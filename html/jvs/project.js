"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj};sky.service("actions",["exceptions"],function(_ref){var exceptions=_ref.exceptions,list={},actions=this.service={perform:function perform(element,event,action,options){var params=action.match(/(.+)\((.*)\)/);params&&(action=params[1],params=params[2].split(","),$.each(params,function(i,val){params[i]=eval(val.trim())})),options&&(params=$.extend(params||[],options));var self=!!element&&$(element),path=action.split("."),current=list,name=action;if(!(self&&self.isDisabled&&self.isDisabled())){if($.each(path,function(i,elem){if(i+1<path.length&&!current[elem])throw new exceptions.system.Error("No action - "+action+", because can't find '"+elem+"'");i+1<path.length&&(current=current[elem]),name=elem}),!current[name])throw new exceptions.system.Error("No action - "+action);current[name].apply(current,[self,event].concat(params||[]))}},add:function(name,events){if("function"==typeof events&&(events=events.safe(!0)()),!events||"object"!==(void 0===events?"undefined":_typeof(events)))throw new exceptions.system.Error("No event object for events '"+name+"' provided");list[name]=$.extend(list[name]||{},events)}};$.fn.action=function(name,selector,action){return void 0===action&&(action=selector,selector=null),this.on(name,selector,function(event,data){action.call(this,event,$(this),data)}.safe())},$(document).action("click submit keyup keydown dblclick mouseover mouseout mouseleave mouseenter change mousedown mouseup touchstart","[data-event]",function(event,self,data){var skyEvent=this.getAttribute("data-event");if(-1!==skyEvent.indexOf(event.type))if(self.isDisabled&&self.isDisabled())event.preventDefault();else{var list=skyEvent.split(";"),i=void 0;for(i=0;i<list.length;i++){var parts=list[i].match(/(\w+):(.*)/);if(3!==parts.length)throw new exceptions.system.Error("Wrong action format in data-event: "+list[i]);var name=parts[1].trim(),action=parts[2].trim();if(name===event.type){event.target===self.get(0)&&event.preventDefault(),data&&(event.data=data);var actionData=self.data("skyActionData");actionData&&(event.data=actionData),"false"!==action&&actions.perform(this,event,action)}}}})}),sky.service("ajax",["callbacks"],function(_ref){var callbacks=_ref.callbacks;this.service=function(url,data,_ref2){var _ref2$object=_ref2.object,object=void 0===_ref2$object?null:_ref2$object,_ref2$callbackData=_ref2.callbackData,callbackData=void 0===_ref2$callbackData?{}:_ref2$callbackData,_ref2$ajaxExtend=_ref2.ajaxExtend,ajaxExtend=void 0===_ref2$ajaxExtend?{}:_ref2$ajaxExtend;object&&(object=$(object).filter(":not(.disabled)").disable());var ajaxCallbacks=new callbacks;return ajaxCallbacks.stop=function(){ajaxCallbacks.ajax.abort()},ajaxCallbacks.ajax=$.ajax($.extend(!0,{url:url,data:data,dataType:"json",type:"post",timeout:48e4,success:function(response,textStatus,jqXHR){var params=$.extend({jqXHR:jqXHR,textStatus:textStatus,object:object},callbackData);return null===response&&(params.error="Данные небыли переданы",params.type="noData"),response.error&&(params.error=response.text,params.type="php"),params.type?ajaxCallbacks.fire("notSuccess, error",params):(params.response=params.data=response,ajaxCallbacks.fire("preSuccess, success, notAbort",params))}.safe(),error:function(jqXHR,textStatus,errorThrown){var type="Unknown",errorText="Во время выполнения запроса произошла ошибка, пожалуйста попробуйте позже";"abort"===textStatus?(type="abort",errorText="Выполнение запроса прервано"):"parsererror"===textStatus?(type="parse",errorText="Ответ пришел в неверном формате, пожалуйста попробуйте позже, текст:<br/>"+jqXHR.responseText):"timeout"===textStatus?(type="timeout",errorText="Время ожидания ответа истекло"):0===jqXHR.status?(type="stopped",errorText="Загрузка остановлена, проверьте свои настройки сети"):codes[jqXHR.status]&&(type=jqXHR.status,errorText="Ошибка во времы выполнения запроса <br/> "+codes[jqXHR.status]);var params=$.extend({error:errorText,type:type,code:type,jqXHR:jqXHR,textStatus:textStatus,status:textStatus,errorThrown:errorThrown,object:object},callbackData);ajaxCallbacks.fire("notSuccess",params),ajaxCallbacks.fire("abort"===textStatus?"abort":"error, notAbort",params)}.safe()},ajaxExtend)),ajaxCallbacks.ajax.promise().always(function(jqXHR,textStatus,errorThrown){object&&object.enable(),ajaxCallbacks.fire("always",{errorThrown:errorThrown,textStatus:textStatus,jqXHR:jqXHR,object:object})}.safe()),ajaxCallbacks};var codes={400:"Неверный запрос",401:"Для выполнеия запроса нужня авторизация",402:"Для доступа к ресурсу необходима оплата",403:"Доступ к ресурсу запрещен",404:"Сервер для выполнения запроса не найден или запрос выполнялся слишком долго",405:"Не поддерживаемый метод HTTP",406:"Не приемлемо",407:"Необходима аутентификация прокси",408:"Истекло время ожидания",409:"Конфликт",410:"Ресурс удален",411:"В запросе не указана длинна",412:"Условие ложно",413:"Размер запроса слишком велик",414:"Запрашиваемый URI слишком длинный",415:"Неподдерживаемый тип данных",416:"Запрашиваемый диапазон не достижим",417:"Ожидаемое неприемлемо",422:"Необрабатываемый экземпляр",423:"Ресурс заблокирован",424:"Невыполненная зависимость",425:"Неупорядоченный набор",426:"Необходимо обновление",428:"Необходимо предусловие",429:"Слишком много запросов",431:"Поля заголовка запроса слишком большие",451:"Недоступно по юридическим причинам",456:"Некорректируемая ошибка",499:"Используется Nginx, соединение закрыто до получения ответа",500:"Внутренняя ошибка сервера",501:"Не реализовано",502:"Плохой или ошибочный шлюз",503:"Сервис недоступен",504:"Шлюз не отвечает",505:"Версия HTTP не поддерживается",506:"Вариант тоже проводит согласование",507:"Переполнение хранилища",508:"Запрос зациклен",509:"Исчерпана пропускная ширина канала",510:"Не расширено",511:"Требуется сетевая аутентификация"}}),sky.service("callback",function(){var Callback=function Callback(flags){return this instanceof Callback?(this.functions=[],this.toRun=0,this.context=this):new Callback(flags)};Callback.prototype={add:function(func,context,options){return this.functions.push({func:func,context:context||!1,once:options&&options.once}),this},removeByContext:function(context){return $.each(this.functions,function(i,current){current.context===context&&this.functions.splice(i,1)}.bind(this)),this},removeByCallback:function(func){return $.each(this.functions,function(i,current){current.func===func&&this.functions.splice(i,1)}.bind(this)),this},fire:function(context,args){$.each(this.functions,function(_,func){func.func.apply(func.context||context,args)})},fireNext:function(args,context){if(this.functions.length<=this.toRun)return!1;this.toRun++;var result,current=this.functions[this.toRun-1],func=current.func;return context=current.context||context||window,"string"==typeof func&&(func=context[func]),!func||(result=!1!==func.apply(current.context||context,args),current.once&&(this.functions.splice(this.toRun-2,1),this.toRun--),result)}},this.service=Callback}),sky.service("callbacks",["callback"],function(_ref){var callback=_ref.callback,Callbacks=function Callbacks(flags){return this instanceof Callbacks?($.extend(!0,this,Callbacks.extend),this.advancedCallbacks={},this.flags(flags)):new Callbacks(flags)};Callbacks.prototype={flags:function(_flags){return this.callbacksFlags=_flags,this},removeListener:function(name,listener){this.advancedCallbacks[name]&&this.advancedCallbacks[name].removeByContext(listener)},on:function(name,func,context,options){var _this=this;return name instanceof Object?$.each(name,function(event,func){_this.on(event,func)}):$.each(this.getEventsNames(name),function(_,name){_this.advancedCallbacks[name]||(_this.advancedCallbacks[name]=callback(_this.callbacksFlags)),_this.advancedCallbacks[name].add(func,context||self.context,options||{})}),this},fire:function(name,args,options){var events=this.getEventsNames(name),self=this;(options=options||{}).noGlobal&&(events=events.slice(1)),$.each(events,function(_,event){if(self.advancedCallbacks[event]){for(;self.advancedCallbacks[event].fireNext(jQuery.extend({event:event},args||[]),self.context,options.possible););options.once||(self.advancedCallbacks[event].toRun=0)}})},getEventsNames:function(name){var names=name.split(","),events=[];return $.each(names,function(i,name){var elements=(name=name.replace(" ","")).split(".");events.push(elements[0]);for(var j=1;j<elements.length;j++)events.push(elements[0]+"."+elements[j]);2<elements.length&&events.push(elements.join("."))}),events},off:function(name){var func=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;func&&this.advancedCallbacks[name]?this.advancedCallbacks[name].removeByCallback(func):delete this.advancedCallbacks[name]}},this.service=Callbacks}),sky.service("directives",["exceptions"],function(_ref){var exceptions=_ref.exceptions,list={},directives=this.service={add:function(name,options,directive){return directive||"function"!=typeof options||(directive=options,options={}),options.directive=directive,options.selector=name,list[name]=options,this},getAttributes:function(element){var attributes={};return $.each(element.get(0).attributes,function(_,attr){attributes[attr.nodeName]=attr.nodeValue}),attributes},parseElement:function(element,options){element=$(element);var attributes=this.getAttributes(element);if(options.json||options.jsonToData){var jsonScript=element.children('script[type="application/json"]');if(jsonScript.length)try{var json=JSON.parse(jsonScript.text());$.extend(attributes,json),options.jsonToData&&element.data("json",json)}catch(e){throw new exceptions.system.Error("Element "+options.selector+" should have json stored content, but error on parse appears")}}"function"==typeof options.directive&&options.directive(element,attributes)},parse:function(element){$.each(list,function(tag,options){$(tag,element).each(function(){directives.parseElement(this,options)}),element.is(tag)&&directives.parseElement(element,options)})}};jQuery.fn.parseDirectives=function(){return directives.parse(this),this},sky.onReady(function(){$("body").parseDirectives()})}),sky.service("stackList",function(){var List=this.service=function(){if(!(this instanceof List))return new List;var elements={},lastId=0,total=0;this.last=function(){var last=!1;return $.each(elements,function(_,element){last=element}),last},this.add=function(element){total++,element[++lastId]=element},this.remove=function(element){$.each(elements,function(index,current){element===current&&(delete elements[index],total--)})},this.total=function(){return total},this.elements=function(){return elements},this.each=function(callback){var _iteratorNormalCompletion=!0,_didIteratorError=!1,_iteratorError=void 0;try{for(var _step,_iterator=elements[Symbol.iterator]();!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=!0){var single=_step.value;callback.apply(single,single)}}catch(err){_didIteratorError=!0,_iteratorError=err}finally{try{!_iteratorNormalCompletion&&_iterator.return&&_iterator.return()}finally{if(_didIteratorError)throw _iteratorError}}}}}),sky.service("supported",function(){try{this.service.fullScreen=void 0!==document.webkitIsFullScreen,this.service.formData=window.FormData&&!0,this.service.XHRIsSupported=XHRIsSupported,this.service.XHRUpload=void 0!==(new XMLHttpRequest).upload,this.service.localStorage=!!window.localStorage}catch(e){}});var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj};sky.service("utils",function(){this.service={isObjectsEqual:function(first,second){if((void 0===first?"undefined":_typeof(first))!==(void 0===second?"undefined":_typeof(second)))return!1;if(first instanceof Array||first instanceof Object){var key=void 0;for(key in first)if(first.hasOwnProperty(key)){if(void 0===second[key])return!1;if(!this.isObjectsEqual(first[key],second[key]))return!1}for(key in second)if(second.hasOwnProperty(key)&&void 0===first[key])return!1}else if(first!==second)return!1;return!0},addLeadingZero:function(value){return(value=parseInt(value))<10&&(value="0"+value),value},encode:function(rawStr){return rawStr.replace(/[\u00A0-\u9999<>\&]/gim,function(i){return"&#"+i.charCodeAt(0)+";"})},jsonData:function(data,inputName){return'<script type="application/json"'+(inputName?' input-name="'+inputName+'"':"")+">"+sky.encode(JSON.stringify(data))+"<\/script>"},prepareSelectData:function(items,func,_ref){var _ref$columnSplitOn=_ref.columnSplitOn,columnSplitOn=void 0===_ref$columnSplitOn?6:_ref$columnSplitOn,_ref$maxColumns=_ref.maxColumns,maxColumns=void 0===_ref$maxColumns?4:_ref$maxColumns,index=0,groupHolder=void 0,compiled=void 0,columns=[],columnsCount=items.length/columnSplitOn;columnsCount<1&&(columnsCount=1),maxColumns<columnsCount&&(columnsCount=maxColumns);var perColumn=Math.ceil(items.length/columnsCount);return $.each(items,function(_,item){(compiled=func({item:item,index:index,column:columns.length}))&&(index%perColumn==0&&(groupHolder=[],columns.push(groupHolder)),groupHolder.push(compiled),index++)}),0===index?[]:{groups:columns}}}}),sky.exec(function(){sky.servicesDeferred.resolve()}),sky.action("shared",{closeWindow:function(self,event){event.target&&event.target===self.get(0)&&self.closest(".windowShadow").data("modalWindow").close()},validForm:function(form){form.validForm()&&form.get(0).submit()},clearForm:function(button,event){var form=button.closest("form");form.get(0).reset(),form.find("input").trigger("change")},changeOrder:function(button,_,orderField,type){var order=button.hasClass("desc")?"asc":"desc",table=button.closest("table"),first=table.find("th:last").parent(),trs=table.find("tr:not(.orderSkip):not(.footer):not(.header)"),cell1=void 0,cell2=void 0,convert="datetime"!==type&&"text"!==type;button.closest("tr").find("a").removeClass("asc desc"),button.addClass(order),trs.sort(function(firstTr,secondTr){if(orderField)cell1=$(firstTr).find("[data-field="+orderField+"]"),cell2=$(secondTr).find("[data-field="+orderField+"]");else{var index=button.closest("tr").find("td, th").index(button.closest("td, th"));cell1=$(firstTr).find("td:eq("+index+")"),cell2=$(secondTr).find("td:eq("+index+")")}var val1=cell1.attr("data-value")||cell1.html(),val2=cell2.attr("data-value")||cell2.html();return convert&&(val1=parseFloat(val1),val2=parseFloat(val2)),val1===val2||convert&&isNaN(val1)&&isNaN(val2)?0:val2<val1||convert&&isNaN(val2)?"desc"===order?1:-1:"desc"===order?-1:1}).insertAfter(first)},changeOrderReload:function(button,_,orderField){var order=button.hasClass("desc")?"asc":"desc";button.closest("tr").find("a").removeClass("asc desc"),button.addClass(order),page.history.set({order:order,orderField:orderField}),page.currentLoader.reload()}}),sky.directive("input.autoHttp",function(input){input.on("focus",function(){""===input.val()&&(input.val("http://").get(0).selectionStart=7)})}),sky.exec(function(){document.body.classList.remove("hidden"),sky.projectDeffered.resolve()});
//# sourceMappingURL=project.js.map
