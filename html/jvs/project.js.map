{"version":3,"sources":["actions/actions.js","ajax/ajax.js","callbacks/callback.js","callbacks/callbacks.js","dataOperator/dataOperator.js","dataOperator/inputsIO.js","directives/directives.js","history/history.js","localStorage/localStorage.js","drag/drag.js","calendar/calendar.js","ajaxFiles/ajaxFiles.dropZone.js","ajaxFiles/ajaxFiles.iframe.js","ajaxFiles/ajaxFiles.js","ajaxFiles/ajaxFiles.xhr.js","models/models.js","models/modelsManager.js","models/modelsStorage.js","notifications/notifications.js","pagination/pagination.js","stacklist/stacklist.js","suggester/suggester.js","supported/supported.js","templates/templates.js","tips/tips.js","utils/utils.js","validator/validator.js","visibleCalculator/visibleCalculator.js","windows/windows.js","pagination/actions/paginationActions.js","selectReplace/actions/selectReplace.js","selectReplace/directives/select.js","suggester/actions/suggests.js","suggester/directives/suggests.js","tips/actions/tips.js","tips/directives/tips.js","servicesInit.js","shared.js","projectInit.js"],"names":["sky","service","_ref","exceptions","list","actions","this","perform","element","event","action","options","params","match","split","$","each","i","val","eval","trim","extend","self","path","current","name","isDisabled","elem","length","system","Error","apply","concat","add","events","safe","_typeof","fn","selector","on","data","call","document","_this","skyEvent","getAttribute","indexOf","type","preventDefault","map","eventString","parts","target","get","callbacks","url","_ref2","_ref2$object","object","undefined","_ref2$callbackData","callbackData","_ref2$ajaxExtend","ajaxExtend","filter","disable","ajaxCallbacks","stop","ajax","abort","dataType","timeout","success","response","textStatus","jqXHR","error","text","fire","errorThrown","errorText","responseText","status","codes","code","promise","always","enable","400","401","402","403","404","405","406","407","408","409","410","411","412","413","414","415","416","417","422","423","424","425","426","428","429","431","451","456","499","500","501","502","503","504","505","506","507","508","509","510","511","Callback","flags","functions","toRun","context","prototype","func","push","once","removeByContext","splice","removeByCallback","args","_iteratorNormalCompletion","_didIteratorError","_iteratorError","_step","_iterator","Symbol","iterator","next","done","value","err","return","fireNext","result","window","callback","Callbacks","advancedCallbacks","callbacksFlags","removeListener","listener","Object","getEventsNames","_","slice","jQuery","possible","names","elements","replace","j","join","off","arguments","inputsIO","notifications","templates","utils","searchField","virtual","_classCallCheck","inputName","default","input","_createClass","key","Array","isObjectsEqual","searchRead","hashRead","readInputsValues","writeInputsValue","hashValue","page","history","hashObject","searchValue","searchObject","baseOptions","fields","historyType","DataOperator","lastRequestData","beforeRequest","setOptions","form","onFormSubmit","bind","validForm","force","reload","set","search","fromUrl","readSearch","writeForm","readHash","read","writeHash","writeSearch","prepareRequest","request","lastResponse","render","loading","reloadContent","holder","item","fieldsList","field","valueOrNullOnDefault","write","fieldName","substring","find","initOperator","initLoader","loader","pagination","_ref2$reload","_ref2$history","html","append","remove","pages","onPageChange","pageNum","message","searchChanged","hashChanged","readInputValue","is","inputs","valuesNamed","valuesLined","attr","writeInputValue","prop","first","trigger","notByUser","values","directives","directive","getAttributes","attributes","nodeName","nodeValue","parseElement","jsonScript","children","json","JSON","parse","e","tag","parseDirectives","onReady","supported","History","hashString","searchString","pathString","intervalId","base","navigate","location","pathname","substr","pushState","oldPath","newPath","getWindowSearch","hash","change","hashDifference","searchDifference","old","getWindowHash","getDifference","rebuild","pathChanged","setHash","encodeURI","setSearch","changed","decodeURIComponent","param","proxy","stringFromObject","obj","getObjects","paramsString","objects","subStrings","str","keyAndValue","string","stored","getObjectsDifference","second","difference","localDiff","returnArray","decodeURI","start","onpopstate","setInterval","time","_class","id","items","getItems","localStorage","getItem","parseJSON","storage","setItem","stringify","bindEvents","move","originalEvent","started","button","x","pageX","y","pageY","calendar","monthsNames","renderDays","moment","date","weeks","currentWeek","month","day","number","isoWeek","days","clone","dateStr","format","dates","period","since","till","setTime","dayPick","dayDiv","notClose","parseInt","getInputValue","close","useTime","isSame","setDayPick","pickedDateView","position","insertAfter","parent","css","marginTop","marginLeft","offset","top","outerHeight","left","periodChangeDay","reset","lastModified","isBefore","isAfter","markSelected","removeClass","addClass","changeDay","hour","minute","changeYear","year","yearView","changeMonth","monthView","getDatePeriod","dateString","getDate","show","showTime","lastPicked","subtract","dateOriginal","elementFromPoint","clientX","touches","clientY","srcElement","parents","keyCode","calendars","zone","files","XHRUpload","attachEvents","dragenter","dragleave","dragend","drop","dragover","isValidFileDrag","effect","dataTransfer","effectAllowed","dropEffect","onStart","dt","isWebkit","navigator","userAgent","types","contains","ajaxFilesXHR","ajaxFilesIFrame","AjaxFiles","saveFiles","file","send","parallel","handler","sendParallel","sendConsequentially","_this2","_iteratorNormalCompletion2","_didIteratorError2","_iteratorError2","_step2","_iterator2","defaultSend","closest","windows","filesAjax","modal","getLast","currentFile","lock","unlock","clearExceptTemplate","appendToModal","totalPercent","percent","stackList","toProceed","inProgress","total","totalLoaded","totalSize","fileRequests","size","Math","random","getName","loaded","queryString","formData","FormData","processData","contentType","xhr","XMLHttpRequest","upload","toFixed","onProgress","beforeSend","setRequestHeader","all","notSuccess","delete","fileRequestData","modelsStorage","modelsDefinition","BaseDefinition","Model","definition","creation","extension","model","addDefinition","fromData","cached","Manager","arr","fromArray","cache","visibleCalculator","tips","Modal","tip","align","Tip","create","loadings","global","appendTo","click","hide","inModalWindow","content","contentHolder","calc","setPosition","calculate","width","height","setHolder","reCalculate","instance","init","Pagination","_ref2$current","pageWidth","last","dimensions","startPage","lastStartPage","pagesVisible","pagesInvisible","scrollAvailable","scrollStart","tumbler","dom","slider","back","forward","redraw","goToPage","newPage","floor","innerWidth","toShow","drawPages","createScroll","scrollLine","runner","scroll","outerWidth","pos","List","lastId","index","hasOwnProperty","single","suggester","lastList","removeData","elementPosition","renderPosition","margin-left","margin-top","selected","prev","fullScreen","templatesList","templatesCompiled","Templates","globals","template","save","cookie","renderWithHolder","noDirectives","compile","temp","renderToText","renderByText","twig","renderByTextToText","load","compiled","fromLS","attrs","hideAll","withoutAutoHide","autoHide","mouseenter","mouseleave","_ref2$autoHide","_ref2$create","_ref2$close","_ref2$ajax","_ref2$highlight","highlight","insertBefore","shadow","opacity","background","closeTimeout","setTimeout","display","animate","fadeOut","fadeIn","blur","clearTimeout","what","addLeadingZero","encode","rawStr","charCodeAt","jsonData","prepareSelectData","_ref$columnSplitOn","columnSplitOn","_ref$maxColumns","maxColumns","columns","columnsCount","groupHolder","perColumn","ceil","column","groups","validator","validateForm","validationRule","addRule","validateElement","pass","shouldBeValidated","Options","totalPass","firstError","lastSuccess","firstSuccess","rules","ruleOverload","compiledRule","Rule","validate","onSuccess","onError","rule","ruleDefaults","optionsDefaults","errorClass","successClass","overload","required","requiredIfFilled","email","same","regexp","RegExp","numeric","positive","parseFloat","max","min","minLength","maxLength","getDeclaredRules","Calculator","minHeight","scrollable","holderRect","scrollTop","windowHeight","windowWidth","sizes","right","realHeight","scrollLeft","bottom","popup","popupWidth","popupHeight","win","replaceOffset","popupOffset","leftDifference","topDifference","middle","visible","selfOffset","selfWidth","locked","dataContainer","closeButton","body","reRender","detach","removeMessages","innerHeight","byUser","setPage","scrollTo","grab","previous","which","stopPropagation","rus","eng","expression","toLowerCase","expressionInvert","character","hasClass","inputHtml","selectAll","unSelectAll","showTip","label","originalTip","hideTip","dropOffset","getDropOffset","margintop","focus","defaultValue","defaultAllValue","filtered","prepend","labels","multiple","adverts","suggestAjax","advert","username","campaigns","campaign","campaignsSpecial","showTipWithText","hideTips","forceHideTips","tipText","exec","servicesDeferred","resolve","closeWindow","submit","clearForm","changeOrder","orderField","order","table","trs","cell1","cell2","convert","sort","firstTr","secondTr","val1","val2","isNaN","changeOrderReload","currentLoader","selectionStart","classList","projectDeffered"],"mappings":"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","file":"project.js","sourcesContent":["sky.service(\"actions\", [\"exceptions\"], function ({exceptions}) {\n\n\tlet list = {},\n\t\tactions = this.service = {\n\n\t\t\t/**\n\t\t\t * Performs action\n\t\t\t * @param element\n\t\t\t * @param event\n\t\t\t * @param action\n\t\t\t * @param {Array} [options]\n\t\t\t */\n\t\t\tperform: function (element, event, action, options) {\n\n\t\t\t\t/* Get parameters */\n\t\t\t\tlet params = action.match(/(.+)\\((.*)\\)/);\n\n\t\t\t\t/* Parse */\n\t\t\t\tif (params) {\n\n\t\t\t\t\t/* Get function */\n\t\t\t\t\taction = params[1];\n\n\t\t\t\t\t/* Parse params */\n\t\t\t\t\tparams = params[2].split(\",\");\n\t\t\t\t\t$.each(params, function (i, val) {\n\t\t\t\t\t\tparams[i] = eval(val.trim());\n\t\t\t\t\t})\n\t\t\t\t}\n\n\t\t\t\t/* Options */\n\t\t\t\tif (options)\n\t\t\t\t\tparams = $.extend(params || [], options);\n\n\t\t\t\t/* Get */\n\t\t\t\tlet self = element ? $(element) : false,\n\t\t\t\t\tpath = action.split(\".\"),\n\t\t\t\t\tcurrent = list,\n\t\t\t\t\tname = action;\n\n\t\t\t\t/* If disabled */\n\t\t\t\tif (self && self.isDisabled && self.isDisabled())\n\t\t\t\t\treturn;\n\n\t\t\t\t$.each(path, function (i, elem) {\n\n\t\t\t\t\t/* Search */\n\t\t\t\t\tif (i + 1 < path.length && !current[elem])\n\t\t\t\t\t\tthrow new exceptions.system.Error(\"No action - \" + action + \", because can't find '\" + elem + \"'\");\n\n\t\t\t\t\t/* Get new elem */\n\t\t\t\t\tif (i + 1 < path.length)\n\t\t\t\t\t\tcurrent = current[elem];\n\n\t\t\t\t\t/* Save name */\n\t\t\t\t\tname = elem;\n\n\t\t\t\t});\n\n\t\t\t\t/* If no */\n\t\t\t\tif (!current[name])\n\t\t\t\t\tthrow new exceptions.system.Error(\"No action - \" + action);\n\n\t\t\t\t/* Call */\n\t\t\t\tcurrent[name].apply(current, [self, event].concat(params || []));\n\n\t\t\t},\n\n\t\t\t/**\n\t\t\t * Adds actions to list\n\t\t\t * @param name Group name\n\t\t\t * @param events List\n\t\t\t */\n\t\t\tadd: function (name, events) {\n\n\t\t\t\tif (typeof events === \"function\")\n\t\t\t\t\tevents = events.safe(true)(true);\n\n\t\t\t\t// Check\n\t\t\t\tif (!events || typeof events !== 'object')\n\t\t\t\t\tthrow new exceptions.system.Error(\"No event object for events '\" + name + \"' provided\");\n\n\t\t\t\t// Save\n\t\t\t\tlist[name] = $.extend(list[name] || {}, events);\n\n\t\t\t}\n\n\t\t};\n\n\n\t/**\n\t * Adds special bind function\n\t * @param {string} name Event name\n\t * @param {*} selector Selector string\n\t * @param {function} [action] Action function\n\t * @returns {jQuery}\n\t */\n\t$.fn.action = function(name, selector, action) {\n\n\t\t/* Parameters skip */\n\t\tif(typeof action === \"undefined\") { action = selector; selector = null; }\n\n\t\t/* Bind */\n\t\treturn this.on(name, selector, function(event, data) {\n\t\t\taction.call(this, event, $(this), data);\n\t\t}.safe());\n\t};\n\n\t/*\n\t * Bind declarative events\n\t */\n\t$(document).action(\"click submit keyup keydown dblclick mouseover mouseout mouseleave mouseenter change mousedown mouseup touchstart\", '[data-event]', function (event, self, data) {\n\n\t\t/* Get string */\n\t\tlet skyEvent = this.getAttribute(\"data-event\");\n\n\t\t/* If no such event in data-event attribute */\n\t\tif (skyEvent.indexOf(event.type) === -1)\n\t\t\treturn;\n\n\t\t/* If disabled */\n\t\tif (self.isDisabled && self.isDisabled()) {\n\t\t\tevent.preventDefault();\n\t\t\treturn;\n\t\t}\n\n\t\tskyEvent.split(\";\").map(eventString => {\n\n\t\t\t/* Get elements */\n\t\t\tlet parts = eventString.match(/(\\w+):(.*)/);\n\n\t\t\t/* Wrong */\n\t\t\tif (parts.length !== 3)\n\t\t\t\tthrow new exceptions.system.Error(\"Wrong action format in data-event: \" + eventString);\n\n\t\t\t/* Get elements */\n\t\t\tlet name = parts[1].trim(),\n\t\t\t\taction = parts[2].trim();\n\n\t\t\t/* Another event */\n\t\t\tif (name !== event.type)\n\t\t\t\treturn;\n\n\t\t\t/* No default go */\n\t\t\tif (event.target === self.get(0))\n\t\t\t\tevent.preventDefault();\n\n\t\t\t/* Passed data */\n\t\t\tevent.data = data;\n\n\t\t\t/* Perform action */\n\t\t\tactions.perform(this, event, action);\n\n\t\t});\n\n\t});\n\n});","sky.service(\"ajax\", [\"callbacks\"], function({ callbacks }) {\n\n\t/**\n\t * Advanced ajax execution\n\t * To abort call stop() method instead of abort() because it's used for abort callback set, or .ajax.abort()\n\t * You may skip type, don't skip it if lock is string set false in object and data\n\t * @param {string} url\t\t\t\tRequested url\n\t * @param {object} [data]\t\t\tHolds request parameters\n\t * @param {jQuery} [object]\t\t\tObject which performs request, to disable it during request\n\t * @param {object} [ajaxExtend]\t\tAdditional ajax options, see http://api.jquery.com/jQuery.ajaxSetup/\n\t * @param {object} [callbackData]\tAdditional params that passed to any callback\n\t */\n\tthis.service = function(url, data, { object = null, callbackData = {}, ajaxExtend = {} }) {\n\n\t\t/* Lock button */\n\t\tif(object)\n\t\t\tobject = $(object).filter(\":not(.disabled)\").disable();\n\n\t\t/* New object to store callbacks */\n\t\tlet ajaxCallbacks = new callbacks();\n\t\tajaxCallbacks.stop = function() { ajaxCallbacks.ajax.abort(); };\n\n\t\t/* Perform ajax request */\n\t\tajaxCallbacks.ajax = $.ajax($.extend(true, {\n\n\t\t\t/* Set base options */\n\t\t\turl     \t: url,\n\t\t\tdata    \t: data,\n\t\t\tdataType\t: \"json\",\n\t\t\ttype    \t: \"post\",\n\t\t\ttimeout\t\t: 480 * 1000,\n\t\t\tsuccess: function(response, textStatus, jqXHR) {\n\n\t\t\t\t/* Possible params list */\n\t\t\t\tlet params = $.extend({ jqXHR: jqXHR, textStatus: textStatus, object: object }, callbackData);\n\n\t\t\t\t/* If empty response */\n\t\t\t\tif(response === null) {\n\t\t\t\t\tparams.error = \"  \";\n\t\t\t\t\tparams.type = \"noData\";\n\t\t\t\t}\n\n\t\t\t\t/* If response returned with error */\n\t\t\t\tif(response.error) {\n\t\t\t\t\tparams.error = response.text;\n\t\t\t\t\tparams.type = \"php\";\n\t\t\t\t}\n\n\t\t\t\t/* If error type set */\n\t\t\t\tif(params.type)\n\t\t\t\t\treturn ajaxCallbacks.fire(\"notSuccess, error\", params); // No data\n\n\t\t\t\t/* Set response in possible params */\n\t\t\t\tparams.response = params.data = response;\n\n\t\t\t\t/* User success function */\n\t\t\t\treturn ajaxCallbacks.fire(\"preSuccess, success, notAbort\", params);\n\n\t\t\t}.safe(),\n\t\t\terror: function(jqXHR, textStatus, errorThrown) {\n\n\t\t\t\t/* Defaults */\n\t\t\t\tlet type        = \"Unknown\",\n\t\t\t\t\terrorText   = \"     ,   \";\n\n\t\t\t\t/* Get error text according to response data */\n\t\t\t\tif(textStatus === \"abort\") {\n\t\t\t\t\ttype \t  = \"abort\";\n\t\t\t\t\terrorText = '  ';\n\t\t\t\t} else if(textStatus === 'parsererror') {\n\t\t\t\t\ttype \t  = \"parse\";\n\t\t\t\t\terrorText = \"    ,   , :<br/>\" + jqXHR.responseText;\n\t\t\t\t} else if(textStatus === 'timeout') {\n\t\t\t\t\ttype \t  = \"timeout\";\n\t\t\t\t\terrorText = '   ';\n\t\t\t\t} else if(jqXHR.status === 0) {\n\t\t\t\t\ttype \t  = \"stopped\";\n\t\t\t\t\terrorText = ' ,    ';\n\t\t\t\t} else if(codes[jqXHR.status]) {\n\t\t\t\t\ttype = jqXHR.status;\n\t\t\t\t\terrorText = '     <br/> ' + codes[jqXHR.status];\n\t\t\t\t}\n\n\t\t\t\t/* Possible params list */\n\t\t\t\tlet params = $.extend({\n\t\t\t\t\terror      : errorText,\n\t\t\t\t\ttype       : type,\n\t\t\t\t\tcode\t   : type,\n\t\t\t\t\tjqXHR      : jqXHR,\n\t\t\t\t\ttextStatus : textStatus,\n\t\t\t\t\tstatus     : textStatus,\n\t\t\t\t\terrorThrown: errorThrown,\n\t\t\t\t\tobject     : object\n\t\t\t\t}, callbackData);\n\n\t\t\t\t/* Execute callback */\n\t\t\t\tajaxCallbacks.fire(\"notSuccess\", params);\n\n\t\t\t\t/* Execute special ajaxCallbacks */\n\t\t\t\tajaxCallbacks.fire(textStatus === \"abort\" ? \"abort\" : \"error, notAbort\", params);\n\n\t\t\t}.safe()\n\n\t\t}, ajaxExtend));\n\n\t\t/* On always set */\n\t\tajaxCallbacks.ajax.promise().always(function(jqXHR, textStatus, errorThrown) {\n\n\t\t\t/* Unlock objects */\n\t\t\tif(object)\n\t\t\t\tobject.enable();\n\n\t\t\t/* Always callback */\n\t\t\tajaxCallbacks.fire(\"always\", { errorThrown: errorThrown, textStatus: textStatus, jqXHR: jqXHR, object: object});\n\n\t\t}.safe());\n\n\t\treturn ajaxCallbacks;\n\n\t};\n\n\t/**\n\t * Contains http codes\n\t */\n\tlet codes = {\n\n\t\t/* Request errors */\n\t\t400: \" \",\n\t\t401: \"    \",\n\t\t402: \"     \",\n\t\t403: \"   \",\n\t\t404: \"          \",\n\t\t405: \"   HTTP\",\n\t\t406: \" \",\n\t\t407: \"  \",\n\t\t408: \"  \",\n\t\t409: \"\",\n\t\t410: \" \",\n\t\t411: \"    \",\n\t\t412: \" \",\n\t\t413: \"   \",\n\t\t414: \" URI  \",\n\t\t415: \"  \",\n\t\t416: \"   \",\n\t\t417: \" \",\n\t\t422: \" \",\n\t\t423: \" \",\n\t\t424: \" \",\n\t\t425: \" \",\n\t\t426: \" \",\n\t\t428: \" \",\n\t\t429: \"  \",\n\t\t431: \"    \",\n\t\t451: \"   \",\n\t\t456: \" \",\n\t\t499: \" Nginx,     \",\n\n\t\t/* Server error */\n\t\t500: \"  \",\n\t\t501: \" \",\n\t\t502: \"   \",\n\t\t503: \" \",\n\t\t504: \"  \",\n\t\t505: \" HTTP  \",\n\t\t506: \"   \",\n\t\t507: \" \",\n\t\t508: \" \",\n\t\t509: \"   \",\n\t\t510: \" \",\n\t\t511: \"  \"\n\n\t};\n\n});","sky.service(\"callback\", function() {\n\n\t/**\n\t * Creates callback object that holds functions list\n\t * @param {string} [flags]\n\t * @returns {*}\n\t * @constructor\n\t */\n\tlet Callback = function(flags) {\n\n\t\t/* Self construct */\n\t\tif(!(this instanceof Callback))\n\t\t\treturn new Callback(flags);\n\n\t\t/**\n\t\t * Functions list holder\n\t\t * @type {Array}\n\t\t */\n\t\tthis.functions = [];\n\t\tthis.toRun =  0;\n\t\tthis.context = this;\n\n\t\t/* Self return for next usage */\n\t\treturn this;\n\n\t};\n\n\t/**\n\t * Base\n\t * @type {{functions: Array, toRun: number, context: *, add: add, removeByContext: removeByContext, fire: fire, fireNext: fireNext}}\n\t */\n\tCallback.prototype = {\n\n\t\t/**\n\t\t * Adds new function to stack\n\t\t * @param {Function} func Function to add\n\t\t * @param {Object} context Function context\n\t\t * @param {Object} options Call options\n\t\t */\n\t\tadd: function(func, context, options) {\n\t\t\tthis.functions.push({\n\t\t\t\tfunc: func,\n\t\t\t\tcontext: context || false,\n\t\t\t\tonce: options && options.once\n\t\t\t});\n\t\t\treturn this;\n\t\t},\n\n\t\t/**\n\t\t * Removes function from list by context\n\t\t * @param context\n\t\t */\n\t\tremoveByContext: function(context) {\n\n\t\t\t/* Find listener */\n\t\t\tlet i;\n\t\t\tfor(i in this.functions)\n\t\t\t\tif(this.functions[i].context === context)\n\t\t\t\t\tthis.functions.splice(i, 1);\n\n\t\t\t/* Self return */\n\t\t\treturn this;\n\n\t\t},\n\n\t\t/**\n\t\t * Removes function from list by context\n\t\t * @param func\n\t\t */\n\t\tremoveByCallback: function(func) {\n\n\t\t\t/* Find listener */\n\t\t\tlet i;\n\t\t\tfor(i in this.functions)\n\t\t\t\tif(this.functions[i].func === func)\n\t\t\t\t\tthis.functions.splice(i, 1);\n\n\t\t\t/* Self return */\n\t\t\treturn this;\n\n\t\t},\n\n\t\t/**\n\t\t * Fires all functions\n\t\t * @param {Object} context Function context\n\t\t * @param {Array} args Arguments\n\t\t */\n\t\tfire: function(context, args) {\n\t\t\tfor(let func of this.functions)\n\t\t\t\tfunc.func.apply(func.context || context, args);\n\t\t},\n\n\t\t/**\n\t\t * Fires next function\n\t\t * @param {Array|Object} args Arguments\n\t\t * @param {Object} context Function context\n\t\t */\n\t\tfireNext: function(args, context) {\n\n\t\t\t/* If no more to run */\n\t\t\tif(this.functions.length <= this.toRun)\n\t\t\t\treturn false;\n\n\t\t\t/* Set next to run */\n\t\t\tthis.toRun++;\n\n\t\t\t/* Function to run */\n\t\t\tlet current = this.functions[this.toRun - 1],\n\t\t\t\tresult,\n\t\t\t\tfunc = current.func;\n\n\t\t\t/* Set context */\n\t\t\tcontext = current.context || context || window;\n\n\t\t\t/* Get function in string */\n\t\t\tif(typeof func === \"string\")\n\t\t\t\tfunc = context[func];\n\n\t\t\t/* If no function found */\n\t\t\tif(!func)\n\t\t\t\treturn true;\n\n\t\t\t/* Call function */\n\t\t\tresult =  func.apply(current.context || context, args) !== false;\n\n\t\t\t/* If call once */\n\t\t\tif(current.once) {\n\t\t\t\tthis.functions.splice(this.toRun - 2, 1);\n\t\t\t\tthis.toRun--;\n\t\t\t}\n\n\t\t\t/* Return function result */\n\t\t\treturn result;\n\t\t}\n\n\t};\n\n\tthis.service = Callback;\n\n});","sky.service(\"callbacks\", [\"callback\"], function({ callback }) {\n\n\t/**\n\t *\n\t * Callbacks prepared object\n\t * @param {*} [flags] Flags list for jQuery.Callbacks\n\t * @constructor\n\t */\n\tlet Callbacks = function(flags) {\n\n\t\t/* Self construction */\n\t\tif(!(this instanceof Callbacks))\n\t\t\treturn new Callbacks(flags);\n\n\t\t/* Add properties */\n\t\t$.extend(true, this, Callbacks.extend);\n\n\t\t/* Callbacks list */\n\t\tthis.advancedCallbacks = {};\n\n\t\t/* Set default flags and self context */\n\t\treturn this.flags(flags);\n\n\t};\n\n\t/**\n\t * Prototype\n\t * @type {{on: on, fire: fire, off: off, flags: flags, setContext: setContext}}\n\t */\n\tCallbacks.prototype = {\n\n\t\t\t/**\n\t\t\t * Flags for sky.Callback\n\t\t\t * @param {object} flags Flags list\n\t\t\t * @returns {*}\n\t\t\t */\n\t\t\tflags: function(flags) {\n\t\t\t\tthis.callbacksFlags = flags;\n\t\t\t\treturn this;\n\t\t\t},\n\n\t\t\t/**\n\t\t\t * Remove by listener\n\t\t\t * @param {string} name Event name\n\t\t\t * @param {string} listener Listener object\n\t\t\t */\n\t\t\tremoveListener: function(name, listener) {\n\t\t\t\tif(this.advancedCallbacks[name]) {\n\t\t\t\t\tthis.advancedCallbacks[name].removeByContext(listener);\n\t\t\t\t}\n\t\t\t},\n\n\t\t\t/**\n\t\t\t * Adds new event handler\n\t\t\t * @param {string} \t name \t\t\tName of event\n\t\t\t * @param {function|string} func \tFunction be called on event fires\n\t\t\t * @param {object}   [context]\t\tFunction options\n\t\t\t * @param {object}   [options]\t\tFunction options\n\t\t\t */\n\t\t\ton:  function(name, func, context, options) {\n\n\n\t\t\t\tif(name instanceof Object)\n\t\t\t\t\t$.each(name, (event, func) => { this.on(event, func) });\n\n\t\t\t\telse $.each(this.getEventsNames(name), (_, name) => {\n\n\t\t\t\t\t/* Create callbacks */\n\t\t\t\t\tif(!this.advancedCallbacks[name])\n\t\t\t\t\t\tthis.advancedCallbacks[name] = callback(this.callbacksFlags);\n\n\t\t\t\t\t/* Add function */\n\t\t\t\t\tthis.advancedCallbacks[name].add(func, context ? context : self.context, options || {});\n\n\t\t\t\t});\n\n\t\t\t\treturn this;\n\t\t\t},\n\n\t\t\t/**\n\t\t\t * Fires callbacks for specified event\n\t\t\t * @param {string} name Name of event\n\t\t\t * @param {object} args Arguments to be passed\n\t\t\t * @param {object} [options] Additional options\n\t\t\t */\n\t\t\tfire: function(name, args, options) {\n\n\t\t\t\t/* Success last */\n\t\t\t\tlet events = this.getEventsNames(name),\n\t\t\t\t\tself = this,\n\t\t\t\t\tnext = false;\n\t\t\t\t\toptions = options || {};\n\n\t\t\t\t/* Remove global if need */\n\t\t\t\tif(options[\"noGlobal\"])\n\t\t\t\t\tevents = events.slice(1);\n\n\t\t\t\t/* Fire events */\n\t\t\t\t$.each(events, function(_, event) {\n\n\t\t\t\t\t/* If no callback */\n\t\t\t\t\tif(!self.advancedCallbacks[event])\n\t\t\t\t\t\treturn;\n\n\t\t\t\t\t/* Run */\n\t\t\t\t\tdo {\n\t\t\t\t\t\tnext = self.advancedCallbacks[event].fireNext(jQuery.extend({ event: event }, args || []), self.context, options.possible);\n\t\t\t\t\t} while(next);\n\n\t\t\t\t\t/* Reset */\n\t\t\t\t\tif(!options.once)\n\t\t\t\t\t\tself.advancedCallbacks[event].toRun = 0;\n\n\t\t\t\t});\n\n\t\t\t},\n\n\t\t\t/**\n\t\t\t * Get all event names from global name\n\t\t\t * @param {String} name Global event name\n\t\t\t * @returns {Array}\n\t\t\t */\n\t\t\tgetEventsNames: function(name) {\n\n\t\t\t\t/* Get events names */\n\t\t\t\tlet names = name.split(\",\"), events = [];\n\n\t\t\t\t/* Go through */\n\t\t\t\t$.each(names, function(i, name) {\n\n\t\t\t\t\t/* Remove spaces */\n\t\t\t\t\tname = name.replace(\" \", \"\");\n\n\t\t\t\t\t/* Get elements */\n\t\t\t\t\tlet elements = name.split(\".\");\n\t\t\t\t\tevents.push(elements[0]);\n\n\t\t\t\t\t/* Go through */\n\t\t\t\t\tfor(let j = 1; j < elements.length; j++)\n\t\t\t\t\t\tevents.push(elements[0] + \".\" + elements[j]);\n\n\t\t\t\t\t/* Global event */\n\t\t\t\t\tif(elements.length > 2)\n\t\t\t\t\t\tevents.push(elements.join(\".\"));\n\n\t\t\t\t});\n\n\t\t\t\t/* Return */\n\t\t\t\treturn events;\n\n\t\t\t},\n\n\t\t/**\n\t\t * Removes event handlers and functions\n\t\t * @param {string} name Event name\n\t\t * @param func\n\t\t */\n\t\t\toff: function(name, func = null) {\n\t\t\t\tif(func && this.advancedCallbacks[name])\n\t\t\t\t\tthis.advancedCallbacks[name].removeByCallback(func);\n\t\t\t\telse\n\t\t\t\t\tdelete this.advancedCallbacks[name];\n\t\t\t}\n\n\t\t};\n\n\t\tthis.service = Callbacks;\n\n});","sky.service(\"dataOperator\", [ \"inputsIO\", \"notifications\", \"templates\", \"utils\", \"ajax\", \"actions\" ], function ({ inputsIO, notifications, templates, utils, ajax, actions }) {\n\n\tclass searchField {\n\t\tconstructor(name, virtual) {\n\t\t\tthis.name = name;\n\t\t\tthis.inputName = name;\n\t\t\tthis.virtual = virtual || false;\n\t\t\tthis.default = null;\n\t\t\tthis.input = false;\n\t\t\tthis.value = null;\n\t\t}\n\t\tvalueOrNullOnDefault() {\n\t\t\tif ((this.default instanceof Array) && (this.value instanceof Array))\n\t\t\t\treturn utils.isObjectsEqual(this.value, this.default) ? null : this.value;\n\n\t\t\treturn this.value === this.default ? null : this.value;\n\t\t}\n\t\tread() {\n\t\t\tif (this.virtual === \"search\")\n\t\t\t\treturn this.searchRead();\n\t\t\telse if (this.virtual)\n\t\t\t\treturn this.hashRead();\n\t\t\telse if (this.input)\n\t\t\t\tthis.value = inputsIO.readInputsValues(this.input);\n\n\t\t\treturn this.value;\n\t\t}\n\t\twrite() {\n\t\t\tif (this.input)\n\t\t\t\tinputsIO.writeInputsValue(this.value === null ? this.default : this.value, this.input);\n\t\t\treturn this.value;\n\t\t}\n\t\thashRead() {\n\t\t\tlet hashValue = page.history.hashObject[this.name];\n\t\t\treturn this.value = (typeof hashValue === \"undefined\") ? this.default : hashValue;\n\t\t}\n\t\tsearchRead () {\n\t\t\tlet searchValue = page.history.searchObject[this.name];\n\t\t\treturn this.value = (typeof searchValue === \"undefined\") ? this.default : searchValue;\n\t\t}\n\t}\n\n\t/**\n\t * Default options\n\t * @type {{}}\n\t */\n\tlet baseOptions = {\n\t\tfields: {},\n\t\thistoryType: \"hash\"\n\t};\n\n\t/* Creates new data operator */\n\tclass DataOperator {\n\t\tconstructor(options) {\n\n\t\t\t/* Stores last request object */\n\t\t\tthis.lastRequestData = false;\n\n\t\t\t/* Func that calls before request */\n\t\t\tthis.beforeRequest = false;\n\t\t\t\n\t\t\t/* Fields list */\n\t\t\tthis.fields = {};\n\n\t\t\t/* Add base options, but only not set, that's why so fun construction */\n\t\t\tthis.options = $.extend({}, baseOptions, true);\n\n\t\t\t/* Options init */\n\t\t\tthis.setOptions(options);\n\n\t\t}\n\n\t\t/** Saves to options */\n\t\tsetOptions(options) {\n\n\t\t\t/* Back link */\n\t\t\tlet self = this;\n\n\t\t\t/* Set submit handler */\n\t\t\tif (options.form)\n\t\t\t\t$(options.form).action(\"submit\", this.onFormSubmit.bind(this));\n\n\t\t\t/* Add to options */\n\t\t\t$.extend(this.options, options, true);\n\n\t\t\t/* Self return */\n\t\t\treturn this;\n\t\t}\n\n\t\t/**\n\t\t * On form submit\n\t\t * @param event\n\t\t */\n\t\tonFormSubmit(event) {\n\n\t\t\t/* Prevent */\n\t\t\tevent.preventDefault();\n\n\t\t\t/* If form not valid */\n\t\t\tif (!$(this.options.form).validForm())\n\t\t\t\treturn;\n\n\t\t\tlet options = {force: true};\n\n\t\t\tif (this.fields[\"page\"])\n\t\t\t\toptions[this.options.historyType === \"search\" ? \"search\" : \"hash\"] = {page: 1};\n\n\t\t\t/* Update */\n\t\t\tthis.reload(options);\n\n\t\t}\n\n\t\tprepareRequest(options) {\n\n\t\t\t/* On empty */\n\t\t\toptions = options || {};\n\n\t\t\t/* Hash fields */\n\t\t\tif (options[\"hash\"])\n\t\t\t\tpage.history.set(options[\"hash\"]);\n\n\t\t\t/* Hash fields */\n\t\t\tif (options[\"search\"])\n\t\t\t\tpage.history.search(options[\"search\"]);\n\n\t\t\t/* Hash fields */\n\t\t\tif (options[\"virtual\"]) {\n\t\t\t\tif (this.options.historyType === \"search\")\n\t\t\t\t\tpage.history.search(options[\"virtual\"]);\n\t\t\t\telse\n\t\t\t\t\tpage.history.set(options[\"virtual\"]);\n\t\t\t}\n\n\t\t\t/* Write to form from hash */\n\t\t\tif (options.fromUrl) {\n\t\t\t\tif (this.options.historyType === \"search\")\n\t\t\t\t\tthis.readSearch().writeForm();\n\t\t\t\telse\n\t\t\t\t\tthis.readHash().writeForm();\n\t\t\t}\n\n\t\t\t/* jQuery wrap */\n\t\t\tif (this.options.form && !$(this.options.form).validForm())\n\t\t\t\treturn false;\n\n\t\t\t/* Read */\n\t\t\tlet data = this.read();\n\n\t\t\t/* Add additional data */\n\t\t\tif (this.options[\"requestData\"])\n\t\t\t\tdata = $.extend(data, this.options[\"requestData\"]);\n\n\t\t\t/* Check is same and no force requested */\n\t\t\tif (this.lastRequestData !== false && utils.isObjectsEqual(this.lastRequestData, data) && !options[\"force\"])\n\t\t\t\treturn false;\n\n\t\t\t/* Set hash data */\n\t\t\tif (!options.fromUrl && this.options.historyType === \"search\")\n\t\t\t\tthis.writeSearch();\n\t\t\telse if (!options.fromUrl)\n\t\t\t\tthis.writeHash();\n\n\t\t\t/* Before request call */\n\t\t\tif (this.beforeRequest)\n\t\t\t\tif (this.beforeRequest(data, options) === false)\n\t\t\t\t\treturn false;\n\n\t\t\t/* Return data */\n\t\t\treturn data;\n\n\t\t}\n\n\t\t/**\n\t\t * Reloads data according to params\n\t\t * @param options\n\t\t * @returns {DataOperator}\n\t\t */\n\t\treload(options) {\n\n\t\t\t/* Prepare */\n\t\t\tlet data = this.prepareRequest(options);\n\n\t\t\t/* Reload */\n\t\t\tif (data)\n\t\t\t\tthis.request(data);\n\n\t\t\t/* Self return */\n\t\t\treturn this;\n\n\t\t}\n\n\t\t/**\n\t\t * Performs request to reload data\n\t\t * @param data\n\t\t */\n\t\trequest(data) {\n\n\t\t\t/* Back link */\n\t\t\tlet self = this;\n\n\t\t\t/* Save last data */\n\t\t\tself.lastRequestData = data;\n\n\t\t\t/* Stop old request */\n\t\t\tif (this.ajax)\n\t\t\t\tthis.ajax.stop();\n\n\t\t\t/* Request */\n\t\t\tthis.ajax = ajax(this.options.url, data)\n\t\t\t\t.on(\"success\", function (response) {\n\t\t\t\t\tself.lastResponse = response;\n\t\t\t\t\tself.render(response, data);\n\t\t\t\t})\n\t\t\t\t.on(\"error\", function (error) {\n\t\t\t\t\tself.error(error)\n\t\t\t\t})\n\t\t\t\t.on(\"always\", function () {\n\t\t\t\t\tself.ajax = false;\n\t\t\t\t});\n\n\t\t\t/* Create loading, auto remove when ajax finishes */\n\t\t\tnotifications.loading(this.ajax).reloadContent(this.options.holder);\n\n\t\t}\n\n\t\t/**\n\t\t * On success, have to be overloaded\n\t\t * @param data\n\t\t * @param request\n\t\t */\n\t\trender(data, request) {}\n\n\t\t/**\n\t\t * On error, have to be overloaded\n\t\t * @param error\n\t\t */\n\t\terror(error) {}\n\n\t\t/**\n\t\t * Adds list of fields to current list\n\t\t * @param {Array} list List of names\n\t\t * @param {Boolean} [virtual] Virtual fields flag\n\t\t */\n\t\tfieldsList(list, virtual) {\n\n\t\t\t/* Back link */\n\t\t\tlet self = this;\n\n\t\t\t/* Go through and push */\n\t\t\t$.each(list, function (_, item) {\n\t\t\t\tself.options.fields[item] = virtual;\n\t\t\t});\n\n\t\t\t/* Self return */\n\t\t\treturn this;\n\t\t\t\n\t\t}\n\n\t\t/**\n\t\t * Sets form fields\n\t\t * @param list\n\t\t * @returns {*}\n\t\t */\n\t\trealFieldsList(list) {\n\t\t\treturn this.fieldsList(list);\n\t\t}\n\n\t\t/**\n\t\t * Set none forms fields\n\t\t * @param list\n\t\t * @returns {*}\n\t\t */\n\t\tvirtualFieldsList(list) {\n\t\t\treturn this.fieldsList(list, true);\n\t\t}\n\n\t\t/**\n\t\t * Reads real fields\n\t\t * @returns {{}}\n\t\t */\n\t\treadReal() {\n\n\t\t\t/* Data holder */\n\t\t\tlet data = {};\n\n\t\t\t/* Go through */\n\t\t\t$.each(this.fields, function (i, field) {\n\t\t\t\t/** @let field searchField */\n\n\t\t\t\tif (field.virtual)\n\t\t\t\t\treturn;\n\n\t\t\t\t/* Read */\n\t\t\t\tfield.read();\n\n\t\t\t\t/* Get non default or null */\n\t\t\t\tlet val = field.valueOrNullOnDefault();\n\n\t\t\t\t/* If value not same as default */\n\t\t\t\tif (val !== null)\n\t\t\t\t\tdata[field.name] = val;\n\n\t\t\t});\n\n\t\t\t/* Self return */\n\t\t\treturn data;\n\n\t\t}\n\n\t\t/** Reads form to fields */\n\t\tread() {\n\n\t\t\t/* Data holder */\n\t\t\tlet data = {};\n\n\t\t\t/* Go through */\n\t\t\t$.each(this.fields, function (i, field) {\n\t\t\t\t/** @let field searchField */\n\n\t\t\t\t/* Read */\n\t\t\t\tfield.read();\n\n\t\t\t\t/* Get non default or null */\n\t\t\t\tlet val = field.valueOrNullOnDefault();\n\n\t\t\t\t/* If value not same as default */\n\t\t\t\tif (val !== null)\n\t\t\t\t\tdata[field.name] = val;\n\n\t\t\t});\n\n\t\t\t/* Self return */\n\t\t\treturn data;\n\t\t}\n\n\t\t/** Write current field to form */\n\t\twriteForm() {\n\t\t\t$.each(this.fields, function (i, field) {\n\t\t\t\t/** @let field searchField */\n\t\t\t\tfield.write();\n\t\t\t});\n\n\t\t\t/* Self return */\n\t\t\treturn this;\n\t\t}\n\n\t\t/** Reads hash to fields */\n\t\treadHash() {\n\t\t\t$.each(this.fields, function (i, field) {\n\t\t\t\t/** @let field searchField */\n\t\t\t\tfield.hashRead();\n\t\t\t});\n\n\t\t\t/* Self return */\n\t\t\treturn this;\n\t\t}\n\n\t\t/** Reads hash to fields */\n\t\treadSearch() {\n\t\t\t$.each(this.fields, function (i, field) {\n\t\t\t\t/** @let field searchField */\n\t\t\t\tfield.searchRead();\n\t\t\t});\n\n\t\t\t/* Self return */\n\t\t\treturn this;\n\t\t}\n\n\t\t/** Writes current fields to hash */\n\t\twriteHash() {\n\n\t\t\t/* To write */\n\t\t\tlet write = {};\n\n\t\t\t/* Go through */\n\t\t\t$.each(this.fields, function (i, field) {\n\t\t\t\t/** @let field searchField */\n\t\t\t\twrite[field.name] = field.valueOrNullOnDefault();\n\t\t\t});\n\n\t\t\t/* Write to hash */\n\t\t\tpage.history.set(write);\n\n\t\t\t/* Self return */\n\t\t\treturn this;\n\t\t}\n\n\t\t/** Writes current fields to hash */\n\t\twriteSearch() {\n\n\t\t\t/* To write */\n\t\t\tlet write = {};\n\n\t\t\t/* Go through */\n\t\t\t$.each(this.fields, function (i, field) {\n\t\t\t\t/** @let field searchField */\n\t\t\t\twrite[field.name] = field.valueOrNullOnDefault();\n\t\t\t});\n\n\t\t\t/* Write to hash */\n\t\t\tpage.history.search(write);\n\n\t\t\t/* Self return */\n\t\t\treturn this;\n\n\t\t}\n\n\t\t/** Finds inputs associated with fields */\n\t\tinitInputs() {\n\n\t\t\t/* Back link */\n\t\t\tlet self = this;\n\n\t\t\t$.each(this.options.fields, function (fieldName, virtual) {\n\n\t\t\t\t// Create search field\n\t\t\t\tlet field = new searchField(fieldName, virtual ? self.options.historyType : false);\n\n\t\t\t\t/** @let field searchField */\n\t\t\t\tif (!field.virtual) {\n\n\t\t\t\t\t/* Find input */\n\t\t\t\t\tif (field.name[0] === \"*\") {\n\t\t\t\t\t\tfield.name = field.name.substring(1);\n\t\t\t\t\t\tfield.input = $(self.options.form).find(\".selectReplaceChoose[data-input=\" + field.name + \"]\");\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t\tfield.input = $(self.options.form).find('[name=\"' + field.name + '\"]');\n\n\t\t\t\t\t/* Remove fields without input */\n\t\t\t\t\tif (!field.input || !field.input.length) {\n\t\t\t\t\t\tdelete self.fields[fieldName];\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\t/* Save */\n\t\t\t\t\tself.fields[fieldName] = field;\n\n\t\t\t\t\t/* Read default */\n\t\t\t\t\tfield.default = field.read();\n\t\t\t\t\tfield.value = null;\n\t\t\t\t} else {\n\t\t\t\t\tif (self.options.historyType === \"search\")\n\t\t\t\t\t\tfield.virtual = \"search\";\n\t\t\t\t\tself.fields[fieldName] = field;\n\t\t\t\t}\n\t\t\t});\n\n\t\t\t/* Self return */\n\t\t\treturn this;\n\t\t}\n\t};\n\n\t/* Interface */\n\tthis.service = {\n\t\tinitOperator: options => new DataOperator(options),\n\t\tsearchField: searchField,\n\t\tinitLoader: function (loader, notifications, pagination, { reload = true, history = true }) {\n\n\t\t\t/* Add count */\n\t\t\tloader.beforeRequest = function (data, options) {\n\t\t\t\tif (!this.lastRequestData || options.force)\n\t\t\t\t\tdata[\"count\"] = true;\n\t\t\t};\n\n\t\t\t/* Render function */\n\t\t\tloader.render = function (response) {\n\n\t\t\t\t// Re render\n\t\t\t\t$(this.options.holder).html('').append(\n\t\t\t\t\ttemplates.render(\"page-result-render\", response)\n\t\t\t\t);\n\n\t\t\t\t// Remove old\n\t\t\t\tif (this.pagination)\n\t\t\t\t\tthis.pagination = this.pagination.remove();\n\n\t\t\t\tif (typeof response.pages !== \"undefined\") {\n\n\t\t\t\t\t// Pages holder\n\t\t\t\t\tlet holder = $(\"#pages\").html('');\n\n\t\t\t\t\t// Create new\n\t\t\t\t\tif (response.pages > 1 && pagination) {\n\t\t\t\t\t\tthis.pagination = pagination.add({\n\t\t\t\t\t\t\tpages: response.pages,\n\t\t\t\t\t\t\tcurrent: response.page,\n\t\t\t\t\t\t\tholder: holder\n\t\t\t\t\t\t});\n\t\t\t\t\t\tthis.pagination.onPageChange = function (pageNum) {\n\t\t\t\t\t\t\tloader.reload({virtual: {page: pageNum}});\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t};\n\n\t\t\t/* On loading error */\n\t\t\tloader.error = function (error) {\n\n\t\t\t\t// Remove pagination on error\n\t\t\t\tif (this.pagination)\n\t\t\t\t\tthis.pagination = this.pagination.remove();\n\n\t\t\t\t// Clear\n\t\t\t\t$(this.options.holder).html('').append(notifications.message({text: error}).render);\n\t\t\t};\n\n\t\t\t/* Reload */\n\t\t\tif (reload)\n\t\t\t\tloader.reload({fromUrl: true});\n\n\t\t\t/* Set handler */\n\t\t\tif (history)\n\t\t\t\tpage.history.on(\"change\", function (searchChanged, hashChanged) {\n\t\t\t\t\tif (searchChanged || hashChanged)\n\t\t\t\t\t\tloader.reload({fromUrl: true});\n\t\t\t\t});\n\n\t\t}\n\t}\n\n});","sky.service(\"inputsIO\", function () {\n\n\tthis.service = {\n\n\t\t/**\n\t\t * Get value of single input\n\t\t * @param input\n\t\t * @returns {*}\n\t\t */\n\t\treadInputValue: function (input) {\n\n\t\t\tif (input.is(\".selectReplaceChoose\")) {\n\n\t\t\t\t// Get inputs\n\t\t\t\tlet inputs = input.find(\"input\");\n\n\t\t\t\t// Read\n\t\t\t\tlet data = this.readInputsValues(inputs);\n\n\t\t\t\t// If all checked\n\t\t\t\tif (data.length === inputs.length)\n\t\t\t\t\treturn true;\n\n\t\t\t\t// Return data\n\t\t\t\treturn data;\n\n\t\t\t} else if (input.is(\":checkbox\") || input.is(\":radio\")) {\n\t\t\t\treturn input.is(\":checked\") ? input.val() : false;\n\t\t\t} else\n\t\t\t\treturn input.val() === \"\" ? false : input.val();\n\n\n\t\t},\n\n\t\t/**\n\t\t * Get value of multiple inputs\n\t\t * @param inputs\n\t\t * @returns {*}\n\t\t */\n\t\treadInputsValues: function (inputs) {\n\n\t\t\t/* If single input */\n\t\t\tif (inputs.length === 1)\n\t\t\t\treturn this.readInputValue(inputs);\n\n\t\t\t/* Values holder */\n\t\t\tlet valuesNamed = [],\n\t\t\t\tvaluesLined = [],\n\t\t\t\tself = this;\n\n\t\t\t/* Go through */\n\t\t\tinputs.each(function () {\n\n\t\t\t\t/* Get value */\n\t\t\t\tlet input = $(this),\n\t\t\t\t\tvalue = self.readInputValue(input);\n\n\t\t\t\t/* If we get values */\n\t\t\t\tif (value !== false) {\n\t\t\t\t\tvaluesNamed.push({name: input.attr(\"name\"), value: value});\n\t\t\t\t\tvaluesLined.push(value);\n\t\t\t\t}\n\n\t\t\t});\n\n\t\t\t/* Single */\n\t\t\tif (valuesLined.length === 1) {\n\t\t\t\treturn valuesLined[0];\n\t\t\t}\n\n\t\t\t/* Return */\n\t\t\treturn valuesLined.length ? valuesLined : false;\n\n\t\t},\n\n\t\t/**\n\t\t * Write single input value\n\t\t * @param value\n\t\t * @param input\n\t\t * @returns {*}\n\t\t */\n\t\twriteInputValue: function (value, input) {\n\n\t\t\tif (input.is(\".selectReplaceChoose\")) {\n\n\t\t\t\t// Get inputs\n\t\t\t\tlet inputs = input.find(\"input\");\n\n\t\t\t\t// If all checked\n\t\t\t\tif (value === true)\n\t\t\t\t\tinputs.prop(\"checked\", true);\n\t\t\t\telse\n\t\t\t\t\tthis.writeInputsValue(value, inputs);\n\n\t\t\t\tif (inputs.length)\n\t\t\t\t\tinputs.first().trigger(\"change\", {notByUser: true});\n\n\t\t\t} else if (input.is(\":checkbox\") || input.is(\":radio\")) {\n\t\t\t\treturn input.prop(\"checked\", value !== false);\n\t\t\t} else\n\t\t\t\treturn input.val(value === false ? \"\" : value);\n\t\t},\n\n\t\t/**\n\t\t * Write multiple inputs value\n\t\t * @param values\n\t\t * @param inputs\n\t\t * @returns {*}\n\t\t */\n\t\twriteInputsValue: function (values, inputs) {\n\n\t\t\t/* Write single */\n\t\t\tif (inputs.length < 2)\n\t\t\t\treturn this.writeInputValue(values, inputs);\n\n\t\t\t/* Multiple */\n\t\t\tif (inputs.is(\":checkbox\") || inputs.is(\":radio\")) {\n\t\t\t\tinputs.prop(\"checked\", false);\n\t\t\t\tif (values instanceof Array) {\n\t\t\t\t\t$.each(values, function (_, val) {\n\t\t\t\t\t\tinputs.filter('[value=\"' + val + '\"]').prop(\"checked\", true);\n\t\t\t\t\t});\n\t\t\t\t\tinputs.first().trigger(\"change\", {notByUser: true});\n\t\t\t\t} else {\n\t\t\t\t\tif (values === false || values === true)\n\t\t\t\t\t\tinputs.prop(\"checked\", values).first().trigger(\"change\", {notByUser: true});\n\t\t\t\t\telse\n\t\t\t\t\t\tinputs.filter('[value=\"' + values + '\"]').prop(\"checked\", true).trigger(\"change\", {notByUser: true});\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tinputs.val(values);\n\t\t\t}\n\t\t}\n\n\t}\n\n});","sky.service(\"directives\", [\"exceptions\"], function ({exceptions}) {\n\n\tlet list = {},\n\t\tdirectives = this.service = {\n\n\t\t\t/**\n\t\t\t * Adds new directive\n\t\t\t * @param {string} name Directive name\n\t\t\t * @param {*} options Directive options\n\t\t\t * @param {function} directive How to parse directive\n\t\t\t */\n\t\t\tadd: function (name, options, directive) {\n\n\t\t\t\t/* Reset */\n\t\t\t\tif (!directive && typeof options === \"function\") {\n\t\t\t\t\tdirective = options;\n\t\t\t\t\toptions = {};\n\t\t\t\t}\n\t\t\t\toptions.directive = directive;\n\t\t\t\toptions.selector = name;\n\n\t\t\t\t/* Save */\n\t\t\t\tlist[name] = options;\n\n\t\t\t\t/* Self return*/\n\t\t\t\treturn this;\n\n\t\t\t},\n\n\t\t\t/**\n\t\t\t * Get element attributes\n\t\t\t * @param element\n\t\t\t * @returns {{}}\n\t\t\t */\n\t\t\tgetAttributes: function (element) {\n\n\t\t\t\t/* Holds attributes */\n\t\t\t\tlet attributes = {};\n\n\t\t\t\t/* Copy them to list */\n\t\t\t\tfor(let attr of element.get(0).attributes)\n\t\t\t\t\tattributes[attr.nodeName] = attr.nodeValue;\n\n\t\t\t\t/* Return */\n\t\t\t\treturn attributes;\n\n\t\t\t},\n\n\t\t\t/**\n\t\t\t * Applies directive convert to element\n\t\t\t * @param element\n\t\t\t * @param options\n\t\t\t */\n\t\t\tparseElement: function (element, options) {\n\n\t\t\t\t/* Get element */\n\t\t\t\telement = $(element);\n\n\t\t\t\t/* Get element attributes */\n\t\t\t\tlet attributes = this.getAttributes(element);\n\n\t\t\t\t/* Parse body for jason data */\n\t\t\t\tif (options[\"json\"] || options[\"jsonToData\"]) {\n\n\t\t\t\t\t/* Get child */\n\t\t\t\t\tlet jsonScript = element.children('script[type=\"application/json\"]');\n\n\t\t\t\t\t/* If we have json encoded data */\n\t\t\t\t\tif (jsonScript.length) {\n\n\t\t\t\t\t\ttry {\n\n\t\t\t\t\t\t\t/* Parse json */\n\t\t\t\t\t\t\tlet json = JSON.parse(jsonScript.text());\n\n\t\t\t\t\t\t\t/* Extend */\n\t\t\t\t\t\t\t$.extend(attributes, json);\n\n\t\t\t\t\t\t\t/* Save to data */\n\t\t\t\t\t\t\tif (options[\"jsonToData\"])\n\t\t\t\t\t\t\t\telement.data(\"json\", json);\n\n\t\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\t\tthrow new exceptions.system.Error(\"Element \" + options.selector + \" should have json stored content, but error on parse appears\");\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t/* Call parse function */\n\t\t\t\tif (typeof options.directive === \"function\")\n\t\t\t\t\toptions.directive(element, attributes);\n\t\t\t},\n\n\t\t\t/**\n\t\t\t * Searches and replaces directives in element\n\t\t\t * @param element\n\t\t\t */\n\t\t\tparse: function (element) {\n\t\t\t\t$.each(list, function (tag, options) {\n\t\t\t\t\t$(tag, element).each(function () {\n\t\t\t\t\t\tdirectives.parseElement(this, options);\n\t\t\t\t\t});\n\t\t\t\t\tif (element.is(tag))\n\t\t\t\t\t\tdirectives.parseElement(element, options);\n\t\t\t\t});\n\t\t\t}\n\n\n\t\t};\n\n\t/* Add jQuery fn */\n\tjQuery.fn.parseDirectives = function () {\n\n\t\t/* Parse */\n\t\tdirectives.parse(this);\n\n\t\t/* Return */\n\t\treturn this;\n\n\t};\n\n\t/* Parse body for directives when all ready */\n\tsky.onReady(function () {\n\t\t$(\"body\").parseDirectives();\n\t});\n\n});","sky.service(\"history\", [ \"callbacks\", \"supported\" ], function ({ callbacks, supported }) {\n\n\n\t/**\n\t * Get difference fields in objects\n\t * @param {object} first  Object to compare\n\t * @param {object} second Object to compare\n\t */\n    let getObjectsDifference = function (first, second) {\n\n\t\tlet difference = {},\n\t\t    localDiff = false;\n\n        /* If both arrays or objects */\n\t\tif ((first instanceof Array && second instanceof Array) || (first instanceof Object && second instanceof Object)) {\n\n            /* Find what was changed or deleted in second */\n\t\t\t$.each(first, function (key, value) {\n\n                /* If no such elements in second */\n\t\t\t\tif (typeof second[key] === \"undefined\")\n\t\t\t\t\tdifference[key] = null; // Set to null\n\n                /* Check if different */\n\t\t\t\telse if (localDiff = getObjectsDifference(value, second[key])) {\n\t\t\t\t\tdifference[key] = localDiff;\n\t\t\t\t}\n\n\t\t\t});\n\n            /* If was added */\n\t\t\t$.each(second, function (key, value) {\n\t\t\t\tif (typeof first[key] === \"undefined\")\n\t\t\t\t\tdifference[key] = value;\n\t\t\t});\n\n            /* Convert object to array */\n\t\t\tif (first instanceof Array) {\n\t\t\t\tlet returnArray = [];\n\t\t\t\t$.each(difference, function (key) {\n\t\t\t\t\treturnArray.push(difference[key]);\n\t\t\t\t});\n\t\t\t\tdifference = returnArray;\n\t\t\t}\n\n\t\t} else {\n\t\t\tif (first !== second) return second;\n\t\t\telse return false;\n\t\t}\n\n        /* No array difference */\n\t\tif (difference.length === 0) return false;\n\t\telse return difference;\n\n\t};\n\n    /**\n     * History constructor\n     * @param [options]\n     * @returns {sky.History}\n     * @constructor\n     */\n    sky.History = function (options) {\n\n\t\t/* Self creation */\n        if (!(this instanceof sky.History))\n            return new sky.History(options);\n\n\t\t/* Reset */\n        this.options = options || {};\n\n\t\t/* Set events */\n        this.events = this.options.events || new callbacks();\n        this.options.events = this.events;\n\n\t\t/* Self return */\n        return this;\n\n    };\n\n    /**\n     * Extending\n     */\n    $.extend(sky.History.prototype, {\n\n        /**\n         * Stores last saved hash\n         */\n        hashString: \"\",\n\n        /**\n         * Stores last saved search\n         */\n        searchString: \"\",\n\n        /**\n         * Stores last saved path\n         */\n        pathString: \"\",\n\n        /**\n         * Stores object with hash params key/value pairs\n         */\n        hashObject: {},\n\n        /**\n         * Stores object with page search params key/value pairs\n         */\n        searchObject: {},\n\n        /**\n         * Stores events\n         */\n        events: undefined,\n\n        /**\n         * Holds hash check function interval id\n         */\n        intervalId: 0,\n\n        /**\n         * This page base url\n         */\n        base: \"\",\n\n        /**\n         * Changes current path to specified\n         * @param {string} path PAth to navigate\n         */\n        navigate: function (path) {\n\n            // Get path\n            path = path.replace(\"~\", this.base);\n\n            // Get current\n            let current = (window.location.pathname + window.location.search).substr(this.base.length);\n\n            // If changes\n            if (current !== path) {\n\n                // Set new state\n                history.pushState({ oldPath: this.pathString, newPath: path, search: this.searchObject}, path, path);\n\n                // Get new\n                this.pathString = window.location.pathname.substr(this.base.length);\n\n                // Get search string\n                this.searchString = this.getWindowSearch();\n\n                // Fire event\n                this.events.fire(\"navigate.path, always\", {hash: this.hashObject, path: this.pathString, search: this.searchObject});\n\n            }\n        },\n\n        /**\n         * Fires on path change\n         */\n        change: function () {\n\n\t\t\t/* Hash difference holder */\n            let hashDifference = {},\n                searchDifference = {},\n                old = this.pathString,\n                hashChanged = false,\n                searchChanged = false;\n\n\t\t\t/* If api supported */\n            if (this.supported)\n                this.pathString = window.location.pathname.substr(this.base.length);\n\n\t\t\t/* Check if hash changed */\n            if (this.hashString !== this.getWindowHash()) {\n\n\t\t\t\t/* Get difference */\n                hashDifference = this.getDifference(this.getWindowHash(), this.hashObject);\n\n\t\t\t\t/* Hash change flag */\n                hashChanged = true;\n\n            }\n\n\t\t\t/* Check if params changed */\n            if (this.searchString !== this.getWindowSearch()) {\n\n\t\t\t\t/* Get difference */\n                searchDifference = this.getDifference(this.getWindowSearch(), this.searchObject);\n\n\t\t\t\t/* Hash change flag */\n                searchChanged = true;\n\n            }\n\n\t\t\t/* If nothing changed */\n            if (this.pathString === old && !hashChanged && !searchChanged)\n                return;\n\n\t\t\t/* Rebuild hash object on new hash str */\n            this.rebuild();\n\n\t\t\t/* Fire */\n            this.events.fire(\"change, always\", {\n                hash: this.hashObject,\n                hashDifference: hashDifference,\n                searchDifference: searchDifference,\n                path: this.pathString,\n                oldPath: old,\n                searchChanged: searchChanged,\n                hashChanged: hashChanged,\n                pathChanged: old !== this.pathString\n            });\n\n        },\n\n        /**\n         * Navigates to specified path\n         * @param path\n         */\n        setHash: function (path) {\n\n\t\t\t/* To not jump top */\n            if (path === \"\" && window.location.hash !== \"\")\n                path = \"none\";\n\n\t\t\t/* Save */\n            this.hashString = path;\n\n\t\t\t/* Set hash */\n            window.location.hash = encodeURI(path);//encodeURI(path);\n\n        },\n\n        /**\n         * Navigates to specified path\n         * @param path\n         */\n        setSearch: function (path) {\n\n\t\t\t/* Set path */\n            this.navigate(window.location.pathname + encodeURI(path !== \"\" ? \"?\" + path : \"\"));\n\n        },\n\n        /**\n         * Sets hash letiable\n         * @param {object}    elements Fields to be set\n         * @param {boolean}    [force]     Replace all stored fields with elements object\n         */\n        set: function (elements, force) {\n\n            let changed = false;\n\n\t\t\t/* Force rewrite */\n            if (force)\n                this.hashObject = elements;\n\n\t\t\t/* Go through elements and add or change them */\n            $.each(elements, (key, value) => {\n\n\t\t\t\t/* If we need delete */\n                if (value === null)\n                    delete this.hashObject[key];\n                else\n                    this.hashObject[key] = value;\n\n\t\t\t\t/* Set as changed */\n                changed = true;\n\n            });\n\n\t\t\t/* If any changes we rebuild hash */\n            if (changed || force)\n                this.setHash(decodeURIComponent(jQuery.param(this.hashObject).replace(/\\+/g, \" \")));\n\n\t\t\t/* Fire */\n            this.events.fire(\"set, always\", {elements: elements, hash: this.hashObject, path: this.pathString});\n\n        },\n\n\n        /**\n         * Sets hash letiable\n         * @param {object}    elements Fields to be set\n         * @param {boolean}    [force]     Replace all stored fields with elements object\n         */\n        search: function (elements, force) {\n\n            let changed = false;\n\n\t\t\t/* Force rewrite */\n            if (force)\n                this.searchObject = elements;\n\n\t\t\t/* Go through elements and add or change them */\n            $.each(elements, $.proxy(function (key, value) {\n\n\t\t\t\t/* If we need delete */\n                if (value === null)\n                    delete this.searchObject[key];\n                else\n                    this.searchObject[key] = value;\n\n\t\t\t\t/* Set as changed */\n                changed = true;\n\n            }, this));\n\n\t\t\t/* If any changes we rebuild hash */\n            if (changed || force)\n                this.setSearch(decodeURIComponent(jQuery.param(this.searchObject).replace(/\\+/g, \" \")));\n\n\t\t\t/* Fire */\n\t\t\tthis.events.fire(\"set, always\", {elements: elements, hash: this.hashObject, path: this.pathString});\n\n        },\n\n        /**\n         * Makes hash from object\n         * @param obj\n         * @returns {*|void|string|XML}\n         */\n        stringFromObject: function (obj) {\n            return jQuery.param(obj).replace(/\\+/g, \" \");\n        },\n\n        /**\n         * Get objects according to hash string\n         * @param {string} paramsString String which contains key=value pairs, would be parsed to object\n         */\n        getObjects: function (paramsString) {\n\n            let objects = {};\n\n\t\t\t/* Remove sharp */\n            if (paramsString.substr(0, 1) === '#' || paramsString.substr(0, 1) === '?')\n                paramsString = paramsString.slice(1, paramsString.length);\n\n\t\t\t/* Split parameters */\n            let subStrings = paramsString.split(\"&\");\n\n\t\t\t/* Get params */\n            $.each(subStrings, function (i, str) {\n\n                let keyAndValue = str.split(\"=\", 2);\n\n\t\t\t\t/* If no assign */\n                if (keyAndValue.length < 2)\n                    return;\n\n                let name = keyAndValue[0];\n\n\t\t\t\t/* Truncate brackets */\n                if (name.substr(-2) === \"[]\")\n                    name = name.substr(0, name.length - 2);\n\n\t\t\t\t/* Special hash for \"=\" in value  */\n                keyAndValue[1] = str.substr(keyAndValue[0].length + 1);\n\n\t\t\t\t/* If object repeats we create array */\n                if (typeof objects[name] === \"undefined\") objects[name] = keyAndValue[1];\n                else {\n                    if (!(objects[name] instanceof Array)) objects[name] = [objects[name]];\n                    objects[name].push(keyAndValue[1]);\n                }\n            });\n\n            return objects;\n\n        },\n\n        /**\n         * Finds difference between current stored hash and parameter\n         * @returns {*}\n         */\n        getDifference: function (string, stored) {\n\n\t\t\t/* Init */\n            let objects = this.getObjects(decodeURI(string));\n            return getObjectsDifference(stored, objects);\n\n        },\n\n        /**\n         * Rebuilds stored hash parameters according to current one\n         */\n        rebuild: function () {\n            this.hashString = this.getWindowHash();\n            this.hashObject = this.getObjects(this.hashString);\n            this.searchString = this.getWindowSearch();\n            this.searchObject = this.getObjects(this.searchString);\n            this.pathString = window.location.pathname;\n            return this;\n\n        },\n\n        /**\n         * Gets current window hash without \"#\"\n         * @returns {string}\n         */\n        getWindowHash: function () {\n\n\t\t\t/* Get decoded hash */\n            let hash = decodeURI(window.location.hash);\n\n\t\t\t/* Remove sharp */\n            if (hash.substr(0, 1) === '#')\n                hash = hash.slice(1);\n\n\t\t\t/* Return */\n            return hash;\n\n        },\n\n        /**\n         * Gets current window parameters without \"?\"\n         * @returns {string}\n         */\n        getWindowSearch: function () {\n\n\t\t\t/* Get decoded hash */\n            let search = decodeURI(window.location.search);\n\n\t\t\t/* Remove question */\n            if (search.substr(0, 1) === '?')\n                search = search.slice(1);\n\n\t\t\t/* Return */\n            return search;\n\n        },\n\n        /**\n         * Set interval execution\n         */\n        start: function () {\n\n            /* Set base if any */\n\t\t\tif (this.options.base)\n\t\t\t\tthis.base = this.options.base;\n\n\t\t\t/* If supported history */\n            if (window.history)\n                window.onpopstate = this.change.bind(this);\n\n            /* Timeout */\n            if (!this.intervalId)\n                this.intervalId = setInterval(this.change.bind(this), this.options.time || 500);\n\n\t\t\t/* Immediately event */\n            this.change();\n            return this;\n        }\n\n    });\n\n});","sky.service(\"localStorage\", [ \"callbacks\" ], function({ callbacks }) {\n\n\t//noinspection JSUnusedLocalSymbols\n\tlet LocalStorage = this.service = class {\n\t\tconstructor(options) {\n\t\t\tthis.name = options.name || \"global\";\n\t\t\tthis.events = callbacks();\n\t\t}\n\n\t\t/**\n\t\t * Loads item form database\n\t\t * @param {*} id Unique id\n\t\t */\n\t\tload(id) {\n\t\t\tlet items = this.getItems();\n\t\t\treturn items ? items[id] : undefined;\n\t\t}\n\n\t\tgetItems() {\n\t\t\ttry {\n\n\t\t\t\t/* Try to get item from storage */\n\t\t\t\tlet items = localStorage.getItem(this.name);\n\n\t\t\t\t/* Trigger error */\n\t\t\t\tif(items !== null)\n\t\t\t\t\treturn $.parseJSON(items);\n\n\t\t\t} catch(e) {\n\t\t\t\tthis.events.fire(\"error\", { storage: this });\n\t\t\t}\n\n\t\t\t/* Undefined on error */\n\t\t\treturn undefined;\n\n\t\t}\n\n\t\t/**\n\t\t * Save data to storage\n\t\t * @param id\n\t\t * @param data\n\t\t * @returns {*}\n\t\t */\n\t\tsave(id, data) {\n\n\t\t\ttry {\n\n\t\t\t\t/* Save */\n\t\t\t\tlet items = this.getItems() || {};\n\n\t\t\t\t/* Add item */\n\t\t\t\titems[id] = data;\n\n\t\t\t\t/* Save keys */\n\t\t\t\tlocalStorage.setItem(this.name, JSON.stringify(items));\n\n\t\t\t} catch(e) {\n\t\t\t\tthis.events.fire(\"error\", { storage: this });\n\t\t\t}\n\n\t\t\t/* Self return */\n\t\t\treturn this;\n\n\t\t}\n\n\t\t/**\n\t\t * Removes from storage\n\t\t * @param id\n\t\t * @returns {*}\n\t\t */\n\t\tremove(id) {\n\t\t\ttry {\n\n\t\t\t\t/* Save */\n\t\t\t\tlet items = this.getItems();\n\n\t\t\t\t/* Add item */\n\t\t\t\tdelete items[id];\n\n\t\t\t\t/* Save keys */\n\t\t\t\tlocalStorage.setItem(this.name, JSON.stringify(items));\n\n\t\t\t} catch(e) {\n\t\t\t\tthis.events.fire(\"error\", { storage: this });\n\t\t\t}\n\n\t\t\t/* Self return */\n\t\t\treturn this;\n\n\t\t}\n\t};\n\n});","sky.service(\"drag\", [\"callbacks\"], function({callbacks}) {\n\tlet self = {\n\t\tbindEvents: (event, events) => {\n\t\t\tself.bind(event)\n\t\t\t\t.on(\"start\", events.start)\n\t\t\t\t.on(\"move\", events.move)\n\t\t\t\t.on(\"stop\", events.stop)\n\t\t},\n\t\tbind: event => {\n\n\t\t\t// Get original event\n\t\t\tevent = event.originalEvent || event;\n\n\t\t\t// Init vars\n\t\t\tlet started = false,\n\t\t\t\tcallbacks = callbacks();\n\n\t\t\t// Check button\n\t\t\tif(event.button && event.button !== 1)\n\t\t\t\treturn callbacks;\n\n\t\t\t// Stop default action\n\t\t\tevent.preventDefault();\n\n\t\t\t$(document).on(\"mousemove.drag\", function(event) {\n\n\t\t\t\t// Start\n\t\t\t\tif(!started) {\n\t\t\t\t\tstarted = true;\n\t\t\t\t\tcallbacks.fire(\"start\", { event: event, x: event.pageX, y: event.pageY });\n\t\t\t\t}\n\t\t\t\t// Move\n\t\t\t\telse callbacks.fire(\"move\", { event: event, x: event.pageX, y: event.pageY });\n\n\t\t\t\t// Prevent default\n\t\t\t\tevent.preventDefault();\n\t\t\t\treturn false;\n\n\t\t\t}).on(\"mouseup.drag\", function(event) {\n\n\t\t\t\t// Off events\n\t\t\t\t$(document).off(\"mousemove.drag\").off(\"mouseup.drag\");\n\n\t\t\t\t// If not started\n\t\t\t\tif(!started)\n\t\t\t\t\treturn;\n\n\t\t\t\t// Stop default action\n\t\t\t\tevent.preventDefault();\n\n\t\t\t\t// Call stop callback\n\t\t\t\tcallbacks.fire(\"stop\", { event: event, x: event.pageX, y: event.pageY });\n\n\t\t\t});\n\n\t\t\treturn callbacks;\n\t\t}\n\t};\n\treturn self;\n});","sky.service(\"calendar\", [ \"templates\" ], function ({ templates }) {\n\n\t/* This class is for showing calendar to pick date on page */\n\tlet calendar = {\n\n\t\t/* Days set */\n\t\tmonthsNames: window.page.data.monthsNames || [\"\", \"\", \"\", \"\", \"\", \"\", \"\", \"\", \"\", \"\", \"\", \"\"],\n\n\t\trenderDays: function () {\n\n\t\t\t/* Clone */\n\t\t\tlet current = moment(this.date),\n\t\t\t\tweeks = [],\n\t\t\t\tcurrentWeek = false;\n\n\t\t\t/* From first */\n\t\t\tcurrent.date(1);\n\n\t\t\t/* Go through */\n\t\t\twhile (current.month() === this.date.month()) {\n\n\t\t\t\t/* Make week if new */\n\t\t\t\tif (!currentWeek || current.day() === 1) {\n\t\t\t\t\tcurrentWeek = {number: current.isoWeek(), days: []};\n\t\t\t\t\tweeks.push(currentWeek);\n\t\t\t\t}\n\n\t\t\t\t/* Push */\n\t\t\t\tcurrentWeek.days.push({date: current.clone(), dateStr: current.format(\"YYYY.MM.DD\"), day: current.day() === 0 ? 6 : current.day() - 1});\n\n\t\t\t\t/* Go next day */\n\t\t\t\tcurrent.add(1, \"d\");\n\n\t\t\t}\n\n\t\t\t/* Render */\n\t\t\tthis.dates.html('').append(templates.render(\"calendar-dates\", {\n\t\t\t\tweeks: weeks,\n\t\t\t\tdateStr: this.date.format(\"YYYY.MM.DD\"),\n\t\t\t\tcurrent: this.date,\n\t\t\t\tperiod: this.period,\n\t\t\t\tsince: this.since,\n\t\t\t\ttill: this.till\n\t\t\t}));\n\n\t\t\t/* Render */\n\t\t\tthis.setTime();\n\n\t\t},\n\n\t\t/**\n\t\t * When user picks date\n\t\t * @param {*} dayDiv Div that user clicked, if he did\n\t\t * @param notClose\n\t\t */\n\t\tdayPick: function (dayDiv, notClose) {\n\n\t\t\t/* Set date */\n\t\t\tif (dayDiv)\n\t\t\t\tthis.date.date(parseInt(dayDiv.html()));\n\n\t\t\tthis.field.val(this.getInputValue()).trigger(\"change\").trigger(\"keyup\");\n\t\t\tif (!notClose) this.close();\n\n\t\t},\n\n\t\tgetInputValue: function () {\n\n\t\t\t/* Get field new value */\n\t\t\tif (this.useTime)\n\t\t\t\treturn this.date.format(\"DD.MM.YYYY HH:mm\");\n\t\t\telse if (this.period && this.since.isSame(this.till))\n\t\t\t\treturn this.since.format(\"DD.MM.YYYY\");\n\t\t\telse if (this.period)\n\t\t\t\treturn this.since.format(\"DD.MM.YYYY\") + ' - ' + this.till.format(\"DD.MM.YYYY\");\n\n\t\t\t/* Default */\n\t\t\treturn this.date.format(\"DD.MM.YYYY\");\n\n\t\t},\n\n\t\tsetDayPick: function () {\n\t\t\tthis.pickedDateView.html(this.getInputValue());\n\t\t},\n\n\t\t/**\n\t\t * Position date picker\n\t\t * @param {*} field Item that we should position under\n\t\t */\n\t\tposition: function (field) {\n\n\t\t\tthis.holder.insertAfter(field.parent()).css({\n\t\t\t\tmarginTop: 0,\n\t\t\t\tmarginLeft: 0,\n\t\t\t\tposition: \"absolute\"\n\t\t\t}).css({\n\t\t\t\tmarginTop: field.offset().top - this.holder.offset().top + field.outerHeight() + 1,\n\t\t\t\tmarginLeft: field.offset().left - this.holder.offset().left + 1\n\t\t\t});\n\n\t\t},\n\n\t\t/**\n\t\t * Sets time inputs in calendar values\n\t\t */\n\t\tsetTime: function () {\n\n\t\t\t/* Set time */\n\t\t\tthis.holder.find(\".time .hour\").val(this.date.format(\"HH\"));\n\t\t\tthis.holder.find(\".time .minute\").val(this.date.format(\"mm\"));\n\n\t\t},\n\n\t\tperiodChangeDay: function () {\n\n\t\t\tlet reset = function () {\n\t\t\t\tcalendar.since = calendar.date.clone();\n\t\t\t\tcalendar.till = calendar.date.clone();\n\t\t\t\tcalendar.lastModified = \"none\"\n\t\t\t};\n\n\t\t\tif (this.date.isBefore(this.since)) {\n\t\t\t\tif (this.lastModified !== \"since\") {\n\t\t\t\t\tthis.since = this.date.clone();\n\t\t\t\t\tthis.lastModified = \"since\"\n\t\t\t\t}\n\t\t\t\telse reset();\n\t\t\t} else if (this.date.isAfter(this.till)) {\n\t\t\t\tif (this.lastModified !== \"till\") {\n\t\t\t\t\tthis.till = this.date.clone();\n\t\t\t\t\tthis.lastModified = \"till\"\n\t\t\t\t}\n\t\t\t\telse reset();\n\t\t\t} else if (this.date.isSame(this.till) || this.date.isSame(this.since))\n\t\t\t\treset();\n\t\t\telse {\n\t\t\t\tif (this.lastModified === \"since\") {\n\t\t\t\t\tthis.till = this.date.clone();\n\t\t\t\t\tthis.lastModified = \"till\"\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tthis.since = this.date.clone();\n\t\t\t\t\tthis.lastModified = \"since\"\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tcalendar.markSelected();\n\n\t\t},\n\n\t\tmarkSelected: function () {\n\n\t\t\tthis.dates.find(\".day\").removeClass(\"selected\").removeClass(\"subSelected\").each(function () {\n\n\n\t\t\t\tlet element = $(this),\n\t\t\t\t\tdate = calendar.date.clone().date(parseInt(element.html()));\n\n\t\t\t\tif (!calendar.period) {\n\t\t\t\t\tif (date.format(\"DD.MM.YYYY\") === calendar.date.format(\"DD.MM.YYYY\"))\n\t\t\t\t\t\telement.addClass(\"subSelected\");\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (date.isAfter(calendar.since) && date.isBefore(calendar.till))\n\t\t\t\t\telement.addClass(\"subSelected\");\n\t\t\t\telse if (date.isSame(calendar.since) || date.isSame(calendar.till))\n\t\t\t\t\telement.addClass(\"selected\");\n\n\t\t\t});\n\n\t\t},\n\n\t\t/**\n\t\t * Changes day\n\t\t * @param {*} element Day picker\n\t\t * @returns {undefined}\n\t\t */\n\t\tchangeDay: function (element) {\n\n\t\t\t/* If pick today */\n\t\t\tthis.date.date(parseInt(element.html()));\n\n\t\t\t/* No more for period */\n\t\t\tif (this.period) {\n\t\t\t\tthis.periodChangeDay();\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tcalendar.markSelected();\n\n\t\t\t/* Set time */\n\t\t\tif (this.field.attr(\"name\") === \"since\")\n\t\t\t\tthis.date.hour(0).minute(0);\n\t\t\telse if (this.date.format(\"DD-MM-YYYY\") === moment().format(\"DD-MM-YYYY\"))\n\t\t\t\tthis.date.hour(moment().hour()).minute(moment().minute());\n\t\t\telse\n\t\t\t\tthis.date.hour(23).minute(59);\n\n\t\t\t/* Pick */\n\t\t\tif (!this.useTime)\n\t\t\t\tthis.dayPick(element);\n\t\t\telse\n\t\t\t\tthis.setTime();\n\n\t\t},\n\n\t\t/**\n\t\t * Sets specified year\n\t\t * @param {int} year Year that need to be set\n\t\t */\n\t\tchangeYear: function (year) {\n\n\t\t\t/* Set year */\n\t\t\tthis.date.year(year);\n\n\t\t\t/* Update */\n\t\t\tthis.yearView.html(year);\n\n\t\t\t/* Dates redraw */\n\t\t\tthis.renderDays();\n\n\t\t},\n\n\t\t/**\n\t\t * Sets specified month\n\t\t * @param {int} month Month to be set\n\t\t */\n\t\tchangeMonth: function (month) {\n\n\t\t\t/* Set year */\n\t\t\tthis.date.month(month);\n\n\t\t\t/* Updates */\n\t\t\tthis.monthView.html(this.monthsNames[this.date.month()] + ' ' + this.date.year());\n\n\t\t\t/* Reload year */\n\t\t\tthis.changeYear(this.date.year());\n\n\t\t},\n\n\t\tgetDatePeriod: function (dateString) {\n\n\t\t\t// Split and get since\n\t\t\tlet parts = dateString.split('-'),\n\t\t\t\ttill,\n\t\t\t\tsince = this.getDate(parts[0].trim());\n\n\t\t\t// Get till\n\t\t\tif (parts.length > 1)\n\t\t\t\ttill = this.getDate(parts[1].trim());\n\t\t\telse\n\t\t\t\ttill = this.getDate(parts[0].trim());\n\n\t\t\t// Set inner lets\n\t\t\tthis.since = since;\n\t\t\tthis.till = till;\n\t\t\tthis.date = since.clone();\n\n\t\t},\n\n\t\t/**\n\t\t * Creates today date\n\t\t */\n\t\tgetDate: function (dateString) {\n\n\t\t\t/* Set calendar date */\n\t\t\tlet date = false;\n\n\t\t\t/* If input has datetime format value */\n\t\t\tif (dateString.match(/^\\d{4}-\\d{2}-\\d{2} \\d{1,2}:\\d{1,2}$/))\n\t\t\t\tdate = moment(dateString, \"YYYY-MM-DD HH:mm\");\n\n\t\t\t/* Id input has date format value */\n\t\t\tif (dateString.match(/^\\d{4}-\\d{2}-\\d{2}$/))\n\t\t\t\tdate = moment(dateString, \"YYYY-MM-DD\");\n\n\t\t\t/* Id input has date format value */\n\t\t\tif (dateString.match(/^\\d{2}.\\d{2}.\\d{4}$/))\n\t\t\t\tdate = moment(dateString, \"DD.MM.YYYY\");\n\n\t\t\t/* Id input has date format value */\n\t\t\tif (dateString.match(/^\\d{2}.\\d{2}.\\d{4} \\d{2}:\\d{2}$/))\n\t\t\t\tdate = moment(dateString, \"DD.MM.YYYY HH:mm\");\n\n\t\t\t/*  If still no */\n\t\t\tif (!date) {\n\t\t\t\tdate = moment();\n\n\t\t\t\t/* Set time */\n\t\t\t\tif (this.field.attr(\"name\") === \"since\")\n\t\t\t\t\tdate.hour(0).minute(0);\n\t\t\t}\n\n\t\t\t/* Reset time */\n\t\t\tif (!this.useTime)\n\t\t\t\tdate.hour(0).minute(0);\n\n\t\t\t/* Additional check */\n\t\t\treturn this.date = date;\n\n\t\t},\n\n\t\t/**\n\t\t * Closes windows\n\t\t */\n\t\tclose: function () {\n\n\t\t\t/* Remove calendar */\n\t\t\tif (this.holder)\n\t\t\t\tthis.holder.remove();\n\n\t\t\t/* Unset */\n\t\t\tif (this.field) {\n\t\t\t\tthis.field.off(\"keyup.calendar\");\n\t\t\t\tthis.field = false;\n\t\t\t}\n\t\t}\n\t};\n\n\tlet show = function (field, showTime) {\n\n\t\t/* Remove old calendars */\n\t\tthis.close();\n\n\t\t/* Begins from current date */\n\t\tthis.field = field;\n\t\tthis.period = false;\n\t\tthis.useTime = showTime ? showTime : false;\n\t\tthis.lastPicked = \"none\";\n\n\t\tif (field.is(\"input.datePeriod\")) {\n\t\t\tthis.period = true;\n\t\t\tthis.getDatePeriod(field.val());\n\t\t} else\n\t\t\tthis.getDate(field.val());\n\n\t\t/* Render */\n\t\tthis.holder = templates.render(\"calendar\", this);\n\n\t\t/* Actions */\n\t\tthis.holder\n\n\t\t/* Months changer */\n\t\t\t.action(\"click\", \".month .next\", function (event) {\n\t\t\t\tevent.preventDefault();\n\t\t\t\tcalendar.changeMonth(calendar.date.month() + 1);\n\t\t\t})\n\t\t\t.action(\"click\", \".month .prev\", function (event) {\n\t\t\t\tevent.preventDefault();\n\t\t\t\tcalendar.changeMonth(calendar.date.month() - 1);\n\t\t\t})\n\n\t\t\t/* Years */\n\t\t\t.action(\"click\", \".year .next\", function (event) {\n\t\t\t\tevent.preventDefault();\n\t\t\t\tcalendar.changeYear(calendar.date.year() + 1);\n\t\t\t})\n\t\t\t.action(\"click\", \".year .prev\", function (event) {\n\t\t\t\tevent.preventDefault();\n\t\t\t\tcalendar.changeYear(calendar.date.year() - 1);\n\t\t\t})\n\t\t\t.action(\"click\", \".setNow\", function (event) {\n\t\t\t\tevent.preventDefault();\n\t\t\t\tcalendar.date = moment();\n\t\t\t\tcalendar.renderDays();\n\t\t\t\tcalendar.setTime();\n\t\t\t})\n\t\t\t.action(\"click\", \".setToday\", function (event) {\n\t\t\t\tevent.preventDefault();\n\t\t\t\tcalendar.date = moment();\n\t\t\t\tcalendar.date.hour(0);\n\t\t\t\tcalendar.date.minute(0);\n\t\t\t\tcalendar.renderDays();\n\t\t\t\tcalendar.setTime();\n\t\t\t})\n\t\t\t.action(\"click\", \".setWeek\", function (event) {\n\t\t\t\tevent.preventDefault();\n\t\t\t\tcalendar.date = moment();\n\t\t\t\tcalendar.date.subtract(7, \"d\");\n\t\t\t\tcalendar.renderDays();\n\t\t\t\tcalendar.setTime();\n\t\t\t})\n\n\t\t\t/* Day */\n\t\t\t.action(\"click\", \".dates .day\", function (event) {\n\t\t\t\tevent.preventDefault();\n\t\t\t\tlet self = $(this);\n\n\t\t\t\tif (self.is(\".selected\") && !calendar.period)\n\t\t\t\t\tcalendar.dayPick($(this));\n\t\t\t\telse {\n\t\t\t\t\tcalendar.changeDay($(this));\n\t\t\t\t\tcalendar.dayPick(false, true);\n\t\t\t\t}\n\t\t\t})\n\n\t\t\t/* Apply button */\n\t\t\t.action(\"click\", \".apply\", function (event) {\n\t\t\t\tevent.preventDefault();\n\t\t\t\tcalendar.dayPick();\n\t\t\t})\n\n\t\t\t/* Time */\n\t\t\t.action(\"click\", \".time a\", function (event) {\n\t\t\t\tevent.preventDefault();\n\t\t\t\tcalendar.date.hour(moment().hour());\n\t\t\t\tcalendar.date.minute(moment().minute());\n\t\t\t\tcalendar.setTime();\n\t\t\t})\n\t\t\t.action(\"keyup\", \".time .hour\", function () {\n\t\t\t\tcalendar.date.hour(this.value);\n\t\t\t})\n\t\t\t.action(\"keyup\", \".time .minute\", function () {\n\t\t\t\tcalendar.date.minute(this.value);\n\t\t\t});\n\n\n\t\t/* Close and containers */\n\t\tthis.dates = this.holder.find(\".dates\");\n\t\tthis.yearView = this.holder.find(\".year .value\");\n\t\tthis.monthView = this.holder.find(\".month .value\");\n\t\tthis.pickedDateView = this.holder.find(\".pickedDate\");\n\n\t\t/* Refresh days */\n\t\tthis.renderDays();\n\n\t\t/* Reposition */\n\t\tthis.position(field);\n\t\tthis.setDayPick();\n\n\t\t/* Auto change */\n\t\tthis.field.on(\"keyup.calendar\", function () {\n\t\t\tshow(field, showTime);\n\t\t});\n\n\t\tlet dateOriginal;\n\t\tthis.dates.on(\"touchstart\", function (event) {\n\n\t\t\tlet element = $(event.target);\n\t\t\tif (!element.is(\".day\")) return;\n\t\t\tdateOriginal = calendar.date.clone().date(parseInt(element.html()));\n\n\t\t}).on(\"touchmove\", function (event) {\n\n\t\t\t/* No original event */\n\t\t\tevent.preventDefault();\n\n\t\t\tlet element = document.elementFromPoint((event.clientX || event.originalEvent.touches[0].clientX), (event.clientY || event.originalEvent.touches[0].clientY));\n\t\t\telement = $(element);\n\n\t\t\tif (!element.is(\".day\")) return;\n\n\t\t\tlet date = dateOriginal.clone().date(parseInt(element.html()));\n\n\t\t\tif (date.isBefore(dateOriginal)) {\n\t\t\t\tcalendar.since = date.clone();\n\t\t\t\tcalendar.till = dateOriginal.clone();\n\t\t\t} else {\n\t\t\t\tcalendar.since = dateOriginal.clone();\n\t\t\t\tcalendar.till = date.clone();\n\t\t\t}\n\t\t\tcalendar.lastModified = \"none\";\n\t\t\tcalendar.markSelected();\n\t\t\t// $(this).trigger(\"click\");\n\n\t\t});\n\n\t}.bind(calendar);\n\n\t/* Return */\n\tthis.service = show;\n\n});\n\nsky.onReady(({calendar}) => {\n\n\t/* Calendar show */\n\t$(document).action(\"click.calendar\", function (event) {\n\n\t\t/* Get element */\n\t\tlet element = $(event.target || event.srcElement);\n\n\t\t/* Remove calendar */\n\t\tif (!element.is(\".calendar\") && !element.parents(\".calendar\").length)\n\t\t\t$(\".calendar\").remove();\n\n\t\t/* Calendar show */\n\t\tif (element.is(\"input.date\"))\n\t\t\tcalendar(element);\n\n\t\t/* Calendar show */\n\t\tif (element.is(\"input.datePeriod\"))\n\t\t\tcalendar(element, false, true);\n\n\t\t/* Calendar show */\n\t\tif (element.is(\"input.datetime\"))\n\t\t\tcalendar(element, true);\n\n\t\t/* Calendar show */\n\t\tif (element.is(\"input.datehour\"))\n\t\t\tcalendar(element, true);\n\n\t}).action(\"keydown.calendar\", function (event) {\n\t\tif (event.keyCode === 13) {\n\t\t\tlet calendars = $(\".calendar\");\n\t\t\tif (calendars.length) {\n\t\t\t\tcalendars.find(\".day.selected\").trigger(\"click\");\n\t\t\t\tevent.preventDefault();\n\t\t\t}\n\t\t}\n\t});\n});","/** Class to work with drop zone for File api */\nsky.service(\"ajaxFilesDropZone\", [\"supported\", \"callbacks\"], function({ supported, callbacks }) {\n\tthis.service = class {\n\t\tconstructor({ zone, data, url, options }) {\n\n\t\t\t/* Save options */\n\t\t\tthis.options   = options;\n\t\t\tthis.zone      = zone;\n\t\t\tthis.callbacks = callbacks();\n\t\t\tthis.data      = data;\n\t\t\tthis.url       = url;\n\t\t\tthis.files     = [];\n\n\t\t\t/* If no XHR supported, no file drop needed */\n\t\t\tif(!supported.XHRUpload) {\n\t\t\t\tthis.callbacks.fire(\"nonSupported\");\n\t\t\t\treturn this;\n\t\t\t}\n\n\t\t\t/* Bind events */\n\t\t\tthis.attachEvents();\n\n\t\t}\n\n\t\tattachEvents() {\n\n\t\t\t/* While over event */\n\t\t\tthis.zone.on({\n\n\t\t\t\tdragenter: (event) => { this.callbacks.fire(\"dragenter\", this, [event]); },\n\t\t\t\tdragleave: (event) => { this.callbacks.fire(\"dragleave\", this, [event]); },\n\t\t\t\tdragend  : (event) => { this.callbacks.fire(\"dragend\", this, [event]); \t },\n\t\t\t\tdrop     : (event) => { this.callbacks.fire(\"drop\", this, [event]);\t\t },\n\t\t\t\tdragover : (event) => {\n\n\t\t\t\t\t/* Get event */\n\t\t\t\t\tevent = event.originalEvent;\n\n\t\t\t\t\t/* Check if drag is valid */\n\t\t\t\t\tif(!this.isValidFileDrag(event))\n\t\t\t\t\t\treturn;\n\n\t\t\t\t\t/* Get effect */\n\t\t\t\t\tlet effect = event.dataTransfer.effectAllowed;\n\n\t\t\t\t\t/* Set proper */\n\t\t\t\t\tif(effect === 'move' || effect === 'linkMove') {\n\t\t\t\t\t\tevent.dataTransfer.dropEffect = 'move'; // for FF (only move allowed)\n\t\t\t\t\t} else {\n\t\t\t\t\t\tevent.dataTransfer.dropEffect = 'copy'; // for Chrome\n\t\t\t\t\t}\n\n\t\t\t\t\t/* Prevent */\n\t\t\t\t\tevent.preventDefault();\n\n\t\t\t\t}\n\t\t\t});\n\n\t\t\t/* Stop file opening when drop on browser window */\n\t\t\t$(document).bind({\n\t\t\t\tdragover : function(e) {\n\t\t\t\t\te = e.originalEvent;\n\t\t\t\t\tif(e.dataTransfer) {\n\t\t\t\t\t\te.dataTransfer.dropEffect = 'none';\n\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tdragenter: function(e) {\n\t\t\t\t\tif(typeof self.options.onStart !== \"undefined\")\n\t\t\t\t\t\tself.options.onStart.apply(self, [e]);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tstatic isValidFileDrag(event) {\n\n\t\t\tlet dt = event.dataTransfer,\n\t\t\t// do not check dt.types.contains in webkit, because it crashes safari 4\n\t\t\t\tisWebkit = navigator.userAgent.indexOf(\"AppleWebKit\") > -1;\n\n\t\t\t// dt.effectAllowed is none in Safari 5\n\t\t\t// dt.types.contains check is for firefox\n\t\t\treturn dt && dt.effectAllowed !== 'none' &&\n\t\t\t\t(dt.files || (!isWebkit && dt.types.contains && dt.types.contains('Files')));\n\n\t\t}\n\n\t};\n\n});","sky.service(\"ajaxFilesIFrame\", function() {\n\n\tlet AjaxFilesIFrame = function(options) {\n\n\t\t/* Save options */\n\t\tthis.options \t= options;\n\t\tthis.files    \t= options.files;\n\t\tthis.input   \t= options.input;\n\t\tthis.url  \t \t= options.url;\n\t\tthis.data \t \t= options.data;\n\t\tthis.callbacks \t= options.callbacks;\n\n\t};\n\n\tAjaxFilesIFrame.prototype = {\n\n\t\tgetName: function(name){\n\n\t\t\t// get input value and remove path to normalize\n\t\t\treturn name.replace(/.*(\\/|\\\\)/, \"\");\n\n\t\t},\n\n\t\tcancel: function(id){\n\n\t\t\tthis.options.onAbort(id, this.getName(this.input.value));\n\n\t\t\tthis.IFrame.setAttribute('src', 'javascript:false;').remove();\n\n\t\t},\n\n\t\t/**\n\t\t * Upload file function\n\t\t */\n\t\tsend: function() {\n\n\t\t\t/* letiables */\n\t\t\tlet self \t = this;\n\t\t\tlet input \t = this.input;\n\t\t\tlet fileName = this.getName(input.value);\n\n\t\t\t/* Create new input */\n\t\t\t$(input).clone().val(\"\").insertBefore(input);\n\n\t\t\t/* Create elements */\n\t\t\tthis.IFrame = this.createIframe();\n\t\t\tthis.form = this.createForm(this.IFrame, this.options.data).append(input);\n\n\t\t\tthis.attachLoadEvent(this.IFrame, function() {\n\n\t\t\t\tlet response = self.getIframeContentJSON(self.IFrame);\n\n\t\t\t\tif(response) self.options.onSuccess(response);\n\n\t\t\t\t// timeout added to fix busy state in FF3.6\n\t\t\t\tsetTimeout(function(){ self.IFrame.remove(); }, 1);\n\n\t\t\t});\n\n\t\t\tthis.form.trigger(\"submit\");\n\n\t\t},\n\n\t\t/**\n\t\t * Attach load event to IFrame\n\t\t */\n\t\tattachLoadEvent: function(iframe, callback){\n\n\t\t\tiframe.load(function(){\n\n\t\t\t\tif (!this.parentNode) return;\n\n\t\t\t\t// fixing Opera 10.53\n\t\t\t\tif (this.contentDocument &&\n\t\t\t\t\tthis.contentDocument.body &&\n\t\t\t\t\tthis.contentDocument.body.innerHTML === \"false\") return;\n\n\t\t\t\tcallback();\n\n\t\t\t});\n\n\t\t},\n\n\t\t/**\n\t\t * Returns json object received by IFrame from server.\n\t\t */\n\t\tgetIframeContentJSON: function(iframe){\n\n\t\t\t/* IFrame.contentWindow.document - for IE<7 */\n\t\t\tlet doc = iframe.get(0).contentDocument ? iframe.get(0).contentDocument: iframe.get(0).contentWindow.document;\n\n\t\t\tlet response = doc.body.innerHTML\n\n\t\t\t/* Check for empty response */\n\t\t\tif(response === \"\") {\n\t\t\t\tif(self.callbacks) self.callbacks.onError(\"  \"); // No data\n\t\t\t\treturn false;\n\t\t\t}\n\n\n\t\t\t/* Try to get json data */\n\t\t\ttry {\n\t\t\t\tresponse = jQuery.parseJSON(response);\n\t\t\t} catch(e) {\n\t\t\t\tif(self.callbacks) {\n\t\t\t\t\tself.callbacks.onError(\"  \"); // No data\n\t\t\t\t\tconsole.log(response);\n\t\t\t\t}\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\t/* If response returned with error */\n\t\t\tif(response.error) {\n\t\t\t\tif(self.callbacks) self.callbacks.onError(response.text); // Execute user error handler\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\treturn response;\n\t\t},\n\n\t\t/**\n\t\t * Creates IFrame with unique name\n\t\t */\n\t\tcreateIframe: function() {\n\n\t\t\treturn $('<IFrame/>', { src: \"javascript:false;\", name: \"uploadIFrame\" + Math.floor(Math.random()*1000000) }).css(\"display\", \"none\").appendTo('body');\n\n\t\t},\n\n\t\t/**\n\t\t * Creates form, that will be submitted to IFrame\n\t\t */\n\t\tcreateForm: function(iframe, params) {\n\n\t\t\tlet queryString = this.url + \"?\" + jQuery.param(params);\n\n\t\t\treturn $('<form/>', {\n\t\t\t\tmethod: \"post\", enctype: \"multipart/form-data\", action: queryString, target: iframe.attr(\"name\")\n\t\t\t}).css(\"display\", \"none\").appendTo('body');\n\n\t\t}\n\n\t};\n\n});","/**\n * Module to work with ajax file upload\n */\nsky.service(\"ajaxFiles\", [\"supported\", \"callbacks\", \"ajaxFilesXHR\", \"ajaxFilesIFrame\"], function({ callbacks, supported, ajaxFilesXHR, ajaxFilesIFrame }) {\n\n\t/**\n\t * Class to work with dynamic file upload\n\t * @param {html|string} input Input to be used to upload\n\t * @param {string} url Url to upload\n\t * @param {object} data Data to be send with request\n\t */\n\tlet AjaxFiles = this.service = function(input, url, data) {\n\n\t\t/* Self construct */\n\t\tif(!(this instanceof AjaxFiles))\n\t\t\treturn new AjaxFiles(input, url, data);\n\n\t\t/* Save items */\n\t\tthis.inputs \t= $(input);\n\t\tthis.url   \t\t= url;\n\t\tthis.data  \t\t= data;\n\t\tthis.callbacks \t= callbacks();\n\t\tthis.files\t\t= [];\n\n\t\t/**\n\t\t * Function to handle file input change\n\t\t */\n\t\tthis.saveFiles = function(input) {\n\n\t\t\t/* Get files list */\n\t\t\tif(supported.XHRUpload) {\n\n\t\t\t\t/* Get files from event */\n\t\t\t\tlet files = input.get(0).files;\n\n\t\t\t\t/* Save them to this */\n\t\t\t\tfor(let file of files)\n\t\t\t\t\tthis.files.push({ file: file, input: input, inputName: input.attr(\"name\") });\n\n\t\t\t} else this.files.push(input.get(0));\n\n\t\t};\n\n\t\t/**\n\t\t * Sends ajax files\n\t\t * @param {bool} parallel If try files would be send in parallel\n\t\t * @returns {*}\n\t\t */\n\t\tthis.send = function(parallel) {\n\n\t\t\t/* Clear */\n\t\t\tthis.files = [];\n\n\t\t\t/* Get files list */\n\t\t\tthis.inputs.each((_, input) => { this.saveFiles($(input)); });\n\n\t\t\t/* If no files */\n\t\t\tif(!this.files.length)\n\t\t\t\treturn false;\n\n\t\t\t/* Create supported handler */\n\t\t\tlet handler;\n\t\t\tif(supported.XHRUpload)\n\t\t\t\thandler = new ajaxFilesXHR(this);\n\t\t\telse\n\t\t\t\thandler = new ajaxFilesIFrame(this);\n\n\t\t\t/* Send files */\n\t\t\tif(parallel)\n\t\t\t\tthis.sendParallel(handler);\n\t\t\telse\n\t\t\t\tthis.sendConsequentially(handler);\n\n\t\t\t/* return send handler */\n\t\t\treturn handler;\n\n\t\t};\n\n\t\t/**\n\t\t * Sends files consequentially\n\t\t * @param handler\n\t\t */\n\t\tthis.sendConsequentially = function(handler) {\n\n\t\t\t/* First id */\n\t\t\tlet id = 0;\n\n\t\t\t/* Set sending next after this one */\n\t\t\tthis.callbacks.on(\"always\", () => {\n\t\t\t\tid++;\n\t\t\t\tif(this.files[id])\n\t\t\t\t\thandler.send(this.files[id]);\n\t\t\t});\n\n\t\t\t/* Send first */\n\t\t\thandler.send(self.files[id]);\n\n\t\t};\n\n\t\t/**\n\t\t * Sends files parallel\n\t\t * @param handler\n\t\t */\n\t\tthis.sendParallel = function(handler) {\n\n\t\t\t/* Send files through them */\n\t\t\tfor(let file of this.files)\n\t\t\t\thandler.send(file);\n\n\t\t};\n\n\t\t/* Self return */\n\t\treturn this;\n\n\t};\n\n\t/**\n\t * Performs default file send\n\t * @param {string} url\n\t * @param element\n\t * @param data\n\t */\n\tAjaxFiles.defaultSend = function(url, element, data) {\n\n\t\t// Get input\n\t\tlet input = element.is(\"input[type=file]\") ? element : element.closest(\"label, .label\").find(\"input[type=file]\"),\n\t\t\texceptions = sky.service(\"exceptions\"),\n\t\t\ttemplates = sky.service(\"templates\"),\n\t\t\tnotifications = sky.service(\"notifications\"),\n\t\t\twindows = sky.service.windows(\"windows\");\n\n\t\t// Check\n\t\tif(!input.length)\n\t\t\tthrow new exceptions.system.Error(\"No proper input provided for file send\");\n\n\t\t// Init\n\t\tlet filesAjax = AjaxFiles(input, url, data),\n\t\t\tmodal = windows.getLast(),\n\t\t\tcurrentFile;\n\n\t\t/*  Bind events */\n\t\tfilesAjax.callbacks\n\t\t\t.on(\"begin\", function (file) {\n\t\t\t\tif(modal) {\n\t\t\t\t\tmodal.holder.find(\".preview\").remove();\n\t\t\t\t\tmodal.lock();\n\t\t\t\t}\n\t\t\t\tcurrentFile = templates.render(\"files-single-upload\", file).insertAfter(element.parent());\n\t\t\t})\n\t\t\t.on(\"always\", function () {\n\t\t\t\tcurrentFile.remove();\n\t\t\t\tif(modal)\n\t\t\t\t\tmodal.unlock();\n\t\t\t})\n\t\t\t.on(\"notSuccess\", function (error) {\n\t\t\t\tmodal.clearExceptTemplate();\n\t\t\t\tnotifications.message({text: error}).appendToModal(modal);\n\t\t\t})\n\t\t\t.on(\"progress\", function (totalPercent, percent) {\n\t\t\t\tcurrentFile.find(\".total\").html(percent + \"%\");\n\t\t\t\tcurrentFile.find(\".progressBar div\").css(\"width\", percent + \"%\");\n\n\t\t\t\t// If loaded\n\t\t\t\tif (percent === 100)\n\t\t\t\t\tcurrentFile.find(\".total\").html(\"100%, \");\n\n\n\t\t\t})\n\t\t\t.on(\"start\", function () {\n\n\t\t\t});\n\n\t\t/* Send */\n\t\tfilesAjax.send();\n\t\treturn filesAjax;\n\n\t};\n\n});","/** Sends file data via HttpRequest */\nsky.service(\"ajaxFilesXHR\", [\"supported\", \"ajax\", \"stackList\"], function({supported, ajax, stackList}) {\n\tthis.service = class {\n\t\tconstructor(options) {\n\n\t\t\t/* Save options */\n\t\t\tthis.options \t\t= options;\n\t\t\tthis.files \t\t\t= options.files;\n\t\t\tthis.input \t\t\t= options.input;\n\t\t\tthis.url \t\t\t= options.url;\n\t\t\tthis.data \t\t\t= options.data;\n\t\t\tthis.callbacks \t\t= options.callbacks;\n\t\t\tthis.toProceed \t\t= options.files.length;\n\t\t\tthis.inProgress \t= 0;\n\t\t\tthis.total \t\t\t= options.files.length;\n\t\t\tthis.totalLoaded \t= 0;\n\t\t\tthis.totalSize \t\t= 0;\n\t\t\tthis.totalPercent \t= 0;\n\t\t\tthis.current \t\t= 0;\n\t\t\tthis.fileRequests \t= stackList();\n\n\t\t\t/* Go through */\n\t\t\tfor(file of options.files)\n\t\t\t\tthis.totalSize += file.size;\n\n\t\t}\n\n\t\t/**\n\t\t * Get file name\n\t\t * @param {*} file File\n\t\t * @returns {string}\n\t\t */\n\t\tstatic getName(file) {\n\t\t\treturn file.name.replace(/.*(\\/|\\\\)/, \"\");\n\t\t}\n\n\t\t/**\n\t\t * Uploads file\n\t\t * @param {*} file File name in files stack\n\t\t */\n\t\tsend(file) {\n\n\t\t\t/* This obj will store data associated with XHR */\n\t\t\t$.extend(file, {\n\t\t\t\tid     : Math.random(),\n\t\t\t\tname   : this.getName(file.file),\n\t\t\t\tsize   : file.file.size,\n\t\t\t\tajax   : false,\n\t\t\t\tpercent: false,\n\t\t\t\tloaded : 0\n\t\t\t});\n\n\t\t\t/* Prepare params */\n\t\t\tlet self        = this,\n\t\t\t\tparams      = this.data || {},\n\t\t\t\tqueryString = this.url + \"?ajaxFile=\" + file.name + \"&\" + jQuery.param(params);\n\n\t\t\t/**\n\t\t\t * Params extend\n\t\t\t * @param {object} args Object to be extended\n\t\t\t * @returns {*}\n\t\t\t */\n\t\t\tthis.extend = function(args) {\n\t\t\t\treturn jQuery.extend(args, {\n\t\t\t\t\ttotalLoaded : self.totalLoaded,\n\t\t\t\t\ttotalSize   : self.totalSize,\n\t\t\t\t\ttotalPercent: self.totalPercent,\n\t\t\t\t\tfile        : file,\n\t\t\t\t\tloaded      : file.loaded,\n\t\t\t\t\tsize        : file.size,\n\t\t\t\t\tpercent     : file.percent,\n\t\t\t\t\ttoProceed   : self.toProceed,\n\t\t\t\t\tcurrent     : self.current,\n\t\t\t\t\ttotal       : self.total\n\t\t\t\t});\n\t\t\t};\n\n\t\t\t/* Send */\n\t\t\tif(supported.formData) {\n\n\t\t\t\t/* Create form data sender */\n\t\t\t\tlet form = new FormData();\n\t\t\t\tform.append(file.inputName, file.file);\n\n\t\t\t\t/* Send start */\n\t\t\t\tfile.ajax = ajax(queryString, form, { ajaxExtend: {\n\t\t\t\t\t\tprocessData: false,\n\t\t\t\t\t\tcontentType: false,\n\t\t\t\t\t\ttype       : \"POST\",\n\t\t\t\t\t\txhr        : (() => {\n\t\t\t\t\t\t\ttry {\n\n\t\t\t\t\t\t\t\t/* Create XHR */\n\t\t\t\t\t\t\t\tlet xhr = new XMLHttpRequest();\n\n\t\t\t\t\t\t\t\t/* Set special upload api handlers */\n\t\t\t\t\t\t\t\txhr.upload[\"onloadstart\"] = function() {\n\t\t\t\t\t\t\t\t\tthis.inProgress++;\n\t\t\t\t\t\t\t\t\tthis.callbacks.fire(\"begin\", this.extend({}));\n\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t\txhr.upload[\"onprogress\"] = function(event) {\n\t\t\t\t\t\t\t\t\tthis.totalLoaded += event.loaded - file.loaded;\n\t\t\t\t\t\t\t\t\tthis.totalPercent = (this.totalLoaded / this.totalSize * 100).toFixed(0);\n\t\t\t\t\t\t\t\t\tthis.onProgress(event, file);\n\t\t\t\t\t\t\t\t};\n\n\t\t\t\t\t\t\t\t/* Return create XHR */\n\t\t\t\t\t\t\t\treturn xhr;\n\n\t\t\t\t\t\t\t} catch(e) {\n\t\t\t\t\t\t\t\treturn undefined;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}).safe()\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t} else {\n\n\t\t\t\t/* Send start */\n\t\t\t\tfile.ajax = ajax(queryString, file.file, {\n\t\t\t\t\tprocessData: false,\n\t\t\t\t\tcontentType: false,\n\t\t\t\t\ttype       : \"POST\",\n\t\t\t\t\tbeforeSend : sky.func(function(jqXHR) {\n\t\t\t\t\t\tjqXHR.setRequestHeader(\"X-Requested-With\", \"XMLHttpRequest\");\n\t\t\t\t\t\tjqXHR.setRequestHeader(\"X-File-Name\", encodeURI(file.name));\n\t\t\t\t\t\tjqXHR.setRequestHeader(\"Content-Type\", \"multipart/form-data\");\n\t\t\t\t\t\tjqXHR.setRequestHeader(\"Content-Disposition\", 'attachment; filename=\"' + encodeURI(file.name) + '\"');\n\t\t\t\t\t\tjqXHR.setRequestHeader(\"Accept\", \"text/html,application/xhtml+xml,application/xml;q=0.9\");\n\t\t\t\t\t})\n\t\t\t\t});\n\n\t\t\t}\n\n\t\t\t/* Set ajax callbacks */\n\t\t\tfile.ajax.on({\n\t\t\t\tsuccess:\t(all) => { this.callbacks.fire(\"success\", this.extend(all)); },\n\t\t\t\terror: \t\t(all) => { this.callbacks.fire(\"error\", this.extend(all)); },\n\t\t\t\tnotSuccess: (all) => { this.callbacks.fire(\"notSuccess\", this.extend(all)); },\n\t\t\t\talways: \t(all) => {\n\n\t\t\t\t\t/* Counters */\n\t\t\t\t\tthis.inProgress--;\n\t\t\t\t\tthis.toProceed--;\n\n\t\t\t\t\t/* Call always method */\n\t\t\t\t\tthis.callbacks.fire(\"always\", this.extend(all));\n\n\t\t\t\t\t/* Delete connection */\n\t\t\t\t\tthis.fileRequests.delete(file);\n\n\t\t\t\t}\n\t\t\t});\n\n\t\t\t/* Save */\n\t\t\tthis.fileRequests.add(file);\n\n\t\t}\n\n\t\t/**\n\t\t * Fores on progress change\n\t\t * @param event\n\t\t * @param fileRequestData\n\t\t */\n\t\tonProgress(event, fileRequestData) {\n\n\t\t\t/* Count percentage */\n\t\t\tlet percent = (event.loaded / event[\"total\"] * 100).toFixed(0);\n\t\t\tfileRequestData.loaded = event.loaded;\n\n\t\t\t/* If percent changed */\n\t\t\tif(percent !== fileRequestData.percent && event[\"lengthComputable\"]) {\n\t\t\t\tfileRequestData.percent = percent;\n\t\t\t\tthis.callbacks.fire(\"progress\", this.extend({}));\n\t\t\t}\n\n\t\t}\n\n\t\t/**\n\t\t * Aborts current download\n\t\t */\n\t\tabort() {\n\n\t\t\t/* Stop each request */\n\t\t\tthis.fileRequests.each(request => { request.ajax.stop() });\n\n\t\t\t/* Call always method */\n\t\t\tthis.callbacks.fire(\"abort\", this.extend({}));\n\n\t\t}\n\n\t};\n\n});","sky.service(\"model\", [ \"modelsStorage\", \"callbacks\" ], function({ modelsStorage, callbacks }) {\n\n\t/**\n\t * List of model definitions\n\t */\n\tlet modelsDefinition = {};\n\n\tclass Model {\n\t\tconstructor(type, data) {\n\n\t\t\t/* Init as base */\n\t\t\tthis.definition = BaseDefinition;\n\n\t\t\t/* Get special if defined */\n\t\t\tif(modelsDefinition[type])\n\t\t\t\tthis.definition = modelsDefinition[type];\n\n\t\t\t/* Save id */\n\t\t\tthis.id = data[this.definition.id] || null;\n\t\t\tthis.type = type;\n\t\t\tthis.data = {};\n\t\t\tthis.callbacks = callbacks();\n\t\t\tthis.definition.creation.bind(this)($.extend({}, data, true));\n\n\t\t}\n\t\textend(data) {\n\t\t\tthis.definition.extension.bind(this)($.extend({}, data, true));\n\t\t\treturn this.changed();\n\t\t}\n\t\tchanged() {\n\t\t\tthis.callbacks.fire(\"change\", {model: this});\n\t\t\treturn this;\n\t\t}\n\t\tremoveFromStorage() {\n\t\t\tmodelsStorage.remove(this);\n\t\t}\n\t\taddListener(func) {\n\t\t\tthis.callbacks.on(\"change\", func);\n\t\t}\n\t\tremoveListener(func) {\n\t\t\tthis.callbacks.off(\"change\", func);\n\t\t}\n\t}\n\n\t/**\n\t * Base model definition witch would be parented\n\t */\n\tlet BaseDefinition = {\n\t\tid: \"id\",\n\t\tcreation: function(data) {\n\t\t\tthis.data = data;\n\t\t},\n\t\textension: function(data) {\n\t\t\t$.extend(true, this.data, data);\n\t\t}\n\t};\n\n\tthis.service = {\n\t\t/**\n\t\t * Adds new models definition\n\t\t * @param name\n\t\t * @param definition\n\t\t */\n\t\taddDefinition: function(name, definition) {\n\t\t\tmodelsDefinition[name] = $.extend({}, BaseDefinition, definition);\n\t\t},\n\n\t\tfromData: function(type, data) {\n\n\t\t\tlet model = new this.Model(type, data);\n\t\t\tlet cached = modelsStorage.add(model);\n\n\t\t\tif(cached)\n\t\t\t\treturn cached.extend(data);\n\n\t\t\treturn model;\n\n\t\t}\n\t};\n\n});","sky.service(\"modelsManager\", [\"callbacks\", \"model\"], function({callbacks, model}) {\n\tclass Manager {\n\t\tconstructor(type, arr) {\n\n\t\t\tthis.items = [];\n\t\t\tthis.type = type;\n\t\t\tthis.callbacks = callbacks();\n\n\t\t\t$.each(arr, (_, model) => {\n\t\t\t\tthis.items.push(model)\n\t\t\t});\n\t\t}\n\t\treloadFromArray(arr) {\n\t\t\tthis.items = [];\n\t\t\t$.each(arr, (_, data) => {\n\t\t\t\tthis.items.push(model.fromData(this.type, data))\n\t\t\t});\n\t\t}\n\t\tcount() {\n\t\t\treturn this.items.length;\n\t\t}\n\t\taddListener(func) {\n\t\t\tthis.callbacks.on(\"change\", func);\n\t\t}\n\t\tremoveListener(func) {\n\t\t\tthis.callbacks.off(\"change\", func);\n\t\t}\n\t}\n\n\tthis.service = {\n\t\tfromArray: function(type, arr) {\n\t\t\tlet items = [];\n\t\t\t$.each(arr, (_, data) => {\n\t\t\t\titems.push(sky.model.fromData(type, data));\n\t\t\t});\n\t\t\treturn new Manager(type, items);\n\t\t}\n\t};\n\n});","sky.service(\"modelsStorage\", function() {\n\n    let cache = {};\n\n    this.service = {\n\t\tadd: function(model) {\n\n\t\t\t// Search in cache\n\t\t\tlet cached = this.search(model.type, model.id);\n\n\t\t\t// If found extend\n\t\t\tif(cached)\n\t\t\t\treturn cached;\n\n            // Create type storage if none\n            if(!this.cache[model.type])\n                this.cache[model.type] = {};\n\n            // Save model\n            this.cache[model.type][model.id] = model;\n\n\t\t},\n\n\t\tsearch: function(type, id) {\n\n\t\t\t// Cache search\n\t\t\tif(cache[type] && cache[type][id])\n\t\t\t\treturn cache[type][id];\n\n\t\t\t// On miss\n\t\t\treturn false;\n\t\t},\n\n\t\tremove: function(model) {\n\t\t\tdelete cache[model.type][model.id];\n\t\t}\n\t}\n});","/**\n * For work with different type of notifications\n */\nsky.service(\"notifications\", [ \"stackList\", \"callbacks\", \"visibleCalculator\", \"templates\", \"windows\", \"tips\" ], function({ stackList, callbacks, visibleCalculator, templates, windows, tips }) {\n\n\tlet notification = function(options) {\n\t\t/* Self creation */\n\t\tif(!(this instanceof notification))\n\t\t\treturn new notification(options);\n\n\t\tthis.render = templates.render(\"forms-notification\", options);\n\t};\n\tlet message = function(options) {\n\n\t\t/* Self creation */\n\t\tif(!(this instanceof message))\n\t\t\treturn new message(options);\n\n\t\tthis.render = templates.render(\"forms-message\", options);\n\t};\n\n\tmessage.prototype = {\n\t\tmodal: function() {\n\t\t\treturn windows.Modal(this.render);\n\t\t},\n\n\t\t/**\n\t\t * Append to holder of modal window\n\t\t * @param {object} modal\n\t\t */\n\t\tappendToModal: function(modal) {\n\t\t\tmodal.holder.append(this.render);\n\t\t},\n\n\t\ttip: function(object, align) {\n\t\t\ttips.Tip(object, { create: this.render, close: 5 }).show(align || \"top\",);\n\t\t}\n\t};\n\n\tlet loadings = stackList();\n\n\t/**\n\t * Loading\n\t */\n\tlet loading = function(ajax, global = true) {\n\n\t\t/* Self creation */\n        if(!(this instanceof loading))\n            return new loading(ajax, global);\n\n\t\t/* Back link */\n\t\tthis.global = global;\n\n\t\t/* Render */\n\t\tthis.render = $('<div><div></div></div>').addClass(\"ajaxLoading\");\n\n\t\t/* Global insert */\n\t\tif(this.global)\n\t\t\tthis.render.addClass(\"fixed\").appendTo(\"body\");\n\n\t\t/* If stop possible */\n\t\tif(ajax) {\n\t\t\t$(\"<span/>\").appendTo(this.render.addClass(\"cancelable\")).click(function() { ajax.stop(); });\n\t\t\tajax.on(\"always\", () => { this.hide(); });\n\t\t}\n\n\t\t/* Callbacks */\n\t\tthis.callbacks = callbacks();\n\n\t\t/* List save */\n\t\tloadings.add(this);\n\n\t};\n\n\t/**\n\t * Prototype\n\t * @type {{render: null, hide: hide}}\n\t */\n\tloading.prototype = {\n\n\t\t/**\n\t\t * Loads loading in modal window\n\t\t * @param {object} modal Window\n\t\t */\n\t\tinModalWindow: function(modal) {\n\n\t\t\t/* Hide */\n\t\t\tlet content = modal.holder.children().hide();\n\n\t\t\t/* Insert */\n\t\t\tthis.render.appendTo(modal.holder);\n\n\t\t\t/* Restore on hide */\n\t\t\tthis.callbacks.on(\"hide\", () => content.show());\n\n\t\t},\n\n\t\t/**\n\t\t *\n\t\t * @param contentHolder\n\t\t */\n\t\treloadContent: function(contentHolder) {\n\n\t\t\t/* If no holder */\n\t\t\tif(!this.holder.length)\n\t\t\t\treturn;\n\n\t\t\t/* Safe */\n\t\t\tthis.holder = contentHolder = $(contentHolder).addClass(\"withLoading\");\n\n\t\t\t/* Get children */\n\t\t\tlet content = contentHolder.children();\n\n\t\t\t/* Different content disable */\n\t\t\tif(this.global) {\n\n\t\t\t\tcontent.disable();\n\n\t\t\t\t/* Make sizes calculator */\n\t\t\t\tthis.calc = visibleCalculator(contentHolder, this.render.outerHeight(), \"body\");\n\n\t\t\t\t/* Set position func */\n\t\t\t\tthis.setPosition = function() {\n\t\t\t\t\tlet position = this.calc.calculate();\n\t\t\t\t\tthis.render.css({\n\t\t\t\t\t\tleft: position.left + (position.width) / 2,\n\t\t\t\t\t\ttop: position.top + (position.height) / 2\n\t\t\t\t\t})\n\t\t\t\t};\n\t\t\t\tthis.setPosition();\n\n\t\t\t\t/* Re enable */\n\t\t\t\tthis.callbacks.on(\"hide\", () => {\n\t\t\t\t\tcontent.enable();\n\t\t\t\t\t$(window).off(\"scroll.notification\");\n\t\t\t\t});\n\n\t\t\t\t$(window).on(\"scroll.notification\", () => { this.setPosition();\t});\n\n\t\t\t} else {\n\n\t\t\t\t/*  Hide */\n\t\t\t\tcontent.hide();\n\n\t\t\t\t/* Insert */\n\t\t\t\tthis.render.appendTo(this.holder);\n\n\t\t\t\t/* Re enable */\n\t\t\t\tthis.callbacks.on(\"hide\", function() {\n\t\t\t\t\tcontent.show();\n\t\t\t\t});\n\t\t\t}\n\n\t\t\treturn this;\n\n\t\t},\n\n\t\tsetHolder: function(holder) {\n\n\t\t\t/* Append and save */\n\t\t\tthis.holder = $(holder).addClass(\"withLoading\").append(this.render);\n\n\t\t\t/* Self return */\n\t\t\treturn this;\n\n\t\t},\n\n\t\t/**\n\t\t * Hides current loading\n\t\t */\n\t\thide: function() {\n\n\t\t\tif(this.holder)\n\t\t\t\tthis.holder.removeClass(\"withLoading\");\n\n\t\t\tthis.render.remove();\n\t\t\tthis.callbacks.fire(\"hide\");\n\n\t\t\t/* Remove from list */\n\t\t\tloadings.remove(this);\n\n\t\t}\n\t};\n\n\treturn {\n\t\tloading: loading,\n\t\tmessage: message,\n\t\treCalculate: function() {\n\t\t\tloadings.each(function(instance) {\n\t\t\t\tinstance.calc.init();\n\t\t\t\tinstance.setPosition();\n\t\t\t})\n\t\t}\n\t}\n\n});","sky.service(\"pagination\", [\"templates\", \"stackList\"], function({ templates, stackList }) {\n\n\tlet list = stackList();\n\n\tclass Pagination {\n\t\tconstructor({ pages, holder, current = 1, }) {\n\n\t\t\t/* Self creation */\n\t\t\tif(!(this instanceof Pagination))\n\t\t\t\treturn new Pagination({ pages, holder, current });\n\n\t\t\t/* Save */\n\t\t\tlist.add(this);\n\n\t\t\t/* Set total pages */\n\t\t\tthis.pages \t\t= pages;\n\t\t\tthis.current \t= current;\n\t\t\tthis.pageWidth\t= 50;\n\t\t\tthis.id \t\t= last;\n\n\t\t\t/* No pages needed */\n\t\t\tif(this.pages < 2)\n\t\t\t\treturn this;\n\n\t\t\t/* Counted params */\n\t\t\tthis.dimensions = {\n\t\t\t\tstartPage      : 1,\n\t\t\t\tlastStartPage  : 0,\n\t\t\t\tpagesVisible   : 0,\n\t\t\t\tpagesInvisible : 0,\n\t\t\t\tscrollAvailable: 0,\n\t\t\t\tscrollStart\t   : 0,\n\t\t\t\ttumbler\t\t   : 10\n\t\t\t};\n\n\t\t\t/* Render */\n\t\t\tthis.dom = {};\n\t\t\tthis.dom.holder  = templates.render(\"pagination\", {}).data(\"pagination\", this);\n\t\t\tthis.dom.slider  = this.dom.holder.find(\".pages\");\n\t\t\tthis.dom.pages   = this.dom.slider.children();\n\t\t\tthis.dom.back \t = this.dom.holder.children(\".left\");\n\t\t\tthis.dom.forward = this.dom.holder.children(\".right\");\n\n\t\t\t/* Insert */\n\t\t\tif(holder)\n\t\t\t\tthis.dom.holder.appendTo(holder);\n\n\t\t\t/* If bigger than 10000 */\n\t\t\tif(this.pages > 9999) {\n\t\t\t\tthis.dom.slider.addClass(\"tenthousand\");\n\t\t\t\tthis.pageWidth = 80;\n\t\t\t}\n\t\t\t/* If bigger than 1000 */\n\t\t\telse if(this.pages > 999) {\n\t\t\t\tthis.dom.slider.addClass(\"thousand\");\n\t\t\t\tthis.pageWidth = 70;\n\t\t\t}\n\t\t\t/* If bigger 100 */\n\t\t\telse if(this.pages > 99 ) {\n\t\t\t\tthis.dom.slider.addClass(\"hundred\");\n\t\t\t\tthis.pageWidth = 60;\n\t\t\t}\n\n\t\t\t/* Make all */\n\t\t\tthis.redraw();\n\n\t\t\t/* Mark page */\n\t\t\tthis.goToPage(this.current);\n\n\t\t\t/* Self return */\n\t\t\treturn this;\n\n\t\t}\n\n\t\t/** */\n\t\tonPageChange(newPage) {}\n\n\t\t/** Removes navigator */\n\t\tremove() {\n\t\t\tthis.dom.holder.remove();\n\t\t\tlist.remove(this);\n\t\t}\n\n\t\t/**\n\t\t * Redraws pagination\n\t\t */\n\t\tredraw() {\n\n            /* No action on invisible */\n            if(!this.dom.holder.is(\":visible\"))\n                return;\n\n\t\t\t/* Reset width */\n\t\t\tthis.dom.slider.css(\"width\", \"auto\");\n\n\t\t\t/* Count visible sizes */\n\t\t\tthis.dimensions.pagesVisible = Math.floor((this.dom.holder.innerWidth() - 100) / this.pageWidth);\n\n\t\t\t/* Count invisible */\n\t\t\tthis.dimensions.pagesInvisible = (this.pages - this.dimensions.pagesVisible) > 0 ? this.pages - this.dimensions.pagesVisible : 0;\n\n\t\t\t/* Count last start */\n\t\t\tthis.dimensions.lastStartPage = this.dimensions.pagesInvisible + 1;\n\n\t\t\t/* Get max pages */\n\t\t\tlet toShow = this.dimensions.pagesVisible > this.pages ? this.pages : this.dimensions.pagesVisible;\n\n\t\t\t/* Crop */\n\t\t\tthis.dom.slider.css(\"width\", toShow * this.pageWidth);\n\n\t\t\t/* Redraw pages */\n\t\t\tthis.drawPages(this.dimensions.startPage);\n\n\t\t\t/* Try to create scroll */\n\t\t\tthis.createScroll();\n\n\t\t\t/* Set scroll position */\n\t\t\tif(this.dom.scrollLine)\n\t\t\t\tthis.dom.runner.css(\"left\", this.calculate().scroll);\n\n\t\t}\n\n\t\t/**\n\t\t * Create scroll line if needed\n\t\t */\n\t\tcreateScroll() {\n\n\t\t\t/* If no scroll needed */\n\t\t\tif(this.pages <= this.dimensions.pagesVisible) {\n\t\t\t\tif(this.dom.scrollLine) {\n\t\t\t\t\tthis.dom.scrollLine.remove();\n\t\t\t\t\tthis.dom.scrollLine = false;\n\t\t\t\t}\n\t\t\t\treturn;\n\t\t\t} else if(!this.dom.scrollLine) {\n\n\t\t\t\t/* Create scroll */\n\t\t\t\tthis.dom.scrollLine = templates.render(\"pagination-scroll\", {}).appendTo(this.dom.slider);\n\t\t\t\tthis.dom.runner = this.dom.scrollLine.children();\n\t\t\t}\n\n\t\t\t/* Count left */\n\t\t\tthis.dimensions.scrollStart = this.dom.scrollLine.position().left + 2;\n\n\t\t\t/* Count scroll line width */\n\t\t\tthis.dimensions.scrollAvailable = this.dom.scrollLine.outerWidth() - this.dom.scrollLine.children().outerWidth() - 4;\n\t\t\n\t\t}\n\n\t\t/**\n\t\t * Calculates related coordinates between scroll and move part\n\t\t */\n\t\tcalculate(position) {\n\n\t\t\t/* Get position */\n\t\t\tif(position === undefined)\n\t\t\t\tposition = this.dom.runner.offset().left  - this.dimensions.scrollStart;\n\n\t\t\t/* Remove start */\n\t\t\tposition = position - this.dimensions.scrollStart;\n\n\t\t\t/* Correct */\n\t\t\tposition = position > 0 ? position : 0;\n\n\t\t\t/* Count pages */\n\t\t\treturn {\n\t\t\t\tpages : Math.floor(this.dimensions.pagesInvisible * (position / this.dimensions.scrollAvailable)) + 1,\n\t\t\t\tscroll: Math.floor(this.dimensions.scrollAvailable * (this.dimensions.startPage - 1)/ this.dimensions.pagesInvisible + this.dimensions.scrollStart)\n\t\t\t}\n\n\t\t}\n\n\t\t/**\n\t\t * Draws pages according to start\n\t\t * @param {int} start Page to start from\n\t\t */\n\t\tdrawPages(start) {\n\n\t\t\t/* Remove old pages */\n\t\t\tthis.dom.pages.html(\"\");\n\n\t\t\t/* Correct */\n\t\t\tif(start > this.dimensions.pagesInvisible)\n\t\t\t\tstart = this.dimensions.pagesInvisible + 1;\n\n\t\t\t/* Correct */\n\t\t\tif(start < 1)\n\t\t\t\tstart = 1;\n\n\t\t\t/* Start position */\n\t\t\tlet i = start;\n\n\t\t\t/* Draw pages */\n\t\t\twhile(i <= this.pages && i < start + this.dimensions.pagesVisible) {\n\t\t\t\ttemplates.render(\"pagination-page\", { page: i, current: this.current }).appendTo(this.dom.pages);\n\t\t\t\ti++;\n\t\t\t}\n\n\t\t\t/* Reset start page */\n\t\t\tthis.dimensions.startPage = start;\n\n\n\t\t}\n\n\t\t/**\n\t\t * Sets page as active\n\t\t * @param {int} page Page number\n\t\t * @returns {Pagination}\n\t\t */\n\t\tgoToPage(page) {\n\n\t\t\t/* If no pages */\n\t\t\tif(this.pages < 2)\n\t\t\t\treturn this;\n\n\t\t\t/* Parse */\n\t\t\tpage = parseInt(page);\n\n\t\t\t/* Correct */\n\t\t\tif(page < 1)\n\t\t\t\tpage = 1;\n\t\t\telse if(page > this.pages)\n\t\t\t\tpage = this.pages;\n\n\t\t\t/* Checks if page is visible */\n\t\t\tlet isVisible = this.dimensions.startPage <= page && page < this.dimensions.startPage + this.dimensions.pagesVisible;\n\n\t\t\t/* Redraws if needed */\n\t\t\tif(!isVisible) {\n\t\t\t\tthis.drawPages(page);\n\t\t\t\tif(this.dom.scrollLine)\n\t\t\t\t\tthis.dom.runner.css(\"left\", this.calculate().scroll);\n\t\t\t}\n\n\t\t\t/* Make active */\n\t\t\tthis.dom.pages.children().removeClass(\"active\").filter(\"[page=\" + page +\"]\").addClass(\"active\");\n\n\t\t\t/* Forward buttons disable */\n\t\t\tif(page > 1) this.dom.back.enable();\n\t\t\telse this.dom.back.disable();\n\n\t\t\t/* Backward button disable */\n\t\t\tif(page === this.pages) this.dom.forward.disable();\n\t\t\telse this.dom.forward.enable();\n\n\t\t\t/* Callback */\n\t\t\tif(this.current !== page)\n\t\t\t\tthis.onPageChange(page);\n\n\t\t\t/* Save page state */\n\t\t\tthis.current = page;\n\n\t\t\t/* Self return */\n\t\t\treturn this;\n\n\t\t}\n\n\t\t/** Set scroll */\n\t\tscroll(event) {\n\n\t\t\tlet pos = event.pageX - 10;\n\t\t\tif(this.dimensions.scrollStart > pos)\n\t\t\t\tpos = this.dimensions.scrollStart;\n\t\t\tif(this.dimensions.scrollStart + this.dimensions.scrollAvailable < pos)\n\t\t\t\tpos = this.dimensions.scrollStart + this.dimensions.scrollAvailable;\n\n\t\t\tthis.dom.runner.css({left: pos});\n\t\t\tthis.drawPages(this.calculate(pos).pages);\n\n\t\t}\n\n\t}\n\n\t/* Bind windows events */\n\t$(window).on(\"resize\", function() {\n\t\tlist.each(() => { this.redraw(); });\n\t});\n\n\t/* Return */\n\tthis.service = {\n\t\tadd: function(options) {\n\t\t\treturn new Pagination(options);\n\t\t}\n\t}\n\n});","sky.service(\"stackList\", function() {\n\tlet List = this.service = function() {\n\n\t\tif(!(this instanceof List))\n\t\t\treturn new List();\n\n\t\tlet elements = {};\n\t\tlet lastId = 0;\n\t\tlet total = 0;\n\n\t\tthis.last = function() {\n\n\t\t\t/* Holder */\n\t\t\tlet last;\n\n\t\t\t/* Apply for windows */\n\t\t\tfor(let element of elements) last = element;\n\n\t\t\t/* Return */\n\t\t\treturn last || false;\n\n\t\t};\n\n\t\tthis.add = function(element) {\n\t\t\tlastId++;\n\t\t\ttotal++;\n\t\t\telement[lastId] = element;\n\t\t};\n\n\t\tthis.remove = function(element) {\n\t\t\t/* Apply for windows */\n\t\t\tfor(let index in elements)\n\t\t\t\tif(elements.hasOwnProperty(index) && elements[index] === element) {\n\t\t\t\t\tdelete elements[index];\n\t\t\t\t\ttotal--;\n\t\t\t\t}\n\t\t};\n\n\t\tthis.total = function() {\n\t\t\treturn total;\n\t\t};\n\n\t\tthis.elements = function() {\n\t\t\treturn elements;\n\t\t};\n\n\t\tthis.each = function(callback) {\n\t\t\tfor(let single of elements)\n\t\t\t\tcallback.apply(single, single);\n\t\t};\n\n\t}\n});","sky.onReady(({suggester}) => {\n\t$(document).on(\"click\", function(event) {\n\n\t\t/* Get element */\n\t\tlet element = $(event.target || event.srcElement);\n\n\t\t/* If click in replace we should not hide it */\n\t\tif(element.is(\"[type=submit]\") || element.closest(\".suggester\").length || element.data(\"suggester\"))\n\t\t\treturn;\n\n\t\t/* Hide all */\n\t\tsuggester.hide();\n\n\t});\n});\n\nsky.service(\"suggester\", [\"templates\"], function({templates}) {\n\n\tlet render,\n\t\tobject,\n\t\tlastList,\n\t\tsuggester = this.service = {\n\t\t\thide: function() {\n\n\t\t\t\tif(render) {\n\t\t\t\t\trender.remove();\n\t\t\t\t\trender = false;\n\t\t\t\t}\n\t\t\t\tif(object) {\n\t\t\t\t\tobject.removeData(\"suggester\");\n\t\t\t\t\tobject = false;\n\t\t\t\t}\n\t\t\t\t$(document).off(\"keyup.suggester, keydown.suggester\");\n\t\t\t},\n\t\t\tshow: function(input, list) {\n\n\t\t\t\t/* Hide previous */\n\t\t\t\tsuggester.hide();\n\n\t\t\t\t/* Save */\n\t\t\t\tlastList = list;\n\t\t\t\trender = templates.render(\"suggester\", {items: list}).insertAfter(input.closest(\"label, .label\"));\n\t\t\t\tobject = input.data(\"suggester\", render);\n\n\t\t\t\t/* Get positions */\n\t\t\t\tlet elementPosition = input.offset(),\n\t\t\t\t\trenderPosition = render.offset();\n\n\t\t\t\t/* Show */\n\t\t\t\trender.css({\n\t\t\t\t\t\"margin-left\": elementPosition.left - renderPosition.left,\n\t\t\t\t\t\"margin-top\": elementPosition.top - renderPosition.top + input.outerHeight()\n\t\t\t\t});\n\n\t\t\t\t/* Add handlers */\n\t\t\t\tlet children = render.children().on(\"click\", function() {\n\t\t\t\t\tinput.val($(this).html());\n\t\t\t\t\tsuggester.hide();\n\t\t\t\t\tif(lastList[$(this).attr(\"data-index\")].callback)\n\t\t\t\t\t\tlastList[$(this).attr(\"data-index\")].callback();\n\t\t\t\t});\n\n\t\t\t\t$(document).on(\"keyup.suggester\", function(event) {\n\n\t\t\t\t\tif(event.keyCode === 38 || event.keyCode === 40) {\n\n\t\t\t\t\t\tlet selected = children.filter(\".selected\");\n\t\t\t\t\t\tchildren.removeClass(\"selected\");\n\n\t\t\t\t\t\t// Up\n\t\t\t\t\t\tif(event.keyCode === 38) {\n\t\t\t\t\t\t\tif(!selected.length || !selected.prev().length)\n\t\t\t\t\t\t\t\tchildren.last().addClass(\"selected\");\n\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t\tselected.prev().addClass(\"selected\");\n\t\t\t\t\t\t}\n\t\t\t\t\t\t// Down\n\t\t\t\t\t\tif(event.keyCode === 40) {\n\t\t\t\t\t\t\tchildren.removeClass(\"selected\");\n\t\t\t\t\t\t\tif(!selected.length || !selected.next().length) {\n\t\t\t\t\t\t\t\tchildren.first().addClass(\"selected\")\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tselected.next().addClass(\"selected\");\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\t// Esc\n\t\t\t\t\tif(event.keyCode === 27) suggester.hide();\n\n\n\t\t\t\t}).on(\"keydown.suggester\", function(event) {\n\n\t\t\t\t\t// Enter\n\t\t\t\t\tif(event.keyCode !== 13) return;\n\n\t\t\t\t\tlet selected = children.filter(\".selected\");\n\t\t\t\t\tif(selected.length) {\n\t\t\t\t\t\tselected.trigger(\"click\");\n\t\t\t\t\t\tevent.preventDefault();\n\t\t\t\t\t} else {\n\t\t\t\t\t\tsuggester.hide();\n\t\t\t\t\t}\n\n\t\t\t\t});\n\t\t\t}\n\t\t};\n});","/**\n * Module to work with user services\n */\nsky.service(\"supported\", function () {\n\ttry {\n\t\tthis.service.fullScreen = typeof document[\"webkitIsFullScreen\"] !== \"undefined\";\n\t\tthis.service.formData = window.FormData && true;\n\t\t// this.service.XHRIsSupported = XHRIsSupported;\n\t\tthis.service.XHRUpload = (typeof new XMLHttpRequest().upload !== \"undefined\");\n\t\tthis.service.localStorage = !!window.localStorage;\n\t} catch (e) {}\n});","sky.service(\"templates\", [\"localStorage\", \"supported\", \"directives\", \"exceptions\"], function({ localStorage, supported, directives, exceptions }) {\n\n\t\n\tlet templatesList = {},\n\t\ttemplatesCompiled = {},\n\t\tTemplates = this.service = {\n\n\t\t/** Globals list */\n\t\tglobals : {},\n\n\t\t/** Local storage support */\n\t\tstorage: supported.localStorage ? new localStorage({ name: \"jsTemplates\" }) : false,\n\n\t\t/**\n\t\t * Adds new template to list\n\t\t * @param options\n\t\t */\n\t\tadd: function(options) {\n\t\t\ttemplatesList[options.name] = options.template;\n\t\t\tif(this.storage) {\n\t\t\t\tthis.storage.save(options.name, options.template);\n\t\t\t\t$.cookie(\"storedTemplates-\" + options.name, options.date);\n\t\t\t}\n\t\t},\n\n\t\t/**\n\t\t * Renders specified template\n\t\t * @param {String} name Template name\n\t\t * @param {Object} data Inner data\n\t\t * @param {bool} [noDirectives]\n\t\t * @returns {*}\n\t\t */\n\t\trenderWithHolder: function(name, data, noDirectives) {\n\n\t\t\t/* Compile template */\n\t\t\tthis.compile(name);\n\n\t\t\t/* Add globals */\n\t\t\tdata = $.extend(true, {}, data, { globals: this.globals });\n\n\t\t\t/* Render */\n\t\t\tlet temp = $('<div/>').append(templatesCompiled[name].render(data));\n\n\t\t\t/* Parse directives */\n\t\t\tif(!noDirectives)\n\t\t\t\tdirectives.parse(temp);\n\n\t\t\t/* Return */\n\t\t\treturn temp;\n\n\t\t},\n\n\t\t/**\n\t\t * Renders specified template\n\t\t * @param {String} name Template name\n\t\t * @param {Object} data Inner data\n\t\t * @param {bool} [noDirectives]\n\t\t * @returns {*}\n\t\t */\n\t\trender: function(name, data, noDirectives) {\n\n\t\t\t/* Compile template */\n\t\t\treturn this.renderWithHolder(name, data, noDirectives).children();\n\n\t\t},\n\n\t\t/**\n\t\t * Renders specified template and returns text\n\t\t * @param {String} name Template name\n\t\t * @param {Object} data Inner data\n\t\t * @param {bool} [noDirectives]\n\t\t * @returns {*}\n\t\t */\n\t\trenderToText: function(name, data, noDirectives) {\n\n\t\t\t/* Compile template */\n\t\t\treturn this.renderWithHolder(name, data, noDirectives).html();\n\n\t\t},\n\n\t\t/**\n\t\t * Renders template by its text as parameter\n\t\t * @param {string} text Template text\n\t\t * @param {Object} data Inner data\n\t\t * @param {bool} [noDirectives]\n\t\t * @returns {XMLList|*}\n\t\t */\n\t\trenderByText: function(text, data, noDirectives) {\n\n\t\t\t/* Add globals */\n\t\t\tdata = jQuery.extend(true, data, { globals: this.globals });\n\n\t\t\t/* Render */\n\t\t\tlet temp = $('<div/>').append(twig({ data: text }).render(data));\n\n\t\t\t/* Parse directives */\n\t\t\tif(!noDirectives)\n\t\t\t\tdirectives.parse(temp);\n\n\t\t\t/* Return */\n\t\t\treturn temp.children();\n\n\t\t},\n\n\t\t/**\n\t\t * Renders template by its text as parameter\n\t\t * @param {string} text Template text\n\t\t * @param {Object} data Inner data\n\t\t * @param noDirectives\n\t\t * @returns {XMLList|*}\n\t\t */\n\t\trenderByTextToText: function(text, data, noDirectives)  {\n\t\t\treturn $('<div/>').append(this.renderByText(text, data, noDirectives)).html();\n\t\t},\n\n\t\t/**\n\t\t * Compiles specified template\n\t\t * @param {string} name Template name\n\t\t */\n\t\tcompile: function(name) {\n\n\t\t\t/* If already compiled */\n\t\t\tif(templatesCompiled[name])\n\t\t\t\treturn;\n\n\t\t\t/* Load */\n\t\t\tthis.load(name);\n\n\t\t\t/* Compile */\n\t\t\tlet compiled = twig({ id: name, data: templatesList[name] });\n\n\t\t\t/* Check */\n\t\t\tif(!compiled)\n\t\t\t\tthrow new exceptions.system.Error('Error during compiling template \"' + name + '\"');\n\n\t\t\t/* Save */\n\t\t\ttemplatesCompiled[name] = compiled;\n\n\t\t},\n\n\t\t/**\n\t\t * Loads specified template\n\t\t * @param {string} name Template name\n\t\t */\n\t\tload: function(name) {\n\n\t\t\t/* Loaded */\n\t\t\tlet fromLS;\n\n\t\t\t/* Try to load from storage */\n\t\t\tif(!templatesList[name] && this.storage && (fromLS = this.storage.load(name)))\n\t\t\t\treturn templatesList[name] = fromLS;\n\n\t\t\t/* If already compiled */\n\t\t\tif(templatesList[name])\n\t\t\t\treturn templatesList[name];\n\n\t\t\t/* Load template */\n\t\t\tif(!(templatesList[name] = $('script[type=\"text/template\"][id='+ name +']').html()))\n\t\t\t\tthrow new exceptions.system.Error(\"Can't find template  \"  + name);\n\n\t\t\t/* Save to LS */\n\t\t\tif(this.storage)\n\t\t\t\tthis.storage.save(name, { template: templatesList[name] });\n\n\t\t\t/* Return */\n\t\t\treturn templatesList[name]\n\n\t\t}\n\n\t};\n\n\tsky.directive('script[type=\"text/template\"]', function(template, attrs) {\n\t\tTemplates.add({\n\t\t\tname        : attrs.id,\n\t\t\ttemplate    : template.html()\n\t\t});\n\t});\n\n\n\t/* Save templates files data */\n\tsky.onReady(() => {\n\t\tif(window.page.data.templates && supported.localStorage) {\n\t\t\t$.each(window.page.data.templates, function(_, template) {\n\t\t\t\t$.cookie(\"storedTemplates-\" + template.path, template.date);\n\t\t\t});\n\t\t}\n\t});\n\n});\n","sky.service(\"tips\", [\"stackList\", \"callbacks\"], function({ stackList, callbacks }) {\n\n    /** Class to work with tips */\n    let list = stackList(),\n        tips = this.service = {\n\n        /**\n         * Hides all visible tips\n         * @param withoutAutoHide\n         */\n        hideAll: function(withoutAutoHide) {\n\n            /* Hide all tips */\n            $.each(list.elements(), function(_, tip) {\n                if(withoutAutoHide || tip.autoHide)\n                    this.hide();\n            });\n\n        },\n\n        /**\n         * Returns last open window if any\n         * @returns {tips.Tip|boolean}\n         */\n        getLast: function() {\n            list.last();\n        },\n\n        /**\n         * Add show/hide functions\n         * @param {string}            selector            Object to bind tips for\n         * @param {string}            align                Align of tip\n         * @param options\n         * @see tips.tip\n         */\n        bind: function(selector, align, options) {\n\n            /* Create binds */\n            $(selector).on({\n                \"mouseenter\": function() {\n                    let tip = $(this).data(\"tip\") || tips.Tip(this, options).show(align);\n                },\n                \"mouseleave\": function() {\n                    let tip = $(this).data(\"tip\");\n                    if(tip) tip.hide(align);\n                }\n            });\n\n        },\n\n        /**\n         * Creates new tip object\n         * @param {object}            object                Object to show tip for\n         * @param autoHide\n         * @param create\n         * @param close\n         * @param ajax\n         * @param highlight\n         * @constructor\n         */\n        Tip: function(object, { autoHide = true, create = false, close = false, ajax = false, highlight = false } = {}) {\n\n            /* Auto construct */\n            if(!(this instanceof tips.Tip))\n                return new tips.Tip(object, { autoHide, create, close, ajax, highlight });\n\n            /* Manual create tip by create function */\n            if(typeof create === \"function\") {\n\n                /* Create tip */\n                this.tip = create(object);\n\n                /* If no tip */\n                if(!this.tip) return this;\n\n            }\n\n            /* Object set */\n            this.object = $(object).data(\"tip\", this);\n\n            /* Save callbacks */\n            this.callbacks = callbacks();\n\n            /* Auto hide */\n            this.autoHide = autoHide;\n\n            /* Manual create tip by create function */\n            if(typeof create !== \"function\") {\n\n                /* Create tip */\n                this.tip = $(\"<div/>\").addClass(\"tip\").append('<div class=\"tipContent\"></div>').insertBefore(object);\n\n                /* Title using */\n                if(!create && this.object.attr('title'))\n\t\t\t\t\tcreate = this.object.attr('title');\n                else if(!create)\n\t\t\t\t\tcreate = \" \";\n\n                this.tip.find(\".tipContent\").append(create);\n\n            }\n\n            if(highlight)\n                this.shadow = $('<div/>').css({ opacity: 0, position:\"absolute\", width: \"100%\", height: \"100%\", left:0 ,top:0, background: \"rgba(0,0,0,0.5)\" }).appendTo(\"body\");\n\n            /* If count down */\n            if(typeof close === \"number\")\n                this.closeTimeout = setTimeout(() => this.hide(), close);\n\n            /* If close button */\n            else if(close)\n                $('<div/>').addClass('close').appendTo(this.tip).on(\"click\", () => this.hide());\n\n            /* If stop possible */\n            if(ajax)  ajax.on(\"always\", () => this.hide());\n\n            /* Add to list */\n            this.tip.css(\"display\", \"none\");\n\t\t\tlist.add(this);\n            return this;\n\n        }\n\n    };\n\n    /**\n     * Extends tip\n     */\n    $.extend(tips.Tip.prototype, /** @lends tips.tip */ {\n\n        /**\n         * Shows tip according to type\n         * @param {string} [align] Way it would be shown\n         */\n        show: function(align) {\n\n            /* Back link */\n            let self   = this;\n            let offset = this.tip.css({left: \"\", top: \"\", marginLeft: \"\", marginTop: \"\", display: \"\"}).offset();\n\n            /* Stop animation and shows */\n            this.tip.stop();\n\n            /* Save way to show */\n            if(align) this.align = align;\n\n            /* If shadow */\n            if(this.shadow)\n                this.shadow.stop().show().animate({opacity: 1}, 100);\n\n            /* Different actions according to tip position */\n            switch(this.align) {\n\n                /* If show righter than input */\n                case \"right\":\n                {\n                    this.tip.addClass(\"right\").css({\n                        marginLeft: this.object.offset().left + this.object.outerWidth() - offset.left,\n                        marginTop : this.object.offset().top - offset.top + parseInt((this.object.outerHeight() - this.tip.outerHeight()) / 2),\n                        opacity   : 0\n                    });\n                    this.tip.animate({opacity: 1, marginLeft: \"+=10\"}, 100);\n                    break;\n                }\n                /* If show righter than input */\n                case \"left\":\n                {\n                    this.tip.addClass(\"left\").css({\n                        marginLeft: this.object.offset().left - offset.left - this.tip.outerWidth(),\n                        marginTop : this.object.offset().top - offset.top + parseInt((this.object.outerHeight() - this.tip.outerHeight()) / 2),\n                        opacity   : 0\n                    });\n                    this.tip.animate({opacity: 1, marginLeft: \"-=10\"}, 300);\n                    break;\n                }\n                /* If show topper */\n                case \"top\":\n                {\n\n                    // Count left offset\n                    let left = this.object.offset().left - offset.left;\n\n                    /* Reposition */\n                    if(offset.left + left + this.tip.outerWidth() > $(window).outerWidth())\n                        left = left - this.tip.outerWidth() + this.object.outerWidth();\n\n                    /* Position */\n                    this.tip.addClass(\"top\").css({\n                        marginLeft: left,\n                        marginTop : this.object.offset().top - this.tip.outerHeight() - offset.top,\n                        opacity   : 0\n                    });\n\n                    this.tip.animate({opacity: 1, marginTop: \"-=10\"}, 300);\n                    break;\n                }\n                /* If show topper */\n                case \"bottom\":\n                {\n\n                    let left = this.object.offset().left - offset.left;\n\n                    /* Reposition */\n                    if(offset.left + left + this.tip.outerWidth() > $(window).outerWidth())\n                        left = left - this.tip.outerWidth() + this.object.outerWidth();\n\n                    /* Position */\n                    this.tip.addClass(\"bottom\").css({\n                        marginLeft: left,\n                        marginTop : this.object.offset().top + this.object.outerHeight() - offset.top,\n                        opacity   : 0\n                    });\n\n                    this.tip.animate({opacity: 1, marginTop: \"+=10\"}, 300);\n                    break;\n                }\n                /* If we replace input with tip */\n                case \"instead\":\n                {\n                    this.tip.css({\n                        width  : this.object.outerWidth(),\n                        height : this.object.outerHeight(),\n                        display: \"none\"\n                    });\n                    this.object.fadeOut(100, function() {\n                        self.tip.fadeIn(100);\n                    }).get(0).blur();\n                    break;\n                }\n                case \"inside\":\n                {\n                    this.tip.css({\n                        width  : this.object.outerWidth(),\n                        height : this.object.outerHeight(),\n                        display: \"none\"\n                    });\n                    this.tip.css(\"opacity\", 0).animate({opacity: 1}, 100);\n                    break;\n                }\n                default:\n                    break;\n            }\n\n            this.tip.css({left: \"\", top: \"\"});\n\n            /* Self return */\n            return this;\n\n        },\n\n        /**\n         * Hides current tip\n         */\n        hide: function() {\n\n            /* Remove count down if needed */\n            if(this.closeTimeout)\n                clearTimeout(this.closeTimeout);\n\n            /* Stop animation */\n            this.tip.stop();\n\n            /* Get know how tip was shown */\n            let align = this.align;\n\n            /* Create end animation callback */\n            let callback = () => {\n\n                /* Delete record from global list */\n                list.remove(this);\n\n                /* Remove data */\n                this.object.removeData(\"tip\");\n\n                /* Remove tip */\n                this.tip.remove();\n\n                /* Callback */\n                this.callbacks.fire(\"hide\", this);\n\n            };\n\n            /* If just shown */\n            if(!align)\n                callback();\n\n            /* If shadow */\n            if(this.shadow)\n                this.shadow.animate({opacity: 0}, 100, () => { this.shadow.remove() });\n\n            /* Right way hide */\n            if(align === \"right\")\n                this.tip.animate({opacity: 0, marginLeft: \"+=10\"}, 100, callback);\n\n            /* Left way hide */\n            if(align === \"left\")\n                this.tip.animate({opacity: 0, marginLeft: \"-=10\"}, 100, callback);\n\n            /* Instead way hide */\n            if(align === \"instead\")\n                this.tip.fadeOut({opacity: 0}, 200, callback);\n\n            /* Top way hide */\n            if(align === \"top\")\n                this.tip.animate({opacity: 0, marginTop: \"-=5\"}, 200, callback);\n\n            /* Bottom way hide */\n            if(align === \"bottom\")\n                this.tip.animate({opacity: 0, marginTop: \"+=5\"}, 200, callback);\n\n            /* Inside way hide */\n            if(align === \"inside\")\n                this.tip.animate({opacity: 0}, 200, callback);\n\n            /* Self return */\n            return this;\n\n        },\n\n        /**\n         * Gets tips dom\n         * @returns {*}\n         */\n        get: function() {\n            return this.tip;\n        },\n\n        /**\n         * Sets tip text\n         * @param {string|jQuery} text What to insert to tip body\n         */\n        set: function(text) {\n            this.tip.children(\".tipContent\").html(text);\n            return this;\n        },\n\n        /**\n         * Adds something to tip\n         * @param {string|jQuery} what What to append to tip body\n         */\n        add: function(what) {\n            this.tip.children(\".tipContent\").append(what);\n            return this;\n        }\n\n    });\n\n});","sky.service(\"utils\", function() {\n\tthis.service = {\n\n\t\t/**\n\t\t * Checks if object has same data\n\t\t * @param first\n\t\t * @param second\n\t\t */\n\t\tisObjectsEqual: function(first, second) {\n\n\t\t\t/* Different types */\n\t\t\tif(typeof first !== typeof second)\n\t\t\t\treturn false;\n\n\t\t\t/* If object or array we will compare each element */\n\t\t\tif(first instanceof Array || first instanceof Object) {\n\t\t\t\tlet key;\n\t\t\t\t/* Check first */\n\t\t\t\tfor(key in first) {\n\t\t\t\t\tif(!first.hasOwnProperty(key)) continue;\n\t\t\t\t\tif(typeof second[key] === \"undefined\") return false;\n\t\t\t\t\telse if(!this.isObjectsEqual(first[key], second[key])) return false;\n\t\t\t\t}\n\n\t\t\t\t/* Check second */\n\t\t\t\tfor(key in second) {\n\t\t\t\t\tif(!second.hasOwnProperty(key)) continue;\n\t\t\t\t\tif(typeof first[key] === \"undefined\") return false;\n\t\t\t\t}\n\n\t\t\t} else if(first !== second) return false;    // For simple types\n\n\t\t\t/* All tests success */\n\t\t\treturn true;\n\n\t\t},\n\n\t\t/**\n\t\t * Adds zero\n\t\t * @param value\n\t\t * @returns {Number}\n\t\t */\n\t\taddLeadingZero: function(value) {\n\n\t\t\t/* Parse */\n\t\t\tvalue = parseInt(value);\n\n\t\t\t/* Ad zero */\n\t\t\tif(value < 10)\n\t\t\t\tvalue = \"0\" + value;\n\n\t\t\t/* Val */\n\t\t\treturn value;\n\n\t\t},\n\n\t\tencode: function(rawStr) {\n\t\t\treturn rawStr.replace(/[\\u00A0-\\u9999<>&]/gim, function(i) {\n\t\t\t\treturn '&#' + i.charCodeAt(0) + ';';\n\t\t\t});\n\t\t},\n\n\t\t/**\n\t\t * Makes data to JSON past\n\t\t * @param data\n\t\t * @param [inputName]\n\t\t * @returns {string}\n\t\t */\n\t\tjsonData: function(data, inputName) {\n\t\t\treturn '<script type=\"application/json\"' + (inputName ? (' input-name=\"' + inputName + '\"') : \"\") + '>' + sky.encode(JSON.stringify(data)) + '</script>';\n\t\t},\n\n\t\tprepareSelectData: function(items, func, {columnSplitOn = 6, maxColumns = 4}) {\n\n\t\t\tlet index        = 0,\n\t\t\t\tcolumns      = [],\n\t\t\t\tcolumnsCount = items.length / columnSplitOn,\n\t\t\t\tgroupHolder,\n\t\t\t\tcompiled;\n\n\t\t\tif(columnsCount < 1)\n\t\t\t\tcolumnsCount = 1;\n\t\t\tif(columnsCount > maxColumns)\n\t\t\t\tcolumnsCount = maxColumns;\n\n\t\t\tlet perColumn = Math.ceil(items.length / columnsCount);\n\n\t\t\tfor(let item of items) {\n\t\t\t\tif(compiled = func({item, index, column: columns.length})) {\n\n\t\t\t\t\tif(index % perColumn === 0) {\n\t\t\t\t\t\tgroupHolder = [];\n\t\t\t\t\t\tcolumns.push(groupHolder);\n\t\t\t\t\t}\n\n\t\t\t\t\tgroupHolder.push(compiled);\n\t\t\t\t\tindex++;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn index === 0 ? [] : {groups: columns}\n\n\t\t}\n\t}\n});","sky.onReady(function({ validator }) {\n\tjQuery.fn.validForm = function() {\n\t\treturn validator.validateForm(this);\n\t}.safe();\n\tjQuery.fn.validationRule = function(name, options) {\n\t\treturn validator.addRule(this, name, options);\n\t}.safe();\n\t$(document).on(\"change keyup\", \"[data-validate]\", function() {\n\t\tvalidator.validateElement($(this));\n\t});\n});\n\nsky.service(\"validator\", function() {\n\n\t/**\n\t * Main validation object\n\t */\n\tlet validator = this.service = {\n\n\t\t/**\n\t\t * Validates specified form, or dom element\n\t\t * @param form\n\t\t */\n\t\tvalidateForm: function(form) {\n\n\t\t\tlet pass = true,\n\t\t\t\tself = this;\n\n\t\t\t/* Go through all elements that need to be validate */\n\t\t\tform.find(\"input, select, textarea, .selectReplace, [data-validate]\").filter(\":visible\").each(function() {\n\n\t\t\t\t/* Get element */\n\t\t\t\tlet element = $(this);\n\n\t\t\t\t/* validate if needed to */\n\t\t\t\tif(self.shouldBeValidated(element) && !self.validateElement(element, form))\n\t\t\t\t\tpass = false;\n\n\t\t\t});\n\n\t\t\t/* Return result */\n\t\t\treturn pass;\n\n\t\t},\n\n\t\t/**\n\t\t * Add rule to specified element\n\t\t * @param element\n\t\t * @param name\n\t\t * @param [options]\n\t\t */\n\t\taddRule: function(element, name, options) {\n\n\t\t\t/* Get or make options and add rule */\n\t\t\tthis.Options(element).addRule(name, options || {});\n\n\t\t\t/* Self return */\n\t\t\treturn this;\n\n\t\t},\n\n\t\t/**\n\t\t *\n\t\t * Validates specified element\n\t\t * @param {*} element Element to validate\n\t\t * @param {*} [form] Form to validate\n\t\t * @returns {boolean}\n\t\t */\n\t\tvalidateElement: function(element, form) {\n\n\t\t\tlet self = this,\n\t\t\t\toptions = this.Options(element),\n\t\t\t\ttotalPass = true,\n\t\t\t\tvalue = element.val(),\n\t\t\t\tlastError = false,\n\t\t\t\tfirstError = false,\n\t\t\t\tlastSuccess = false,\n\t\t\t\tfirstSuccess = false;\n\n\t\t\t/* Select replace */\n\t\t\tif(element.is(\".selectReplace\")) {\n\t\t\t\tlet inputs = element.next().find(\"input:checked\");\n\t\t\t\tif(!inputs.length)\n\t\t\t\t\tvalue = \"\";\n\t\t\t\telse if(element.is(\".single\"))\n\t\t\t\t\tvalue = element.next().find(\"input:checked\").val();\n\t\t\t\telse\n\t\t\t\t\tvalue = element.next().find(\"input:checked\").length ? \"true\" : \"\";\n\t\t\t}\n\n\t\t\t/* Go through rules */\n\t\t\t$.each(options.rules, function(name, ruleOverload) {\n\n\t\t\t\t/* Make compiled rule */\n\t\t\t\tlet compiledRule = jQuery.extend(true, {}, self.rules[name] || self.Rule({}), ruleOverload || {});\n\n\t\t\t\t/* Execute message is needed */\n\t\t\t\tif(typeof compiledRule.message === \"function\")\n\t\t\t\t\tcompiledRule.message = compiledRule.message.call(this);\n\n\t\t\t\t/* Check if element pass validation */\n\t\t\t\tlet pass = self.validate(value, compiledRule, element, form);\n\n\t\t\t\t/* Perform action according to result */\n\t\t\t\tif(pass) {\n\t\t\t\t\tcompiledRule.onSuccess(element, compiledRule);\n\t\t\t\t\tlastSuccess = compiledRule;\n\t\t\t\t\tif(!firstSuccess)\n\t\t\t\t\t\tfirstSuccess = compiledRule;\n\t\t\t\t} else {\n\t\t\t\t\tcompiledRule.onError(element, compiledRule);\n\t\t\t\t\tlastError = compiledRule;\n\t\t\t\t\tif(!firstError)\n\t\t\t\t\t\tfirstError = compiledRule;\n\t\t\t\t\ttotalPass = false;\n\t\t\t\t}\n\n\t\t\t});\n\n\t\t\t/* Total callbacks */\n\t\t\tif(totalPass)\n\t\t\t\toptions.onSuccess(element, lastSuccess);\n\t\t\telse\n\t\t\t\toptions.onError(element, firstError);\n\n\t\t\t/* Return true of element passed all validations */\n\t\t\treturn totalPass;\n\n\t\t},\n\n\t\t/**\n\t\t * Return true if element should be validated\n\t\t * @param {*} element Element to validate\n\t\t * @returns {boolean}\n\t\t */\n\t\tshouldBeValidated: function(element) {\n\t\t\treturn element.attr(\"data-validate\") || element.data(\"validationOptions\");\n\t\t},\n\n\t\t/**\n\t\t * Return true if element passed validation\n\t\t * @param element\n\t\t * @param compiledRule\n\t\t * @param form\n\t\t * @returns {*}\n\t\t * @param value\n\t\t */\n\t\tvalidate: function(value, compiledRule, element, form) {\n\t\t\treturn compiledRule.rule.call(compiledRule, value, element, form);\n\t\t}\n\n\t};\n\n\t/**\n\t * Defaults\n\t */\n\tvalidator.ruleDefaults = {\n\n\t};\n\n\t/**\n\t * Defaults\n\t * @type {{onSuccess: onSuccess, onError: onError}}\n\t */\n\tvalidator.optionsDefaults = {\n\n\t\t/* Fires on success */\n\t\tonSuccess: function(element) {\n\n\t\t\t/* Remove error */\n\t\t\telement.removeClass(this.errorClass);\n\n\t\t\t/* Add success */\n\t\t\tif(this.successClass)\n\t\t\t\telement.addClass(this.successClass);\n\n\t\t},\n\n\t\t/* Fires on error */\n\t\tonError: function(element) {\n\n\t\t\t/* Add error */\n\t\t\telement.addClass(this.errorClass);\n\n\t\t\t/* Remove success */\n\t\t\tif(this.successClass)\n\t\t\t\telement.removeClass(this.successClass);\n\n\t\t}\n\t};\n\n\t/**\n\t * Base rule object\n\t * @param overload\n\t * @returns {validator.Rule}\n\t * @constructor\n\t */\n\tvalidator.Rule = function(overload) {\n\n\t\t/* Self creation if needed */\n\t\tif(!(this instanceof validator.Rule))\n\t\t\treturn new validator.Rule(overload);\n\n\t\t/* Dump rule to check validation */\n\t\tthis.rule = function() { return true; };\n\n\t\t/* Dump message */\n\t\tthis.message = \"    \";\n\n\t\t/* List of options to make validation according to */\n\t\tthis.options = [];\n\n\t\t/* Fires on success */\n\t\tthis.onSuccess = function(element) {};\n\n\t\t/* Fires on error */\n\t\tthis.onError = function(element) {};\n\n\t\t/* Self extend with overload */\n\t\tjQuery.extend(this, overload);\n\n\t\t/* Return */\n\t\treturn this;\n\n\t};\n\n\t/**\n\t * List of default rules\n\t * @type {{required: validator.Rule}}\n\t */\n\tvalidator.rules = {\n\t\trequired: validator.Rule({\n\t\t\trule: function(value) {\n\t\t\t\treturn !!value.length;\n\t\t\t},\n\t\t\tmessage: \"   \"\n\t\t}),\n\t\trequiredIfFilled: validator.Rule({\n\t\t\trule: function(value) {\n\t\t\t\tlet item = $(this.options[0]);\n\t\t\t\treturn item.is(\":radio, :checkbox\") ? !item.is(\":checked\") || value : item.val() === \"\" || value;\n\t\t\t},\n\t\t\tmessage: \"   \"\n\t\t}),\n\t\tdate: validator.Rule({\n\t\t\trule: function(value) {\n\t\t\t\treturn !value || (\n\t\t\t\t\tvalue.match(/^\\d{4}-\\d{2}-\\d{2}( \\d{2}:\\d{2}(:\\d{2})?)?$/) ||\n\t\t\t\t\tvalue.match(/^\\d{2}.\\d{2}.\\d{4}( \\d{2}:\\d{2}(:\\d{2})?)?$/)\n\t\t\t\t\t);\n\t\t\t},\n\t\t\tmessage: \"  \"\n\t\t}),\n\t\tperiod: validator.Rule({\n\t\t\trule: function(value) {\n\t\t\t\treturn !value || (\n\t\t\t\t\tvalue.match(/^\\d{4}-\\d{2}-\\d{2}$/) ||\n\t\t\t\t\tvalue.match(/^\\d{2}.\\d{2}.\\d{4}$/) ||\n\t\t\t\t\tvalue.match(/^\\d{2}.\\d{2}.\\d{4}\\s*-\\s*\\d{2}.\\d{2}.\\d{4}$/) ||\n\t\t\t\t\tvalue.match(/^\\d{4}-\\d{2}-\\d{2}\\s*-\\s*\\d{4}-\\d{2}-\\d{2}$/)\n\t\t\t\t\t);\n\t\t\t},\n\t\t\tmessage: \"  \"\n\t\t}),\n\t\temail: validator.Rule({\n\t\t\trule: function(value) {\n\t\t\t\treturn value && value.match(/[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*@(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?/);\n\t\t\t},\n\t\t\tmessage: \"   \"\n\t\t}),\n\t\tsame: validator.Rule({\n\t\t\trule: function(value) {\n\t\t\t\treturn value === $('[name=\"' + this.options[0] + '\"]').val();\n\t\t\t},\n\t\t\tmessage: \"  \"\n\t\t}),\n\t\turl: validator.Rule({\n\t\t\trule: function(value) {\n\t\t\t\treturn value === \"\" || value.match(/^(https?:\\/\\/.+)$/);\n\t\t\t},\n\t\t\tmessage: \"   URI\"\n\t\t}),\n\t\tregexp: validator.Rule({\n\t\t\trule: function(value) {\n\t\t\t\treturn value === \"\" || value.match(new RegExp(this.options[0]));\n\t\t\t},\n\t\t\tmessage: \"  \"\n\t\t}),\n\t\tnumeric: validator.Rule({\n\t\t\trule: function(value) {\n\t\t\t\treturn value === \"\" || value.match(/^-?[0-9]+(\\.[0-9]+)?$/);\n\t\t\t},\n\t\t\tmessage: \" \"\n\t\t}),\n\t\tpositive: validator.Rule({\n\t\t\trule: function(value) {\n\t\t\t\treturn value === \"\" || value.match(/^[0-9]+(\\.[0-9]+)?$/) && parseFloat(value) > 0;\n\t\t\t},\n\t\t\tmessage: \"  \"\n\t\t}),\n\t\tmax: validator.Rule({\n\t\t\trule: function(value) {\n\t\t\t\treturn value === \"\" || value.match(/^[0-9]+(\\.[0-9]+)?$/) && parseFloat(value) <= parseFloat(this.options[0] || 0);\n\t\t\t},\n\t\t\tmessage: function() {\n\t\t\t\treturn \" ,    \" + (this.options[0] || 0)\n\t\t\t}\n\t\t}),\n\t\tmin: validator.Rule({\n\t\t\trule: function(value) {\n\t\t\t\treturn value === \"\" || value.match(/^[0-9]+(\\.[0-9]+)?$/) && parseFloat(value) >= parseFloat(this.options[0] || 0);\n\t\t\t},\n\t\t\tmessage: function() {\n\t\t\t\treturn \" ,    \" + (this.options[0] || 0);\n\t\t\t}\n\t\t}),\n\t\tminLength: validator.Rule({\n\t\t\trule: function(value) {\n\t\t\t\treturn value === \"\" || value.length >= (this.options[0] || 0)\n\t\t\t},\n\t\t\tmessage: \"    \"\n\t\t}),\n\t\tmaxLength: validator.Rule({\n\t\t\trule: function(value) {\n\t\t\t\treturn value === \"\" || value.length <= (this.options[0] || 0)\n\t\t\t},\n\t\t\tmessage: \"     \"\n\t\t})\n\t};\n\n\t/**\n\t * Holds element validation options\n\t * @param element\n\t * @constructor\n\t */\n\tvalidator.Options = function(element) {\n\n\t\t/* Create or return */\n\t\tif(!(this instanceof validator.Options))\n\t\t\treturn element.data(\"validationOptions\") || new validator.Options(element);\n\n\t\t/* Callbacks after all checks */\n\t\tthis.onSuccess = function() {};\n\t\tthis.onError = function() {};\n\n\t\t/* Adds to element on success */\n\t\tthis.successClass = false;\n\n\t\t/* Adds to element on error */\n\t\tthis.errorClass   = \"error\";\n\n\t\t/* Overlay defaults */\n\t\tjQuery.extend(true, this, validator.optionsDefaults);\n\n\t\t/* Holds list of validating rules */\n\t\tthis.rules = {};\n\n\t\t/* Save element */\n\t\tthis.element = element;\n\n\t\t/* Get rules that declared in element definition */\n\t\tthis.getDeclaredRules();\n\n\t\t/* Save option */\n\t\tthis.element.data(\"validationOptions\", this);\n\n\t\t/* Self return */\n\t\treturn this;\n\n\t};\n\n\tvalidator.Options.prototype = {\n\n\t\t/**\n\t\t * Gets list of rules that are set in declared way\n\t\t */\n\t\tgetDeclaredRules: function() {\n\n\t\t\t/* Get attribute value */\n\t\t\tlet attr = this.element.attr(\"data-validate\"),\n\t\t\t\tself = this;\n\n\t\t\t/* If none */\n\t\t\tif(!attr)\n\t\t\t\treturn;\n\n\t\t\t/* Get list */\n\t\t\t$.each(attr.split(\";\"), function(_, name) {\n\n\t\t\t\t/* Get parameters */\n\t\t\t\tlet params = name.match(/(\\w+)\\((.*)\\)/);\n\n\t\t\t\t/* Parse */\n\t\t\t\tif(params) {\n\n\t\t\t\t\t/* Get function */\n\t\t\t\t\tname = params[1];\n\n\t\t\t\t\t/* Parse params */\n\t\t\t\t\tparams = params[2].match(/(('[^']+')|([\\d\\w]+))/g);\n\t\t\t\t\t$.each(params, function(i, val) {\n\t\t\t\t\t\tparams[i] = eval(val.trim());\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\t/* Add rule to options */\n\t\t\t\tself.addRule(name.trim(), { options: params || [] });\n\n\t\t\t});\n\n\n\t\t},\n\n\t\t/**\n\t\t * Adds new rule for element\n\t\t * @param {string} name Rule name\n\t\t * @param {object} options Rule options\n\t\t * @returns {validator.Options}\n\t\t */\n\t\taddRule: function(name, options) {\n\n\t\t\t/* Create and save new rule */\n\t\t\tthis.rules[name] = jQuery.extend({}, validator.ruleDefaults, options);\n\n\t\t\t/* Mark for auto validation */\n\t\t\tif(!this.element.attr(\"data-validate\"))\n\t\t\t\tthis.element.attr(\"data-validate\", \"true\");\n\n\t\t\t/* Self returning */\n\t\t\treturn this;\n\t\t}\n\n\t}\n\n});","sky.service(\"visibleCalculator\", function() {\n\n\tlet Calculator = this.service = class {\n\n\t\tconstructor(holder, minHeight, scrollable) {\n\n\t\t\t/* Check if class */\n\t\t\tif(!(this instanceof Calculator))\n\t\t\t\treturn new Calculator(holder, minHeight, scrollable);\n\n\t\t\t/* Re get holder */\n\t\t\tthis.holder = $(holder);\n\t\t\tthis.scrollable = scrollable;\n\t\t\tthis.minHeight = minHeight;\n\n\t\t\t/* Init */\n\t\t\tthis.init();\n\n\t\t}\n\n\t\t/* Init func */\n\t\tinit() {\n\n\t\t\t/* Count offset */\n\t\t\tlet offset = this.holder.offset();\n\n\t\t\t/* Get holder rect */\n\t\t\tthis.holderRect = {\n\t\t\t\tleft  : offset.left,\n\t\t\t\ttop   : offset.top,\n\t\t\t\twidth : this.holder.outerWidth(),\n\t\t\t\theight: this.holder.outerHeight()\n\t\t\t};\n\n\t\t}\n\n\t\t/* Calculating function */\n\t\tcalculate() {\n\n\t\t\t/* How much is scrolled */\n\t\t\tlet scrollTop    = $(this.scrollable).scrollTop(),\n\t\t\t\twindowHeight = $(window).height(),\n\t\t\t\twindowWidth  = $(window).width(),\n\t\t\t\tsizes        = {\n\t\t\t\t\tleft        : this.holderRect.left,\n\t\t\t\t\tright       : this.holderRect.left + this.holderRect.width,\n\t\t\t\t\ttop         : this.holderRect.top - scrollTop,\n\t\t\t\t\twidth       : this.holderRect.width,\n\t\t\t\t\theight      : this.holderRect.height,\n\t\t\t\t\trealHeight  : this.holderRect.height,\n\t\t\t\t\tscrollTop   : scrollTop,\n\t\t\t\t\tscrollLeft  : 0,\n\t\t\t\t\twindowHeight: windowHeight,\n\t\t\t\t\twindowWidth : windowWidth,\n\t\t\t\t};\n\n\t\t\t/* Min height */\n\t\t\tif(sizes.height < this.minHeight)\n\t\t\t\tsizes.height = this.minHeight;\n\n\t\t\t/* Count bottom */\n\t\t\tsizes.bottom = sizes.top + sizes.height;\n\n\t\t\t/* If top border near than holder */\n\t\t\tif(sizes.top < 0) {\n\t\t\t\t// If visible less than min\n\t\t\t\tif(sizes.bottom < this.minHeight) {\n\t\t\t\t\tsizes.bottom = sizes.bottom < 0 ? 0 : sizes.bottom;\n\t\t\t\t\tsizes.top = sizes.bottom - this.minHeight;\n\t\t\t\t\tsizes.height = this.minHeight;\n\t\t\t\t}\n\t\t\t\t// If visible more than min\n\t\t\t\telse {\n\t\t\t\t\tsizes.height = sizes.bottom;\n\t\t\t\t\tsizes.top = 0;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t/* Get visible bottom */\n\t\t\tif(windowHeight < sizes.bottom) {\n\t\t\t\t// If visible less than min\n\t\t\t\tif(windowHeight - sizes.top < this.minHeight) {\n\t\t\t\t\tsizes.height = this.minHeight;\n\t\t\t\t\tsizes.top = windowHeight - sizes.top < 0 ? 0 : sizes.top;\n\t\t\t\t\tsizes.bottom = sizes.top + this.minHeight;\n\t\t\t\t}\n\t\t\t\t// If visible more than min\n\t\t\t\telse {\n\t\t\t\t\tsizes.height = windowHeight - sizes.top;\n\t\t\t\t\tsizes.bottom = 0;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t/* Return */\n\t\t\treturn sizes;\n\n\t\t}\n\n\t\tgetDropOffset(replace, popup) {\n\n\t\t\t/* Get drop */\n\t\t\tif(!popup.is(\":visible\")) return;\n\n\t\t\t/* Set position to zeros to get max width and height */\n\t\t\tpopup.removeClass('hidden').css({left: 0, top: 0});\n\n\t\t\t/* Init */\n\t\t\tlet popupWidth  = popup.outerWidth(),\n\t\t\t\tpopupHeight = popup.outerHeight();\n\n\t\t\t/* Reset position */\n\t\t\tpopup.css({marginLeft: \"\", marginTop: \"\", width: \"\", left: \"\", top: \"\"});\n\n\t\t\t/* Init */\n\t\t\tlet win            = $(window),\n\t\t\t\treplaceOffset  = replace.offset(),\n\t\t\t\tpopupOffset    = popup.offset(),\n\t\t\t\tleftDifference = popupOffset.left - replaceOffset.left,\n\t\t\t\ttopDifference  = popupOffset.top - replaceOffset.top,\n\t\t\t\tmiddle         = false,\n\t\t\t\tvisible        = this.calculate();\n\n\t\t\t// Drop down\n\t\t\tif(visible.bottom + popupHeight >= visible.windowHeight)\n\t\t\t\tpopup.css(\"marginTop\", topDifference + visible.realHeight + 1);\n\t\t\t// Drop up\n\t\t\telse if(visible.top > popupHeight)\n\t\t\t\tpopup.css(\"marginTop\", -topDifference - 1);\n\t\t\t// Drop left\n\t\t\telse {\n\t\t\t\tpopup.css(\"marginTop\", -topDifference - (popupHeight - visible.realHeight) / 2);\n\t\t\t\tmiddle = true;\n\t\t\t}\n\n\n\t\t\t/* Set position */\n\t\t\tif(!middle) {\n\t\t\t\tif(visible.windowWidth > visible.left + popupWidth)\n\t\t\t\t\tpopup.css(\"marginLeft\", leftDifference);\n\t\t\t\telse\n\t\t\t\t\tpopup.css(\"marginLeft\", leftDifference - popupWidth + visible.width);\n\t\t\t} else {\n\n\t\t\t\tif(win.width() > selfOffset.left + popupWidth + selfWidth)\n\t\t\t\t\tpopup.css({\n\t\t\t\t\t\tmarginLeft: selfOffset.left - popupOffset.left + selfWidth\n\t\t\t\t\t});\n\t\t\t\telse\n\t\t\t\t\tpopup.css({\n\t\t\t\t\t\tmarginLeft: selfOffset.left - popupOffset.left - popupWidth\n\t\t\t\t\t});\n\n\t\t\t}\n\n\t\t}\n\t}\n\n})\n;","/**\n * Holds classes to work with modal/new windows\n */\nsky.service('windows', [\"templates\", \"callbacks\", \"stackList\"], function ({templates, callbacks, stackList}) {\n\n\tlet tips = false,\n\t\tlist = stackList(),\n\t\twindows = this.service = {\n\n\t\t\t/**\n\t\t\t * Returns last open window if any\n\t\t\t * @returns {windows.Modal|boolean}\n\t\t\t */\n\t\t\tgetLast: function () {\n\t\t\t\treturn list.last()\n\t\t\t},\n\n\t\t\t/**\n\t\t\t * Creates new modal window\n\t\t\t * @param {*} name Window name\n\t\t\t * @param {*} [data] Data to send with request\n\t\t\t */\n\t\t\tModal: function (name, data) {\n\n\t\t\t\t/* Self construct */\n\t\t\t\tif (!(this instanceof windows.Modal))\n\t\t\t\t\treturn new windows.Modal(name, data);\n\n\t\t\t\t/* Create window */\n\t\t\t\tthis.locked \t\t= false;\n\t\t\t\tthis.background \t= templates.render(\"windows-modal\", {}).appendTo(\"#pageContentHolder\").data(\"modalWindow\", this);\n\t\t\t\tthis.dataContainer \t= this.background.children();\n\t\t\t\tthis.holder \t\t= this.dataContainer.children(\".windowData\");\n\t\t\t\tthis.closeButton \t= this.dataContainer.children(\".close\");\n\n\t\t\t\t/* Make body un scrollable */\n\t\t\t\t$(document.body).css(\"overflow\", \"hidden\");\n\n\t\t\t\t/* Callbacks */\n\t\t\t\tthis.callbacks = callbacks();\n\n\t\t\t\t/* Render content */\n\t\t\t\ttry {\n\t\t\t\t\tthis.reRender(name, data);\n\t\t\t\t} catch (e) {\n\t\t\t\t\tthis.close(false);\n\t\t\t\t\tthrow e;\n\t\t\t\t}\n\n\t\t\t\t/* Return */\n\t\t\t\treturn this;\n\n\t\t\t}\n\n\t\t};\n\n\t/**\n\t * Modal window prototype\n\t */\n\twindows.Modal.prototype = {\n\n\t\t/**\n\t\t * Renders window content\n\t\t * @param {*} name Window name\n\t\t * @param {*} [data] Data to send with request\n\t\t */\n\t\treRender: function (name, data) {\n\n\t\t\t/* Close all tips */\n\t\t\tif(tips) tips.hideAll(true);\n\n\t\t\t/* Clear */\n\t\t\tthis.holder.html('');\n\n\t\t\t/* Render content */\n\t\t\tif (name instanceof jQuery)\n\t\t\t\tthis.template = name.appendTo(this.holder);\n\t\t\telse if (typeof name === \"string\")\n\t\t\t\tthis.template = templates.render(name, data).appendTo(this.holder);\n\n\t\t\t/* Self return */\n\t\t\treturn this;\n\t\t},\n\n\t\t/**\n\t\t * Removes all except that was rendered\n\t\t */\n\t\tclearExceptTemplate: function () {\n\t\t\tthis.holder.children().detach();\n\t\t\tthis.holder.append(this.template);\n\t\t},\n\n\t\t/**\n\t\t * Removes all except that was rendered\n\t\t */\n\t\tremoveMessages: function () {\n\t\t\tthis.holder.find(\".notificationMessage\").remove();\n\t\t\treturn this;\n\t\t},\n\n\t\t/**\n\t\t * Locks window so it can't be closed\n\t\t * @returns {windows.Modal}\n\t\t */\n\t\tlock: function (ajax) {\n\t\t\tthis.locked = true;\n\t\t\tthis.closeButton.hide();\n\t\t\tif (ajax) ajax\n\t\t\t\t.on(\"preSuccess\", function () {\n\t\t\t\t\tthis.dataContainer.css(\"height\", this.dataContainer.innerHeight());\n\t\t\t\t}, this)\n\t\t\t\t.on(\"notAbort\", function () {\n\t\t\t\t\tlet self = this;\n\t\t\t\t\tthis.unlock();\n\t\t\t\t\tthis.dataContainer.css(\"height\", this.holder.outerHeight());\n\t\t\t\t\tsetTimeout(function () {\n\t\t\t\t\t\tself.dataContainer.css(\"height\", \"\");\n\t\t\t\t\t}, 500)\n\t\t\t\t}, this)\n\t\t\t\t.on(\"abort\", function () {\n\t\t\t\t\tthis.unlock().close();\n\t\t\t\t}, this);\n\t\t\treturn this;\n\t\t},\n\n\t\t/**\n\t\t * Unlocks window so it can be closed\n\t\t * @returns {windows.Modal}\n\t\t */\n\t\tunlock: function () {\n\t\t\tthis.locked = false;\n\t\t\tthis.closeButton.show();\n\t\t\treturn this;\n\t\t},\n\n\t\t/**\n\t\t * Closes current window\n\t\t * @param {boolean} [byUser] Indicates that window was closed not by user\n\t\t */\n\t\tclose: function (byUser = false) {\n\n\t\t\t/* If windows is locked */\n\t\t\tif (this.locked)\n\t\t\t\treturn;\n\n\t\t\t/* Remove elements */\n\t\t\tthis.background.fadeOut(\"fast\", function () {\n\t\t\t\t$(this).remove()\n\t\t\t});\n\n\t\t\t/* Delete from list */\n\t\t\tlist.remove(this);\n\n\t\t\t/* Call close callback */\n\t\t\tthis.callbacks.fire(\"close\", {byUser: byUser});\n\n\t\t\t/* Close all tips */\n\t\t\tif(tips) tips.hideAll(true);\n\n\t\t\t/* Make body scrollable */\n\t\t\tif (list.total() < 1)\n\t\t\t\t$(document.body).css(\"overflow\", \"\");\n\n\t\t\treturn this;\n\n\t\t}\n\n\t};\n\n\ttry {\n\t\ttips = sky.service(\"tips\");\n\t} catch (e) {}\n\n\t/* Add handler to black area click */\n\t$(document)\n\t\t.on(\"keyup\", sky.func(function (event) {\n\t\t\tlet last;\n\n\t\t\t/* If slide show was disabled */\n\t\t\tif (document[\"webkitIsFullScreen\"] || document[\"mozIsFullScreen\"] || document[\"isFullScreen\"])\n\t\t\t\treturn;\n\n\t\t\t/* Close current window */\n\t\t\tif (event.keyCode === 27 && (last = windows.getLast()))\n\t\t\t\tlast.close(true);\n\n\t\t}));\n\n});","sky.action(\"pagination\", {\n\n\tsetPage: function(button, _, page) {\n\n\t\t/* Get pagination */\n\t\tlet pagination = button.parents(\".pagination\").data(\"pagination\");\n\n\t\t/* Correct page */\n\t\tif(page === \"next\")\n\t\t\tpage = pagination.current + 1;\n\n\t\t/* Correct  */\n\t\tif(page === \"previous\")\n\t\t\tpage = pagination.current - 1;\n\n\t\t/* Go to page */\n\t\tpagination.goToPage(page);\n\n\t},\n\n\tscrollTo: function(element, event) {\n\n\t\t/* Get pagination */\n\t\tlet pagination = element.parents(\".pagination\").data(\"pagination\");\n\n\t\t/* Move */\n\t\tpagination.scroll(event);\n\n\t},\n\n\tgrab: function(runner) {\n\n\t\t/* Get pagination */\n\t\tlet pagination = runner.parents(\".pagination\").data(\"pagination\");\n\n\t\t/* Binds */\n\t\t$(window)\n\t\t\t.on(\"mouseup.pagination\", function() {\n\t\t\t\t$(window).off(\"mouseup.pagination mousemove.pagination\");\n\t\t\t}).on(\"mousemove.pagination\", function(event) {\n\t\t\t\tpagination.scroll(event);\n\t\t\t});\n\n\t},\n\n\tnext: function(button, _) {\n\t\tthis.setPage(button, _, \"next\")\n\t},\n\n\tprevious: function(button, _) {\n\t\tthis.setPage(button, _, \"previous\")\n\t}\n\n});","sky.action(\"selectReplace\", function({ visibleCalculator }) {\n\n    let filter = function(self, event) {\n\n        /* Get drop */\n        let popup  = self.closest(\".selectReplaceChoose\"),\n            inputs = popup.find(\"input[name]\");\n\n        /* On enter */\n        if(event.which === 13) {\n            let visible = popup.find(\"label:visible\");\n            if(visible.length > 0) {\n                inputs.prop(\"checked\", false);\n                visible.children(\"input\").prop(\"checked\", true).trigger(\"change\");\n            }\n            event.stopPropagation();\n        }\n\n        /* Get value */\n\t\tlet value = self.val(),\n\t\t\t rus              = \"\",\n             eng              = \"qwertyuiop[]asdfghjkl;'\\\\zxcvbnm,.\",\n             expression       = new RegExp(value.toLowerCase()),\n             expressionInvert = new RegExp(value.toLowerCase().replace(/[a-z-]/g, (character) => {\n                if(rus.indexOf(character) > -1) return eng[rus.indexOf(character)];\n                if(eng.indexOf(character) > -1) return rus[eng.indexOf(character)];\n                return character;\n            }));\n\n        /* Hide */\n        for(let input of inputs) {\n\n            if(input.parent().hasClass('hidden'))\n                return;\n\n            let inputHtml = input.next().html().toLowerCase();\n\n            try {\n                if(!inputHtml.match(expression) && !inputHtml.match(expressionInvert)) input.parent().hide();\n                else input.parent().show();\n            } catch(e) {}\n\n        }\n    };\n\n    return {\n\n        filter: filter,\n\n        selectAll: function(button) {\n\n            /* Get drop */\n            let popup = button.closest(\".selectReplaceChoose\");\n            popup.find(\":checkbox:visible\").prop(\"checked\", true).first().trigger(\"change\");\n\n        },\n\n        unSelectAll: function(button) {\n\n            /* Get drop */\n            let popup = button.closest(\".selectReplaceChoose\");\n            popup.find(\":checkbox:visible\").prop(\"checked\", false).first().trigger(\"change\");\n\n        },\n\n        close: function(element, event) {\n            if(element.get(0) === event.target)\n                $(\".selectReplaceChoose\").addClass('hidden');\n        },\n\n\t\tshowTip: function(label) {\n\n\t\t\tlet originalTip = label.find(\".checkItemTip\");\n\n\t\t\t/* If no tip element or tip already shown */\n\t\t\tif(!originalTip.length || label.data(\"tip\"))\n\t\t\t    return;\n\n            let popup = label.closest(\".selectReplaceChoose\");\n            let tip = originalTip.clone().removeClass(\"hidden\").appendTo(\"body\");\n            tip.css({\n                left: popup.offset().left,\n                top : popup.offset().top + popup.outerHeight() + 5\n            });\n            label.data(\"tip\", tip);\n\n\n\t\t},\n\n        hideTip: function(label) {\n\t\t\tif(!label.data(\"tip\"))\n\t\t\t    return;\n            label.data(\"tip\").remove();\n            label.removeData(\"tip\");\n\t\t},\n\n        /**\n         * Shows drop down\n         * @param replace Input\n         */\n        drop: function (replace) {\n\n            /* Hide all */\n\t\t\t$(\".selectReplaceChoose\").addClass('hidden');\n\n            /* Get drop */\n            let popup = replace.next(),\n                dropOffset = (new visibleCalculator).getDropOffset(replace, popup);\n\n\t\t\t/* If visible just hide */\n\t\t\tif(dropOffset) {\n\t\t\t\tpopup.removeClass('hidden').css({ marginLeft: dropOffset.left, margintop: dropOffset.top });\n\n\t\t\t\tif(replace.outerWidth() > popup.outerWidth())\n\t\t\t\t\tpopup.css(\"width\", replace.outerWidth());\n\n                /* Search focus */\n\t\t\t\tif (popup.find(\".search\").length)\n\t\t\t\t\tpopup.find(\".search input\").val('').focus();\n\n            }\n\n        },\n\n        change: function(element, event) {\n\n\t\t\t/* Get inputs */\n\t\t\tlet popup = element.closest(\".selectReplaceChoose\"),\n\t\t\t\tinputs = popup.find(\"input:radio, input:checkbox\"),\n\t\t\t\tcurrent, change, children = false, replace = popup.prev(),\n\t\t\t\tval = \"\",\n\t\t\t\tdefaultValue = replace.html() || '-',\n\t\t\t\tdefaultAllValue = replace.text() || \"\";\n\n\t\t\t/* Un select all */\n\t\t\tpopup.find(\"label\").removeClass(\"selected\");\n\n            /* Get checked */\n\t\t\tlet filtered = inputs.filter(\":checked\").each(function() {\n\t\t\t\tcurrent = $(this);\n\t\t\t\tcurrent.closest(\"label\").addClass(\"selected\");\n\t\t\t\tchildren = current.next();\n\t\t\t\tval = (val && val + \", \") + children.text();\n\t\t\t});\n\n            /* Make text shorter */\n\t\t\tif(val.length > 26)\n\t\t\t\tval = val.substr(0, 26).trim() + \"...\";\n\n\t\t\t/* If all checked */\n\t\t\tif(filtered.length === inputs.length && !popup.hasClass(\"single\"))\n\t\t\t\tval = defaultAllValue;\n\n\t\t\t/* Set input html */\n\t\t\tif(popup.hasClass(\"single\") && children)\n\t\t\t\treplace.html('').prepend(children.clone().removeClass(\"name\"));\n\t\t\telse if(!children)\n\t\t\t\treplace.html(defaultValue);\n\t\t\telse\n\t\t\t\treplace.text(val);\n\n            /* If not fake event */\n\t\t\tif(event && current)\n\t\t\t\treplace.trigger(\"change\", { value: current.val(), item: element });\n\n\t\t\t/* Hide on single-select */\n\t\t\tif(popup.hasClass(\"single\"))\n\t\t\t\tpopup.addClass('hidden');\n\n        }\n\n    }\n});","sky.directive(\".selectReplaceChoose\", function(popup, attrs) {\r\n\r\n\t\t/* Get inputs */\r\n\t\tlet labels = popup.find(\"label\"),\r\n\t\t\tinputs = popup.find(\"input:radio, input:checkbox\"),\r\n\t\t\tcurrent, change, children, replace = popup.prev(),\r\n\t\t\tval = \"\",\r\n            defaultValue = replace.html() || '-',\r\n            defaultAllValue = replace.text() || \"\";\r\n\r\n\t\treplace.data(\"addItem\", function(item) {\r\n\t\t\tlet newInput = sky.templates.renderByText(\"{% skyImport forms as forms %}{{ forms.selectReplaceGroup(items, options) }}\", { items: [item], options: {\r\n\t\t\t\tname: replace.attr(\"input\"),\r\n\t\t\t\tmultiple:  !replace.hasClass(\"single\")\r\n\t\t\t}});\r\n\t\t\tnewInput.insertAfter(inputs.filter(\":last\").parent());\r\n\t\t\tinputs = popup.find(\"input\");\r\n\t\t});\r\n\r\n\t\t/* On change */\r\n\t\t$(document).on(\"change\", '[data-input=\"'+ attrs[\"data-input\"] + '\"] input', change = function(event, data) {\r\n\r\n\t\t\t/* Remove selected styles */\r\n\t\t\tlabels.removeClass(\"selected\");\r\n\r\n\t\t\t/* Base text */\r\n\t\t\tval = \"\";\r\n\t\t\tchildren = false;\r\n\r\n\t\t\t/* Get checked */\r\n\t\t\tlet filtered = inputs.filter(\":checked\").each(function() {\r\n\t\t\t\tcurrent = $(this);\r\n\t\t\t\tcurrent.closest(\"label\").addClass(\"selected\");\r\n\t\t\t\tval = (val && val + \", \") + current.next().text();\r\n\t\t\t\tchildren = current.next();\r\n\t\t\t});\r\n\r\n\t\t\t/* Make text shorter */\r\n\t\t\tif(val.length > 26)\r\n\t\t\t\tval = val.substr(0, 26).trim() + \"...\";\r\n\r\n\t\t\tif(filtered.length === inputs.length && !popup.hasClass(\"single\"))\r\n\t\t\t\tval = defaultAllValue;\r\n\r\n\t\t\tif(popup.hasClass(\"single\") && children)\r\n\t\t\t\treplace.html('').prepend(children.clone().removeClass(\"name\"));\r\n\t\t\telse if(!children)\r\n\t\t\t\treplace.html(defaultValue);\r\n\t\t\telse\r\n\t\t\t\treplace.text(val);\r\n\r\n\t\t\t/* If not fake event */\r\n\t\t\tif(event && current) {\r\n                replace.trigger(\"change\", $.extend(data || {}, {\r\n                    value: current.val(),\r\n                    item: $(this)\r\n                }));\r\n            }\r\n\r\n            if(popup.hasClass(\"single\"))\r\n\t\t\t\t$(\".selectReplaceChoose\").addClass('hidden');\r\n\t\t});\r\n\r\n\t\t/* Trigger */\r\n\t\tsetTimeout(function() { change(false) }, 1);\r\n\r\n\t});\r\n\r\nsky.onReady(() => {\r\n\t$(document).on(\"click touchstart\", function(event) {\r\n\r\n\t\t/* Get element */\r\n\t\tlet element = $(event.target || event.srcElement);\r\n\r\n\r\n\t\t/* If click in replace we should not hide it */\r\n\t\tif(element.closest(\".selectReplaceChoose\").length || element.closest(\".selectReplace\").length)\r\n\t\t\treturn;\r\n\r\n\t\t/* Hide all */\r\n\t\t$(\".selectReplaceChoose\").addClass('hidden');\r\n\r\n\t})\r\n});\r\n","sky.action(\"suggest\", function(suggester) {\r\n   return {\r\n       adverts: function(input, event) {\r\n\r\n           // Events\r\n           if(event.keyCode == 38 || event.keyCode == 40 || event.keyCode == 13 || event.keyCode == 27)\r\n               return;\r\n\r\n           // Stop if any other\r\n           if(this.suggestAjax)\r\n               this.suggestAjax.stop();\r\n\r\n           // Nothing\r\n           if(input.val() == \"\" || input.val().length < 2) {\r\n               suggester.hideAll();\r\n               return;\r\n           }\r\n\r\n           this.suggestAjax = sky.ajax(\"/ajax/members/search\", { name: input.val() })\r\n               .on(\"success\", function(response) {\r\n\r\n                   // No filtered\r\n                   if(!response.adverts || !response.adverts.length)\r\n                       suggester.hideAll();\r\n\r\n                   var filtered = [];\r\n\r\n                   $.each(response.adverts, function(_, advert) {\r\n                       filtered.push(advert.username);\r\n                   });\r\n\r\n                   // Show\r\n                   suggester.show(input, filtered);\r\n\r\n               }).on(\"error\", function() {\r\n                   suggester.hideAll();\r\n               });\r\n\r\n       },\r\n\r\n       campaigns: function(input, event){\r\n\r\n           // Events\r\n           if(event.keyCode == 38 || event.keyCode == 40 || event.keyCode == 13 || event.keyCode == 27)\r\n               return;\r\n\r\n           // Stop if any other\r\n           if(this.suggestAjax)\r\n               this.suggestAjax.stop();\r\n\r\n           // Nothing\r\n           if(input.val() == \"\" || input.val().length < 2) {\r\n               suggester.hideAll();\r\n               return;\r\n           }\r\n\r\n           this.suggestAjax = sky.ajax(\"/ajax/campaigns/search\", { name: input.val() })\r\n               .on(\"success\", function(response) {\r\n\r\n                   // No filtered\r\n                   if(!response.campaigns || !response.campaigns.length)\r\n                       suggester.hideAll();\r\n\r\n                   var filtered = [];\r\n\r\n                   $.each(response.campaigns, function(_, campaign) {\r\n\r\n                       filtered.push({ html: campaign.name });\r\n                   });\r\n\r\n                   // Show\r\n                   suggester.show(input, filtered);\r\n\r\n               }).on(\"error\", function() {\r\n                   suggester.hideAll();\r\n               });\r\n       },\r\n\r\n       campaignsSpecial: function(input, event){\r\n           // Events\r\n           if(event.keyCode == 38 || event.keyCode == 40 || event.keyCode == 13 || event.keyCode == 27)\r\n               return;\r\n\r\n           // Nothing\r\n           if(input.val() == \"\" || input.val().length < 2) {\r\n               suggester.hideAll();\r\n               return;\r\n           }\r\n\r\n           if(this.suggestAjax)\r\n               this.suggestAjax.stop();\r\n\r\n           this.suggestAjax = sky.ajax(\"/ajax/campaigns/search\", { name: input.val() })\r\n               .on(\"success\", function(response) {\r\n\r\n                   // No filtered\r\n                   if(!response.campaigns || !response.campaigns.length)\r\n                       suggester.hideAll();\r\n\r\n                   var filtered = [];\r\n\r\n                   $.each(response.campaigns, function(_, campaign) {\r\n\r\n                       filtered.push({ html: campaign.name+\" (\"+campaign.advert.username+\")\", callback: function(){\r\n                           sky.actions.perform(null, null, \"page.selectCampaign\", [campaign.id]);\r\n                       }});\r\n                   });\r\n\r\n                   // Show\r\n                   suggester.show(input, filtered);\r\n\r\n               }).on(\"error\", function() {\r\n                   suggester.hideAll();\r\n               });\r\n       }\r\n   }\r\n});","sky.directive(\"[data-suggests]\", function(element, attributes) {\n\telement.attr(\"data-event\", \"keyup: suggest.\" + attributes[\"data-suggests\"]).attr(\"autocomplete\", \"off\");\n});","sky.action(\"tips\", {\n\n\tshowTip: function (button, _, name) {\n\n\t\tif (button.data(\"tip\")) {\n\t\t\tbutton.data(\"tip\").hide();\n\t\t\treturn;\n\t\t}\n\n\t\t// Hide others\n\t\tsky.actions.perform(button, false, \"shared.hideTips\", [name]);\n\n\t\t// Create\n\t\tlet tip = sky.tips.Tip(\"bottom\", button, {\n\t\t\tcreate: $('<div/>').css(\"overflow\", \"hidden\").append($(\"#\" + name + \"TipText\").html())\n\t\t});\n\n\t\t// Show\n\t\ttip.show();\n\n\t},\n\n\tshowTipWithText: function (button, _, text) {\n\n\t\tif (button.data(\"tip\")) {\n\t\t\tbutton.data(\"tip\").hide();\n\t\t\treturn;\n\t\t}\n\n\t\t// Hide others\n\t\tsky.actions.perform(button, false, \"shared.hideTips\");\n\n\t\t// Create\n\t\tlet tip = sky.tips.Tip(\"bottom\", button, {\n\t\t\tcreate: $('<div/>').css(\"overflow\", \"hidden\").append(text)\n\t\t});\n\n\t\t// Show\n\t\ttip.show();\n\n\t},\n\n\thideTips: function (element, event) {\n\t\tlet target;\n\n\t\tif (event && event.target) {\n\t\t\ttarget = $(event.target);\n\t\t\tif (target.is(\"[sky-tip]\") || target.is(\"[sky-tip-text]\") || target.closest(\".tipContent\").length)\n\t\t\t\treturn;\n\t\t}\n\n\t\tsky.tips.hideAll();\n\n\t},\n\n\t/**\n\t *\n\t */\n\tforceHideTips: function () {\n\t\tsky.tips.hideAll(true);\n\t}\n});","sky.directive(\"[data-tip]\", function(button, attributes) {\n\n\t// Get\n\tlet events  = attributes[\"data-event\"] || \"\",\n\t\ttipName = attributes[\"data-tip\"],\n\t\tevent   = \"click: shared.showTip('\" + tipName + \"')\";\n\n\t// Set new\n\tevents = events ? event : events + \"; \" + event;\n\n\t// Add\n\tbutton.attr(\"data-event\", events).addClass(\"dashed\");\n\n});\nsky.directive(\"[data-tip-text]\", function(button, attributes) {\n\n\t// Get\n\tlet events  = attributes[\"data-event\"] || \"\",\n\t\ttipText = attributes[\"data-tip-hover\"] || attributes[\"data-tip-text\"],\n\t\tevent   = \"click: shared.showTipWithText('\" + tipText + \"')\";\n\n\t// Set new\n\tevents = events ? event : events + \"; \" + event;\n\n\t// Add\n\tbutton.attr(\"data-event\", events).addClass(\"dashed\");\n\n});\nsky.directive(\"[data-tip-hover]\", function(button, attributes) {\n\n\t// Get\n\tlet tipText = attributes[\"data-tip-hover\"];\n\n\tsky.service(\"tips\").bind(button, \"top\", {create: tipText});\n\n\t// Set new\n\tlet events = attributes[\"data-event\"] || \"\",\n\t\tevent  = \"click: shared.showTipWithText('\" + tipText + \"')\";\n\tevents = events ? event : events + \"; \" + event;\n\n\t// Add\n\tbutton.attr(\"data-event\", events).addClass(\"dashed\");\n\n});","/**\n * Fire services init done\n */\nsky.exec(function() {\n\tsky.servicesDeferred.resolve();\n});","sky.directive(\"input.autoHttp\", function(input) {\n\tinput.on(\"focus\", function() {\n\t\tif(input.val() === \"\") input.val(\"http://\").get(0).selectionStart = 7;\n\t});\n});","/**\n * Fire project init done\n */\nsky.exec(function() {\n    document.body.classList.remove(\"hidden\");\n    sky.projectDeffered.resolve();\n});"]}