{"version":3,"sources":["actions/actions.js","ajax/ajax.js","ajaxFiles/ajaxFiles.dropZone.js","ajaxFiles/ajaxFiles.iframe.js","ajaxFiles/ajaxFiles.js","ajaxFiles/ajaxFiles.xhr.js","calendar/calendar.js","callbacks/callback.js","callbacks/callbacks.js","dataOperator/dataOperator.js","dataOperator/inputsIO.js","directives/directives.js","drag/drag.js","history/history.js","localStorage/localStorage.js","models/models.js","models/modelsManager.js","models/modelsStorage.js","notifications/notifications.js","pagination/pagination.js","stacklist/stacklist.js","suggester/suggester.js","supported/supported.js","templates/templates.js","tips/tips.js","utils/utils.js","validator/validator.js","visibleCalculator/visibleCalculator.js","windows/windows.js","pagination/actions/paginationActions.js","selectReplace/actions/selectReplace.js","selectReplace/directives/select.js","suggester/actions/suggests.js","suggester/directives/suggests.js","tips/actions/tips.js","tips/directives/tips.js","servicesInit.js","shared.js","projectInit.js"],"names":["sky","service","_ref","exceptions","list","actions","this","perform","element","event","action","options","params","match","split","$","each","i","val","eval","trim","extend","self","path","current","name","isDisabled","elem","length","system","Error","apply","concat","add","events","safe","_typeof","fn","selector","on","data","call","document","_this","skyEvent","getAttribute","indexOf","type","preventDefault","map","eventString","parts","target","get","callbacks","url","_ref2","_ref2$object","object","undefined","_ref2$callbackData","callbackData","_ref2$ajaxExtend","ajaxExtend","filter","disable","ajaxCallbacks","stop","ajax","abort","dataType","timeout","success","response","textStatus","jqXHR","error","text","fire","errorThrown","errorText","responseText","status","codes","code","promise","always","enable","400","401","402","403","404","405","406","407","408","409","410","411","412","413","414","415","416","417","422","423","424","425","426","428","429","431","451","456","499","500","501","502","503","504","505","506","507","508","509","510","511","supported","_class","zone","_classCallCheck","files","XHRIsSupported","attachEvents","_createClass","key","value","dragenter","dragleave","dragend","drop","dragover","originalEvent","isValidFileDrag","effect","dataTransfer","effectAllowed","dropEffect","bind","e","onStart","dt","isWebkit","navigator","userAgent","types","contains","ajaxFilesXHR","ajaxFilesIFrame","AjaxFiles","input","inputs","saveFiles","XHRUpload","_iteratorNormalCompletion","_didIteratorError","_iteratorError","_step","_iterator","Symbol","iterator","next","done","file","push","inputName","attr","err","return","send","parallel","_","handler","sendParallel","sendConsequentially","_this2","id","_iteratorNormalCompletion2","_didIteratorError2","_iteratorError2","_step2","_iterator2","defaultSend","is","closest","find","templates","notifications","windows","filesAjax","modal","getLast","currentFile","holder","remove","lock","render","insertAfter","parent","unlock","clearExceptTemplate","message","appendToModal","totalPercent","percent","html","css","stackList","toProceed","inProgress","total","totalLoaded","totalSize","fileRequests","size","Math","random","getName","loaded","queryString","jQuery","param","args","formData","form","FormData","append","processData","contentType","xhr","XMLHttpRequest","upload","toFixed","onProgress","beforeSend","func","setRequestHeader","encodeURI","all","notSuccess","delete","fileRequestData","request","replace","calendar","monthsNames","window","page","renderDays","moment","date","weeks","currentWeek","month","day","number","isoWeek","days","clone","dateStr","format","dates","period","since","till","setTime","dayPick","dayDiv","notClose","parseInt","field","getInputValue","trigger","close","useTime","isSame","setDayPick","pickedDateView","position","marginTop","marginLeft","offset","top","outerHeight","left","periodChangeDay","reset","lastModified","isBefore","isAfter","markSelected","removeClass","addClass","changeDay","hour","minute","changeYear","year","yearView","changeMonth","monthView","getDatePeriod","dateString","getDate","off","show","showTime","lastPicked","subtract","dateOriginal","elementFromPoint","clientX","touches","clientY","onReady","srcElement","parents","keyCode","calendars","Callback","flags","functions","toRun","context","prototype","once","removeByContext","splice","removeByCallback","fireNext","result","callback","Callbacks","advancedCallbacks","callbacksFlags","removeListener","listener","Object","getEventsNames","slice","possible","names","elements","j","join","arguments","inputsIO","utils","searchField","virtual","default","Array","isObjectsEqual","searchRead","hashRead","readInputsValues","writeInputsValue","hashValue","history","hashObject","searchValue","searchObject","baseOptions","fields","historyType","DataOperator","lastRequestData","beforeRequest","setOptions","onFormSubmit","validForm","force","reload","set","search","fromUrl","readSearch","writeForm","readHash","read","writeHash","writeSearch","prepareRequest","lastResponse","loading","reloadContent","item","fieldsList","valueOrNullOnDefault","write","fieldName","substring","initOperator","initLoader","loader","pagination","_ref2$reload","_ref2$history","pages","onPageChange","pageNum","searchChanged","hashChanged","readInputValue","valuesNamed","valuesLined","writeInputValue","prop","first","notByUser","values","directives","directive","getAttributes","attributes","nodeName","nodeValue","parseElement","jsonScript","children","json","JSON","parse","tag","parseDirectives","bindEvents","start","move","started","button","x","pageX","y","pageY","History","hashString","searchString","pathString","intervalId","base","navigate","location","pathname","substr","pushState","oldPath","newPath","getWindowSearch","hash","change","hashDifference","searchDifference","old","getWindowHash","getDifference","rebuild","pathChanged","setHash","setSearch","changed","decodeURIComponent","proxy","stringFromObject","obj","getObjects","paramsString","objects","subStrings","str","keyAndValue","string","stored","getObjectsDifference","second","difference","localDiff","returnArray","decodeURI","onpopstate","setInterval","time","LocalStorage","prefix","fullName","itemPrefix","ids","onLoad","localStorage","getItem","storage","parseJSON","itemsIds","items","getIds","load","setItem","stringify","console","log","index","models","save","removeItem","modelsStorage","modelsDefinition","BaseDefinition","Model","definition","creation","extension","model","addDefinition","fromData","cached","Manager","arr","fromArray","cache","visibleCalculator","tips","Modal","tip","align","Tip","create","loadings","global","appendTo","click","hide","inModalWindow","content","contentHolder","calc","setPosition","calculate","width","height","setHolder","reCalculate","instance","init","services","Pagination","_ref2$current","pageWidth","last","dimensions","startPage","lastStartPage","pagesVisible","pagesInvisible","scrollAvailable","scrollStart","tumbler","dom","slider","back","forward","redraw","goToPage","newPage","floor","innerWidth","toShow","drawPages","createScroll","scrollLine","runner","scroll","outerWidth","pos","List","lastId","hasOwnProperty","single","suggester","lastList","removeData","elementPosition","renderPosition","margin-left","margin-top","selected","prev","fullScreen","templatesList","templatesCompiled","Templates","globals","template","renderWithHolder","noDirectives","compile","temp","renderToText","renderByText","twig","renderByTextToText","compiled","fromLS","cookie","hideAll","withoutAutoHide","autoHide","mouseenter","mouseleave","_ref2$autoHide","_ref2$create","_ref2$close","_ref2$ajax","_ref2$highlight","highlight","insertBefore","shadow","opacity","background","closeTimeout","setTimeout","display","animate","fadeOut","fadeIn","blur","clearTimeout","what","addLeadingZero","encode","rawStr","charCodeAt","jsonData","prepareSelectData","_ref$columnSplitOn","columnSplitOn","_ref$maxColumns","maxColumns","columns","columnsCount","groupHolder","perColumn","ceil","column","groups","validator","validateForm","validationRule","addRule","validateElement","pass","shouldBeValidated","Options","totalPass","firstError","lastSuccess","firstSuccess","rules","ruleOverload","compiledRule","Rule","validate","onSuccess","onError","rule","ruleDefaults","optionsDefaults","errorClass","successClass","overload","required","requiredIfFilled","email","same","regexp","RegExp","numeric","positive","parseFloat","max","min","minLength","maxLength","getDeclaredRules","Calculator","minHeight","scrollable","holderRect","scrollTop","windowHeight","windowWidth","sizes","right","realHeight","scrollLeft","bottom","popup","popupWidth","popupHeight","win","replaceOffset","popupOffset","leftDifference","topDifference","middle","visible","selfOffset","selfWidth","locked","dataContainer","closeButton","body","reRender","detach","removeMessages","innerHeight","byUser","setPage","scrollTo","grab","previous","which","stopPropagation","rus","eng","expression","toLowerCase","expressionInvert","character","hasClass","inputHtml","selectAll","unSelectAll","dropOffset","getDropOffset","margintop","focus","attrs","labels","defaultValue","defaultAllValue","multiple","filtered","prepend","root","label","originalTip","adverts","suggestAjax","advert","username","campaigns","campaign","campaignsSpecial","showTip","showTipWithText","hideTips","forceHideTips","tipText","exec","servicesDeferred","resolve","closeWindow","submit","clearForm","changeOrder","orderField","order","table","trs","cell1","cell2","convert","sort","firstTr","secondTr","val1","val2","isNaN","changeOrderReload","currentLoader","selectionStart","classList","projectDeffered"],"mappings":"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","file":"project.js","sourcesContent":["sky.service(\"actions\", [\"exceptions\"], function ({exceptions}) {\n\n\tlet list = {},\n\t\tactions = this.service = {\n\n\t\t\t/**\n\t\t\t * Performs action\n\t\t\t * @param element\n\t\t\t * @param event\n\t\t\t * @param action\n\t\t\t * @param {Array} [options]\n\t\t\t */\n\t\t\tperform: function (element, event, action, options) {\n\n\t\t\t\t/* Get parameters */\n\t\t\t\tlet params = action.match(/(.+)\\((.*)\\)/);\n\n\t\t\t\t/* Parse */\n\t\t\t\tif (params) {\n\n\t\t\t\t\t/* Get function */\n\t\t\t\t\taction = params[1];\n\n\t\t\t\t\t/* Parse params */\n\t\t\t\t\tparams = params[2].split(\",\");\n\t\t\t\t\t$.each(params, function (i, val) {\n\t\t\t\t\t\tparams[i] = eval(val.trim());\n\t\t\t\t\t})\n\t\t\t\t}\n\n\t\t\t\t/* Options */\n\t\t\t\tif (options)\n\t\t\t\t\tparams = $.extend(params || [], options);\n\n\t\t\t\t/* Get */\n\t\t\t\tlet self = element ? $(element) : false,\n\t\t\t\t\tpath = action.split(\".\"),\n\t\t\t\t\tcurrent = list,\n\t\t\t\t\tname = action;\n\n\t\t\t\t/* If disabled */\n\t\t\t\tif (self && self.isDisabled && self.isDisabled())\n\t\t\t\t\treturn;\n\n\t\t\t\t$.each(path, function (i, elem) {\n\n\t\t\t\t\t/* Search */\n\t\t\t\t\tif (i + 1 < path.length && !current[elem])\n\t\t\t\t\t\tthrow new exceptions.system.Error(\"No action - \" + action + \", because can't find '\" + elem + \"'\");\n\n\t\t\t\t\t/* Get new elem */\n\t\t\t\t\tif (i + 1 < path.length)\n\t\t\t\t\t\tcurrent = current[elem];\n\n\t\t\t\t\t/* Save name */\n\t\t\t\t\tname = elem;\n\n\t\t\t\t});\n\n\t\t\t\t/* If no */\n\t\t\t\tif (!current[name])\n\t\t\t\t\tthrow new exceptions.system.Error(\"No action - \" + action);\n\n\t\t\t\t/* Call */\n\t\t\t\tcurrent[name].apply(current, [self, event].concat(params || []));\n\n\t\t\t},\n\n\t\t\t/**\n\t\t\t * Adds actions to list\n\t\t\t * @param name Group name\n\t\t\t * @param events List\n\t\t\t */\n\t\t\tadd: function (name, events) {\n\n\t\t\t\tif (typeof events === \"function\")\n\t\t\t\t\tevents = events.safe(true)();\n\n\t\t\t\t// Check\n\t\t\t\tif (!events || typeof events !== 'object')\n\t\t\t\t\tthrow new exceptions.system.Error(\"No event object for events '\" + name + \"' provided\");\n\n\t\t\t\t// Save\n\t\t\t\tlist[name] = $.extend(list[name] || {}, events);\n\n\t\t\t}\n\n\t\t};\n\n\n\t/**\n\t * Adds special bind function\n\t * @param {string} name Event name\n\t * @param {*} selector Selector string\n\t * @param {function} [action] Action function\n\t * @returns {jQuery}\n\t */\n\t$.fn.action = function(name, selector, action) {\n\n\t\t/* Parameters skip */\n\t\tif(typeof action === \"undefined\") { action = selector; selector = null; }\n\n\t\t/* Bind */\n\t\treturn this.on(name, selector, function(event, data) {\n\t\t\taction.call(this, event, $(this), data);\n\t\t}.safe());\n\t};\n\n\t/*\n\t * Bind declarative events\n\t */\n\t$(document).action(\"click submit keyup keydown dblclick mouseover mouseout mouseleave mouseenter change mousedown mouseup touchstart\", '[data-event]', function (event, self, data) {\n\n\t\t/* Get string */\n\t\tlet skyEvent = this.getAttribute(\"data-event\");\n\n\t\t/* If no such event in data-event attribute */\n\t\tif (skyEvent.indexOf(event.type) === -1)\n\t\t\treturn;\n\n\t\t/* If disabled */\n\t\tif (self.isDisabled && self.isDisabled()) {\n\t\t\tevent.preventDefault();\n\t\t\treturn;\n\t\t}\n\n\t\tskyEvent.split(\";\").map(eventString => {\n\n\t\t\t/* Get elements */\n\t\t\tlet parts = eventString.match(/(\\w+):(.*)/);\n\n\t\t\t/* Wrong */\n\t\t\tif (parts.length !== 3)\n\t\t\t\tthrow new exceptions.system.Error(\"Wrong action format in data-event: \" + eventString);\n\n\t\t\t/* Get elements */\n\t\t\tlet name = parts[1].trim(),\n\t\t\t\taction = parts[2].trim();\n\n\t\t\t/* Another event */\n\t\t\tif (name !== event.type)\n\t\t\t\treturn;\n\n\t\t\t/* No default go */\n\t\t\tif (event.target === self.get(0))\n\t\t\t\tevent.preventDefault();\n\n\t\t\t/* Passed data */\n\t\t\tevent.data = data;\n\n\t\t\t/* Perform action */\n\t\t\tactions.perform(this, event, action);\n\n\t\t});\n\n\t});\n\n});","sky.service(\"ajax\", [\"callbacks\"], function({ callbacks }) {\n\n\t/**\n\t * Advanced ajax execution\n\t * To abort call stop() method instead of abort() because it's used for abort callback set, or .ajax.abort()\n\t * You may skip type, don't skip it if lock is string set false in object and data\n\t * @param {string} url\t\t\t\tRequested url\n\t * @param {object} [data]\t\t\tHolds request parameters\n\t * @param {jQuery} [object]\t\t\tObject which performs request, to disable it during request\n\t * @param {object} [ajaxExtend]\t\tAdditional ajax options, see http://api.jquery.com/jQuery.ajaxSetup/\n\t * @param {object} [callbackData]\tAdditional params that passed to any callback\n\t */\n\tthis.service = function(url, data, { object = null, callbackData = {}, ajaxExtend = {} }) {\n\n\t\t/* Lock button */\n\t\tif(object)\n\t\t\tobject = $(object).filter(\":not(.disabled)\").disable();\n\n\t\t/* New object to store callbacks */\n\t\tlet ajaxCallbacks = new callbacks();\n\t\tajaxCallbacks.stop = function() { ajaxCallbacks.ajax.abort(); };\n\n\t\t/* Perform ajax request */\n\t\tajaxCallbacks.ajax = $.ajax($.extend(true, {\n\n\t\t\t/* Set base options */\n\t\t\turl     \t: url,\n\t\t\tdata    \t: data,\n\t\t\tdataType\t: \"json\",\n\t\t\ttype    \t: \"post\",\n\t\t\ttimeout\t\t: 480 * 1000,\n\t\t\tsuccess: function(response, textStatus, jqXHR) {\n\n\t\t\t\t/* Possible params list */\n\t\t\t\tlet params = $.extend({ jqXHR: jqXHR, textStatus: textStatus, object: object }, callbackData);\n\n\t\t\t\t/* If empty response */\n\t\t\t\tif(response === null) {\n\t\t\t\t\tparams.error = \"  \";\n\t\t\t\t\tparams.type = \"noData\";\n\t\t\t\t}\n\n\t\t\t\t/* If response returned with error */\n\t\t\t\tif(response.error) {\n\t\t\t\t\tparams.error = response.text;\n\t\t\t\t\tparams.type = \"php\";\n\t\t\t\t}\n\n\t\t\t\t/* If error type set */\n\t\t\t\tif(params.type)\n\t\t\t\t\treturn ajaxCallbacks.fire(\"notSuccess, error\", params); // No data\n\n\t\t\t\t/* Set response in possible params */\n\t\t\t\tparams.response = params.data = response;\n\n\t\t\t\t/* User success function */\n\t\t\t\treturn ajaxCallbacks.fire(\"preSuccess, success, notAbort\", params);\n\n\t\t\t}.safe(),\n\t\t\terror: function(jqXHR, textStatus, errorThrown) {\n\n\t\t\t\t/* Defaults */\n\t\t\t\tlet type        = \"Unknown\",\n\t\t\t\t\terrorText   = \"     ,   \";\n\n\t\t\t\t/* Get error text according to response data */\n\t\t\t\tif(textStatus === \"abort\") {\n\t\t\t\t\ttype \t  = \"abort\";\n\t\t\t\t\terrorText = '  ';\n\t\t\t\t} else if(textStatus === 'parsererror') {\n\t\t\t\t\ttype \t  = \"parse\";\n\t\t\t\t\terrorText = \"    ,   , :<br/>\" + jqXHR.responseText;\n\t\t\t\t} else if(textStatus === 'timeout') {\n\t\t\t\t\ttype \t  = \"timeout\";\n\t\t\t\t\terrorText = '   ';\n\t\t\t\t} else if(jqXHR.status === 0) {\n\t\t\t\t\ttype \t  = \"stopped\";\n\t\t\t\t\terrorText = ' ,    ';\n\t\t\t\t} else if(codes[jqXHR.status]) {\n\t\t\t\t\ttype = jqXHR.status;\n\t\t\t\t\terrorText = '     <br/> ' + codes[jqXHR.status];\n\t\t\t\t}\n\n\t\t\t\t/* Possible params list */\n\t\t\t\tlet params = $.extend({\n\t\t\t\t\terror      : errorText,\n\t\t\t\t\ttype       : type,\n\t\t\t\t\tcode\t   : type,\n\t\t\t\t\tjqXHR      : jqXHR,\n\t\t\t\t\ttextStatus : textStatus,\n\t\t\t\t\tstatus     : textStatus,\n\t\t\t\t\terrorThrown: errorThrown,\n\t\t\t\t\tobject     : object\n\t\t\t\t}, callbackData);\n\n\t\t\t\t/* Execute callback */\n\t\t\t\tajaxCallbacks.fire(\"notSuccess\", params);\n\n\t\t\t\t/* Execute special ajaxCallbacks */\n\t\t\t\tajaxCallbacks.fire(textStatus === \"abort\" ? \"abort\" : \"error, notAbort\", params);\n\n\t\t\t}.safe()\n\n\t\t}, ajaxExtend));\n\n\t\t/* On always set */\n\t\tajaxCallbacks.ajax.promise().always(function(jqXHR, textStatus, errorThrown) {\n\n\t\t\t/* Unlock objects */\n\t\t\tif(object)\n\t\t\t\tobject.enable();\n\n\t\t\t/* Always callback */\n\t\t\tajaxCallbacks.fire(\"always\", { errorThrown: errorThrown, textStatus: textStatus, jqXHR: jqXHR, object: object});\n\n\t\t}.safe());\n\n\t\treturn ajaxCallbacks;\n\n\t};\n\n\t/**\n\t * Contains http codes\n\t */\n\tlet codes = {\n\n\t\t/* Request errors */\n\t\t400: \" \",\n\t\t401: \"    \",\n\t\t402: \"     \",\n\t\t403: \"   \",\n\t\t404: \"          \",\n\t\t405: \"   HTTP\",\n\t\t406: \" \",\n\t\t407: \"  \",\n\t\t408: \"  \",\n\t\t409: \"\",\n\t\t410: \" \",\n\t\t411: \"    \",\n\t\t412: \" \",\n\t\t413: \"   \",\n\t\t414: \" URI  \",\n\t\t415: \"  \",\n\t\t416: \"   \",\n\t\t417: \" \",\n\t\t422: \" \",\n\t\t423: \" \",\n\t\t424: \" \",\n\t\t425: \" \",\n\t\t426: \" \",\n\t\t428: \" \",\n\t\t429: \"  \",\n\t\t431: \"    \",\n\t\t451: \"   \",\n\t\t456: \" \",\n\t\t499: \" Nginx,     \",\n\n\t\t/* Server error */\n\t\t500: \"  \",\n\t\t501: \" \",\n\t\t502: \"   \",\n\t\t503: \" \",\n\t\t504: \"  \",\n\t\t505: \" HTTP  \",\n\t\t506: \"   \",\n\t\t507: \" \",\n\t\t508: \" \",\n\t\t509: \"   \",\n\t\t510: \" \",\n\t\t511: \"  \"\n\n\t};\n\n});","/** Class to work with drop zone for File api */\nsky.service(\"ajaxFilesDropZone\", [\"supported\", \"callbacks\"], function({ supported, callbacks }) {\n\tthis.service = class {\n\t\tconstructor({ zone, data, url, options }) {\n\n\t\t\t/* Save options */\n\t\t\tthis.options   = options;\n\t\t\tthis.zone      = zone;\n\t\t\tthis.callbacks = callbacks();\n\t\t\tthis.data      = data;\n\t\t\tthis.url       = url;\n\t\t\tthis.files     = [];\n\n\t\t\t/* If no XHR supported, no file drip needed */\n\t\t\tif(!supported.XHRIsSupported) {\n\t\t\t\tthis.callbacks.fire(\"nonSupported\");\n\t\t\t\treturn this;\n\t\t\t}\n\n\t\t\t/* Bind events */\n\t\t\tthis.attachEvents();\n\n\t\t}\n\n\t\tattachEvents() {\n\n\t\t\t/* While over event */\n\t\t\tthis.zone.on({\n\n\t\t\t\tdragenter: (event) => { this.callbacks.fire(\"dragenter\", this, [event]); },\n\t\t\t\tdragleave: (event) => { this.callbacks.fire(\"dragleave\", this, [event]); },\n\t\t\t\tdragend  : (event) => { this.callbacks.fire(\"dragend\", this, [event]); \t },\n\t\t\t\tdrop     : (event) => { this.callbacks.fire(\"drop\", this, [event]);\t\t },\n\t\t\t\tdragover : (event) => {\n\n\t\t\t\t\t/* Get event */\n\t\t\t\t\tevent = event.originalEvent;\n\n\t\t\t\t\t/* Check if drag is valid */\n\t\t\t\t\tif(!this.isValidFileDrag(event))\n\t\t\t\t\t\treturn;\n\n\t\t\t\t\t/* Get effect */\n\t\t\t\t\tlet effect = event.dataTransfer.effectAllowed;\n\n\t\t\t\t\t/* Set proper */\n\t\t\t\t\tif(effect === 'move' || effect === 'linkMove') {\n\t\t\t\t\t\tevent.dataTransfer.dropEffect = 'move'; // for FF (only move allowed)\n\t\t\t\t\t} else {\n\t\t\t\t\t\tevent.dataTransfer.dropEffect = 'copy'; // for Chrome\n\t\t\t\t\t}\n\n\t\t\t\t\t/* Prevent */\n\t\t\t\t\tevent.preventDefault();\n\n\t\t\t\t}\n\t\t\t});\n\n\t\t\t/* Stop file opening when drop on browser window */\n\t\t\t$(document).bind({\n\t\t\t\tdragover : function(e) {\n\t\t\t\t\te = e.originalEvent;\n\t\t\t\t\tif(e.dataTransfer) {\n\t\t\t\t\t\te.dataTransfer.dropEffect = 'none';\n\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tdragenter: function(e) {\n\t\t\t\t\tif(typeof self.options.onStart !== \"undefined\")\n\t\t\t\t\t\tself.options.onStart.apply(self, [e]);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tstatic isValidFileDrag(event) {\n\n\t\t\tlet dt = event.dataTransfer,\n\t\t\t// do not check dt.types.contains in webkit, because it crashes safari 4\n\t\t\t\tisWebkit = navigator.userAgent.indexOf(\"AppleWebKit\") > -1;\n\n\t\t\t// dt.effectAllowed is none in Safari 5\n\t\t\t// dt.types.contains check is for firefox\n\t\t\treturn dt && dt.effectAllowed !== 'none' &&\n\t\t\t\t(dt.files || (!isWebkit && dt.types.contains && dt.types.contains('Files')));\n\n\t\t}\n\n\t};\n\n});","sky.service(\"ajaxFilesIFrame\", function() {\n\n\tlet AjaxFilesIFrame = function(options) {\n\n\t\t/* Save options */\n\t\tthis.options \t= options;\n\t\tthis.files    \t= options.files;\n\t\tthis.input   \t= options.input;\n\t\tthis.url  \t \t= options.url;\n\t\tthis.data \t \t= options.data;\n\t\tthis.callbacks \t= options.callbacks;\n\n\t};\n\n\tAjaxFilesIFrame.prototype = {\n\n\t\tgetName: function(name){\n\n\t\t\t// get input value and remove path to normalize\n\t\t\treturn name.replace(/.*(\\/|\\\\)/, \"\");\n\n\t\t},\n\n\t\tcancel: function(id){\n\n\t\t\tthis.options.onAbort(id, this.getName(this.input.value));\n\n\t\t\tthis.IFrame.setAttribute('src', 'javascript:false;').remove();\n\n\t\t},\n\n\t\t/**\n\t\t * Upload file function\n\t\t */\n\t\tsend: function() {\n\n\t\t\t/* letiables */\n\t\t\tlet self \t = this;\n\t\t\tlet input \t = this.input;\n\t\t\tlet fileName = this.getName(input.value);\n\n\t\t\t/* Create new input */\n\t\t\t$(input).clone().val(\"\").insertBefore(input);\n\n\t\t\t/* Create elements */\n\t\t\tthis.IFrame = this.createIframe();\n\t\t\tthis.form = this.createForm(this.IFrame, this.options.data).append(input);\n\n\t\t\tthis.attachLoadEvent(this.IFrame, function() {\n\n\t\t\t\tlet response = self.getIframeContentJSON(self.IFrame);\n\n\t\t\t\tif(response) self.options.onSuccess(response);\n\n\t\t\t\t// timeout added to fix busy state in FF3.6\n\t\t\t\tsetTimeout(function(){ self.IFrame.remove(); }, 1);\n\n\t\t\t});\n\n\t\t\tthis.form.trigger(\"submit\");\n\n\t\t},\n\n\t\t/**\n\t\t * Attach load event to IFrame\n\t\t */\n\t\tattachLoadEvent: function(iframe, callback){\n\n\t\t\tiframe.load(function(){\n\n\t\t\t\tif (!this.parentNode) return;\n\n\t\t\t\t// fixing Opera 10.53\n\t\t\t\tif (this.contentDocument &&\n\t\t\t\t\tthis.contentDocument.body &&\n\t\t\t\t\tthis.contentDocument.body.innerHTML === \"false\") return;\n\n\t\t\t\tcallback();\n\n\t\t\t});\n\n\t\t},\n\n\t\t/**\n\t\t * Returns json object received by IFrame from server.\n\t\t */\n\t\tgetIframeContentJSON: function(iframe){\n\n\t\t\t/* IFrame.contentWindow.document - for IE<7 */\n\t\t\tlet doc = iframe.get(0).contentDocument ? iframe.get(0).contentDocument: iframe.get(0).contentWindow.document;\n\n\t\t\tlet response = doc.body.innerHTML\n\n\t\t\t/* Check for empty response */\n\t\t\tif(response === \"\") {\n\t\t\t\tif(self.callbacks) self.callbacks.onError(\"  \"); // No data\n\t\t\t\treturn false;\n\t\t\t}\n\n\n\t\t\t/* Try to get json data */\n\t\t\ttry {\n\t\t\t\tresponse = jQuery.parseJSON(response);\n\t\t\t} catch(e) {\n\t\t\t\tif(self.callbacks) {\n\t\t\t\t\tself.callbacks.onError(\"  \"); // No data\n\t\t\t\t\tconsole.log(response);\n\t\t\t\t}\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\t/* If response returned with error */\n\t\t\tif(response.error) {\n\t\t\t\tif(self.callbacks) self.callbacks.onError(response.text); // Execute user error handler\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\treturn response;\n\t\t},\n\n\t\t/**\n\t\t * Creates IFrame with unique name\n\t\t */\n\t\tcreateIframe: function() {\n\n\t\t\treturn $('<IFrame/>', { src: \"javascript:false;\", name: \"uploadIFrame\" + Math.floor(Math.random()*1000000) }).css(\"display\", \"none\").appendTo('body');\n\n\t\t},\n\n\t\t/**\n\t\t * Creates form, that will be submitted to IFrame\n\t\t */\n\t\tcreateForm: function(iframe, params) {\n\n\t\t\tlet queryString = this.url + \"?\" + jQuery.param(params);\n\n\t\t\treturn $('<form/>', {\n\t\t\t\tmethod: \"post\", enctype: \"multipart/form-data\", action: queryString, target: iframe.attr(\"name\")\n\t\t\t}).css(\"display\", \"none\").appendTo('body');\n\n\t\t}\n\n\t};\n\n});","/**\n * Module to work with ajax file upload\n */\nsky.service(\"ajaxFiles\", [\"supported\", \"callbacks\", \"ajaxFilesXHR\", \"ajaxFilesIFrame\"], function({ callbacks, supported, ajaxFilesXHR, ajaxFilesIFrame }) {\n\n\t/**\n\t * Class to work with dynamic file upload\n\t * @param {html|string} input Input to be used to upload\n\t * @param {string} url Url to upload\n\t * @param {object} data Data to be send with request\n\t */\n\tlet AjaxFiles = this.service = function(input, url, data) {\n\n\t\t/* Self construct */\n\t\tif(!(this instanceof AjaxFiles))\n\t\t\treturn new AjaxFiles(input, url, data);\n\n\t\t/* Save items */\n\t\tthis.inputs \t= $(input);\n\t\tthis.url   \t\t= url;\n\t\tthis.data  \t\t= data;\n\t\tthis.callbacks \t= callbacks();\n\t\tthis.files\t\t= [];\n\n\t\t/**\n\t\t * Function to handle file input change\n\t\t */\n\t\tthis.saveFiles = function(input) {\n\n\t\t\t/* Get files list */\n\t\t\tif(supported.XHRUpload) {\n\n\t\t\t\t/* Get files from event */\n\t\t\t\tlet files = input.get(0).files;\n\n\t\t\t\t/* Save them to this */\n\t\t\t\tfor(let file of files)\n\t\t\t\t\tthis.files.push({ file: file, input: input, inputName: input.attr(\"name\") });\n\n\t\t\t} else this.files.push(input.get(0));\n\n\t\t};\n\n\t\t/**\n\t\t * Sends ajax files\n\t\t * @param {bool} parallel If try files would be send in parallel\n\t\t * @returns {*}\n\t\t */\n\t\tthis.send = function(parallel) {\n\n\t\t\t/* Clear */\n\t\t\tthis.files = [];\n\n\t\t\t/* Get files list */\n\t\t\tthis.inputs.each((_, input) => { this.saveFiles($(input)); });\n\n\t\t\t/* If no files */\n\t\t\tif(!this.files.length)\n\t\t\t\treturn false;\n\n\t\t\t/* Create supported handler */\n\t\t\tlet handler;\n\t\t\tif(supported.XHRUpload)\n\t\t\t\thandler = new ajaxFilesXHR(this);\n\t\t\telse\n\t\t\t\thandler = new ajaxFilesIFrame(this);\n\n\t\t\t/* Send files */\n\t\t\tif(parallel)\n\t\t\t\tthis.sendParallel(handler);\n\t\t\telse\n\t\t\t\tthis.sendConsequentially(handler);\n\n\t\t\t/* return send handler */\n\t\t\treturn handler;\n\n\t\t};\n\n\t\t/**\n\t\t * Sends files consequentially\n\t\t * @param handler\n\t\t */\n\t\tthis.sendConsequentially = function(handler) {\n\n\t\t\t/* First id */\n\t\t\tlet id = 0;\n\n\t\t\t/* Set sending next after this one */\n\t\t\tthis.callbacks.on(\"always\", () => {\n\t\t\t\tid++;\n\t\t\t\tif(this.files[id])\n\t\t\t\t\thandler.send(this.files[id]);\n\t\t\t});\n\n\t\t\t/* Send first */\n\t\t\thandler.send(self.files[id]);\n\n\t\t};\n\n\t\t/**\n\t\t * Sends files parallel\n\t\t * @param handler\n\t\t */\n\t\tthis.sendParallel = function(handler) {\n\n\t\t\t/* Send files through them */\n\t\t\tfor(let file of this.files)\n\t\t\t\thandler.send(file);\n\n\t\t};\n\n\t\t/* Self return */\n\t\treturn this;\n\n\t};\n\n\t/**\n\t * Performs default file send\n\t * @param {string} url\n\t * @param element\n\t * @param data\n\t */\n\tAjaxFiles.defaultSend = function(url, element, data) {\n\n\t\t// Get input\n\t\tlet input = element.is(\"input[type=file]\") ? element : element.closest(\"label, .label\").find(\"input[type=file]\"),\n\t\t\texceptions = sky.service(\"exceptions\"),\n\t\t\ttemplates = sky.service(\"templates\"),\n\t\t\tnotifications = sky.service(\"notifications\"),\n\t\t\twindows = sky.service.windows(\"windows\");\n\n\t\t// Check\n\t\tif(!input.length)\n\t\t\tthrow new exceptions.system.Error(\"No proper input provided for file send\");\n\n\t\t// Init\n\t\tlet filesAjax = AjaxFiles(input, url, data),\n\t\t\tmodal = windows.getLast(),\n\t\t\tcurrentFile;\n\n\t\t/*  Bind events */\n\t\tfilesAjax.callbacks\n\t\t\t.on(\"begin\", function (file) {\n\t\t\t\tif(modal) {\n\t\t\t\t\tmodal.holder.find(\".preview\").remove();\n\t\t\t\t\tmodal.lock();\n\t\t\t\t}\n\t\t\t\tcurrentFile = templates.render(\"files-single-upload\", file).insertAfter(element.parent());\n\t\t\t})\n\t\t\t.on(\"always\", function () {\n\t\t\t\tcurrentFile.remove();\n\t\t\t\tif(modal)\n\t\t\t\t\tmodal.unlock();\n\t\t\t})\n\t\t\t.on(\"notSuccess\", function (error) {\n\t\t\t\tmodal.clearExceptTemplate();\n\t\t\t\tnotifications.message({text: error}).appendToModal(modal);\n\t\t\t})\n\t\t\t.on(\"progress\", function (totalPercent, percent) {\n\t\t\t\tcurrentFile.find(\".total\").html(percent + \"%\");\n\t\t\t\tcurrentFile.find(\".progressBar div\").css(\"width\", percent + \"%\");\n\n\t\t\t\t// If loaded\n\t\t\t\tif (percent === 100)\n\t\t\t\t\tcurrentFile.find(\".total\").html(\"100%, \");\n\n\n\t\t\t})\n\t\t\t.on(\"start\", function () {\n\n\t\t\t});\n\n\t\t/* Send */\n\t\tfilesAjax.send();\n\t\treturn filesAjax;\n\n\t};\n\n});","/** Sends file data via HttpRequest */\nsky.service(\"ajaxFilesXHR\", [\"supported\", \"ajax\", \"stackList\"], function({supported, ajax, stackList}) {\n\tthis.service = class {\n\t\tconstructor(options) {\n\n\t\t\t/* Save options */\n\t\t\tthis.options \t\t= options;\n\t\t\tthis.files \t\t\t= options.files;\n\t\t\tthis.input \t\t\t= options.input;\n\t\t\tthis.url \t\t\t= options.url;\n\t\t\tthis.data \t\t\t= options.data;\n\t\t\tthis.callbacks \t\t= options.callbacks;\n\t\t\tthis.toProceed \t\t= options.files.length;\n\t\t\tthis.inProgress \t= 0;\n\t\t\tthis.total \t\t\t= options.files.length;\n\t\t\tthis.totalLoaded \t= 0;\n\t\t\tthis.totalSize \t\t= 0;\n\t\t\tthis.totalPercent \t= 0;\n\t\t\tthis.current \t\t= 0;\n\t\t\tthis.fileRequests \t= stackList();\n\n\t\t\t/* Go through */\n\t\t\tfor(file of options.files)\n\t\t\t\tthis.totalSize += file.size;\n\n\t\t}\n\n\t\t/**\n\t\t * Get file name\n\t\t * @param {*} file File\n\t\t * @returns {string}\n\t\t */\n\t\tstatic getName(file) {\n\t\t\treturn file.name.replace(/.*(\\/|\\\\)/, \"\");\n\t\t}\n\n\t\t/**\n\t\t * Uploads file\n\t\t * @param {*} file File name in files stack\n\t\t */\n\t\tsend(file) {\n\n\t\t\t/* This obj will store data associated with XHR */\n\t\t\t$.extend(file, {\n\t\t\t\tid     : Math.random(),\n\t\t\t\tname   : this.getName(file.file),\n\t\t\t\tsize   : file.file.size,\n\t\t\t\tajax   : false,\n\t\t\t\tpercent: false,\n\t\t\t\tloaded : 0\n\t\t\t});\n\n\t\t\t/* Prepare params */\n\t\t\tlet self        = this,\n\t\t\t\tparams      = this.data || {},\n\t\t\t\tqueryString = this.url + \"?ajaxFile=\" + file.name + \"&\" + jQuery.param(params);\n\n\t\t\t/**\n\t\t\t * Params extend\n\t\t\t * @param {object} args Object to be extended\n\t\t\t * @returns {*}\n\t\t\t */\n\t\t\tthis.extend = function(args) {\n\t\t\t\treturn jQuery.extend(args, {\n\t\t\t\t\ttotalLoaded : self.totalLoaded,\n\t\t\t\t\ttotalSize   : self.totalSize,\n\t\t\t\t\ttotalPercent: self.totalPercent,\n\t\t\t\t\tfile        : file,\n\t\t\t\t\tloaded      : file.loaded,\n\t\t\t\t\tsize        : file.size,\n\t\t\t\t\tpercent     : file.percent,\n\t\t\t\t\ttoProceed   : self.toProceed,\n\t\t\t\t\tcurrent     : self.current,\n\t\t\t\t\ttotal       : self.total\n\t\t\t\t});\n\t\t\t};\n\n\t\t\t/* Send */\n\t\t\tif(supported.formData) {\n\n\t\t\t\t/* Create form data sender */\n\t\t\t\tlet form = new FormData();\n\t\t\t\tform.append(file.inputName, file.file);\n\n\t\t\t\t/* Send start */\n\t\t\t\tfile.ajax = ajax(queryString, form, { ajaxExtend: {\n\t\t\t\t\t\tprocessData: false,\n\t\t\t\t\t\tcontentType: false,\n\t\t\t\t\t\ttype       : \"POST\",\n\t\t\t\t\t\txhr        : (() => {\n\t\t\t\t\t\t\ttry {\n\n\t\t\t\t\t\t\t\t/* Create XHR */\n\t\t\t\t\t\t\t\tlet xhr = new XMLHttpRequest();\n\n\t\t\t\t\t\t\t\t/* Set special upload api handlers */\n\t\t\t\t\t\t\t\txhr.upload[\"onloadstart\"] = function() {\n\t\t\t\t\t\t\t\t\tthis.inProgress++;\n\t\t\t\t\t\t\t\t\tthis.callbacks.fire(\"begin\", this.extend({}));\n\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t\txhr.upload[\"onprogress\"] = function(event) {\n\t\t\t\t\t\t\t\t\tthis.totalLoaded += event.loaded - file.loaded;\n\t\t\t\t\t\t\t\t\tthis.totalPercent = (this.totalLoaded / this.totalSize * 100).toFixed(0);\n\t\t\t\t\t\t\t\t\tthis.onProgress(event, file);\n\t\t\t\t\t\t\t\t};\n\n\t\t\t\t\t\t\t\t/* Return create XHR */\n\t\t\t\t\t\t\t\treturn xhr;\n\n\t\t\t\t\t\t\t} catch(e) {\n\t\t\t\t\t\t\t\treturn undefined;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}).safe()\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t} else {\n\n\t\t\t\t/* Send start */\n\t\t\t\tfile.ajax = ajax(queryString, file.file, {\n\t\t\t\t\tprocessData: false,\n\t\t\t\t\tcontentType: false,\n\t\t\t\t\ttype       : \"POST\",\n\t\t\t\t\tbeforeSend : sky.func(function(jqXHR) {\n\t\t\t\t\t\tjqXHR.setRequestHeader(\"X-Requested-With\", \"XMLHttpRequest\");\n\t\t\t\t\t\tjqXHR.setRequestHeader(\"X-File-Name\", encodeURI(file.name));\n\t\t\t\t\t\tjqXHR.setRequestHeader(\"Content-Type\", \"multipart/form-data\");\n\t\t\t\t\t\tjqXHR.setRequestHeader(\"Content-Disposition\", 'attachment; filename=\"' + encodeURI(file.name) + '\"');\n\t\t\t\t\t\tjqXHR.setRequestHeader(\"Accept\", \"text/html,application/xhtml+xml,application/xml;q=0.9\");\n\t\t\t\t\t})\n\t\t\t\t});\n\n\t\t\t}\n\n\t\t\t/* Set ajax callbacks */\n\t\t\tfile.ajax.on({\n\t\t\t\tsuccess:\t(all) => { this.callbacks.fire(\"success\", this.extend(all)); },\n\t\t\t\terror: \t\t(all) => { this.callbacks.fire(\"error\", this.extend(all)); },\n\t\t\t\tnotSuccess: (all) => { this.callbacks.fire(\"notSuccess\", this.extend(all)); },\n\t\t\t\talways: \t(all) => {\n\n\t\t\t\t\t/* Counters */\n\t\t\t\t\tthis.inProgress--;\n\t\t\t\t\tthis.toProceed--;\n\n\t\t\t\t\t/* Call always method */\n\t\t\t\t\tthis.callbacks.fire(\"always\", this.extend(all));\n\n\t\t\t\t\t/* Delete connection */\n\t\t\t\t\tthis.fileRequests.delete(file);\n\n\t\t\t\t}\n\t\t\t});\n\n\t\t\t/* Save */\n\t\t\tthis.fileRequests.add(file);\n\n\t\t}\n\n\t\t/**\n\t\t * Fores on progress change\n\t\t * @param event\n\t\t * @param fileRequestData\n\t\t */\n\t\tonProgress(event, fileRequestData) {\n\n\t\t\t/* Count percentage */\n\t\t\tlet percent = (event.loaded / event[\"total\"] * 100).toFixed(0);\n\t\t\tfileRequestData.loaded = event.loaded;\n\n\t\t\t/* If percent changed */\n\t\t\tif(percent !== fileRequestData.percent && event[\"lengthComputable\"]) {\n\t\t\t\tfileRequestData.percent = percent;\n\t\t\t\tthis.callbacks.fire(\"progress\", this.extend({}));\n\t\t\t}\n\n\t\t}\n\n\t\t/**\n\t\t * Aborts current download\n\t\t */\n\t\tabort() {\n\n\t\t\t/* Stop each request */\n\t\t\tthis.fileRequests.each(request => { request.ajax.stop() });\n\n\t\t\t/* Call always method */\n\t\t\tthis.callbacks.fire(\"abort\", this.extend({}));\n\n\t\t}\n\n\t};\n\n});","sky.service(\"calendar\", [ \"templates\" ], function ({ templates }) {\n\n\t/* This class is for showing calendar to pick date on page */\n\tlet calendar = {\n\n\t\t/* Days set */\n\t\tmonthsNames: window.page.data.monthsNames || [\"\", \"\", \"\", \"\", \"\", \"\", \"\", \"\", \"\", \"\", \"\", \"\"],\n\n\t\trenderDays: function () {\n\n\t\t\t/* Clone */\n\t\t\tlet current = moment(this.date),\n\t\t\t\tweeks = [],\n\t\t\t\tcurrentWeek = false;\n\n\t\t\t/* From first */\n\t\t\tcurrent.date(1);\n\n\t\t\t/* Go through */\n\t\t\twhile (current.month() === this.date.month()) {\n\n\t\t\t\t/* Make week if new */\n\t\t\t\tif (!currentWeek || current.day() === 1) {\n\t\t\t\t\tcurrentWeek = {number: current.isoWeek(), days: []};\n\t\t\t\t\tweeks.push(currentWeek);\n\t\t\t\t}\n\n\t\t\t\t/* Push */\n\t\t\t\tcurrentWeek.days.push({date: current.clone(), dateStr: current.format(\"YYYY.MM.DD\"), day: current.day() === 0 ? 6 : current.day() - 1});\n\n\t\t\t\t/* Go next day */\n\t\t\t\tcurrent.add(1, \"d\");\n\n\t\t\t}\n\n\t\t\t/* Render */\n\t\t\tthis.dates.html('').append(templates.render(\"calendar-dates\", {\n\t\t\t\tweeks: weeks,\n\t\t\t\tdateStr: this.date.format(\"YYYY.MM.DD\"),\n\t\t\t\tcurrent: this.date,\n\t\t\t\tperiod: this.period,\n\t\t\t\tsince: this.since,\n\t\t\t\ttill: this.till\n\t\t\t}));\n\n\t\t\t/* Render */\n\t\t\tthis.setTime();\n\n\t\t},\n\n\t\t/**\n\t\t * When user picks date\n\t\t * @param {*} dayDiv Div that user clicked, if he did\n\t\t * @param notClose\n\t\t */\n\t\tdayPick: function (dayDiv, notClose) {\n\n\t\t\t/* Set date */\n\t\t\tif (dayDiv)\n\t\t\t\tthis.date.date(parseInt(dayDiv.html()));\n\n\t\t\tthis.field.val(this.getInputValue()).trigger(\"change\").trigger(\"keyup\");\n\t\t\tif (!notClose) this.close();\n\n\t\t},\n\n\t\tgetInputValue: function () {\n\n\t\t\t/* Get field new value */\n\t\t\tif (this.useTime)\n\t\t\t\treturn this.date.format(\"DD.MM.YYYY HH:mm\");\n\t\t\telse if (this.period && this.since.isSame(this.till))\n\t\t\t\treturn this.since.format(\"DD.MM.YYYY\");\n\t\t\telse if (this.period)\n\t\t\t\treturn this.since.format(\"DD.MM.YYYY\") + ' - ' + this.till.format(\"DD.MM.YYYY\");\n\n\t\t\t/* Default */\n\t\t\treturn this.date.format(\"DD.MM.YYYY\");\n\n\t\t},\n\n\t\tsetDayPick: function () {\n\t\t\tthis.pickedDateView.html(this.getInputValue());\n\t\t},\n\n\t\t/**\n\t\t * Position date picker\n\t\t * @param {*} field Item that we should position under\n\t\t */\n\t\tposition: function (field) {\n\n\t\t\tthis.holder.insertAfter(field.parent()).css({\n\t\t\t\tmarginTop: 0,\n\t\t\t\tmarginLeft: 0,\n\t\t\t\tposition: \"absolute\"\n\t\t\t}).css({\n\t\t\t\tmarginTop: field.offset().top - this.holder.offset().top + field.outerHeight() + 1,\n\t\t\t\tmarginLeft: field.offset().left - this.holder.offset().left + 1\n\t\t\t});\n\n\t\t},\n\n\t\t/**\n\t\t * Sets time inputs in calendar values\n\t\t */\n\t\tsetTime: function () {\n\n\t\t\t/* Set time */\n\t\t\tthis.holder.find(\".time .hour\").val(this.date.format(\"HH\"));\n\t\t\tthis.holder.find(\".time .minute\").val(this.date.format(\"mm\"));\n\n\t\t},\n\n\t\tperiodChangeDay: function () {\n\n\t\t\tlet reset = function () {\n\t\t\t\tcalendar.since = calendar.date.clone();\n\t\t\t\tcalendar.till = calendar.date.clone();\n\t\t\t\tcalendar.lastModified = \"none\"\n\t\t\t};\n\n\t\t\tif (this.date.isBefore(this.since)) {\n\t\t\t\tif (this.lastModified !== \"since\") {\n\t\t\t\t\tthis.since = this.date.clone();\n\t\t\t\t\tthis.lastModified = \"since\"\n\t\t\t\t}\n\t\t\t\telse reset();\n\t\t\t} else if (this.date.isAfter(this.till)) {\n\t\t\t\tif (this.lastModified !== \"till\") {\n\t\t\t\t\tthis.till = this.date.clone();\n\t\t\t\t\tthis.lastModified = \"till\"\n\t\t\t\t}\n\t\t\t\telse reset();\n\t\t\t} else if (this.date.isSame(this.till) || this.date.isSame(this.since))\n\t\t\t\treset();\n\t\t\telse {\n\t\t\t\tif (this.lastModified === \"since\") {\n\t\t\t\t\tthis.till = this.date.clone();\n\t\t\t\t\tthis.lastModified = \"till\"\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tthis.since = this.date.clone();\n\t\t\t\t\tthis.lastModified = \"since\"\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tcalendar.markSelected();\n\n\t\t},\n\n\t\tmarkSelected: function () {\n\n\t\t\tthis.dates.find(\".day\").removeClass(\"selected\").removeClass(\"subSelected\").each(function () {\n\n\n\t\t\t\tlet element = $(this),\n\t\t\t\t\tdate = calendar.date.clone().date(parseInt(element.html()));\n\n\t\t\t\tif (!calendar.period) {\n\t\t\t\t\tif (date.format(\"DD.MM.YYYY\") === calendar.date.format(\"DD.MM.YYYY\"))\n\t\t\t\t\t\telement.addClass(\"subSelected\");\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (date.isAfter(calendar.since) && date.isBefore(calendar.till))\n\t\t\t\t\telement.addClass(\"subSelected\");\n\t\t\t\telse if (date.isSame(calendar.since) || date.isSame(calendar.till))\n\t\t\t\t\telement.addClass(\"selected\");\n\n\t\t\t});\n\n\t\t},\n\n\t\t/**\n\t\t * Changes day\n\t\t * @param {*} element Day picker\n\t\t * @returns {undefined}\n\t\t */\n\t\tchangeDay: function (element) {\n\n\t\t\t/* If pick today */\n\t\t\tthis.date.date(parseInt(element.html()));\n\n\t\t\t/* No more for period */\n\t\t\tif (this.period) {\n\t\t\t\tthis.periodChangeDay();\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tcalendar.markSelected();\n\n\t\t\t/* Set time */\n\t\t\tif (this.field.attr(\"name\") === \"since\")\n\t\t\t\tthis.date.hour(0).minute(0);\n\t\t\telse if (this.date.format(\"DD-MM-YYYY\") === moment().format(\"DD-MM-YYYY\"))\n\t\t\t\tthis.date.hour(moment().hour()).minute(moment().minute());\n\t\t\telse\n\t\t\t\tthis.date.hour(23).minute(59);\n\n\t\t\t/* Pick */\n\t\t\tif (!this.useTime)\n\t\t\t\tthis.dayPick(element);\n\t\t\telse\n\t\t\t\tthis.setTime();\n\n\t\t},\n\n\t\t/**\n\t\t * Sets specified year\n\t\t * @param {int} year Year that need to be set\n\t\t */\n\t\tchangeYear: function (year) {\n\n\t\t\t/* Set year */\n\t\t\tthis.date.year(year);\n\n\t\t\t/* Update */\n\t\t\tthis.yearView.html(year);\n\n\t\t\t/* Dates redraw */\n\t\t\tthis.renderDays();\n\n\t\t},\n\n\t\t/**\n\t\t * Sets specified month\n\t\t * @param {int} month Month to be set\n\t\t */\n\t\tchangeMonth: function (month) {\n\n\t\t\t/* Set year */\n\t\t\tthis.date.month(month);\n\n\t\t\t/* Updates */\n\t\t\tthis.monthView.html(this.monthsNames[this.date.month()] + ' ' + this.date.year());\n\n\t\t\t/* Reload year */\n\t\t\tthis.changeYear(this.date.year());\n\n\t\t},\n\n\t\tgetDatePeriod: function (dateString) {\n\n\t\t\t// Split and get since\n\t\t\tlet parts = dateString.split('-'),\n\t\t\t\ttill,\n\t\t\t\tsince = this.getDate(parts[0].trim());\n\n\t\t\t// Get till\n\t\t\tif (parts.length > 1)\n\t\t\t\ttill = this.getDate(parts[1].trim());\n\t\t\telse\n\t\t\t\ttill = this.getDate(parts[0].trim());\n\n\t\t\t// Set inner lets\n\t\t\tthis.since = since;\n\t\t\tthis.till = till;\n\t\t\tthis.date = since.clone();\n\n\t\t},\n\n\t\t/**\n\t\t * Creates today date\n\t\t */\n\t\tgetDate: function (dateString) {\n\n\t\t\t/* Set calendar date */\n\t\t\tlet date = false;\n\n\t\t\t/* If input has datetime format value */\n\t\t\tif (dateString.match(/^\\d{4}-\\d{2}-\\d{2} \\d{1,2}:\\d{1,2}$/))\n\t\t\t\tdate = moment(dateString, \"YYYY-MM-DD HH:mm\");\n\n\t\t\t/* Id input has date format value */\n\t\t\tif (dateString.match(/^\\d{4}-\\d{2}-\\d{2}$/))\n\t\t\t\tdate = moment(dateString, \"YYYY-MM-DD\");\n\n\t\t\t/* Id input has date format value */\n\t\t\tif (dateString.match(/^\\d{2}.\\d{2}.\\d{4}$/))\n\t\t\t\tdate = moment(dateString, \"DD.MM.YYYY\");\n\n\t\t\t/* Id input has date format value */\n\t\t\tif (dateString.match(/^\\d{2}.\\d{2}.\\d{4} \\d{2}:\\d{2}$/))\n\t\t\t\tdate = moment(dateString, \"DD.MM.YYYY HH:mm\");\n\n\t\t\t/*  If still no */\n\t\t\tif (!date) {\n\t\t\t\tdate = moment();\n\n\t\t\t\t/* Set time */\n\t\t\t\tif (this.field.attr(\"name\") === \"since\")\n\t\t\t\t\tdate.hour(0).minute(0);\n\t\t\t}\n\n\t\t\t/* Reset time */\n\t\t\tif (!this.useTime)\n\t\t\t\tdate.hour(0).minute(0);\n\n\t\t\t/* Additional check */\n\t\t\treturn this.date = date;\n\n\t\t},\n\n\t\t/**\n\t\t * Closes windows\n\t\t */\n\t\tclose: function () {\n\n\t\t\t/* Remove calendar */\n\t\t\tif (this.holder)\n\t\t\t\tthis.holder.remove();\n\n\t\t\t/* Unset */\n\t\t\tif (this.field) {\n\t\t\t\tthis.field.off(\"keyup.calendar\");\n\t\t\t\tthis.field = false;\n\t\t\t}\n\t\t}\n\t};\n\n\tlet show = function (field, showTime) {\n\n\t\t/* Remove old calendars */\n\t\tthis.close();\n\n\t\t/* Begins from current date */\n\t\tthis.field = field;\n\t\tthis.period = false;\n\t\tthis.useTime = showTime ? showTime : false;\n\t\tthis.lastPicked = \"none\";\n\n\t\tif (field.is(\"input.datePeriod\")) {\n\t\t\tthis.period = true;\n\t\t\tthis.getDatePeriod(field.val());\n\t\t} else\n\t\t\tthis.getDate(field.val());\n\n\t\t/* Render */\n\t\tthis.holder = templates.render(\"calendar\", this);\n\n\t\t/* Actions */\n\t\tthis.holder\n\n\t\t/* Months changer */\n\t\t\t.action(\"click\", \".month .next\", function (event) {\n\t\t\t\tevent.preventDefault();\n\t\t\t\tcalendar.changeMonth(calendar.date.month() + 1);\n\t\t\t})\n\t\t\t.action(\"click\", \".month .prev\", function (event) {\n\t\t\t\tevent.preventDefault();\n\t\t\t\tcalendar.changeMonth(calendar.date.month() - 1);\n\t\t\t})\n\n\t\t\t/* Years */\n\t\t\t.action(\"click\", \".year .next\", function (event) {\n\t\t\t\tevent.preventDefault();\n\t\t\t\tcalendar.changeYear(calendar.date.year() + 1);\n\t\t\t})\n\t\t\t.action(\"click\", \".year .prev\", function (event) {\n\t\t\t\tevent.preventDefault();\n\t\t\t\tcalendar.changeYear(calendar.date.year() - 1);\n\t\t\t})\n\t\t\t.action(\"click\", \".setNow\", function (event) {\n\t\t\t\tevent.preventDefault();\n\t\t\t\tcalendar.date = moment();\n\t\t\t\tcalendar.renderDays();\n\t\t\t\tcalendar.setTime();\n\t\t\t})\n\t\t\t.action(\"click\", \".setToday\", function (event) {\n\t\t\t\tevent.preventDefault();\n\t\t\t\tcalendar.date = moment();\n\t\t\t\tcalendar.date.hour(0);\n\t\t\t\tcalendar.date.minute(0);\n\t\t\t\tcalendar.renderDays();\n\t\t\t\tcalendar.setTime();\n\t\t\t})\n\t\t\t.action(\"click\", \".setWeek\", function (event) {\n\t\t\t\tevent.preventDefault();\n\t\t\t\tcalendar.date = moment();\n\t\t\t\tcalendar.date.subtract(7, \"d\");\n\t\t\t\tcalendar.renderDays();\n\t\t\t\tcalendar.setTime();\n\t\t\t})\n\n\t\t\t/* Day */\n\t\t\t.action(\"click\", \".dates .day\", function (event) {\n\t\t\t\tevent.preventDefault();\n\t\t\t\tlet self = $(this);\n\n\t\t\t\tif (self.is(\".selected\") && !calendar.period)\n\t\t\t\t\tcalendar.dayPick($(this));\n\t\t\t\telse {\n\t\t\t\t\tcalendar.changeDay($(this));\n\t\t\t\t\tcalendar.dayPick(false, true);\n\t\t\t\t}\n\t\t\t})\n\n\t\t\t/* Apply button */\n\t\t\t.action(\"click\", \".apply\", function (event) {\n\t\t\t\tevent.preventDefault();\n\t\t\t\tcalendar.dayPick();\n\t\t\t})\n\n\t\t\t/* Time */\n\t\t\t.action(\"click\", \".time a\", function (event) {\n\t\t\t\tevent.preventDefault();\n\t\t\t\tcalendar.date.hour(moment().hour());\n\t\t\t\tcalendar.date.minute(moment().minute());\n\t\t\t\tcalendar.setTime();\n\t\t\t})\n\t\t\t.action(\"keyup\", \".time .hour\", function () {\n\t\t\t\tcalendar.date.hour(this.value);\n\t\t\t})\n\t\t\t.action(\"keyup\", \".time .minute\", function () {\n\t\t\t\tcalendar.date.minute(this.value);\n\t\t\t});\n\n\n\t\t/* Close and containers */\n\t\tthis.dates = this.holder.find(\".dates\");\n\t\tthis.yearView = this.holder.find(\".year .value\");\n\t\tthis.monthView = this.holder.find(\".month .value\");\n\t\tthis.pickedDateView = this.holder.find(\".pickedDate\");\n\n\t\t/* Refresh days */\n\t\tthis.renderDays();\n\n\t\t/* Reposition */\n\t\tthis.position(field);\n\t\tthis.setDayPick();\n\n\t\t/* Auto change */\n\t\tthis.field.on(\"keyup.calendar\", function () {\n\t\t\tshow(field, showTime);\n\t\t});\n\n\t\tlet dateOriginal;\n\t\tthis.dates.on(\"touchstart\", function (event) {\n\n\t\t\tlet element = $(event.target);\n\t\t\tif (!element.is(\".day\")) return;\n\t\t\tdateOriginal = calendar.date.clone().date(parseInt(element.html()));\n\n\t\t}).on(\"touchmove\", function (event) {\n\n\t\t\t/* No original event */\n\t\t\tevent.preventDefault();\n\n\t\t\tlet element = document.elementFromPoint((event.clientX || event.originalEvent.touches[0].clientX), (event.clientY || event.originalEvent.touches[0].clientY));\n\t\t\telement = $(element);\n\n\t\t\tif (!element.is(\".day\")) return;\n\n\t\t\tlet date = dateOriginal.clone().date(parseInt(element.html()));\n\n\t\t\tif (date.isBefore(dateOriginal)) {\n\t\t\t\tcalendar.since = date.clone();\n\t\t\t\tcalendar.till = dateOriginal.clone();\n\t\t\t} else {\n\t\t\t\tcalendar.since = dateOriginal.clone();\n\t\t\t\tcalendar.till = date.clone();\n\t\t\t}\n\t\t\tcalendar.lastModified = \"none\";\n\t\t\tcalendar.markSelected();\n\t\t\t// $(this).trigger(\"click\");\n\n\t\t});\n\n\t}.bind(calendar);\n\n\t/* Return */\n\tthis.service = show;\n\n});\n\nsky.onReady(({calendar}) => {\n\n\t/* Calendar show */\n\t$(document).action(\"click.calendar\", function (event) {\n\n\t\t/* Get element */\n\t\tlet element = $(event.target || event.srcElement);\n\n\t\t/* Remove calendar */\n\t\tif (!element.is(\".calendar\") && !element.parents(\".calendar\").length)\n\t\t\t$(\".calendar\").remove();\n\n\t\t/* Calendar show */\n\t\tif (element.is(\"input.date\"))\n\t\t\tcalendar(element);\n\n\t\t/* Calendar show */\n\t\tif (element.is(\"input.datePeriod\"))\n\t\t\tcalendar(element, false, true);\n\n\t\t/* Calendar show */\n\t\tif (element.is(\"input.datetime\"))\n\t\t\tcalendar(element, true);\n\n\t\t/* Calendar show */\n\t\tif (element.is(\"input.datehour\"))\n\t\t\tcalendar(element, true);\n\n\t}).action(\"keydown.calendar\", function (event) {\n\t\tif (event.keyCode === 13) {\n\t\t\tlet calendars = $(\".calendar\");\n\t\t\tif (calendars.length) {\n\t\t\t\tcalendars.find(\".day.selected\").trigger(\"click\");\n\t\t\t\tevent.preventDefault();\n\t\t\t}\n\t\t}\n\t});\n});","sky.service(\"callback\", function() {\n\n\t/**\n\t * Creates callback object that holds functions list\n\t * @param {string} [flags]\n\t * @returns {*}\n\t * @constructor\n\t */\n\tlet Callback = function(flags) {\n\n\t\t/* Self construct */\n\t\tif(!(this instanceof Callback))\n\t\t\treturn new Callback(flags);\n\n\t\t/**\n\t\t * Functions list holder\n\t\t * @type {Array}\n\t\t */\n\t\tthis.functions = [];\n\t\tthis.toRun =  0;\n\t\tthis.context = this;\n\n\t\t/* Self return for next usage */\n\t\treturn this;\n\n\t};\n\n\t/**\n\t * Base\n\t * @type {{functions: Array, toRun: number, context: *, add: add, removeByContext: removeByContext, fire: fire, fireNext: fireNext}}\n\t */\n\tCallback.prototype = {\n\n\t\t/**\n\t\t * Adds new function to stack\n\t\t * @param {Function} func Function to add\n\t\t * @param {Object} context Function context\n\t\t * @param {Object} options Call options\n\t\t */\n\t\tadd: function(func, context, options) {\n\t\t\tthis.functions.push({\n\t\t\t\tfunc: func,\n\t\t\t\tcontext: context || false,\n\t\t\t\tonce: options && options.once\n\t\t\t});\n\t\t\treturn this;\n\t\t},\n\n\t\t/**\n\t\t * Removes function from list by context\n\t\t * @param context\n\t\t */\n\t\tremoveByContext: function(context) {\n\n\t\t\t/* Find listener */\n\t\t\tlet i;\n\t\t\tfor(i in this.functions)\n\t\t\t\tif(this.functions[i].context === context)\n\t\t\t\t\tthis.functions.splice(i, 1);\n\n\t\t\t/* Self return */\n\t\t\treturn this;\n\n\t\t},\n\n\t\t/**\n\t\t * Removes function from list by context\n\t\t * @param func\n\t\t */\n\t\tremoveByCallback: function(func) {\n\n\t\t\t/* Find listener */\n\t\t\tlet i;\n\t\t\tfor(i in this.functions)\n\t\t\t\tif(this.functions[i].func === func)\n\t\t\t\t\tthis.functions.splice(i, 1);\n\n\t\t\t/* Self return */\n\t\t\treturn this;\n\n\t\t},\n\n\t\t/**\n\t\t * Fires all functions\n\t\t * @param {Object} context Function context\n\t\t * @param {Array} args Arguments\n\t\t */\n\t\tfire: function(context, args) {\n\t\t\tfor(let func of this.functions)\n\t\t\t\tfunc.func.apply(func.context || context, args);\n\t\t},\n\n\t\t/**\n\t\t * Fires next function\n\t\t * @param {Array|Object} args Arguments\n\t\t * @param {Object} context Function context\n\t\t */\n\t\tfireNext: function(args, context) {\n\n\t\t\t/* If no more to run */\n\t\t\tif(this.functions.length <= this.toRun)\n\t\t\t\treturn false;\n\n\t\t\t/* Set next to run */\n\t\t\tthis.toRun++;\n\n\t\t\t/* Function to run */\n\t\t\tlet current = this.functions[this.toRun - 1],\n\t\t\t\tresult,\n\t\t\t\tfunc = current.func;\n\n\t\t\t/* Set context */\n\t\t\tcontext = current.context || context || window;\n\n\t\t\t/* Get function in string */\n\t\t\tif(typeof func === \"string\")\n\t\t\t\tfunc = context[func];\n\n\t\t\t/* If no function found */\n\t\t\tif(!func)\n\t\t\t\treturn true;\n\n\t\t\t/* Call function */\n\t\t\tresult =  func.apply(current.context || context, args) !== false;\n\n\t\t\t/* If call once */\n\t\t\tif(current.once) {\n\t\t\t\tthis.functions.splice(this.toRun - 2, 1);\n\t\t\t\tthis.toRun--;\n\t\t\t}\n\n\t\t\t/* Return function result */\n\t\t\treturn result;\n\t\t}\n\n\t};\n\n\tthis.service = Callback;\n\n});","sky.service(\"callbacks\", [\"callback\"], function({ callback }) {\n\n\t/**\n\t *\n\t * Callbacks prepared object\n\t * @param {*} [flags] Flags list for jQuery.Callbacks\n\t * @constructor\n\t */\n\tlet Callbacks = function(flags) {\n\n\t\t/* Self construction */\n\t\tif(!(this instanceof Callbacks))\n\t\t\treturn new Callbacks(flags);\n\n\t\t/* Add properties */\n\t\t$.extend(true, this, Callbacks.extend);\n\n\t\t/* Callbacks list */\n\t\tthis.advancedCallbacks = {};\n\n\t\t/* Set default flags and self context */\n\t\treturn this.flags(flags);\n\n\t};\n\n\t/**\n\t * Prototype\n\t * @type {{on: on, fire: fire, off: off, flags: flags, setContext: setContext}}\n\t */\n\tCallbacks.prototype = {\n\n\t\t\t/**\n\t\t\t * Flags for sky.Callback\n\t\t\t * @param {object} flags Flags list\n\t\t\t * @returns {*}\n\t\t\t */\n\t\t\tflags: function(flags) {\n\t\t\t\tthis.callbacksFlags = flags;\n\t\t\t\treturn this;\n\t\t\t},\n\n\t\t\t/**\n\t\t\t * Remove by listener\n\t\t\t * @param {string} name Event name\n\t\t\t * @param {string} listener Listener object\n\t\t\t */\n\t\t\tremoveListener: function(name, listener) {\n\t\t\t\tif(this.advancedCallbacks[name]) {\n\t\t\t\t\tthis.advancedCallbacks[name].removeByContext(listener);\n\t\t\t\t}\n\t\t\t},\n\n\t\t\t/**\n\t\t\t * Adds new event handler\n\t\t\t * @param {string} \t name \t\t\tName of event\n\t\t\t * @param {function|string} func \tFunction be called on event fires\n\t\t\t * @param {object}   [context]\t\tFunction options\n\t\t\t * @param {object}   [options]\t\tFunction options\n\t\t\t */\n\t\t\ton:  function(name, func, context, options) {\n\n\n\t\t\t\tif(name instanceof Object)\n\t\t\t\t\t$.each(name, (event, func) => { this.on(event, func) });\n\n\t\t\t\telse $.each(this.getEventsNames(name), (_, name) => {\n\n\t\t\t\t\t/* Create callbacks */\n\t\t\t\t\tif(!this.advancedCallbacks[name])\n\t\t\t\t\t\tthis.advancedCallbacks[name] = callback(this.callbacksFlags);\n\n\t\t\t\t\t/* Add function */\n\t\t\t\t\tthis.advancedCallbacks[name].add(func, context ? context : self.context, options || {});\n\n\t\t\t\t});\n\n\t\t\t\treturn this;\n\t\t\t},\n\n\t\t\t/**\n\t\t\t * Fires callbacks for specified event\n\t\t\t * @param {string} name Name of event\n\t\t\t * @param {object} args Arguments to be passed\n\t\t\t * @param {object} [options] Additional options\n\t\t\t */\n\t\t\tfire: function(name, args, options) {\n\n\t\t\t\t/* Success last */\n\t\t\t\tlet events = this.getEventsNames(name),\n\t\t\t\t\tself = this,\n\t\t\t\t\tnext = false;\n\t\t\t\t\toptions = options || {};\n\n\t\t\t\t/* Remove global if need */\n\t\t\t\tif(options[\"noGlobal\"])\n\t\t\t\t\tevents = events.slice(1);\n\n\t\t\t\t/* Fire events */\n\t\t\t\t$.each(events, function(_, event) {\n\n\t\t\t\t\t/* If no callback */\n\t\t\t\t\tif(!self.advancedCallbacks[event])\n\t\t\t\t\t\treturn;\n\n\t\t\t\t\t/* Run */\n\t\t\t\t\tdo {\n\t\t\t\t\t\tnext = self.advancedCallbacks[event].fireNext(jQuery.extend({ event: event }, args || []), self.context, options.possible);\n\t\t\t\t\t} while(next);\n\n\t\t\t\t\t/* Reset */\n\t\t\t\t\tif(!options.once)\n\t\t\t\t\t\tself.advancedCallbacks[event].toRun = 0;\n\n\t\t\t\t});\n\n\t\t\t},\n\n\t\t\t/**\n\t\t\t * Get all event names from global name\n\t\t\t * @param {String} name Global event name\n\t\t\t * @returns {Array}\n\t\t\t */\n\t\t\tgetEventsNames: function(name) {\n\n\t\t\t\t/* Get events names */\n\t\t\t\tlet names = name.split(\",\"), events = [];\n\n\t\t\t\t/* Go through */\n\t\t\t\t$.each(names, function(i, name) {\n\n\t\t\t\t\t/* Remove spaces */\n\t\t\t\t\tname = name.replace(\" \", \"\");\n\n\t\t\t\t\t/* Get elements */\n\t\t\t\t\tlet elements = name.split(\".\");\n\t\t\t\t\tevents.push(elements[0]);\n\n\t\t\t\t\t/* Go through */\n\t\t\t\t\tfor(let j = 1; j < elements.length; j++)\n\t\t\t\t\t\tevents.push(elements[0] + \".\" + elements[j]);\n\n\t\t\t\t\t/* Global event */\n\t\t\t\t\tif(elements.length > 2)\n\t\t\t\t\t\tevents.push(elements.join(\".\"));\n\n\t\t\t\t});\n\n\t\t\t\t/* Return */\n\t\t\t\treturn events;\n\n\t\t\t},\n\n\t\t/**\n\t\t * Removes event handlers and functions\n\t\t * @param {string} name Event name\n\t\t * @param func\n\t\t */\n\t\t\toff: function(name, func = null) {\n\t\t\t\tif(func && this.advancedCallbacks[name])\n\t\t\t\t\tthis.advancedCallbacks[name].removeByCallback(func);\n\t\t\t\telse\n\t\t\t\t\tdelete this.advancedCallbacks[name];\n\t\t\t}\n\n\t\t};\n\n\t\tthis.service = Callbacks;\n\n});","sky.service(\"dataOperator\", [ \"inputsIO\", \"notifications\", \"templates\", \"utils\", \"ajax\", \"actions\" ], function ({ inputsIO, notifications, templates, utils, ajax, actions }) {\n\n\tclass searchField {\n\t\tconstructor(name, virtual) {\n\t\t\tthis.name = name;\n\t\t\tthis.inputName = name;\n\t\t\tthis.virtual = virtual || false;\n\t\t\tthis.default = null;\n\t\t\tthis.input = false;\n\t\t\tthis.value = null;\n\t\t}\n\t\tvalueOrNullOnDefault() {\n\t\t\tif ((this.default instanceof Array) && (this.value instanceof Array))\n\t\t\t\treturn utils.isObjectsEqual(this.value, this.default) ? null : this.value;\n\n\t\t\treturn this.value === this.default ? null : this.value;\n\t\t}\n\t\tread() {\n\t\t\tif (this.virtual === \"search\")\n\t\t\t\treturn this.searchRead();\n\t\t\telse if (this.virtual)\n\t\t\t\treturn this.hashRead();\n\t\t\telse if (this.input)\n\t\t\t\tthis.value = inputsIO.readInputsValues(this.input);\n\n\t\t\treturn this.value;\n\t\t}\n\t\twrite() {\n\t\t\tif (this.input)\n\t\t\t\tinputsIO.writeInputsValue(this.value === null ? this.default : this.value, this.input);\n\t\t\treturn this.value;\n\t\t}\n\t\thashRead() {\n\t\t\tlet hashValue = page.history.hashObject[this.name];\n\t\t\treturn this.value = (typeof hashValue === \"undefined\") ? this.default : hashValue;\n\t\t}\n\t\tsearchRead () {\n\t\t\tlet searchValue = page.history.searchObject[this.name];\n\t\t\treturn this.value = (typeof searchValue === \"undefined\") ? this.default : searchValue;\n\t\t}\n\t}\n\n\t/**\n\t * Default options\n\t * @type {{}}\n\t */\n\tlet baseOptions = {\n\t\tfields: {},\n\t\thistoryType: \"hash\"\n\t};\n\n\t/* Creates new data operator */\n\tclass DataOperator {\n\t\tconstructor(options) {\n\n\t\t\t/* Stores last request object */\n\t\t\tthis.lastRequestData = false;\n\n\t\t\t/* Func that calls before request */\n\t\t\tthis.beforeRequest = false;\n\t\t\t\n\t\t\t/* Fields list */\n\t\t\tthis.fields = {};\n\n\t\t\t/* Add base options, but only not set, that's why so fun construction */\n\t\t\tthis.options = $.extend({}, baseOptions, true);\n\n\t\t\t/* Options init */\n\t\t\tthis.setOptions(options);\n\n\t\t}\n\n\t\t/** Saves to options */\n\t\tsetOptions(options) {\n\n\t\t\t/* Back link */\n\t\t\tlet self = this;\n\n\t\t\t/* Set submit handler */\n\t\t\tif (options.form)\n\t\t\t\t$(options.form).action(\"submit\", this.onFormSubmit.bind(this));\n\n\t\t\t/* Add to options */\n\t\t\t$.extend(this.options, options, true);\n\n\t\t\t/* Self return */\n\t\t\treturn this;\n\t\t}\n\n\t\t/**\n\t\t * On form submit\n\t\t * @param event\n\t\t */\n\t\tonFormSubmit(event) {\n\n\t\t\t/* Prevent */\n\t\t\tevent.preventDefault();\n\n\t\t\t/* If form not valid */\n\t\t\tif (!$(this.options.form).validForm())\n\t\t\t\treturn;\n\n\t\t\tlet options = {force: true};\n\n\t\t\tif (this.fields[\"page\"])\n\t\t\t\toptions[this.options.historyType === \"search\" ? \"search\" : \"hash\"] = {page: 1};\n\n\t\t\t/* Update */\n\t\t\tthis.reload(options);\n\n\t\t}\n\n\t\tprepareRequest(options) {\n\n\t\t\t/* On empty */\n\t\t\toptions = options || {};\n\n\t\t\t/* Hash fields */\n\t\t\tif (options[\"hash\"])\n\t\t\t\tpage.history.set(options[\"hash\"]);\n\n\t\t\t/* Hash fields */\n\t\t\tif (options[\"search\"])\n\t\t\t\tpage.history.search(options[\"search\"]);\n\n\t\t\t/* Hash fields */\n\t\t\tif (options[\"virtual\"]) {\n\t\t\t\tif (this.options.historyType === \"search\")\n\t\t\t\t\tpage.history.search(options[\"virtual\"]);\n\t\t\t\telse\n\t\t\t\t\tpage.history.set(options[\"virtual\"]);\n\t\t\t}\n\n\t\t\t/* Write to form from hash */\n\t\t\tif (options.fromUrl) {\n\t\t\t\tif (this.options.historyType === \"search\")\n\t\t\t\t\tthis.readSearch().writeForm();\n\t\t\t\telse\n\t\t\t\t\tthis.readHash().writeForm();\n\t\t\t}\n\n\t\t\t/* jQuery wrap */\n\t\t\tif (this.options.form && !$(this.options.form).validForm())\n\t\t\t\treturn false;\n\n\t\t\t/* Read */\n\t\t\tlet data = this.read();\n\n\t\t\t/* Add additional data */\n\t\t\tif (this.options[\"requestData\"])\n\t\t\t\tdata = $.extend(data, this.options[\"requestData\"]);\n\n\t\t\t/* Check is same and no force requested */\n\t\t\tif (this.lastRequestData !== false && utils.isObjectsEqual(this.lastRequestData, data) && !options[\"force\"])\n\t\t\t\treturn false;\n\n\t\t\t/* Set hash data */\n\t\t\tif (!options.fromUrl && this.options.historyType === \"search\")\n\t\t\t\tthis.writeSearch();\n\t\t\telse if (!options.fromUrl)\n\t\t\t\tthis.writeHash();\n\n\t\t\t/* Before request call */\n\t\t\tif (this.beforeRequest)\n\t\t\t\tif (this.beforeRequest(data, options) === false)\n\t\t\t\t\treturn false;\n\n\t\t\t/* Return data */\n\t\t\treturn data;\n\n\t\t}\n\n\t\t/**\n\t\t * Reloads data according to params\n\t\t * @param options\n\t\t * @returns {DataOperator}\n\t\t */\n\t\treload(options) {\n\n\t\t\t/* Prepare */\n\t\t\tlet data = this.prepareRequest(options);\n\n\t\t\t/* Reload */\n\t\t\tif (data)\n\t\t\t\tthis.request(data);\n\n\t\t\t/* Self return */\n\t\t\treturn this;\n\n\t\t}\n\n\t\t/**\n\t\t * Performs request to reload data\n\t\t * @param data\n\t\t */\n\t\trequest(data) {\n\n\t\t\t/* Back link */\n\t\t\tlet self = this;\n\n\t\t\t/* Save last data */\n\t\t\tself.lastRequestData = data;\n\n\t\t\t/* Stop old request */\n\t\t\tif (this.ajax)\n\t\t\t\tthis.ajax.stop();\n\n\t\t\t/* Request */\n\t\t\tthis.ajax = ajax(this.options.url, data)\n\t\t\t\t.on(\"success\", function (response) {\n\t\t\t\t\tself.lastResponse = response;\n\t\t\t\t\tself.render(response, data);\n\t\t\t\t})\n\t\t\t\t.on(\"error\", function (error) {\n\t\t\t\t\tself.error(error)\n\t\t\t\t})\n\t\t\t\t.on(\"always\", function () {\n\t\t\t\t\tself.ajax = false;\n\t\t\t\t});\n\n\t\t\t/* Create loading, auto remove when ajax finishes */\n\t\t\tnotifications.loading(this.ajax).reloadContent(this.options.holder);\n\n\t\t}\n\n\t\t/**\n\t\t * On success, have to be overloaded\n\t\t * @param data\n\t\t * @param request\n\t\t */\n\t\trender(data, request) {}\n\n\t\t/**\n\t\t * On error, have to be overloaded\n\t\t * @param error\n\t\t */\n\t\terror(error) {}\n\n\t\t/**\n\t\t * Adds list of fields to current list\n\t\t * @param {Array} list List of names\n\t\t * @param {Boolean} [virtual] Virtual fields flag\n\t\t */\n\t\tfieldsList(list, virtual) {\n\n\t\t\t/* Back link */\n\t\t\tlet self = this;\n\n\t\t\t/* Go through and push */\n\t\t\t$.each(list, function (_, item) {\n\t\t\t\tself.options.fields[item] = virtual;\n\t\t\t});\n\n\t\t\t/* Self return */\n\t\t\treturn this;\n\t\t\t\n\t\t}\n\n\t\t/**\n\t\t * Sets form fields\n\t\t * @param list\n\t\t * @returns {*}\n\t\t */\n\t\trealFieldsList(list) {\n\t\t\treturn this.fieldsList(list);\n\t\t}\n\n\t\t/**\n\t\t * Set none forms fields\n\t\t * @param list\n\t\t * @returns {*}\n\t\t */\n\t\tvirtualFieldsList(list) {\n\t\t\treturn this.fieldsList(list, true);\n\t\t}\n\n\t\t/**\n\t\t * Reads real fields\n\t\t * @returns {{}}\n\t\t */\n\t\treadReal() {\n\n\t\t\t/* Data holder */\n\t\t\tlet data = {};\n\n\t\t\t/* Go through */\n\t\t\t$.each(this.fields, function (i, field) {\n\t\t\t\t/** @let field searchField */\n\n\t\t\t\tif (field.virtual)\n\t\t\t\t\treturn;\n\n\t\t\t\t/* Read */\n\t\t\t\tfield.read();\n\n\t\t\t\t/* Get non default or null */\n\t\t\t\tlet val = field.valueOrNullOnDefault();\n\n\t\t\t\t/* If value not same as default */\n\t\t\t\tif (val !== null)\n\t\t\t\t\tdata[field.name] = val;\n\n\t\t\t});\n\n\t\t\t/* Self return */\n\t\t\treturn data;\n\n\t\t}\n\n\t\t/** Reads form to fields */\n\t\tread() {\n\n\t\t\t/* Data holder */\n\t\t\tlet data = {};\n\n\t\t\t/* Go through */\n\t\t\t$.each(this.fields, function (i, field) {\n\t\t\t\t/** @let field searchField */\n\n\t\t\t\t/* Read */\n\t\t\t\tfield.read();\n\n\t\t\t\t/* Get non default or null */\n\t\t\t\tlet val = field.valueOrNullOnDefault();\n\n\t\t\t\t/* If value not same as default */\n\t\t\t\tif (val !== null)\n\t\t\t\t\tdata[field.name] = val;\n\n\t\t\t});\n\n\t\t\t/* Self return */\n\t\t\treturn data;\n\t\t}\n\n\t\t/** Write current field to form */\n\t\twriteForm() {\n\t\t\t$.each(this.fields, function (i, field) {\n\t\t\t\t/** @let field searchField */\n\t\t\t\tfield.write();\n\t\t\t});\n\n\t\t\t/* Self return */\n\t\t\treturn this;\n\t\t}\n\n\t\t/** Reads hash to fields */\n\t\treadHash() {\n\t\t\t$.each(this.fields, function (i, field) {\n\t\t\t\t/** @let field searchField */\n\t\t\t\tfield.hashRead();\n\t\t\t});\n\n\t\t\t/* Self return */\n\t\t\treturn this;\n\t\t}\n\n\t\t/** Reads hash to fields */\n\t\treadSearch() {\n\t\t\t$.each(this.fields, function (i, field) {\n\t\t\t\t/** @let field searchField */\n\t\t\t\tfield.searchRead();\n\t\t\t});\n\n\t\t\t/* Self return */\n\t\t\treturn this;\n\t\t}\n\n\t\t/** Writes current fields to hash */\n\t\twriteHash() {\n\n\t\t\t/* To write */\n\t\t\tlet write = {};\n\n\t\t\t/* Go through */\n\t\t\t$.each(this.fields, function (i, field) {\n\t\t\t\t/** @let field searchField */\n\t\t\t\twrite[field.name] = field.valueOrNullOnDefault();\n\t\t\t});\n\n\t\t\t/* Write to hash */\n\t\t\tpage.history.set(write);\n\n\t\t\t/* Self return */\n\t\t\treturn this;\n\t\t}\n\n\t\t/** Writes current fields to hash */\n\t\twriteSearch() {\n\n\t\t\t/* To write */\n\t\t\tlet write = {};\n\n\t\t\t/* Go through */\n\t\t\t$.each(this.fields, function (i, field) {\n\t\t\t\t/** @let field searchField */\n\t\t\t\twrite[field.name] = field.valueOrNullOnDefault();\n\t\t\t});\n\n\t\t\t/* Write to hash */\n\t\t\tpage.history.search(write);\n\n\t\t\t/* Self return */\n\t\t\treturn this;\n\n\t\t}\n\n\t\t/** Finds inputs associated with fields */\n\t\tinitInputs() {\n\n\t\t\t/* Back link */\n\t\t\tlet self = this;\n\n\t\t\t$.each(this.options.fields, function (fieldName, virtual) {\n\n\t\t\t\t// Create search field\n\t\t\t\tlet field = new searchField(fieldName, virtual ? self.options.historyType : false);\n\n\t\t\t\t/** @let field searchField */\n\t\t\t\tif (!field.virtual) {\n\n\t\t\t\t\t/* Find input */\n\t\t\t\t\tif (field.name[0] === \"*\") {\n\t\t\t\t\t\tfield.name = field.name.substring(1);\n\t\t\t\t\t\tfield.input = $(self.options.form).find(\".selectReplaceChoose[data-input=\" + field.name + \"]\");\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t\tfield.input = $(self.options.form).find('[name=\"' + field.name + '\"]');\n\n\t\t\t\t\t/* Remove fields without input */\n\t\t\t\t\tif (!field.input || !field.input.length) {\n\t\t\t\t\t\tdelete self.fields[fieldName];\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\t/* Save */\n\t\t\t\t\tself.fields[fieldName] = field;\n\n\t\t\t\t\t/* Read default */\n\t\t\t\t\tfield.default = field.read();\n\t\t\t\t\tfield.value = null;\n\t\t\t\t} else {\n\t\t\t\t\tif (self.options.historyType === \"search\")\n\t\t\t\t\t\tfield.virtual = \"search\";\n\t\t\t\t\tself.fields[fieldName] = field;\n\t\t\t\t}\n\t\t\t});\n\n\t\t\t/* Self return */\n\t\t\treturn this;\n\t\t}\n\t};\n\n\t/* Interface */\n\tthis.service = {\n\t\tinitOperator: options => new DataOperator(options),\n\t\tsearchField: searchField,\n\t\tinitLoader: function (loader, notifications, pagination, { reload = true, history = true }) {\n\n\t\t\t/* Add count */\n\t\t\tloader.beforeRequest = function (data, options) {\n\t\t\t\tif (!this.lastRequestData || options.force)\n\t\t\t\t\tdata[\"count\"] = true;\n\t\t\t};\n\n\t\t\t/* Render function */\n\t\t\tloader.render = function (response) {\n\n\t\t\t\t// Re render\n\t\t\t\t$(this.options.holder).html('').append(\n\t\t\t\t\ttemplates.render(\"page-result-render\", response)\n\t\t\t\t);\n\n\t\t\t\t// Remove old\n\t\t\t\tif (this.pagination)\n\t\t\t\t\tthis.pagination = this.pagination.remove();\n\n\t\t\t\tif (typeof response.pages !== \"undefined\") {\n\n\t\t\t\t\t// Pages holder\n\t\t\t\t\tlet holder = $(\"#pages\").html('');\n\n\t\t\t\t\t// Create new\n\t\t\t\t\tif (response.pages > 1 && pagination) {\n\t\t\t\t\t\tthis.pagination = pagination.add({\n\t\t\t\t\t\t\tpages: response.pages,\n\t\t\t\t\t\t\tcurrent: response.page,\n\t\t\t\t\t\t\tholder: holder\n\t\t\t\t\t\t});\n\t\t\t\t\t\tthis.pagination.onPageChange = function (pageNum) {\n\t\t\t\t\t\t\tloader.reload({virtual: {page: pageNum}});\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t};\n\n\t\t\t/* On loading error */\n\t\t\tloader.error = function (error) {\n\n\t\t\t\t// Remove pagination on error\n\t\t\t\tif (this.pagination)\n\t\t\t\t\tthis.pagination = this.pagination.remove();\n\n\t\t\t\t// Clear\n\t\t\t\t$(this.options.holder).html('').append(notifications.message({text: error}).render);\n\t\t\t};\n\n\t\t\t/* Reload */\n\t\t\tif (reload)\n\t\t\t\tloader.reload({fromUrl: true});\n\n\t\t\t/* Set handler */\n\t\t\tif (history)\n\t\t\t\tpage.history.on(\"change\", function (searchChanged, hashChanged) {\n\t\t\t\t\tif (searchChanged || hashChanged)\n\t\t\t\t\t\tloader.reload({fromUrl: true});\n\t\t\t\t});\n\n\t\t}\n\t}\n\n});","sky.service(\"inputsIO\", function () {\n\n\tthis.service = {\n\n\t\t/**\n\t\t * Get value of single input\n\t\t * @param input\n\t\t * @returns {*}\n\t\t */\n\t\treadInputValue: function (input) {\n\n\t\t\tif (input.is(\".selectReplaceChoose\")) {\n\n\t\t\t\t// Get inputs\n\t\t\t\tlet inputs = input.find(\"input\");\n\n\t\t\t\t// Read\n\t\t\t\tlet data = this.readInputsValues(inputs);\n\n\t\t\t\t// If all checked\n\t\t\t\tif (data.length === inputs.length)\n\t\t\t\t\treturn true;\n\n\t\t\t\t// Return data\n\t\t\t\treturn data;\n\n\t\t\t} else if (input.is(\":checkbox\") || input.is(\":radio\")) {\n\t\t\t\treturn input.is(\":checked\") ? input.val() : false;\n\t\t\t} else\n\t\t\t\treturn input.val() === \"\" ? false : input.val();\n\n\n\t\t},\n\n\t\t/**\n\t\t * Get value of multiple inputs\n\t\t * @param inputs\n\t\t * @returns {*}\n\t\t */\n\t\treadInputsValues: function (inputs) {\n\n\t\t\t/* If single input */\n\t\t\tif (inputs.length === 1)\n\t\t\t\treturn this.readInputValue(inputs);\n\n\t\t\t/* Values holder */\n\t\t\tlet valuesNamed = [],\n\t\t\t\tvaluesLined = [],\n\t\t\t\tself = this;\n\n\t\t\t/* Go through */\n\t\t\tinputs.each(function () {\n\n\t\t\t\t/* Get value */\n\t\t\t\tlet input = $(this),\n\t\t\t\t\tvalue = self.readInputValue(input);\n\n\t\t\t\t/* If we get values */\n\t\t\t\tif (value !== false) {\n\t\t\t\t\tvaluesNamed.push({name: input.attr(\"name\"), value: value});\n\t\t\t\t\tvaluesLined.push(value);\n\t\t\t\t}\n\n\t\t\t});\n\n\t\t\t/* Single */\n\t\t\tif (valuesLined.length === 1) {\n\t\t\t\treturn valuesLined[0];\n\t\t\t}\n\n\t\t\t/* Return */\n\t\t\treturn valuesLined.length ? valuesLined : false;\n\n\t\t},\n\n\t\t/**\n\t\t * Write single input value\n\t\t * @param value\n\t\t * @param input\n\t\t * @returns {*}\n\t\t */\n\t\twriteInputValue: function (value, input) {\n\n\t\t\tif (input.is(\".selectReplaceChoose\")) {\n\n\t\t\t\t// Get inputs\n\t\t\t\tlet inputs = input.find(\"input\");\n\n\t\t\t\t// If all checked\n\t\t\t\tif (value === true)\n\t\t\t\t\tinputs.prop(\"checked\", true);\n\t\t\t\telse\n\t\t\t\t\tthis.writeInputsValue(value, inputs);\n\n\t\t\t\tif (inputs.length)\n\t\t\t\t\tinputs.first().trigger(\"change\", {notByUser: true});\n\n\t\t\t} else if (input.is(\":checkbox\") || input.is(\":radio\")) {\n\t\t\t\treturn input.prop(\"checked\", value !== false);\n\t\t\t} else\n\t\t\t\treturn input.val(value === false ? \"\" : value);\n\t\t},\n\n\t\t/**\n\t\t * Write multiple inputs value\n\t\t * @param values\n\t\t * @param inputs\n\t\t * @returns {*}\n\t\t */\n\t\twriteInputsValue: function (values, inputs) {\n\n\t\t\t/* Write single */\n\t\t\tif (inputs.length < 2)\n\t\t\t\treturn this.writeInputValue(values, inputs);\n\n\t\t\t/* Multiple */\n\t\t\tif (inputs.is(\":checkbox\") || inputs.is(\":radio\")) {\n\t\t\t\tinputs.prop(\"checked\", false);\n\t\t\t\tif (values instanceof Array) {\n\t\t\t\t\t$.each(values, function (_, val) {\n\t\t\t\t\t\tinputs.filter('[value=\"' + val + '\"]').prop(\"checked\", true);\n\t\t\t\t\t});\n\t\t\t\t\tinputs.first().trigger(\"change\", {notByUser: true});\n\t\t\t\t} else {\n\t\t\t\t\tif (values === false || values === true)\n\t\t\t\t\t\tinputs.prop(\"checked\", values).first().trigger(\"change\", {notByUser: true});\n\t\t\t\t\telse\n\t\t\t\t\t\tinputs.filter('[value=\"' + values + '\"]').prop(\"checked\", true).trigger(\"change\", {notByUser: true});\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tinputs.val(values);\n\t\t\t}\n\t\t}\n\n\t}\n\n});","sky.service(\"directives\", [\"exceptions\"], function ({exceptions}) {\n\n\tlet list = {},\n\t\tdirectives = this.service = {\n\n\t\t\t/**\n\t\t\t * Adds new directive\n\t\t\t * @param {string} name Directive name\n\t\t\t * @param {*} options Directive options\n\t\t\t * @param {function} directive How to parse directive\n\t\t\t */\n\t\t\tadd: function (name, options, directive) {\n\n\t\t\t\t/* Reset */\n\t\t\t\tif (!directive && typeof options === \"function\") {\n\t\t\t\t\tdirective = options;\n\t\t\t\t\toptions = {};\n\t\t\t\t}\n\t\t\t\toptions.directive = directive;\n\t\t\t\toptions.selector = name;\n\n\t\t\t\t/* Save */\n\t\t\t\tlist[name] = options;\n\n\t\t\t\t/* Self return*/\n\t\t\t\treturn this;\n\n\t\t\t},\n\n\t\t\t/**\n\t\t\t * Get element attributes\n\t\t\t * @param element\n\t\t\t * @returns {{}}\n\t\t\t */\n\t\t\tgetAttributes: function (element) {\n\n\t\t\t\t/* Holds attributes */\n\t\t\t\tlet attributes = {};\n\n\t\t\t\t/* Copy them to list */\n\t\t\t\tfor(let attr of element.get(0).attributes)\n\t\t\t\t\tattributes[attr.nodeName] = attr.nodeValue;\n\n\t\t\t\t/* Return */\n\t\t\t\treturn attributes;\n\n\t\t\t},\n\n\t\t\t/**\n\t\t\t * Applies directive convert to element\n\t\t\t * @param element\n\t\t\t * @param options\n\t\t\t */\n\t\t\tparseElement: function (element, options) {\n\n\t\t\t\t/* Get element */\n\t\t\t\telement = $(element);\n\n\t\t\t\t/* Get element attributes */\n\t\t\t\tlet attributes = this.getAttributes(element);\n\n\t\t\t\t/* Parse body for jason data */\n\t\t\t\tif (options[\"json\"] || options[\"jsonToData\"]) {\n\n\t\t\t\t\t/* Get child */\n\t\t\t\t\tlet jsonScript = element.children('script[type=\"application/json\"]');\n\n\t\t\t\t\t/* If we have json encoded data */\n\t\t\t\t\tif (jsonScript.length) {\n\n\t\t\t\t\t\ttry {\n\n\t\t\t\t\t\t\t/* Parse json */\n\t\t\t\t\t\t\tlet json = JSON.parse(jsonScript.text());\n\n\t\t\t\t\t\t\t/* Extend */\n\t\t\t\t\t\t\t$.extend(attributes, json);\n\n\t\t\t\t\t\t\t/* Save to data */\n\t\t\t\t\t\t\tif (options[\"jsonToData\"])\n\t\t\t\t\t\t\t\telement.data(\"json\", json);\n\n\t\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\t\tthrow new exceptions.system.Error(\"Element \" + options.selector + \" should have json stored content, but error on parse appears\");\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t/* Call parse function */\n\t\t\t\tif (typeof options.directive === \"function\")\n\t\t\t\t\toptions.directive(element, attributes);\n\t\t\t},\n\n\t\t\t/**\n\t\t\t * Searches and replaces directives in element\n\t\t\t * @param element\n\t\t\t */\n\t\t\tparse: function (element) {\n\t\t\t\t$.each(list, function (tag, options) {\n\t\t\t\t\t$(tag, element).each(function () {\n\t\t\t\t\t\tdirectives.parseElement(this, options);\n\t\t\t\t\t});\n\t\t\t\t\tif (element.is(tag))\n\t\t\t\t\t\tdirectives.parseElement(element, options);\n\t\t\t\t});\n\t\t\t}\n\n\n\t\t};\n\n\t/* Add jQuery fn */\n\tjQuery.fn.parseDirectives = function () {\n\n\t\t/* Parse */\n\t\tdirectives.parse(this);\n\n\t\t/* Return */\n\t\treturn this;\n\n\t};\n\n\t/* Parse body for directives when all ready */\n\tsky.onReady(function () {\n\t\t$(\"body\").parseDirectives();\n\t});\n\n});","sky.service(\"drag\", [\"callbacks\"], function({callbacks}) {\n\tlet self = {\n\t\tbindEvents: (event, events) => {\n\t\t\tself.bind(event)\n\t\t\t\t.on(\"start\", events.start)\n\t\t\t\t.on(\"move\", events.move)\n\t\t\t\t.on(\"stop\", events.stop)\n\t\t},\n\t\tbind: event => {\n\n\t\t\t// Get original event\n\t\t\tevent = event.originalEvent || event;\n\n\t\t\t// Init vars\n\t\t\tlet started = false,\n\t\t\t\tcallbacks = callbacks();\n\n\t\t\t// Check button\n\t\t\tif(event.button && event.button !== 1)\n\t\t\t\treturn callbacks;\n\n\t\t\t// Stop default action\n\t\t\tevent.preventDefault();\n\n\t\t\t$(document).on(\"mousemove.drag\", function(event) {\n\n\t\t\t\t// Start\n\t\t\t\tif(!started) {\n\t\t\t\t\tstarted = true;\n\t\t\t\t\tcallbacks.fire(\"start\", { event: event, x: event.pageX, y: event.pageY });\n\t\t\t\t}\n\t\t\t\t// Move\n\t\t\t\telse callbacks.fire(\"move\", { event: event, x: event.pageX, y: event.pageY });\n\n\t\t\t\t// Prevent default\n\t\t\t\tevent.preventDefault();\n\t\t\t\treturn false;\n\n\t\t\t}).on(\"mouseup.drag\", function(event) {\n\n\t\t\t\t// Off events\n\t\t\t\t$(document).off(\"mousemove.drag\").off(\"mouseup.drag\");\n\n\t\t\t\t// If not started\n\t\t\t\tif(!started)\n\t\t\t\t\treturn;\n\n\t\t\t\t// Stop default action\n\t\t\t\tevent.preventDefault();\n\n\t\t\t\t// Call stop callback\n\t\t\t\tcallbacks.fire(\"stop\", { event: event, x: event.pageX, y: event.pageY });\n\n\t\t\t});\n\n\t\t\treturn callbacks;\n\t\t}\n\t};\n\treturn self;\n});","sky.service(\"history\", [ \"callbacks\", \"supported\" ], function ({ callbacks, supported }) {\n\n\n\t/**\n\t * Get difference fields in objects\n\t * @param {object} first  Object to compare\n\t * @param {object} second Object to compare\n\t */\n    let getObjectsDifference = function (first, second) {\n\n\t\tlet difference = {},\n\t\t    localDiff = false;\n\n        /* If both arrays or objects */\n\t\tif ((first instanceof Array && second instanceof Array) || (first instanceof Object && second instanceof Object)) {\n\n            /* Find what was changed or deleted in second */\n\t\t\t$.each(first, function (key, value) {\n\n                /* If no such elements in second */\n\t\t\t\tif (typeof second[key] === \"undefined\")\n\t\t\t\t\tdifference[key] = null; // Set to null\n\n                /* Check if different */\n\t\t\t\telse if (localDiff = getObjectsDifference(value, second[key])) {\n\t\t\t\t\tdifference[key] = localDiff;\n\t\t\t\t}\n\n\t\t\t});\n\n            /* If was added */\n\t\t\t$.each(second, function (key, value) {\n\t\t\t\tif (typeof first[key] === \"undefined\")\n\t\t\t\t\tdifference[key] = value;\n\t\t\t});\n\n            /* Convert object to array */\n\t\t\tif (first instanceof Array) {\n\t\t\t\tlet returnArray = [];\n\t\t\t\t$.each(difference, function (key) {\n\t\t\t\t\treturnArray.push(difference[key]);\n\t\t\t\t});\n\t\t\t\tdifference = returnArray;\n\t\t\t}\n\n\t\t} else {\n\t\t\tif (first !== second) return second;\n\t\t\telse return false;\n\t\t}\n\n        /* No array difference */\n\t\tif (difference.length === 0) return false;\n\t\telse return difference;\n\n\t};\n\n    /**\n     * History constructor\n     * @param [options]\n     * @returns {sky.History}\n     * @constructor\n     */\n    sky.History = function (options) {\n\n\t\t/* Self creation */\n        if (!(this instanceof sky.History))\n            return new sky.History(options);\n\n\t\t/* Reset */\n        this.options = options || {};\n\n\t\t/* Set events */\n        this.events = this.options.events || new callbacks();\n        this.options.events = this.events;\n\n\t\t/* Self return */\n        return this;\n\n    };\n\n    /**\n     * Extending\n     */\n    $.extend(sky.History.prototype, {\n\n        /**\n         * Stores last saved hash\n         */\n        hashString: \"\",\n\n        /**\n         * Stores last saved search\n         */\n        searchString: \"\",\n\n        /**\n         * Stores last saved path\n         */\n        pathString: \"\",\n\n        /**\n         * Stores object with hash params key/value pairs\n         */\n        hashObject: {},\n\n        /**\n         * Stores object with page search params key/value pairs\n         */\n        searchObject: {},\n\n        /**\n         * Stores events\n         */\n        events: undefined,\n\n        /**\n         * Holds hash check function interval id\n         */\n        intervalId: 0,\n\n        /**\n         * This page base url\n         */\n        base: \"\",\n\n        /**\n         * Changes current path to specified\n         * @param {string} path PAth to navigate\n         */\n        navigate: function (path) {\n\n            // Get path\n            path = path.replace(\"~\", this.base);\n\n            // Get current\n            let current = (window.location.pathname + window.location.search).substr(this.base.length);\n\n            // If changes\n            if (current !== path) {\n\n                // Set new state\n                history.pushState({ oldPath: this.pathString, newPath: path, search: this.searchObject}, path, path);\n\n                // Get new\n                this.pathString = window.location.pathname.substr(this.base.length);\n\n                // Get search string\n                this.searchString = this.getWindowSearch();\n\n                // Fire event\n                this.events.fire(\"navigate.path, always\", {hash: this.hashObject, path: this.pathString, search: this.searchObject});\n\n            }\n        },\n\n        /**\n         * Fires on path change\n         */\n        change: function () {\n\n\t\t\t/* Hash difference holder */\n            let hashDifference = {},\n                searchDifference = {},\n                old = this.pathString,\n                hashChanged = false,\n                searchChanged = false;\n\n\t\t\t/* If api supported */\n            if (this.supported)\n                this.pathString = window.location.pathname.substr(this.base.length);\n\n\t\t\t/* Check if hash changed */\n            if (this.hashString !== this.getWindowHash()) {\n\n\t\t\t\t/* Get difference */\n                hashDifference = this.getDifference(this.getWindowHash(), this.hashObject);\n\n\t\t\t\t/* Hash change flag */\n                hashChanged = true;\n\n            }\n\n\t\t\t/* Check if params changed */\n            if (this.searchString !== this.getWindowSearch()) {\n\n\t\t\t\t/* Get difference */\n                searchDifference = this.getDifference(this.getWindowSearch(), this.searchObject);\n\n\t\t\t\t/* Hash change flag */\n                searchChanged = true;\n\n            }\n\n\t\t\t/* If nothing changed */\n            if (this.pathString === old && !hashChanged && !searchChanged)\n                return;\n\n\t\t\t/* Rebuild hash object on new hash str */\n            this.rebuild();\n\n\t\t\t/* Fire */\n            this.events.fire(\"change, always\", {\n                hash: this.hashObject,\n                hashDifference: hashDifference,\n                searchDifference: searchDifference,\n                path: this.pathString,\n                oldPath: old,\n                searchChanged: searchChanged,\n                hashChanged: hashChanged,\n                pathChanged: old !== this.pathString\n            });\n\n        },\n\n        /**\n         * Navigates to specified path\n         * @param path\n         */\n        setHash: function (path) {\n\n\t\t\t/* To not jump top */\n            if (path === \"\" && window.location.hash !== \"\")\n                path = \"none\";\n\n\t\t\t/* Save */\n            this.hashString = path;\n\n\t\t\t/* Set hash */\n            window.location.hash = encodeURI(path);//encodeURI(path);\n\n        },\n\n        /**\n         * Navigates to specified path\n         * @param path\n         */\n        setSearch: function (path) {\n\n\t\t\t/* Set path */\n            this.navigate(window.location.pathname + encodeURI(path !== \"\" ? \"?\" + path : \"\"));\n\n        },\n\n        /**\n         * Sets hash letiable\n         * @param {object}    elements Fields to be set\n         * @param {boolean}    [force]     Replace all stored fields with elements object\n         */\n        set: function (elements, force) {\n\n            let changed = false;\n\n\t\t\t/* Force rewrite */\n            if (force)\n                this.hashObject = elements;\n\n\t\t\t/* Go through elements and add or change them */\n            $.each(elements, (key, value) => {\n\n\t\t\t\t/* If we need delete */\n                if (value === null)\n                    delete this.hashObject[key];\n                else\n                    this.hashObject[key] = value;\n\n\t\t\t\t/* Set as changed */\n                changed = true;\n\n            });\n\n\t\t\t/* If any changes we rebuild hash */\n            if (changed || force)\n                this.setHash(decodeURIComponent(jQuery.param(this.hashObject).replace(/\\+/g, \" \")));\n\n\t\t\t/* Fire */\n            this.events.fire(\"set, always\", {elements: elements, hash: this.hashObject, path: this.pathString});\n\n        },\n\n\n        /**\n         * Sets hash letiable\n         * @param {object}    elements Fields to be set\n         * @param {boolean}    [force]     Replace all stored fields with elements object\n         */\n        search: function (elements, force) {\n\n            let changed = false;\n\n\t\t\t/* Force rewrite */\n            if (force)\n                this.searchObject = elements;\n\n\t\t\t/* Go through elements and add or change them */\n            $.each(elements, $.proxy(function (key, value) {\n\n\t\t\t\t/* If we need delete */\n                if (value === null)\n                    delete this.searchObject[key];\n                else\n                    this.searchObject[key] = value;\n\n\t\t\t\t/* Set as changed */\n                changed = true;\n\n            }, this));\n\n\t\t\t/* If any changes we rebuild hash */\n            if (changed || force)\n                this.setSearch(decodeURIComponent(jQuery.param(this.searchObject).replace(/\\+/g, \" \")));\n\n\t\t\t/* Fire */\n\t\t\tthis.events.fire(\"set, always\", {elements: elements, hash: this.hashObject, path: this.pathString});\n\n        },\n\n        /**\n         * Makes hash from object\n         * @param obj\n         * @returns {*|void|string|XML}\n         */\n        stringFromObject: function (obj) {\n            return jQuery.param(obj).replace(/\\+/g, \" \");\n        },\n\n        /**\n         * Get objects according to hash string\n         * @param {string} paramsString String which contains key=value pairs, would be parsed to object\n         */\n        getObjects: function (paramsString) {\n\n            let objects = {};\n\n\t\t\t/* Remove sharp */\n            if (paramsString.substr(0, 1) === '#' || paramsString.substr(0, 1) === '?')\n                paramsString = paramsString.slice(1, paramsString.length);\n\n\t\t\t/* Split parameters */\n            let subStrings = paramsString.split(\"&\");\n\n\t\t\t/* Get params */\n            $.each(subStrings, function (i, str) {\n\n                let keyAndValue = str.split(\"=\", 2);\n\n\t\t\t\t/* If no assign */\n                if (keyAndValue.length < 2)\n                    return;\n\n                let name = keyAndValue[0];\n\n\t\t\t\t/* Truncate brackets */\n                if (name.substr(-2) === \"[]\")\n                    name = name.substr(0, name.length - 2);\n\n\t\t\t\t/* Special hash for \"=\" in value  */\n                keyAndValue[1] = str.substr(keyAndValue[0].length + 1);\n\n\t\t\t\t/* If object repeats we create array */\n                if (typeof objects[name] === \"undefined\") objects[name] = keyAndValue[1];\n                else {\n                    if (!(objects[name] instanceof Array)) objects[name] = [objects[name]];\n                    objects[name].push(keyAndValue[1]);\n                }\n            });\n\n            return objects;\n\n        },\n\n        /**\n         * Finds difference between current stored hash and parameter\n         * @returns {*}\n         */\n        getDifference: function (string, stored) {\n\n\t\t\t/* Init */\n            let objects = this.getObjects(decodeURI(string));\n            return getObjectsDifference(stored, objects);\n\n        },\n\n        /**\n         * Rebuilds stored hash parameters according to current one\n         */\n        rebuild: function () {\n            this.hashString = this.getWindowHash();\n            this.hashObject = this.getObjects(this.hashString);\n            this.searchString = this.getWindowSearch();\n            this.searchObject = this.getObjects(this.searchString);\n            this.pathString = window.location.pathname;\n            return this;\n\n        },\n\n        /**\n         * Gets current window hash without \"#\"\n         * @returns {string}\n         */\n        getWindowHash: function () {\n\n\t\t\t/* Get decoded hash */\n            let hash = decodeURI(window.location.hash);\n\n\t\t\t/* Remove sharp */\n            if (hash.substr(0, 1) === '#')\n                hash = hash.slice(1);\n\n\t\t\t/* Return */\n            return hash;\n\n        },\n\n        /**\n         * Gets current window parameters without \"?\"\n         * @returns {string}\n         */\n        getWindowSearch: function () {\n\n\t\t\t/* Get decoded hash */\n            let search = decodeURI(window.location.search);\n\n\t\t\t/* Remove question */\n            if (search.substr(0, 1) === '?')\n                search = search.slice(1);\n\n\t\t\t/* Return */\n            return search;\n\n        },\n\n        /**\n         * Set interval execution\n         */\n        start: function () {\n\n            /* Set base if any */\n\t\t\tif (this.options.base)\n\t\t\t\tthis.base = this.options.base;\n\n\t\t\t/* If supported history */\n            if (window.history)\n                window.onpopstate = this.change.bind(this);\n\n            /* Timeout */\n            if (!this.intervalId)\n                this.intervalId = setInterval(this.change.bind(this), this.options.time || 500);\n\n\t\t\t/* Immediately event */\n            this.change();\n            return this;\n        }\n\n    });\n\n});","sky.service(\"localStorage\", [ \"callbacks\" ], function({ callbacks }) {\n\n\t/**\n\t * Local storage class\n\t * @param {Object} options Creation options\n\t * @param {sky.Callbacks} [events] Events handler\n\t * @returns {*}\n\t * @constructor\n\t */\n\tlet LocalStorage = this.service = class {\n\t\tconstructor(options, events) {\n\n\t\t\t/* If already */\n\t\t\tif(options instanceof LocalStorage)\n\t\t\t\treturn options;\n\n\t\t\t/* Self creating if not in constructor */\n\t\t\tif(!(this instanceof LocalStorage))\n\t\t\t\treturn new LocalStorage(options, events);\n\n\t\t\t/* Options */\n\t\t\toptions = options || {};\n\n\t\t\t/* Set default name */\n\t\t\tif(!options.name)\n\t\t\t\toptions.name = \"global\";\n\n\t\t\t/* Set prefix */\n\t\t\tif(!options.prefix)\n\t\t\t\toptions.prefix = options.name;\n\n\t\t\t/* Set full name */\n\t\t\tthis.fullName = [\"sky\", options.name].join(\"-\");\n\n\t\t\t/* Stored item prefix */\n\t\t\tthis.itemPrefix = [\"sky\", options.prefix].join(\"-\");\n\n\t\t\t/* Get events */\n\t\t\tthis.events = events || new callbacks();\n\n\t\t\t/* Ids list */\n\t\t\tthis.ids = false;\n\n\t\t\t/* Return */\n\t\t\treturn this;\n\n\t\t}\n\n\t\t/**\n\t\t * Loads item form database\n\t\t * @param {*} id Unique id\n\t\t * @param {function} [onLoad] Calls when load complete\n\t\t */\n\t\tload(id, onLoad) {\n\n\t\t\t/* Try to get item from storage */\n\t\t\tlet item = localStorage.getItem([this.itemPrefix, id].join(\"-\"));\n\n\t\t\t/* Trigger error */\n\t\t\tif(item === null)\n\t\t\t\tthis.events.fire(\"load.error\", { id: id, storage: this });\n\n\t\t\t/* Call function */\n\t\t\tif(onLoad)\n\t\t\t\tonLoad(item ? $.parseJSON(item) : undefined);\n\n\t\t\t/* Return */\n\t\t\treturn item ? $.parseJSON(item) : undefined;\n\n\t\t}\n\n\t\t/**\n\t\t * Get all ids from database\n\t\t * @returns {*}\n\t\t */\n\t\tgetIds() {\n\n\t\t\t/* If already stored */\n\t\t\tif(this.ids instanceof Array)\n\t\t\t\treturn this.ids;\n\n\t\t\t/* Gets ids list by key */\n\t\t\tlet itemsIds = localStorage.getItem(this.fullName), self = this;\n\n\t\t\t/* SAve and return */\n\t\t\titemsIds = itemsIds ? itemsIds.split(\", \") : [];\n\t\t\tthis.ids = [];\n\n\t\t\t/* remove duplicates */\n\t\t\t$.each(itemsIds, function(_, id) {\n\t\t\t\tif(self.ids.indexOf(id) < 0)\n\t\t\t\t\tself.ids.push(id);\n\t\t\t});\n\n\t\t\t/* return */\n\t\t\treturn this.ids;\n\n\t\t}\n\n\t\t/**\n\t\t * Loads all element from storage\n\t\t * @param onLoad\n\t\t */\n\t\tloadAll(onLoad) {\n\n\t\t\t/* Item holder */\n\t\t\tlet self = this, items = {};\n\n\t\t\t/* Go through items */\n\t\t\t$.each(this.getIds(), function(_, id) {\n\n\t\t\t\t/* Get item */\n\t\t\t\tself.load(id, function(item) {\n\n\t\t\t\t\t/* Add parsed */\n\t\t\t\t\tif(item) items[id] = item;\n\t\t\t\t\telse delete self.ids[id];\n\n\t\t\t\t});\n\n\t\t\t});\n\n\t\t\t/* Trigger error */\n\t\t\tif(!self.ids.length)\n\t\t\t\tthis.events.fire(\"empty\", { storage: this });\n\n\t\t\t/* Return */\n\t\t\tonLoad.call(this, items);\n\n\t\t}\n\n\t\t/**\n\t\t * Save data to storage\n\t\t * @param id\n\t\t * @param data\n\t\t * @returns {*}\n\t\t */\n\t\tsave(id, data) {\n\n\t\t\ttry {\n\n\t\t\t\t/* Save item */\n\t\t\t\tlocalStorage.setItem([this.itemPrefix, id].join(\"-\"), JSON.stringify(data));\n\n\t\t\t\t/* Get ids */\n\t\t\t\tlet ids = this.getIds();\n\n\t\t\t\t/* Save id */\n\t\t\t\tif(ids.indexOf(id) < 0)\n\t\t\t\t\tids.push(id);\n\n\t\t\t\t/* Save keys */\n\t\t\t\tlocalStorage.setItem(this.fullName, ids.join(\", \"));\n\n\t\t\t\t/* Trigger event */\n\t\t\t\tthis.events.fire(\"save.success\", { storage: this, data: data, id: id });\n\n\t\t\t} catch(e) {\n\t\t\t\tconsole.log(e);\n\t\t\t}\n\n\t\t\t/* Self return */\n\t\t\treturn this;\n\n\t\t}\n\n\t\t/**\n\t\t * Saves all\n\t\t * @param index\n\t\t * @param models\n\t\t * @returns {*}\n\t\t */\n\t\tsaveAll(index, models) {\n\t\t\tlet self = this;\n\n\t\t\t/* Go through */\n\t\t\t$.each(models, function() {\n\t\t\t\tself.save(this.attr(index), this.attributes);\n\t\t\t});\n\n\t\t\treturn this;\n\t\t}\n\n\t\t/**\n\t\t * Removes from storage\n\t\t * @param id\n\t\t * @returns {*}\n\t\t */\n\t\tremove(id) {\n\n\t\t\t/* Init */\n\t\t\tlet index,\n\t\t\t\tids = this.getIds(); // Get ids\n\n\t\t\t/* Remove item */\n\t\t\tlocalStorage.removeItem([this.itemPrefix, id].join(\"-\"));\n\n\t\t\t/* Remove from list */\n\t\t\tif((index = ids.indexOf(id)) > -1) {\n\n\t\t\t\t/* Remove id */\n\t\t\t\tids.splice(index, 1);\n\n\t\t\t\t/* Save keys */\n\t\t\t\tlocalStorage.setItem(this.fullName, ids.join(\", \"));\n\n\t\t\t\t/* Trigger event */\n\t\t\t\tthis.events.fire(\"success.remove\", { storage: this, id: id });\n\n\t\t\t}\n\t\t\t/* If no id */\n\t\t\telse\n\t\t\t\tthis.events.fire(\"remove.error\", { storage: this, id: id });\n\n\n\t\t\t/* Self return */\n\t\t\treturn this;\n\n\t\t}\n\t};\n\n});","sky.service(\"model\", [ \"modelsStorage\", \"callbacks\" ], function({ modelsStorage, callbacks }) {\n\n\t/**\n\t * List of model definitions\n\t */\n\tlet modelsDefinition = {};\n\n\tclass Model {\n\t\tconstructor(type, data) {\n\n\t\t\t/* Init as base */\n\t\t\tthis.definition = BaseDefinition;\n\n\t\t\t/* Get special if defined */\n\t\t\tif(modelsDefinition[type])\n\t\t\t\tthis.definition = modelsDefinition[type];\n\n\t\t\t/* Save id */\n\t\t\tthis.id = data[this.definition.id] || null;\n\t\t\tthis.type = type;\n\t\t\tthis.data = {};\n\t\t\tthis.callbacks = callbacks();\n\t\t\tthis.definition.creation.bind(this)($.extend({}, data, true));\n\n\t\t}\n\t\textend(data) {\n\t\t\tthis.definition.extension.bind(this)($.extend({}, data, true));\n\t\t\treturn this.changed();\n\t\t}\n\t\tchanged() {\n\t\t\tthis.callbacks.fire(\"change\", {model: this});\n\t\t\treturn this;\n\t\t}\n\t\tremoveFromStorage() {\n\t\t\tmodelsStorage.remove(this);\n\t\t}\n\t\taddListener(func) {\n\t\t\tthis.callbacks.on(\"change\", func);\n\t\t}\n\t\tremoveListener(func) {\n\t\t\tthis.callbacks.off(\"change\", func);\n\t\t}\n\t}\n\n\t/**\n\t * Base model definition witch would be parented\n\t */\n\tlet BaseDefinition = {\n\t\tid: \"id\",\n\t\tcreation: function(data) {\n\t\t\tthis.data = data;\n\t\t},\n\t\textension: function(data) {\n\t\t\t$.extend(true, this.data, data);\n\t\t}\n\t};\n\n\tthis.service = {\n\t\t/**\n\t\t * Adds new models definition\n\t\t * @param name\n\t\t * @param definition\n\t\t */\n\t\taddDefinition: function(name, definition) {\n\t\t\tmodelsDefinition[name] = $.extend({}, BaseDefinition, definition);\n\t\t},\n\n\t\tfromData: function(type, data) {\n\n\t\t\tlet model = new this.Model(type, data);\n\t\t\tlet cached = modelsStorage.add(model);\n\n\t\t\tif(cached)\n\t\t\t\treturn cached.extend(data);\n\n\t\t\treturn model;\n\n\t\t}\n\t};\n\n});","sky.service(\"modelsManager\", [\"callbacks\", \"model\"], function({callbacks, model}) {\n\tclass Manager {\n\t\tconstructor(type, arr) {\n\n\t\t\tthis.items = [];\n\t\t\tthis.type = type;\n\t\t\tthis.callbacks = callbacks();\n\n\t\t\t$.each(arr, (_, model) => {\n\t\t\t\tthis.items.push(model)\n\t\t\t});\n\t\t}\n\t\treloadFromArray(arr) {\n\t\t\tthis.items = [];\n\t\t\t$.each(arr, (_, data) => {\n\t\t\t\tthis.items.push(model.fromData(this.type, data))\n\t\t\t});\n\t\t}\n\t\tcount() {\n\t\t\treturn this.items.length;\n\t\t}\n\t\taddListener(func) {\n\t\t\tthis.callbacks.on(\"change\", func);\n\t\t}\n\t\tremoveListener(func) {\n\t\t\tthis.callbacks.off(\"change\", func);\n\t\t}\n\t}\n\n\tthis.service = {\n\t\tfromArray: function(type, arr) {\n\t\t\tlet items = [];\n\t\t\t$.each(arr, (_, data) => {\n\t\t\t\titems.push(sky.model.fromData(type, data));\n\t\t\t});\n\t\t\treturn new Manager(type, items);\n\t\t}\n\t};\n\n});","sky.service(\"modelsStorage\", function() {\n\n    let cache = {};\n\n    this.service = {\n\t\tadd: function(model) {\n\n\t\t\t// Search in cache\n\t\t\tlet cached = this.search(model.type, model.id);\n\n\t\t\t// If found extend\n\t\t\tif(cached)\n\t\t\t\treturn cached;\n\n            // Create type storage if none\n            if(!this.cache[model.type])\n                this.cache[model.type] = {};\n\n            // Save model\n            this.cache[model.type][model.id] = model;\n\n\t\t},\n\n\t\tsearch: function(type, id) {\n\n\t\t\t// Cache search\n\t\t\tif(cache[type] && cache[type][id])\n\t\t\t\treturn cache[type][id];\n\n\t\t\t// On miss\n\t\t\treturn false;\n\t\t},\n\n\t\tremove: function(model) {\n\t\t\tdelete cache[model.type][model.id];\n\t\t}\n\t}\n});","/**\n * For work with different type of notifications\n */\nsky.service(\"notifications\", [ \"stackList\", \"callbacks\", \"visibleCalculator\", \"templates\", \"windows\", \"tips\" ], function({ stackList, callbacks, visibleCalculator, templates, windows, tips }) {\n\n\tlet notification = function(options) {\n\t\t/* Self creation */\n\t\tif(!(this instanceof notification))\n\t\t\treturn new notification(options);\n\n\t\tthis.render = templates.render(\"forms-notification\", options);\n\t};\n\tlet message = function(options) {\n\n\t\t/* Self creation */\n\t\tif(!(this instanceof message))\n\t\t\treturn new message(options);\n\n\t\tthis.render = templates.render(\"forms-message\", options);\n\t};\n\n\tmessage.prototype = {\n\t\tmodal: function() {\n\t\t\treturn windows.Modal(this.render);\n\t\t},\n\n\t\t/**\n\t\t * Append to holder of modal window\n\t\t * @param {object} modal\n\t\t */\n\t\tappendToModal: function(modal) {\n\t\t\tmodal.holder.append(this.render);\n\t\t},\n\n\t\ttip: function(object, align) {\n\t\t\ttips.Tip(object, { create: this.render, close: 5 }).show(align || \"top\",);\n\t\t}\n\t};\n\n\tlet loadings = stackList();\n\n\t/**\n\t * Loading\n\t */\n\tlet loading = function(ajax, global = true) {\n\n\t\t/* Self creation */\n        if(!(this instanceof loading))\n            return new loading(ajax, global);\n\n\t\t/* Back link */\n\t\tthis.global = global;\n\n\t\t/* Render */\n\t\tthis.render = $('<div><div></div></div>').addClass(\"ajaxLoading\");\n\n\t\t/* Global insert */\n\t\tif(this.global)\n\t\t\tthis.render.addClass(\"fixed\").appendTo(\"body\");\n\n\t\t/* If stop possible */\n\t\tif(ajax) {\n\t\t\t$(\"<span/>\").appendTo(this.render.addClass(\"cancelable\")).click(function() { ajax.stop(); });\n\t\t\tajax.on(\"always\", () => { this.hide(); });\n\t\t}\n\n\t\t/* Callbacks */\n\t\tthis.callbacks = callbacks();\n\n\t\t/* List save */\n\t\tloadings.add(this);\n\n\t};\n\n\t/**\n\t * Prototype\n\t * @type {{render: null, hide: hide}}\n\t */\n\tloading.prototype = {\n\n\t\t/**\n\t\t * Loads loading in modal window\n\t\t * @param {object} modal Window\n\t\t */\n\t\tinModalWindow: function(modal) {\n\n\t\t\t/* Hide */\n\t\t\tlet content = modal.holder.children().hide();\n\n\t\t\t/* Insert */\n\t\t\tthis.render.appendTo(modal.holder);\n\n\t\t\t/* Restore on hide */\n\t\t\tthis.callbacks.on(\"hide\", () => content.show());\n\n\t\t},\n\n\t\t/**\n\t\t *\n\t\t * @param contentHolder\n\t\t */\n\t\treloadContent: function(contentHolder) {\n\n\t\t\t/* If no holder */\n\t\t\tif(!this.holder.length)\n\t\t\t\treturn;\n\n\t\t\t/* Safe */\n\t\t\tthis.holder = contentHolder = $(contentHolder).addClass(\"withLoading\");\n\n\t\t\t/* Get children */\n\t\t\tlet content = contentHolder.children();\n\n\t\t\t/* Different content disable */\n\t\t\tif(this.global) {\n\n\t\t\t\tcontent.disable();\n\n\t\t\t\t/* Make sizes calculator */\n\t\t\t\tthis.calc = visibleCalculator(contentHolder, this.render.outerHeight(), \"body\");\n\n\t\t\t\t/* Set position func */\n\t\t\t\tthis.setPosition = function() {\n\t\t\t\t\tlet position = this.calc.calculate();\n\t\t\t\t\tthis.render.css({\n\t\t\t\t\t\tleft: position.left + (position.width) / 2,\n\t\t\t\t\t\ttop: position.top + (position.height) / 2\n\t\t\t\t\t})\n\t\t\t\t};\n\t\t\t\tthis.setPosition();\n\n\t\t\t\t/* Re enable */\n\t\t\t\tthis.callbacks.on(\"hide\", () => {\n\t\t\t\t\tcontent.enable();\n\t\t\t\t\t$(window).off(\"scroll.notification\");\n\t\t\t\t});\n\n\t\t\t\t$(window).on(\"scroll.notification\", () => { this.setPosition();\t});\n\n\t\t\t} else {\n\n\t\t\t\t/*  Hide */\n\t\t\t\tcontent.hide();\n\n\t\t\t\t/* Insert */\n\t\t\t\tthis.render.appendTo(this.holder);\n\n\t\t\t\t/* Re enable */\n\t\t\t\tthis.callbacks.on(\"hide\", function() {\n\t\t\t\t\tcontent.show();\n\t\t\t\t});\n\t\t\t}\n\n\t\t\treturn this;\n\n\t\t},\n\n\t\tsetHolder: function(holder) {\n\n\t\t\t/* Append and save */\n\t\t\tthis.holder = $(holder).addClass(\"withLoading\").append(this.render);\n\n\t\t\t/* Self return */\n\t\t\treturn this;\n\n\t\t},\n\n\t\t/**\n\t\t * Hides current loading\n\t\t */\n\t\thide: function() {\n\n\t\t\tif(this.holder)\n\t\t\t\tthis.holder.removeClass(\"withLoading\");\n\n\t\t\tthis.render.remove();\n\t\t\tthis.callbacks.fire(\"hide\");\n\n\t\t\t/* Remove from list */\n\t\t\tloadings.remove(this);\n\n\t\t}\n\t};\n\n\treturn {\n\t\tloading: loading,\n\t\tmessage: message,\n\t\treCalculate: function() {\n\t\t\tloadings.each(function(instance) {\n\t\t\t\tinstance.calc.init();\n\t\t\t\tinstance.setPosition();\n\t\t\t})\n\t\t}\n\t}\n\n});","sky.services.add(\"pagination\", [\"templates\", \"stackList\"], function({ templates, stackList }) {\n\n\tlet list = stackList();\n\n\tclass Pagination {\n\t\tconstructor({ pages, holder, current = 1, }) {\n\n\t\t\t/* Self creation */\n\t\t\tif(!(this instanceof Pagination))\n\t\t\t\treturn new Pagination({ pages, holder, current });\n\n\t\t\t/* Save */\n\t\t\tlist.add(this);\n\n\t\t\t/* Set total pages */\n\t\t\tthis.pages \t\t= pages;\n\t\t\tthis.current \t= current;\n\t\t\tthis.pageWidth\t= 50;\n\t\t\tthis.id \t\t= last;\n\n\t\t\t/* No pages needed */\n\t\t\tif(this.pages < 2)\n\t\t\t\treturn this;\n\n\t\t\t/* Counted params */\n\t\t\tthis.dimensions = {\n\t\t\t\tstartPage      : 1,\n\t\t\t\tlastStartPage  : 0,\n\t\t\t\tpagesVisible   : 0,\n\t\t\t\tpagesInvisible : 0,\n\t\t\t\tscrollAvailable: 0,\n\t\t\t\tscrollStart\t   : 0,\n\t\t\t\ttumbler\t\t   : 10\n\t\t\t};\n\n\t\t\t/* Render */\n\t\t\tthis.dom = {};\n\t\t\tthis.dom.holder  = templates.render(\"pagination\", {}).data(\"pagination\", this);\n\t\t\tthis.dom.slider  = this.dom.holder.find(\".pages\");\n\t\t\tthis.dom.pages   = this.dom.slider.children();\n\t\t\tthis.dom.back \t = this.dom.holder.children(\".left\");\n\t\t\tthis.dom.forward = this.dom.holder.children(\".right\");\n\n\t\t\t/* Insert */\n\t\t\tif(holder)\n\t\t\t\tthis.dom.holder.appendTo(holder);\n\n\t\t\t/* If bigger than 10000 */\n\t\t\tif(this.pages > 9999) {\n\t\t\t\tthis.dom.slider.addClass(\"tenthousand\");\n\t\t\t\tthis.pageWidth = 80;\n\t\t\t}\n\t\t\t/* If bigger than 1000 */\n\t\t\telse if(this.pages > 999) {\n\t\t\t\tthis.dom.slider.addClass(\"thousand\");\n\t\t\t\tthis.pageWidth = 70;\n\t\t\t}\n\t\t\t/* If bigger 100 */\n\t\t\telse if(this.pages > 99 ) {\n\t\t\t\tthis.dom.slider.addClass(\"hundred\");\n\t\t\t\tthis.pageWidth = 60;\n\t\t\t}\n\n\t\t\t/* Make all */\n\t\t\tthis.redraw();\n\n\t\t\t/* Mark page */\n\t\t\tthis.goToPage(this.current);\n\n\t\t\t/* Self return */\n\t\t\treturn this;\n\n\t\t}\n\n\t\t/** */\n\t\tonPageChange(newPage) {}\n\n\t\t/** Removes navigator */\n\t\tremove() {\n\t\t\tthis.dom.holder.remove();\n\t\t\tlist.remove(this);\n\t\t}\n\n\t\t/**\n\t\t * Redraws pagination\n\t\t */\n\t\tredraw() {\n\n            /* No action on invisible */\n            if(!this.dom.holder.is(\":visible\"))\n                return;\n\n\t\t\t/* Reset width */\n\t\t\tthis.dom.slider.css(\"width\", \"auto\");\n\n\t\t\t/* Count visible sizes */\n\t\t\tthis.dimensions.pagesVisible = Math.floor((this.dom.holder.innerWidth() - 100) / this.pageWidth);\n\n\t\t\t/* Count invisible */\n\t\t\tthis.dimensions.pagesInvisible = (this.pages - this.dimensions.pagesVisible) > 0 ? this.pages - this.dimensions.pagesVisible : 0;\n\n\t\t\t/* Count last start */\n\t\t\tthis.dimensions.lastStartPage = this.dimensions.pagesInvisible + 1;\n\n\t\t\t/* Get max pages */\n\t\t\tlet toShow = this.dimensions.pagesVisible > this.pages ? this.pages : this.dimensions.pagesVisible;\n\n\t\t\t/* Crop */\n\t\t\tthis.dom.slider.css(\"width\", toShow * this.pageWidth);\n\n\t\t\t/* Redraw pages */\n\t\t\tthis.drawPages(this.dimensions.startPage);\n\n\t\t\t/* Try to create scroll */\n\t\t\tthis.createScroll();\n\n\t\t\t/* Set scroll position */\n\t\t\tif(this.dom.scrollLine)\n\t\t\t\tthis.dom.runner.css(\"left\", this.calculate().scroll);\n\n\t\t}\n\n\t\t/**\n\t\t * Create scroll line if needed\n\t\t */\n\t\tcreateScroll() {\n\n\t\t\t/* If no scroll needed */\n\t\t\tif(this.pages <= this.dimensions.pagesVisible) {\n\t\t\t\tif(this.dom.scrollLine) {\n\t\t\t\t\tthis.dom.scrollLine.remove();\n\t\t\t\t\tthis.dom.scrollLine = false;\n\t\t\t\t}\n\t\t\t\treturn;\n\t\t\t} else if(!this.dom.scrollLine) {\n\n\t\t\t\t/* Create scroll */\n\t\t\t\tthis.dom.scrollLine = templates.render(\"pagination-scroll\", {}).appendTo(this.dom.slider);\n\t\t\t\tthis.dom.runner = this.dom.scrollLine.children();\n\t\t\t}\n\n\t\t\t/* Count left */\n\t\t\tthis.dimensions.scrollStart = this.dom.scrollLine.position().left + 2;\n\n\t\t\t/* Count scroll line width */\n\t\t\tthis.dimensions.scrollAvailable = this.dom.scrollLine.outerWidth() - this.dom.scrollLine.children().outerWidth() - 4;\n\t\t\n\t\t}\n\n\t\t/**\n\t\t * Calculates related coordinates between scroll and move part\n\t\t */\n\t\tcalculate(position) {\n\n\t\t\t/* Get position */\n\t\t\tif(position === undefined)\n\t\t\t\tposition = this.dom.runner.offset().left  - this.dimensions.scrollStart;\n\n\t\t\t/* Remove start */\n\t\t\tposition = position - this.dimensions.scrollStart;\n\n\t\t\t/* Correct */\n\t\t\tposition = position > 0 ? position : 0;\n\n\t\t\t/* Count pages */\n\t\t\treturn {\n\t\t\t\tpages : Math.floor(this.dimensions.pagesInvisible * (position / this.dimensions.scrollAvailable)) + 1,\n\t\t\t\tscroll: Math.floor(this.dimensions.scrollAvailable * (this.dimensions.startPage - 1)/ this.dimensions.pagesInvisible + this.dimensions.scrollStart)\n\t\t\t}\n\n\t\t}\n\n\t\t/**\n\t\t * Draws pages according to start\n\t\t * @param {int} start Page to start from\n\t\t */\n\t\tdrawPages(start) {\n\n\t\t\t/* Remove old pages */\n\t\t\tthis.dom.pages.html(\"\");\n\n\t\t\t/* Correct */\n\t\t\tif(start > this.dimensions.pagesInvisible)\n\t\t\t\tstart = this.dimensions.pagesInvisible + 1;\n\n\t\t\t/* Correct */\n\t\t\tif(start < 1)\n\t\t\t\tstart = 1;\n\n\t\t\t/* Start position */\n\t\t\tlet i = start;\n\n\t\t\t/* Draw pages */\n\t\t\twhile(i <= this.pages && i < start + this.dimensions.pagesVisible) {\n\t\t\t\ttemplates.render(\"pagination-page\", { page: i, current: this.current }).appendTo(this.dom.pages);\n\t\t\t\ti++;\n\t\t\t}\n\n\t\t\t/* Reset start page */\n\t\t\tthis.dimensions.startPage = start;\n\n\n\t\t}\n\n\t\t/**\n\t\t * Sets page as active\n\t\t * @param {int} page Page number\n\t\t * @returns {Pagination}\n\t\t */\n\t\tgoToPage(page) {\n\n\t\t\t/* If no pages */\n\t\t\tif(this.pages < 2)\n\t\t\t\treturn this;\n\n\t\t\t/* Parse */\n\t\t\tpage = parseInt(page);\n\n\t\t\t/* Correct */\n\t\t\tif(page < 1)\n\t\t\t\tpage = 1;\n\t\t\telse if(page > this.pages)\n\t\t\t\tpage = this.pages;\n\n\t\t\t/* Checks if page is visible */\n\t\t\tlet isVisible = this.dimensions.startPage <= page && page < this.dimensions.startPage + this.dimensions.pagesVisible;\n\n\t\t\t/* Redraws if needed */\n\t\t\tif(!isVisible) {\n\t\t\t\tthis.drawPages(page);\n\t\t\t\tif(this.dom.scrollLine)\n\t\t\t\t\tthis.dom.runner.css(\"left\", this.calculate().scroll);\n\t\t\t}\n\n\t\t\t/* Make active */\n\t\t\tthis.dom.pages.children().removeClass(\"active\").filter(\"[page=\" + page +\"]\").addClass(\"active\");\n\n\t\t\t/* Forward buttons disable */\n\t\t\tif(page > 1) this.dom.back.enable();\n\t\t\telse this.dom.back.disable();\n\n\t\t\t/* Backward button disable */\n\t\t\tif(page === this.pages) this.dom.forward.disable();\n\t\t\telse this.dom.forward.enable();\n\n\t\t\t/* Callback */\n\t\t\tif(this.current !== page)\n\t\t\t\tthis.onPageChange(page);\n\n\t\t\t/* Save page state */\n\t\t\tthis.current = page;\n\n\t\t\t/* Self return */\n\t\t\treturn this;\n\n\t\t}\n\n\t\t/** Set scroll */\n\t\tscroll(event) {\n\n\t\t\tlet pos = event.pageX - 10;\n\t\t\tif(this.dimensions.scrollStart > pos)\n\t\t\t\tpos = this.dimensions.scrollStart;\n\t\t\tif(this.dimensions.scrollStart + this.dimensions.scrollAvailable < pos)\n\t\t\t\tpos = this.dimensions.scrollStart + this.dimensions.scrollAvailable;\n\n\t\t\tthis.dom.runner.css({left: pos});\n\t\t\tthis.drawPages(this.calculate(pos).pages);\n\n\t\t}\n\n\t}\n\n\t/* Bind windows events */\n\t$(window).on(\"resize\", function() {\n\t\tlist.each(() => { this.redraw(); });\n\t});\n\n\t/* Return */\n\tthis.service = {\n\t\tadd: function(options) {\n\t\t\treturn new Pagination(options);\n\t\t}\n\t}\n\n});","sky.service(\"stackList\", function() {\n\tlet List = this.service = function() {\n\n\t\tif(!(this instanceof List))\n\t\t\treturn new List();\n\n\t\tlet elements = {};\n\t\tlet lastId = 0;\n\t\tlet total = 0;\n\n\t\tthis.last = function() {\n\n\t\t\t/* Holder */\n\t\t\tlet last;\n\n\t\t\t/* Apply for windows */\n\t\t\tfor(let element of elements) last = element;\n\n\t\t\t/* Return */\n\t\t\treturn last || false;\n\n\t\t};\n\n\t\tthis.add = function(element) {\n\t\t\tlastId++;\n\t\t\ttotal++;\n\t\t\telement[lastId] = element;\n\t\t};\n\n\t\tthis.remove = function(element) {\n\t\t\t/* Apply for windows */\n\t\t\tfor(let index in elements)\n\t\t\t\tif(elements.hasOwnProperty(index) && elements[index] === element) {\n\t\t\t\t\tdelete elements[index];\n\t\t\t\t\ttotal--;\n\t\t\t\t}\n\t\t};\n\n\t\tthis.total = function() {\n\t\t\treturn total;\n\t\t};\n\n\t\tthis.elements = function() {\n\t\t\treturn elements;\n\t\t};\n\n\t\tthis.each = function(callback) {\n\t\t\tfor(let single of elements)\n\t\t\t\tcallback.apply(single, single);\n\t\t};\n\n\t}\n});","sky.onReady(({suggester}) => {\n\t$(document).on(\"click\", function(event) {\n\n\t\t/* Get element */\n\t\tlet element = $(event.target || event.srcElement);\n\n\t\t/* If click in replace we should not hide it */\n\t\tif(element.is(\"[type=submit]\") || element.closest(\".suggester\").length || element.data(\"suggester\"))\n\t\t\treturn;\n\n\t\t/* Hide all */\n\t\tsuggester.hide();\n\n\t});\n});\n\nsky.service(\"suggester\", [\"templates\"], function({templates}) {\n\n\tlet render,\n\t\tobject,\n\t\tlastList,\n\t\tsuggester = this.service = {\n\t\t\thide: function() {\n\n\t\t\t\tif(render) {\n\t\t\t\t\trender.remove();\n\t\t\t\t\trender = false;\n\t\t\t\t}\n\t\t\t\tif(object) {\n\t\t\t\t\tobject.removeData(\"suggester\");\n\t\t\t\t\tobject = false;\n\t\t\t\t}\n\t\t\t\t$(document).off(\"keyup.suggester, keydown.suggester\");\n\t\t\t},\n\t\t\tshow: function(input, list) {\n\n\t\t\t\t/* Hide previous */\n\t\t\t\tsuggester.hide();\n\n\t\t\t\t/* Save */\n\t\t\t\tlastList = list;\n\t\t\t\trender = templates.render(\"suggester\", {items: list}).insertAfter(input.closest(\"label, .label\"));\n\t\t\t\tobject = input.data(\"suggester\", render);\n\n\t\t\t\t/* Get positions */\n\t\t\t\tlet elementPosition = input.offset(),\n\t\t\t\t\trenderPosition = render.offset();\n\n\t\t\t\t/* Show */\n\t\t\t\trender.css({\n\t\t\t\t\t\"margin-left\": elementPosition.left - renderPosition.left,\n\t\t\t\t\t\"margin-top\": elementPosition.top - renderPosition.top + input.outerHeight()\n\t\t\t\t});\n\n\t\t\t\t/* Add handlers */\n\t\t\t\tlet children = render.children().on(\"click\", function() {\n\t\t\t\t\tinput.val($(this).html());\n\t\t\t\t\tsuggester.hide();\n\t\t\t\t\tif(lastList[$(this).attr(\"data-index\")].callback)\n\t\t\t\t\t\tlastList[$(this).attr(\"data-index\")].callback();\n\t\t\t\t});\n\n\t\t\t\t$(document).on(\"keyup.suggester\", function(event) {\n\n\t\t\t\t\tif(event.keyCode === 38 || event.keyCode === 40) {\n\n\t\t\t\t\t\tlet selected = children.filter(\".selected\");\n\t\t\t\t\t\tchildren.removeClass(\"selected\");\n\n\t\t\t\t\t\t// Up\n\t\t\t\t\t\tif(event.keyCode === 38) {\n\t\t\t\t\t\t\tif(!selected.length || !selected.prev().length)\n\t\t\t\t\t\t\t\tchildren.last().addClass(\"selected\");\n\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t\tselected.prev().addClass(\"selected\");\n\t\t\t\t\t\t}\n\t\t\t\t\t\t// Down\n\t\t\t\t\t\tif(event.keyCode === 40) {\n\t\t\t\t\t\t\tchildren.removeClass(\"selected\");\n\t\t\t\t\t\t\tif(!selected.length || !selected.next().length) {\n\t\t\t\t\t\t\t\tchildren.first().addClass(\"selected\")\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tselected.next().addClass(\"selected\");\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\t// Esc\n\t\t\t\t\tif(event.keyCode === 27) suggester.hide();\n\n\n\t\t\t\t}).on(\"keydown.suggester\", function(event) {\n\n\t\t\t\t\t// Enter\n\t\t\t\t\tif(event.keyCode !== 13) return;\n\n\t\t\t\t\tlet selected = children.filter(\".selected\");\n\t\t\t\t\tif(selected.length) {\n\t\t\t\t\t\tselected.trigger(\"click\");\n\t\t\t\t\t\tevent.preventDefault();\n\t\t\t\t\t} else {\n\t\t\t\t\t\tsuggester.hide();\n\t\t\t\t\t}\n\n\t\t\t\t});\n\t\t\t}\n\t\t};\n});","/**\n * Module to work with user services\n */\nsky.service(\"supported\", function () {\n\ttry {\n\t\tthis.service.fullScreen = typeof document[\"webkitIsFullScreen\"] !== \"undefined\";\n\t\tthis.service.formData = window.FormData && true;\n\t\tthis.service.XHRIsSupported = XHRIsSupported;\n\t\tthis.service.XHRUpload = (typeof new XMLHttpRequest().upload !== \"undefined\");\n\t\tthis.service.localStorage = !!window.localStorage;\n\t} catch (e) {}\n});","sky.service(\"templates\", [\"localStorage\", \"supported\", \"directives\", \"exceptions\"], function({ localStorage, supported, directives, exceptions }) {\n\n\t\n\tlet templatesList = {},\n\t\ttemplatesCompiled = {},\n\t\tTemplates = this.service = {\n\n\t\t/** Globals list */\n\t\tglobals : {},\n\n\t\t/** Local storage support */\n\t\tstorage: supported.localStorage ? localStorage({ name: \"jsTemplates\" }) : false,\n\n\t\t/**\n\t\t * Adds new template to list\n\t\t * @param options\n\t\t */\n\t\tadd: function(options) {\n\t\t\ttemplatesList[options.name] = options.template;\n\t\t\tif(this.storage) {\n\t\t\t\tthis.storage.save(options.name, templatesList[options.name]);\n\t\t\t\t//$.cookie(\"storedTemplates-\" + options.name, options.date);\n\t\t\t}\n\t\t},\n\n\t\t/**\n\t\t * Renders specified template\n\t\t * @param {String} name Template name\n\t\t * @param {Object} data Inner data\n\t\t * @param {bool} [noDirectives]\n\t\t * @returns {*}\n\t\t */\n\t\trenderWithHolder: function(name, data, noDirectives) {\n\n\t\t\t/* Compile template */\n\t\t\tthis.compile(name);\n\n\t\t\t/* Add globals */\n\t\t\tdata = $.extend(true, {}, data, { globals: this.globals });\n\n\t\t\t/* Render */\n\t\t\tlet temp = $('<div/>').append(templatesCompiled[name].render(data));\n\n\t\t\t/* Parse directives */\n\t\t\tif(!noDirectives)\n\t\t\t\tdirectives.parse(temp);\n\n\t\t\t/* Return */\n\t\t\treturn temp;\n\n\t\t},\n\n\t\t/**\n\t\t * Renders specified template\n\t\t * @param {String} name Template name\n\t\t * @param {Object} data Inner data\n\t\t * @param {bool} [noDirectives]\n\t\t * @returns {*}\n\t\t */\n\t\trender: function(name, data, noDirectives) {\n\n\t\t\t/* Compile template */\n\t\t\treturn this.renderWithHolder(name, data, noDirectives).children();\n\n\t\t},\n\n\t\t/**\n\t\t * Renders specified template and returns text\n\t\t * @param {String} name Template name\n\t\t * @param {Object} data Inner data\n\t\t * @param {bool} [noDirectives]\n\t\t * @returns {*}\n\t\t */\n\t\trenderToText: function(name, data, noDirectives) {\n\n\t\t\t/* Compile template */\n\t\t\treturn this.renderWithHolder(name, data, noDirectives).html();\n\n\t\t},\n\n\t\t/**\n\t\t * Renders template by its text as parameter\n\t\t * @param {string} text Template text\n\t\t * @param {Object} data Inner data\n\t\t * @param {bool} [noDirectives]\n\t\t * @returns {XMLList|*}\n\t\t */\n\t\trenderByText: function(text, data, noDirectives) {\n\n\t\t\t/* Add globals */\n\t\t\tdata = jQuery.extend(true, data, { globals: this.globals });\n\n\t\t\t/* Render */\n\t\t\tlet temp = $('<div/>').append(twig({ data: text }).render(data));\n\n\t\t\t/* Parse directives */\n\t\t\tif(!noDirectives)\n\t\t\t\tdirectives.parse(temp);\n\n\t\t\t/* Return */\n\t\t\treturn temp.children();\n\n\t\t},\n\n\t\t/**\n\t\t * Renders template by its text as parameter\n\t\t * @param {string} text Template text\n\t\t * @param {Object} data Inner data\n\t\t * @param noDirectives\n\t\t * @returns {XMLList|*}\n\t\t */\n\t\trenderByTextToText: function(text, data, noDirectives)  {\n\t\t\treturn $('<div/>').append(this.renderByText(text, data, noDirectives)).html();\n\t\t},\n\n\t\t/**\n\t\t * Compiles specified template\n\t\t * @param {string} name Template name\n\t\t */\n\t\tcompile: function(name) {\n\n\t\t\t/* If already compiled */\n\t\t\tif(templatesCompiled[name])\n\t\t\t\treturn;\n\n\t\t\t/* Load */\n\t\t\tthis.load(name);\n\n\t\t\t/* Compile */\n\t\t\tlet compiled = twig({ id: name, data: templatesList[name] });\n\n\t\t\t/* Check */\n\t\t\tif(!compiled)\n\t\t\t\tthrow new exceptions.system.Error('Error during compiling template \"' + name + '\"');\n\n\t\t\t/* Save */\n\t\t\ttemplatesCompiled[name] = compiled;\n\n\t\t},\n\n\t\t/**\n\t\t * Loads specified template\n\t\t * @param {string} name Template name\n\t\t */\n\t\tload: function(name) {\n\n\t\t\t/* Loaded */\n\t\t\tlet fromLS;\n\n\t\t\t/* Try to load from storage */\n\t\t\tif(!templatesList[name] && this.storage && (fromLS = this.storage.load(name)))\n\t\t\t\treturn templatesList[name] = fromLS;\n\n\t\t\t/* If already compiled */\n\t\t\tif(templatesList[name])\n\t\t\t\treturn templatesList[name];\n\n\t\t\t/* Load template */\n\t\t\tif(!(templatesList[name] = $('script[type=\"text/template\"][id='+ name +']').html()))\n\t\t\t\tthrow new exceptions.system.Error(\"Can't find template  \"  + name);\n\n\t\t\t/* Save to LS */\n\t\t\tif(this.storage)\n\t\t\t\tthis.storage.save(name, { template: templatesList[name] });\n\n\t\t\t/* Return */\n\t\t\treturn templatesList[name]\n\n\t\t}\n\n\t};\n\n\t/**\n\t * Load templates on ready\n\t */\n\t$(document).on(\"ready\", sky.func(function() {\n\n\t\t/* Find templates and save them */\n\t\t$('script[type=\"text/template\"]').each(function() {\n\t\t\tlet self = $(this);\n\t\t\tTemplates.add({\n\t\t\t\tname        : self.attr('id'),\n\t\t\t\ttemplate    : self.html()\n\t\t\t\t//dependencies: self.attr('dependencies') ? self.attr('dependencies').replace(\" \", \"\").split(\",\") : false\n\t\t\t});\n\t\t});\n\n\t\t/* Save templates files data */\n\t\tif(window.page.data[\"templates\"] && Templates.storage) {\n\t\t\t$.each(window.page.data[\"templates\"], function() {\n\t\t\t\t$.cookie(\"storedTemplates-\" + this.path, this.date);\n\t\t\t});\n\t\t}\n\n\t}));\n\n});\n","sky.service(\"tips\", [\"stackList\", \"callbacks\"], function({ stackList, callbacks }) {\n\n    /** Class to work with tips */\n    let list = stackList(),\n        tips = this.service = {\n\n        /**\n         * Hides all visible tips\n         * @param withoutAutoHide\n         */\n        hideAll: function(withoutAutoHide) {\n\n            /* Hide all tips */\n            $.each(list.elements(), function(_, tip) {\n                if(withoutAutoHide || tip.autoHide)\n                    this.hide();\n            });\n\n        },\n\n        /**\n         * Returns last open window if any\n         * @returns {tips.Tip|boolean}\n         */\n        getLast: function() {\n            list.last();\n        },\n\n        /**\n         * Add show/hide functions\n         * @param {string}            selector            Object to bind tips for\n         * @param {string}            align                Align of tip\n         * @param options\n         * @see tips.tip\n         */\n        bind: function(selector, align, options) {\n\n            /* Create binds */\n            $(selector).on({\n                \"mouseenter\": function() {\n                    let tip = $(this).data(\"tip\") || tips.Tip(this, options).show(align);\n                },\n                \"mouseleave\": function() {\n                    let tip = $(this).data(\"tip\");\n                    if(tip) tip.hide(align);\n                }\n            });\n\n        },\n\n        /**\n         * Creates new tip object\n         * @param {object}            object                Object to show tip for\n         * @param autoHide\n         * @param create\n         * @param close\n         * @param ajax\n         * @param highlight\n         * @constructor\n         */\n        Tip: function(object, { autoHide = true, create = false, close = false, ajax = false, highlight = false } = {}) {\n\n            /* Auto construct */\n            if(!(this instanceof tips.Tip))\n                return new tips.Tip(object, { autoHide, create, close, ajax, highlight });\n\n            /* Manual create tip by create function */\n            if(typeof create === \"function\") {\n\n                /* Create tip */\n                this.tip = create(object);\n\n                /* If no tip */\n                if(!this.tip) return this;\n\n            }\n\n            /* Object set */\n            this.object = $(object).data(\"tip\", this);\n\n            /* Save callbacks */\n            this.callbacks = callbacks();\n\n            /* Auto hide */\n            this.autoHide = autoHide;\n\n            /* Manual create tip by create function */\n            if(typeof create !== \"function\") {\n\n                /* Create tip */\n                this.tip = $(\"<div/>\").addClass(\"tip\").append('<div class=\"tipContent\"></div>').insertBefore(object);\n\n                /* Title using */\n                if(!create && this.object.attr('title'))\n\t\t\t\t\tcreate = this.object.attr('title');\n                else if(!create)\n\t\t\t\t\tcreate = \" \";\n\n                this.tip.find(\".tipContent\").append(create);\n\n            }\n\n            if(highlight)\n                this.shadow = $('<div/>').css({ opacity: 0, position:\"absolute\", width: \"100%\", height: \"100%\", left:0 ,top:0, background: \"rgba(0,0,0,0.5)\" }).appendTo(\"body\");\n\n            /* If count down */\n            if(typeof close === \"number\")\n                this.closeTimeout = setTimeout(() => this.hide(), close);\n\n            /* If close button */\n            else if(close)\n                $('<div/>').addClass('close').appendTo(this.tip).on(\"click\", () => this.hide());\n\n            /* If stop possible */\n            if(ajax)  ajax.on(\"always\", () => this.hide());\n\n            /* Add to list */\n            this.tip.css(\"display\", \"none\");\n\t\t\tlist.add(this);\n            return this;\n\n        }\n\n    };\n\n    /**\n     * Extends tip\n     */\n    $.extend(tips.Tip.prototype, /** @lends tips.tip */ {\n\n        /**\n         * Shows tip according to type\n         * @param {string} [align] Way it would be shown\n         */\n        show: function(align) {\n\n            /* Back link */\n            let self   = this;\n            let offset = this.tip.css({left: \"\", top: \"\", marginLeft: \"\", marginTop: \"\", display: \"\"}).offset();\n\n            /* Stop animation and shows */\n            this.tip.stop();\n\n            /* Save way to show */\n            if(align) this.align = align;\n\n            /* If shadow */\n            if(this.shadow)\n                this.shadow.stop().show().animate({opacity: 1}, 100);\n\n            /* Different actions according to tip position */\n            switch(this.align) {\n\n                /* If show righter than input */\n                case \"right\":\n                {\n                    this.tip.addClass(\"right\").css({\n                        marginLeft: this.object.offset().left + this.object.outerWidth() - offset.left,\n                        marginTop : this.object.offset().top - offset.top + parseInt((this.object.outerHeight() - this.tip.outerHeight()) / 2),\n                        opacity   : 0\n                    });\n                    this.tip.animate({opacity: 1, marginLeft: \"+=10\"}, 100);\n                    break;\n                }\n                /* If show righter than input */\n                case \"left\":\n                {\n                    this.tip.addClass(\"left\").css({\n                        marginLeft: this.object.offset().left - offset.left - this.tip.outerWidth(),\n                        marginTop : this.object.offset().top - offset.top + parseInt((this.object.outerHeight() - this.tip.outerHeight()) / 2),\n                        opacity   : 0\n                    });\n                    this.tip.animate({opacity: 1, marginLeft: \"-=10\"}, 300);\n                    break;\n                }\n                /* If show topper */\n                case \"top\":\n                {\n\n                    // Count left offset\n                    let left = this.object.offset().left - offset.left;\n\n                    /* Reposition */\n                    if(offset.left + left + this.tip.outerWidth() > $(window).outerWidth())\n                        left = left - this.tip.outerWidth() + this.object.outerWidth();\n\n                    /* Position */\n                    this.tip.addClass(\"top\").css({\n                        marginLeft: left,\n                        marginTop : this.object.offset().top - this.tip.outerHeight() - offset.top,\n                        opacity   : 0\n                    });\n\n                    this.tip.animate({opacity: 1, marginTop: \"-=10\"}, 300);\n                    break;\n                }\n                /* If show topper */\n                case \"bottom\":\n                {\n\n                    let left = this.object.offset().left - offset.left;\n\n                    /* Reposition */\n                    if(offset.left + left + this.tip.outerWidth() > $(window).outerWidth())\n                        left = left - this.tip.outerWidth() + this.object.outerWidth();\n\n                    /* Position */\n                    this.tip.addClass(\"bottom\").css({\n                        marginLeft: left,\n                        marginTop : this.object.offset().top + this.object.outerHeight() - offset.top,\n                        opacity   : 0\n                    });\n\n                    this.tip.animate({opacity: 1, marginTop: \"+=10\"}, 300);\n                    break;\n                }\n                /* If we replace input with tip */\n                case \"instead\":\n                {\n                    this.tip.css({\n                        width  : this.object.outerWidth(),\n                        height : this.object.outerHeight(),\n                        display: \"none\"\n                    });\n                    this.object.fadeOut(100, function() {\n                        self.tip.fadeIn(100);\n                    }).get(0).blur();\n                    break;\n                }\n                case \"inside\":\n                {\n                    this.tip.css({\n                        width  : this.object.outerWidth(),\n                        height : this.object.outerHeight(),\n                        display: \"none\"\n                    });\n                    this.tip.css(\"opacity\", 0).animate({opacity: 1}, 100);\n                    break;\n                }\n                default:\n                    break;\n            }\n\n            this.tip.css({left: \"\", top: \"\"});\n\n            /* Self return */\n            return this;\n\n        },\n\n        /**\n         * Hides current tip\n         */\n        hide: function() {\n\n            /* Remove count down if needed */\n            if(this.closeTimeout)\n                clearTimeout(this.closeTimeout);\n\n            /* Stop animation */\n            this.tip.stop();\n\n            /* Get know how tip was shown */\n            let align = this.align;\n\n            /* Create end animation callback */\n            let callback = () => {\n\n                /* Delete record from global list */\n                list.remove(this);\n\n                /* Remove data */\n                this.object.removeData(\"tip\");\n\n                /* Remove tip */\n                this.tip.remove();\n\n                /* Callback */\n                this.callbacks.fire(\"hide\", this);\n\n            };\n\n            /* If just shown */\n            if(!align)\n                callback();\n\n            /* If shadow */\n            if(this.shadow)\n                this.shadow.animate({opacity: 0}, 100, () => { this.shadow.remove() });\n\n            /* Right way hide */\n            if(align === \"right\")\n                this.tip.animate({opacity: 0, marginLeft: \"+=10\"}, 100, callback);\n\n            /* Left way hide */\n            if(align === \"left\")\n                this.tip.animate({opacity: 0, marginLeft: \"-=10\"}, 100, callback);\n\n            /* Instead way hide */\n            if(align === \"instead\")\n                this.tip.fadeOut({opacity: 0}, 200, callback);\n\n            /* Top way hide */\n            if(align === \"top\")\n                this.tip.animate({opacity: 0, marginTop: \"-=5\"}, 200, callback);\n\n            /* Bottom way hide */\n            if(align === \"bottom\")\n                this.tip.animate({opacity: 0, marginTop: \"+=5\"}, 200, callback);\n\n            /* Inside way hide */\n            if(align === \"inside\")\n                this.tip.animate({opacity: 0}, 200, callback);\n\n            /* Self return */\n            return this;\n\n        },\n\n        /**\n         * Gets tips dom\n         * @returns {*}\n         */\n        get: function() {\n            return this.tip;\n        },\n\n        /**\n         * Sets tip text\n         * @param {string|jQuery} text What to insert to tip body\n         */\n        set: function(text) {\n            this.tip.children(\".tipContent\").html(text);\n            return this;\n        },\n\n        /**\n         * Adds something to tip\n         * @param {string|jQuery} what What to append to tip body\n         */\n        add: function(what) {\n            this.tip.children(\".tipContent\").append(what);\n            return this;\n        }\n\n    });\n\n});","sky.service(\"utils\", function() {\n\tthis.service = {\n\n\t\t/**\n\t\t * Checks if object has same data\n\t\t * @param first\n\t\t * @param second\n\t\t */\n\t\tisObjectsEqual: function(first, second) {\n\n\t\t\t/* Different types */\n\t\t\tif(typeof first !== typeof second)\n\t\t\t\treturn false;\n\n\t\t\t/* If object or array we will compare each element */\n\t\t\tif(first instanceof Array || first instanceof Object) {\n\t\t\t\tlet key;\n\t\t\t\t/* Check first */\n\t\t\t\tfor(key in first) {\n\t\t\t\t\tif(!first.hasOwnProperty(key)) continue;\n\t\t\t\t\tif(typeof second[key] === \"undefined\") return false;\n\t\t\t\t\telse if(!this.isObjectsEqual(first[key], second[key])) return false;\n\t\t\t\t}\n\n\t\t\t\t/* Check second */\n\t\t\t\tfor(key in second) {\n\t\t\t\t\tif(!second.hasOwnProperty(key)) continue;\n\t\t\t\t\tif(typeof first[key] === \"undefined\") return false;\n\t\t\t\t}\n\n\t\t\t} else if(first !== second) return false;    // For simple types\n\n\t\t\t/* All tests success */\n\t\t\treturn true;\n\n\t\t},\n\n\t\t/**\n\t\t * Adds zero\n\t\t * @param value\n\t\t * @returns {Number}\n\t\t */\n\t\taddLeadingZero: function(value) {\n\n\t\t\t/* Parse */\n\t\t\tvalue = parseInt(value);\n\n\t\t\t/* Ad zero */\n\t\t\tif(value < 10)\n\t\t\t\tvalue = \"0\" + value;\n\n\t\t\t/* Val */\n\t\t\treturn value;\n\n\t\t},\n\n\t\tencode: function(rawStr) {\n\t\t\treturn rawStr.replace(/[\\u00A0-\\u9999<>&]/gim, function(i) {\n\t\t\t\treturn '&#' + i.charCodeAt(0) + ';';\n\t\t\t});\n\t\t},\n\n\t\t/**\n\t\t * Makes data to JSON past\n\t\t * @param data\n\t\t * @param [inputName]\n\t\t * @returns {string}\n\t\t */\n\t\tjsonData: function(data, inputName) {\n\t\t\treturn '<script type=\"application/json\"' + (inputName ? (' input-name=\"' + inputName + '\"') : \"\") + '>' + sky.encode(JSON.stringify(data)) + '</script>';\n\t\t},\n\n\t\tprepareSelectData: function(items, func, {columnSplitOn = 6, maxColumns = 4}) {\n\n\t\t\tlet index        = 0,\n\t\t\t\tcolumns      = [],\n\t\t\t\tcolumnsCount = items.length / columnSplitOn,\n\t\t\t\tgroupHolder,\n\t\t\t\tcompiled;\n\n\t\t\tif(columnsCount < 1)\n\t\t\t\tcolumnsCount = 1;\n\t\t\tif(columnsCount > maxColumns)\n\t\t\t\tcolumnsCount = maxColumns;\n\n\t\t\tlet perColumn = Math.ceil(items.length / columnsCount);\n\n\t\t\tfor(let item of items) {\n\t\t\t\tif(compiled = func({item, index, column: columns.length})) {\n\n\t\t\t\t\tif(index % perColumn === 0) {\n\t\t\t\t\t\tgroupHolder = [];\n\t\t\t\t\t\tcolumns.push(groupHolder);\n\t\t\t\t\t}\n\n\t\t\t\t\tgroupHolder.push(compiled);\n\t\t\t\t\tindex++;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn index === 0 ? [] : {groups: columns}\n\n\t\t}\n\t}\n});","sky.onReady(function({ validator }) {\n\tjQuery.fn.validForm = function() {\n\t\treturn validator.validateForm(this);\n\t}.safe();\n\tjQuery.fn.validationRule = function(name, options) {\n\t\treturn validator.addRule(this, name, options);\n\t}.safe();\n\t$(document).on(\"change keyup\", \"[data-validate]\", function() {\n\t\tvalidator.validateElement($(this));\n\t});\n});\n\nsky.service(\"validator\", function() {\n\n\t/**\n\t * Main validation object\n\t */\n\tlet validator = this.service = {\n\n\t\t/**\n\t\t * Validates specified form, or dom element\n\t\t * @param form\n\t\t */\n\t\tvalidateForm: function(form) {\n\n\t\t\tlet pass = true,\n\t\t\t\tself = this;\n\n\t\t\t/* Go through all elements that need to be validate */\n\t\t\tform.find(\"input, select, textarea, .selectReplace, [data-validate]\").filter(\":visible\").each(function() {\n\n\t\t\t\t/* Get element */\n\t\t\t\tlet element = $(this);\n\n\t\t\t\t/* validate if needed to */\n\t\t\t\tif(self.shouldBeValidated(element) && !self.validateElement(element, form))\n\t\t\t\t\tpass = false;\n\n\t\t\t});\n\n\t\t\t/* Return result */\n\t\t\treturn pass;\n\n\t\t},\n\n\t\t/**\n\t\t * Add rule to specified element\n\t\t * @param element\n\t\t * @param name\n\t\t * @param [options]\n\t\t */\n\t\taddRule: function(element, name, options) {\n\n\t\t\t/* Get or make options and add rule */\n\t\t\tthis.Options(element).addRule(name, options || {});\n\n\t\t\t/* Self return */\n\t\t\treturn this;\n\n\t\t},\n\n\t\t/**\n\t\t *\n\t\t * Validates specified element\n\t\t * @param {*} element Element to validate\n\t\t * @param {*} [form] Form to validate\n\t\t * @returns {boolean}\n\t\t */\n\t\tvalidateElement: function(element, form) {\n\n\t\t\tlet self = this,\n\t\t\t\toptions = this.Options(element),\n\t\t\t\ttotalPass = true,\n\t\t\t\tvalue = element.val(),\n\t\t\t\tlastError = false,\n\t\t\t\tfirstError = false,\n\t\t\t\tlastSuccess = false,\n\t\t\t\tfirstSuccess = false;\n\n\t\t\t/* Select replace */\n\t\t\tif(element.is(\".selectReplace\")) {\n\t\t\t\tlet inputs = element.next().find(\"input:checked\");\n\t\t\t\tif(!inputs.length)\n\t\t\t\t\tvalue = \"\";\n\t\t\t\telse if(element.is(\".single\"))\n\t\t\t\t\tvalue = element.next().find(\"input:checked\").val();\n\t\t\t\telse\n\t\t\t\t\tvalue = element.next().find(\"input:checked\").length ? \"true\" : \"\";\n\t\t\t}\n\n\t\t\t/* Go through rules */\n\t\t\t$.each(options.rules, function(name, ruleOverload) {\n\n\t\t\t\t/* Make compiled rule */\n\t\t\t\tlet compiledRule = jQuery.extend(true, {}, self.rules[name] || self.Rule({}), ruleOverload || {});\n\n\t\t\t\t/* Execute message is needed */\n\t\t\t\tif(typeof compiledRule.message === \"function\")\n\t\t\t\t\tcompiledRule.message = compiledRule.message.call(this);\n\n\t\t\t\t/* Check if element pass validation */\n\t\t\t\tlet pass = self.validate(value, compiledRule, element, form);\n\n\t\t\t\t/* Perform action according to result */\n\t\t\t\tif(pass) {\n\t\t\t\t\tcompiledRule.onSuccess(element, compiledRule);\n\t\t\t\t\tlastSuccess = compiledRule;\n\t\t\t\t\tif(!firstSuccess)\n\t\t\t\t\t\tfirstSuccess = compiledRule;\n\t\t\t\t} else {\n\t\t\t\t\tcompiledRule.onError(element, compiledRule);\n\t\t\t\t\tlastError = compiledRule;\n\t\t\t\t\tif(!firstError)\n\t\t\t\t\t\tfirstError = compiledRule;\n\t\t\t\t\ttotalPass = false;\n\t\t\t\t}\n\n\t\t\t});\n\n\t\t\t/* Total callbacks */\n\t\t\tif(totalPass)\n\t\t\t\toptions.onSuccess(element, lastSuccess);\n\t\t\telse\n\t\t\t\toptions.onError(element, firstError);\n\n\t\t\t/* Return true of element passed all validations */\n\t\t\treturn totalPass;\n\n\t\t},\n\n\t\t/**\n\t\t * Return true if element should be validated\n\t\t * @param {*} element Element to validate\n\t\t * @returns {boolean}\n\t\t */\n\t\tshouldBeValidated: function(element) {\n\t\t\treturn element.attr(\"data-validate\") || element.data(\"validationOptions\");\n\t\t},\n\n\t\t/**\n\t\t * Return true if element passed validation\n\t\t * @param element\n\t\t * @param compiledRule\n\t\t * @param form\n\t\t * @returns {*}\n\t\t * @param value\n\t\t */\n\t\tvalidate: function(value, compiledRule, element, form) {\n\t\t\treturn compiledRule.rule.call(compiledRule, value, element, form);\n\t\t}\n\n\t};\n\n\t/**\n\t * Defaults\n\t */\n\tvalidator.ruleDefaults = {\n\n\t};\n\n\t/**\n\t * Defaults\n\t * @type {{onSuccess: onSuccess, onError: onError}}\n\t */\n\tvalidator.optionsDefaults = {\n\n\t\t/* Fires on success */\n\t\tonSuccess: function(element) {\n\n\t\t\t/* Remove error */\n\t\t\telement.removeClass(this.errorClass);\n\n\t\t\t/* Add success */\n\t\t\tif(this.successClass)\n\t\t\t\telement.addClass(this.successClass);\n\n\t\t},\n\n\t\t/* Fires on error */\n\t\tonError: function(element) {\n\n\t\t\t/* Add error */\n\t\t\telement.addClass(this.errorClass);\n\n\t\t\t/* Remove success */\n\t\t\tif(this.successClass)\n\t\t\t\telement.removeClass(this.successClass);\n\n\t\t}\n\t};\n\n\t/**\n\t * Base rule object\n\t * @param overload\n\t * @returns {validator.Rule}\n\t * @constructor\n\t */\n\tvalidator.Rule = function(overload) {\n\n\t\t/* Self creation if needed */\n\t\tif(!(this instanceof validator.Rule))\n\t\t\treturn new validator.Rule(overload);\n\n\t\t/* Dump rule to check validation */\n\t\tthis.rule = function() { return true; };\n\n\t\t/* Dump message */\n\t\tthis.message = \"    \";\n\n\t\t/* List of options to make validation according to */\n\t\tthis.options = [];\n\n\t\t/* Fires on success */\n\t\tthis.onSuccess = function(element) {};\n\n\t\t/* Fires on error */\n\t\tthis.onError = function(element) {};\n\n\t\t/* Self extend with overload */\n\t\tjQuery.extend(this, overload);\n\n\t\t/* Return */\n\t\treturn this;\n\n\t};\n\n\t/**\n\t * List of default rules\n\t * @type {{required: validator.Rule}}\n\t */\n\tvalidator.rules = {\n\t\trequired: validator.Rule({\n\t\t\trule: function(value) {\n\t\t\t\treturn !!value.length;\n\t\t\t},\n\t\t\tmessage: \"   \"\n\t\t}),\n\t\trequiredIfFilled: validator.Rule({\n\t\t\trule: function(value) {\n\t\t\t\tlet item = $(this.options[0]);\n\t\t\t\treturn item.is(\":radio, :checkbox\") ? !item.is(\":checked\") || value : item.val() === \"\" || value;\n\t\t\t},\n\t\t\tmessage: \"   \"\n\t\t}),\n\t\tdate: validator.Rule({\n\t\t\trule: function(value) {\n\t\t\t\treturn !value || (\n\t\t\t\t\tvalue.match(/^\\d{4}-\\d{2}-\\d{2}( \\d{2}:\\d{2}(:\\d{2})?)?$/) ||\n\t\t\t\t\tvalue.match(/^\\d{2}.\\d{2}.\\d{4}( \\d{2}:\\d{2}(:\\d{2})?)?$/)\n\t\t\t\t\t);\n\t\t\t},\n\t\t\tmessage: \"  \"\n\t\t}),\n\t\tperiod: validator.Rule({\n\t\t\trule: function(value) {\n\t\t\t\treturn !value || (\n\t\t\t\t\tvalue.match(/^\\d{4}-\\d{2}-\\d{2}$/) ||\n\t\t\t\t\tvalue.match(/^\\d{2}.\\d{2}.\\d{4}$/) ||\n\t\t\t\t\tvalue.match(/^\\d{2}.\\d{2}.\\d{4}\\s*-\\s*\\d{2}.\\d{2}.\\d{4}$/) ||\n\t\t\t\t\tvalue.match(/^\\d{4}-\\d{2}-\\d{2}\\s*-\\s*\\d{4}-\\d{2}-\\d{2}$/)\n\t\t\t\t\t);\n\t\t\t},\n\t\t\tmessage: \"  \"\n\t\t}),\n\t\temail: validator.Rule({\n\t\t\trule: function(value) {\n\t\t\t\treturn value && value.match(/[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*@(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?/);\n\t\t\t},\n\t\t\tmessage: \"   \"\n\t\t}),\n\t\tsame: validator.Rule({\n\t\t\trule: function(value) {\n\t\t\t\treturn value === $('[name=\"' + this.options[0] + '\"]').val();\n\t\t\t},\n\t\t\tmessage: \"  \"\n\t\t}),\n\t\turl: validator.Rule({\n\t\t\trule: function(value) {\n\t\t\t\treturn value === \"\" || value.match(/^(https?:\\/\\/.+)$/);\n\t\t\t},\n\t\t\tmessage: \"   URI\"\n\t\t}),\n\t\tregexp: validator.Rule({\n\t\t\trule: function(value) {\n\t\t\t\treturn value === \"\" || value.match(new RegExp(this.options[0]));\n\t\t\t},\n\t\t\tmessage: \"  \"\n\t\t}),\n\t\tnumeric: validator.Rule({\n\t\t\trule: function(value) {\n\t\t\t\treturn value === \"\" || value.match(/^-?[0-9]+(\\.[0-9]+)?$/);\n\t\t\t},\n\t\t\tmessage: \" \"\n\t\t}),\n\t\tpositive: validator.Rule({\n\t\t\trule: function(value) {\n\t\t\t\treturn value === \"\" || value.match(/^[0-9]+(\\.[0-9]+)?$/) && parseFloat(value) > 0;\n\t\t\t},\n\t\t\tmessage: \"  \"\n\t\t}),\n\t\tmax: validator.Rule({\n\t\t\trule: function(value) {\n\t\t\t\treturn value === \"\" || value.match(/^[0-9]+(\\.[0-9]+)?$/) && parseFloat(value) <= parseFloat(this.options[0] || 0);\n\t\t\t},\n\t\t\tmessage: function() {\n\t\t\t\treturn \" ,    \" + (this.options[0] || 0)\n\t\t\t}\n\t\t}),\n\t\tmin: validator.Rule({\n\t\t\trule: function(value) {\n\t\t\t\treturn value === \"\" || value.match(/^[0-9]+(\\.[0-9]+)?$/) && parseFloat(value) >= parseFloat(this.options[0] || 0);\n\t\t\t},\n\t\t\tmessage: function() {\n\t\t\t\treturn \" ,    \" + (this.options[0] || 0);\n\t\t\t}\n\t\t}),\n\t\tminLength: validator.Rule({\n\t\t\trule: function(value) {\n\t\t\t\treturn value === \"\" || value.length >= (this.options[0] || 0)\n\t\t\t},\n\t\t\tmessage: \"    \"\n\t\t}),\n\t\tmaxLength: validator.Rule({\n\t\t\trule: function(value) {\n\t\t\t\treturn value === \"\" || value.length <= (this.options[0] || 0)\n\t\t\t},\n\t\t\tmessage: \"     \"\n\t\t})\n\t};\n\n\t/**\n\t * Holds element validation options\n\t * @param element\n\t * @constructor\n\t */\n\tvalidator.Options = function(element) {\n\n\t\t/* Create or return */\n\t\tif(!(this instanceof validator.Options))\n\t\t\treturn element.data(\"validationOptions\") || new validator.Options(element);\n\n\t\t/* Callbacks after all checks */\n\t\tthis.onSuccess = function() {};\n\t\tthis.onError = function() {};\n\n\t\t/* Adds to element on success */\n\t\tthis.successClass = false;\n\n\t\t/* Adds to element on error */\n\t\tthis.errorClass   = \"error\";\n\n\t\t/* Overlay defaults */\n\t\tjQuery.extend(true, this, validator.optionsDefaults);\n\n\t\t/* Holds list of validating rules */\n\t\tthis.rules = {};\n\n\t\t/* Save element */\n\t\tthis.element = element;\n\n\t\t/* Get rules that declared in element definition */\n\t\tthis.getDeclaredRules();\n\n\t\t/* Save option */\n\t\tthis.element.data(\"validationOptions\", this);\n\n\t\t/* Self return */\n\t\treturn this;\n\n\t};\n\n\tvalidator.Options.prototype = {\n\n\t\t/**\n\t\t * Gets list of rules that are set in declared way\n\t\t */\n\t\tgetDeclaredRules: function() {\n\n\t\t\t/* Get attribute value */\n\t\t\tlet attr = this.element.attr(\"data-validate\"),\n\t\t\t\tself = this;\n\n\t\t\t/* If none */\n\t\t\tif(!attr)\n\t\t\t\treturn;\n\n\t\t\t/* Get list */\n\t\t\t$.each(attr.split(\";\"), function(_, name) {\n\n\t\t\t\t/* Get parameters */\n\t\t\t\tlet params = name.match(/(\\w+)\\((.*)\\)/);\n\n\t\t\t\t/* Parse */\n\t\t\t\tif(params) {\n\n\t\t\t\t\t/* Get function */\n\t\t\t\t\tname = params[1];\n\n\t\t\t\t\t/* Parse params */\n\t\t\t\t\tparams = params[2].match(/(('[^']+')|([\\d\\w]+))/g);\n\t\t\t\t\t$.each(params, function(i, val) {\n\t\t\t\t\t\tparams[i] = eval(val.trim());\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\t/* Add rule to options */\n\t\t\t\tself.addRule(name.trim(), { options: params || [] });\n\n\t\t\t});\n\n\n\t\t},\n\n\t\t/**\n\t\t * Adds new rule for element\n\t\t * @param {string} name Rule name\n\t\t * @param {object} options Rule options\n\t\t * @returns {validator.Options}\n\t\t */\n\t\taddRule: function(name, options) {\n\n\t\t\t/* Create and save new rule */\n\t\t\tthis.rules[name] = jQuery.extend({}, validator.ruleDefaults, options);\n\n\t\t\t/* Mark for auto validation */\n\t\t\tif(!this.element.attr(\"data-validate\"))\n\t\t\t\tthis.element.attr(\"data-validate\", \"true\");\n\n\t\t\t/* Self returning */\n\t\t\treturn this;\n\t\t}\n\n\t}\n\n});","sky.service(\"visibleCalculator\", function() {\n\n\tlet Calculator = this.service = class {\n\n\t\tconstructor(holder, minHeight, scrollable) {\n\n\t\t\t/* Check if class */\n\t\t\tif(!(this instanceof Calculator))\n\t\t\t\treturn new Calculator(holder, minHeight, scrollable);\n\n\t\t\t/* Re get holder */\n\t\t\tthis.holder = $(holder);\n\t\t\tthis.scrollable = scrollable;\n\t\t\tthis.minHeight = minHeight;\n\n\t\t\t/* Init */\n\t\t\tthis.init();\n\n\t\t}\n\n\t\t/* Init func */\n\t\tinit() {\n\n\t\t\t/* Count offset */\n\t\t\tlet offset = this.holder.offset();\n\n\t\t\t/* Get holder rect */\n\t\t\tthis.holderRect = {\n\t\t\t\tleft  : offset.left,\n\t\t\t\ttop   : offset.top,\n\t\t\t\twidth : this.holder.outerWidth(),\n\t\t\t\theight: this.holder.outerHeight()\n\t\t\t};\n\n\t\t}\n\n\t\t/* Calculating function */\n\t\tcalculate() {\n\n\t\t\t/* How much is scrolled */\n\t\t\tlet scrollTop    = $(this.scrollable).scrollTop(),\n\t\t\t\twindowHeight = $(window).height(),\n\t\t\t\twindowWidth  = $(window).width(),\n\t\t\t\tsizes        = {\n\t\t\t\t\tleft        : this.holderRect.left,\n\t\t\t\t\tright       : this.holderRect.left + this.holderRect.width,\n\t\t\t\t\ttop         : this.holderRect.top - scrollTop,\n\t\t\t\t\twidth       : this.holderRect.width,\n\t\t\t\t\theight      : this.holderRect.height,\n\t\t\t\t\trealHeight  : this.holderRect.height,\n\t\t\t\t\tscrollTop   : scrollTop,\n\t\t\t\t\tscrollLeft  : 0,\n\t\t\t\t\twindowHeight: windowHeight,\n\t\t\t\t\twindowWidth : windowWidth,\n\t\t\t\t};\n\n\t\t\t/* Min height */\n\t\t\tif(sizes.height < this.minHeight)\n\t\t\t\tsizes.height = this.minHeight;\n\n\t\t\t/* Count bottom */\n\t\t\tsizes.bottom = sizes.top + sizes.height;\n\n\t\t\t/* If top border near than holder */\n\t\t\tif(sizes.top < 0) {\n\t\t\t\t// If visible less than min\n\t\t\t\tif(sizes.bottom < this.minHeight) {\n\t\t\t\t\tsizes.bottom = sizes.bottom < 0 ? 0 : sizes.bottom;\n\t\t\t\t\tsizes.top = sizes.bottom - this.minHeight;\n\t\t\t\t\tsizes.height = this.minHeight;\n\t\t\t\t}\n\t\t\t\t// If visible more than min\n\t\t\t\telse {\n\t\t\t\t\tsizes.height = sizes.bottom;\n\t\t\t\t\tsizes.top = 0;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t/* Get visible bottom */\n\t\t\tif(windowHeight < sizes.bottom) {\n\t\t\t\t// If visible less than min\n\t\t\t\tif(windowHeight - sizes.top < this.minHeight) {\n\t\t\t\t\tsizes.height = this.minHeight;\n\t\t\t\t\tsizes.top = windowHeight - sizes.top < 0 ? 0 : sizes.top;\n\t\t\t\t\tsizes.bottom = sizes.top + this.minHeight;\n\t\t\t\t}\n\t\t\t\t// If visible more than min\n\t\t\t\telse {\n\t\t\t\t\tsizes.height = windowHeight - sizes.top;\n\t\t\t\t\tsizes.bottom = 0;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t/* Return */\n\t\t\treturn sizes;\n\n\t\t}\n\n\t\tgetDropOffset(replace, popup) {\n\n\t\t\t/* Get drop */\n\t\t\tif(!popup.is(\":visible\")) return;\n\n\t\t\t/* Set position to zeros to get max width and height */\n\t\t\tpopup.removeClass('hidden').css({left: 0, top: 0});\n\n\t\t\t/* Init */\n\t\t\tlet popupWidth  = popup.outerWidth(),\n\t\t\t\tpopupHeight = popup.outerHeight();\n\n\t\t\t/* Reset position */\n\t\t\tpopup.css({marginLeft: \"\", marginTop: \"\", width: \"\", left: \"\", top: \"\"});\n\n\t\t\t/* Init */\n\t\t\tlet win            = $(window),\n\t\t\t\treplaceOffset  = replace.offset(),\n\t\t\t\tpopupOffset    = popup.offset(),\n\t\t\t\tleftDifference = popupOffset.left - replaceOffset.left,\n\t\t\t\ttopDifference  = popupOffset.top - replaceOffset.top,\n\t\t\t\tmiddle         = false,\n\t\t\t\tvisible        = this.calculate();\n\n\t\t\t// Drop down\n\t\t\tif(visible.bottom + popupHeight >= visible.windowHeight)\n\t\t\t\tpopup.css(\"marginTop\", topDifference + visible.realHeight + 1);\n\t\t\t// Drop up\n\t\t\telse if(visible.top > popupHeight)\n\t\t\t\tpopup.css(\"marginTop\", -topDifference - 1);\n\t\t\t// Drop left\n\t\t\telse {\n\t\t\t\tpopup.css(\"marginTop\", -topDifference - (popupHeight - visible.realHeight) / 2);\n\t\t\t\tmiddle = true;\n\t\t\t}\n\n\n\t\t\t/* Set position */\n\t\t\tif(!middle) {\n\t\t\t\tif(visible.windowWidth > visible.left + popupWidth)\n\t\t\t\t\tpopup.css(\"marginLeft\", leftDifference);\n\t\t\t\telse\n\t\t\t\t\tpopup.css(\"marginLeft\", leftDifference - popupWidth + visible.width);\n\t\t\t} else {\n\n\t\t\t\tif(win.width() > selfOffset.left + popupWidth + selfWidth)\n\t\t\t\t\tpopup.css({\n\t\t\t\t\t\tmarginLeft: selfOffset.left - popupOffset.left + selfWidth\n\t\t\t\t\t});\n\t\t\t\telse\n\t\t\t\t\tpopup.css({\n\t\t\t\t\t\tmarginLeft: selfOffset.left - popupOffset.left - popupWidth\n\t\t\t\t\t});\n\n\t\t\t}\n\n\t\t}\n\t}\n\n})\n;","/**\n * Holds classes to work with modal/new windows\n */\nsky.service('windows', [\"templates\", \"callbacks\", \"stackList\"], function ({templates, callbacks, stackList}) {\n\n\tlet tips = false,\n\t\tlist = stackList(),\n\t\twindows = this.service = {\n\n\t\t\t/**\n\t\t\t * Returns last open window if any\n\t\t\t * @returns {windows.Modal|boolean}\n\t\t\t */\n\t\t\tgetLast: function () {\n\t\t\t\treturn list.last()\n\t\t\t},\n\n\t\t\t/**\n\t\t\t * Creates new modal window\n\t\t\t * @param {*} name Window name\n\t\t\t * @param {*} [data] Data to send with request\n\t\t\t */\n\t\t\tModal: function (name, data) {\n\n\t\t\t\t/* Self construct */\n\t\t\t\tif (!(this instanceof windows.Modal))\n\t\t\t\t\treturn new windows.Modal(name, data);\n\n\t\t\t\t/* Create window */\n\t\t\t\tthis.locked \t\t= false;\n\t\t\t\tthis.background \t= templates.render(\"windows-modal\", {}).appendTo(\"#pageContentHolder\").data(\"modalWindow\", this);\n\t\t\t\tthis.dataContainer \t= this.background.children();\n\t\t\t\tthis.holder \t\t= this.dataContainer.children(\".windowData\");\n\t\t\t\tthis.closeButton \t= this.dataContainer.children(\".close\");\n\n\t\t\t\t/* Make body un scrollable */\n\t\t\t\t$(document.body).css(\"overflow\", \"hidden\");\n\n\t\t\t\t/* Callbacks */\n\t\t\t\tthis.callbacks = callbacks();\n\n\t\t\t\t/* Render content */\n\t\t\t\ttry {\n\t\t\t\t\tthis.reRender(name, data);\n\t\t\t\t} catch (e) {\n\t\t\t\t\tthis.close(false);\n\t\t\t\t\tthrow e;\n\t\t\t\t}\n\n\t\t\t\t/* Return */\n\t\t\t\treturn this;\n\n\t\t\t}\n\n\t\t};\n\n\t/**\n\t * Modal window prototype\n\t */\n\twindows.Modal.prototype = {\n\n\t\t/**\n\t\t * Renders window content\n\t\t * @param {*} name Window name\n\t\t * @param {*} [data] Data to send with request\n\t\t */\n\t\treRender: function (name, data) {\n\n\t\t\t/* Close all tips */\n\t\t\tif(tips) tips.hideAll(true);\n\n\t\t\t/* Clear */\n\t\t\tthis.holder.html('');\n\n\t\t\t/* Render content */\n\t\t\tif (name instanceof jQuery)\n\t\t\t\tthis.template = name.appendTo(this.holder);\n\t\t\telse if (typeof name === \"string\")\n\t\t\t\tthis.template = templates.render(name, data).appendTo(this.holder);\n\n\t\t\t/* Self return */\n\t\t\treturn this;\n\t\t},\n\n\t\t/**\n\t\t * Removes all except that was rendered\n\t\t */\n\t\tclearExceptTemplate: function () {\n\t\t\tthis.holder.children().detach();\n\t\t\tthis.holder.append(this.template);\n\t\t},\n\n\t\t/**\n\t\t * Removes all except that was rendered\n\t\t */\n\t\tremoveMessages: function () {\n\t\t\tthis.holder.find(\".notificationMessage\").remove();\n\t\t\treturn this;\n\t\t},\n\n\t\t/**\n\t\t * Locks window so it can't be closed\n\t\t * @returns {windows.Modal}\n\t\t */\n\t\tlock: function (ajax) {\n\t\t\tthis.locked = true;\n\t\t\tthis.closeButton.hide();\n\t\t\tif (ajax) ajax\n\t\t\t\t.on(\"preSuccess\", function () {\n\t\t\t\t\tthis.dataContainer.css(\"height\", this.dataContainer.innerHeight());\n\t\t\t\t}, this)\n\t\t\t\t.on(\"notAbort\", function () {\n\t\t\t\t\tlet self = this;\n\t\t\t\t\tthis.unlock();\n\t\t\t\t\tthis.dataContainer.css(\"height\", this.holder.outerHeight());\n\t\t\t\t\tsetTimeout(function () {\n\t\t\t\t\t\tself.dataContainer.css(\"height\", \"\");\n\t\t\t\t\t}, 500)\n\t\t\t\t}, this)\n\t\t\t\t.on(\"abort\", function () {\n\t\t\t\t\tthis.unlock().close();\n\t\t\t\t}, this);\n\t\t\treturn this;\n\t\t},\n\n\t\t/**\n\t\t * Unlocks window so it can be closed\n\t\t * @returns {windows.Modal}\n\t\t */\n\t\tunlock: function () {\n\t\t\tthis.locked = false;\n\t\t\tthis.closeButton.show();\n\t\t\treturn this;\n\t\t},\n\n\t\t/**\n\t\t * Closes current window\n\t\t * @param {boolean} [byUser] Indicates that window was closed not by user\n\t\t */\n\t\tclose: function (byUser = false) {\n\n\t\t\t/* If windows is locked */\n\t\t\tif (this.locked)\n\t\t\t\treturn;\n\n\t\t\t/* Remove elements */\n\t\t\tthis.background.fadeOut(\"fast\", function () {\n\t\t\t\t$(this).remove()\n\t\t\t});\n\n\t\t\t/* Delete from list */\n\t\t\tlist.remove(this);\n\n\t\t\t/* Call close callback */\n\t\t\tthis.callbacks.fire(\"close\", {byUser: byUser});\n\n\t\t\t/* Close all tips */\n\t\t\tif(tips) tips.hideAll(true);\n\n\t\t\t/* Make body scrollable */\n\t\t\tif (list.total() < 1)\n\t\t\t\t$(document.body).css(\"overflow\", \"\");\n\n\t\t\treturn this;\n\n\t\t}\n\n\t};\n\n\ttry {\n\t\ttips = sky.service(\"tips\");\n\t} catch (e) {}\n\n\t/* Add handler to black area click */\n\t$(document)\n\t\t.on(\"keyup\", sky.func(function (event) {\n\t\t\tlet last;\n\n\t\t\t/* If slide show was disabled */\n\t\t\tif (document[\"webkitIsFullScreen\"] || document[\"mozIsFullScreen\"] || document[\"isFullScreen\"])\n\t\t\t\treturn;\n\n\t\t\t/* Close current window */\n\t\t\tif (event.keyCode === 27 && (last = windows.getLast()))\n\t\t\t\tlast.close(true);\n\n\t\t}));\n\n});","sky.action(\"pagination\", {\n\n\tsetPage: function(button, _, page) {\n\n\t\t/* Get pagination */\n\t\tlet pagination = button.parents(\".pagination\").data(\"pagination\");\n\n\t\t/* Correct page */\n\t\tif(page === \"next\")\n\t\t\tpage = pagination.current + 1;\n\n\t\t/* Correct  */\n\t\tif(page === \"previous\")\n\t\t\tpage = pagination.current - 1;\n\n\t\t/* Go to page */\n\t\tpagination.goToPage(page);\n\n\t},\n\n\tscrollTo: function(element, event) {\n\n\t\t/* Get pagination */\n\t\tlet pagination = element.parents(\".pagination\").data(\"pagination\");\n\n\t\t/* Move */\n\t\tpagination.scroll(event);\n\n\t},\n\n\tgrab: function(runner) {\n\n\t\t/* Get pagination */\n\t\tlet pagination = runner.parents(\".pagination\").data(\"pagination\");\n\n\t\t/* Binds */\n\t\t$(window)\n\t\t\t.on(\"mouseup.pagination\", function() {\n\t\t\t\t$(window).off(\"mouseup.pagination mousemove.pagination\");\n\t\t\t}).on(\"mousemove.pagination\", function(event) {\n\t\t\t\tpagination.scroll(event);\n\t\t\t});\n\n\t},\n\n\tnext: function(button, _) {\n\t\tthis.setPage(button, _, \"next\")\n\t},\n\n\tprevious: function(button, _) {\n\t\tthis.setPage(button, _, \"previous\")\n\t}\n\n});","sky.action(\"selectReplace\", function({ visibleCalculator }) {\n\n    let filter = function(self, event) {\n\n        /* Get drop */\n        let popup  = self.closest(\".selectReplaceChoose\"),\n            inputs = popup.find(\"input[name]\");\n\n        /* On enter */\n        if(event.which === 13) {\n            let visible = popup.find(\"label:visible\");\n            if(visible.length > 0) {\n                inputs.prop(\"checked\", false);\n                visible.children(\"input\").prop(\"checked\", true).trigger(\"change\");\n            }\n            event.stopPropagation();\n        }\n\n        /* Get value */\n\t\tlet value = self.val(),\n\t\t\t rus              = \"\",\n             eng              = \"qwertyuiop[]asdfghjkl;'\\\\zxcvbnm,.\",\n             expression       = new RegExp(value.toLowerCase()),\n             expressionInvert = new RegExp(value.toLowerCase().replace(/[a-z-]/g, (character) => {\n                if(rus.indexOf(character) > -1) return eng[rus.indexOf(character)];\n                if(eng.indexOf(character) > -1) return rus[eng.indexOf(character)];\n                return character;\n            }));\n\n        /* Hide */\n        for(let input of inputs) {\n\n            if(input.parent().hasClass('hidden'))\n                return;\n\n            let inputHtml = input.next().html().toLowerCase();\n\n            try {\n                if(!inputHtml.match(expression) && !inputHtml.match(expressionInvert)) input.parent().hide();\n                else input.parent().show();\n            } catch(e) {}\n\n        }\n    };\n\n    return {\n\n        filter: filter,\n\n        selectAll: function(button) {\n\n            /* Get drop */\n            let popup = button.closest(\".selectReplaceChoose\");\n            popup.find(\":checkbox:visible\").prop(\"checked\", true).first().trigger(\"change\");\n\n        },\n\n        unSelectAll: function(button) {\n\n            /* Get drop */\n            let popup = button.closest(\".selectReplaceChoose\");\n            popup.find(\":checkbox:visible\").prop(\"checked\", false).first().trigger(\"change\");\n\n        },\n\n        close: function(element, event) {\n            if(element.get(0) === event.target)\n                $(\".selectReplaceChoose\").addClass('hidden');\n        },\n\n        /**\n         * Shows drop down\n         * @param replace Input\n         */\n        drop: function (replace) {\n\n            /* Hide all */\n\t\t\t$(\".selectReplaceChoose\").addClass('hidden');\n\n            /* Get drop */\n            let popup = replace.next(),\n                dropOffset = visibleCalculator.getDropOffset(replace, popup);\n\n\t\t\t/* If visible just hide */\n\t\t\tif(dropOffset) {\n\t\t\t\tpopup.removeClass('hidden').css({ marginLeft: dropOffset.left, margintop: dropOffset.top });\n\n\t\t\t\tif(replace.outerWidth() > popup.outerWidth())\n\t\t\t\t\tpopup.css(\"width\", replace.outerWidth());\n\n                /* Search focus */\n\t\t\t\tif (popup.find(\".search\").length)\n\t\t\t\t\tpopup.find(\".search input\").val('').focus();\n\n            }\n\n        }\n    }\n});","sky.directive(\".selectReplaceChoose\", function(popup, attrs) {\r\n\r\n\t\t/* Get inputs */\r\n\t\tlet labels = popup.find(\"label\"),\r\n\t\t\tinputs = popup.find(\"input:radio, input:checkbox\"),\r\n\t\t\tcurrent, change, children, replace = popup.prev(),\r\n\t\t\tval = \"\",\r\n            defaultValue = replace.html() || '-',\r\n            defaultAllValue = replace.text() || \"\";\r\n\r\n\t\treplace.data(\"addItem\", function(item) {\r\n\t\t\tvar newInput = sky.templates.renderByText(\"{% skyImport forms as forms %}{{ forms.selectReplaceGroup(items, options) }}\", { items: [item], options: {\r\n\t\t\t\tname: replace.attr(\"input\"),\r\n\t\t\t\tmultiple:  !replace.hasClass(\"single\")\r\n\t\t\t}});\r\n\t\t\tnewInput.insertAfter(inputs.filter(\":last\").parent());\r\n\t\t\tinputs = popup.find(\"input\");\r\n\t\t});\r\n\r\n\t\t/* On change */\r\n\t\t$(document).on(\"change\", '[data-input=\"'+ attrs[\"data-input\"] + '\"] input', change = function(event, data) {\r\n\r\n\t\t\t/* Remove selected styles */\r\n\t\t\tlabels.removeClass(\"selected\");\r\n\r\n\t\t\t/* Base text */\r\n\t\t\tval = \"\";\r\n\t\t\tchildren = false;\r\n\r\n\t\t\t/* Get checked */\r\n\t\t\tvar filtered = inputs.filter(\":checked\").each(function() {\r\n\t\t\t\tcurrent = $(this);\r\n\t\t\t\tcurrent.closest(\"label\").addClass(\"selected\");\r\n\t\t\t\tval = (val && val + \", \") + current.next().text();\r\n\t\t\t\tchildren = current.next();\r\n\t\t\t});\r\n\r\n\t\t\t/* Make text shorter */\r\n\t\t\tif(val.length > 26)\r\n\t\t\t\tval = val.substr(0, 26).trim() + \"...\";\r\n\r\n\t\t\tif(filtered.length === inputs.length && !popup.hasClass(\"single\"))\r\n\t\t\t\tval = defaultAllValue;\r\n\r\n\t\t\tif(popup.hasClass(\"single\") && children)\r\n\t\t\t\treplace.html('').prepend(children.clone().removeClass(\"name\"));\r\n\t\t\telse if(!children)\r\n\t\t\t\treplace.html(defaultValue);\r\n\t\t\telse\r\n\t\t\t\treplace.text(val);\r\n\r\n\t\t\t/* If not fake event */\r\n\t\t\tif(event && current) {\r\n                replace.trigger(\"change\", $.extend(data || {}, {\r\n                    value: current.val(),\r\n                    item: $(this)\r\n                }));\r\n            }\r\n\r\n            if(popup.hasClass(\"single\"))\r\n\t\t\t\t$(\".selectReplaceChoose\").addClass('hidden');\r\n\t\t});\r\n\r\n\t\t/* Trigger */\r\n\t\tsetTimeout(function() { change(false) }, 1);\r\n\r\n\t});\r\n\r\n\r\n$(document)\r\n\t.on(\"click touchstart\", function(event) {\r\n\r\n\t\t/* Get element */\r\n\t\tvar element = $(event.target || event.srcElement);\r\n\r\n\r\n\t\t/* If click in replace we should not hide it */\r\n\t\tif(element.closest(\".selectReplaceChoose\").length || element.closest(\".selectReplace\").length)\r\n\t\t\treturn;\r\n\r\n\t\t/* Hide all */\r\n\t\t$(\".selectReplaceChoose\").addClass('hidden');\r\n\r\n\t}).on(\"change\", \".specialSelect input\", function(event) {\r\n\t\tvar root = $(this).closest(\".specialSelect\");\r\n\t\troot.find(\".selected\").removeClass(\"selected\");\r\n\t\troot.find(\"input\").each(function() {\r\n\t\t\tvar self = $(this);\r\n\r\n\t\t\tif(self.is(\":checked\"))\r\n\t\t\t\tself.parent().addClass(\"selected\");\r\n\r\n\t\t});\r\n\r\n\t\t//root.closest(\"form\").trigger(\"submit\");\r\n\r\n\t}).on(\"mouseover\", \".selectReplaceChoose label\", function() {\r\n\r\n\t\tvar label = $(this);\r\n\t\tvar originalTip = label.find(\".checkItemTip\");\r\n\r\n\t\tif(originalTip.length && !label.data(\"tip\")) {\r\n\t\t\tvar popup = label.closest(\".selectReplaceChoose\");\r\n\t\t\tvar tip = originalTip.clone().removeClass(\"hidden\").appendTo(\"body\");\r\n\t\t\ttip.css({\r\n\t\t\t\tleft: popup.offset().left,\r\n\t\t\t\ttop: popup.offset().top + popup.outerHeight() + 5\r\n\t\t\t});\r\n\t\t\tlabel.data(\"tip\", tip);\r\n\t\t}\r\n\r\n\t}).on(\"mouseout\", \".selectReplaceChoose label\", function() {\r\n\r\n\t\tvar label = $(this);\r\n\r\n\t\tif(label.data(\"tip\")) {\r\n\t\t\tlabel.data(\"tip\").remove();\r\n\t\t\tlabel.removeData(\"tip\");\r\n\t\t}\r\n\r\n\t})\r\n\r\n;\r\n","sky.action(\"suggest\", function(suggester) {\r\n   return {\r\n       adverts: function(input, event) {\r\n\r\n           // Events\r\n           if(event.keyCode == 38 || event.keyCode == 40 || event.keyCode == 13 || event.keyCode == 27)\r\n               return;\r\n\r\n           // Stop if any other\r\n           if(this.suggestAjax)\r\n               this.suggestAjax.stop();\r\n\r\n           // Nothing\r\n           if(input.val() == \"\" || input.val().length < 2) {\r\n               suggester.hideAll();\r\n               return;\r\n           }\r\n\r\n           this.suggestAjax = sky.ajax(\"/ajax/members/search\", { name: input.val() })\r\n               .on(\"success\", function(response) {\r\n\r\n                   // No filtered\r\n                   if(!response.adverts || !response.adverts.length)\r\n                       suggester.hideAll();\r\n\r\n                   var filtered = [];\r\n\r\n                   $.each(response.adverts, function(_, advert) {\r\n                       filtered.push(advert.username);\r\n                   });\r\n\r\n                   // Show\r\n                   suggester.show(input, filtered);\r\n\r\n               }).on(\"error\", function() {\r\n                   suggester.hideAll();\r\n               });\r\n\r\n       },\r\n\r\n       campaigns: function(input, event){\r\n\r\n           // Events\r\n           if(event.keyCode == 38 || event.keyCode == 40 || event.keyCode == 13 || event.keyCode == 27)\r\n               return;\r\n\r\n           // Stop if any other\r\n           if(this.suggestAjax)\r\n               this.suggestAjax.stop();\r\n\r\n           // Nothing\r\n           if(input.val() == \"\" || input.val().length < 2) {\r\n               suggester.hideAll();\r\n               return;\r\n           }\r\n\r\n           this.suggestAjax = sky.ajax(\"/ajax/campaigns/search\", { name: input.val() })\r\n               .on(\"success\", function(response) {\r\n\r\n                   // No filtered\r\n                   if(!response.campaigns || !response.campaigns.length)\r\n                       suggester.hideAll();\r\n\r\n                   var filtered = [];\r\n\r\n                   $.each(response.campaigns, function(_, campaign) {\r\n\r\n                       filtered.push({ html: campaign.name });\r\n                   });\r\n\r\n                   // Show\r\n                   suggester.show(input, filtered);\r\n\r\n               }).on(\"error\", function() {\r\n                   suggester.hideAll();\r\n               });\r\n       },\r\n\r\n       campaignsSpecial: function(input, event){\r\n           // Events\r\n           if(event.keyCode == 38 || event.keyCode == 40 || event.keyCode == 13 || event.keyCode == 27)\r\n               return;\r\n\r\n           // Nothing\r\n           if(input.val() == \"\" || input.val().length < 2) {\r\n               suggester.hideAll();\r\n               return;\r\n           }\r\n\r\n           if(this.suggestAjax)\r\n               this.suggestAjax.stop();\r\n\r\n           this.suggestAjax = sky.ajax(\"/ajax/campaigns/search\", { name: input.val() })\r\n               .on(\"success\", function(response) {\r\n\r\n                   // No filtered\r\n                   if(!response.campaigns || !response.campaigns.length)\r\n                       suggester.hideAll();\r\n\r\n                   var filtered = [];\r\n\r\n                   $.each(response.campaigns, function(_, campaign) {\r\n\r\n                       filtered.push({ html: campaign.name+\" (\"+campaign.advert.username+\")\", callback: function(){\r\n                           sky.actions.perform(null, null, \"page.selectCampaign\", [campaign.id]);\r\n                       }});\r\n                   });\r\n\r\n                   // Show\r\n                   suggester.show(input, filtered);\r\n\r\n               }).on(\"error\", function() {\r\n                   suggester.hideAll();\r\n               });\r\n       }\r\n   }\r\n});","sky.directive(\"[data-suggests]\", function(element, attributes) {\n\telement.attr(\"data-event\", \"keyup: suggest.\" + attributes[\"data-suggests\"]).attr(\"autocomplete\", \"off\");\n});","sky.action(\"tips\", {\n\n\tshowTip: function (button, _, name) {\n\n\t\tif (button.data(\"tip\")) {\n\t\t\tbutton.data(\"tip\").hide();\n\t\t\treturn;\n\t\t}\n\n\t\t// Hide others\n\t\tsky.actions.perform(button, false, \"shared.hideTips\", [name]);\n\n\t\t// Create\n\t\tlet tip = sky.tips.Tip(\"bottom\", button, {\n\t\t\tcreate: $('<div/>').css(\"overflow\", \"hidden\").append($(\"#\" + name + \"TipText\").html())\n\t\t});\n\n\t\t// Show\n\t\ttip.show();\n\n\t},\n\n\tshowTipWithText: function (button, _, text) {\n\n\t\tif (button.data(\"tip\")) {\n\t\t\tbutton.data(\"tip\").hide();\n\t\t\treturn;\n\t\t}\n\n\t\t// Hide others\n\t\tsky.actions.perform(button, false, \"shared.hideTips\");\n\n\t\t// Create\n\t\tlet tip = sky.tips.Tip(\"bottom\", button, {\n\t\t\tcreate: $('<div/>').css(\"overflow\", \"hidden\").append(text)\n\t\t});\n\n\t\t// Show\n\t\ttip.show();\n\n\t},\n\n\thideTips: function (element, event) {\n\t\tlet target;\n\n\t\tif (event && event.target) {\n\t\t\ttarget = $(event.target);\n\t\t\tif (target.is(\"[sky-tip]\") || target.is(\"[sky-tip-text]\") || target.closest(\".tipContent\").length)\n\t\t\t\treturn;\n\t\t}\n\n\t\tsky.tips.hideAll();\n\n\t},\n\n\t/**\n\t *\n\t */\n\tforceHideTips: function () {\n\t\tsky.tips.hideAll(true);\n\t}\n});","sky.directive(\"[data-tip]\", function(button, attributes) {\n\n\t// Get\n\tlet events  = attributes[\"data-event\"] || \"\",\n\t\ttipName = attributes[\"data-tip\"],\n\t\tevent   = \"click: shared.showTip('\" + tipName + \"')\";\n\n\t// Set new\n\tevents = events ? event : events + \"; \" + event;\n\n\t// Add\n\tbutton.attr(\"data-event\", events).addClass(\"dashed\");\n\n});\nsky.directive(\"[data-tip-text]\", function(button, attributes) {\n\n\t// Get\n\tlet events  = attributes[\"data-event\"] || \"\",\n\t\ttipText = attributes[\"data-tip-hover\"] || attributes[\"data-tip-text\"],\n\t\tevent   = \"click: shared.showTipWithText('\" + tipText + \"')\";\n\n\t// Set new\n\tevents = events ? event : events + \"; \" + event;\n\n\t// Add\n\tbutton.attr(\"data-event\", events).addClass(\"dashed\");\n\n});\nsky.directive(\"[data-tip-hover]\", function(button, attributes) {\n\n\t// Get\n\tlet tipText = attributes[\"data-tip-hover\"];\n\n\tsky.service(\"tips\").bind(button, \"top\", {create: tipText});\n\n\t// Set new\n\tlet events = attributes[\"data-event\"] || \"\",\n\t\tevent  = \"click: shared.showTipWithText('\" + tipText + \"')\";\n\tevents = events ? event : events + \"; \" + event;\n\n\t// Add\n\tbutton.attr(\"data-event\", events).addClass(\"dashed\");\n\n});","/**\n * Fire services init done\n */\nsky.exec(function() {\n\tsky.servicesDeferred.resolve();\n});","sky.directive(\"input.autoHttp\", function(input) {\n\tinput.on(\"focus\", function() {\n\t\tif(input.val() === \"\") input.val(\"http://\").get(0).selectionStart = 7;\n\t});\n});","/**\n * Fire project init done\n */\nsky.exec(function() {\n    document.body.classList.remove(\"hidden\");\n    sky.projectDeffered.resolve();\n});"]}