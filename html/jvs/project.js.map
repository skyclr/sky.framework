{"version":3,"sources":["actions/actions.js","ajax/ajax.js","ajaxFiles/ajaxFiles.dropZone.js","ajaxFiles/ajaxFiles.iframe.js","ajaxFiles/ajaxFiles.js","ajaxFiles/ajaxFiles.xhr.js","calendar/calendar.js","callbacks/callback.js","callbacks/callbacks.js","dataOperator/dataOperator.js","dataOperator/inputsIO.js","directives/directives.js","drag/drag.js","history/history.js","localStorage/localStorage.js","models/models.js","models/modelsManager.js","models/modelsStorage.js","notifications/notifications.js","pagination/pagination.js","stacklist/stacklist.js","suggester/suggester.js","supported/supported.js","templates/templates.js","tips/tips.js","utils/utils.js","validator/validator.js","visibleCalculator/visibleCalculator.js","windows/windows.js","pagination/actions/paginationActions.js","selectReplace/actions/selectReplace.js","selectReplace/directives/select.js","suggester/actions/suggests.js","suggester/directives/suggests.js","tips/actions/tips.js","tips/directives/tips.js","servicesInit.js","shared.js","projectInit.js"],"names":["sky","service","exceptions","list","actions","perform","element","event","action","options","params","match","split","$","each","i","val","eval","trim","extend","self","path","current","name","isDisabled","elem","length","system","Error","apply","concat","add","events","safe","fn","selector","on","data","call","document","skyEvent","getAttribute","indexOf","type","preventDefault","map","parts","eventString","target","get","callbacks","url","object","callbackData","ajaxExtend","filter","disable","ajaxCallbacks","stop","ajax","abort","dataType","timeout","success","response","textStatus","jqXHR","error","text","fire","errorThrown","errorText","responseText","status","codes","code","promise","always","enable","supported","zone","files","XHRUpload","attachEvents","dragenter","dragleave","dragend","drop","dragover","originalEvent","isValidFileDrag","effect","dataTransfer","effectAllowed","dropEffect","bind","e","onStart","dt","isWebkit","navigator","userAgent","types","contains","AjaxFilesIFrame","input","prototype","getName","replace","cancel","id","onAbort","value","IFrame","setAttribute","remove","send","fileName","clone","insertBefore","createIframe","form","createForm","append","attachLoadEvent","getIframeContentJSON","onSuccess","setTimeout","trigger","iframe","callback","load","parentNode","contentDocument","body","innerHTML","doc","contentWindow","onError","jQuery","parseJSON","console","log","src","Math","floor","random","css","appendTo","queryString","param","method","enctype","attr","ajaxFilesXHR","ajaxFilesIFrame","AjaxFiles","inputs","saveFiles","file","push","inputName","parallel","_","handler","sendParallel","sendConsequentially","defaultSend","is","closest","find","templates","notifications","windows","filesAjax","modal","getLast","currentFile","holder","lock","render","insertAfter","parent","unlock","clearExceptTemplate","message","appendToModal","totalPercent","percent","html","stackList","toProceed","inProgress","total","totalLoaded","totalSize","fileRequests","size","loaded","args","formData","FormData","processData","contentType","xhr","XMLHttpRequest","upload","toFixed","onProgress","undefined","beforeSend","func","setRequestHeader","encodeURI","all","notSuccess","delete","fileRequestData","request","calendar","monthsNames","window","page","renderDays","moment","date","weeks","currentWeek","month","day","number","isoWeek","days","dateStr","format","dates","period","since","till","setTime","dayPick","dayDiv","notClose","parseInt","field","getInputValue","close","useTime","isSame","setDayPick","pickedDateView","position","marginTop","marginLeft","offset","top","outerHeight","left","periodChangeDay","reset","lastModified","isBefore","isAfter","markSelected","removeClass","addClass","changeDay","hour","minute","changeYear","year","yearView","changeMonth","monthView","getDatePeriod","dateString","getDate","off","show","showTime","lastPicked","subtract","dateOriginal","elementFromPoint","clientX","touches","clientY","onReady","srcElement","parents","keyCode","calendars","Callback","flags","functions","toRun","context","once","removeByContext","splice","removeByCallback","fireNext","result","Callbacks","advancedCallbacks","callbacksFlags","removeListener","listener","Object","getEventsNames","next","slice","possible","names","elements","j","join","inputsIO","utils","searchField","virtual","default","Array","isObjectsEqual","searchRead","hashRead","readInputsValues","writeInputsValue","hashValue","history","hashObject","searchValue","searchObject","baseOptions","fields","historyType","DataOperator","lastRequestData","beforeRequest","setOptions","onFormSubmit","validForm","force","reload","set","search","fromUrl","readSearch","writeForm","readHash","read","writeSearch","writeHash","prepareRequest","lastResponse","loading","reloadContent","item","fieldsList","valueOrNullOnDefault","write","fieldName","substring","initOperator","initLoader","loader","pagination","pages","onPageChange","pageNum","searchChanged","hashChanged","readInputValue","valuesNamed","valuesLined","writeInputValue","prop","first","notByUser","values","directives","directive","getAttributes","attributes","nodeName","nodeValue","parseElement","jsonScript","children","json","JSON","parse","tag","parseDirectives","bindEvents","start","move","started","button","x","pageX","y","pageY","getObjectsDifference","second","difference","localDiff","key","returnArray","History","hashString","searchString","pathString","intervalId","base","navigate","location","pathname","substr","pushState","oldPath","newPath","getWindowSearch","hash","change","hashDifference","searchDifference","old","getWindowHash","getDifference","rebuild","pathChanged","setHash","setSearch","changed","decodeURIComponent","proxy","stringFromObject","obj","getObjects","paramsString","objects","subStrings","str","keyAndValue","string","stored","decodeURI","onpopstate","setInterval","time","LocalStorage","items","getItems","localStorage","getItem","storage","setItem","stringify","modelsStorage","modelsDefinition","Model","definition","BaseDefinition","creation","extension","model","addDefinition","fromData","cached","Manager","arr","fromArray","cache","visibleCalculator","tips","notification","Modal","tip","align","Tip","create","loadings","global","click","hide","inModalWindow","content","contentHolder","calc","setPosition","calculate","width","height","setHolder","reCalculate","instance","init","Pagination","pageWidth","last","dimensions","startPage","lastStartPage","pagesVisible","pagesInvisible","scrollAvailable","scrollStart","tumbler","dom","slider","back","forward","redraw","goToPage","newPage","innerWidth","toShow","drawPages","createScroll","scrollLine","runner","scroll","outerWidth","isVisible","pos","List","lastId","index","hasOwnProperty","single","suggester","lastList","removeData","elementPosition","renderPosition","selected","prev","fullScreen","templatesList","templatesCompiled","Templates","globals","template","save","cookie","renderWithHolder","noDirectives","compile","temp","renderToText","renderByText","twig","renderByTextToText","compiled","fromLS","attrs","hideAll","withoutAutoHide","autoHide","highlight","shadow","opacity","background","closeTimeout","display","animate","fadeOut","fadeIn","blur","clearTimeout","what","addLeadingZero","encode","rawStr","charCodeAt","jsonData","prepareSelectData","columnSplitOn","maxColumns","columns","columnsCount","groupHolder","perColumn","ceil","column","groups","validator","validateForm","validationRule","addRule","validateElement","pass","shouldBeValidated","Options","totalPass","lastError","firstError","lastSuccess","firstSuccess","rules","ruleOverload","compiledRule","Rule","validate","rule","ruleDefaults","optionsDefaults","errorClass","successClass","overload","required","requiredIfFilled","email","same","regexp","RegExp","numeric","positive","parseFloat","max","min","minLength","maxLength","getDeclaredRules","Calculator","minHeight","scrollable","holderRect","scrollTop","windowHeight","windowWidth","sizes","right","realHeight","bottom","scrollLeft","popup","popupWidth","popupHeight","win","replaceOffset","popupOffset","leftDifference","topDifference","middle","visible","locked","dataContainer","closeButton","reRender","detach","removeMessages","innerHeight","byUser","setPage","scrollTo","grab","previous","which","stopPropagation","rus","eng","expression","toLowerCase","expressionInvert","character","hasClass","inputHtml","selectAll","unSelectAll","showTip","label","originalTip","hideTip","dropOffset","getDropOffset","focus","defaultValue","defaultAllValue","filtered","prepend","labels","newInput","multiple","adverts","suggestAjax","advert","username","campaigns","campaign","campaignsSpecial","hideTips","showTipWithText","forceHideTips","tipName","tipText","exec","servicesDeferred","resolve","closeWindow","submit","clearForm","changeOrder","orderField","order","table","trs","cell1","cell2","convert","sort","firstTr","secondTr","buttonTr","val1","val2","isNaN","changeOrderReload","currentLoader","selectionStart","classList","projectDeffered"],"mappings":"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","file":"project.js","sourcesContent":["sky.service(\"actions\", [\"exceptions\"], function ({exceptions}) {\n\n\tlet list = {},\n\t\tactions = this.service = {\n\n\t\t\t/**\n\t\t\t * Performs action\n\t\t\t * @param element\n\t\t\t * @param event\n\t\t\t * @param action\n\t\t\t * @param {Array} [options]\n\t\t\t */\n\t\t\tperform: function (element, event, action, options) {\n\n\t\t\t\t/* Get parameters */\n\t\t\t\tlet params = action.match(/(.+)\\((.*)\\)/);\n\n\t\t\t\t/* Parse */\n\t\t\t\tif (params) {\n\n\t\t\t\t\t/* Get function */\n\t\t\t\t\taction = params[1];\n\n\t\t\t\t\t/* Parse params */\n\t\t\t\t\tparams = params[2].split(\",\");\n\t\t\t\t\t$.each(params, function (i, val) {\n\t\t\t\t\t\tparams[i] = eval(val.trim());\n\t\t\t\t\t})\n\t\t\t\t}\n\n\t\t\t\t/* Options */\n\t\t\t\tif (options)\n\t\t\t\t\tparams = $.extend(params || [], options);\n\n\t\t\t\t/* Get */\n\t\t\t\tlet self = element ? $(element) : false,\n\t\t\t\t\tpath = action.split(\".\"),\n\t\t\t\t\tcurrent = list,\n\t\t\t\t\tname = action;\n\n\t\t\t\t/* If disabled */\n\t\t\t\tif (self && self.isDisabled && self.isDisabled())\n\t\t\t\t\treturn;\n\n\t\t\t\t$.each(path, function (i, elem) {\n\n\t\t\t\t\t/* Search */\n\t\t\t\t\tif (i + 1 < path.length && !current[elem])\n\t\t\t\t\t\tthrow new exceptions.system.Error(\"No action - \" + action + \", because can't find '\" + elem + \"'\");\n\n\t\t\t\t\t/* Get new elem */\n\t\t\t\t\tif (i + 1 < path.length)\n\t\t\t\t\t\tcurrent = current[elem];\n\n\t\t\t\t\t/* Save name */\n\t\t\t\t\tname = elem;\n\n\t\t\t\t});\n\n\t\t\t\t/* If no */\n\t\t\t\tif (!current[name])\n\t\t\t\t\tthrow new exceptions.system.Error(\"No action - \" + action);\n\n\t\t\t\t/* Call */\n\t\t\t\tcurrent[name].apply(current, [self, event].concat(params || []));\n\n\t\t\t},\n\n\t\t\t/**\n\t\t\t * Adds actions to list\n\t\t\t * @param name Group name\n\t\t\t * @param events List\n\t\t\t */\n\t\t\tadd: function (name, events) {\n\n\t\t\t\tif (typeof events === \"function\")\n\t\t\t\t\tevents = events.safe(true)();\n\n\t\t\t\t// Check\n\t\t\t\tif (!events || typeof events !== 'object')\n\t\t\t\t\tthrow new exceptions.system.Error(\"No event object for events '\" + name + \"' provided\");\n\n\t\t\t\t// Save\n\t\t\t\tlist[name] = $.extend(list[name] || {}, events);\n\n\t\t\t}\n\n\t\t};\n\n\n\t/**\n\t * Adds special bind function\n\t * @param {string} name Event name\n\t * @param {*} selector Selector string\n\t * @param {function} [action] Action function\n\t * @returns {jQuery}\n\t */\n\t$.fn.action = function(name, selector, action) {\n\n\t\t/* Parameters skip */\n\t\tif(typeof action === \"undefined\") { action = selector; selector = null; }\n\n\t\t/* Bind */\n\t\treturn this.on(name, selector, function(event, data) {\n\t\t\taction.call(this, event, $(this), data);\n\t\t}.safe());\n\t};\n\n\t/*\n\t * Bind declarative events\n\t */\n\t$(document).action(\"click submit keyup keydown dblclick mouseover mouseout mouseleave mouseenter change mousedown mouseup touchstart\", '[data-event]', function (event, self, data) {\n\n\t\t/* Get string */\n\t\tlet skyEvent = this.getAttribute(\"data-event\");\n\n\t\t/* If no such event in data-event attribute */\n\t\tif (skyEvent.indexOf(event.type) === -1)\n\t\t\treturn;\n\n\t\t/* If disabled */\n\t\tif (self.isDisabled && self.isDisabled()) {\n\t\t\tevent.preventDefault();\n\t\t\treturn;\n\t\t}\n\n\t\tskyEvent.split(\";\").map(eventString => {\n\n\t\t\t/* Get elements */\n\t\t\tlet parts = eventString.match(/(\\w+):(.*)/);\n\n\t\t\t/* Wrong */\n\t\t\tif (parts.length !== 3)\n\t\t\t\tthrow new exceptions.system.Error(\"Wrong action format in data-event: \" + eventString);\n\n\t\t\t/* Get elements */\n\t\t\tlet name = parts[1].trim(),\n\t\t\t\taction = parts[2].trim();\n\n\t\t\t/* Another event */\n\t\t\tif (name !== event.type)\n\t\t\t\treturn;\n\n\t\t\t/* No default go */\n\t\t\tif (event.target === self.get(0))\n\t\t\t\tevent.preventDefault();\n\n\t\t\t/* Passed data */\n\t\t\tevent.data = data;\n\n\t\t\t/* Perform action */\n\t\t\tactions.perform(this, event, action);\n\n\t\t});\n\n\t});\n\n});","sky.service(\"ajax\", [\"callbacks\"], function({ callbacks }) {\n\n\t/**\n\t * Advanced ajax execution\n\t * To abort call stop() method instead of abort() because it's used for abort callback set, or .ajax.abort()\n\t * You may skip type, don't skip it if lock is string set false in object and data\n\t * @param {string} url\t\t\t\tRequested url\n\t * @param {object} [data]\t\t\tHolds request parameters\n\t * @param {jQuery} [object]\t\t\tObject which performs request, to disable it during request\n\t * @param {object} [ajaxExtend]\t\tAdditional ajax options, see http://api.jquery.com/jQuery.ajaxSetup/\n\t * @param {object} [callbackData]\tAdditional params that passed to any callback\n\t */\n\tthis.service = function(url, data, { object = null, callbackData = {}, ajaxExtend = {} }) {\n\n\t\t/* Lock button */\n\t\tif(object)\n\t\t\tobject = $(object).filter(\":not(.disabled)\").disable();\n\n\t\t/* New object to store callbacks */\n\t\tlet ajaxCallbacks = new callbacks();\n\t\tajaxCallbacks.stop = function() { ajaxCallbacks.ajax.abort(); };\n\n\t\t/* Perform ajax request */\n\t\tajaxCallbacks.ajax = $.ajax($.extend(true, {\n\n\t\t\t/* Set base options */\n\t\t\turl     \t: url,\n\t\t\tdata    \t: data,\n\t\t\tdataType\t: \"json\",\n\t\t\ttype    \t: \"post\",\n\t\t\ttimeout\t\t: 480 * 1000,\n\t\t\tsuccess: function(response, textStatus, jqXHR) {\n\n\t\t\t\t/* Possible params list */\n\t\t\t\tlet params = $.extend({ jqXHR: jqXHR, textStatus: textStatus, object: object }, callbackData);\n\n\t\t\t\t/* If empty response */\n\t\t\t\tif(response === null) {\n\t\t\t\t\tparams.error = \"Данные небыли переданы\";\n\t\t\t\t\tparams.type = \"noData\";\n\t\t\t\t}\n\n\t\t\t\t/* If response returned with error */\n\t\t\t\tif(response.error) {\n\t\t\t\t\tparams.error = response.text;\n\t\t\t\t\tparams.type = \"php\";\n\t\t\t\t}\n\n\t\t\t\t/* If error type set */\n\t\t\t\tif(params.type)\n\t\t\t\t\treturn ajaxCallbacks.fire(\"notSuccess, error\", params); // No data\n\n\t\t\t\t/* Set response in possible params */\n\t\t\t\tparams.response = params.data = response;\n\n\t\t\t\t/* User success function */\n\t\t\t\treturn ajaxCallbacks.fire(\"preSuccess, success, notAbort\", params);\n\n\t\t\t}.safe(),\n\t\t\terror: function(jqXHR, textStatus, errorThrown) {\n\n\t\t\t\t/* Defaults */\n\t\t\t\tlet type        = \"Unknown\",\n\t\t\t\t\terrorText   = \"Во время выполнения запроса произошла ошибка, пожалуйста попробуйте позже\";\n\n\t\t\t\t/* Get error text according to response data */\n\t\t\t\tif(textStatus === \"abort\") {\n\t\t\t\t\ttype \t  = \"abort\";\n\t\t\t\t\terrorText = 'Выполнение запроса прервано';\n\t\t\t\t} else if(textStatus === 'parsererror') {\n\t\t\t\t\ttype \t  = \"parse\";\n\t\t\t\t\terrorText = \"Ответ пришел в неверном формате, пожалуйста попробуйте позже, текст:<br/>\" + jqXHR.responseText;\n\t\t\t\t} else if(textStatus === 'timeout') {\n\t\t\t\t\ttype \t  = \"timeout\";\n\t\t\t\t\terrorText = 'Время ожидания ответа истекло';\n\t\t\t\t} else if(jqXHR.status === 0) {\n\t\t\t\t\ttype \t  = \"stopped\";\n\t\t\t\t\terrorText = 'Загрузка остановлена, проверьте свои настройки сети';\n\t\t\t\t} else if(codes[jqXHR.status]) {\n\t\t\t\t\ttype = jqXHR.status;\n\t\t\t\t\terrorText = 'Ошибка во времы выполнения запроса <br/> ' + codes[jqXHR.status];\n\t\t\t\t}\n\n\t\t\t\t/* Possible params list */\n\t\t\t\tlet params = $.extend({\n\t\t\t\t\terror      : errorText,\n\t\t\t\t\ttype       : type,\n\t\t\t\t\tcode\t   : type,\n\t\t\t\t\tjqXHR      : jqXHR,\n\t\t\t\t\ttextStatus : textStatus,\n\t\t\t\t\tstatus     : textStatus,\n\t\t\t\t\terrorThrown: errorThrown,\n\t\t\t\t\tobject     : object\n\t\t\t\t}, callbackData);\n\n\t\t\t\t/* Execute callback */\n\t\t\t\tajaxCallbacks.fire(\"notSuccess\", params);\n\n\t\t\t\t/* Execute special ajaxCallbacks */\n\t\t\t\tajaxCallbacks.fire(textStatus === \"abort\" ? \"abort\" : \"error, notAbort\", params);\n\n\t\t\t}.safe()\n\n\t\t}, ajaxExtend));\n\n\t\t/* On always set */\n\t\tajaxCallbacks.ajax.promise().always(function(jqXHR, textStatus, errorThrown) {\n\n\t\t\t/* Unlock objects */\n\t\t\tif(object)\n\t\t\t\tobject.enable();\n\n\t\t\t/* Always callback */\n\t\t\tajaxCallbacks.fire(\"always\", { errorThrown: errorThrown, textStatus: textStatus, jqXHR: jqXHR, object: object});\n\n\t\t}.safe());\n\n\t\treturn ajaxCallbacks;\n\n\t};\n\n\t/**\n\t * Contains http codes\n\t */\n\tlet codes = {\n\n\t\t/* Request errors */\n\t\t400: \"Неверный запрос\",\n\t\t401: \"Для выполнеия запроса нужня авторизация\",\n\t\t402: \"Для доступа к ресурсу необходима оплата\",\n\t\t403: \"Доступ к ресурсу запрещен\",\n\t\t404: \"Сервер для выполнения запроса не найден или запрос выполнялся слишком долго\",\n\t\t405: \"Не поддерживаемый метод HTTP\",\n\t\t406: \"Не приемлемо\",\n\t\t407: \"Необходима аутентификация прокси\",\n\t\t408: \"Истекло время ожидания\",\n\t\t409: \"Конфликт\",\n\t\t410: \"Ресурс удален\",\n\t\t411: \"В запросе не указана длинна\",\n\t\t412: \"Условие ложно\",\n\t\t413: \"Размер запроса слишком велик\",\n\t\t414: \"Запрашиваемый URI слишком длинный\",\n\t\t415: \"Неподдерживаемый тип данных\",\n\t\t416: \"Запрашиваемый диапазон не достижим\",\n\t\t417: \"Ожидаемое неприемлемо\",\n\t\t422: \"Необрабатываемый экземпляр\",\n\t\t423: \"Ресурс заблокирован\",\n\t\t424: \"Невыполненная зависимость\",\n\t\t425: \"Неупорядоченный набор\",\n\t\t426: \"Необходимо обновление\",\n\t\t428: \"Необходимо предусловие\",\n\t\t429: \"Слишком много запросов\",\n\t\t431: \"Поля заголовка запроса слишком большие\",\n\t\t451: \"Недоступно по юридическим причинам\",\n\t\t456: \"Некорректируемая ошибка\",\n\t\t499: \"Используется Nginx, соединение закрыто до получения ответа\",\n\n\t\t/* Server error */\n\t\t500: \"Внутренняя ошибка сервера\",\n\t\t501: \"Не реализовано\",\n\t\t502: \"Плохой или ошибочный шлюз\",\n\t\t503: \"Сервис недоступен\",\n\t\t504: \"Шлюз не отвечает\",\n\t\t505: \"Версия HTTP не поддерживается\",\n\t\t506: \"Вариант тоже проводит согласование\",\n\t\t507: \"Переполнение хранилища\",\n\t\t508: \"Запрос зациклен\",\n\t\t509: \"Исчерпана пропускная ширина канала\",\n\t\t510: \"Не расширено\",\n\t\t511: \"Требуется сетевая аутентификация\"\n\n\t};\n\n});","/** Class to work with drop zone for File api */\nsky.service(\"ajaxFilesDropZone\", [\"supported\", \"callbacks\"], function({ supported, callbacks }) {\n\tthis.service = class {\n\t\tconstructor({ zone, data, url, options }) {\n\n\t\t\t/* Save options */\n\t\t\tthis.options   = options;\n\t\t\tthis.zone      = zone;\n\t\t\tthis.callbacks = callbacks();\n\t\t\tthis.data      = data;\n\t\t\tthis.url       = url;\n\t\t\tthis.files     = [];\n\n\t\t\t/* If no XHR supported, no file drop needed */\n\t\t\tif(!supported.XHRUpload) {\n\t\t\t\tthis.callbacks.fire(\"nonSupported\");\n\t\t\t\treturn this;\n\t\t\t}\n\n\t\t\t/* Bind events */\n\t\t\tthis.attachEvents();\n\n\t\t}\n\n\t\tattachEvents() {\n\n\t\t\t/* While over event */\n\t\t\tthis.zone.on({\n\n\t\t\t\tdragenter: (event) => { this.callbacks.fire(\"dragenter\", this, [event]); },\n\t\t\t\tdragleave: (event) => { this.callbacks.fire(\"dragleave\", this, [event]); },\n\t\t\t\tdragend  : (event) => { this.callbacks.fire(\"dragend\", this, [event]); \t },\n\t\t\t\tdrop     : (event) => { this.callbacks.fire(\"drop\", this, [event]);\t\t },\n\t\t\t\tdragover : (event) => {\n\n\t\t\t\t\t/* Get event */\n\t\t\t\t\tevent = event.originalEvent;\n\n\t\t\t\t\t/* Check if drag is valid */\n\t\t\t\t\tif(!this.isValidFileDrag(event))\n\t\t\t\t\t\treturn;\n\n\t\t\t\t\t/* Get effect */\n\t\t\t\t\tlet effect = event.dataTransfer.effectAllowed;\n\n\t\t\t\t\t/* Set proper */\n\t\t\t\t\tif(effect === 'move' || effect === 'linkMove') {\n\t\t\t\t\t\tevent.dataTransfer.dropEffect = 'move'; // for FF (only move allowed)\n\t\t\t\t\t} else {\n\t\t\t\t\t\tevent.dataTransfer.dropEffect = 'copy'; // for Chrome\n\t\t\t\t\t}\n\n\t\t\t\t\t/* Prevent */\n\t\t\t\t\tevent.preventDefault();\n\n\t\t\t\t}\n\t\t\t});\n\n\t\t\t/* Stop file opening when drop on browser window */\n\t\t\t$(document).bind({\n\t\t\t\tdragover : function(e) {\n\t\t\t\t\te = e.originalEvent;\n\t\t\t\t\tif(e.dataTransfer) {\n\t\t\t\t\t\te.dataTransfer.dropEffect = 'none';\n\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tdragenter: function(e) {\n\t\t\t\t\tif(typeof self.options.onStart !== \"undefined\")\n\t\t\t\t\t\tself.options.onStart.apply(self, [e]);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tstatic isValidFileDrag(event) {\n\n\t\t\tlet dt = event.dataTransfer,\n\t\t\t// do not check dt.types.contains in webkit, because it crashes safari 4\n\t\t\t\tisWebkit = navigator.userAgent.indexOf(\"AppleWebKit\") > -1;\n\n\t\t\t// dt.effectAllowed is none in Safari 5\n\t\t\t// dt.types.contains check is for firefox\n\t\t\treturn dt && dt.effectAllowed !== 'none' &&\n\t\t\t\t(dt.files || (!isWebkit && dt.types.contains && dt.types.contains('Files')));\n\n\t\t}\n\n\t};\n\n});","sky.service(\"ajaxFilesIFrame\", function() {\n\n\tlet AjaxFilesIFrame = function(options) {\n\n\t\t/* Save options */\n\t\tthis.options \t= options;\n\t\tthis.files    \t= options.files;\n\t\tthis.input   \t= options.input;\n\t\tthis.url  \t \t= options.url;\n\t\tthis.data \t \t= options.data;\n\t\tthis.callbacks \t= options.callbacks;\n\n\t};\n\n\tAjaxFilesIFrame.prototype = {\n\n\t\tgetName: function(name){\n\n\t\t\t// get input value and remove path to normalize\n\t\t\treturn name.replace(/.*(\\/|\\\\)/, \"\");\n\n\t\t},\n\n\t\tcancel: function(id){\n\n\t\t\tthis.options.onAbort(id, this.getName(this.input.value));\n\n\t\t\tthis.IFrame.setAttribute('src', 'javascript:false;').remove();\n\n\t\t},\n\n\t\t/**\n\t\t * Upload file function\n\t\t */\n\t\tsend: function() {\n\n\t\t\t/* letiables */\n\t\t\tlet self \t = this;\n\t\t\tlet input \t = this.input;\n\t\t\tlet fileName = this.getName(input.value);\n\n\t\t\t/* Create new input */\n\t\t\t$(input).clone().val(\"\").insertBefore(input);\n\n\t\t\t/* Create elements */\n\t\t\tthis.IFrame = this.createIframe();\n\t\t\tthis.form = this.createForm(this.IFrame, this.options.data).append(input);\n\n\t\t\tthis.attachLoadEvent(this.IFrame, function() {\n\n\t\t\t\tlet response = self.getIframeContentJSON(self.IFrame);\n\n\t\t\t\tif(response) self.options.onSuccess(response);\n\n\t\t\t\t// timeout added to fix busy state in FF3.6\n\t\t\t\tsetTimeout(function(){ self.IFrame.remove(); }, 1);\n\n\t\t\t});\n\n\t\t\tthis.form.trigger(\"submit\");\n\n\t\t},\n\n\t\t/**\n\t\t * Attach load event to IFrame\n\t\t */\n\t\tattachLoadEvent: function(iframe, callback){\n\n\t\t\tiframe.load(function(){\n\n\t\t\t\tif (!this.parentNode) return;\n\n\t\t\t\t// fixing Opera 10.53\n\t\t\t\tif (this.contentDocument &&\n\t\t\t\t\tthis.contentDocument.body &&\n\t\t\t\t\tthis.contentDocument.body.innerHTML === \"false\") return;\n\n\t\t\t\tcallback();\n\n\t\t\t});\n\n\t\t},\n\n\t\t/**\n\t\t * Returns json object received by IFrame from server.\n\t\t */\n\t\tgetIframeContentJSON: function(iframe){\n\n\t\t\t/* IFrame.contentWindow.document - for IE<7 */\n\t\t\tlet doc = iframe.get(0).contentDocument ? iframe.get(0).contentDocument: iframe.get(0).contentWindow.document;\n\n\t\t\tlet response = doc.body.innerHTML\n\n\t\t\t/* Check for empty response */\n\t\t\tif(response === \"\") {\n\t\t\t\tif(self.callbacks) self.callbacks.onError(\"Данные небыли переданы\"); // No data\n\t\t\t\treturn false;\n\t\t\t}\n\n\n\t\t\t/* Try to get json data */\n\t\t\ttry {\n\t\t\t\tresponse = jQuery.parseJSON(response);\n\t\t\t} catch(e) {\n\t\t\t\tif(self.callbacks) {\n\t\t\t\t\tself.callbacks.onError(\"Неверный формат данных\"); // No data\n\t\t\t\t\tconsole.log(response);\n\t\t\t\t}\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\t/* If response returned with error */\n\t\t\tif(response.error) {\n\t\t\t\tif(self.callbacks) self.callbacks.onError(response.text); // Execute user error handler\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\treturn response;\n\t\t},\n\n\t\t/**\n\t\t * Creates IFrame with unique name\n\t\t */\n\t\tcreateIframe: function() {\n\n\t\t\treturn $('<IFrame/>', { src: \"javascript:false;\", name: \"uploadIFrame\" + Math.floor(Math.random()*1000000) }).css(\"display\", \"none\").appendTo('body');\n\n\t\t},\n\n\t\t/**\n\t\t * Creates form, that will be submitted to IFrame\n\t\t */\n\t\tcreateForm: function(iframe, params) {\n\n\t\t\tlet queryString = this.url + \"?\" + jQuery.param(params);\n\n\t\t\treturn $('<form/>', {\n\t\t\t\tmethod: \"post\", enctype: \"multipart/form-data\", action: queryString, target: iframe.attr(\"name\")\n\t\t\t}).css(\"display\", \"none\").appendTo('body');\n\n\t\t}\n\n\t};\n\n});","/**\n * Module to work with ajax file upload\n */\nsky.service(\"ajaxFiles\", [\"supported\", \"callbacks\", \"ajaxFilesXHR\", \"ajaxFilesIFrame\"], function({ callbacks, supported, ajaxFilesXHR, ajaxFilesIFrame }) {\n\n\t/**\n\t * Class to work with dynamic file upload\n\t * @param {html|string} input Input to be used to upload\n\t * @param {string} url Url to upload\n\t * @param {object} data Data to be send with request\n\t */\n\tlet AjaxFiles = this.service = function(input, url, data) {\n\n\t\t/* Self construct */\n\t\tif(!(this instanceof AjaxFiles))\n\t\t\treturn new AjaxFiles(input, url, data);\n\n\t\t/* Save items */\n\t\tthis.inputs \t= $(input);\n\t\tthis.url   \t\t= url;\n\t\tthis.data  \t\t= data;\n\t\tthis.callbacks \t= callbacks();\n\t\tthis.files\t\t= [];\n\n\t\t/**\n\t\t * Function to handle file input change\n\t\t */\n\t\tthis.saveFiles = function(input) {\n\n\t\t\t/* Get files list */\n\t\t\tif(supported.XHRUpload) {\n\n\t\t\t\t/* Get files from event */\n\t\t\t\tlet files = input.get(0).files;\n\n\t\t\t\t/* Save them to this */\n\t\t\t\tfor(let file of files)\n\t\t\t\t\tthis.files.push({ file: file, input: input, inputName: input.attr(\"name\") });\n\n\t\t\t} else this.files.push(input.get(0));\n\n\t\t};\n\n\t\t/**\n\t\t * Sends ajax files\n\t\t * @param {bool} parallel If try files would be send in parallel\n\t\t * @returns {*}\n\t\t */\n\t\tthis.send = function(parallel) {\n\n\t\t\t/* Clear */\n\t\t\tthis.files = [];\n\n\t\t\t/* Get files list */\n\t\t\tthis.inputs.each((_, input) => { this.saveFiles($(input)); });\n\n\t\t\t/* If no files */\n\t\t\tif(!this.files.length)\n\t\t\t\treturn false;\n\n\t\t\t/* Create supported handler */\n\t\t\tlet handler;\n\t\t\tif(supported.XHRUpload)\n\t\t\t\thandler = new ajaxFilesXHR(this);\n\t\t\telse\n\t\t\t\thandler = new ajaxFilesIFrame(this);\n\n\t\t\t/* Send files */\n\t\t\tif(parallel)\n\t\t\t\tthis.sendParallel(handler);\n\t\t\telse\n\t\t\t\tthis.sendConsequentially(handler);\n\n\t\t\t/* return send handler */\n\t\t\treturn handler;\n\n\t\t};\n\n\t\t/**\n\t\t * Sends files consequentially\n\t\t * @param handler\n\t\t */\n\t\tthis.sendConsequentially = function(handler) {\n\n\t\t\t/* First id */\n\t\t\tlet id = 0;\n\n\t\t\t/* Set sending next after this one */\n\t\t\tthis.callbacks.on(\"always\", () => {\n\t\t\t\tid++;\n\t\t\t\tif(this.files[id])\n\t\t\t\t\thandler.send(this.files[id]);\n\t\t\t});\n\n\t\t\t/* Send first */\n\t\t\thandler.send(self.files[id]);\n\n\t\t};\n\n\t\t/**\n\t\t * Sends files parallel\n\t\t * @param handler\n\t\t */\n\t\tthis.sendParallel = function(handler) {\n\n\t\t\t/* Send files through them */\n\t\t\tfor(let file of this.files)\n\t\t\t\thandler.send(file);\n\n\t\t};\n\n\t\t/* Self return */\n\t\treturn this;\n\n\t};\n\n\t/**\n\t * Performs default file send\n\t * @param {string} url\n\t * @param element\n\t * @param data\n\t */\n\tAjaxFiles.defaultSend = function(url, element, data) {\n\n\t\t// Get input\n\t\tlet input = element.is(\"input[type=file]\") ? element : element.closest(\"label, .label\").find(\"input[type=file]\"),\n\t\t\texceptions = sky.service(\"exceptions\"),\n\t\t\ttemplates = sky.service(\"templates\"),\n\t\t\tnotifications = sky.service(\"notifications\"),\n\t\t\twindows = sky.service.windows(\"windows\");\n\n\t\t// Check\n\t\tif(!input.length)\n\t\t\tthrow new exceptions.system.Error(\"No proper input provided for file send\");\n\n\t\t// Init\n\t\tlet filesAjax = AjaxFiles(input, url, data),\n\t\t\tmodal = windows.getLast(),\n\t\t\tcurrentFile;\n\n\t\t/*  Bind events */\n\t\tfilesAjax.callbacks\n\t\t\t.on(\"begin\", function (file) {\n\t\t\t\tif(modal) {\n\t\t\t\t\tmodal.holder.find(\".preview\").remove();\n\t\t\t\t\tmodal.lock();\n\t\t\t\t}\n\t\t\t\tcurrentFile = templates.render(\"files-single-upload\", file).insertAfter(element.parent());\n\t\t\t})\n\t\t\t.on(\"always\", function () {\n\t\t\t\tcurrentFile.remove();\n\t\t\t\tif(modal)\n\t\t\t\t\tmodal.unlock();\n\t\t\t})\n\t\t\t.on(\"notSuccess\", function (error) {\n\t\t\t\tmodal.clearExceptTemplate();\n\t\t\t\tnotifications.message({text: error}).appendToModal(modal);\n\t\t\t})\n\t\t\t.on(\"progress\", function (totalPercent, percent) {\n\t\t\t\tcurrentFile.find(\".total\").html(percent + \"%\");\n\t\t\t\tcurrentFile.find(\".progressBar div\").css(\"width\", percent + \"%\");\n\n\t\t\t\t// If loaded\n\t\t\t\tif (percent === 100)\n\t\t\t\t\tcurrentFile.find(\".total\").html(\"100%, обработка\");\n\n\n\t\t\t})\n\t\t\t.on(\"start\", function () {\n\n\t\t\t});\n\n\t\t/* Send */\n\t\tfilesAjax.send();\n\t\treturn filesAjax;\n\n\t};\n\n});","/** Sends file data via HttpRequest */\nsky.service(\"ajaxFilesXHR\", [\"supported\", \"ajax\", \"stackList\"], function({supported, ajax, stackList}) {\n\tthis.service = class {\n\t\tconstructor(options) {\n\n\t\t\t/* Save options */\n\t\t\tthis.options \t\t= options;\n\t\t\tthis.files \t\t\t= options.files;\n\t\t\tthis.input \t\t\t= options.input;\n\t\t\tthis.url \t\t\t= options.url;\n\t\t\tthis.data \t\t\t= options.data;\n\t\t\tthis.callbacks \t\t= options.callbacks;\n\t\t\tthis.toProceed \t\t= options.files.length;\n\t\t\tthis.inProgress \t= 0;\n\t\t\tthis.total \t\t\t= options.files.length;\n\t\t\tthis.totalLoaded \t= 0;\n\t\t\tthis.totalSize \t\t= 0;\n\t\t\tthis.totalPercent \t= 0;\n\t\t\tthis.current \t\t= 0;\n\t\t\tthis.fileRequests \t= stackList();\n\n\t\t\t/* Go through */\n\t\t\tfor(file of options.files)\n\t\t\t\tthis.totalSize += file.size;\n\n\t\t}\n\n\t\t/**\n\t\t * Get file name\n\t\t * @param {*} file File\n\t\t * @returns {string}\n\t\t */\n\t\tstatic getName(file) {\n\t\t\treturn file.name.replace(/.*(\\/|\\\\)/, \"\");\n\t\t}\n\n\t\t/**\n\t\t * Uploads file\n\t\t * @param {*} file File name in files stack\n\t\t */\n\t\tsend(file) {\n\n\t\t\t/* This obj will store data associated with XHR */\n\t\t\t$.extend(file, {\n\t\t\t\tid     : Math.random(),\n\t\t\t\tname   : this.getName(file.file),\n\t\t\t\tsize   : file.file.size,\n\t\t\t\tajax   : false,\n\t\t\t\tpercent: false,\n\t\t\t\tloaded : 0\n\t\t\t});\n\n\t\t\t/* Prepare params */\n\t\t\tlet self        = this,\n\t\t\t\tparams      = this.data || {},\n\t\t\t\tqueryString = this.url + \"?ajaxFile=\" + file.name + \"&\" + jQuery.param(params);\n\n\t\t\t/**\n\t\t\t * Params extend\n\t\t\t * @param {object} args Object to be extended\n\t\t\t * @returns {*}\n\t\t\t */\n\t\t\tthis.extend = function(args) {\n\t\t\t\treturn jQuery.extend(args, {\n\t\t\t\t\ttotalLoaded : self.totalLoaded,\n\t\t\t\t\ttotalSize   : self.totalSize,\n\t\t\t\t\ttotalPercent: self.totalPercent,\n\t\t\t\t\tfile        : file,\n\t\t\t\t\tloaded      : file.loaded,\n\t\t\t\t\tsize        : file.size,\n\t\t\t\t\tpercent     : file.percent,\n\t\t\t\t\ttoProceed   : self.toProceed,\n\t\t\t\t\tcurrent     : self.current,\n\t\t\t\t\ttotal       : self.total\n\t\t\t\t});\n\t\t\t};\n\n\t\t\t/* Send */\n\t\t\tif(supported.formData) {\n\n\t\t\t\t/* Create form data sender */\n\t\t\t\tlet form = new FormData();\n\t\t\t\tform.append(file.inputName, file.file);\n\n\t\t\t\t/* Send start */\n\t\t\t\tfile.ajax = ajax(queryString, form, { ajaxExtend: {\n\t\t\t\t\t\tprocessData: false,\n\t\t\t\t\t\tcontentType: false,\n\t\t\t\t\t\ttype       : \"POST\",\n\t\t\t\t\t\txhr        : (() => {\n\t\t\t\t\t\t\ttry {\n\n\t\t\t\t\t\t\t\t/* Create XHR */\n\t\t\t\t\t\t\t\tlet xhr = new XMLHttpRequest();\n\n\t\t\t\t\t\t\t\t/* Set special upload api handlers */\n\t\t\t\t\t\t\t\txhr.upload[\"onloadstart\"] = function() {\n\t\t\t\t\t\t\t\t\tthis.inProgress++;\n\t\t\t\t\t\t\t\t\tthis.callbacks.fire(\"begin\", this.extend({}));\n\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t\txhr.upload[\"onprogress\"] = function(event) {\n\t\t\t\t\t\t\t\t\tthis.totalLoaded += event.loaded - file.loaded;\n\t\t\t\t\t\t\t\t\tthis.totalPercent = (this.totalLoaded / this.totalSize * 100).toFixed(0);\n\t\t\t\t\t\t\t\t\tthis.onProgress(event, file);\n\t\t\t\t\t\t\t\t};\n\n\t\t\t\t\t\t\t\t/* Return create XHR */\n\t\t\t\t\t\t\t\treturn xhr;\n\n\t\t\t\t\t\t\t} catch(e) {\n\t\t\t\t\t\t\t\treturn undefined;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}).safe()\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t} else {\n\n\t\t\t\t/* Send start */\n\t\t\t\tfile.ajax = ajax(queryString, file.file, {\n\t\t\t\t\tprocessData: false,\n\t\t\t\t\tcontentType: false,\n\t\t\t\t\ttype       : \"POST\",\n\t\t\t\t\tbeforeSend : sky.func(function(jqXHR) {\n\t\t\t\t\t\tjqXHR.setRequestHeader(\"X-Requested-With\", \"XMLHttpRequest\");\n\t\t\t\t\t\tjqXHR.setRequestHeader(\"X-File-Name\", encodeURI(file.name));\n\t\t\t\t\t\tjqXHR.setRequestHeader(\"Content-Type\", \"multipart/form-data\");\n\t\t\t\t\t\tjqXHR.setRequestHeader(\"Content-Disposition\", 'attachment; filename=\"' + encodeURI(file.name) + '\"');\n\t\t\t\t\t\tjqXHR.setRequestHeader(\"Accept\", \"text/html,application/xhtml+xml,application/xml;q=0.9\");\n\t\t\t\t\t})\n\t\t\t\t});\n\n\t\t\t}\n\n\t\t\t/* Set ajax callbacks */\n\t\t\tfile.ajax.on({\n\t\t\t\tsuccess:\t(all) => { this.callbacks.fire(\"success\", this.extend(all)); },\n\t\t\t\terror: \t\t(all) => { this.callbacks.fire(\"error\", this.extend(all)); },\n\t\t\t\tnotSuccess: (all) => { this.callbacks.fire(\"notSuccess\", this.extend(all)); },\n\t\t\t\talways: \t(all) => {\n\n\t\t\t\t\t/* Counters */\n\t\t\t\t\tthis.inProgress--;\n\t\t\t\t\tthis.toProceed--;\n\n\t\t\t\t\t/* Call always method */\n\t\t\t\t\tthis.callbacks.fire(\"always\", this.extend(all));\n\n\t\t\t\t\t/* Delete connection */\n\t\t\t\t\tthis.fileRequests.delete(file);\n\n\t\t\t\t}\n\t\t\t});\n\n\t\t\t/* Save */\n\t\t\tthis.fileRequests.add(file);\n\n\t\t}\n\n\t\t/**\n\t\t * Fores on progress change\n\t\t * @param event\n\t\t * @param fileRequestData\n\t\t */\n\t\tonProgress(event, fileRequestData) {\n\n\t\t\t/* Count percentage */\n\t\t\tlet percent = (event.loaded / event[\"total\"] * 100).toFixed(0);\n\t\t\tfileRequestData.loaded = event.loaded;\n\n\t\t\t/* If percent changed */\n\t\t\tif(percent !== fileRequestData.percent && event[\"lengthComputable\"]) {\n\t\t\t\tfileRequestData.percent = percent;\n\t\t\t\tthis.callbacks.fire(\"progress\", this.extend({}));\n\t\t\t}\n\n\t\t}\n\n\t\t/**\n\t\t * Aborts current download\n\t\t */\n\t\tabort() {\n\n\t\t\t/* Stop each request */\n\t\t\tthis.fileRequests.each(request => { request.ajax.stop() });\n\n\t\t\t/* Call always method */\n\t\t\tthis.callbacks.fire(\"abort\", this.extend({}));\n\n\t\t}\n\n\t};\n\n});","sky.service(\"calendar\", [ \"templates\" ], function ({ templates }) {\n\n\t/* This class is for showing calendar to pick date on page */\n\tlet calendar = {\n\n\t\t/* Days set */\n\t\tmonthsNames: window.page.data.monthsNames || [\"Январь\", \"Февраль\", \"Март\", \"Апрель\", \"Май\", \"Июнь\", \"Июль\", \"Август\", \"Сентябрь\", \"Октябрь\", \"Ноябрь\", \"Декабрь\"],\n\n\t\trenderDays: function () {\n\n\t\t\t/* Clone */\n\t\t\tlet current = moment(this.date),\n\t\t\t\tweeks = [],\n\t\t\t\tcurrentWeek = false;\n\n\t\t\t/* From first */\n\t\t\tcurrent.date(1);\n\n\t\t\t/* Go through */\n\t\t\twhile (current.month() === this.date.month()) {\n\n\t\t\t\t/* Make week if new */\n\t\t\t\tif (!currentWeek || current.day() === 1) {\n\t\t\t\t\tcurrentWeek = {number: current.isoWeek(), days: []};\n\t\t\t\t\tweeks.push(currentWeek);\n\t\t\t\t}\n\n\t\t\t\t/* Push */\n\t\t\t\tcurrentWeek.days.push({date: current.clone(), dateStr: current.format(\"YYYY.MM.DD\"), day: current.day() === 0 ? 6 : current.day() - 1});\n\n\t\t\t\t/* Go next day */\n\t\t\t\tcurrent.add(1, \"d\");\n\n\t\t\t}\n\n\t\t\t/* Render */\n\t\t\tthis.dates.html('').append(templates.render(\"calendar-dates\", {\n\t\t\t\tweeks: weeks,\n\t\t\t\tdateStr: this.date.format(\"YYYY.MM.DD\"),\n\t\t\t\tcurrent: this.date,\n\t\t\t\tperiod: this.period,\n\t\t\t\tsince: this.since,\n\t\t\t\ttill: this.till\n\t\t\t}));\n\n\t\t\t/* Render */\n\t\t\tthis.setTime();\n\n\t\t},\n\n\t\t/**\n\t\t * When user picks date\n\t\t * @param {*} dayDiv Div that user clicked, if he did\n\t\t * @param notClose\n\t\t */\n\t\tdayPick: function (dayDiv, notClose) {\n\n\t\t\t/* Set date */\n\t\t\tif (dayDiv)\n\t\t\t\tthis.date.date(parseInt(dayDiv.html()));\n\n\t\t\tthis.field.val(this.getInputValue()).trigger(\"change\").trigger(\"keyup\");\n\t\t\tif (!notClose) this.close();\n\n\t\t},\n\n\t\tgetInputValue: function () {\n\n\t\t\t/* Get field new value */\n\t\t\tif (this.useTime)\n\t\t\t\treturn this.date.format(\"DD.MM.YYYY HH:mm\");\n\t\t\telse if (this.period && this.since.isSame(this.till))\n\t\t\t\treturn this.since.format(\"DD.MM.YYYY\");\n\t\t\telse if (this.period)\n\t\t\t\treturn this.since.format(\"DD.MM.YYYY\") + ' - ' + this.till.format(\"DD.MM.YYYY\");\n\n\t\t\t/* Default */\n\t\t\treturn this.date.format(\"DD.MM.YYYY\");\n\n\t\t},\n\n\t\tsetDayPick: function () {\n\t\t\tthis.pickedDateView.html(this.getInputValue());\n\t\t},\n\n\t\t/**\n\t\t * Position date picker\n\t\t * @param {*} field Item that we should position under\n\t\t */\n\t\tposition: function (field) {\n\n\t\t\tthis.holder.insertAfter(field.parent()).css({\n\t\t\t\tmarginTop: 0,\n\t\t\t\tmarginLeft: 0,\n\t\t\t\tposition: \"absolute\"\n\t\t\t}).css({\n\t\t\t\tmarginTop: field.offset().top - this.holder.offset().top + field.outerHeight() + 1,\n\t\t\t\tmarginLeft: field.offset().left - this.holder.offset().left + 1\n\t\t\t});\n\n\t\t},\n\n\t\t/**\n\t\t * Sets time inputs in calendar values\n\t\t */\n\t\tsetTime: function () {\n\n\t\t\t/* Set time */\n\t\t\tthis.holder.find(\".time .hour\").val(this.date.format(\"HH\"));\n\t\t\tthis.holder.find(\".time .minute\").val(this.date.format(\"mm\"));\n\n\t\t},\n\n\t\tperiodChangeDay: function () {\n\n\t\t\tlet reset = function () {\n\t\t\t\tcalendar.since = calendar.date.clone();\n\t\t\t\tcalendar.till = calendar.date.clone();\n\t\t\t\tcalendar.lastModified = \"none\"\n\t\t\t};\n\n\t\t\tif (this.date.isBefore(this.since)) {\n\t\t\t\tif (this.lastModified !== \"since\") {\n\t\t\t\t\tthis.since = this.date.clone();\n\t\t\t\t\tthis.lastModified = \"since\"\n\t\t\t\t}\n\t\t\t\telse reset();\n\t\t\t} else if (this.date.isAfter(this.till)) {\n\t\t\t\tif (this.lastModified !== \"till\") {\n\t\t\t\t\tthis.till = this.date.clone();\n\t\t\t\t\tthis.lastModified = \"till\"\n\t\t\t\t}\n\t\t\t\telse reset();\n\t\t\t} else if (this.date.isSame(this.till) || this.date.isSame(this.since))\n\t\t\t\treset();\n\t\t\telse {\n\t\t\t\tif (this.lastModified === \"since\") {\n\t\t\t\t\tthis.till = this.date.clone();\n\t\t\t\t\tthis.lastModified = \"till\"\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tthis.since = this.date.clone();\n\t\t\t\t\tthis.lastModified = \"since\"\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tcalendar.markSelected();\n\n\t\t},\n\n\t\tmarkSelected: function () {\n\n\t\t\tthis.dates.find(\".day\").removeClass(\"selected\").removeClass(\"subSelected\").each(function () {\n\n\n\t\t\t\tlet element = $(this),\n\t\t\t\t\tdate = calendar.date.clone().date(parseInt(element.html()));\n\n\t\t\t\tif (!calendar.period) {\n\t\t\t\t\tif (date.format(\"DD.MM.YYYY\") === calendar.date.format(\"DD.MM.YYYY\"))\n\t\t\t\t\t\telement.addClass(\"subSelected\");\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (date.isAfter(calendar.since) && date.isBefore(calendar.till))\n\t\t\t\t\telement.addClass(\"subSelected\");\n\t\t\t\telse if (date.isSame(calendar.since) || date.isSame(calendar.till))\n\t\t\t\t\telement.addClass(\"selected\");\n\n\t\t\t});\n\n\t\t},\n\n\t\t/**\n\t\t * Changes day\n\t\t * @param {*} element Day picker\n\t\t * @returns {undefined}\n\t\t */\n\t\tchangeDay: function (element) {\n\n\t\t\t/* If pick today */\n\t\t\tthis.date.date(parseInt(element.html()));\n\n\t\t\t/* No more for period */\n\t\t\tif (this.period) {\n\t\t\t\tthis.periodChangeDay();\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tcalendar.markSelected();\n\n\t\t\t/* Set time */\n\t\t\tif (this.field.attr(\"name\") === \"since\")\n\t\t\t\tthis.date.hour(0).minute(0);\n\t\t\telse if (this.date.format(\"DD-MM-YYYY\") === moment().format(\"DD-MM-YYYY\"))\n\t\t\t\tthis.date.hour(moment().hour()).minute(moment().minute());\n\t\t\telse\n\t\t\t\tthis.date.hour(23).minute(59);\n\n\t\t\t/* Pick */\n\t\t\tif (!this.useTime)\n\t\t\t\tthis.dayPick(element);\n\t\t\telse\n\t\t\t\tthis.setTime();\n\n\t\t},\n\n\t\t/**\n\t\t * Sets specified year\n\t\t * @param {int} year Year that need to be set\n\t\t */\n\t\tchangeYear: function (year) {\n\n\t\t\t/* Set year */\n\t\t\tthis.date.year(year);\n\n\t\t\t/* Update */\n\t\t\tthis.yearView.html(year);\n\n\t\t\t/* Dates redraw */\n\t\t\tthis.renderDays();\n\n\t\t},\n\n\t\t/**\n\t\t * Sets specified month\n\t\t * @param {int} month Month to be set\n\t\t */\n\t\tchangeMonth: function (month) {\n\n\t\t\t/* Set year */\n\t\t\tthis.date.month(month);\n\n\t\t\t/* Updates */\n\t\t\tthis.monthView.html(this.monthsNames[this.date.month()] + ' ' + this.date.year());\n\n\t\t\t/* Reload year */\n\t\t\tthis.changeYear(this.date.year());\n\n\t\t},\n\n\t\tgetDatePeriod: function (dateString) {\n\n\t\t\t// Split and get since\n\t\t\tlet parts = dateString.split('-'),\n\t\t\t\ttill,\n\t\t\t\tsince = this.getDate(parts[0].trim());\n\n\t\t\t// Get till\n\t\t\tif (parts.length > 1)\n\t\t\t\ttill = this.getDate(parts[1].trim());\n\t\t\telse\n\t\t\t\ttill = this.getDate(parts[0].trim());\n\n\t\t\t// Set inner lets\n\t\t\tthis.since = since;\n\t\t\tthis.till = till;\n\t\t\tthis.date = since.clone();\n\n\t\t},\n\n\t\t/**\n\t\t * Creates today date\n\t\t */\n\t\tgetDate: function (dateString) {\n\n\t\t\t/* Set calendar date */\n\t\t\tlet date = false;\n\n\t\t\t/* If input has datetime format value */\n\t\t\tif (dateString.match(/^\\d{4}-\\d{2}-\\d{2} \\d{1,2}:\\d{1,2}$/))\n\t\t\t\tdate = moment(dateString, \"YYYY-MM-DD HH:mm\");\n\n\t\t\t/* Id input has date format value */\n\t\t\tif (dateString.match(/^\\d{4}-\\d{2}-\\d{2}$/))\n\t\t\t\tdate = moment(dateString, \"YYYY-MM-DD\");\n\n\t\t\t/* Id input has date format value */\n\t\t\tif (dateString.match(/^\\d{2}.\\d{2}.\\d{4}$/))\n\t\t\t\tdate = moment(dateString, \"DD.MM.YYYY\");\n\n\t\t\t/* Id input has date format value */\n\t\t\tif (dateString.match(/^\\d{2}.\\d{2}.\\d{4} \\d{2}:\\d{2}$/))\n\t\t\t\tdate = moment(dateString, \"DD.MM.YYYY HH:mm\");\n\n\t\t\t/*  If still no */\n\t\t\tif (!date) {\n\t\t\t\tdate = moment();\n\n\t\t\t\t/* Set time */\n\t\t\t\tif (this.field.attr(\"name\") === \"since\")\n\t\t\t\t\tdate.hour(0).minute(0);\n\t\t\t}\n\n\t\t\t/* Reset time */\n\t\t\tif (!this.useTime)\n\t\t\t\tdate.hour(0).minute(0);\n\n\t\t\t/* Additional check */\n\t\t\treturn this.date = date;\n\n\t\t},\n\n\t\t/**\n\t\t * Closes windows\n\t\t */\n\t\tclose: function () {\n\n\t\t\t/* Remove calendar */\n\t\t\tif (this.holder)\n\t\t\t\tthis.holder.remove();\n\n\t\t\t/* Unset */\n\t\t\tif (this.field) {\n\t\t\t\tthis.field.off(\"keyup.calendar\");\n\t\t\t\tthis.field = false;\n\t\t\t}\n\t\t}\n\t};\n\n\tlet show = function (field, showTime) {\n\n\t\t/* Remove old calendars */\n\t\tthis.close();\n\n\t\t/* Begins from current date */\n\t\tthis.field = field;\n\t\tthis.period = false;\n\t\tthis.useTime = showTime ? showTime : false;\n\t\tthis.lastPicked = \"none\";\n\n\t\tif (field.is(\"input.datePeriod\")) {\n\t\t\tthis.period = true;\n\t\t\tthis.getDatePeriod(field.val());\n\t\t} else\n\t\t\tthis.getDate(field.val());\n\n\t\t/* Render */\n\t\tthis.holder = templates.render(\"calendar\", this);\n\n\t\t/* Actions */\n\t\tthis.holder\n\n\t\t/* Months changer */\n\t\t\t.action(\"click\", \".month .next\", function (event) {\n\t\t\t\tevent.preventDefault();\n\t\t\t\tcalendar.changeMonth(calendar.date.month() + 1);\n\t\t\t})\n\t\t\t.action(\"click\", \".month .prev\", function (event) {\n\t\t\t\tevent.preventDefault();\n\t\t\t\tcalendar.changeMonth(calendar.date.month() - 1);\n\t\t\t})\n\n\t\t\t/* Years */\n\t\t\t.action(\"click\", \".year .next\", function (event) {\n\t\t\t\tevent.preventDefault();\n\t\t\t\tcalendar.changeYear(calendar.date.year() + 1);\n\t\t\t})\n\t\t\t.action(\"click\", \".year .prev\", function (event) {\n\t\t\t\tevent.preventDefault();\n\t\t\t\tcalendar.changeYear(calendar.date.year() - 1);\n\t\t\t})\n\t\t\t.action(\"click\", \".setNow\", function (event) {\n\t\t\t\tevent.preventDefault();\n\t\t\t\tcalendar.date = moment();\n\t\t\t\tcalendar.renderDays();\n\t\t\t\tcalendar.setTime();\n\t\t\t})\n\t\t\t.action(\"click\", \".setToday\", function (event) {\n\t\t\t\tevent.preventDefault();\n\t\t\t\tcalendar.date = moment();\n\t\t\t\tcalendar.date.hour(0);\n\t\t\t\tcalendar.date.minute(0);\n\t\t\t\tcalendar.renderDays();\n\t\t\t\tcalendar.setTime();\n\t\t\t})\n\t\t\t.action(\"click\", \".setWeek\", function (event) {\n\t\t\t\tevent.preventDefault();\n\t\t\t\tcalendar.date = moment();\n\t\t\t\tcalendar.date.subtract(7, \"d\");\n\t\t\t\tcalendar.renderDays();\n\t\t\t\tcalendar.setTime();\n\t\t\t})\n\n\t\t\t/* Day */\n\t\t\t.action(\"click\", \".dates .day\", function (event) {\n\t\t\t\tevent.preventDefault();\n\t\t\t\tlet self = $(this);\n\n\t\t\t\tif (self.is(\".selected\") && !calendar.period)\n\t\t\t\t\tcalendar.dayPick($(this));\n\t\t\t\telse {\n\t\t\t\t\tcalendar.changeDay($(this));\n\t\t\t\t\tcalendar.dayPick(false, true);\n\t\t\t\t}\n\t\t\t})\n\n\t\t\t/* Apply button */\n\t\t\t.action(\"click\", \".apply\", function (event) {\n\t\t\t\tevent.preventDefault();\n\t\t\t\tcalendar.dayPick();\n\t\t\t})\n\n\t\t\t/* Time */\n\t\t\t.action(\"click\", \".time a\", function (event) {\n\t\t\t\tevent.preventDefault();\n\t\t\t\tcalendar.date.hour(moment().hour());\n\t\t\t\tcalendar.date.minute(moment().minute());\n\t\t\t\tcalendar.setTime();\n\t\t\t})\n\t\t\t.action(\"keyup\", \".time .hour\", function () {\n\t\t\t\tcalendar.date.hour(this.value);\n\t\t\t})\n\t\t\t.action(\"keyup\", \".time .minute\", function () {\n\t\t\t\tcalendar.date.minute(this.value);\n\t\t\t});\n\n\n\t\t/* Close and containers */\n\t\tthis.dates = this.holder.find(\".dates\");\n\t\tthis.yearView = this.holder.find(\".year .value\");\n\t\tthis.monthView = this.holder.find(\".month .value\");\n\t\tthis.pickedDateView = this.holder.find(\".pickedDate\");\n\n\t\t/* Refresh days */\n\t\tthis.renderDays();\n\n\t\t/* Reposition */\n\t\tthis.position(field);\n\t\tthis.setDayPick();\n\n\t\t/* Auto change */\n\t\tthis.field.on(\"keyup.calendar\", function () {\n\t\t\tshow(field, showTime);\n\t\t});\n\n\t\tlet dateOriginal;\n\t\tthis.dates.on(\"touchstart\", function (event) {\n\n\t\t\tlet element = $(event.target);\n\t\t\tif (!element.is(\".day\")) return;\n\t\t\tdateOriginal = calendar.date.clone().date(parseInt(element.html()));\n\n\t\t}).on(\"touchmove\", function (event) {\n\n\t\t\t/* No original event */\n\t\t\tevent.preventDefault();\n\n\t\t\tlet element = document.elementFromPoint((event.clientX || event.originalEvent.touches[0].clientX), (event.clientY || event.originalEvent.touches[0].clientY));\n\t\t\telement = $(element);\n\n\t\t\tif (!element.is(\".day\")) return;\n\n\t\t\tlet date = dateOriginal.clone().date(parseInt(element.html()));\n\n\t\t\tif (date.isBefore(dateOriginal)) {\n\t\t\t\tcalendar.since = date.clone();\n\t\t\t\tcalendar.till = dateOriginal.clone();\n\t\t\t} else {\n\t\t\t\tcalendar.since = dateOriginal.clone();\n\t\t\t\tcalendar.till = date.clone();\n\t\t\t}\n\t\t\tcalendar.lastModified = \"none\";\n\t\t\tcalendar.markSelected();\n\t\t\t// $(this).trigger(\"click\");\n\n\t\t});\n\n\t}.bind(calendar);\n\n\t/* Return */\n\tthis.service = show;\n\n});\n\nsky.onReady(({calendar}) => {\n\n\t/* Calendar show */\n\t$(document).action(\"click.calendar\", function (event) {\n\n\t\t/* Get element */\n\t\tlet element = $(event.target || event.srcElement);\n\n\t\t/* Remove calendar */\n\t\tif (!element.is(\".calendar\") && !element.parents(\".calendar\").length)\n\t\t\t$(\".calendar\").remove();\n\n\t\t/* Calendar show */\n\t\tif (element.is(\"input.date\"))\n\t\t\tcalendar(element);\n\n\t\t/* Calendar show */\n\t\tif (element.is(\"input.datePeriod\"))\n\t\t\tcalendar(element, false, true);\n\n\t\t/* Calendar show */\n\t\tif (element.is(\"input.datetime\"))\n\t\t\tcalendar(element, true);\n\n\t\t/* Calendar show */\n\t\tif (element.is(\"input.datehour\"))\n\t\t\tcalendar(element, true);\n\n\t}).action(\"keydown.calendar\", function (event) {\n\t\tif (event.keyCode === 13) {\n\t\t\tlet calendars = $(\".calendar\");\n\t\t\tif (calendars.length) {\n\t\t\t\tcalendars.find(\".day.selected\").trigger(\"click\");\n\t\t\t\tevent.preventDefault();\n\t\t\t}\n\t\t}\n\t});\n});","sky.service(\"callback\", function() {\n\n\t/**\n\t * Creates callback object that holds functions list\n\t * @param {string} [flags]\n\t * @returns {*}\n\t * @constructor\n\t */\n\tlet Callback = function(flags) {\n\n\t\t/* Self construct */\n\t\tif(!(this instanceof Callback))\n\t\t\treturn new Callback(flags);\n\n\t\t/**\n\t\t * Functions list holder\n\t\t * @type {Array}\n\t\t */\n\t\tthis.functions = [];\n\t\tthis.toRun =  0;\n\t\tthis.context = this;\n\n\t\t/* Self return for next usage */\n\t\treturn this;\n\n\t};\n\n\t/**\n\t * Base\n\t * @type {{functions: Array, toRun: number, context: *, add: add, removeByContext: removeByContext, fire: fire, fireNext: fireNext}}\n\t */\n\tCallback.prototype = {\n\n\t\t/**\n\t\t * Adds new function to stack\n\t\t * @param {Function} func Function to add\n\t\t * @param {Object} context Function context\n\t\t * @param {Object} options Call options\n\t\t */\n\t\tadd: function(func, context, options) {\n\t\t\tthis.functions.push({\n\t\t\t\tfunc: func,\n\t\t\t\tcontext: context || false,\n\t\t\t\tonce: options && options.once\n\t\t\t});\n\t\t\treturn this;\n\t\t},\n\n\t\t/**\n\t\t * Removes function from list by context\n\t\t * @param context\n\t\t */\n\t\tremoveByContext: function(context) {\n\n\t\t\t/* Find listener */\n\t\t\tlet i;\n\t\t\tfor(i in this.functions)\n\t\t\t\tif(this.functions[i].context === context)\n\t\t\t\t\tthis.functions.splice(i, 1);\n\n\t\t\t/* Self return */\n\t\t\treturn this;\n\n\t\t},\n\n\t\t/**\n\t\t * Removes function from list by context\n\t\t * @param func\n\t\t */\n\t\tremoveByCallback: function(func) {\n\n\t\t\t/* Find listener */\n\t\t\tlet i;\n\t\t\tfor(i in this.functions)\n\t\t\t\tif(this.functions[i].func === func)\n\t\t\t\t\tthis.functions.splice(i, 1);\n\n\t\t\t/* Self return */\n\t\t\treturn this;\n\n\t\t},\n\n\t\t/**\n\t\t * Fires all functions\n\t\t * @param {Object} context Function context\n\t\t * @param {Array} args Arguments\n\t\t */\n\t\tfire: function(context, args) {\n\t\t\tfor(let func of this.functions)\n\t\t\t\tfunc.func.apply(func.context || context, args);\n\t\t},\n\n\t\t/**\n\t\t * Fires next function\n\t\t * @param {Array|Object} args Arguments\n\t\t * @param {Object} context Function context\n\t\t */\n\t\tfireNext: function(args, context) {\n\n\t\t\t/* If no more to run */\n\t\t\tif(this.functions.length <= this.toRun)\n\t\t\t\treturn false;\n\n\t\t\t/* Set next to run */\n\t\t\tthis.toRun++;\n\n\t\t\t/* Function to run */\n\t\t\tlet current = this.functions[this.toRun - 1],\n\t\t\t\tresult,\n\t\t\t\tfunc = current.func;\n\n\t\t\t/* Set context */\n\t\t\tcontext = current.context || context || window;\n\n\t\t\t/* Get function in string */\n\t\t\tif(typeof func === \"string\")\n\t\t\t\tfunc = context[func];\n\n\t\t\t/* If no function found */\n\t\t\tif(!func)\n\t\t\t\treturn true;\n\n\t\t\t/* Call function */\n\t\t\tresult =  func.apply(current.context || context, args) !== false;\n\n\t\t\t/* If call once */\n\t\t\tif(current.once) {\n\t\t\t\tthis.functions.splice(this.toRun - 2, 1);\n\t\t\t\tthis.toRun--;\n\t\t\t}\n\n\t\t\t/* Return function result */\n\t\t\treturn result;\n\t\t}\n\n\t};\n\n\tthis.service = Callback;\n\n});","sky.service(\"callbacks\", [\"callback\"], function({ callback }) {\n\n\t/**\n\t *\n\t * Callbacks prepared object\n\t * @param {*} [flags] Flags list for jQuery.Callbacks\n\t * @constructor\n\t */\n\tlet Callbacks = function(flags) {\n\n\t\t/* Self construction */\n\t\tif(!(this instanceof Callbacks))\n\t\t\treturn new Callbacks(flags);\n\n\t\t/* Add properties */\n\t\t$.extend(true, this, Callbacks.extend);\n\n\t\t/* Callbacks list */\n\t\tthis.advancedCallbacks = {};\n\n\t\t/* Set default flags and self context */\n\t\treturn this.flags(flags);\n\n\t};\n\n\t/**\n\t * Prototype\n\t * @type {{on: on, fire: fire, off: off, flags: flags, setContext: setContext}}\n\t */\n\tCallbacks.prototype = {\n\n\t\t\t/**\n\t\t\t * Flags for sky.Callback\n\t\t\t * @param {object} flags Flags list\n\t\t\t * @returns {*}\n\t\t\t */\n\t\t\tflags: function(flags) {\n\t\t\t\tthis.callbacksFlags = flags;\n\t\t\t\treturn this;\n\t\t\t},\n\n\t\t\t/**\n\t\t\t * Remove by listener\n\t\t\t * @param {string} name Event name\n\t\t\t * @param {string} listener Listener object\n\t\t\t */\n\t\t\tremoveListener: function(name, listener) {\n\t\t\t\tif(this.advancedCallbacks[name]) {\n\t\t\t\t\tthis.advancedCallbacks[name].removeByContext(listener);\n\t\t\t\t}\n\t\t\t},\n\n\t\t\t/**\n\t\t\t * Adds new event handler\n\t\t\t * @param {string} \t name \t\t\tName of event\n\t\t\t * @param {function|string} func \tFunction be called on event fires\n\t\t\t * @param {object}   [context]\t\tFunction options\n\t\t\t * @param {object}   [options]\t\tFunction options\n\t\t\t */\n\t\t\ton:  function(name, func, context, options) {\n\n\n\t\t\t\tif(name instanceof Object)\n\t\t\t\t\t$.each(name, (event, func) => { this.on(event, func) });\n\n\t\t\t\telse $.each(this.getEventsNames(name), (_, name) => {\n\n\t\t\t\t\t/* Create callbacks */\n\t\t\t\t\tif(!this.advancedCallbacks[name])\n\t\t\t\t\t\tthis.advancedCallbacks[name] = callback(this.callbacksFlags);\n\n\t\t\t\t\t/* Add function */\n\t\t\t\t\tthis.advancedCallbacks[name].add(func, context ? context : self.context, options || {});\n\n\t\t\t\t});\n\n\t\t\t\treturn this;\n\t\t\t},\n\n\t\t\t/**\n\t\t\t * Fires callbacks for specified event\n\t\t\t * @param {string} name Name of event\n\t\t\t * @param {object} args Arguments to be passed\n\t\t\t * @param {object} [options] Additional options\n\t\t\t */\n\t\t\tfire: function(name, args, options) {\n\n\t\t\t\t/* Success last */\n\t\t\t\tlet events = this.getEventsNames(name),\n\t\t\t\t\tself = this,\n\t\t\t\t\tnext = false;\n\t\t\t\t\toptions = options || {};\n\n\t\t\t\t/* Remove global if need */\n\t\t\t\tif(options[\"noGlobal\"])\n\t\t\t\t\tevents = events.slice(1);\n\n\t\t\t\t/* Fire events */\n\t\t\t\t$.each(events, function(_, event) {\n\n\t\t\t\t\t/* If no callback */\n\t\t\t\t\tif(!self.advancedCallbacks[event])\n\t\t\t\t\t\treturn;\n\n\t\t\t\t\t/* Run */\n\t\t\t\t\tdo {\n\t\t\t\t\t\tnext = self.advancedCallbacks[event].fireNext(jQuery.extend({ event: event }, args || []), self.context, options.possible);\n\t\t\t\t\t} while(next);\n\n\t\t\t\t\t/* Reset */\n\t\t\t\t\tif(!options.once)\n\t\t\t\t\t\tself.advancedCallbacks[event].toRun = 0;\n\n\t\t\t\t});\n\n\t\t\t},\n\n\t\t\t/**\n\t\t\t * Get all event names from global name\n\t\t\t * @param {String} name Global event name\n\t\t\t * @returns {Array}\n\t\t\t */\n\t\t\tgetEventsNames: function(name) {\n\n\t\t\t\t/* Get events names */\n\t\t\t\tlet names = name.split(\",\"), events = [];\n\n\t\t\t\t/* Go through */\n\t\t\t\t$.each(names, function(i, name) {\n\n\t\t\t\t\t/* Remove spaces */\n\t\t\t\t\tname = name.replace(\" \", \"\");\n\n\t\t\t\t\t/* Get elements */\n\t\t\t\t\tlet elements = name.split(\".\");\n\t\t\t\t\tevents.push(elements[0]);\n\n\t\t\t\t\t/* Go through */\n\t\t\t\t\tfor(let j = 1; j < elements.length; j++)\n\t\t\t\t\t\tevents.push(elements[0] + \".\" + elements[j]);\n\n\t\t\t\t\t/* Global event */\n\t\t\t\t\tif(elements.length > 2)\n\t\t\t\t\t\tevents.push(elements.join(\".\"));\n\n\t\t\t\t});\n\n\t\t\t\t/* Return */\n\t\t\t\treturn events;\n\n\t\t\t},\n\n\t\t/**\n\t\t * Removes event handlers and functions\n\t\t * @param {string} name Event name\n\t\t * @param func\n\t\t */\n\t\t\toff: function(name, func = null) {\n\t\t\t\tif(func && this.advancedCallbacks[name])\n\t\t\t\t\tthis.advancedCallbacks[name].removeByCallback(func);\n\t\t\t\telse\n\t\t\t\t\tdelete this.advancedCallbacks[name];\n\t\t\t}\n\n\t\t};\n\n\t\tthis.service = Callbacks;\n\n});","sky.service(\"dataOperator\", [ \"inputsIO\", \"notifications\", \"templates\", \"utils\", \"ajax\", \"actions\" ], function ({ inputsIO, notifications, templates, utils, ajax, actions }) {\n\n\tclass searchField {\n\t\tconstructor(name, virtual) {\n\t\t\tthis.name = name;\n\t\t\tthis.inputName = name;\n\t\t\tthis.virtual = virtual || false;\n\t\t\tthis.default = null;\n\t\t\tthis.input = false;\n\t\t\tthis.value = null;\n\t\t}\n\t\tvalueOrNullOnDefault() {\n\t\t\tif ((this.default instanceof Array) && (this.value instanceof Array))\n\t\t\t\treturn utils.isObjectsEqual(this.value, this.default) ? null : this.value;\n\n\t\t\treturn this.value === this.default ? null : this.value;\n\t\t}\n\t\tread() {\n\t\t\tif (this.virtual === \"search\")\n\t\t\t\treturn this.searchRead();\n\t\t\telse if (this.virtual)\n\t\t\t\treturn this.hashRead();\n\t\t\telse if (this.input)\n\t\t\t\tthis.value = inputsIO.readInputsValues(this.input);\n\n\t\t\treturn this.value;\n\t\t}\n\t\twrite() {\n\t\t\tif (this.input)\n\t\t\t\tinputsIO.writeInputsValue(this.value === null ? this.default : this.value, this.input);\n\t\t\treturn this.value;\n\t\t}\n\t\thashRead() {\n\t\t\tlet hashValue = page.history.hashObject[this.name];\n\t\t\treturn this.value = (typeof hashValue === \"undefined\") ? this.default : hashValue;\n\t\t}\n\t\tsearchRead () {\n\t\t\tlet searchValue = page.history.searchObject[this.name];\n\t\t\treturn this.value = (typeof searchValue === \"undefined\") ? this.default : searchValue;\n\t\t}\n\t}\n\n\t/**\n\t * Default options\n\t * @type {{}}\n\t */\n\tlet baseOptions = {\n\t\tfields: {},\n\t\thistoryType: \"hash\"\n\t};\n\n\t/* Creates new data operator */\n\tclass DataOperator {\n\t\tconstructor(options) {\n\n\t\t\t/* Stores last request object */\n\t\t\tthis.lastRequestData = false;\n\n\t\t\t/* Func that calls before request */\n\t\t\tthis.beforeRequest = false;\n\t\t\t\n\t\t\t/* Fields list */\n\t\t\tthis.fields = {};\n\n\t\t\t/* Add base options, but only not set, that's why so fun construction */\n\t\t\tthis.options = $.extend({}, baseOptions, true);\n\n\t\t\t/* Options init */\n\t\t\tthis.setOptions(options);\n\n\t\t}\n\n\t\t/** Saves to options */\n\t\tsetOptions(options) {\n\n\t\t\t/* Back link */\n\t\t\tlet self = this;\n\n\t\t\t/* Set submit handler */\n\t\t\tif (options.form)\n\t\t\t\t$(options.form).action(\"submit\", this.onFormSubmit.bind(this));\n\n\t\t\t/* Add to options */\n\t\t\t$.extend(this.options, options, true);\n\n\t\t\t/* Self return */\n\t\t\treturn this;\n\t\t}\n\n\t\t/**\n\t\t * On form submit\n\t\t * @param event\n\t\t */\n\t\tonFormSubmit(event) {\n\n\t\t\t/* Prevent */\n\t\t\tevent.preventDefault();\n\n\t\t\t/* If form not valid */\n\t\t\tif (!$(this.options.form).validForm())\n\t\t\t\treturn;\n\n\t\t\tlet options = {force: true};\n\n\t\t\tif (this.fields[\"page\"])\n\t\t\t\toptions[this.options.historyType === \"search\" ? \"search\" : \"hash\"] = {page: 1};\n\n\t\t\t/* Update */\n\t\t\tthis.reload(options);\n\n\t\t}\n\n\t\tprepareRequest(options) {\n\n\t\t\t/* On empty */\n\t\t\toptions = options || {};\n\n\t\t\t/* Hash fields */\n\t\t\tif (options[\"hash\"])\n\t\t\t\tpage.history.set(options[\"hash\"]);\n\n\t\t\t/* Hash fields */\n\t\t\tif (options[\"search\"])\n\t\t\t\tpage.history.search(options[\"search\"]);\n\n\t\t\t/* Hash fields */\n\t\t\tif (options[\"virtual\"]) {\n\t\t\t\tif (this.options.historyType === \"search\")\n\t\t\t\t\tpage.history.search(options[\"virtual\"]);\n\t\t\t\telse\n\t\t\t\t\tpage.history.set(options[\"virtual\"]);\n\t\t\t}\n\n\t\t\t/* Write to form from hash */\n\t\t\tif (options.fromUrl) {\n\t\t\t\tif (this.options.historyType === \"search\")\n\t\t\t\t\tthis.readSearch().writeForm();\n\t\t\t\telse\n\t\t\t\t\tthis.readHash().writeForm();\n\t\t\t}\n\n\t\t\t/* jQuery wrap */\n\t\t\tif (this.options.form && !$(this.options.form).validForm())\n\t\t\t\treturn false;\n\n\t\t\t/* Read */\n\t\t\tlet data = this.read();\n\n\t\t\t/* Add additional data */\n\t\t\tif (this.options[\"requestData\"])\n\t\t\t\tdata = $.extend(data, this.options[\"requestData\"]);\n\n\t\t\t/* Check is same and no force requested */\n\t\t\tif (this.lastRequestData !== false && utils.isObjectsEqual(this.lastRequestData, data) && !options[\"force\"])\n\t\t\t\treturn false;\n\n\t\t\t/* Set hash data */\n\t\t\tif (!options.fromUrl && this.options.historyType === \"search\")\n\t\t\t\tthis.writeSearch();\n\t\t\telse if (!options.fromUrl)\n\t\t\t\tthis.writeHash();\n\n\t\t\t/* Before request call */\n\t\t\tif (this.beforeRequest)\n\t\t\t\tif (this.beforeRequest(data, options) === false)\n\t\t\t\t\treturn false;\n\n\t\t\t/* Return data */\n\t\t\treturn data;\n\n\t\t}\n\n\t\t/**\n\t\t * Reloads data according to params\n\t\t * @param options\n\t\t * @returns {DataOperator}\n\t\t */\n\t\treload(options) {\n\n\t\t\t/* Prepare */\n\t\t\tlet data = this.prepareRequest(options);\n\n\t\t\t/* Reload */\n\t\t\tif (data)\n\t\t\t\tthis.request(data);\n\n\t\t\t/* Self return */\n\t\t\treturn this;\n\n\t\t}\n\n\t\t/**\n\t\t * Performs request to reload data\n\t\t * @param data\n\t\t */\n\t\trequest(data) {\n\n\t\t\t/* Back link */\n\t\t\tlet self = this;\n\n\t\t\t/* Save last data */\n\t\t\tself.lastRequestData = data;\n\n\t\t\t/* Stop old request */\n\t\t\tif (this.ajax)\n\t\t\t\tthis.ajax.stop();\n\n\t\t\t/* Request */\n\t\t\tthis.ajax = ajax(this.options.url, data)\n\t\t\t\t.on(\"success\", function (response) {\n\t\t\t\t\tself.lastResponse = response;\n\t\t\t\t\tself.render(response, data);\n\t\t\t\t})\n\t\t\t\t.on(\"error\", function (error) {\n\t\t\t\t\tself.error(error)\n\t\t\t\t})\n\t\t\t\t.on(\"always\", function () {\n\t\t\t\t\tself.ajax = false;\n\t\t\t\t});\n\n\t\t\t/* Create loading, auto remove when ajax finishes */\n\t\t\tnotifications.loading(this.ajax).reloadContent(this.options.holder);\n\n\t\t}\n\n\t\t/**\n\t\t * On success, have to be overloaded\n\t\t * @param data\n\t\t * @param request\n\t\t */\n\t\trender(data, request) {}\n\n\t\t/**\n\t\t * On error, have to be overloaded\n\t\t * @param error\n\t\t */\n\t\terror(error) {}\n\n\t\t/**\n\t\t * Adds list of fields to current list\n\t\t * @param {Array} list List of names\n\t\t * @param {Boolean} [virtual] Virtual fields flag\n\t\t */\n\t\tfieldsList(list, virtual) {\n\n\t\t\t/* Back link */\n\t\t\tlet self = this;\n\n\t\t\t/* Go through and push */\n\t\t\t$.each(list, function (_, item) {\n\t\t\t\tself.options.fields[item] = virtual;\n\t\t\t});\n\n\t\t\t/* Self return */\n\t\t\treturn this;\n\t\t\t\n\t\t}\n\n\t\t/**\n\t\t * Sets form fields\n\t\t * @param list\n\t\t * @returns {*}\n\t\t */\n\t\trealFieldsList(list) {\n\t\t\treturn this.fieldsList(list);\n\t\t}\n\n\t\t/**\n\t\t * Set none forms fields\n\t\t * @param list\n\t\t * @returns {*}\n\t\t */\n\t\tvirtualFieldsList(list) {\n\t\t\treturn this.fieldsList(list, true);\n\t\t}\n\n\t\t/**\n\t\t * Reads real fields\n\t\t * @returns {{}}\n\t\t */\n\t\treadReal() {\n\n\t\t\t/* Data holder */\n\t\t\tlet data = {};\n\n\t\t\t/* Go through */\n\t\t\t$.each(this.fields, function (i, field) {\n\t\t\t\t/** @let field searchField */\n\n\t\t\t\tif (field.virtual)\n\t\t\t\t\treturn;\n\n\t\t\t\t/* Read */\n\t\t\t\tfield.read();\n\n\t\t\t\t/* Get non default or null */\n\t\t\t\tlet val = field.valueOrNullOnDefault();\n\n\t\t\t\t/* If value not same as default */\n\t\t\t\tif (val !== null)\n\t\t\t\t\tdata[field.name] = val;\n\n\t\t\t});\n\n\t\t\t/* Self return */\n\t\t\treturn data;\n\n\t\t}\n\n\t\t/** Reads form to fields */\n\t\tread() {\n\n\t\t\t/* Data holder */\n\t\t\tlet data = {};\n\n\t\t\t/* Go through */\n\t\t\t$.each(this.fields, function (i, field) {\n\t\t\t\t/** @let field searchField */\n\n\t\t\t\t/* Read */\n\t\t\t\tfield.read();\n\n\t\t\t\t/* Get non default or null */\n\t\t\t\tlet val = field.valueOrNullOnDefault();\n\n\t\t\t\t/* If value not same as default */\n\t\t\t\tif (val !== null)\n\t\t\t\t\tdata[field.name] = val;\n\n\t\t\t});\n\n\t\t\t/* Self return */\n\t\t\treturn data;\n\t\t}\n\n\t\t/** Write current field to form */\n\t\twriteForm() {\n\t\t\t$.each(this.fields, function (i, field) {\n\t\t\t\t/** @let field searchField */\n\t\t\t\tfield.write();\n\t\t\t});\n\n\t\t\t/* Self return */\n\t\t\treturn this;\n\t\t}\n\n\t\t/** Reads hash to fields */\n\t\treadHash() {\n\t\t\t$.each(this.fields, function (i, field) {\n\t\t\t\t/** @let field searchField */\n\t\t\t\tfield.hashRead();\n\t\t\t});\n\n\t\t\t/* Self return */\n\t\t\treturn this;\n\t\t}\n\n\t\t/** Reads hash to fields */\n\t\treadSearch() {\n\t\t\t$.each(this.fields, function (i, field) {\n\t\t\t\t/** @let field searchField */\n\t\t\t\tfield.searchRead();\n\t\t\t});\n\n\t\t\t/* Self return */\n\t\t\treturn this;\n\t\t}\n\n\t\t/** Writes current fields to hash */\n\t\twriteHash() {\n\n\t\t\t/* To write */\n\t\t\tlet write = {};\n\n\t\t\t/* Go through */\n\t\t\t$.each(this.fields, function (i, field) {\n\t\t\t\t/** @let field searchField */\n\t\t\t\twrite[field.name] = field.valueOrNullOnDefault();\n\t\t\t});\n\n\t\t\t/* Write to hash */\n\t\t\tpage.history.set(write);\n\n\t\t\t/* Self return */\n\t\t\treturn this;\n\t\t}\n\n\t\t/** Writes current fields to hash */\n\t\twriteSearch() {\n\n\t\t\t/* To write */\n\t\t\tlet write = {};\n\n\t\t\t/* Go through */\n\t\t\t$.each(this.fields, function (i, field) {\n\t\t\t\t/** @let field searchField */\n\t\t\t\twrite[field.name] = field.valueOrNullOnDefault();\n\t\t\t});\n\n\t\t\t/* Write to hash */\n\t\t\tpage.history.search(write);\n\n\t\t\t/* Self return */\n\t\t\treturn this;\n\n\t\t}\n\n\t\t/** Finds inputs associated with fields */\n\t\tinitInputs() {\n\n\t\t\t/* Back link */\n\t\t\tlet self = this;\n\n\t\t\t$.each(this.options.fields, function (fieldName, virtual) {\n\n\t\t\t\t// Create search field\n\t\t\t\tlet field = new searchField(fieldName, virtual ? self.options.historyType : false);\n\n\t\t\t\t/** @let field searchField */\n\t\t\t\tif (!field.virtual) {\n\n\t\t\t\t\t/* Find input */\n\t\t\t\t\tif (field.name[0] === \"*\") {\n\t\t\t\t\t\tfield.name = field.name.substring(1);\n\t\t\t\t\t\tfield.input = $(self.options.form).find(\".selectReplaceChoose[data-input=\" + field.name + \"]\");\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t\tfield.input = $(self.options.form).find('[name=\"' + field.name + '\"]');\n\n\t\t\t\t\t/* Remove fields without input */\n\t\t\t\t\tif (!field.input || !field.input.length) {\n\t\t\t\t\t\tdelete self.fields[fieldName];\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\t/* Save */\n\t\t\t\t\tself.fields[fieldName] = field;\n\n\t\t\t\t\t/* Read default */\n\t\t\t\t\tfield.default = field.read();\n\t\t\t\t\tfield.value = null;\n\t\t\t\t} else {\n\t\t\t\t\tif (self.options.historyType === \"search\")\n\t\t\t\t\t\tfield.virtual = \"search\";\n\t\t\t\t\tself.fields[fieldName] = field;\n\t\t\t\t}\n\t\t\t});\n\n\t\t\t/* Self return */\n\t\t\treturn this;\n\t\t}\n\t};\n\n\t/* Interface */\n\tthis.service = {\n\t\tinitOperator: options => new DataOperator(options),\n\t\tsearchField: searchField,\n\t\tinitLoader: function (loader, notifications, pagination, { reload = true, history = true }) {\n\n\t\t\t/* Add count */\n\t\t\tloader.beforeRequest = function (data, options) {\n\t\t\t\tif (!this.lastRequestData || options.force)\n\t\t\t\t\tdata[\"count\"] = true;\n\t\t\t};\n\n\t\t\t/* Render function */\n\t\t\tloader.render = function (response) {\n\n\t\t\t\t// Re render\n\t\t\t\t$(this.options.holder).html('').append(\n\t\t\t\t\ttemplates.render(\"page-result-render\", response)\n\t\t\t\t);\n\n\t\t\t\t// Remove old\n\t\t\t\tif (this.pagination)\n\t\t\t\t\tthis.pagination = this.pagination.remove();\n\n\t\t\t\tif (typeof response.pages !== \"undefined\") {\n\n\t\t\t\t\t// Pages holder\n\t\t\t\t\tlet holder = $(\"#pages\").html('');\n\n\t\t\t\t\t// Create new\n\t\t\t\t\tif (response.pages > 1 && pagination) {\n\t\t\t\t\t\tthis.pagination = pagination.add({\n\t\t\t\t\t\t\tpages: response.pages,\n\t\t\t\t\t\t\tcurrent: response.page,\n\t\t\t\t\t\t\tholder: holder\n\t\t\t\t\t\t});\n\t\t\t\t\t\tthis.pagination.onPageChange = function (pageNum) {\n\t\t\t\t\t\t\tloader.reload({virtual: {page: pageNum}});\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t};\n\n\t\t\t/* On loading error */\n\t\t\tloader.error = function (error) {\n\n\t\t\t\t// Remove pagination on error\n\t\t\t\tif (this.pagination)\n\t\t\t\t\tthis.pagination = this.pagination.remove();\n\n\t\t\t\t// Clear\n\t\t\t\t$(this.options.holder).html('').append(notifications.message({text: error}).render);\n\t\t\t};\n\n\t\t\t/* Reload */\n\t\t\tif (reload)\n\t\t\t\tloader.reload({fromUrl: true});\n\n\t\t\t/* Set handler */\n\t\t\tif (history)\n\t\t\t\tpage.history.on(\"change\", function (searchChanged, hashChanged) {\n\t\t\t\t\tif (searchChanged || hashChanged)\n\t\t\t\t\t\tloader.reload({fromUrl: true});\n\t\t\t\t});\n\n\t\t}\n\t}\n\n});","sky.service(\"inputsIO\", function () {\n\n\tthis.service = {\n\n\t\t/**\n\t\t * Get value of single input\n\t\t * @param input\n\t\t * @returns {*}\n\t\t */\n\t\treadInputValue: function (input) {\n\n\t\t\tif (input.is(\".selectReplaceChoose\")) {\n\n\t\t\t\t// Get inputs\n\t\t\t\tlet inputs = input.find(\"input\");\n\n\t\t\t\t// Read\n\t\t\t\tlet data = this.readInputsValues(inputs);\n\n\t\t\t\t// If all checked\n\t\t\t\tif (data.length === inputs.length)\n\t\t\t\t\treturn true;\n\n\t\t\t\t// Return data\n\t\t\t\treturn data;\n\n\t\t\t} else if (input.is(\":checkbox\") || input.is(\":radio\")) {\n\t\t\t\treturn input.is(\":checked\") ? input.val() : false;\n\t\t\t} else\n\t\t\t\treturn input.val() === \"\" ? false : input.val();\n\n\n\t\t},\n\n\t\t/**\n\t\t * Get value of multiple inputs\n\t\t * @param inputs\n\t\t * @returns {*}\n\t\t */\n\t\treadInputsValues: function (inputs) {\n\n\t\t\t/* If single input */\n\t\t\tif (inputs.length === 1)\n\t\t\t\treturn this.readInputValue(inputs);\n\n\t\t\t/* Values holder */\n\t\t\tlet valuesNamed = [],\n\t\t\t\tvaluesLined = [],\n\t\t\t\tself = this;\n\n\t\t\t/* Go through */\n\t\t\tinputs.each(function () {\n\n\t\t\t\t/* Get value */\n\t\t\t\tlet input = $(this),\n\t\t\t\t\tvalue = self.readInputValue(input);\n\n\t\t\t\t/* If we get values */\n\t\t\t\tif (value !== false) {\n\t\t\t\t\tvaluesNamed.push({name: input.attr(\"name\"), value: value});\n\t\t\t\t\tvaluesLined.push(value);\n\t\t\t\t}\n\n\t\t\t});\n\n\t\t\t/* Single */\n\t\t\tif (valuesLined.length === 1) {\n\t\t\t\treturn valuesLined[0];\n\t\t\t}\n\n\t\t\t/* Return */\n\t\t\treturn valuesLined.length ? valuesLined : false;\n\n\t\t},\n\n\t\t/**\n\t\t * Write single input value\n\t\t * @param value\n\t\t * @param input\n\t\t * @returns {*}\n\t\t */\n\t\twriteInputValue: function (value, input) {\n\n\t\t\tif (input.is(\".selectReplaceChoose\")) {\n\n\t\t\t\t// Get inputs\n\t\t\t\tlet inputs = input.find(\"input\");\n\n\t\t\t\t// If all checked\n\t\t\t\tif (value === true)\n\t\t\t\t\tinputs.prop(\"checked\", true);\n\t\t\t\telse\n\t\t\t\t\tthis.writeInputsValue(value, inputs);\n\n\t\t\t\tif (inputs.length)\n\t\t\t\t\tinputs.first().trigger(\"change\", {notByUser: true});\n\n\t\t\t} else if (input.is(\":checkbox\") || input.is(\":radio\")) {\n\t\t\t\treturn input.prop(\"checked\", value !== false);\n\t\t\t} else\n\t\t\t\treturn input.val(value === false ? \"\" : value);\n\t\t},\n\n\t\t/**\n\t\t * Write multiple inputs value\n\t\t * @param values\n\t\t * @param inputs\n\t\t * @returns {*}\n\t\t */\n\t\twriteInputsValue: function (values, inputs) {\n\n\t\t\t/* Write single */\n\t\t\tif (inputs.length < 2)\n\t\t\t\treturn this.writeInputValue(values, inputs);\n\n\t\t\t/* Multiple */\n\t\t\tif (inputs.is(\":checkbox\") || inputs.is(\":radio\")) {\n\t\t\t\tinputs.prop(\"checked\", false);\n\t\t\t\tif (values instanceof Array) {\n\t\t\t\t\t$.each(values, function (_, val) {\n\t\t\t\t\t\tinputs.filter('[value=\"' + val + '\"]').prop(\"checked\", true);\n\t\t\t\t\t});\n\t\t\t\t\tinputs.first().trigger(\"change\", {notByUser: true});\n\t\t\t\t} else {\n\t\t\t\t\tif (values === false || values === true)\n\t\t\t\t\t\tinputs.prop(\"checked\", values).first().trigger(\"change\", {notByUser: true});\n\t\t\t\t\telse\n\t\t\t\t\t\tinputs.filter('[value=\"' + values + '\"]').prop(\"checked\", true).trigger(\"change\", {notByUser: true});\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tinputs.val(values);\n\t\t\t}\n\t\t}\n\n\t}\n\n});","sky.service(\"directives\", [\"exceptions\"], function ({exceptions}) {\n\n\tlet list = {},\n\t\tdirectives = this.service = {\n\n\t\t\t/**\n\t\t\t * Adds new directive\n\t\t\t * @param {string} name Directive name\n\t\t\t * @param {*} options Directive options\n\t\t\t * @param {function} directive How to parse directive\n\t\t\t */\n\t\t\tadd: function (name, options, directive) {\n\n\t\t\t\t/* Reset */\n\t\t\t\tif (!directive && typeof options === \"function\") {\n\t\t\t\t\tdirective = options;\n\t\t\t\t\toptions = {};\n\t\t\t\t}\n\t\t\t\toptions.directive = directive;\n\t\t\t\toptions.selector = name;\n\n\t\t\t\t/* Save */\n\t\t\t\tlist[name] = options;\n\n\t\t\t\t/* Self return*/\n\t\t\t\treturn this;\n\n\t\t\t},\n\n\t\t\t/**\n\t\t\t * Get element attributes\n\t\t\t * @param element\n\t\t\t * @returns {{}}\n\t\t\t */\n\t\t\tgetAttributes: function (element) {\n\n\t\t\t\t/* Holds attributes */\n\t\t\t\tlet attributes = {};\n\n\t\t\t\t/* Copy them to list */\n\t\t\t\tfor(let attr of element.get(0).attributes)\n\t\t\t\t\tattributes[attr.nodeName] = attr.nodeValue;\n\n\t\t\t\t/* Return */\n\t\t\t\treturn attributes;\n\n\t\t\t},\n\n\t\t\t/**\n\t\t\t * Applies directive convert to element\n\t\t\t * @param element\n\t\t\t * @param options\n\t\t\t */\n\t\t\tparseElement: function (element, options) {\n\n\t\t\t\t/* Get element */\n\t\t\t\telement = $(element);\n\n\t\t\t\t/* Get element attributes */\n\t\t\t\tlet attributes = this.getAttributes(element);\n\n\t\t\t\t/* Parse body for jason data */\n\t\t\t\tif (options[\"json\"] || options[\"jsonToData\"]) {\n\n\t\t\t\t\t/* Get child */\n\t\t\t\t\tlet jsonScript = element.children('script[type=\"application/json\"]');\n\n\t\t\t\t\t/* If we have json encoded data */\n\t\t\t\t\tif (jsonScript.length) {\n\n\t\t\t\t\t\ttry {\n\n\t\t\t\t\t\t\t/* Parse json */\n\t\t\t\t\t\t\tlet json = JSON.parse(jsonScript.text());\n\n\t\t\t\t\t\t\t/* Extend */\n\t\t\t\t\t\t\t$.extend(attributes, json);\n\n\t\t\t\t\t\t\t/* Save to data */\n\t\t\t\t\t\t\tif (options[\"jsonToData\"])\n\t\t\t\t\t\t\t\telement.data(\"json\", json);\n\n\t\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\t\tthrow new exceptions.system.Error(\"Element \" + options.selector + \" should have json stored content, but error on parse appears\");\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t/* Call parse function */\n\t\t\t\tif (typeof options.directive === \"function\")\n\t\t\t\t\toptions.directive(element, attributes);\n\t\t\t},\n\n\t\t\t/**\n\t\t\t * Searches and replaces directives in element\n\t\t\t * @param element\n\t\t\t */\n\t\t\tparse: function (element) {\n\t\t\t\t$.each(list, function (tag, options) {\n\t\t\t\t\t$(tag, element).each(function () {\n\t\t\t\t\t\tdirectives.parseElement(this, options);\n\t\t\t\t\t});\n\t\t\t\t\tif (element.is(tag))\n\t\t\t\t\t\tdirectives.parseElement(element, options);\n\t\t\t\t});\n\t\t\t}\n\n\n\t\t};\n\n\t/* Add jQuery fn */\n\tjQuery.fn.parseDirectives = function () {\n\n\t\t/* Parse */\n\t\tdirectives.parse(this);\n\n\t\t/* Return */\n\t\treturn this;\n\n\t};\n\n\t/* Parse body for directives when all ready */\n\tsky.onReady(function () {\n\t\t$(\"body\").parseDirectives();\n\t});\n\n});","sky.service(\"drag\", [\"callbacks\"], function({callbacks}) {\n\tlet self = {\n\t\tbindEvents: (event, events) => {\n\t\t\tself.bind(event)\n\t\t\t\t.on(\"start\", events.start)\n\t\t\t\t.on(\"move\", events.move)\n\t\t\t\t.on(\"stop\", events.stop)\n\t\t},\n\t\tbind: event => {\n\n\t\t\t// Get original event\n\t\t\tevent = event.originalEvent || event;\n\n\t\t\t// Init vars\n\t\t\tlet started = false,\n\t\t\t\tcallbacks = callbacks();\n\n\t\t\t// Check button\n\t\t\tif(event.button && event.button !== 1)\n\t\t\t\treturn callbacks;\n\n\t\t\t// Stop default action\n\t\t\tevent.preventDefault();\n\n\t\t\t$(document).on(\"mousemove.drag\", function(event) {\n\n\t\t\t\t// Start\n\t\t\t\tif(!started) {\n\t\t\t\t\tstarted = true;\n\t\t\t\t\tcallbacks.fire(\"start\", { event: event, x: event.pageX, y: event.pageY });\n\t\t\t\t}\n\t\t\t\t// Move\n\t\t\t\telse callbacks.fire(\"move\", { event: event, x: event.pageX, y: event.pageY });\n\n\t\t\t\t// Prevent default\n\t\t\t\tevent.preventDefault();\n\t\t\t\treturn false;\n\n\t\t\t}).on(\"mouseup.drag\", function(event) {\n\n\t\t\t\t// Off events\n\t\t\t\t$(document).off(\"mousemove.drag\").off(\"mouseup.drag\");\n\n\t\t\t\t// If not started\n\t\t\t\tif(!started)\n\t\t\t\t\treturn;\n\n\t\t\t\t// Stop default action\n\t\t\t\tevent.preventDefault();\n\n\t\t\t\t// Call stop callback\n\t\t\t\tcallbacks.fire(\"stop\", { event: event, x: event.pageX, y: event.pageY });\n\n\t\t\t});\n\n\t\t\treturn callbacks;\n\t\t}\n\t};\n\treturn self;\n});","sky.service(\"history\", [ \"callbacks\", \"supported\" ], function ({ callbacks, supported }) {\n\n\n\t/**\n\t * Get difference fields in objects\n\t * @param {object} first  Object to compare\n\t * @param {object} second Object to compare\n\t */\n    let getObjectsDifference = function (first, second) {\n\n\t\tlet difference = {},\n\t\t    localDiff = false;\n\n        /* If both arrays or objects */\n\t\tif ((first instanceof Array && second instanceof Array) || (first instanceof Object && second instanceof Object)) {\n\n            /* Find what was changed or deleted in second */\n\t\t\t$.each(first, function (key, value) {\n\n                /* If no such elements in second */\n\t\t\t\tif (typeof second[key] === \"undefined\")\n\t\t\t\t\tdifference[key] = null; // Set to null\n\n                /* Check if different */\n\t\t\t\telse if (localDiff = getObjectsDifference(value, second[key])) {\n\t\t\t\t\tdifference[key] = localDiff;\n\t\t\t\t}\n\n\t\t\t});\n\n            /* If was added */\n\t\t\t$.each(second, function (key, value) {\n\t\t\t\tif (typeof first[key] === \"undefined\")\n\t\t\t\t\tdifference[key] = value;\n\t\t\t});\n\n            /* Convert object to array */\n\t\t\tif (first instanceof Array) {\n\t\t\t\tlet returnArray = [];\n\t\t\t\t$.each(difference, function (key) {\n\t\t\t\t\treturnArray.push(difference[key]);\n\t\t\t\t});\n\t\t\t\tdifference = returnArray;\n\t\t\t}\n\n\t\t} else {\n\t\t\tif (first !== second) return second;\n\t\t\telse return false;\n\t\t}\n\n        /* No array difference */\n\t\tif (difference.length === 0) return false;\n\t\telse return difference;\n\n\t};\n\n    /**\n     * History constructor\n     * @param [options]\n     * @returns {sky.History}\n     * @constructor\n     */\n    sky.History = function (options) {\n\n\t\t/* Self creation */\n        if (!(this instanceof sky.History))\n            return new sky.History(options);\n\n\t\t/* Reset */\n        this.options = options || {};\n\n\t\t/* Set events */\n        this.events = this.options.events || new callbacks();\n        this.options.events = this.events;\n\n\t\t/* Self return */\n        return this;\n\n    };\n\n    /**\n     * Extending\n     */\n    $.extend(sky.History.prototype, {\n\n        /**\n         * Stores last saved hash\n         */\n        hashString: \"\",\n\n        /**\n         * Stores last saved search\n         */\n        searchString: \"\",\n\n        /**\n         * Stores last saved path\n         */\n        pathString: \"\",\n\n        /**\n         * Stores object with hash params key/value pairs\n         */\n        hashObject: {},\n\n        /**\n         * Stores object with page search params key/value pairs\n         */\n        searchObject: {},\n\n        /**\n         * Stores events\n         */\n        events: undefined,\n\n        /**\n         * Holds hash check function interval id\n         */\n        intervalId: 0,\n\n        /**\n         * This page base url\n         */\n        base: \"\",\n\n        /**\n         * Changes current path to specified\n         * @param {string} path PAth to navigate\n         */\n        navigate: function (path) {\n\n            // Get path\n            path = path.replace(\"~\", this.base);\n\n            // Get current\n            let current = (window.location.pathname + window.location.search).substr(this.base.length);\n\n            // If changes\n            if (current !== path) {\n\n                // Set new state\n                history.pushState({ oldPath: this.pathString, newPath: path, search: this.searchObject}, path, path);\n\n                // Get new\n                this.pathString = window.location.pathname.substr(this.base.length);\n\n                // Get search string\n                this.searchString = this.getWindowSearch();\n\n                // Fire event\n                this.events.fire(\"navigate.path, always\", {hash: this.hashObject, path: this.pathString, search: this.searchObject});\n\n            }\n        },\n\n        /**\n         * Fires on path change\n         */\n        change: function () {\n\n\t\t\t/* Hash difference holder */\n            let hashDifference = {},\n                searchDifference = {},\n                old = this.pathString,\n                hashChanged = false,\n                searchChanged = false;\n\n\t\t\t/* If api supported */\n            if (this.supported)\n                this.pathString = window.location.pathname.substr(this.base.length);\n\n\t\t\t/* Check if hash changed */\n            if (this.hashString !== this.getWindowHash()) {\n\n\t\t\t\t/* Get difference */\n                hashDifference = this.getDifference(this.getWindowHash(), this.hashObject);\n\n\t\t\t\t/* Hash change flag */\n                hashChanged = true;\n\n            }\n\n\t\t\t/* Check if params changed */\n            if (this.searchString !== this.getWindowSearch()) {\n\n\t\t\t\t/* Get difference */\n                searchDifference = this.getDifference(this.getWindowSearch(), this.searchObject);\n\n\t\t\t\t/* Hash change flag */\n                searchChanged = true;\n\n            }\n\n\t\t\t/* If nothing changed */\n            if (this.pathString === old && !hashChanged && !searchChanged)\n                return;\n\n\t\t\t/* Rebuild hash object on new hash str */\n            this.rebuild();\n\n\t\t\t/* Fire */\n            this.events.fire(\"change, always\", {\n                hash: this.hashObject,\n                hashDifference: hashDifference,\n                searchDifference: searchDifference,\n                path: this.pathString,\n                oldPath: old,\n                searchChanged: searchChanged,\n                hashChanged: hashChanged,\n                pathChanged: old !== this.pathString\n            });\n\n        },\n\n        /**\n         * Navigates to specified path\n         * @param path\n         */\n        setHash: function (path) {\n\n\t\t\t/* To not jump top */\n            if (path === \"\" && window.location.hash !== \"\")\n                path = \"none\";\n\n\t\t\t/* Save */\n            this.hashString = path;\n\n\t\t\t/* Set hash */\n            window.location.hash = encodeURI(path);//encodeURI(path);\n\n        },\n\n        /**\n         * Navigates to specified path\n         * @param path\n         */\n        setSearch: function (path) {\n\n\t\t\t/* Set path */\n            this.navigate(window.location.pathname + encodeURI(path !== \"\" ? \"?\" + path : \"\"));\n\n        },\n\n        /**\n         * Sets hash letiable\n         * @param {object}    elements Fields to be set\n         * @param {boolean}    [force]     Replace all stored fields with elements object\n         */\n        set: function (elements, force) {\n\n            let changed = false;\n\n\t\t\t/* Force rewrite */\n            if (force)\n                this.hashObject = elements;\n\n\t\t\t/* Go through elements and add or change them */\n            $.each(elements, (key, value) => {\n\n\t\t\t\t/* If we need delete */\n                if (value === null)\n                    delete this.hashObject[key];\n                else\n                    this.hashObject[key] = value;\n\n\t\t\t\t/* Set as changed */\n                changed = true;\n\n            });\n\n\t\t\t/* If any changes we rebuild hash */\n            if (changed || force)\n                this.setHash(decodeURIComponent(jQuery.param(this.hashObject).replace(/\\+/g, \" \")));\n\n\t\t\t/* Fire */\n            this.events.fire(\"set, always\", {elements: elements, hash: this.hashObject, path: this.pathString});\n\n        },\n\n\n        /**\n         * Sets hash letiable\n         * @param {object}    elements Fields to be set\n         * @param {boolean}    [force]     Replace all stored fields with elements object\n         */\n        search: function (elements, force) {\n\n            let changed = false;\n\n\t\t\t/* Force rewrite */\n            if (force)\n                this.searchObject = elements;\n\n\t\t\t/* Go through elements and add or change them */\n            $.each(elements, $.proxy(function (key, value) {\n\n\t\t\t\t/* If we need delete */\n                if (value === null)\n                    delete this.searchObject[key];\n                else\n                    this.searchObject[key] = value;\n\n\t\t\t\t/* Set as changed */\n                changed = true;\n\n            }, this));\n\n\t\t\t/* If any changes we rebuild hash */\n            if (changed || force)\n                this.setSearch(decodeURIComponent(jQuery.param(this.searchObject).replace(/\\+/g, \" \")));\n\n\t\t\t/* Fire */\n\t\t\tthis.events.fire(\"set, always\", {elements: elements, hash: this.hashObject, path: this.pathString});\n\n        },\n\n        /**\n         * Makes hash from object\n         * @param obj\n         * @returns {*|void|string|XML}\n         */\n        stringFromObject: function (obj) {\n            return jQuery.param(obj).replace(/\\+/g, \" \");\n        },\n\n        /**\n         * Get objects according to hash string\n         * @param {string} paramsString String which contains key=value pairs, would be parsed to object\n         */\n        getObjects: function (paramsString) {\n\n            let objects = {};\n\n\t\t\t/* Remove sharp */\n            if (paramsString.substr(0, 1) === '#' || paramsString.substr(0, 1) === '?')\n                paramsString = paramsString.slice(1, paramsString.length);\n\n\t\t\t/* Split parameters */\n            let subStrings = paramsString.split(\"&\");\n\n\t\t\t/* Get params */\n            $.each(subStrings, function (i, str) {\n\n                let keyAndValue = str.split(\"=\", 2);\n\n\t\t\t\t/* If no assign */\n                if (keyAndValue.length < 2)\n                    return;\n\n                let name = keyAndValue[0];\n\n\t\t\t\t/* Truncate brackets */\n                if (name.substr(-2) === \"[]\")\n                    name = name.substr(0, name.length - 2);\n\n\t\t\t\t/* Special hash for \"=\" in value  */\n                keyAndValue[1] = str.substr(keyAndValue[0].length + 1);\n\n\t\t\t\t/* If object repeats we create array */\n                if (typeof objects[name] === \"undefined\") objects[name] = keyAndValue[1];\n                else {\n                    if (!(objects[name] instanceof Array)) objects[name] = [objects[name]];\n                    objects[name].push(keyAndValue[1]);\n                }\n            });\n\n            return objects;\n\n        },\n\n        /**\n         * Finds difference between current stored hash and parameter\n         * @returns {*}\n         */\n        getDifference: function (string, stored) {\n\n\t\t\t/* Init */\n            let objects = this.getObjects(decodeURI(string));\n            return getObjectsDifference(stored, objects);\n\n        },\n\n        /**\n         * Rebuilds stored hash parameters according to current one\n         */\n        rebuild: function () {\n            this.hashString = this.getWindowHash();\n            this.hashObject = this.getObjects(this.hashString);\n            this.searchString = this.getWindowSearch();\n            this.searchObject = this.getObjects(this.searchString);\n            this.pathString = window.location.pathname;\n            return this;\n\n        },\n\n        /**\n         * Gets current window hash without \"#\"\n         * @returns {string}\n         */\n        getWindowHash: function () {\n\n\t\t\t/* Get decoded hash */\n            let hash = decodeURI(window.location.hash);\n\n\t\t\t/* Remove sharp */\n            if (hash.substr(0, 1) === '#')\n                hash = hash.slice(1);\n\n\t\t\t/* Return */\n            return hash;\n\n        },\n\n        /**\n         * Gets current window parameters without \"?\"\n         * @returns {string}\n         */\n        getWindowSearch: function () {\n\n\t\t\t/* Get decoded hash */\n            let search = decodeURI(window.location.search);\n\n\t\t\t/* Remove question */\n            if (search.substr(0, 1) === '?')\n                search = search.slice(1);\n\n\t\t\t/* Return */\n            return search;\n\n        },\n\n        /**\n         * Set interval execution\n         */\n        start: function () {\n\n            /* Set base if any */\n\t\t\tif (this.options.base)\n\t\t\t\tthis.base = this.options.base;\n\n\t\t\t/* If supported history */\n            if (window.history)\n                window.onpopstate = this.change.bind(this);\n\n            /* Timeout */\n            if (!this.intervalId)\n                this.intervalId = setInterval(this.change.bind(this), this.options.time || 500);\n\n\t\t\t/* Immediately event */\n            this.change();\n            return this;\n        }\n\n    });\n\n});","sky.service(\"localStorage\", [ \"callbacks\" ], function({ callbacks }) {\n\n\t//noinspection JSUnusedLocalSymbols\n\tlet LocalStorage = this.service = class {\n\t\tconstructor(options) {\n\t\t\tthis.name = options.name || \"global\";\n\t\t\tthis.events = callbacks();\n\t\t}\n\n\t\t/**\n\t\t * Loads item form database\n\t\t * @param {*} id Unique id\n\t\t */\n\t\tload(id) {\n\t\t\tlet items = this.getItems();\n\t\t\treturn items ? items[id] : undefined;\n\t\t}\n\n\t\tgetItems() {\n\t\t\ttry {\n\n\t\t\t\t/* Try to get item from storage */\n\t\t\t\tlet items = localStorage.getItem(this.name);\n\n\t\t\t\t/* Trigger error */\n\t\t\t\tif(items !== null)\n\t\t\t\t\treturn $.parseJSON(items);\n\n\t\t\t} catch(e) {\n\t\t\t\tthis.events.fire(\"error\", { storage: this });\n\t\t\t}\n\n\t\t\t/* Undefined on error */\n\t\t\treturn undefined;\n\n\t\t}\n\n\t\t/**\n\t\t * Save data to storage\n\t\t * @param id\n\t\t * @param data\n\t\t * @returns {*}\n\t\t */\n\t\tsave(id, data) {\n\n\t\t\ttry {\n\n\t\t\t\t/* Save */\n\t\t\t\tlet items = this.getItems() || {};\n\n\t\t\t\t/* Add item */\n\t\t\t\titems[id] = data;\n\n\t\t\t\t/* Save keys */\n\t\t\t\tlocalStorage.setItem(this.name, JSON.stringify(items));\n\n\t\t\t} catch(e) {\n\t\t\t\tthis.events.fire(\"error\", { storage: this });\n\t\t\t}\n\n\t\t\t/* Self return */\n\t\t\treturn this;\n\n\t\t}\n\n\t\t/**\n\t\t * Removes from storage\n\t\t * @param id\n\t\t * @returns {*}\n\t\t */\n\t\tremove(id) {\n\t\t\ttry {\n\n\t\t\t\t/* Save */\n\t\t\t\tlet items = this.getItems();\n\n\t\t\t\t/* Add item */\n\t\t\t\tdelete items[id];\n\n\t\t\t\t/* Save keys */\n\t\t\t\tlocalStorage.setItem(this.name, JSON.stringify(items));\n\n\t\t\t} catch(e) {\n\t\t\t\tthis.events.fire(\"error\", { storage: this });\n\t\t\t}\n\n\t\t\t/* Self return */\n\t\t\treturn this;\n\n\t\t}\n\t};\n\n});","sky.service(\"model\", [ \"modelsStorage\", \"callbacks\" ], function({ modelsStorage, callbacks }) {\n\n\t/**\n\t * List of model definitions\n\t */\n\tlet modelsDefinition = {};\n\n\tclass Model {\n\t\tconstructor(type, data) {\n\n\t\t\t/* Init as base */\n\t\t\tthis.definition = BaseDefinition;\n\n\t\t\t/* Get special if defined */\n\t\t\tif(modelsDefinition[type])\n\t\t\t\tthis.definition = modelsDefinition[type];\n\n\t\t\t/* Save id */\n\t\t\tthis.id = data[this.definition.id] || null;\n\t\t\tthis.type = type;\n\t\t\tthis.data = {};\n\t\t\tthis.callbacks = callbacks();\n\t\t\tthis.definition.creation.bind(this)($.extend({}, data, true));\n\n\t\t}\n\t\textend(data) {\n\t\t\tthis.definition.extension.bind(this)($.extend({}, data, true));\n\t\t\treturn this.changed();\n\t\t}\n\t\tchanged() {\n\t\t\tthis.callbacks.fire(\"change\", {model: this});\n\t\t\treturn this;\n\t\t}\n\t\tremoveFromStorage() {\n\t\t\tmodelsStorage.remove(this);\n\t\t}\n\t\taddListener(func) {\n\t\t\tthis.callbacks.on(\"change\", func);\n\t\t}\n\t\tremoveListener(func) {\n\t\t\tthis.callbacks.off(\"change\", func);\n\t\t}\n\t}\n\n\t/**\n\t * Base model definition witch would be parented\n\t */\n\tlet BaseDefinition = {\n\t\tid: \"id\",\n\t\tcreation: function(data) {\n\t\t\tthis.data = data;\n\t\t},\n\t\textension: function(data) {\n\t\t\t$.extend(true, this.data, data);\n\t\t}\n\t};\n\n\tthis.service = {\n\t\t/**\n\t\t * Adds new models definition\n\t\t * @param name\n\t\t * @param definition\n\t\t */\n\t\taddDefinition: function(name, definition) {\n\t\t\tmodelsDefinition[name] = $.extend({}, BaseDefinition, definition);\n\t\t},\n\n\t\tfromData: function(type, data) {\n\n\t\t\tlet model = new this.Model(type, data);\n\t\t\tlet cached = modelsStorage.add(model);\n\n\t\t\tif(cached)\n\t\t\t\treturn cached.extend(data);\n\n\t\t\treturn model;\n\n\t\t}\n\t};\n\n});","sky.service(\"modelsManager\", [\"callbacks\", \"model\"], function({callbacks, model}) {\n\tclass Manager {\n\t\tconstructor(type, arr) {\n\n\t\t\tthis.items = [];\n\t\t\tthis.type = type;\n\t\t\tthis.callbacks = callbacks();\n\n\t\t\t$.each(arr, (_, model) => {\n\t\t\t\tthis.items.push(model)\n\t\t\t});\n\t\t}\n\t\treloadFromArray(arr) {\n\t\t\tthis.items = [];\n\t\t\t$.each(arr, (_, data) => {\n\t\t\t\tthis.items.push(model.fromData(this.type, data))\n\t\t\t});\n\t\t}\n\t\tcount() {\n\t\t\treturn this.items.length;\n\t\t}\n\t\taddListener(func) {\n\t\t\tthis.callbacks.on(\"change\", func);\n\t\t}\n\t\tremoveListener(func) {\n\t\t\tthis.callbacks.off(\"change\", func);\n\t\t}\n\t}\n\n\tthis.service = {\n\t\tfromArray: function(type, arr) {\n\t\t\tlet items = [];\n\t\t\t$.each(arr, (_, data) => {\n\t\t\t\titems.push(sky.model.fromData(type, data));\n\t\t\t});\n\t\t\treturn new Manager(type, items);\n\t\t}\n\t};\n\n});","sky.service(\"modelsStorage\", function() {\n\n    let cache = {};\n\n    this.service = {\n\t\tadd: function(model) {\n\n\t\t\t// Search in cache\n\t\t\tlet cached = this.search(model.type, model.id);\n\n\t\t\t// If found extend\n\t\t\tif(cached)\n\t\t\t\treturn cached;\n\n            // Create type storage if none\n            if(!this.cache[model.type])\n                this.cache[model.type] = {};\n\n            // Save model\n            this.cache[model.type][model.id] = model;\n\n\t\t},\n\n\t\tsearch: function(type, id) {\n\n\t\t\t// Cache search\n\t\t\tif(cache[type] && cache[type][id])\n\t\t\t\treturn cache[type][id];\n\n\t\t\t// On miss\n\t\t\treturn false;\n\t\t},\n\n\t\tremove: function(model) {\n\t\t\tdelete cache[model.type][model.id];\n\t\t}\n\t}\n});","/**\n * For work with different type of notifications\n */\nsky.service(\"notifications\", [ \"stackList\", \"callbacks\", \"visibleCalculator\", \"templates\", \"windows\", \"tips\" ], function({ stackList, callbacks, visibleCalculator, templates, windows, tips }) {\n\n\tlet notification = function(options) {\n\t\t/* Self creation */\n\t\tif(!(this instanceof notification))\n\t\t\treturn new notification(options);\n\n\t\tthis.render = templates.render(\"forms-notification\", options);\n\t};\n\tlet message = function(options) {\n\n\t\t/* Self creation */\n\t\tif(!(this instanceof message))\n\t\t\treturn new message(options);\n\n\t\tthis.render = templates.render(\"forms-message\", options);\n\t};\n\n\tmessage.prototype = {\n\t\tmodal: function() {\n\t\t\treturn windows.Modal(this.render);\n\t\t},\n\n\t\t/**\n\t\t * Append to holder of modal window\n\t\t * @param {object} modal\n\t\t */\n\t\tappendToModal: function(modal) {\n\t\t\tmodal.holder.append(this.render);\n\t\t},\n\n\t\ttip: function(object, align) {\n\t\t\ttips.Tip(object, { create: this.render, close: 5 }).show(align || \"top\",);\n\t\t}\n\t};\n\n\tlet loadings = stackList();\n\n\t/**\n\t * Loading\n\t */\n\tlet loading = function(ajax, global = true) {\n\n\t\t/* Self creation */\n        if(!(this instanceof loading))\n            return new loading(ajax, global);\n\n\t\t/* Back link */\n\t\tthis.global = global;\n\n\t\t/* Render */\n\t\tthis.render = $('<div><div></div></div>').addClass(\"ajaxLoading\");\n\n\t\t/* Global insert */\n\t\tif(this.global)\n\t\t\tthis.render.addClass(\"fixed\").appendTo(\"body\");\n\n\t\t/* If stop possible */\n\t\tif(ajax) {\n\t\t\t$(\"<span/>\").appendTo(this.render.addClass(\"cancelable\")).click(function() { ajax.stop(); });\n\t\t\tajax.on(\"always\", () => { this.hide(); });\n\t\t}\n\n\t\t/* Callbacks */\n\t\tthis.callbacks = callbacks();\n\n\t\t/* List save */\n\t\tloadings.add(this);\n\n\t};\n\n\t/**\n\t * Prototype\n\t * @type {{render: null, hide: hide}}\n\t */\n\tloading.prototype = {\n\n\t\t/**\n\t\t * Loads loading in modal window\n\t\t * @param {object} modal Window\n\t\t */\n\t\tinModalWindow: function(modal) {\n\n\t\t\t/* Hide */\n\t\t\tlet content = modal.holder.children().hide();\n\n\t\t\t/* Insert */\n\t\t\tthis.render.appendTo(modal.holder);\n\n\t\t\t/* Restore on hide */\n\t\t\tthis.callbacks.on(\"hide\", () => content.show());\n\n\t\t},\n\n\t\t/**\n\t\t *\n\t\t * @param contentHolder\n\t\t */\n\t\treloadContent: function(contentHolder) {\n\n\t\t\t/* If no holder */\n\t\t\tif(!this.holder.length)\n\t\t\t\treturn;\n\n\t\t\t/* Safe */\n\t\t\tthis.holder = contentHolder = $(contentHolder).addClass(\"withLoading\");\n\n\t\t\t/* Get children */\n\t\t\tlet content = contentHolder.children();\n\n\t\t\t/* Different content disable */\n\t\t\tif(this.global) {\n\n\t\t\t\tcontent.disable();\n\n\t\t\t\t/* Make sizes calculator */\n\t\t\t\tthis.calc = visibleCalculator(contentHolder, this.render.outerHeight(), \"body\");\n\n\t\t\t\t/* Set position func */\n\t\t\t\tthis.setPosition = function() {\n\t\t\t\t\tlet position = this.calc.calculate();\n\t\t\t\t\tthis.render.css({\n\t\t\t\t\t\tleft: position.left + (position.width) / 2,\n\t\t\t\t\t\ttop: position.top + (position.height) / 2\n\t\t\t\t\t})\n\t\t\t\t};\n\t\t\t\tthis.setPosition();\n\n\t\t\t\t/* Re enable */\n\t\t\t\tthis.callbacks.on(\"hide\", () => {\n\t\t\t\t\tcontent.enable();\n\t\t\t\t\t$(window).off(\"scroll.notification\");\n\t\t\t\t});\n\n\t\t\t\t$(window).on(\"scroll.notification\", () => { this.setPosition();\t});\n\n\t\t\t} else {\n\n\t\t\t\t/*  Hide */\n\t\t\t\tcontent.hide();\n\n\t\t\t\t/* Insert */\n\t\t\t\tthis.render.appendTo(this.holder);\n\n\t\t\t\t/* Re enable */\n\t\t\t\tthis.callbacks.on(\"hide\", function() {\n\t\t\t\t\tcontent.show();\n\t\t\t\t});\n\t\t\t}\n\n\t\t\treturn this;\n\n\t\t},\n\n\t\tsetHolder: function(holder) {\n\n\t\t\t/* Append and save */\n\t\t\tthis.holder = $(holder).addClass(\"withLoading\").append(this.render);\n\n\t\t\t/* Self return */\n\t\t\treturn this;\n\n\t\t},\n\n\t\t/**\n\t\t * Hides current loading\n\t\t */\n\t\thide: function() {\n\n\t\t\tif(this.holder)\n\t\t\t\tthis.holder.removeClass(\"withLoading\");\n\n\t\t\tthis.render.remove();\n\t\t\tthis.callbacks.fire(\"hide\");\n\n\t\t\t/* Remove from list */\n\t\t\tloadings.remove(this);\n\n\t\t}\n\t};\n\n\treturn {\n\t\tloading: loading,\n\t\tmessage: message,\n\t\treCalculate: function() {\n\t\t\tloadings.each(function(instance) {\n\t\t\t\tinstance.calc.init();\n\t\t\t\tinstance.setPosition();\n\t\t\t})\n\t\t}\n\t}\n\n});","sky.service(\"pagination\", [\"templates\", \"stackList\"], function({ templates, stackList }) {\n\n\tlet list = stackList();\n\n\tclass Pagination {\n\t\tconstructor({ pages, holder, current = 1, }) {\n\n\t\t\t/* Self creation */\n\t\t\tif(!(this instanceof Pagination))\n\t\t\t\treturn new Pagination({ pages, holder, current });\n\n\t\t\t/* Save */\n\t\t\tlist.add(this);\n\n\t\t\t/* Set total pages */\n\t\t\tthis.pages \t\t= pages;\n\t\t\tthis.current \t= current;\n\t\t\tthis.pageWidth\t= 50;\n\t\t\tthis.id \t\t= last;\n\n\t\t\t/* No pages needed */\n\t\t\tif(this.pages < 2)\n\t\t\t\treturn this;\n\n\t\t\t/* Counted params */\n\t\t\tthis.dimensions = {\n\t\t\t\tstartPage      : 1,\n\t\t\t\tlastStartPage  : 0,\n\t\t\t\tpagesVisible   : 0,\n\t\t\t\tpagesInvisible : 0,\n\t\t\t\tscrollAvailable: 0,\n\t\t\t\tscrollStart\t   : 0,\n\t\t\t\ttumbler\t\t   : 10\n\t\t\t};\n\n\t\t\t/* Render */\n\t\t\tthis.dom = {};\n\t\t\tthis.dom.holder  = templates.render(\"pagination\", {}).data(\"pagination\", this);\n\t\t\tthis.dom.slider  = this.dom.holder.find(\".pages\");\n\t\t\tthis.dom.pages   = this.dom.slider.children();\n\t\t\tthis.dom.back \t = this.dom.holder.children(\".left\");\n\t\t\tthis.dom.forward = this.dom.holder.children(\".right\");\n\n\t\t\t/* Insert */\n\t\t\tif(holder)\n\t\t\t\tthis.dom.holder.appendTo(holder);\n\n\t\t\t/* If bigger than 10000 */\n\t\t\tif(this.pages > 9999) {\n\t\t\t\tthis.dom.slider.addClass(\"tenthousand\");\n\t\t\t\tthis.pageWidth = 80;\n\t\t\t}\n\t\t\t/* If bigger than 1000 */\n\t\t\telse if(this.pages > 999) {\n\t\t\t\tthis.dom.slider.addClass(\"thousand\");\n\t\t\t\tthis.pageWidth = 70;\n\t\t\t}\n\t\t\t/* If bigger 100 */\n\t\t\telse if(this.pages > 99 ) {\n\t\t\t\tthis.dom.slider.addClass(\"hundred\");\n\t\t\t\tthis.pageWidth = 60;\n\t\t\t}\n\n\t\t\t/* Make all */\n\t\t\tthis.redraw();\n\n\t\t\t/* Mark page */\n\t\t\tthis.goToPage(this.current);\n\n\t\t\t/* Self return */\n\t\t\treturn this;\n\n\t\t}\n\n\t\t/** */\n\t\tonPageChange(newPage) {}\n\n\t\t/** Removes navigator */\n\t\tremove() {\n\t\t\tthis.dom.holder.remove();\n\t\t\tlist.remove(this);\n\t\t}\n\n\t\t/**\n\t\t * Redraws pagination\n\t\t */\n\t\tredraw() {\n\n            /* No action on invisible */\n            if(!this.dom.holder.is(\":visible\"))\n                return;\n\n\t\t\t/* Reset width */\n\t\t\tthis.dom.slider.css(\"width\", \"auto\");\n\n\t\t\t/* Count visible sizes */\n\t\t\tthis.dimensions.pagesVisible = Math.floor((this.dom.holder.innerWidth() - 100) / this.pageWidth);\n\n\t\t\t/* Count invisible */\n\t\t\tthis.dimensions.pagesInvisible = (this.pages - this.dimensions.pagesVisible) > 0 ? this.pages - this.dimensions.pagesVisible : 0;\n\n\t\t\t/* Count last start */\n\t\t\tthis.dimensions.lastStartPage = this.dimensions.pagesInvisible + 1;\n\n\t\t\t/* Get max pages */\n\t\t\tlet toShow = this.dimensions.pagesVisible > this.pages ? this.pages : this.dimensions.pagesVisible;\n\n\t\t\t/* Crop */\n\t\t\tthis.dom.slider.css(\"width\", toShow * this.pageWidth);\n\n\t\t\t/* Redraw pages */\n\t\t\tthis.drawPages(this.dimensions.startPage);\n\n\t\t\t/* Try to create scroll */\n\t\t\tthis.createScroll();\n\n\t\t\t/* Set scroll position */\n\t\t\tif(this.dom.scrollLine)\n\t\t\t\tthis.dom.runner.css(\"left\", this.calculate().scroll);\n\n\t\t}\n\n\t\t/**\n\t\t * Create scroll line if needed\n\t\t */\n\t\tcreateScroll() {\n\n\t\t\t/* If no scroll needed */\n\t\t\tif(this.pages <= this.dimensions.pagesVisible) {\n\t\t\t\tif(this.dom.scrollLine) {\n\t\t\t\t\tthis.dom.scrollLine.remove();\n\t\t\t\t\tthis.dom.scrollLine = false;\n\t\t\t\t}\n\t\t\t\treturn;\n\t\t\t} else if(!this.dom.scrollLine) {\n\n\t\t\t\t/* Create scroll */\n\t\t\t\tthis.dom.scrollLine = templates.render(\"pagination-scroll\", {}).appendTo(this.dom.slider);\n\t\t\t\tthis.dom.runner = this.dom.scrollLine.children();\n\t\t\t}\n\n\t\t\t/* Count left */\n\t\t\tthis.dimensions.scrollStart = this.dom.scrollLine.position().left + 2;\n\n\t\t\t/* Count scroll line width */\n\t\t\tthis.dimensions.scrollAvailable = this.dom.scrollLine.outerWidth() - this.dom.scrollLine.children().outerWidth() - 4;\n\t\t\n\t\t}\n\n\t\t/**\n\t\t * Calculates related coordinates between scroll and move part\n\t\t */\n\t\tcalculate(position) {\n\n\t\t\t/* Get position */\n\t\t\tif(position === undefined)\n\t\t\t\tposition = this.dom.runner.offset().left  - this.dimensions.scrollStart;\n\n\t\t\t/* Remove start */\n\t\t\tposition = position - this.dimensions.scrollStart;\n\n\t\t\t/* Correct */\n\t\t\tposition = position > 0 ? position : 0;\n\n\t\t\t/* Count pages */\n\t\t\treturn {\n\t\t\t\tpages : Math.floor(this.dimensions.pagesInvisible * (position / this.dimensions.scrollAvailable)) + 1,\n\t\t\t\tscroll: Math.floor(this.dimensions.scrollAvailable * (this.dimensions.startPage - 1)/ this.dimensions.pagesInvisible + this.dimensions.scrollStart)\n\t\t\t}\n\n\t\t}\n\n\t\t/**\n\t\t * Draws pages according to start\n\t\t * @param {int} start Page to start from\n\t\t */\n\t\tdrawPages(start) {\n\n\t\t\t/* Remove old pages */\n\t\t\tthis.dom.pages.html(\"\");\n\n\t\t\t/* Correct */\n\t\t\tif(start > this.dimensions.pagesInvisible)\n\t\t\t\tstart = this.dimensions.pagesInvisible + 1;\n\n\t\t\t/* Correct */\n\t\t\tif(start < 1)\n\t\t\t\tstart = 1;\n\n\t\t\t/* Start position */\n\t\t\tlet i = start;\n\n\t\t\t/* Draw pages */\n\t\t\twhile(i <= this.pages && i < start + this.dimensions.pagesVisible) {\n\t\t\t\ttemplates.render(\"pagination-page\", { page: i, current: this.current }).appendTo(this.dom.pages);\n\t\t\t\ti++;\n\t\t\t}\n\n\t\t\t/* Reset start page */\n\t\t\tthis.dimensions.startPage = start;\n\n\n\t\t}\n\n\t\t/**\n\t\t * Sets page as active\n\t\t * @param {int} page Page number\n\t\t * @returns {Pagination}\n\t\t */\n\t\tgoToPage(page) {\n\n\t\t\t/* If no pages */\n\t\t\tif(this.pages < 2)\n\t\t\t\treturn this;\n\n\t\t\t/* Parse */\n\t\t\tpage = parseInt(page);\n\n\t\t\t/* Correct */\n\t\t\tif(page < 1)\n\t\t\t\tpage = 1;\n\t\t\telse if(page > this.pages)\n\t\t\t\tpage = this.pages;\n\n\t\t\t/* Checks if page is visible */\n\t\t\tlet isVisible = this.dimensions.startPage <= page && page < this.dimensions.startPage + this.dimensions.pagesVisible;\n\n\t\t\t/* Redraws if needed */\n\t\t\tif(!isVisible) {\n\t\t\t\tthis.drawPages(page);\n\t\t\t\tif(this.dom.scrollLine)\n\t\t\t\t\tthis.dom.runner.css(\"left\", this.calculate().scroll);\n\t\t\t}\n\n\t\t\t/* Make active */\n\t\t\tthis.dom.pages.children().removeClass(\"active\").filter(\"[page=\" + page +\"]\").addClass(\"active\");\n\n\t\t\t/* Forward buttons disable */\n\t\t\tif(page > 1) this.dom.back.enable();\n\t\t\telse this.dom.back.disable();\n\n\t\t\t/* Backward button disable */\n\t\t\tif(page === this.pages) this.dom.forward.disable();\n\t\t\telse this.dom.forward.enable();\n\n\t\t\t/* Callback */\n\t\t\tif(this.current !== page)\n\t\t\t\tthis.onPageChange(page);\n\n\t\t\t/* Save page state */\n\t\t\tthis.current = page;\n\n\t\t\t/* Self return */\n\t\t\treturn this;\n\n\t\t}\n\n\t\t/** Set scroll */\n\t\tscroll(event) {\n\n\t\t\tlet pos = event.pageX - 10;\n\t\t\tif(this.dimensions.scrollStart > pos)\n\t\t\t\tpos = this.dimensions.scrollStart;\n\t\t\tif(this.dimensions.scrollStart + this.dimensions.scrollAvailable < pos)\n\t\t\t\tpos = this.dimensions.scrollStart + this.dimensions.scrollAvailable;\n\n\t\t\tthis.dom.runner.css({left: pos});\n\t\t\tthis.drawPages(this.calculate(pos).pages);\n\n\t\t}\n\n\t}\n\n\t/* Bind windows events */\n\t$(window).on(\"resize\", function() {\n\t\tlist.each(() => { this.redraw(); });\n\t});\n\n\t/* Return */\n\tthis.service = {\n\t\tadd: function(options) {\n\t\t\treturn new Pagination(options);\n\t\t}\n\t}\n\n});","sky.service(\"stackList\", function() {\n\tlet List = this.service = function() {\n\n\t\tif(!(this instanceof List))\n\t\t\treturn new List();\n\n\t\tlet elements = {};\n\t\tlet lastId = 0;\n\t\tlet total = 0;\n\n\t\tthis.last = function() {\n\n\t\t\t/* Holder */\n\t\t\tlet last = false;\n\n\t\t\t/* Apply for windows */\n\t\t\tthis.each(element => { last = element });\n\n\t\t\t/* Return */\n\t\t\treturn last;\n\n\t\t};\n\n\t\tthis.add = function(element) {\n\t\t\tlastId++;\n\t\t\ttotal++;\n\t\t\telement[lastId] = element;\n\t\t};\n\n\t\tthis.remove = function(element) {\n\t\t\t/* Apply for windows */\n\t\t\tfor(let index in elements)\n\t\t\t\tif(elements.hasOwnProperty(index) && elements[index] === element) {\n\t\t\t\t\tdelete elements[index];\n\t\t\t\t\ttotal--;\n\t\t\t\t}\n\t\t};\n\n\t\tthis.total = function() {\n\t\t\treturn total;\n\t\t};\n\n\t\tthis.elements = function() {\n\t\t\treturn elements;\n\t\t};\n\n\t\tthis.each = function(callback) {\n\t\t\t$.each(elements, (_, single) => {\n\t\t\t\tcallback.apply(single, single);\n\t\t\t});\n\n\t\t};\n\n\t}\n});","sky.onReady(({suggester}) => {\n\t$(document).on(\"click\", function(event) {\n\n\t\t/* Get element */\n\t\tlet element = $(event.target || event.srcElement);\n\n\t\t/* If click in replace we should not hide it */\n\t\tif(element.is(\"[type=submit]\") || element.closest(\".suggester\").length || element.data(\"suggester\"))\n\t\t\treturn;\n\n\t\t/* Hide all */\n\t\tsuggester.hide();\n\n\t});\n});\n\nsky.service(\"suggester\", [\"templates\"], function({templates}) {\n\n\tlet render,\n\t\tobject,\n\t\tlastList,\n\t\tsuggester = this.service = {\n\t\t\thide: function() {\n\n\t\t\t\tif(render) {\n\t\t\t\t\trender.remove();\n\t\t\t\t\trender = false;\n\t\t\t\t}\n\t\t\t\tif(object) {\n\t\t\t\t\tobject.removeData(\"suggester\");\n\t\t\t\t\tobject = false;\n\t\t\t\t}\n\t\t\t\t$(document).off(\"keyup.suggester, keydown.suggester\");\n\t\t\t},\n\t\t\tshow: function(input, list) {\n\n\t\t\t\t/* Hide previous */\n\t\t\t\tsuggester.hide();\n\n\t\t\t\t/* Save */\n\t\t\t\tlastList = list;\n\t\t\t\trender = templates.render(\"suggester\", {items: list}).insertAfter(input.closest(\"label, .label\"));\n\t\t\t\tobject = input.data(\"suggester\", render);\n\n\t\t\t\t/* Get positions */\n\t\t\t\tlet elementPosition = input.offset(),\n\t\t\t\t\trenderPosition = render.offset();\n\n\t\t\t\t/* Show */\n\t\t\t\trender.css({\n\t\t\t\t\t\"margin-left\": elementPosition.left - renderPosition.left,\n\t\t\t\t\t\"margin-top\": elementPosition.top - renderPosition.top + input.outerHeight()\n\t\t\t\t});\n\n\t\t\t\t/* Add handlers */\n\t\t\t\tlet children = render.children().on(\"click\", function() {\n\t\t\t\t\tinput.val($(this).html());\n\t\t\t\t\tsuggester.hide();\n\t\t\t\t\tif(lastList[$(this).attr(\"data-index\")].callback)\n\t\t\t\t\t\tlastList[$(this).attr(\"data-index\")].callback();\n\t\t\t\t});\n\n\t\t\t\t$(document).on(\"keyup.suggester\", function(event) {\n\n\t\t\t\t\tif(event.keyCode === 38 || event.keyCode === 40) {\n\n\t\t\t\t\t\tlet selected = children.filter(\".selected\");\n\t\t\t\t\t\tchildren.removeClass(\"selected\");\n\n\t\t\t\t\t\t// Up\n\t\t\t\t\t\tif(event.keyCode === 38) {\n\t\t\t\t\t\t\tif(!selected.length || !selected.prev().length)\n\t\t\t\t\t\t\t\tchildren.last().addClass(\"selected\");\n\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t\tselected.prev().addClass(\"selected\");\n\t\t\t\t\t\t}\n\t\t\t\t\t\t// Down\n\t\t\t\t\t\tif(event.keyCode === 40) {\n\t\t\t\t\t\t\tchildren.removeClass(\"selected\");\n\t\t\t\t\t\t\tif(!selected.length || !selected.next().length) {\n\t\t\t\t\t\t\t\tchildren.first().addClass(\"selected\")\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tselected.next().addClass(\"selected\");\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\t// Esc\n\t\t\t\t\tif(event.keyCode === 27) suggester.hide();\n\n\n\t\t\t\t}).on(\"keydown.suggester\", function(event) {\n\n\t\t\t\t\t// Enter\n\t\t\t\t\tif(event.keyCode !== 13) return;\n\n\t\t\t\t\tlet selected = children.filter(\".selected\");\n\t\t\t\t\tif(selected.length) {\n\t\t\t\t\t\tselected.trigger(\"click\");\n\t\t\t\t\t\tevent.preventDefault();\n\t\t\t\t\t} else {\n\t\t\t\t\t\tsuggester.hide();\n\t\t\t\t\t}\n\n\t\t\t\t});\n\t\t\t}\n\t\t};\n});","/**\n * Module to work with user services\n */\nsky.service(\"supported\", function () {\n\ttry {\n\t\tthis.service.fullScreen = typeof document[\"webkitIsFullScreen\"] !== \"undefined\";\n\t\tthis.service.formData = window.FormData && true;\n\t\t// this.service.XHRIsSupported = XHRIsSupported;\n\t\tthis.service.XHRUpload = (typeof new XMLHttpRequest().upload !== \"undefined\");\n\t\tthis.service.localStorage = !!window.localStorage;\n\t} catch (e) {}\n});","sky.service(\"templates\", [\"localStorage\", \"supported\", \"directives\", \"exceptions\"], function({ localStorage, supported, directives, exceptions }) {\n\n\t\n\tlet templatesList = {},\n\t\ttemplatesCompiled = {},\n\t\tTemplates = this.service = {\n\n\t\t/** Globals list */\n\t\tglobals : {},\n\n\t\t/** Local storage support */\n\t\tstorage: supported.localStorage ? new localStorage({ name: \"jsTemplates\" }) : false,\n\n\t\t/**\n\t\t * Adds new template to list\n\t\t * @param options\n\t\t */\n\t\tadd: function(options) {\n\t\t\ttemplatesList[options.name] = options.template;\n\t\t\tif(this.storage) {\n\t\t\t\tthis.storage.save(options.name, options.template);\n\t\t\t\t$.cookie(\"storedTemplates-\" + options.name, options.date);\n\t\t\t}\n\t\t},\n\n\t\t/**\n\t\t * Renders specified template\n\t\t * @param {String} name Template name\n\t\t * @param {Object} data Inner data\n\t\t * @param {bool} [noDirectives]\n\t\t * @returns {*}\n\t\t */\n\t\trenderWithHolder: function(name, data, noDirectives) {\n\n\t\t\t/* Compile template */\n\t\t\tthis.compile(name);\n\n\t\t\t/* Add globals */\n\t\t\tdata = $.extend(true, {}, data, { globals: this.globals });\n\n\t\t\t/* Render */\n\t\t\tlet temp = $('<div/>').append(templatesCompiled[name].render(data));\n\n\t\t\t/* Parse directives */\n\t\t\tif(!noDirectives)\n\t\t\t\tdirectives.parse(temp);\n\n\t\t\t/* Return */\n\t\t\treturn temp;\n\n\t\t},\n\n\t\t/**\n\t\t * Renders specified template\n\t\t * @param {String} name Template name\n\t\t * @param {Object} data Inner data\n\t\t * @param {bool} [noDirectives]\n\t\t * @returns {*}\n\t\t */\n\t\trender: function(name, data, noDirectives) {\n\n\t\t\t/* Compile template */\n\t\t\treturn this.renderWithHolder(name, data, noDirectives).children();\n\n\t\t},\n\n\t\t/**\n\t\t * Renders specified template and returns text\n\t\t * @param {String} name Template name\n\t\t * @param {Object} data Inner data\n\t\t * @param {bool} [noDirectives]\n\t\t * @returns {*}\n\t\t */\n\t\trenderToText: function(name, data, noDirectives) {\n\n\t\t\t/* Compile template */\n\t\t\treturn this.renderWithHolder(name, data, noDirectives).html();\n\n\t\t},\n\n\t\t/**\n\t\t * Renders template by its text as parameter\n\t\t * @param {string} text Template text\n\t\t * @param {Object} data Inner data\n\t\t * @param {bool} [noDirectives]\n\t\t * @returns {XMLList|*}\n\t\t */\n\t\trenderByText: function(text, data, noDirectives) {\n\n\t\t\t/* Add globals */\n\t\t\tdata = jQuery.extend(true, data, { globals: this.globals });\n\n\t\t\t/* Render */\n\t\t\tlet temp = $('<div/>').append(twig({ data: text }).render(data));\n\n\t\t\t/* Parse directives */\n\t\t\tif(!noDirectives)\n\t\t\t\tdirectives.parse(temp);\n\n\t\t\t/* Return */\n\t\t\treturn temp.children();\n\n\t\t},\n\n\t\t/**\n\t\t * Renders template by its text as parameter\n\t\t * @param {string} text Template text\n\t\t * @param {Object} data Inner data\n\t\t * @param noDirectives\n\t\t * @returns {XMLList|*}\n\t\t */\n\t\trenderByTextToText: function(text, data, noDirectives)  {\n\t\t\treturn $('<div/>').append(this.renderByText(text, data, noDirectives)).html();\n\t\t},\n\n\t\t/**\n\t\t * Compiles specified template\n\t\t * @param {string} name Template name\n\t\t */\n\t\tcompile: function(name) {\n\n\t\t\t/* If already compiled */\n\t\t\tif(templatesCompiled[name])\n\t\t\t\treturn;\n\n\t\t\t/* Load */\n\t\t\tthis.load(name);\n\n\t\t\t/* Compile */\n\t\t\tlet compiled = twig({ id: name, data: templatesList[name] });\n\n\t\t\t/* Check */\n\t\t\tif(!compiled)\n\t\t\t\tthrow new exceptions.system.Error('Error during compiling template \"' + name + '\"');\n\n\t\t\t/* Save */\n\t\t\ttemplatesCompiled[name] = compiled;\n\n\t\t},\n\n\t\t/**\n\t\t * Loads specified template\n\t\t * @param {string} name Template name\n\t\t */\n\t\tload: function(name) {\n\n\t\t\t/* Loaded */\n\t\t\tlet fromLS;\n\n\t\t\t/* Try to load from storage */\n\t\t\tif(!templatesList[name] && this.storage && (fromLS = this.storage.load(name)))\n\t\t\t\treturn templatesList[name] = fromLS;\n\n\t\t\t/* If already compiled */\n\t\t\tif(templatesList[name])\n\t\t\t\treturn templatesList[name];\n\n\t\t\t/* Load template */\n\t\t\tif(!(templatesList[name] = $('script[type=\"text/template\"][id='+ name +']').html()))\n\t\t\t\tthrow new exceptions.system.Error(\"Can't find template – \"  + name);\n\n\t\t\t/* Save to LS */\n\t\t\tif(this.storage)\n\t\t\t\tthis.storage.save(name, { template: templatesList[name] });\n\n\t\t\t/* Return */\n\t\t\treturn templatesList[name]\n\n\t\t}\n\n\t};\n\n\tsky.directive('script[type=\"text/template\"], template', function(template, attrs) {\n\t\tTemplates.add({\n\t\t\tname        : attrs.id,\n\t\t\ttemplate    : template.html()\n\t\t});\n\t});\n\n\n\t/* Save templates files data */\n\tsky.onReady(() => {\n\t\tif(window.page.data.templates && supported.localStorage) {\n\t\t\t$.each(window.page.data.templates, function(_, template) {\n\t\t\t\t$.cookie(\"storedTemplates-\" + template.path, template.date);\n\t\t\t});\n\t\t}\n\t});\n\n});\n","sky.service(\"tips\", [\"stackList\", \"callbacks\"], function({ stackList, callbacks }) {\n\n    /** Class to work with tips */\n    let list = stackList(),\n        tips = this.service = {\n\n        /**\n         * Hides all visible tips\n         * @param withoutAutoHide\n         */\n        hideAll: function(withoutAutoHide) {\n\n            /* Hide all tips */\n            $.each(list.elements(), function(_, tip) {\n                if(withoutAutoHide || tip.autoHide)\n                    this.hide();\n            });\n\n        },\n\n        /**\n         * Returns last open window if any\n         * @returns {tips.Tip|boolean}\n         */\n        getLast: function() {\n            list.last();\n        },\n\n        /**\n         * Add show/hide functions\n         * @param {string}            selector            Object to bind tips for\n         * @param {string}            align                Align of tip\n         * @param options\n         * @see tips.tip\n         */\n        bind: function(selector, align, options) {\n\n            /* Create binds */\n            $(selector).on({\n                \"mouseenter\": function() {\n                    let tip = $(this).data(\"tip\") || tips.Tip(this, options).show(align);\n                },\n                \"mouseleave\": function() {\n                    let tip = $(this).data(\"tip\");\n                    if(tip) tip.hide(align);\n                }\n            });\n\n        },\n\n        /**\n         * Creates new tip object\n         * @param {object}            object                Object to show tip for\n         * @param autoHide\n         * @param create\n         * @param close\n         * @param ajax\n         * @param highlight\n         * @constructor\n         */\n        Tip: function(object, { autoHide = true, create = false, close = false, ajax = false, highlight = false } = {}) {\n\n            /* Auto construct */\n            if(!(this instanceof tips.Tip))\n                return new tips.Tip(object, { autoHide, create, close, ajax, highlight });\n\n            /* Manual create tip by create function */\n            if(typeof create === \"function\") {\n\n                /* Create tip */\n                this.tip = create(object);\n\n                /* If no tip */\n                if(!this.tip) return this;\n\n            }\n\n            /* Object set */\n            this.object = $(object).data(\"tip\", this);\n\n            /* Save callbacks */\n            this.callbacks = callbacks();\n\n            /* Auto hide */\n            this.autoHide = autoHide;\n\n            /* Manual create tip by create function */\n            if(typeof create !== \"function\") {\n\n                /* Create tip */\n                this.tip = $(\"<div/>\").addClass(\"tip\").append('<div class=\"tipContent\"></div>').insertBefore(object);\n\n                /* Title using */\n                if(!create && this.object.attr('title'))\n\t\t\t\t\tcreate = this.object.attr('title');\n                else if(!create)\n\t\t\t\t\tcreate = \"Пожалуйста подождите\";\n\n                this.tip.find(\".tipContent\").append(create);\n\n            }\n\n            if(highlight)\n                this.shadow = $('<div/>').css({ opacity: 0, position:\"absolute\", width: \"100%\", height: \"100%\", left:0 ,top:0, background: \"rgba(0,0,0,0.5)\" }).appendTo(\"body\");\n\n            /* If count down */\n            if(typeof close === \"number\")\n                this.closeTimeout = setTimeout(() => this.hide(), close);\n\n            /* If close button */\n            else if(close)\n                $('<div/>').addClass('close').appendTo(this.tip).on(\"click\", () => this.hide());\n\n            /* If stop possible */\n            if(ajax)  ajax.on(\"always\", () => this.hide());\n\n            /* Add to list */\n            this.tip.css(\"display\", \"none\");\n\t\t\tlist.add(this);\n            return this;\n\n        }\n\n    };\n\n    /**\n     * Extends tip\n     */\n    $.extend(tips.Tip.prototype, /** @lends tips.tip */ {\n\n        /**\n         * Shows tip according to type\n         * @param {string} [align] Way it would be shown\n         */\n        show: function(align) {\n\n            /* Back link */\n            let self   = this;\n            let offset = this.tip.css({left: \"\", top: \"\", marginLeft: \"\", marginTop: \"\", display: \"\"}).offset();\n\n            /* Stop animation and shows */\n            this.tip.stop();\n\n            /* Save way to show */\n            if(align) this.align = align;\n\n            /* If shadow */\n            if(this.shadow)\n                this.shadow.stop().show().animate({opacity: 1}, 100);\n\n            /* Different actions according to tip position */\n            switch(this.align) {\n\n                /* If show righter than input */\n                case \"right\":\n                {\n                    this.tip.addClass(\"right\").css({\n                        marginLeft: this.object.offset().left + this.object.outerWidth() - offset.left,\n                        marginTop : this.object.offset().top - offset.top + parseInt((this.object.outerHeight() - this.tip.outerHeight()) / 2),\n                        opacity   : 0\n                    });\n                    this.tip.animate({opacity: 1, marginLeft: \"+=10\"}, 100);\n                    break;\n                }\n                /* If show righter than input */\n                case \"left\":\n                {\n                    this.tip.addClass(\"left\").css({\n                        marginLeft: this.object.offset().left - offset.left - this.tip.outerWidth(),\n                        marginTop : this.object.offset().top - offset.top + parseInt((this.object.outerHeight() - this.tip.outerHeight()) / 2),\n                        opacity   : 0\n                    });\n                    this.tip.animate({opacity: 1, marginLeft: \"-=10\"}, 300);\n                    break;\n                }\n                /* If show topper */\n                case \"top\":\n                {\n\n                    // Count left offset\n                    let left = this.object.offset().left - offset.left;\n\n                    /* Reposition */\n                    if(offset.left + left + this.tip.outerWidth() > $(window).outerWidth())\n                        left = left - this.tip.outerWidth() + this.object.outerWidth();\n\n                    /* Position */\n                    this.tip.addClass(\"top\").css({\n                        marginLeft: left,\n                        marginTop : this.object.offset().top - this.tip.outerHeight() - offset.top,\n                        opacity   : 0\n                    });\n\n                    this.tip.animate({opacity: 1, marginTop: \"-=10\"}, 300);\n                    break;\n                }\n                /* If show topper */\n                case \"bottom\":\n                {\n\n                    let left = this.object.offset().left - offset.left;\n\n                    /* Reposition */\n                    if(offset.left + left + this.tip.outerWidth() > $(window).outerWidth())\n                        left = left - this.tip.outerWidth() + this.object.outerWidth();\n\n                    /* Position */\n                    this.tip.addClass(\"bottom\").css({\n                        marginLeft: left,\n                        marginTop : this.object.offset().top + this.object.outerHeight() - offset.top,\n                        opacity   : 0\n                    });\n\n                    this.tip.animate({opacity: 1, marginTop: \"+=10\"}, 300);\n                    break;\n                }\n                /* If we replace input with tip */\n                case \"instead\":\n                {\n                    this.tip.css({\n                        width  : this.object.outerWidth(),\n                        height : this.object.outerHeight(),\n                        display: \"none\"\n                    });\n                    this.object.fadeOut(100, function() {\n                        self.tip.fadeIn(100);\n                    }).get(0).blur();\n                    break;\n                }\n                case \"inside\":\n                {\n                    this.tip.css({\n                        width  : this.object.outerWidth(),\n                        height : this.object.outerHeight(),\n                        display: \"none\"\n                    });\n                    this.tip.css(\"opacity\", 0).animate({opacity: 1}, 100);\n                    break;\n                }\n                default:\n                    break;\n            }\n\n            this.tip.css({left: \"\", top: \"\"});\n\n            /* Self return */\n            return this;\n\n        },\n\n        /**\n         * Hides current tip\n         */\n        hide: function() {\n\n            /* Remove count down if needed */\n            if(this.closeTimeout)\n                clearTimeout(this.closeTimeout);\n\n            /* Stop animation */\n            this.tip.stop();\n\n            /* Get know how tip was shown */\n            let align = this.align;\n\n            /* Create end animation callback */\n            let callback = () => {\n\n                /* Delete record from global list */\n                list.remove(this);\n\n                /* Remove data */\n                this.object.removeData(\"tip\");\n\n                /* Remove tip */\n                this.tip.remove();\n\n                /* Callback */\n                this.callbacks.fire(\"hide\", this);\n\n            };\n\n            /* If just shown */\n            if(!align)\n                callback();\n\n            /* If shadow */\n            if(this.shadow)\n                this.shadow.animate({opacity: 0}, 100, () => { this.shadow.remove() });\n\n            /* Right way hide */\n            if(align === \"right\")\n                this.tip.animate({opacity: 0, marginLeft: \"+=10\"}, 100, callback);\n\n            /* Left way hide */\n            if(align === \"left\")\n                this.tip.animate({opacity: 0, marginLeft: \"-=10\"}, 100, callback);\n\n            /* Instead way hide */\n            if(align === \"instead\")\n                this.tip.fadeOut({opacity: 0}, 200, callback);\n\n            /* Top way hide */\n            if(align === \"top\")\n                this.tip.animate({opacity: 0, marginTop: \"-=5\"}, 200, callback);\n\n            /* Bottom way hide */\n            if(align === \"bottom\")\n                this.tip.animate({opacity: 0, marginTop: \"+=5\"}, 200, callback);\n\n            /* Inside way hide */\n            if(align === \"inside\")\n                this.tip.animate({opacity: 0}, 200, callback);\n\n            /* Self return */\n            return this;\n\n        },\n\n        /**\n         * Gets tips dom\n         * @returns {*}\n         */\n        get: function() {\n            return this.tip;\n        },\n\n        /**\n         * Sets tip text\n         * @param {string|jQuery} text What to insert to tip body\n         */\n        set: function(text) {\n            this.tip.children(\".tipContent\").html(text);\n            return this;\n        },\n\n        /**\n         * Adds something to tip\n         * @param {string|jQuery} what What to append to tip body\n         */\n        add: function(what) {\n            this.tip.children(\".tipContent\").append(what);\n            return this;\n        }\n\n    });\n\n});","sky.service(\"utils\", function() {\n\tthis.service = {\n\n\t\t/**\n\t\t * Checks if object has same data\n\t\t * @param first\n\t\t * @param second\n\t\t */\n\t\tisObjectsEqual: function(first, second) {\n\n\t\t\t/* Different types */\n\t\t\tif(typeof first !== typeof second)\n\t\t\t\treturn false;\n\n\t\t\t/* If object or array we will compare each element */\n\t\t\tif(first instanceof Array || first instanceof Object) {\n\t\t\t\tlet key;\n\t\t\t\t/* Check first */\n\t\t\t\tfor(key in first) {\n\t\t\t\t\tif(!first.hasOwnProperty(key)) continue;\n\t\t\t\t\tif(typeof second[key] === \"undefined\") return false;\n\t\t\t\t\telse if(!this.isObjectsEqual(first[key], second[key])) return false;\n\t\t\t\t}\n\n\t\t\t\t/* Check second */\n\t\t\t\tfor(key in second) {\n\t\t\t\t\tif(!second.hasOwnProperty(key)) continue;\n\t\t\t\t\tif(typeof first[key] === \"undefined\") return false;\n\t\t\t\t}\n\n\t\t\t} else if(first !== second) return false;    // For simple types\n\n\t\t\t/* All tests success */\n\t\t\treturn true;\n\n\t\t},\n\n\t\t/**\n\t\t * Adds zero\n\t\t * @param value\n\t\t * @returns {Number}\n\t\t */\n\t\taddLeadingZero: function(value) {\n\n\t\t\t/* Parse */\n\t\t\tvalue = parseInt(value);\n\n\t\t\t/* Ad zero */\n\t\t\tif(value < 10)\n\t\t\t\tvalue = \"0\" + value;\n\n\t\t\t/* Val */\n\t\t\treturn value;\n\n\t\t},\n\n\t\tencode: function(rawStr) {\n\t\t\treturn rawStr.replace(/[\\u00A0-\\u9999<>&]/gim, function(i) {\n\t\t\t\treturn '&#' + i.charCodeAt(0) + ';';\n\t\t\t});\n\t\t},\n\n\t\t/**\n\t\t * Makes data to JSON past\n\t\t * @param data\n\t\t * @param [inputName]\n\t\t * @returns {string}\n\t\t */\n\t\tjsonData: function(data, inputName) {\n\t\t\treturn '<script type=\"application/json\"' + (inputName ? (' input-name=\"' + inputName + '\"') : \"\") + '>' + sky.encode(JSON.stringify(data)) + '</script>';\n\t\t},\n\n\t\tprepareSelectData: function(items, func, {columnSplitOn = 6, maxColumns = 4}) {\n\n\t\t\tlet index        = 0,\n\t\t\t\tcolumns      = [],\n\t\t\t\tcolumnsCount = items.length / columnSplitOn,\n\t\t\t\tgroupHolder,\n\t\t\t\tcompiled;\n\n\t\t\tif(columnsCount < 1)\n\t\t\t\tcolumnsCount = 1;\n\t\t\tif(columnsCount > maxColumns)\n\t\t\t\tcolumnsCount = maxColumns;\n\n\t\t\tlet perColumn = Math.ceil(items.length / columnsCount);\n\n\t\t\tfor(let item of items) {\n\t\t\t\tif(compiled = func({item, index, column: columns.length})) {\n\n\t\t\t\t\tif(index % perColumn === 0) {\n\t\t\t\t\t\tgroupHolder = [];\n\t\t\t\t\t\tcolumns.push(groupHolder);\n\t\t\t\t\t}\n\n\t\t\t\t\tgroupHolder.push(compiled);\n\t\t\t\t\tindex++;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn index === 0 ? [] : {groups: columns}\n\n\t\t}\n\t}\n});","sky.onReady(function({ validator }) {\n\tjQuery.fn.validForm = function() {\n\t\treturn validator.validateForm(this);\n\t}.safe();\n\tjQuery.fn.validationRule = function(name, options) {\n\t\treturn validator.addRule(this, name, options);\n\t}.safe();\n\t$(document).on(\"change keyup\", \"[data-validate]\", function() {\n\t\tvalidator.validateElement($(this));\n\t});\n});\n\nsky.service(\"validator\", function() {\n\n\t/**\n\t * Main validation object\n\t */\n\tlet validator = this.service = {\n\n\t\t/**\n\t\t * Validates specified form, or dom element\n\t\t * @param form\n\t\t */\n\t\tvalidateForm: function(form) {\n\n\t\t\tlet pass = true,\n\t\t\t\tself = this;\n\n\t\t\t/* Go through all elements that need to be validate */\n\t\t\tform.find(\"input, select, textarea, .selectReplace, [data-validate]\").filter(\":visible\").each(function() {\n\n\t\t\t\t/* Get element */\n\t\t\t\tlet element = $(this);\n\n\t\t\t\t/* validate if needed to */\n\t\t\t\tif(self.shouldBeValidated(element) && !self.validateElement(element, form))\n\t\t\t\t\tpass = false;\n\n\t\t\t});\n\n\t\t\t/* Return result */\n\t\t\treturn pass;\n\n\t\t},\n\n\t\t/**\n\t\t * Add rule to specified element\n\t\t * @param element\n\t\t * @param name\n\t\t * @param [options]\n\t\t */\n\t\taddRule: function(element, name, options) {\n\n\t\t\t/* Get or make options and add rule */\n\t\t\tthis.Options(element).addRule(name, options || {});\n\n\t\t\t/* Self return */\n\t\t\treturn this;\n\n\t\t},\n\n\t\t/**\n\t\t *\n\t\t * Validates specified element\n\t\t * @param {*} element Element to validate\n\t\t * @param {*} [form] Form to validate\n\t\t * @returns {boolean}\n\t\t */\n\t\tvalidateElement: function(element, form) {\n\n\t\t\tlet self = this,\n\t\t\t\toptions = this.Options(element),\n\t\t\t\ttotalPass = true,\n\t\t\t\tvalue = element.val(),\n\t\t\t\tlastError = false,\n\t\t\t\tfirstError = false,\n\t\t\t\tlastSuccess = false,\n\t\t\t\tfirstSuccess = false;\n\n\t\t\t/* Select replace */\n\t\t\tif(element.is(\".selectReplace\")) {\n\t\t\t\tlet inputs = element.next().find(\"input:checked\");\n\t\t\t\tif(!inputs.length)\n\t\t\t\t\tvalue = \"\";\n\t\t\t\telse if(element.is(\".single\"))\n\t\t\t\t\tvalue = element.next().find(\"input:checked\").val();\n\t\t\t\telse\n\t\t\t\t\tvalue = element.next().find(\"input:checked\").length ? \"true\" : \"\";\n\t\t\t}\n\n\t\t\t/* Go through rules */\n\t\t\t$.each(options.rules, function(name, ruleOverload) {\n\n\t\t\t\t/* Make compiled rule */\n\t\t\t\tlet compiledRule = jQuery.extend(true, {}, self.rules[name] || self.Rule({}), ruleOverload || {});\n\n\t\t\t\t/* Execute message is needed */\n\t\t\t\tif(typeof compiledRule.message === \"function\")\n\t\t\t\t\tcompiledRule.message = compiledRule.message.call(this);\n\n\t\t\t\t/* Check if element pass validation */\n\t\t\t\tlet pass = self.validate(value, compiledRule, element, form);\n\n\t\t\t\t/* Perform action according to result */\n\t\t\t\tif(pass) {\n\t\t\t\t\tcompiledRule.onSuccess(element, compiledRule);\n\t\t\t\t\tlastSuccess = compiledRule;\n\t\t\t\t\tif(!firstSuccess)\n\t\t\t\t\t\tfirstSuccess = compiledRule;\n\t\t\t\t} else {\n\t\t\t\t\tcompiledRule.onError(element, compiledRule);\n\t\t\t\t\tlastError = compiledRule;\n\t\t\t\t\tif(!firstError)\n\t\t\t\t\t\tfirstError = compiledRule;\n\t\t\t\t\ttotalPass = false;\n\t\t\t\t}\n\n\t\t\t});\n\n\t\t\t/* Total callbacks */\n\t\t\tif(totalPass)\n\t\t\t\toptions.onSuccess(element, lastSuccess);\n\t\t\telse\n\t\t\t\toptions.onError(element, firstError);\n\n\t\t\t/* Return true of element passed all validations */\n\t\t\treturn totalPass;\n\n\t\t},\n\n\t\t/**\n\t\t * Return true if element should be validated\n\t\t * @param {*} element Element to validate\n\t\t * @returns {boolean}\n\t\t */\n\t\tshouldBeValidated: function(element) {\n\t\t\treturn element.attr(\"data-validate\") || element.data(\"validationOptions\");\n\t\t},\n\n\t\t/**\n\t\t * Return true if element passed validation\n\t\t * @param element\n\t\t * @param compiledRule\n\t\t * @param form\n\t\t * @returns {*}\n\t\t * @param value\n\t\t */\n\t\tvalidate: function(value, compiledRule, element, form) {\n\t\t\treturn compiledRule.rule.call(compiledRule, value, element, form);\n\t\t}\n\n\t};\n\n\t/**\n\t * Defaults\n\t */\n\tvalidator.ruleDefaults = {\n\n\t};\n\n\t/**\n\t * Defaults\n\t * @type {{onSuccess: onSuccess, onError: onError}}\n\t */\n\tvalidator.optionsDefaults = {\n\n\t\t/* Fires on success */\n\t\tonSuccess: function(element) {\n\n\t\t\t/* Remove error */\n\t\t\telement.removeClass(this.errorClass);\n\n\t\t\t/* Add success */\n\t\t\tif(this.successClass)\n\t\t\t\telement.addClass(this.successClass);\n\n\t\t},\n\n\t\t/* Fires on error */\n\t\tonError: function(element) {\n\n\t\t\t/* Add error */\n\t\t\telement.addClass(this.errorClass);\n\n\t\t\t/* Remove success */\n\t\t\tif(this.successClass)\n\t\t\t\telement.removeClass(this.successClass);\n\n\t\t}\n\t};\n\n\t/**\n\t * Base rule object\n\t * @param overload\n\t * @returns {validator.Rule}\n\t * @constructor\n\t */\n\tvalidator.Rule = function(overload) {\n\n\t\t/* Self creation if needed */\n\t\tif(!(this instanceof validator.Rule))\n\t\t\treturn new validator.Rule(overload);\n\n\t\t/* Dump rule to check validation */\n\t\tthis.rule = function() { return true; };\n\n\t\t/* Dump message */\n\t\tthis.message = \"Это поле заполнено не верно\";\n\n\t\t/* List of options to make validation according to */\n\t\tthis.options = [];\n\n\t\t/* Fires on success */\n\t\tthis.onSuccess = function(element) {};\n\n\t\t/* Fires on error */\n\t\tthis.onError = function(element) {};\n\n\t\t/* Self extend with overload */\n\t\tjQuery.extend(this, overload);\n\n\t\t/* Return */\n\t\treturn this;\n\n\t};\n\n\t/**\n\t * List of default rules\n\t * @type {{required: validator.Rule}}\n\t */\n\tvalidator.rules = {\n\t\trequired: validator.Rule({\n\t\t\trule: function(value) {\n\t\t\t\treturn !!value.length;\n\t\t\t},\n\t\t\tmessage: \"Это поле необходимо заполнить\"\n\t\t}),\n\t\trequiredIfFilled: validator.Rule({\n\t\t\trule: function(value) {\n\t\t\t\tlet item = $(this.options[0]);\n\t\t\t\treturn item.is(\":radio, :checkbox\") ? !item.is(\":checked\") || value : item.val() === \"\" || value;\n\t\t\t},\n\t\t\tmessage: \"Это поле необходимо заполнить\"\n\t\t}),\n\t\tdate: validator.Rule({\n\t\t\trule: function(value) {\n\t\t\t\treturn !value || (\n\t\t\t\t\tvalue.match(/^\\d{4}-\\d{2}-\\d{2}( \\d{2}:\\d{2}(:\\d{2})?)?$/) ||\n\t\t\t\t\tvalue.match(/^\\d{2}.\\d{2}.\\d{4}( \\d{2}:\\d{2}(:\\d{2})?)?$/)\n\t\t\t\t\t);\n\t\t\t},\n\t\t\tmessage: \"Дата указана неверно\"\n\t\t}),\n\t\tperiod: validator.Rule({\n\t\t\trule: function(value) {\n\t\t\t\treturn !value || (\n\t\t\t\t\tvalue.match(/^\\d{4}-\\d{2}-\\d{2}$/) ||\n\t\t\t\t\tvalue.match(/^\\d{2}.\\d{2}.\\d{4}$/) ||\n\t\t\t\t\tvalue.match(/^\\d{2}.\\d{2}.\\d{4}\\s*-\\s*\\d{2}.\\d{2}.\\d{4}$/) ||\n\t\t\t\t\tvalue.match(/^\\d{4}-\\d{2}-\\d{2}\\s*-\\s*\\d{4}-\\d{2}-\\d{2}$/)\n\t\t\t\t\t);\n\t\t\t},\n\t\t\tmessage: \"Период указан неверно\"\n\t\t}),\n\t\temail: validator.Rule({\n\t\t\trule: function(value) {\n\t\t\t\treturn value && value.match(/[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*@(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?/);\n\t\t\t},\n\t\t\tmessage: \"Почтовый адрес указан неверно\"\n\t\t}),\n\t\tsame: validator.Rule({\n\t\t\trule: function(value) {\n\t\t\t\treturn value === $('[name=\"' + this.options[0] + '\"]').val();\n\t\t\t},\n\t\t\tmessage: \"Поля не совпадают\"\n\t\t}),\n\t\turl: validator.Rule({\n\t\t\trule: function(value) {\n\t\t\t\treturn value === \"\" || value.match(/^(https?:\\/\\/.+)$/);\n\t\t\t},\n\t\t\tmessage: \"Не корректный адрес URI\"\n\t\t}),\n\t\tregexp: validator.Rule({\n\t\t\trule: function(value) {\n\t\t\t\treturn value === \"\" || value.match(new RegExp(this.options[0]));\n\t\t\t},\n\t\t\tmessage: \"Введите корректное значение\"\n\t\t}),\n\t\tnumeric: validator.Rule({\n\t\t\trule: function(value) {\n\t\t\t\treturn value === \"\" || value.match(/^-?[0-9]+(\\.[0-9]+)?$/);\n\t\t\t},\n\t\t\tmessage: \"Введите число\"\n\t\t}),\n\t\tpositive: validator.Rule({\n\t\t\trule: function(value) {\n\t\t\t\treturn value === \"\" || value.match(/^[0-9]+(\\.[0-9]+)?$/) && parseFloat(value) > 0;\n\t\t\t},\n\t\t\tmessage: \"Введите положительное число\"\n\t\t}),\n\t\tmax: validator.Rule({\n\t\t\trule: function(value) {\n\t\t\t\treturn value === \"\" || value.match(/^[0-9]+(\\.[0-9]+)?$/) && parseFloat(value) <= parseFloat(this.options[0] || 0);\n\t\t\t},\n\t\t\tmessage: function() {\n\t\t\t\treturn \"Введите число, не обльше чем \" + (this.options[0] || 0)\n\t\t\t}\n\t\t}),\n\t\tmin: validator.Rule({\n\t\t\trule: function(value) {\n\t\t\t\treturn value === \"\" || value.match(/^[0-9]+(\\.[0-9]+)?$/) && parseFloat(value) >= parseFloat(this.options[0] || 0);\n\t\t\t},\n\t\t\tmessage: function() {\n\t\t\t\treturn \"Введите число, не меньше чем \" + (this.options[0] || 0);\n\t\t\t}\n\t\t}),\n\t\tminLength: validator.Rule({\n\t\t\trule: function(value) {\n\t\t\t\treturn value === \"\" || value.length >= (this.options[0] || 0)\n\t\t\t},\n\t\t\tmessage: \"В этом поле нехватает символов\"\n\t\t}),\n\t\tmaxLength: validator.Rule({\n\t\t\trule: function(value) {\n\t\t\t\treturn value === \"\" || value.length <= (this.options[0] || 0)\n\t\t\t},\n\t\t\tmessage: \"В этом поле слишком много символов\"\n\t\t})\n\t};\n\n\t/**\n\t * Holds element validation options\n\t * @param element\n\t * @constructor\n\t */\n\tvalidator.Options = function(element) {\n\n\t\t/* Create or return */\n\t\tif(!(this instanceof validator.Options))\n\t\t\treturn element.data(\"validationOptions\") || new validator.Options(element);\n\n\t\t/* Callbacks after all checks */\n\t\tthis.onSuccess = function() {};\n\t\tthis.onError = function() {};\n\n\t\t/* Adds to element on success */\n\t\tthis.successClass = false;\n\n\t\t/* Adds to element on error */\n\t\tthis.errorClass   = \"error\";\n\n\t\t/* Overlay defaults */\n\t\tjQuery.extend(true, this, validator.optionsDefaults);\n\n\t\t/* Holds list of validating rules */\n\t\tthis.rules = {};\n\n\t\t/* Save element */\n\t\tthis.element = element;\n\n\t\t/* Get rules that declared in element definition */\n\t\tthis.getDeclaredRules();\n\n\t\t/* Save option */\n\t\tthis.element.data(\"validationOptions\", this);\n\n\t\t/* Self return */\n\t\treturn this;\n\n\t};\n\n\tvalidator.Options.prototype = {\n\n\t\t/**\n\t\t * Gets list of rules that are set in declared way\n\t\t */\n\t\tgetDeclaredRules: function() {\n\n\t\t\t/* Get attribute value */\n\t\t\tlet attr = this.element.attr(\"data-validate\"),\n\t\t\t\tself = this;\n\n\t\t\t/* If none */\n\t\t\tif(!attr)\n\t\t\t\treturn;\n\n\t\t\t/* Get list */\n\t\t\t$.each(attr.split(\";\"), function(_, name) {\n\n\t\t\t\t/* Get parameters */\n\t\t\t\tlet params = name.match(/(\\w+)\\((.*)\\)/);\n\n\t\t\t\t/* Parse */\n\t\t\t\tif(params) {\n\n\t\t\t\t\t/* Get function */\n\t\t\t\t\tname = params[1];\n\n\t\t\t\t\t/* Parse params */\n\t\t\t\t\tparams = params[2].match(/(('[^']+')|([\\d\\w]+))/g);\n\t\t\t\t\t$.each(params, function(i, val) {\n\t\t\t\t\t\tparams[i] = eval(val.trim());\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\t/* Add rule to options */\n\t\t\t\tself.addRule(name.trim(), { options: params || [] });\n\n\t\t\t});\n\n\n\t\t},\n\n\t\t/**\n\t\t * Adds new rule for element\n\t\t * @param {string} name Rule name\n\t\t * @param {object} options Rule options\n\t\t * @returns {validator.Options}\n\t\t */\n\t\taddRule: function(name, options) {\n\n\t\t\t/* Create and save new rule */\n\t\t\tthis.rules[name] = jQuery.extend({}, validator.ruleDefaults, options);\n\n\t\t\t/* Mark for auto validation */\n\t\t\tif(!this.element.attr(\"data-validate\"))\n\t\t\t\tthis.element.attr(\"data-validate\", \"true\");\n\n\t\t\t/* Self returning */\n\t\t\treturn this;\n\t\t}\n\n\t}\n\n});","sky.service(\"visibleCalculator\", function() {\n\n\tlet Calculator = class {\n\n\t\tconstructor(holder, minHeight, scrollable) {\n\n\t\t\t/* Check if class */\n\t\t\tif(!(this instanceof Calculator))\n\t\t\t\treturn new Calculator(holder, minHeight, scrollable);\n\n\t\t\t/* Re get holder */\n\t\t\tthis.holder = $(holder);\n\t\t\tthis.scrollable = scrollable || $('body');\n\t\t\tthis.minHeight = minHeight || 0;\n\n\t\t\t/* Init */\n\t\t\tthis.init();\n\n\t\t}\n\n\t\t/* Init func */\n\t\tinit() {\n\n\t\t\t/* Count offset */\n\t\t\tlet offset = this.holder.offset();\n\n\t\t\t/* Get holder rect */\n\t\t\tthis.holderRect = {\n\t\t\t\tleft  : offset.left,\n\t\t\t\ttop   : offset.top,\n\t\t\t\twidth : this.holder.outerWidth(),\n\t\t\t\theight: this.holder.outerHeight()\n\t\t\t};\n\n\t\t}\n\n\t\t/* Calculating function */\n\t\tcalculate() {\n\n\t\t\t/* How much is scrolled */\n\t\t\tlet scrollTop    = $(this.scrollable).scrollTop(),\n\t\t\t\twindowHeight = $(window).height(),\n\t\t\t\twindowWidth  = $(window).width(),\n\t\t\t\tsizes        = {\n\t\t\t\t\tleft        : this.holderRect.left,\n\t\t\t\t\tright       : this.holderRect.left + this.holderRect.width,\n\t\t\t\t\ttop         : this.holderRect.top - scrollTop,\n\t\t\t\t\twidth       : this.holderRect.width,\n\t\t\t\t\theight      : this.holderRect.height,\n\t\t\t\t\trealHeight  : this.holderRect.height,\n\t\t\t\t\tbottom\t\t: 0,\n\t\t\t\t\tscrollTop   : scrollTop,\n\t\t\t\t\tscrollLeft  : 0,\n\t\t\t\t\twindowHeight: windowHeight,\n\t\t\t\t\twindowWidth : windowWidth,\n\t\t\t\t};\n\n\t\t\t/* Min height */\n\t\t\tif(sizes.height < this.minHeight)\n\t\t\t\tsizes.height = this.minHeight;\n\n\t\t\t/* Count bottom */\n\t\t\tsizes.bottom = sizes.top + sizes.height;\n\n\t\t\t/* If top border near than holder */\n\t\t\tif(sizes.top < 0) {\n\t\t\t\t// If visible less than min\n\t\t\t\tif(sizes.bottom < this.minHeight) {\n\t\t\t\t\tsizes.bottom = sizes.bottom < 0 ? 0 : sizes.bottom;\n\t\t\t\t\tsizes.top = sizes.bottom - this.minHeight;\n\t\t\t\t\tsizes.height = this.minHeight;\n\t\t\t\t}\n\t\t\t\t// If visible more than min\n\t\t\t\telse {\n\t\t\t\t\tsizes.height = sizes.bottom;\n\t\t\t\t\tsizes.top = 0;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t/* Get visible bottom */\n\t\t\tif(windowHeight < sizes.bottom) {\n\t\t\t\t// If visible less than min\n\t\t\t\tif(windowHeight - sizes.top < this.minHeight) {\n\t\t\t\t\tsizes.height = this.minHeight;\n\t\t\t\t\tsizes.top = windowHeight - sizes.top < 0 ? 0 : sizes.top;\n\t\t\t\t\tsizes.bottom = sizes.top + this.minHeight;\n\t\t\t\t}\n\t\t\t\t// If visible more than min\n\t\t\t\telse {\n\t\t\t\t\tsizes.height = windowHeight - sizes.top;\n\t\t\t\t\tsizes.bottom = 0;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t/* Return */\n\t\t\treturn sizes;\n\n\t\t}\n\n\t\tgetDropOffset(replace, popup) {\n\n\t\t\t/* Get drop */\n\t\t\tif(!popup.is(\":visible\")) return;\n\n\t\t\t/* Set position to zeros to get max width and height */\n\t\t\tpopup.removeClass('hidden').css({left: 0, top: 0});\n\n\t\t\t/* Init */\n\t\t\tlet popupWidth  = popup.outerWidth(),\n\t\t\t\tpopupHeight = popup.outerHeight();\n\n\t\t\t/* Reset position */\n\t\t\tpopup.css({marginLeft: \"\", marginTop: \"\", width: \"\", left: \"\", top: \"\"});\n\n\t\t\t/* Init */\n\t\t\tlet win            = $(window),\n\t\t\t\treplaceOffset  = replace.offset(),\n\t\t\t\tpopupOffset    = popup.offset(),\n\t\t\t\tleftDifference = popupOffset.left - replaceOffset.left,\n\t\t\t\ttopDifference  = popupOffset.top - replaceOffset.top,\n\t\t\t\tmiddle         = false,\n\t\t\t\tvisible        = this.calculate(),\n\t\t\t\ttop = 0, left = 0;\n\n\t\t\t// Drop down\n\t\t\tif(visible.bottom + popupHeight <= visible.windowHeight)\n\t\t\t\ttop = topDifference + visible.realHeight + 1;\n\t\t\t// Drop up\n\t\t\telse if(visible.top > popupHeight)\n\t\t\t\ttop = -topDifference - 1;\n\t\t\t// Drop left\n\t\t\telse {\n\t\t\t\ttop = -topDifference - (popupHeight - visible.realHeight) / 2;\n\t\t\t\tmiddle = true;\n\t\t\t}\n\t\t\t\n\t\t\t/* Set position */\n\t\t\tif(!middle) {\n\t\t\t\tif(visible.windowWidth > visible.left + popupWidth)\n\t\t\t\t\tleft = -leftDifference;\n\t\t\t\telse\n\t\t\t\t\tleft = -leftDifference - popupWidth + visible.width;\n\t\t\t} else {\n\t\t\t\tif(win.width() > replaceOffset.left + popupWidth + visible.width)\n\t\t\t\t\tleft = replaceOffset.left - popupOffset.left + visible.width;\n\t\t\t\telse\n\t\t\t\t\tleft = replaceOffset.left - popupOffset.left - popupWidth;\n\t\t\t}\n\n\t\t\treturn { top, left };\n\t\t\t\n\t\t}\n\t};\n\tthis.service = Calculator;\n});","/**\n * Holds classes to work with modal/new windows\n */\nsky.service('windows', [\"templates\", \"callbacks\", \"stackList\"], function ({templates, callbacks, stackList}) {\n\n\tlet tips = false,\n\t\tlist = stackList(),\n\t\twindows = this.service = {\n\n\t\t\t/**\n\t\t\t * Returns last open window if any\n\t\t\t * @returns {windows.Modal|boolean}\n\t\t\t */\n\t\t\tgetLast: function () {\n\t\t\t\treturn list.last()\n\t\t\t},\n\n\t\t\t/**\n\t\t\t * Creates new modal window\n\t\t\t * @param {*} name Window name\n\t\t\t * @param {*} [data] Data to send with request\n\t\t\t */\n\t\t\tModal: function (name, data) {\n\n\t\t\t\t/* Self construct */\n\t\t\t\tif (!(this instanceof windows.Modal))\n\t\t\t\t\treturn new windows.Modal(name, data);\n\n\t\t\t\t/* Create window */\n\t\t\t\tthis.locked \t\t= false;\n\t\t\t\tthis.background \t= templates.render(\"windows-modal\", {}).appendTo(\"#pageContentHolder\").data(\"modalWindow\", this);\n\t\t\t\tthis.dataContainer \t= this.background.children();\n\t\t\t\tthis.holder \t\t= this.dataContainer.children(\".windowData\");\n\t\t\t\tthis.closeButton \t= this.dataContainer.children(\".close\");\n\n\t\t\t\t/* Make body un scrollable */\n\t\t\t\t$(document.body).css(\"overflow\", \"hidden\");\n\n\t\t\t\t/* Callbacks */\n\t\t\t\tthis.callbacks = callbacks();\n\n\t\t\t\t/* Render content */\n\t\t\t\ttry {\n\t\t\t\t\tthis.reRender(name, data);\n\t\t\t\t} catch (e) {\n\t\t\t\t\tthis.close(false);\n\t\t\t\t\tthrow e;\n\t\t\t\t}\n\n\t\t\t\t/* Return */\n\t\t\t\treturn this;\n\n\t\t\t}\n\n\t\t};\n\n\t/**\n\t * Modal window prototype\n\t */\n\twindows.Modal.prototype = {\n\n\t\t/**\n\t\t * Renders window content\n\t\t * @param {*} name Window name\n\t\t * @param {*} [data] Data to send with request\n\t\t */\n\t\treRender: function (name, data) {\n\n\t\t\t/* Close all tips */\n\t\t\tif(tips) tips.hideAll(true);\n\n\t\t\t/* Clear */\n\t\t\tthis.holder.html('');\n\n\t\t\t/* Render content */\n\t\t\tif (name instanceof jQuery)\n\t\t\t\tthis.template = name.appendTo(this.holder);\n\t\t\telse if (typeof name === \"string\")\n\t\t\t\tthis.template = templates.render(name, data).appendTo(this.holder);\n\n\t\t\t/* Self return */\n\t\t\treturn this;\n\t\t},\n\n\t\t/**\n\t\t * Removes all except that was rendered\n\t\t */\n\t\tclearExceptTemplate: function () {\n\t\t\tthis.holder.children().detach();\n\t\t\tthis.holder.append(this.template);\n\t\t},\n\n\t\t/**\n\t\t * Removes all except that was rendered\n\t\t */\n\t\tremoveMessages: function () {\n\t\t\tthis.holder.find(\".notificationMessage\").remove();\n\t\t\treturn this;\n\t\t},\n\n\t\t/**\n\t\t * Locks window so it can't be closed\n\t\t * @returns {windows.Modal}\n\t\t */\n\t\tlock: function (ajax) {\n\t\t\tthis.locked = true;\n\t\t\tthis.closeButton.hide();\n\t\t\tif (ajax) ajax\n\t\t\t\t.on(\"preSuccess\", function () {\n\t\t\t\t\tthis.dataContainer.css(\"height\", this.dataContainer.innerHeight());\n\t\t\t\t}, this)\n\t\t\t\t.on(\"notAbort\", function () {\n\t\t\t\t\tlet self = this;\n\t\t\t\t\tthis.unlock();\n\t\t\t\t\tthis.dataContainer.css(\"height\", this.holder.outerHeight());\n\t\t\t\t\tsetTimeout(function () {\n\t\t\t\t\t\tself.dataContainer.css(\"height\", \"\");\n\t\t\t\t\t}, 500)\n\t\t\t\t}, this)\n\t\t\t\t.on(\"abort\", function () {\n\t\t\t\t\tthis.unlock().close();\n\t\t\t\t}, this);\n\t\t\treturn this;\n\t\t},\n\n\t\t/**\n\t\t * Unlocks window so it can be closed\n\t\t * @returns {windows.Modal}\n\t\t */\n\t\tunlock: function () {\n\t\t\tthis.locked = false;\n\t\t\tthis.closeButton.show();\n\t\t\treturn this;\n\t\t},\n\n\t\t/**\n\t\t * Closes current window\n\t\t * @param {boolean} [byUser] Indicates that window was closed not by user\n\t\t */\n\t\tclose: function (byUser = false) {\n\n\t\t\t/* If windows is locked */\n\t\t\tif (this.locked)\n\t\t\t\treturn;\n\n\t\t\t/* Remove elements */\n\t\t\tthis.background.fadeOut(\"fast\", function () {\n\t\t\t\t$(this).remove()\n\t\t\t});\n\n\t\t\t/* Delete from list */\n\t\t\tlist.remove(this);\n\n\t\t\t/* Call close callback */\n\t\t\tthis.callbacks.fire(\"close\", {byUser: byUser});\n\n\t\t\t/* Close all tips */\n\t\t\tif(tips) tips.hideAll(true);\n\n\t\t\t/* Make body scrollable */\n\t\t\tif (list.total() < 1)\n\t\t\t\t$(document.body).css(\"overflow\", \"\");\n\n\t\t\treturn this;\n\n\t\t}\n\n\t};\n\n\ttry {\n\t\ttips = sky.service(\"tips\");\n\t} catch (e) {}\n\n\t/* Add handler to black area click */\n\t$(document)\n\t\t.on(\"keyup\", sky.func(function (event) {\n\t\t\tlet last;\n\n\t\t\t/* If slide show was disabled */\n\t\t\tif (document[\"webkitIsFullScreen\"] || document[\"mozIsFullScreen\"] || document[\"isFullScreen\"])\n\t\t\t\treturn;\n\n\t\t\t/* Close current window */\n\t\t\tif (event.keyCode === 27 && (last = windows.getLast()))\n\t\t\t\tlast.close(true);\n\n\t\t}));\n\n});","sky.action(\"pagination\", {\n\n\tsetPage: function(button, _, page) {\n\n\t\t/* Get pagination */\n\t\tlet pagination = button.parents(\".pagination\").data(\"pagination\");\n\n\t\t/* Correct page */\n\t\tif(page === \"next\")\n\t\t\tpage = pagination.current + 1;\n\n\t\t/* Correct  */\n\t\tif(page === \"previous\")\n\t\t\tpage = pagination.current - 1;\n\n\t\t/* Go to page */\n\t\tpagination.goToPage(page);\n\n\t},\n\n\tscrollTo: function(element, event) {\n\n\t\t/* Get pagination */\n\t\tlet pagination = element.parents(\".pagination\").data(\"pagination\");\n\n\t\t/* Move */\n\t\tpagination.scroll(event);\n\n\t},\n\n\tgrab: function(runner) {\n\n\t\t/* Get pagination */\n\t\tlet pagination = runner.parents(\".pagination\").data(\"pagination\");\n\n\t\t/* Binds */\n\t\t$(window)\n\t\t\t.on(\"mouseup.pagination\", function() {\n\t\t\t\t$(window).off(\"mouseup.pagination mousemove.pagination\");\n\t\t\t}).on(\"mousemove.pagination\", function(event) {\n\t\t\t\tpagination.scroll(event);\n\t\t\t});\n\n\t},\n\n\tnext: function(button, _) {\n\t\tthis.setPage(button, _, \"next\")\n\t},\n\n\tprevious: function(button, _) {\n\t\tthis.setPage(button, _, \"previous\")\n\t}\n\n});","sky.action(\"selectReplace\", function({ visibleCalculator }) {\n\n    let filter = function(self, event) {\n\n        /* Get drop */\n        let popup  = self.closest(\".selectReplaceChoose\"),\n            inputs = popup.find(\"input[name]\");\n\n        /* On enter */\n        if(event.which === 13) {\n            let visible = popup.find(\"label:visible\");\n            if(visible.length > 0) {\n                inputs.prop(\"checked\", false);\n                visible.children(\"input\").prop(\"checked\", true).trigger(\"change\");\n            }\n            event.stopPropagation();\n        }\n\n        /* Get value */\n\t\tlet value = self.val(),\n\t\t\t rus              = \"йцукенгшщзхъфывапролджэёячсмитьбю\",\n             eng              = \"qwertyuiop[]asdfghjkl;'\\\\zxcvbnm,.\",\n             expression       = new RegExp(value.toLowerCase()),\n             expressionInvert = new RegExp(value.toLowerCase().replace(/[a-zа-яё]/g, (character) => {\n                if(rus.indexOf(character) > -1) return eng[rus.indexOf(character)];\n                if(eng.indexOf(character) > -1) return rus[eng.indexOf(character)];\n                return character;\n            }));\n\n        /* Hide */\n        for(let input of inputs) {\n\n            if(input.parent().hasClass('hidden'))\n                return;\n\n            let inputHtml = input.next().html().toLowerCase();\n\n            try {\n                if(!inputHtml.match(expression) && !inputHtml.match(expressionInvert)) input.parent().hide();\n                else input.parent().show();\n            } catch(e) {}\n\n        }\n    };\n\n    return {\n\n        filter: filter,\n\n        selectAll: function(button) {\n\n            /* Get drop */\n            let popup = button.closest(\".selectReplaceChoose\");\n            popup.find(\":checkbox:visible\").prop(\"checked\", true).first().trigger(\"change\");\n\n        },\n\n        unSelectAll: function(button) {\n\n            /* Get drop */\n            let popup = button.closest(\".selectReplaceChoose\");\n            popup.find(\":checkbox:visible\").prop(\"checked\", false).first().trigger(\"change\");\n\n        },\n\n        close: function(element, event) {\n            if(element.get(0) === event.target)\n                $(\".selectReplaceChoose\").addClass('hidden');\n        },\n\n\t\tshowTip: function(label) {\n\n\t\t\tlet originalTip = label.find(\".checkItemTip\");\n\n\t\t\t/* If no tip element or tip already shown */\n\t\t\tif(!originalTip.length || label.data(\"tip\"))\n\t\t\t    return;\n\n            let popup = label.closest(\".selectReplaceChoose\");\n            let tip = originalTip.clone().removeClass(\"hidden\").appendTo(\"body\");\n            tip.css({\n                left: popup.offset().left,\n                top : popup.offset().top + popup.outerHeight() + 5\n            });\n            label.data(\"tip\", tip);\n\n\n\t\t},\n\n        hideTip: function(label) {\n\t\t\tif(!label.data(\"tip\"))\n\t\t\t    return;\n            label.data(\"tip\").remove();\n            label.removeData(\"tip\");\n\t\t},\n\n        /**\n         * Shows drop down\n         * @param replace Input\n         */\n        drop: function (replace) {\n\n            /* Hide all */\n\t\t\t$(\".selectReplaceChoose\").addClass('hidden');\n\n            /* Get drop */\n            let popup = replace.next(),\n                dropOffset = (new visibleCalculator(replace)).getDropOffset(replace, popup.removeClass('hidden'));\n\n            /* If cant calculate offset */\n            if(!dropOffset) return;\n\n\t\t\tpopup.css({ marginLeft: dropOffset.left, marginTop: dropOffset.top });\n\n\t\t\tif(replace.outerWidth() > popup.outerWidth())\n\t\t\t\tpopup.css(\"width\", replace.outerWidth());\n\n\t\t\t/* Search focus */\n\t\t\tif (popup.find(\".search\").length)\n\t\t\t\tpopup.find(\".search input\").val('').focus();\n\n        },\n\n        change: function(element, event) {\n\n\t\t\t/* Get inputs */\n\t\t\tlet popup = element.closest(\".selectReplaceChoose\"),\n\t\t\t\tinputs = popup.find(\"input:radio, input:checkbox\"),\n\t\t\t\tcurrent, change, children = false, replace = popup.prev(),\n\t\t\t\tval = \"\",\n\t\t\t\tdefaultValue = replace.html() || '-',\n\t\t\t\tdefaultAllValue = replace.text() || \"Все\";\n\n\t\t\t/* Un select all */\n\t\t\tpopup.find(\"label\").removeClass(\"selected\");\n\n            /* Get checked */\n\t\t\tlet filtered = inputs.filter(\":checked\").each(function() {\n\t\t\t\tcurrent = $(this);\n\t\t\t\tcurrent.closest(\"label\").addClass(\"selected\");\n\t\t\t\tchildren = current.next();\n\t\t\t\tval = (val && val + \", \") + children.text();\n\t\t\t});\n\n            /* Make text shorter */\n\t\t\tif(val.length > 26)\n\t\t\t\tval = val.substr(0, 26).trim() + \"...\";\n\n\t\t\t/* If all checked */\n\t\t\tif(filtered.length === inputs.length && !popup.hasClass(\"single\"))\n\t\t\t\tval = defaultAllValue;\n\n\t\t\t/* Set input html */\n\t\t\tif(popup.hasClass(\"single\") && children)\n\t\t\t\treplace.html('').prepend(children.clone().removeClass(\"name\"));\n\t\t\telse if(!children)\n\t\t\t\treplace.html(defaultValue);\n\t\t\telse\n\t\t\t\treplace.text(val);\n\n            /* If not fake event */\n\t\t\tif(event && current)\n\t\t\t\treplace.trigger(\"change\", { value: current.val(), item: element });\n\n\t\t\t/* Hide on single-select */\n\t\t\tif(popup.hasClass(\"single\"))\n\t\t\t\tpopup.addClass('hidden');\n\n        }\n\n    }\n});","sky.directive(\".selectReplaceChoose\", function(popup, attrs) {\r\n\r\n\t\t/* Get inputs */\r\n\t\tlet labels = popup.find(\"label\"),\r\n\t\t\tinputs = popup.find(\"input:radio, input:checkbox\"),\r\n\t\t\tcurrent, change, children, replace = popup.prev(),\r\n\t\t\tval = \"\",\r\n            defaultValue = replace.html() || '-',\r\n            defaultAllValue = replace.text() || \"Все\";\r\n\r\n\t\treplace.data(\"addItem\", function(item) {\r\n\t\t\tlet newInput = sky.templates.renderByText(\"{% skyImport forms as forms %}{{ forms.selectReplaceGroup(items, options) }}\", { items: [item], options: {\r\n\t\t\t\tname: replace.attr(\"input\"),\r\n\t\t\t\tmultiple:  !replace.hasClass(\"single\")\r\n\t\t\t}});\r\n\t\t\tnewInput.insertAfter(inputs.filter(\":last\").parent());\r\n\t\t\tinputs = popup.find(\"input\");\r\n\t\t});\r\n\r\n\t\t/* On change */\r\n\t\t$(document).on(\"change\", '[data-input=\"'+ attrs[\"data-input\"] + '\"] input', change = function(event, data) {\r\n\r\n\t\t\t/* Remove selected styles */\r\n\t\t\tlabels.removeClass(\"selected\");\r\n\r\n\t\t\t/* Base text */\r\n\t\t\tval = \"\";\r\n\t\t\tchildren = false;\r\n\r\n\t\t\t/* Get checked */\r\n\t\t\tlet filtered = inputs.filter(\":checked\").each(function() {\r\n\t\t\t\tcurrent = $(this);\r\n\t\t\t\tcurrent.closest(\"label\").addClass(\"selected\");\r\n\t\t\t\tval = (val && val + \", \") + current.next().text();\r\n\t\t\t\tchildren = current.next();\r\n\t\t\t});\r\n\r\n\t\t\t/* Make text shorter */\r\n\t\t\tif(val.length > 26)\r\n\t\t\t\tval = val.substr(0, 26).trim() + \"...\";\r\n\r\n\t\t\tif(filtered.length === inputs.length && !popup.hasClass(\"single\"))\r\n\t\t\t\tval = defaultAllValue;\r\n\r\n\t\t\tif(popup.hasClass(\"single\") && children)\r\n\t\t\t\treplace.html('').prepend(children.clone().removeClass(\"name\"));\r\n\t\t\telse if(!children)\r\n\t\t\t\treplace.html(defaultValue);\r\n\t\t\telse\r\n\t\t\t\treplace.text(val);\r\n\r\n\t\t\t/* If not fake event */\r\n\t\t\tif(event && current) {\r\n                replace.trigger(\"change\", $.extend(data || {}, {\r\n                    value: current.val(),\r\n                    item: $(this)\r\n                }));\r\n            }\r\n\r\n            if(popup.hasClass(\"single\"))\r\n\t\t\t\t$(\".selectReplaceChoose\").addClass('hidden');\r\n\t\t});\r\n\r\n\t\t/* Trigger */\r\n\t\tsetTimeout(function() { change(false) }, 1);\r\n\r\n\t});\r\n\r\nsky.onReady(() => {\r\n\t$(document).on(\"click touchstart\", function(event) {\r\n\r\n\t\t/* Get element */\r\n\t\tlet element = $(event.target || event.srcElement);\r\n\r\n\r\n\t\t/* If click in replace we should not hide it */\r\n\t\tif(element.closest(\".selectReplaceChoose\").length || element.closest(\".selectReplace\").length)\r\n\t\t\treturn;\r\n\r\n\t\t/* Hide all */\r\n\t\t$(\".selectReplaceChoose\").addClass('hidden');\r\n\r\n\t})\r\n});\r\n","sky.action(\"suggest\", function(suggester) {\r\n   return {\r\n       adverts: function(input, event) {\r\n\r\n           // Events\r\n           if(event.keyCode == 38 || event.keyCode == 40 || event.keyCode == 13 || event.keyCode == 27)\r\n               return;\r\n\r\n           // Stop if any other\r\n           if(this.suggestAjax)\r\n               this.suggestAjax.stop();\r\n\r\n           // Nothing\r\n           if(input.val() == \"\" || input.val().length < 2) {\r\n               suggester.hideAll();\r\n               return;\r\n           }\r\n\r\n           this.suggestAjax = sky.ajax(\"/ajax/members/search\", { name: input.val() })\r\n               .on(\"success\", function(response) {\r\n\r\n                   // No filtered\r\n                   if(!response.adverts || !response.adverts.length)\r\n                       suggester.hideAll();\r\n\r\n                   var filtered = [];\r\n\r\n                   $.each(response.adverts, function(_, advert) {\r\n                       filtered.push(advert.username);\r\n                   });\r\n\r\n                   // Show\r\n                   suggester.show(input, filtered);\r\n\r\n               }).on(\"error\", function() {\r\n                   suggester.hideAll();\r\n               });\r\n\r\n       },\r\n\r\n       campaigns: function(input, event){\r\n\r\n           // Events\r\n           if(event.keyCode == 38 || event.keyCode == 40 || event.keyCode == 13 || event.keyCode == 27)\r\n               return;\r\n\r\n           // Stop if any other\r\n           if(this.suggestAjax)\r\n               this.suggestAjax.stop();\r\n\r\n           // Nothing\r\n           if(input.val() == \"\" || input.val().length < 2) {\r\n               suggester.hideAll();\r\n               return;\r\n           }\r\n\r\n           this.suggestAjax = sky.ajax(\"/ajax/campaigns/search\", { name: input.val() })\r\n               .on(\"success\", function(response) {\r\n\r\n                   // No filtered\r\n                   if(!response.campaigns || !response.campaigns.length)\r\n                       suggester.hideAll();\r\n\r\n                   var filtered = [];\r\n\r\n                   $.each(response.campaigns, function(_, campaign) {\r\n\r\n                       filtered.push({ html: campaign.name });\r\n                   });\r\n\r\n                   // Show\r\n                   suggester.show(input, filtered);\r\n\r\n               }).on(\"error\", function() {\r\n                   suggester.hideAll();\r\n               });\r\n       },\r\n\r\n       campaignsSpecial: function(input, event){\r\n           // Events\r\n           if(event.keyCode == 38 || event.keyCode == 40 || event.keyCode == 13 || event.keyCode == 27)\r\n               return;\r\n\r\n           // Nothing\r\n           if(input.val() == \"\" || input.val().length < 2) {\r\n               suggester.hideAll();\r\n               return;\r\n           }\r\n\r\n           if(this.suggestAjax)\r\n               this.suggestAjax.stop();\r\n\r\n           this.suggestAjax = sky.ajax(\"/ajax/campaigns/search\", { name: input.val() })\r\n               .on(\"success\", function(response) {\r\n\r\n                   // No filtered\r\n                   if(!response.campaigns || !response.campaigns.length)\r\n                       suggester.hideAll();\r\n\r\n                   var filtered = [];\r\n\r\n                   $.each(response.campaigns, function(_, campaign) {\r\n\r\n                       filtered.push({ html: campaign.name+\" (\"+campaign.advert.username+\")\", callback: function(){\r\n                           sky.actions.perform(null, null, \"page.selectCampaign\", [campaign.id]);\r\n                       }});\r\n                   });\r\n\r\n                   // Show\r\n                   suggester.show(input, filtered);\r\n\r\n               }).on(\"error\", function() {\r\n                   suggester.hideAll();\r\n               });\r\n       }\r\n   }\r\n});","sky.directive(\"[data-suggests]\", function(element, attributes) {\n\telement.attr(\"data-event\", \"keyup: suggest.\" + attributes[\"data-suggests\"]).attr(\"autocomplete\", \"off\");\n});","sky.action(\"tips\", ({actions, tips}) => {\n\tvar self = {\n\n\t\tshowTip: function(button, _, name) {\n\n\t\t\tif(button.data(\"tip\")) {\n\t\t\t\tbutton.data(\"tip\").hide();\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// Hide others\n\t\t\tself.hideTips(button, false);\n\n\t\t\t// Create\n\t\t\tlet tip = tips.Tip(button, {\n\t\t\t\tcreate: $('<div/>').css(\"overflow\", \"hidden\").append($(\"#\" + name + \"TipText\").html())\n\t\t\t});\n\n\t\t\t// Show\n\t\t\ttip.show(\"top\");\n\n\t\t},\n\n\t\tshowTipWithText: function(button, _, text) {\n\n\t\t\tif(button.data(\"tip\")) {\n\t\t\t\tbutton.data(\"tip\").hide();\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// Hide others\n\t\t\tself.hideTips(button, false);\n\n\t\t\t// Create\n\t\t\tlet tip = tips.Tip(button, {\n\t\t\t\tcreate: $('<div/>').css(\"overflow\", \"hidden\").append(text)\n\t\t\t});\n\n\t\t\t// Show\n\t\t\ttip.show(\"top\");\n\n\t\t},\n\n\t\thideTips: function(element, event) {\n\t\t\tlet target;\n\n\t\t\tif(event && event.target) {\n\t\t\t\ttarget = $(event.target);\n\t\t\t\tif(target.is(\"[tip]\") || target.is(\"[tip-text]\") || target.closest(\".tipContent\").length)\n\t\t\t\t\treturn;\n\t\t\t}\n\n\t\t\ttips.hideAll();\n\n\t\t},\n\n\t\t/**\n\t\t *\n\t\t */\n\t\tforceHideTips: function() {\n\t\t\ttips.hideAll(true);\n\t\t}\n\t};\n\treturn self;\n});","sky.directive(\"[data-tip]\", function(button, attributes) {\n\n\t// Get\n\tlet events  = attributes[\"data-event\"] || \"\",\n\t\ttipName = attributes[\"data-tip\"],\n\t\tevent   = \"click: tips.showTip('\" + tipName + \"')\";\n\n\t// Set new\n\tevents = events ? event : events + \"; \" + event;\n\n\t// Add\n\tbutton.attr(\"data-event\", events).addClass(\"dashed\");\n\n});\nsky.directive(\"[data-tip-text]\", function(button, attributes) {\n\n\t// Get\n\tlet events  = attributes[\"data-event\"] || \"\",\n\t\ttipText = attributes[\"data-tip-hover\"] || attributes[\"data-tip-text\"],\n\t\tevent   = \"click: tips.showTipWithText('\" + tipText + \"')\";\n\n\t// Set new\n\tevents = events ? event : events + \"; \" + event;\n\n\t// Add\n\tbutton.attr(\"data-event\", events).addClass(\"dashed\");\n\n});\nsky.directive(\"[data-tip-hover]\", function(button, attributes) {\n\n\t// Get\n\tlet tipText = attributes[\"data-tip-hover\"];\n\n\tsky.service(\"tips\").bind(button, \"top\", {create: tipText});\n\n\t// Set new\n\tlet events = attributes[\"data-event\"] || \"\",\n\t\tevent  = \"click: tips.showTipWithText('\" + tipText + \"')\";\n\tevents = events ? events + \"; \" + event : event;\n\n\t// Add\n\tbutton.attr(\"data-event\", events).addClass(\"dashed\");\n\n});","/**\n * Fire services init done\n */\nsky.exec(function() {\n\tsky.servicesDeferred.resolve();\n});","sky.directive(\"input.autoHttp\", function(input) {\n\tinput.on(\"focus\", function() {\n\t\tif(input.val() === \"\") input.val(\"http://\").get(0).selectionStart = 7;\n\t});\n});","/**\n * Fire project init done\n */\nsky.exec(function() {\n    document.body.classList.remove(\"hidden\");\n    sky.projectDeffered.resolve();\n});"]}