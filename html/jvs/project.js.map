{"version":3,"sources":["actions/actions.js","ajax/ajax.js","ajaxFiles/ajaxFiles.dropZone.js","ajaxFiles/ajaxFiles.iframe.js","ajaxFiles/ajaxFiles.js","ajaxFiles/ajaxFiles.xhr.js","ajaxLoadingIndicator/ajaxLoadingIndicator.js","calendar/calendar.js","callbacks/callback.js","callbacks/callbacks.js","dataOperator/dataOperator.js","dataOperator/inputsIO.js","dataOperator/searchField.js","directives/directives.js","drag/drag.js","history/history.js","localStorage/localStorage.js","models/models.js","models/modelsManager.js","models/modelsStorage.js","notifications/notifications.js","pagination/pagination.js","stacklist/stacklist.js","suggester/suggester.js","supported/supported.js","templates/templates.js","tips/tips.js","utils/utils.js","validator/validator.js","visibleCalculator/visibleCalculator.js","windows/windows.js","pagination/actions/paginationActions.js","selectReplace/actions/selectReplace.js","selectReplace/directives/select.js","suggester/actions/suggests.js","suggester/directives/suggests.js","tips/actions/tips.js","tips/directives/tips.js","servicesInit.js","shared.js","projectInit.js"],"names":["sky","service","exceptions","list","actions","perform","element","event","action","options","params","match","split","$","each","i","val","eval","trim","extend","self","path","current","name","isDisabled","elem","length","system","Error","apply","concat","add","events","safe","fn","selector","on","data","call","document","skyEvent","getAttribute","indexOf","type","preventDefault","map","parts","eventString","target","get","callbacks","url","object","callbackData","ajaxExtend","filter","disable","ajaxCallbacks","stop","ajax","abort","dataType","timeout","success","response","textStatus","jqXHR","error","text","fire","errorThrown","errorText","responseText","status","codes","code","promise","always","enable","supported","zone","files","XHRUpload","attachEvents","dragenter","dragleave","dragend","drop","dragover","originalEvent","isValidFileDrag","effect","dataTransfer","effectAllowed","dropEffect","bind","e","onStart","dt","isWebkit","navigator","userAgent","types","contains","AjaxFilesIFrame","input","prototype","getName","replace","cancel","id","onAbort","value","IFrame","setAttribute","remove","send","fileName","clone","insertBefore","createIframe","form","createForm","append","attachLoadEvent","getIframeContentJSON","onSuccess","setTimeout","trigger","iframe","callback","load","parentNode","contentDocument","body","innerHTML","doc","contentWindow","onError","jQuery","parseJSON","console","log","src","Math","floor","random","css","appendTo","queryString","param","method","enctype","attr","ajaxFilesXHR","ajaxFilesIFrame","AjaxFiles","inputs","saveFiles","file","push","inputName","parallel","_","handler","sendParallel","sendConsequentially","defaultSend","is","closest","find","templates","notifications","windows","filesAjax","modal","getLast","currentFile","holder","lock","render","insertAfter","parent","unlock","clearExceptTemplate","message","appendToModal","totalPercent","percent","html","stackList","toProceed","inProgress","total","totalLoaded","totalSize","fileRequests","size","loaded","args","formData","FormData","processData","contentType","xhr","XMLHttpRequest","upload","toFixed","onProgress","undefined","beforeSend","func","setRequestHeader","encodeURI","all","notSuccess","delete","fileRequestData","request","loadings","Loading","global","addClass","click","hide","content","children","show","contentHolder","setHolder","calc","visibleCalculator","outerHeight","window","off","position","calculate","left","width","top","height","removeClass","loading","calendar","monthsNames","page","renderDays","moment","date","weeks","currentWeek","month","day","number","isoWeek","days","dateStr","format","dates","period","since","till","setTime","dayPick","dayDiv","notClose","parseInt","field","getInputValue","close","useTime","isSame","setDayPick","pickedDateView","calculator","offset","getDropOffset","marginTop","marginLeft","periodChangeDay","reset","lastModified","isBefore","isAfter","markSelected","changeDay","hour","minute","changeYear","year","yearView","changeMonth","monthView","getDatePeriod","dateString","getDate","showTime","subtract","dateOriginal","elementFromPoint","clientX","touches","clientY","onReady","srcElement","parents","keyCode","calendars","Callback","flags","functions","toRun","context","once","removeByContext","splice","removeByCallback","fireNext","result","Callbacks","advancedCallbacks","callbacksFlags","removeListener","listener","Object","getEventsNames","next","slice","possible","names","elements","j","join","searchField","utils","ajaxLoadingIndicator","baseOptions","fields","historyType","DataOperator","lastRequestData","beforeRequest","setOptions","onFormSubmit","validForm","force","getById","reload","history","set","search","fromUrl","readSearch","writeForm","readHash","read","isObjectsEqual","writeURI","prepareRequest","lastResponse","reloadContent","virtual","item","fieldsList","valueOrNullOnDefault","write","hashRead","searchRead","fieldName","substring","default","initOperator","initLoader","loader","pagination","pages","onPageChange","pageNum","searchChanged","hashChanged","readInputValue","readInputsValues","valuesNamed","valuesLined","writeInputValue","prop","writeInputsValue","first","notByUser","values","Array","inputsIO","hashValue","hashObject","searchValue","searchObject","directives","directive","getAttributes","attributes","nodeName","nodeValue","parseElement","jsonScript","json","JSON","parse","parseDirectives","bindEvents","start","move","started","button","x","pageX","y","pageY","getObjectsDifference","second","difference","localDiff","key","returnArray","History","hashString","searchString","pathString","intervalId","base","navigate","location","pathname","substr","pushState","oldPath","newPath","getWindowSearch","hash","change","hashDifference","searchDifference","old","getWindowHash","getDifference","rebuild","pathChanged","setHash","setSearch","changed","decodeURIComponent","proxy","stringFromObject","obj","getObjects","paramsString","objects","subStrings","str","keyAndValue","string","stored","decodeURI","onpopstate","setInterval","time","LocalStorage","items","getItems","localStorage","getItem","storage","setItem","stringify","modelsStorage","modelsDefinition","Model","definition","BaseDefinition","creation","extension","model","addDefinition","fromData","cached","Manager","arr","fromArray","cache","tips","Message","align","Tip","create","findInElement","Pagination","pageWidth","last","dimensions","startPage","lastStartPage","pagesVisible","pagesInvisible","scrollAvailable","scrollStart","tumbler","dom","slider","back","forward","redraw","goToPage","newPage","innerWidth","toShow","drawPages","createScroll","scrollLine","runner","scroll","outerWidth","isVisible","pos","List","lastId","index","hasOwnProperty","single","suggester","lastList","removeData","elementPosition","renderPosition","selected","prev","fullScreen","templatesList","templatesCompiled","Templates","globals","template","save","cookie","renderByNameWithHolder","noDirectives","compile","coverWithHolder","renderByTextWithHolder","Twig","twig","temp","createElement","childNodes","renderToText","renderByText","renderByTextToText","compiled","fromLS","attrs","hideAll","withoutAutoHide","caller","tip","autoHide","highlight","className","shadow","opacity","background","closeTimeout","display","animate","fadeOut","fadeIn","blur","clearTimeout","what","arguments","addLeadingZero","encode","rawStr","charCodeAt","jsonData","prepareSelectData","columnSplitOn","maxColumns","columns","columnsCount","groupHolder","perColumn","ceil","column","groups","validator","validateForm","validationRule","addRule","validateElement","pass","shouldBeValidated","Options","totalPass","lastError","firstError","lastSuccess","firstSuccess","rules","ruleOverload","compiledRule","Rule","validate","rule","ruleDefaults","optionsDefaults","errorClass","successClass","overload","required","requiredIfFilled","email","same","regexp","RegExp","numeric","positive","parseFloat","max","min","minLength","maxLength","getDeclaredRules","Calculator","minHeight","scrollable","init","holderRect","scrollTop","windowHeight","windowWidth","sizes","right","realHeight","bottom","scrollLeft","popup","popupWidth","popupHeight","win","replaceOffset","popupOffset","leftDifference","topDifference","middle","visible","Modal","locked","dataContainer","closeButton","reRender","detach","innerHeight","byUser","setPage","scrollTo","grab","previous","which","stopPropagation","rus","eng","expression","toLowerCase","expressionInvert","character","hasClass","inputHtml","selectAll","unSelectAll","showTip","label","originalTip","hideTip","dropOffset","focus","defaultValue","defaultAllValue","filtered","prepend","select","option","checked","replaceElement","adverts","suggestAjax","advert","username","campaigns","campaign","campaignsSpecial","hideTips","showTipWithText","forceHideTips","tipName","tipText","exec","servicesDeferred","resolve","closeWindow","submit","clearForm","changeOrder","orderField","order","table","trs","cell1","cell2","convert","sort","firstTr","secondTr","buttonTr","val1","val2","isNaN","changeOrderReload","currentLoader","selectionStart","classList","projectDeffered"],"mappings":"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","file":"project.js","sourcesContent":["sky.service(\"actions\", [\"exceptions\"], function ({exceptions}) {\n\n\tlet list = {},\n\t\tactions = this.service = {\n\n\t\t\t/**\n\t\t\t * Performs action\n\t\t\t * @param element\n\t\t\t * @param event\n\t\t\t * @param action\n\t\t\t * @param {Array} [options]\n\t\t\t */\n\t\t\tperform: function (element, event, action, options) {\n\n\t\t\t\t/* Get parameters */\n\t\t\t\tlet params = action.match(/(.+)\\((.*)\\)/);\n\n\t\t\t\t/* Parse */\n\t\t\t\tif (params) {\n\n\t\t\t\t\t/* Get function */\n\t\t\t\t\taction = params[1];\n\n\t\t\t\t\t/* Parse params */\n\t\t\t\t\tparams = params[2].split(\",\");\n\t\t\t\t\t$.each(params, function (i, val) {\n\t\t\t\t\t\tparams[i] = eval(val.trim());\n\t\t\t\t\t})\n\t\t\t\t}\n\n\t\t\t\t/* Options */\n\t\t\t\tif (options)\n\t\t\t\t\tparams = $.extend(params || [], options);\n\n\t\t\t\t/* Get */\n\t\t\t\tlet self = element ? $(element) : false,\n\t\t\t\t\tpath = action.split(\".\"),\n\t\t\t\t\tcurrent = list,\n\t\t\t\t\tname = action;\n\n\t\t\t\t/* If disabled */\n\t\t\t\tif (self && self.isDisabled && self.isDisabled())\n\t\t\t\t\treturn;\n\n\t\t\t\t$.each(path, function (i, elem) {\n\n\t\t\t\t\t/* Search */\n\t\t\t\t\tif (i + 1 < path.length && !current[elem])\n\t\t\t\t\t\tthrow new exceptions.system.Error(\"No action - \" + action + \", because can't find '\" + elem + \"'\");\n\n\t\t\t\t\t/* Get new elem */\n\t\t\t\t\tif (i + 1 < path.length)\n\t\t\t\t\t\tcurrent = current[elem];\n\n\t\t\t\t\t/* Save name */\n\t\t\t\t\tname = elem;\n\n\t\t\t\t});\n\n\t\t\t\t/* If no */\n\t\t\t\tif (!current[name])\n\t\t\t\t\tthrow new exceptions.system.Error(\"No action - \" + action);\n\n\t\t\t\t/* Call */\n\t\t\t\tcurrent[name].apply(current, [self, event].concat(params || []));\n\n\t\t\t},\n\n\t\t\t/**\n\t\t\t * Adds actions to list\n\t\t\t * @param name Group name\n\t\t\t * @param events List\n\t\t\t */\n\t\t\tadd: function (name, events) {\n\n\t\t\t\tif (typeof events === \"function\")\n\t\t\t\t\tevents = events.safe(true)();\n\n\t\t\t\t// Check\n\t\t\t\tif (!events || typeof events !== 'object')\n\t\t\t\t\tthrow new exceptions.system.Error(\"No event object for events '\" + name + \"' provided\");\n\n\t\t\t\t// Save\n\t\t\t\tlist[name] = $.extend(list[name] || {}, events);\n\n\t\t\t}\n\n\t\t};\n\n\n\t/**\n\t * Adds special bind function\n\t * @param {string} name Event name\n\t * @param {*} selector Selector string\n\t * @param {function} [action] Action function\n\t * @returns {jQuery}\n\t */\n\t$.fn.action = function(name, selector, action) {\n\n\t\t/* Parameters skip */\n\t\tif(typeof action === \"undefined\") { action = selector; selector = null; }\n\n\t\t/* Bind */\n\t\treturn this.on(name, selector, function(event, data) {\n\t\t\taction.call(this, event, $(this), data);\n\t\t}.safe());\n\t};\n\n\t/*\n\t * Bind declarative events\n\t */\n\t$(document).action(\"click submit keyup keydown dblclick mouseover mouseout mouseleave mouseenter change mousedown mouseup touchstart\", '[data-event]', function (event, self, data) {\n\n\t\t/* Get string */\n\t\tlet skyEvent = this.getAttribute(\"data-event\");\n\n\t\t/* If no such event in data-event attribute */\n\t\tif (skyEvent.indexOf(event.type) === -1)\n\t\t\treturn;\n\n\t\t/* If disabled */\n\t\tif (self.isDisabled && self.isDisabled()) {\n\t\t\tevent.preventDefault();\n\t\t\treturn;\n\t\t}\n\n\t\tskyEvent.split(\";\").map(eventString => {\n\n\t\t\t/* Get elements */\n\t\t\tlet parts = eventString.match(/(\\w+):(.*)/);\n\n\t\t\t/* Wrong */\n\t\t\tif (parts.length !== 3)\n\t\t\t\tthrow new exceptions.system.Error(\"Wrong action format in data-event: \" + eventString);\n\n\t\t\t/* Get elements */\n\t\t\tlet name = parts[1].trim(),\n\t\t\t\taction = parts[2].trim();\n\n\t\t\t/* Another event */\n\t\t\tif (name !== event.type)\n\t\t\t\treturn;\n\n\t\t\t/* No default go */\n\t\t\tif (event.target === self.get(0))\n\t\t\t\tevent.preventDefault();\n\n\t\t\t/* Passed data */\n\t\t\tevent.data = data;\n\n\t\t\t/* Perform action */\n\t\t\tactions.perform(this, event, action);\n\n\t\t});\n\n\t});\n\n});","sky.service(\"ajax\", [\"callbacks\"], function({ callbacks }) {\n\n\t/**\n\t * Advanced ajax execution\n\t * To abort call stop() method instead of abort() because it's used for abort callback set, or .ajax.abort()\n\t * You may skip type, don't skip it if lock is string set false in object and data\n\t * @param {string} url\t\t\t\tRequested url\n\t * @param {object} [data]\t\t\tHolds request parameters\n\t * @param {jQuery} [object]\t\t\tObject which performs request, to disable it during request\n\t * @param {object} [ajaxExtend]\t\tAdditional ajax options, see http://api.jquery.com/jQuery.ajaxSetup/\n\t * @param {object} [callbackData]\tAdditional params that passed to any callback\n\t */\n\tthis.service = function(url, data, { object = null, callbackData = {}, ajaxExtend = {} }) {\n\n\t\t/* Lock button */\n\t\tif(object)\n\t\t\tobject = $(object).filter(\":not(.disabled)\").disable();\n\n\t\t/* New object to store callbacks */\n\t\tlet ajaxCallbacks = new callbacks();\n\t\tajaxCallbacks.stop = function() { ajaxCallbacks.ajax.abort(); };\n\n\t\t/* Perform ajax request */\n\t\tajaxCallbacks.ajax = $.ajax($.extend(true, {\n\n\t\t\t/* Set base options */\n\t\t\turl     \t: url,\n\t\t\tdata    \t: data,\n\t\t\tdataType\t: \"json\",\n\t\t\ttype    \t: \"post\",\n\t\t\ttimeout\t\t: 480 * 1000,\n\t\t\tsuccess: function(response, textStatus, jqXHR) {\n\n\t\t\t\t/* Possible params list */\n\t\t\t\tlet params = $.extend({ jqXHR: jqXHR, textStatus: textStatus, object: object }, callbackData);\n\n\t\t\t\t/* If empty response */\n\t\t\t\tif(response === null) {\n\t\t\t\t\tparams.error = \"  \";\n\t\t\t\t\tparams.type = \"noData\";\n\t\t\t\t}\n\n\t\t\t\t/* If response returned with error */\n\t\t\t\tif(response.error) {\n\t\t\t\t\tparams.error = response.text;\n\t\t\t\t\tparams.type = \"php\";\n\t\t\t\t}\n\n\t\t\t\t/* If error type set */\n\t\t\t\tif(params.type)\n\t\t\t\t\treturn ajaxCallbacks.fire(\"notSuccess, error\", params); // No data\n\n\t\t\t\t/* Set response in possible params */\n\t\t\t\tparams.response = params.data = response;\n\n\t\t\t\t/* User success function */\n\t\t\t\treturn ajaxCallbacks.fire(\"preSuccess, success, notAbort\", params);\n\n\t\t\t}.safe(),\n\t\t\terror: function(jqXHR, textStatus, errorThrown) {\n\n\t\t\t\t/* Defaults */\n\t\t\t\tlet type        = \"Unknown\",\n\t\t\t\t\terrorText   = \"     ,   \";\n\n\t\t\t\t/* Get error text according to response data */\n\t\t\t\tif(textStatus === \"abort\") {\n\t\t\t\t\ttype \t  = \"abort\";\n\t\t\t\t\terrorText = '  ';\n\t\t\t\t} else if(textStatus === 'parsererror') {\n\t\t\t\t\ttype \t  = \"parse\";\n\t\t\t\t\terrorText = \"    ,   , :<br/>\" + jqXHR.responseText;\n\t\t\t\t} else if(textStatus === 'timeout') {\n\t\t\t\t\ttype \t  = \"timeout\";\n\t\t\t\t\terrorText = '   ';\n\t\t\t\t} else if(jqXHR.status === 0) {\n\t\t\t\t\ttype \t  = \"stopped\";\n\t\t\t\t\terrorText = ' ,    ';\n\t\t\t\t} else if(codes[jqXHR.status]) {\n\t\t\t\t\ttype = jqXHR.status;\n\t\t\t\t\terrorText = '     <br/> ' + codes[jqXHR.status];\n\t\t\t\t}\n\n\t\t\t\t/* Possible params list */\n\t\t\t\tlet params = $.extend({\n\t\t\t\t\terror      : errorText,\n\t\t\t\t\ttype       : type,\n\t\t\t\t\tcode\t   : type,\n\t\t\t\t\tjqXHR      : jqXHR,\n\t\t\t\t\ttextStatus : textStatus,\n\t\t\t\t\tstatus     : textStatus,\n\t\t\t\t\terrorThrown: errorThrown,\n\t\t\t\t\tobject     : object\n\t\t\t\t}, callbackData);\n\n\t\t\t\t/* Execute callback */\n\t\t\t\tajaxCallbacks.fire(\"notSuccess\", params);\n\n\t\t\t\t/* Execute special ajaxCallbacks */\n\t\t\t\tajaxCallbacks.fire(textStatus === \"abort\" ? \"abort\" : \"error, notAbort\", params);\n\n\t\t\t}.safe()\n\n\t\t}, ajaxExtend));\n\n\t\t/* On always set */\n\t\tajaxCallbacks.ajax.promise().always(function(jqXHR, textStatus, errorThrown) {\n\n\t\t\t/* Unlock objects */\n\t\t\tif(object)\n\t\t\t\tobject.enable();\n\n\t\t\t/* Always callback */\n\t\t\tajaxCallbacks.fire(\"always\", { errorThrown: errorThrown, textStatus: textStatus, jqXHR: jqXHR, object: object});\n\n\t\t}.safe());\n\n\t\treturn ajaxCallbacks;\n\n\t};\n\n\t/**\n\t * Contains http codes\n\t */\n\tlet codes = {\n\n\t\t/* Request errors */\n\t\t400: \" \",\n\t\t401: \"    \",\n\t\t402: \"     \",\n\t\t403: \"   \",\n\t\t404: \"          \",\n\t\t405: \"   HTTP\",\n\t\t406: \" \",\n\t\t407: \"  \",\n\t\t408: \"  \",\n\t\t409: \"\",\n\t\t410: \" \",\n\t\t411: \"    \",\n\t\t412: \" \",\n\t\t413: \"   \",\n\t\t414: \" URI  \",\n\t\t415: \"  \",\n\t\t416: \"   \",\n\t\t417: \" \",\n\t\t422: \" \",\n\t\t423: \" \",\n\t\t424: \" \",\n\t\t425: \" \",\n\t\t426: \" \",\n\t\t428: \" \",\n\t\t429: \"  \",\n\t\t431: \"    \",\n\t\t451: \"   \",\n\t\t456: \" \",\n\t\t499: \" Nginx,     \",\n\n\t\t/* Server error */\n\t\t500: \"  \",\n\t\t501: \" \",\n\t\t502: \"   \",\n\t\t503: \" \",\n\t\t504: \"  \",\n\t\t505: \" HTTP  \",\n\t\t506: \"   \",\n\t\t507: \" \",\n\t\t508: \" \",\n\t\t509: \"   \",\n\t\t510: \" \",\n\t\t511: \"  \"\n\n\t};\n\n});","/** Class to work with drop zone for File api */\nsky.service(\"ajaxFilesDropZone\", [\"supported\", \"callbacks\"], function({ supported, callbacks }) {\n\tthis.service = class {\n\t\tconstructor({ zone, data, url, options }) {\n\n\t\t\t/* Save options */\n\t\t\tthis.options   = options;\n\t\t\tthis.zone      = zone;\n\t\t\tthis.callbacks = callbacks();\n\t\t\tthis.data      = data;\n\t\t\tthis.url       = url;\n\t\t\tthis.files     = [];\n\n\t\t\t/* If no XHR supported, no file drop needed */\n\t\t\tif(!supported.XHRUpload) {\n\t\t\t\tthis.callbacks.fire(\"nonSupported\");\n\t\t\t\treturn this;\n\t\t\t}\n\n\t\t\t/* Bind events */\n\t\t\tthis.attachEvents();\n\n\t\t}\n\n\t\tattachEvents() {\n\n\t\t\t/* While over event */\n\t\t\tthis.zone.on({\n\n\t\t\t\tdragenter: (event) => { this.callbacks.fire(\"dragenter\", this, [event]); },\n\t\t\t\tdragleave: (event) => { this.callbacks.fire(\"dragleave\", this, [event]); },\n\t\t\t\tdragend  : (event) => { this.callbacks.fire(\"dragend\", this, [event]); \t },\n\t\t\t\tdrop     : (event) => { this.callbacks.fire(\"drop\", this, [event]);\t\t },\n\t\t\t\tdragover : (event) => {\n\n\t\t\t\t\t/* Get event */\n\t\t\t\t\tevent = event.originalEvent;\n\n\t\t\t\t\t/* Check if drag is valid */\n\t\t\t\t\tif(!this.isValidFileDrag(event))\n\t\t\t\t\t\treturn;\n\n\t\t\t\t\t/* Get effect */\n\t\t\t\t\tlet effect = event.dataTransfer.effectAllowed;\n\n\t\t\t\t\t/* Set proper */\n\t\t\t\t\tif(effect === 'move' || effect === 'linkMove') {\n\t\t\t\t\t\tevent.dataTransfer.dropEffect = 'move'; // for FF (only move allowed)\n\t\t\t\t\t} else {\n\t\t\t\t\t\tevent.dataTransfer.dropEffect = 'copy'; // for Chrome\n\t\t\t\t\t}\n\n\t\t\t\t\t/* Prevent */\n\t\t\t\t\tevent.preventDefault();\n\n\t\t\t\t}\n\t\t\t});\n\n\t\t\t/* Stop file opening when drop on browser window */\n\t\t\t$(document).bind({\n\t\t\t\tdragover : function(e) {\n\t\t\t\t\te = e.originalEvent;\n\t\t\t\t\tif(e.dataTransfer) {\n\t\t\t\t\t\te.dataTransfer.dropEffect = 'none';\n\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tdragenter: function(e) {\n\t\t\t\t\tif(typeof self.options.onStart !== \"undefined\")\n\t\t\t\t\t\tself.options.onStart.apply(self, [e]);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tstatic isValidFileDrag(event) {\n\n\t\t\tlet dt = event.dataTransfer,\n\t\t\t// do not check dt.types.contains in webkit, because it crashes safari 4\n\t\t\t\tisWebkit = navigator.userAgent.indexOf(\"AppleWebKit\") > -1;\n\n\t\t\t// dt.effectAllowed is none in Safari 5\n\t\t\t// dt.types.contains check is for firefox\n\t\t\treturn dt && dt.effectAllowed !== 'none' &&\n\t\t\t\t(dt.files || (!isWebkit && dt.types.contains && dt.types.contains('Files')));\n\n\t\t}\n\n\t};\n\n});","sky.service(\"ajaxFilesIFrame\", function() {\n\n\tlet AjaxFilesIFrame = function(options) {\n\n\t\t/* Save options */\n\t\tthis.options \t= options;\n\t\tthis.files    \t= options.files;\n\t\tthis.input   \t= options.input;\n\t\tthis.url  \t \t= options.url;\n\t\tthis.data \t \t= options.data;\n\t\tthis.callbacks \t= options.callbacks;\n\n\t};\n\n\tAjaxFilesIFrame.prototype = {\n\n\t\tgetName: function(name){\n\n\t\t\t// get input value and remove path to normalize\n\t\t\treturn name.replace(/.*(\\/|\\\\)/, \"\");\n\n\t\t},\n\n\t\tcancel: function(id){\n\n\t\t\tthis.options.onAbort(id, this.getName(this.input.value));\n\n\t\t\tthis.IFrame.setAttribute('src', 'javascript:false;').remove();\n\n\t\t},\n\n\t\t/**\n\t\t * Upload file function\n\t\t */\n\t\tsend: function() {\n\n\t\t\t/* letiables */\n\t\t\tlet self \t = this;\n\t\t\tlet input \t = this.input;\n\t\t\tlet fileName = this.getName(input.value);\n\n\t\t\t/* Create new input */\n\t\t\t$(input).clone().val(\"\").insertBefore(input);\n\n\t\t\t/* Create elements */\n\t\t\tthis.IFrame = this.createIframe();\n\t\t\tthis.form = this.createForm(this.IFrame, this.options.data).append(input);\n\n\t\t\tthis.attachLoadEvent(this.IFrame, function() {\n\n\t\t\t\tlet response = self.getIframeContentJSON(self.IFrame);\n\n\t\t\t\tif(response) self.options.onSuccess(response);\n\n\t\t\t\t// timeout added to fix busy state in FF3.6\n\t\t\t\tsetTimeout(function(){ self.IFrame.remove(); }, 1);\n\n\t\t\t});\n\n\t\t\tthis.form.trigger(\"submit\");\n\n\t\t},\n\n\t\t/**\n\t\t * Attach load event to IFrame\n\t\t */\n\t\tattachLoadEvent: function(iframe, callback){\n\n\t\t\tiframe.load(function(){\n\n\t\t\t\tif (!this.parentNode) return;\n\n\t\t\t\t// fixing Opera 10.53\n\t\t\t\tif (this.contentDocument &&\n\t\t\t\t\tthis.contentDocument.body &&\n\t\t\t\t\tthis.contentDocument.body.innerHTML === \"false\") return;\n\n\t\t\t\tcallback();\n\n\t\t\t});\n\n\t\t},\n\n\t\t/**\n\t\t * Returns json object received by IFrame from server.\n\t\t */\n\t\tgetIframeContentJSON: function(iframe){\n\n\t\t\t/* IFrame.contentWindow.document - for IE<7 */\n\t\t\tlet doc = iframe.get(0).contentDocument ? iframe.get(0).contentDocument: iframe.get(0).contentWindow.document;\n\n\t\t\tlet response = doc.body.innerHTML\n\n\t\t\t/* Check for empty response */\n\t\t\tif(response === \"\") {\n\t\t\t\tif(self.callbacks) self.callbacks.onError(\"  \"); // No data\n\t\t\t\treturn false;\n\t\t\t}\n\n\n\t\t\t/* Try to get json data */\n\t\t\ttry {\n\t\t\t\tresponse = jQuery.parseJSON(response);\n\t\t\t} catch(e) {\n\t\t\t\tif(self.callbacks) {\n\t\t\t\t\tself.callbacks.onError(\"  \"); // No data\n\t\t\t\t\tconsole.log(response);\n\t\t\t\t}\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\t/* If response returned with error */\n\t\t\tif(response.error) {\n\t\t\t\tif(self.callbacks) self.callbacks.onError(response.text); // Execute user error handler\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\treturn response;\n\t\t},\n\n\t\t/**\n\t\t * Creates IFrame with unique name\n\t\t */\n\t\tcreateIframe: function() {\n\n\t\t\treturn $('<IFrame/>', { src: \"javascript:false;\", name: \"uploadIFrame\" + Math.floor(Math.random()*1000000) }).css(\"display\", \"none\").appendTo('body');\n\n\t\t},\n\n\t\t/**\n\t\t * Creates form, that will be submitted to IFrame\n\t\t */\n\t\tcreateForm: function(iframe, params) {\n\n\t\t\tlet queryString = this.url + \"?\" + jQuery.param(params);\n\n\t\t\treturn $('<form/>', {\n\t\t\t\tmethod: \"post\", enctype: \"multipart/form-data\", action: queryString, target: iframe.attr(\"name\")\n\t\t\t}).css(\"display\", \"none\").appendTo('body');\n\n\t\t}\n\n\t};\n\n});","/**\n * Module to work with ajax file upload\n */\nsky.service(\"ajaxFiles\", [\"supported\", \"callbacks\", \"ajaxFilesXHR\", \"ajaxFilesIFrame\"], function({ callbacks, supported, ajaxFilesXHR, ajaxFilesIFrame }) {\n\n\t/**\n\t * Class to work with dynamic file upload\n\t * @param {html|string} input Input to be used to upload\n\t * @param {string} url Url to upload\n\t * @param {object} data Data to be send with request\n\t */\n\tlet AjaxFiles = this.service = function(input, url, data) {\n\n\t\t/* Self construct */\n\t\tif(!(this instanceof AjaxFiles))\n\t\t\treturn new AjaxFiles(input, url, data);\n\n\t\t/* Save items */\n\t\tthis.inputs \t= $(input);\n\t\tthis.url   \t\t= url;\n\t\tthis.data  \t\t= data;\n\t\tthis.callbacks \t= callbacks();\n\t\tthis.files\t\t= [];\n\n\t\t/**\n\t\t * Function to handle file input change\n\t\t */\n\t\tthis.saveFiles = function(input) {\n\n\t\t\t/* Get files list */\n\t\t\tif(supported.XHRUpload) {\n\n\t\t\t\t/* Get files from event */\n\t\t\t\tlet files = input.get(0).files;\n\n\t\t\t\t/* Save them to this */\n\t\t\t\tfor(let file of files)\n\t\t\t\t\tthis.files.push({ file: file, input: input, inputName: input.attr(\"name\") });\n\n\t\t\t} else this.files.push(input.get(0));\n\n\t\t};\n\n\t\t/**\n\t\t * Sends ajax files\n\t\t * @param {bool} parallel If try files would be send in parallel\n\t\t * @returns {*}\n\t\t */\n\t\tthis.send = function(parallel) {\n\n\t\t\t/* Clear */\n\t\t\tthis.files = [];\n\n\t\t\t/* Get files list */\n\t\t\tthis.inputs.each((_, input) => { this.saveFiles($(input)); });\n\n\t\t\t/* If no files */\n\t\t\tif(!this.files.length)\n\t\t\t\treturn false;\n\n\t\t\t/* Create supported handler */\n\t\t\tlet handler;\n\t\t\tif(supported.XHRUpload)\n\t\t\t\thandler = new ajaxFilesXHR(this);\n\t\t\telse\n\t\t\t\thandler = new ajaxFilesIFrame(this);\n\n\t\t\t/* Send files */\n\t\t\tif(parallel)\n\t\t\t\tthis.sendParallel(handler);\n\t\t\telse\n\t\t\t\tthis.sendConsequentially(handler);\n\n\t\t\t/* return send handler */\n\t\t\treturn handler;\n\n\t\t};\n\n\t\t/**\n\t\t * Sends files consequentially\n\t\t * @param handler\n\t\t */\n\t\tthis.sendConsequentially = function(handler) {\n\n\t\t\t/* First id */\n\t\t\tlet id = 0;\n\n\t\t\t/* Set sending next after this one */\n\t\t\tthis.callbacks.on(\"always\", () => {\n\t\t\t\tid++;\n\t\t\t\tif(this.files[id])\n\t\t\t\t\thandler.send(this.files[id]);\n\t\t\t});\n\n\t\t\t/* Send first */\n\t\t\thandler.send(self.files[id]);\n\n\t\t};\n\n\t\t/**\n\t\t * Sends files parallel\n\t\t * @param handler\n\t\t */\n\t\tthis.sendParallel = function(handler) {\n\n\t\t\t/* Send files through them */\n\t\t\tfor(let file of this.files)\n\t\t\t\thandler.send(file);\n\n\t\t};\n\n\t\t/* Self return */\n\t\treturn this;\n\n\t};\n\n\t/**\n\t * Performs default file send\n\t * @param {string} url\n\t * @param element\n\t * @param data\n\t */\n\tAjaxFiles.defaultSend = function(url, element, data) {\n\n\t\t// Get input\n\t\tlet input = element.is(\"input[type=file]\") ? element : element.closest(\"label, .label\").find(\"input[type=file]\"),\n\t\t\texceptions = sky.service(\"exceptions\"),\n\t\t\ttemplates = sky.service(\"templates\"),\n\t\t\tnotifications = sky.service(\"notifications\"),\n\t\t\twindows = sky.service.windows(\"windows\");\n\n\t\t// Check\n\t\tif(!input.length)\n\t\t\tthrow new exceptions.system.Error(\"No proper input provided for file send\");\n\n\t\t// Init\n\t\tlet filesAjax = AjaxFiles(input, url, data),\n\t\t\tmodal = windows.getLast(),\n\t\t\tcurrentFile;\n\n\t\t/*  Bind events */\n\t\tfilesAjax.callbacks\n\t\t\t.on(\"begin\", function (file) {\n\t\t\t\tif(modal) {\n\t\t\t\t\tmodal.holder.find(\".preview\").remove();\n\t\t\t\t\tmodal.lock();\n\t\t\t\t}\n\t\t\t\tcurrentFile = templates.render(\"files-single-upload\", file).insertAfter(element.parent());\n\t\t\t})\n\t\t\t.on(\"always\", function () {\n\t\t\t\tcurrentFile.remove();\n\t\t\t\tif(modal)\n\t\t\t\t\tmodal.unlock();\n\t\t\t})\n\t\t\t.on(\"notSuccess\", function (error) {\n\t\t\t\tmodal.clearExceptTemplate();\n\t\t\t\tnotifications.message({text: error}).appendToModal(modal);\n\t\t\t})\n\t\t\t.on(\"progress\", function (totalPercent, percent) {\n\t\t\t\tcurrentFile.find(\".total\").html(percent + \"%\");\n\t\t\t\tcurrentFile.find(\".progressBar div\").css(\"width\", percent + \"%\");\n\n\t\t\t\t// If loaded\n\t\t\t\tif (percent === 100)\n\t\t\t\t\tcurrentFile.find(\".total\").html(\"100%, \");\n\n\n\t\t\t})\n\t\t\t.on(\"start\", function () {\n\n\t\t\t});\n\n\t\t/* Send */\n\t\tfilesAjax.send();\n\t\treturn filesAjax;\n\n\t};\n\n});","/** Sends file data via HttpRequest */\nsky.service(\"ajaxFilesXHR\", [\"supported\", \"ajax\", \"stackList\"], function({supported, ajax, stackList}) {\n\tthis.service = class {\n\t\tconstructor(options) {\n\n\t\t\t/* Save options */\n\t\t\tthis.options \t\t= options;\n\t\t\tthis.files \t\t\t= options.files;\n\t\t\tthis.input \t\t\t= options.input;\n\t\t\tthis.url \t\t\t= options.url;\n\t\t\tthis.data \t\t\t= options.data;\n\t\t\tthis.callbacks \t\t= options.callbacks;\n\t\t\tthis.toProceed \t\t= options.files.length;\n\t\t\tthis.inProgress \t= 0;\n\t\t\tthis.total \t\t\t= options.files.length;\n\t\t\tthis.totalLoaded \t= 0;\n\t\t\tthis.totalSize \t\t= 0;\n\t\t\tthis.totalPercent \t= 0;\n\t\t\tthis.current \t\t= 0;\n\t\t\tthis.fileRequests \t= stackList();\n\n\t\t\t/* Go through */\n\t\t\tfor(file of options.files)\n\t\t\t\tthis.totalSize += file.size;\n\n\t\t}\n\n\t\t/**\n\t\t * Get file name\n\t\t * @param {*} file File\n\t\t * @returns {string}\n\t\t */\n\t\tstatic getName(file) {\n\t\t\treturn file.name.replace(/.*(\\/|\\\\)/, \"\");\n\t\t}\n\n\t\t/**\n\t\t * Uploads file\n\t\t * @param {*} file File name in files stack\n\t\t */\n\t\tsend(file) {\n\n\t\t\t/* This obj will store data associated with XHR */\n\t\t\t$.extend(file, {\n\t\t\t\tid     : Math.random(),\n\t\t\t\tname   : this.getName(file.file),\n\t\t\t\tsize   : file.file.size,\n\t\t\t\tajax   : false,\n\t\t\t\tpercent: false,\n\t\t\t\tloaded : 0\n\t\t\t});\n\n\t\t\t/* Prepare params */\n\t\t\tlet self        = this,\n\t\t\t\tparams      = this.data || {},\n\t\t\t\tqueryString = this.url + \"?ajaxFile=\" + file.name + \"&\" + jQuery.param(params);\n\n\t\t\t/**\n\t\t\t * Params extend\n\t\t\t * @param {object} args Object to be extended\n\t\t\t * @returns {*}\n\t\t\t */\n\t\t\tthis.extend = function(args) {\n\t\t\t\treturn jQuery.extend(args, {\n\t\t\t\t\ttotalLoaded : self.totalLoaded,\n\t\t\t\t\ttotalSize   : self.totalSize,\n\t\t\t\t\ttotalPercent: self.totalPercent,\n\t\t\t\t\tfile        : file,\n\t\t\t\t\tloaded      : file.loaded,\n\t\t\t\t\tsize        : file.size,\n\t\t\t\t\tpercent     : file.percent,\n\t\t\t\t\ttoProceed   : self.toProceed,\n\t\t\t\t\tcurrent     : self.current,\n\t\t\t\t\ttotal       : self.total\n\t\t\t\t});\n\t\t\t};\n\n\t\t\t/* Send */\n\t\t\tif(supported.formData) {\n\n\t\t\t\t/* Create form data sender */\n\t\t\t\tlet form = new FormData();\n\t\t\t\tform.append(file.inputName, file.file);\n\n\t\t\t\t/* Send start */\n\t\t\t\tfile.ajax = ajax(queryString, form, { ajaxExtend: {\n\t\t\t\t\t\tprocessData: false,\n\t\t\t\t\t\tcontentType: false,\n\t\t\t\t\t\ttype       : \"POST\",\n\t\t\t\t\t\txhr        : (() => {\n\t\t\t\t\t\t\ttry {\n\n\t\t\t\t\t\t\t\t/* Create XHR */\n\t\t\t\t\t\t\t\tlet xhr = new XMLHttpRequest();\n\n\t\t\t\t\t\t\t\t/* Set special upload api handlers */\n\t\t\t\t\t\t\t\txhr.upload[\"onloadstart\"] = function() {\n\t\t\t\t\t\t\t\t\tthis.inProgress++;\n\t\t\t\t\t\t\t\t\tthis.callbacks.fire(\"begin\", this.extend({}));\n\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t\txhr.upload[\"onprogress\"] = function(event) {\n\t\t\t\t\t\t\t\t\tthis.totalLoaded += event.loaded - file.loaded;\n\t\t\t\t\t\t\t\t\tthis.totalPercent = (this.totalLoaded / this.totalSize * 100).toFixed(0);\n\t\t\t\t\t\t\t\t\tthis.onProgress(event, file);\n\t\t\t\t\t\t\t\t};\n\n\t\t\t\t\t\t\t\t/* Return create XHR */\n\t\t\t\t\t\t\t\treturn xhr;\n\n\t\t\t\t\t\t\t} catch(e) {\n\t\t\t\t\t\t\t\treturn undefined;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}).safe()\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t} else {\n\n\t\t\t\t/* Send start */\n\t\t\t\tfile.ajax = ajax(queryString, file.file, {\n\t\t\t\t\tprocessData: false,\n\t\t\t\t\tcontentType: false,\n\t\t\t\t\ttype       : \"POST\",\n\t\t\t\t\tbeforeSend : sky.func(function(jqXHR) {\n\t\t\t\t\t\tjqXHR.setRequestHeader(\"X-Requested-With\", \"XMLHttpRequest\");\n\t\t\t\t\t\tjqXHR.setRequestHeader(\"X-File-Name\", encodeURI(file.name));\n\t\t\t\t\t\tjqXHR.setRequestHeader(\"Content-Type\", \"multipart/form-data\");\n\t\t\t\t\t\tjqXHR.setRequestHeader(\"Content-Disposition\", 'attachment; filename=\"' + encodeURI(file.name) + '\"');\n\t\t\t\t\t\tjqXHR.setRequestHeader(\"Accept\", \"text/html,application/xhtml+xml,application/xml;q=0.9\");\n\t\t\t\t\t})\n\t\t\t\t});\n\n\t\t\t}\n\n\t\t\t/* Set ajax callbacks */\n\t\t\tfile.ajax.on({\n\t\t\t\tsuccess:\t(all) => { this.callbacks.fire(\"success\", this.extend(all)); },\n\t\t\t\terror: \t\t(all) => { this.callbacks.fire(\"error\", this.extend(all)); },\n\t\t\t\tnotSuccess: (all) => { this.callbacks.fire(\"notSuccess\", this.extend(all)); },\n\t\t\t\talways: \t(all) => {\n\n\t\t\t\t\t/* Counters */\n\t\t\t\t\tthis.inProgress--;\n\t\t\t\t\tthis.toProceed--;\n\n\t\t\t\t\t/* Call always method */\n\t\t\t\t\tthis.callbacks.fire(\"always\", this.extend(all));\n\n\t\t\t\t\t/* Delete connection */\n\t\t\t\t\tthis.fileRequests.delete(file);\n\n\t\t\t\t}\n\t\t\t});\n\n\t\t\t/* Save */\n\t\t\tthis.fileRequests.add(file);\n\n\t\t}\n\n\t\t/**\n\t\t * Fores on progress change\n\t\t * @param event\n\t\t * @param fileRequestData\n\t\t */\n\t\tonProgress(event, fileRequestData) {\n\n\t\t\t/* Count percentage */\n\t\t\tlet percent = (event.loaded / event[\"total\"] * 100).toFixed(0);\n\t\t\tfileRequestData.loaded = event.loaded;\n\n\t\t\t/* If percent changed */\n\t\t\tif(percent !== fileRequestData.percent && event[\"lengthComputable\"]) {\n\t\t\t\tfileRequestData.percent = percent;\n\t\t\t\tthis.callbacks.fire(\"progress\", this.extend({}));\n\t\t\t}\n\n\t\t}\n\n\t\t/**\n\t\t * Aborts current download\n\t\t */\n\t\tabort() {\n\n\t\t\t/* Stop each request */\n\t\t\tthis.fileRequests.each(request => { request.ajax.stop() });\n\n\t\t\t/* Call always method */\n\t\t\tthis.callbacks.fire(\"abort\", this.extend({}));\n\n\t\t}\n\n\t};\n\n});","sky.service(\"ajaxLoadingIndicator\", [\"stackList\"], function({ stackList }) {\n\n\tlet loadings = stackList();\n\n\t/**\n\t * Loading\n\t */\n\tclass Loading {\n\t\tconstructor(ajax, global = true) {\n\n\t\t\t/* List save */\n\t\t\tloadings.add(this);\n\n\t\t\t/* Back link */\n\t\t\tthis.global = global;\n\n\t\t\t/* Render */\n\t\t\tthis.render = $('<div/>').html('<div></div>').addClass(\"ajaxLoading\");\n\n\t\t\t/* Global insert */\n\t\t\tif(this.global)\n\t\t\t\tthis.render.addClass(\"fixed\").appendTo(\"body\");\n\n\t\t\t/* If stop possible */\n\t\t\tif(ajax) {\n\t\t\t\t$(\"<span/>\").appendTo(this.render.addClass(\"cancelable\")).click(function() {\n\t\t\t\t\tajax.stop();\n\t\t\t\t});\n\t\t\t\tajax.on(\"always\", () => this.hide());\n\t\t\t}\n\n\t\t\t/* Callbacks */\n\t\t\tthis.events = callbacks();\n\n\t\t}\n\n\t\t/**\n\t\t * Loads loading in modal window\n\t\t * @param {object} modal Window\n\t\t */\n\t\tinModalWindow(modal) {\n\n\t\t\t/* Hide */\n\t\t\tlet content = modal.holder.children().hide();\n\n\t\t\t/* Insert */\n\t\t\tthis.render.appendTo(modal.holder);\n\n\t\t\t/* Restore on hide */\n\t\t\tthis.events.on(\"hide\", () => content.show());\n\n\t\t}\n\n\t\t/**\n\t\t *\n\t\t * @param contentHolder\n\t\t */\n\t\treloadContent(contentHolder) {\n\n\t\t\tthis.setHolder(contentHolder);\n\n\t\t\t/* If no holder */\n\t\t\tif(!this.holder.length)\n\t\t\t\treturn;\n\n\t\t\t/* Get children */\n\t\t\tlet content = this.holder.children();\n\n\t\t\t/* Different content disable */\n\t\t\tif(this.global) {\n\n\t\t\t\t/* Disable content */\n\t\t\t\tcontent.disable();\n\n\t\t\t\t/* Make sizes calculator */\n\t\t\t\tthis.calc = visibleCalculator(contentHolder, this.render.outerHeight(), \"body\");\n\n\t\t\t\t/* Re enable */\n\t\t\t\tthis.events.on(\"hide\", () => {\n\t\t\t\t\tcontent.enable();\n\t\t\t\t\t$(window).off(\"scroll.notification\");\n\t\t\t\t});\n\n\t\t\t\t/* Bind scroll handler */\n\t\t\t\t$(window).on(\"scroll.notification\", () => {\n\t\t\t\t\tlet position = this.calc.calculate();\n\t\t\t\t\tthis.render.css({\n\t\t\t\t\t\tleft: position.left + (position.width) / 2,\n\t\t\t\t\t\ttop : position.top + (position.height) / 2\n\t\t\t\t\t})\n\t\t\t\t}).trigger(\"scroll\");\n\n\t\t\t} else {\n\n\t\t\t\t/*  Hide */\n\t\t\t\tcontent.hide();\n\n\t\t\t\t/* Insert */\n\t\t\t\tthis.render.appendTo(this.holder);\n\n\t\t\t\t/* Re enable */\n\t\t\t\tthis.events.on(\"hide\", function() {\n\t\t\t\t\tcontent.show();\n\t\t\t\t});\n\t\t\t}\n\n\t\t\treturn this;\n\n\t\t}\n\n\t\tsetHolder(holder) {\n\n\t\t\t/* Append and save */\n\t\t\tthis.holder = $(holder).addClass(\"withLoading\").append(this.render);\n\n\t\t\t/* Self return */\n\t\t\treturn this;\n\n\t\t}\n\n\t\t/**\n\t\t * Hides current loading\n\t\t */\n\t\thide() {\n\n\t\t\tif(this.holder)\n\t\t\t\tthis.holder.removeClass(\"withLoading\");\n\n\t\t\tthis.render.remove();\n\t\t\tthis.events.fire(\"hide\");\n\n\t\t\t/* Remove from list */\n\t\t\tloadings.remove(this);\n\n\t\t}\n\t}\n\n\tthis.service = {\n\t\tloading: (ajax, global = true) => new Loading(ajax, global),\n\t}\n\n});","sky.service(\"calendar\", [ \"templates\", \"visibleCalculator\" ], function ({ templates, visibleCalculator }) {\n\n\t/* This class is for showing calendar to pick date on page */\n\tlet calendar = {\n\n\t\t/* Days set */\n\t\tmonthsNames: window.page.data.monthsNames || [\"\", \"\", \"\", \"\", \"\", \"\", \"\", \"\", \"\", \"\", \"\", \"\"],\n\n\t\trenderDays: function () {\n\n\t\t\t/* Clone */\n\t\t\tlet current = moment(this.date),\n\t\t\t\tweeks = [],\n\t\t\t\tcurrentWeek = false;\n\n\t\t\t/* From first */\n\t\t\tcurrent.date(1);\n\n\t\t\t/* Go through */\n\t\t\twhile (current.month() === this.date.month()) {\n\n\t\t\t\t/* Make week if new */\n\t\t\t\tif (!currentWeek || current.day() === 1) {\n\t\t\t\t\tcurrentWeek = {number: current.isoWeek(), days: []};\n\t\t\t\t\tweeks.push(currentWeek);\n\t\t\t\t}\n\n\t\t\t\t/* Push */\n\t\t\t\tcurrentWeek.days.push({date: current.clone(), dateStr: current.format(\"YYYY.MM.DD\"), day: current.day() === 0 ? 6 : current.day() - 1});\n\n\t\t\t\t/* Go next day */\n\t\t\t\tcurrent.add(1, \"d\");\n\n\t\t\t}\n\n\t\t\t/* Render */\n\t\t\tthis.dates.html('').append(templates.render(\"calendar-dates\", {\n\t\t\t\tweeks: weeks,\n\t\t\t\tdateStr: this.date.format(\"YYYY.MM.DD\"),\n\t\t\t\tcurrent: this.date,\n\t\t\t\tperiod: this.period,\n\t\t\t\tsince: this.since,\n\t\t\t\ttill: this.till\n\t\t\t}));\n\n\t\t\t/* Render */\n\t\t\tthis.setTime();\n\n\t\t},\n\n\t\t/**\n\t\t * When user picks date\n\t\t * @param {*} dayDiv Div that user clicked, if he did\n\t\t * @param notClose\n\t\t */\n\t\tdayPick: function (dayDiv, notClose) {\n\n\t\t\t/* Set date */\n\t\t\tif (dayDiv)\n\t\t\t\tthis.date.date(parseInt(dayDiv.html()));\n\n\t\t\tthis.field.val(this.getInputValue()).trigger(\"change\").trigger(\"keyup\");\n\t\t\tif (!notClose) this.close();\n\n\t\t},\n\n\t\tgetInputValue: function () {\n\n\t\t\t/* Get field new value */\n\t\t\tif (this.useTime)\n\t\t\t\treturn this.date.format(\"DD.MM.YYYY HH:mm\");\n\t\t\telse if (this.period && this.since.isSame(this.till))\n\t\t\t\treturn this.since.format(\"DD.MM.YYYY\");\n\t\t\telse if (this.period)\n\t\t\t\treturn this.since.format(\"DD.MM.YYYY\") + ' - ' + this.till.format(\"DD.MM.YYYY\");\n\n\t\t\t/* Default */\n\t\t\treturn this.date.format(\"DD.MM.YYYY\");\n\n\t\t},\n\n\t\tsetDayPick: function () {\n\t\t\tthis.pickedDateView.html(this.getInputValue());\n\t\t},\n\n\t\t/**\n\t\t * Position date picker\n\t\t * @param {*} field Item that we should position under\n\t\t */\n\t\tposition: function (field) {\n\n\t\t\tthis.holder.insertAfter(field.parent()).css(\"position\", \"absolute\");\n\n\t\t\tlet calculator = new visibleCalculator(field),\n\t\t\t\toffset = calculator.getDropOffset(field, this.holder);\n\n\t\t\tthis.holder.css({\n\t\t\t\tmarginTop: offset.top,\n\t\t\t\tmarginLeft: offset.left\n\t\t\t});\n\n\t\t},\n\n\t\t/**\n\t\t * Sets time inputs in calendar values\n\t\t */\n\t\tsetTime: function () {\n\n\t\t\t/* Set time */\n\t\t\tthis.holder.find(\".time .hour\").val(this.date.format(\"HH\"));\n\t\t\tthis.holder.find(\".time .minute\").val(this.date.format(\"mm\"));\n\n\t\t},\n\n\t\tperiodChangeDay: function () {\n\n\t\t\tlet reset = function () {\n\t\t\t\tcalendar.since = calendar.date.clone();\n\t\t\t\tcalendar.till = calendar.date.clone();\n\t\t\t\tcalendar.lastModified = \"none\"\n\t\t\t};\n\n\t\t\tif (this.date.isBefore(this.since)) {\n\t\t\t\tif (this.lastModified !== \"since\") {\n\t\t\t\t\tthis.since = this.date.clone();\n\t\t\t\t\tthis.lastModified = \"since\"\n\t\t\t\t}\n\t\t\t\telse reset();\n\t\t\t} else if (this.date.isAfter(this.till)) {\n\t\t\t\tif (this.lastModified !== \"till\") {\n\t\t\t\t\tthis.till = this.date.clone();\n\t\t\t\t\tthis.lastModified = \"till\"\n\t\t\t\t}\n\t\t\t\telse reset();\n\t\t\t} else if (this.date.isSame(this.till) || this.date.isSame(this.since))\n\t\t\t\treset();\n\t\t\telse {\n\t\t\t\tif (this.lastModified === \"since\") {\n\t\t\t\t\tthis.till = this.date.clone();\n\t\t\t\t\tthis.lastModified = \"till\"\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tthis.since = this.date.clone();\n\t\t\t\t\tthis.lastModified = \"since\"\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tcalendar.markSelected();\n\n\t\t},\n\n\t\tmarkSelected: function () {\n\n\t\t\tthis.dates.find(\".day\").removeClass(\"selected\").removeClass(\"subSelected\").each(function () {\n\n\n\t\t\t\tlet element = $(this),\n\t\t\t\t\tdate = calendar.date.clone().date(parseInt(element.html()));\n\n\t\t\t\tif (!calendar.period) {\n\t\t\t\t\tif (date.format(\"DD.MM.YYYY\") === calendar.date.format(\"DD.MM.YYYY\"))\n\t\t\t\t\t\telement.addClass(\"subSelected\");\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (date.isAfter(calendar.since) && date.isBefore(calendar.till))\n\t\t\t\t\telement.addClass(\"subSelected\");\n\t\t\t\telse if (date.isSame(calendar.since) || date.isSame(calendar.till))\n\t\t\t\t\telement.addClass(\"selected\");\n\n\t\t\t});\n\n\t\t},\n\n\t\t/**\n\t\t * Changes day\n\t\t * @param {*} element Day picker\n\t\t * @returns {undefined}\n\t\t */\n\t\tchangeDay: function (element) {\n\n\t\t\t/* If pick today */\n\t\t\tthis.date.date(parseInt(element.html()));\n\n\t\t\t/* No more for period */\n\t\t\tif (this.period) {\n\t\t\t\tthis.periodChangeDay();\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tcalendar.markSelected();\n\n\t\t\t/* Set time */\n\t\t\tif (this.field.attr(\"name\") === \"since\")\n\t\t\t\tthis.date.hour(0).minute(0);\n\t\t\telse if (this.date.format(\"DD-MM-YYYY\") === moment().format(\"DD-MM-YYYY\"))\n\t\t\t\tthis.date.hour(moment().hour()).minute(moment().minute());\n\t\t\telse\n\t\t\t\tthis.date.hour(23).minute(59);\n\n\t\t\t/* Pick */\n\t\t\tif (this.useTime)\n\t\t\t\tthis.setTime();\n\n\t\t},\n\n\t\t/**\n\t\t * Sets specified year\n\t\t * @param {int} year Year that need to be set\n\t\t */\n\t\tchangeYear: function (year) {\n\n\t\t\t/* Set year */\n\t\t\tthis.date.year(year);\n\n\t\t\t/* Update */\n\t\t\tthis.yearView.html(year);\n\n\t\t\t/* Dates redraw */\n\t\t\tthis.renderDays();\n\n\t\t},\n\n\t\t/**\n\t\t * Sets specified month\n\t\t * @param {int} month Month to be set\n\t\t */\n\t\tchangeMonth: function (month) {\n\n\t\t\t/* Set year */\n\t\t\tthis.date.month(month);\n\n\t\t\t/* Updates */\n\t\t\tthis.monthView.html(this.monthsNames[this.date.month()] + ' ' + this.date.year());\n\n\t\t\t/* Reload year */\n\t\t\tthis.changeYear(this.date.year());\n\n\t\t},\n\n\t\tgetDatePeriod: function (dateString) {\n\n\t\t\t// Split and get since\n\t\t\tlet parts = dateString.split('-'),\n\t\t\t\ttill,\n\t\t\t\tsince = this.getDate(parts[0].trim());\n\n\t\t\t// Get till\n\t\t\tif (parts.length > 1)\n\t\t\t\ttill = this.getDate(parts[1].trim());\n\t\t\telse\n\t\t\t\ttill = this.getDate(parts[0].trim());\n\n\t\t\t// Set inner lets\n\t\t\tthis.since = since;\n\t\t\tthis.till = till;\n\t\t\tthis.date = since.clone();\n\n\t\t},\n\n\t\t/**\n\t\t * Creates today date\n\t\t */\n\t\tgetDate: function (dateString) {\n\n\t\t\t/* Set calendar date */\n\t\t\tlet date = false;\n\n\t\t\t/* If input has datetime format value */\n\t\t\tif (dateString.match(/^\\d{4}-\\d{2}-\\d{2} \\d{1,2}:\\d{1,2}$/))\n\t\t\t\tdate = moment(dateString, \"YYYY-MM-DD HH:mm\");\n\n\t\t\t/* Id input has date format value */\n\t\t\tif (dateString.match(/^\\d{4}-\\d{2}-\\d{2}$/))\n\t\t\t\tdate = moment(dateString, \"YYYY-MM-DD\");\n\n\t\t\t/* Id input has date format value */\n\t\t\tif (dateString.match(/^\\d{2}.\\d{2}.\\d{4}$/))\n\t\t\t\tdate = moment(dateString, \"DD.MM.YYYY\");\n\n\t\t\t/* Id input has date format value */\n\t\t\tif (dateString.match(/^\\d{2}.\\d{2}.\\d{4} \\d{2}:\\d{2}$/))\n\t\t\t\tdate = moment(dateString, \"DD.MM.YYYY HH:mm\");\n\n\t\t\t/*  If still no */\n\t\t\tif (!date) {\n\t\t\t\tdate = moment();\n\n\t\t\t\t/* Set time */\n\t\t\t\tif (this.field.attr(\"name\") === \"since\")\n\t\t\t\t\tdate.hour(0).minute(0);\n\t\t\t}\n\n\t\t\t/* Reset time */\n\t\t\tif (!this.useTime)\n\t\t\t\tdate.hour(0).minute(0);\n\n\t\t\t/* Additional check */\n\t\t\treturn this.date = date;\n\n\t\t},\n\n\t\t/**\n\t\t * Closes windows\n\t\t */\n\t\tclose: function () {\n\n\t\t\t/* Remove calendar */\n\t\t\tif (this.holder)\n\t\t\t\tthis.holder.remove();\n\n\t\t\t/* Unset */\n\t\t\tif (this.field) {\n\t\t\t\tthis.field.off(\"keyup.calendar\");\n\t\t\t\tthis.field = false;\n\t\t\t}\n\t\t}\n\t};\n\n\tlet show = function (field, showTime) {\n\n\t\t/* Remove old calendars */\n\t\tthis.close();\n\n\t\t/* Begins from current date */\n\t\tthis.field = field;\n\t\tthis.period = false;\n\t\tthis.useTime = showTime ? showTime : false;\n\t\t// this.lastPicked = \"none\";\n\n\t\tif (field.is(\"input.datePeriod\")) {\n\t\t\tthis.period = true;\n\t\t\tthis.getDatePeriod(field.val());\n\t\t} else\n\t\t\tthis.getDate(field.val());\n\n\t\t/* Render */\n\t\tthis.holder = templates.render(\"calendar\", this);\n\n\t\t/* Actions */\n\t\tthis.holder\n\n\t\t/* Months changer */\n\t\t\t.action(\"click\", \".month .next\", function (event) {\n\t\t\t\tevent.preventDefault();\n\t\t\t\tcalendar.changeMonth(calendar.date.month() + 1);\n\t\t\t})\n\t\t\t.action(\"click\", \".month .prev\", function (event) {\n\t\t\t\tevent.preventDefault();\n\t\t\t\tcalendar.changeMonth(calendar.date.month() - 1);\n\t\t\t})\n\n\t\t\t/* Years */\n\t\t\t.action(\"click\", \".year .next\", function (event) {\n\t\t\t\tevent.preventDefault();\n\t\t\t\tcalendar.changeYear(calendar.date.year() + 1);\n\t\t\t})\n\t\t\t.action(\"click\", \".year .prev\", function (event) {\n\t\t\t\tevent.preventDefault();\n\t\t\t\tcalendar.changeYear(calendar.date.year() - 1);\n\t\t\t})\n\t\t\t.action(\"click\", \".setNow\", function (event) {\n\t\t\t\tevent.preventDefault();\n\t\t\t\tcalendar.date = moment();\n\t\t\t\tcalendar.renderDays();\n\t\t\t\tcalendar.setTime();\n\t\t\t})\n\t\t\t.action(\"click\", \".setToday\", function (event) {\n\t\t\t\tevent.preventDefault();\n\t\t\t\tcalendar.date = moment();\n\t\t\t\tcalendar.date.hour(0);\n\t\t\t\tcalendar.date.minute(0);\n\t\t\t\tcalendar.renderDays();\n\t\t\t\tcalendar.setTime();\n\t\t\t})\n\t\t\t.action(\"click\", \".setWeek\", function (event) {\n\t\t\t\tevent.preventDefault();\n\t\t\t\tcalendar.date = moment();\n\t\t\t\tcalendar.date.subtract(7, \"d\");\n\t\t\t\tcalendar.renderDays();\n\t\t\t\tcalendar.setTime();\n\t\t\t})\n\n\t\t\t/* Day */\n\t\t\t.action(\"click\", \".dates .day\", function (event) {\n\t\t\t\tevent.preventDefault();\n\t\t\t\tlet self = $(this);\n\n\t\t\t\tif (self.is(\".selected\") && !calendar.period)\n\t\t\t\t\tcalendar.dayPick($(this));\n\t\t\t\telse {\n\t\t\t\t\tcalendar.changeDay($(this));\n\t\t\t\t\tcalendar.dayPick(false, true);\n\t\t\t\t}\n\t\t\t})\n\n\t\t\t/* Apply button */\n\t\t\t.action(\"click\", \".apply\", function (event) {\n\t\t\t\tevent.preventDefault();\n\t\t\t\tcalendar.dayPick();\n\t\t\t})\n\n\t\t\t/* Time */\n\t\t\t.action(\"click\", \".time a\", function (event) {\n\t\t\t\tevent.preventDefault();\n\t\t\t\tcalendar.date.hour(moment().hour());\n\t\t\t\tcalendar.date.minute(moment().minute());\n\t\t\t\tcalendar.setTime();\n\t\t\t})\n\t\t\t.action(\"keyup\", \".time .hour\", function () {\n\t\t\t\tcalendar.date.hour(this.value);\n\t\t\t})\n\t\t\t.action(\"keyup\", \".time .minute\", function () {\n\t\t\t\tcalendar.date.minute(this.value);\n\t\t\t});\n\n\n\t\t/* Close and containers */\n\t\tthis.dates = this.holder.find(\".dates\");\n\t\tthis.yearView = this.holder.find(\".year .value\");\n\t\tthis.monthView = this.holder.find(\".month .value\");\n\t\tthis.pickedDateView = this.holder.find(\".pickedDate\");\n\n\t\t/* Refresh days */\n\t\tthis.renderDays();\n\n\t\t/* Reposition */\n\t\tthis.position(field);\n\t\tthis.setDayPick();\n\n\t\t/* Auto change */\n\t\tthis.field.on(\"keyup.calendar\", function () {\n\t\t\tshow(field, showTime);\n\t\t});\n\n\t\tlet dateOriginal;\n\t\tthis.dates.on(\"touchstart\", function (event) {\n\n\t\t\tlet element = $(event.target);\n\t\t\tif (!element.is(\".day\")) return;\n\t\t\tdateOriginal = calendar.date.clone().date(parseInt(element.html()));\n\n\t\t}).on(\"touchmove\", function (event) {\n\n\t\t\t/* No original event */\n\t\t\tevent.preventDefault();\n\n\t\t\tlet element = document.elementFromPoint((event.clientX || event.originalEvent.touches[0].clientX), (event.clientY || event.originalEvent.touches[0].clientY));\n\t\t\telement = $(element);\n\n\t\t\tif (!element.is(\".day\")) return;\n\n\t\t\tlet date = dateOriginal.clone().date(parseInt(element.html()));\n\n\t\t\tif (date.isBefore(dateOriginal)) {\n\t\t\t\tcalendar.since = date.clone();\n\t\t\t\tcalendar.till = dateOriginal.clone();\n\t\t\t} else {\n\t\t\t\tcalendar.since = dateOriginal.clone();\n\t\t\t\tcalendar.till = date.clone();\n\t\t\t}\n\t\t\tcalendar.lastModified = \"none\";\n\t\t\tcalendar.markSelected();\n\t\t\t// $(this).trigger(\"click\");\n\n\t\t});\n\n\t}.bind(calendar);\n\n\t/* Return */\n\tthis.service = show;\n\n});\n\nsky.onReady(({calendar}) => {\n\n\t/* Calendar show */\n\t$(document).action(\"click.calendar\", function (event) {\n\n\t\t/* Get element */\n\t\tlet element = $(event.target || event.srcElement);\n\n\t\t/* Remove calendar */\n\t\tif (!element.is(\".calendar\") && !element.parents(\".calendar\").length)\n\t\t\t$(\".calendar\").remove();\n\n\t\t/* Calendar show */\n\t\tif (element.is(\"input.date\"))\n\t\t\tcalendar(element);\n\n\t\t/* Calendar show */\n\t\tif (element.is(\"input.datePeriod\"))\n\t\t\tcalendar(element, false, true);\n\n\t\t/* Calendar show */\n\t\tif (element.is(\"input.datetime\"))\n\t\t\tcalendar(element, true);\n\n\t\t/* Calendar show */\n\t\tif (element.is(\"input.datehour\"))\n\t\t\tcalendar(element, true);\n\n\t}).action(\"keydown.calendar\", function (event) {\n\t\tif (event.keyCode === 13) {\n\t\t\tlet calendars = $(\".calendar\");\n\t\t\tif (calendars.length) {\n\t\t\t\tcalendars.find(\".day.selected\").trigger(\"click\");\n\t\t\t\tevent.preventDefault();\n\t\t\t}\n\t\t}\n\t});\n});","sky.service(\"callback\", function() {\n\n\t/**\n\t * Creates callback object that holds functions list\n\t * @param {string} [flags]\n\t * @returns {*}\n\t * @constructor\n\t */\n\tlet Callback = function(flags) {\n\n\t\t/* Self construct */\n\t\tif(!(this instanceof Callback))\n\t\t\treturn new Callback(flags);\n\n\t\t/**\n\t\t * Functions list holder\n\t\t * @type {Array}\n\t\t */\n\t\tthis.functions = [];\n\t\tthis.toRun =  0;\n\t\tthis.context = this;\n\n\t\t/* Self return for next usage */\n\t\treturn this;\n\n\t};\n\n\t/**\n\t * Base\n\t * @type {{functions: Array, toRun: number, context: *, add: add, removeByContext: removeByContext, fire: fire, fireNext: fireNext}}\n\t */\n\tCallback.prototype = {\n\n\t\t/**\n\t\t * Adds new function to stack\n\t\t * @param {Function} func Function to add\n\t\t * @param {Object} context Function context\n\t\t * @param {Object} options Call options\n\t\t */\n\t\tadd: function(func, context, options) {\n\t\t\tthis.functions.push({\n\t\t\t\tfunc: func,\n\t\t\t\tcontext: context || false,\n\t\t\t\tonce: options && options.once\n\t\t\t});\n\t\t\treturn this;\n\t\t},\n\n\t\t/**\n\t\t * Removes function from list by context\n\t\t * @param context\n\t\t */\n\t\tremoveByContext: function(context) {\n\n\t\t\t/* Find listener */\n\t\t\tlet i;\n\t\t\tfor(i in this.functions)\n\t\t\t\tif(this.functions[i].context === context)\n\t\t\t\t\tthis.functions.splice(i, 1);\n\n\t\t\t/* Self return */\n\t\t\treturn this;\n\n\t\t},\n\n\t\t/**\n\t\t * Removes function from list by context\n\t\t * @param func\n\t\t */\n\t\tremoveByCallback: function(func) {\n\n\t\t\t/* Find listener */\n\t\t\tlet i;\n\t\t\tfor(i in this.functions)\n\t\t\t\tif(this.functions[i].func === func)\n\t\t\t\t\tthis.functions.splice(i, 1);\n\n\t\t\t/* Self return */\n\t\t\treturn this;\n\n\t\t},\n\n\t\t/**\n\t\t * Fires all functions\n\t\t * @param {Object} context Function context\n\t\t * @param {Array} args Arguments\n\t\t */\n\t\tfire: function(context, args) {\n\t\t\tfor(let func of this.functions)\n\t\t\t\tfunc.func.apply(func.context || context, args);\n\t\t},\n\n\t\t/**\n\t\t * Fires next function\n\t\t * @param {Array|Object} args Arguments\n\t\t * @param {Object} context Function context\n\t\t */\n\t\tfireNext: function(args, context) {\n\n\t\t\t/* If no more to run */\n\t\t\tif(this.functions.length <= this.toRun)\n\t\t\t\treturn false;\n\n\t\t\t/* Set next to run */\n\t\t\tthis.toRun++;\n\n\t\t\t/* Function to run */\n\t\t\tlet current = this.functions[this.toRun - 1],\n\t\t\t\tresult,\n\t\t\t\tfunc = current.func;\n\n\t\t\t/* Set context */\n\t\t\tcontext = current.context || context || window;\n\n\t\t\t/* Get function in string */\n\t\t\tif(typeof func === \"string\")\n\t\t\t\tfunc = context[func];\n\n\t\t\t/* If no function found */\n\t\t\tif(!func)\n\t\t\t\treturn true;\n\n\t\t\t/* Call function */\n\t\t\tresult =  func.apply(current.context || context, args) !== false;\n\n\t\t\t/* If call once */\n\t\t\tif(current.once) {\n\t\t\t\tthis.functions.splice(this.toRun - 2, 1);\n\t\t\t\tthis.toRun--;\n\t\t\t}\n\n\t\t\t/* Return function result */\n\t\t\treturn result;\n\t\t}\n\n\t};\n\n\tthis.service = Callback;\n\n});","sky.service(\"callbacks\", [\"callback\"], function({ callback }) {\n\n\t/**\n\t *\n\t * Callbacks prepared object\n\t * @param {*} [flags] Flags list for jQuery.Callbacks\n\t * @constructor\n\t */\n\tlet Callbacks = function(flags) {\n\n\t\t/* Self construction */\n\t\tif(!(this instanceof Callbacks))\n\t\t\treturn new Callbacks(flags);\n\n\t\t/* Add properties */\n\t\t$.extend(true, this, Callbacks.extend);\n\n\t\t/* Callbacks list */\n\t\tthis.advancedCallbacks = {};\n\n\t\t/* Set default flags and self context */\n\t\treturn this.flags(flags);\n\n\t};\n\n\t/**\n\t * Prototype\n\t * @type {{on: on, fire: fire, off: off, flags: flags, setContext: setContext}}\n\t */\n\tCallbacks.prototype = {\n\n\t\t\t/**\n\t\t\t * Flags for sky.Callback\n\t\t\t * @param {object} flags Flags list\n\t\t\t * @returns {*}\n\t\t\t */\n\t\t\tflags: function(flags) {\n\t\t\t\tthis.callbacksFlags = flags;\n\t\t\t\treturn this;\n\t\t\t},\n\n\t\t\t/**\n\t\t\t * Remove by listener\n\t\t\t * @param {string} name Event name\n\t\t\t * @param {string} listener Listener object\n\t\t\t */\n\t\t\tremoveListener: function(name, listener) {\n\t\t\t\tif(this.advancedCallbacks[name]) {\n\t\t\t\t\tthis.advancedCallbacks[name].removeByContext(listener);\n\t\t\t\t}\n\t\t\t},\n\n\t\t\t/**\n\t\t\t * Adds new event handler\n\t\t\t * @param {string} \t name \t\t\tName of event\n\t\t\t * @param {function|string} func \tFunction be called on event fires\n\t\t\t * @param {object}   [context]\t\tFunction options\n\t\t\t * @param {object}   [options]\t\tFunction options\n\t\t\t */\n\t\t\ton:  function(name, func, context, options) {\n\n\n\t\t\t\tif(name instanceof Object)\n\t\t\t\t\t$.each(name, (event, func) => { this.on(event, func) });\n\n\t\t\t\telse $.each(this.getEventsNames(name), (_, name) => {\n\n\t\t\t\t\t/* Create callbacks */\n\t\t\t\t\tif(!this.advancedCallbacks[name])\n\t\t\t\t\t\tthis.advancedCallbacks[name] = callback(this.callbacksFlags);\n\n\t\t\t\t\t/* Add function */\n\t\t\t\t\tthis.advancedCallbacks[name].add(func, context ? context : self.context, options || {});\n\n\t\t\t\t});\n\n\t\t\t\treturn this;\n\t\t\t},\n\n\t\t\t/**\n\t\t\t * Fires callbacks for specified event\n\t\t\t * @param {string} name Name of event\n\t\t\t * @param {object} args Arguments to be passed\n\t\t\t * @param {object} [options] Additional options\n\t\t\t */\n\t\t\tfire: function(name, args, options) {\n\n\t\t\t\t/* Success last */\n\t\t\t\tlet events = this.getEventsNames(name),\n\t\t\t\t\tself = this,\n\t\t\t\t\tnext = false;\n\t\t\t\t\toptions = options || {};\n\n\t\t\t\t/* Remove global if need */\n\t\t\t\tif(options[\"noGlobal\"])\n\t\t\t\t\tevents = events.slice(1);\n\n\t\t\t\t/* Fire events */\n\t\t\t\t$.each(events, function(_, event) {\n\n\t\t\t\t\t/* If no callback */\n\t\t\t\t\tif(!self.advancedCallbacks[event])\n\t\t\t\t\t\treturn;\n\n\t\t\t\t\t/* Run */\n\t\t\t\t\tdo {\n\t\t\t\t\t\tnext = self.advancedCallbacks[event].fireNext(jQuery.extend({ event: event }, args || []), self.context, options.possible);\n\t\t\t\t\t} while(next);\n\n\t\t\t\t\t/* Reset */\n\t\t\t\t\tif(!options.once)\n\t\t\t\t\t\tself.advancedCallbacks[event].toRun = 0;\n\n\t\t\t\t});\n\n\t\t\t},\n\n\t\t\t/**\n\t\t\t * Get all event names from global name\n\t\t\t * @param {String} name Global event name\n\t\t\t * @returns {Array}\n\t\t\t */\n\t\t\tgetEventsNames: function(name) {\n\n\t\t\t\t/* Get events names */\n\t\t\t\tlet names = name.split(\",\"), events = [];\n\n\t\t\t\t/* Go through */\n\t\t\t\t$.each(names, function(i, name) {\n\n\t\t\t\t\t/* Remove spaces */\n\t\t\t\t\tname = name.replace(\" \", \"\");\n\n\t\t\t\t\t/* Get elements */\n\t\t\t\t\tlet elements = name.split(\".\");\n\t\t\t\t\tevents.push(elements[0]);\n\n\t\t\t\t\t/* Go through */\n\t\t\t\t\tfor(let j = 1; j < elements.length; j++)\n\t\t\t\t\t\tevents.push(elements[0] + \".\" + elements[j]);\n\n\t\t\t\t\t/* Global event */\n\t\t\t\t\tif(elements.length > 2)\n\t\t\t\t\t\tevents.push(elements.join(\".\"));\n\n\t\t\t\t});\n\n\t\t\t\t/* Return */\n\t\t\t\treturn events;\n\n\t\t\t},\n\n\t\t/**\n\t\t * Removes event handlers and functions\n\t\t * @param {string} name Event name\n\t\t * @param func\n\t\t */\n\t\t\toff: function(name, func = null) {\n\t\t\t\tif(func && this.advancedCallbacks[name])\n\t\t\t\t\tthis.advancedCallbacks[name].removeByCallback(func);\n\t\t\t\telse\n\t\t\t\t\tdelete this.advancedCallbacks[name];\n\t\t\t}\n\n\t\t};\n\n\t\tthis.service = Callbacks;\n\n});","sky.service(\"dataOperator\", [ \"searchField\", \"templates\", \"utils\", \"ajax\", \"stackList\", \"ajaxLoadingIndicator\" ], function ({ searchField, templates, utils, ajax, stackList, ajaxLoadingIndicator }) {\n\n\t/**\n\t * Default options\n\t * @type {{}}\n\t */\n\tlet baseOptions = {\n\t\tfields: {},\n\t\thistoryType: \"hash\"\n\t};\n\n\t/* Creates new data operator */\n\tclass DataOperator {\n\t\tconstructor(options) {\n\n\t\t\t/* Stores last request object */\n\t\t\tthis.lastRequestData = false;\n\n\t\t\t/* Func that calls before request */\n\t\t\tthis.beforeRequest = false;\n\t\t\t\n\t\t\t/* Fields list */\n\t\t\tthis.fields = stackList();\n\n\t\t\t/* Add base options, but only not set, that's why so fun construction */\n\t\t\tthis.options = utils.extend({}, baseOptions, true);\n\n\t\t\t/* Options init */\n\t\t\tthis.setOptions(options);\n\n\t\t}\n\n\t\t/** Saves to options */\n\t\tsetOptions(options) {\n\n\t\t\t/* Add to options */\n\t\t\tutils.extend(this.options, options, true);\n\n\t\t\t/* Set submit handler */\n\t\t\tif(this.options.form)\n\t\t\t\t$(this.options.form).action(\"submit\", this.onFormSubmit.bind(this));\n\n\t\t\t/* Self return */\n\t\t\treturn this;\n\t\t}\n\n\t\t/**\n\t\t * On form submit\n\t\t * @param event\n\t\t */\n\t\tonFormSubmit(event) {\n\n\t\t\t/* Prevent */\n\t\t\tevent.preventDefault();\n\n\t\t\t/* If form not valid */\n\t\t\tif (!$(this.options.form).validForm())\n\t\t\t\treturn;\n\n\t\t\tlet options = {force: true};\n\n\t\t\tif (this.fields.getById(\"page\"))\n\t\t\t\toptions[this.options.historyType === \"search\" ? \"search\" : \"hash\"] = {page: 1};\n\n\t\t\t/* Update */\n\t\t\tthis.reload(options);\n\n\t\t}\n\n\t\tprepareRequest(options) {\n\n\t\t\t/* On empty */\n\t\t\toptions = options || {};\n\n\t\t\t/* Hash fields */\n\t\t\tif (options[\"hash\"])\n\t\t\t\tpage.history.set(options[\"hash\"]);\n\n\t\t\t/* Hash fields */\n\t\t\tif (options[\"search\"])\n\t\t\t\tpage.history.search(options[\"search\"]);\n\n\t\t\t/* Hash fields */\n\t\t\tif (options[\"virtual\"]) {\n\t\t\t\tif (this.options.historyType === \"search\")\n\t\t\t\t\tpage.history.search(options[\"virtual\"]);\n\t\t\t\telse\n\t\t\t\t\tpage.history.set(options[\"virtual\"]);\n\t\t\t}\n\n\t\t\t/* Write to form from hash */\n\t\t\tif (options.fromUrl) {\n\t\t\t\tif (this.options.historyType === \"search\")\n\t\t\t\t\tthis.readSearch().writeForm();\n\t\t\t\telse\n\t\t\t\t\tthis.readHash().writeForm();\n\t\t\t}\n\n\t\t\t/* jQuery wrap */\n\t\t\tif (this.options.form && !$(this.options.form).validForm())\n\t\t\t\treturn false;\n\n\t\t\t/* Read */\n\t\t\tlet data = this.read();\n\n\t\t\t/* Add additional data */\n\t\t\tif (this.options[\"requestData\"])\n\t\t\t\tdata = utils.extend(data, this.options[\"requestData\"]);\n\n\t\t\t/* Check is same and no force requested */\n\t\t\tif (this.lastRequestData !== false && utils.isObjectsEqual(this.lastRequestData, data) && !options[\"force\"])\n\t\t\t\treturn false;\n\n\t\t\t/* Set hash data */\n\t\t\tif (!options.fromUrl)\n\t\t\t\tthis.writeURI(this.options.historyType);\n\n\t\t\t/* Before request call */\n\t\t\tif (this.beforeRequest)\n\t\t\t\tif (this.beforeRequest(data, options) === false)\n\t\t\t\t\treturn false;\n\n\t\t\t/* Return data */\n\t\t\treturn data;\n\n\t\t}\n\n\t\t/**\n\t\t * Reloads data according to params\n\t\t * @param options\n\t\t * @returns {DataOperator}\n\t\t */\n\t\treload(options) {\n\n\t\t\t/* Prepare */\n\t\t\tlet data = this.prepareRequest(options);\n\n\t\t\t/* Reload */\n\t\t\tif (data)\n\t\t\t\tthis.request(data);\n\n\t\t\t/* Self return */\n\t\t\treturn this;\n\n\t\t}\n\n\t\t/**\n\t\t * Performs request to reload data\n\t\t * @param data\n\t\t */\n\t\trequest(data) {\n\n\t\t\t/* Back link */\n\t\t\tlet self = this;\n\n\t\t\t/* Save last data */\n\t\t\tself.lastRequestData = data;\n\n\t\t\t/* Stop old request */\n\t\t\tif (this.ajax)\n\t\t\t\tthis.ajax.stop();\n\n\t\t\t/* Request */\n\t\t\tthis.ajax = ajax(this.options.url, data)\n\t\t\t\t.on(\"success\", function (response) {\n\t\t\t\t\tself.lastResponse = response;\n\t\t\t\t\tself.render(response, data);\n\t\t\t\t})\n\t\t\t\t.on(\"error\", function (error) {\n\t\t\t\t\tself.error(error)\n\t\t\t\t})\n\t\t\t\t.on(\"always\", function () {\n\t\t\t\t\tself.ajax = false;\n\t\t\t\t});\n\n\t\t\t/* Create loading, auto remove when ajax finishes */\n\t\t\tajaxLoadingIndicator.loading(this.ajax).reloadContent(this.options.holder);\n\n\t\t}\n\n\t\t/**\n\t\t * On success, have to be overloaded\n\t\t * @param data\n\t\t * @param request\n\t\t */\n\t\trender(data, request) {}\n\n\t\t/**\n\t\t * On error, have to be overloaded\n\t\t * @param error\n\t\t */\n\t\terror(error) {}\n\n\t\t/**\n\t\t * Adds list of fields to current list\n\t\t * @param {Array} list List of names\n\t\t * @param {Boolean} [virtual] Virtual fields flag\n\t\t */\n\t\tfieldsList(list, virtual) {\n\n\t\t\t/* Go through and push */\n\t\t\tutils.each(list, (_, item) => {\n\t\t\t\tthis.options.fields[item] = virtual;\n\t\t\t});\n\n\t\t\t/* Self return */\n\t\t\treturn this;\n\t\t\t\n\t\t}\n\n\t\t/**\n\t\t * Sets form fields\n\t\t * @param list\n\t\t * @returns {*}\n\t\t */\n\t\trealFieldsList(list) {\n\t\t\treturn this.fieldsList(list);\n\t\t}\n\n\t\t/**\n\t\t * Set none forms fields\n\t\t * @param list\n\t\t * @returns {*}\n\t\t */\n\t\tvirtualFieldsList(list) {\n\t\t\treturn this.fieldsList(list, true);\n\t\t}\n\n\t\t/**\n\t\t * Reads real fields\n\t\t * @val {string} type Field type - \"real\" or \"virtual\"\n\t\t * @returns {{}}\n\t\t */\n\t\tread(type = false) {\n\n\t\t\t/* Data holder */\n\t\t\tlet data = {};\n\n\t\t\t/* Go through */\n\t\t\tthis.fields.each(field => {\n\n\t\t\t\t/** @let field searchField */\n\t\t\t\tif (type && (type === \"real\" && field.virtual || !field.virtual))\n\t\t\t\t\treturn;\n\n\t\t\t\t/* Read */\n\t\t\t\tfield.read();\n\n\t\t\t\t/* Get non default or null */\n\t\t\t\tlet val = field.valueOrNullOnDefault();\n\n\t\t\t\t/* If value not same as default */\n\t\t\t\tif (val !== null)\n\t\t\t\t\tdata[field.name] = val;\n\n\t\t\t});\n\n\t\t\t/* Self return */\n\t\t\treturn data;\n\n\t\t}\n\n\t\t/** Write current field to form */\n\t\twriteForm() {\n\t\t\tthis.fields.each(field => field.write());\n\t\t\treturn this;\n\t\t}\n\n\t\t/** Reads hash to fields */\n\t\treadHash() {\n\t\t\tthis.fields.each(field => field.hashRead());\n\t\t\treturn this;\n\t\t}\n\n\t\t/** Reads hash to fields */\n\t\treadSearch() {\n\t\t\tthis.fields.each(field => field.searchRead());\n\t\t\treturn this;\n\t\t}\n\n\t\t/** Writes current fields to hash */\n\t\twriteURI(type = \"hash\") {\n\n\t\t\t/* To write */\n\t\t\tlet write = {};\n\n\t\t\t/* Go through */\n\t\t\tthis.fields.each(field => {\n\t\t\t\twrite[field.name]  = field.valueOrNullOnDefault();\n\t\t\t});\n\n\t\t\t/* Write to URI */\n\t\t\ttype === \"search\" ? page.history.search(write) : page.history.set(write);\n\n\t\t\t/* Self return */\n\t\t\treturn this;\n\n\t\t}\n\n\t\t/** Finds inputs associated with fields */\n\t\tinitInputs() {\n\n\t\t\t/* Back link */\n\t\t\tlet self = this;\n\n\t\t\tutils.each(this.options.fields, (fieldName, virtual) => {\n\n\t\t\t\t// Create search field\n\t\t\t\tlet field = new searchField(fieldName, virtual ? self.options.historyType : false);\n\n\t\t\t\t/** @let field searchField */\n\t\t\t\tif (!field.virtual) {\n\n\t\t\t\t\t/* Find input */\n\t\t\t\t\tif (field.name[0] === \"*\") {\n\t\t\t\t\t\tfield.name = field.name.substring(1);\n\t\t\t\t\t\tfield.input = $(self.options.form).find(\".selectReplaceChoose[data-input=\" + field.name + \"]\");\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t\tfield.input = $(self.options.form).find('[name=\"' + field.name + '\"]');\n\n\t\t\t\t\t/* Remove fields without input */\n\t\t\t\t\tif (!field.input || !field.input.length) {\n\t\t\t\t\t\tdelete self.fields[fieldName];\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\t/* Save */\n\t\t\t\t\tself.fields[fieldName] = field;\n\n\t\t\t\t\t/* Read default */\n\t\t\t\t\tfield.default = field.read();\n\t\t\t\t\tfield.value = null;\n\t\t\t\t} else {\n\t\t\t\t\tself.fields[fieldName] = field;\n\t\t\t\t}\n\t\t\t});\n\n\t\t\t/* Self return */\n\t\t\treturn this;\n\t\t}\n\t}\n\n\t/* Interface */\n\tthis.service = {\n\t\tinitOperator: options => new DataOperator(options),\n\t\tsearchField: searchField,\n\t\tinitLoader: function (loader, notifications, pagination, { reload = true, history = true }) {\n\n\t\t\t/* Add count */\n\t\t\tloader.beforeRequest = function (data, options) {\n\t\t\t\tif (!loader.lastRequestData || options.force)\n\t\t\t\t\tdata[\"count\"] = true;\n\t\t\t};\n\n\t\t\t/* Render function */\n\t\t\tloader.render = function (response) {\n\n\t\t\t\t// Re render\n\t\t\t\t$(loader.options.holder).html('').append(\n\t\t\t\t\ttemplates.render(\"page-result-render\", response)\n\t\t\t\t);\n\n\t\t\t\t// Remove old\n\t\t\t\tif (loader.pagination)\n\t\t\t\t\tloader.pagination = loader.pagination.remove();\n\n\t\t\t\tif (typeof response.pages !== \"undefined\") {\n\n\t\t\t\t\t// Pages holder\n\t\t\t\t\tlet holder = $(\"#pages\").html('');\n\n\t\t\t\t\t// Create new\n\t\t\t\t\tif (response.pages > 1 && pagination) {\n\t\t\t\t\t\tloader.pagination = pagination.add({\n\t\t\t\t\t\t\tpages: response.pages,\n\t\t\t\t\t\t\tcurrent: response.page,\n\t\t\t\t\t\t\tholder: holder\n\t\t\t\t\t\t});\n\t\t\t\t\t\tloader.pagination.onPageChange = function (pageNum) {\n\t\t\t\t\t\t\tloader.reload({virtual: {page: pageNum}});\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t};\n\n\t\t\t/* On loading error */\n\t\t\tloader.error = function (error) {\n\n\t\t\t\t// Remove pagination on error\n\t\t\t\tif (loader.pagination)\n\t\t\t\t\tloader.pagination = this.pagination.remove();\n\n\t\t\t\t// Clear\n\t\t\t\t$(loader.options.holder).html('').append(notifications.message({text: error}).render);\n\n\t\t\t};\n\n\t\t\t/* Reload */\n\t\t\tif (reload)\n\t\t\t\tloader.reload({fromUrl: true});\n\n\t\t\t/* Set handler */\n\t\t\tif (history)\n\t\t\t\tpage.history.on(\"change\", function (searchChanged, hashChanged) {\n\t\t\t\t\tif (searchChanged || hashChanged)\n\t\t\t\t\t\tloader.reload({fromUrl: true});\n\t\t\t\t});\n\n\t\t}\n\t}\n\n});","sky.service(\"inputsIO\", function () {\n\n\tthis.service = {\n\n\t\t/**\n\t\t * Get value of single input\n\t\t * @param input\n\t\t * @returns {*}\n\t\t */\n\t\treadInputValue: function (input) {\n\n\t\t\tif (input.is(\".selectReplaceChoose\")) {\n\n\t\t\t\t// Get inputs\n\t\t\t\tlet inputs = input.find(\"input\");\n\n\t\t\t\t// Read\n\t\t\t\tlet data = this.readInputsValues(inputs);\n\n\t\t\t\t// If all checked\n\t\t\t\tif (data.length === inputs.length)\n\t\t\t\t\treturn true;\n\n\t\t\t\t// Return data\n\t\t\t\treturn data;\n\n\t\t\t} else if (input.is(\":checkbox\") || input.is(\":radio\")) {\n\t\t\t\treturn input.is(\":checked\") ? input.val() : false;\n\t\t\t} else\n\t\t\t\treturn input.val() === \"\" ? false : input.val();\n\n\n\t\t},\n\n\t\t/**\n\t\t * Get value of multiple inputs\n\t\t * @param inputs\n\t\t * @returns {*}\n\t\t */\n\t\treadInputsValues: function (inputs) {\n\n\t\t\t/* If single input */\n\t\t\tif (inputs.length === 1)\n\t\t\t\treturn this.readInputValue(inputs);\n\n\t\t\t/* Values holder */\n\t\t\tlet valuesNamed = [],\n\t\t\t\tvaluesLined = [],\n\t\t\t\tself = this;\n\n\t\t\t/* Go through */\n\t\t\tinputs.each(function () {\n\n\t\t\t\t/* Get value */\n\t\t\t\tlet input = $(this),\n\t\t\t\t\tvalue = self.readInputValue(input);\n\n\t\t\t\t/* If we get values */\n\t\t\t\tif (value !== false) {\n\t\t\t\t\tvaluesNamed.push({name: input.attr(\"name\"), value: value});\n\t\t\t\t\tvaluesLined.push(value);\n\t\t\t\t}\n\n\t\t\t});\n\n\t\t\t/* Single */\n\t\t\tif (valuesLined.length === 1) {\n\t\t\t\treturn valuesLined[0];\n\t\t\t}\n\n\t\t\t/* Return */\n\t\t\treturn valuesLined.length ? valuesLined : false;\n\n\t\t},\n\n\t\t/**\n\t\t * Write single input value\n\t\t * @param value\n\t\t * @param input\n\t\t * @returns {*}\n\t\t */\n\t\twriteInputValue: function (value, input) {\n\n\t\t\tif (input.is(\".selectReplaceChoose\")) {\n\n\t\t\t\t// Get inputs\n\t\t\t\tlet inputs = input.find(\"input\");\n\n\t\t\t\t// If all checked\n\t\t\t\tif (value === true)\n\t\t\t\t\tinputs.prop(\"checked\", true);\n\t\t\t\telse\n\t\t\t\t\tthis.writeInputsValue(value, inputs);\n\n\t\t\t\tif (inputs.length)\n\t\t\t\t\tinputs.first().trigger(\"change\", {notByUser: true});\n\n\t\t\t} else if (input.is(\":checkbox\") || input.is(\":radio\")) {\n\t\t\t\treturn input.prop(\"checked\", value !== false);\n\t\t\t} else\n\t\t\t\treturn input.val(value === false ? \"\" : value);\n\t\t},\n\n\t\t/**\n\t\t * Write multiple inputs value\n\t\t * @param values\n\t\t * @param inputs\n\t\t * @returns {*}\n\t\t */\n\t\twriteInputsValue: function (values, inputs) {\n\n\t\t\t/* Write single */\n\t\t\tif (inputs.length < 2)\n\t\t\t\treturn this.writeInputValue(values, inputs);\n\n\t\t\t/* Multiple */\n\t\t\tif (inputs.is(\":checkbox\") || inputs.is(\":radio\")) {\n\t\t\t\tinputs.prop(\"checked\", false);\n\t\t\t\tif (values instanceof Array) {\n\t\t\t\t\t$.each(values, function (_, val) {\n\t\t\t\t\t\tinputs.filter('[value=\"' + val + '\"]').prop(\"checked\", true);\n\t\t\t\t\t});\n\t\t\t\t\tinputs.first().trigger(\"change\", {notByUser: true});\n\t\t\t\t} else {\n\t\t\t\t\tif (values === false || values === true)\n\t\t\t\t\t\tinputs.prop(\"checked\", values).first().trigger(\"change\", {notByUser: true});\n\t\t\t\t\telse\n\t\t\t\t\t\tinputs.filter('[value=\"' + values + '\"]').prop(\"checked\", true).trigger(\"change\", {notByUser: true});\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tinputs.val(values);\n\t\t\t}\n\t\t}\n\n\t}\n\n});","sky.service(\"searchField\", [\"utils\", \"inputsIO\"], function ({ utils, inputsIO }) {\n\tthis.service = class {\n\t\tconstructor(name, virtual) {\n\t\t\tthis.name = name;\n\t\t\tthis.inputName = name;\n\t\t\tthis.virtual = virtual || false;\n\t\t\tthis.default = null;\n\t\t\tthis.input = false;\n\t\t\tthis.value = null;\n\t\t}\n\t\tvalueOrNullOnDefault() {\n\t\t\tif ((this.default instanceof Array) && (this.value instanceof Array))\n\t\t\t\treturn utils.isObjectsEqual(this.value, this.default) ? null : this.value;\n\n\t\t\treturn this.value === this.default ? null : this.value;\n\t\t}\n\t\tread() {\n\t\t\tif (this.virtual === \"search\")\n\t\t\t\treturn this.searchRead();\n\t\t\telse if (this.virtual)\n\t\t\t\treturn this.hashRead();\n\t\t\telse if (this.input)\n\t\t\t\tthis.value = inputsIO.readInputsValues(this.input);\n\n\t\t\treturn this.value;\n\t\t}\n\t\twrite() {\n\t\t\tif (this.input)\n\t\t\t\tinputsIO.writeInputsValue(this.value === null ? this.default : this.value, this.input);\n\t\t\treturn this.value;\n\t\t}\n\t\thashRead() {\n\t\t\tlet hashValue = page.history.hashObject[this.name];\n\t\t\treturn this.value = (typeof hashValue === \"undefined\") ? this.default : hashValue;\n\t\t}\n\t\tsearchRead () {\n\t\t\tlet searchValue = page.history.searchObject[this.name];\n\t\t\treturn this.value = (typeof searchValue === \"undefined\") ? this.default : searchValue;\n\t\t}\n\t}\n});","sky.service(\"directives\", [\"exceptions\", \"utils\", \"stackList\"], function ({exceptions, utils, stackList}) {\n\n\tlet list = stackList(),\n\t\tdirectives = this.service = {\n\n\t\t\t/**\n\t\t\t * Adds new directive\n\t\t\t * @param {string} name Directive name\n\t\t\t * @param {*} options Directive options\n\t\t\t * @param {function} directive How to parse directive\n\t\t\t */\n\t\t\tadd: function (name, options, directive) {\n\n\t\t\t\t/* Reset */\n\t\t\t\tif (!directive && typeof options === \"function\") {\n\t\t\t\t\tdirective = options;\n\t\t\t\t\toptions = {};\n\t\t\t\t}\n\t\t\t\toptions.directive = directive;\n\t\t\t\toptions.selector = name;\n\n\t\t\t\t/* Save */\n\t\t\t\tlist.add(options);\n\n\t\t\t\t/* Self return*/\n\t\t\t\treturn this;\n\n\t\t\t},\n\n\t\t\t/**\n\t\t\t * Get element attributes\n\t\t\t * @param element\n\t\t\t * @returns {{}}\n\t\t\t */\n\t\t\tgetAttributes: function (element) {\n\n\t\t\t\t/* Holds attributes */\n\t\t\t\tlet attributes = {};\n\n\t\t\t\t/* Copy them to list */\n\t\t\t\tfor(let attr of element.get(0).attributes)\n\t\t\t\t\tattributes[attr.nodeName] = attr.nodeValue;\n\n\t\t\t\t/* Return */\n\t\t\t\treturn attributes;\n\n\t\t\t},\n\n\t\t\t/**\n\t\t\t * Applies directive convert to element\n\t\t\t * @param element\n\t\t\t * @param options\n\t\t\t */\n\t\t\tparseElement: function (element, options) {\n\n\t\t\t\t/* Get element */\n\t\t\t\telement = $(element);\n\n\t\t\t\t/* Get element attributes */\n\t\t\t\tlet attributes = this.getAttributes(element);\n\n\t\t\t\t/* Parse body for jason data */\n\t\t\t\tif (options[\"json\"] || options[\"jsonToData\"]) {\n\n\t\t\t\t\t/* Get child */\n\t\t\t\t\tlet jsonScript = element.children('script[type=\"application/json\"]');\n\n\t\t\t\t\t/* If we have json encoded data */\n\t\t\t\t\tif (jsonScript.length) {\n\n\t\t\t\t\t\ttry {\n\n\t\t\t\t\t\t\t/* Parse json */\n\t\t\t\t\t\t\tlet json = JSON.parse(jsonScript.text());\n\n\t\t\t\t\t\t\t/* Extend */\n\t\t\t\t\t\t\tutils.extend(attributes, json);\n\n\t\t\t\t\t\t\t/* Save to data */\n\t\t\t\t\t\t\tif (options[\"jsonToData\"])\n\t\t\t\t\t\t\t\telement.data(\"json\", json);\n\n\t\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\t\tthrow new exceptions.system.Error(\"Element \" + options.selector + \" should have json stored content, but error on parse appears\");\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t/* Call parse function */\n\t\t\t\tif (typeof options.directive === \"function\")\n\t\t\t\t\toptions.directive(element, attributes);\n\t\t\t},\n\n\t\t\t/**\n\t\t\t * Searches and replaces directives in element\n\t\t\t * @param element\n\t\t\t */\n\t\t\tparse: function (element) {\n\t\t\t\tlist.each((directive) => {\n\t\t\t\t\t$(directive.selector, element).each(function () {\n\t\t\t\t\t\tdirectives.parseElement(this, directive);\n\t\t\t\t\t});\n\t\t\t\t\tif ($(element).is(directive.selector))\n\t\t\t\t\t\tdirectives.parseElement(element, directive);\n\t\t\t\t});\n\t\t\t}\n\n\n\t\t};\n\n\t/* Add jQuery fn */\n\tjQuery.fn.parseDirectives = function () {\n\n\t\t/* Parse */\n\t\tdirectives.parse(this);\n\n\t\t/* Return */\n\t\treturn this;\n\n\t};\n\n\t/* Parse body for directives when all ready */\n\tsky.onReady(function () {\n\t\t$(\"body\").parseDirectives();\n\t});\n\n});","sky.service(\"drag\", [\"callbacks\"], function({callbacks}) {\n\tlet self = {\n\t\tbindEvents: (event, events) => {\n\t\t\tself.bind(event)\n\t\t\t\t.on(\"start\", events.start)\n\t\t\t\t.on(\"move\", events.move)\n\t\t\t\t.on(\"stop\", events.stop)\n\t\t},\n\t\tbind: event => {\n\n\t\t\t// Get original event\n\t\t\tevent = event.originalEvent || event;\n\n\t\t\t// Init vars\n\t\t\tlet started = false,\n\t\t\t\tcallbacks = callbacks();\n\n\t\t\t// Check button\n\t\t\tif(event.button && event.button !== 1)\n\t\t\t\treturn callbacks;\n\n\t\t\t// Stop default action\n\t\t\tevent.preventDefault();\n\n\t\t\t$(document).on(\"mousemove.drag\", function(event) {\n\n\t\t\t\t// Start\n\t\t\t\tif(!started) {\n\t\t\t\t\tstarted = true;\n\t\t\t\t\tcallbacks.fire(\"start\", { event: event, x: event.pageX, y: event.pageY });\n\t\t\t\t}\n\t\t\t\t// Move\n\t\t\t\telse callbacks.fire(\"move\", { event: event, x: event.pageX, y: event.pageY });\n\n\t\t\t\t// Prevent default\n\t\t\t\tevent.preventDefault();\n\t\t\t\treturn false;\n\n\t\t\t}).on(\"mouseup.drag\", function(event) {\n\n\t\t\t\t// Off events\n\t\t\t\t$(document).off(\"mousemove.drag\").off(\"mouseup.drag\");\n\n\t\t\t\t// If not started\n\t\t\t\tif(!started)\n\t\t\t\t\treturn;\n\n\t\t\t\t// Stop default action\n\t\t\t\tevent.preventDefault();\n\n\t\t\t\t// Call stop callback\n\t\t\t\tcallbacks.fire(\"stop\", { event: event, x: event.pageX, y: event.pageY });\n\n\t\t\t});\n\n\t\t\treturn callbacks;\n\t\t}\n\t};\n\treturn self;\n});","sky.service(\"history\", [ \"callbacks\", \"supported\" ], function ({ callbacks, supported }) {\n\n\n\t/**\n\t * Get difference fields in objects\n\t * @param {object} first  Object to compare\n\t * @param {object} second Object to compare\n\t */\n    let getObjectsDifference = function (first, second) {\n\n\t\tlet difference = {},\n\t\t    localDiff = false;\n\n        /* If both arrays or objects */\n\t\tif ((first instanceof Array && second instanceof Array) || (first instanceof Object && second instanceof Object)) {\n\n            /* Find what was changed or deleted in second */\n\t\t\t$.each(first, function (key, value) {\n\n                /* If no such elements in second */\n\t\t\t\tif (typeof second[key] === \"undefined\")\n\t\t\t\t\tdifference[key] = null; // Set to null\n\n                /* Check if different */\n\t\t\t\telse if (localDiff = getObjectsDifference(value, second[key])) {\n\t\t\t\t\tdifference[key] = localDiff;\n\t\t\t\t}\n\n\t\t\t});\n\n            /* If was added */\n\t\t\t$.each(second, function (key, value) {\n\t\t\t\tif (typeof first[key] === \"undefined\")\n\t\t\t\t\tdifference[key] = value;\n\t\t\t});\n\n            /* Convert object to array */\n\t\t\tif (first instanceof Array) {\n\t\t\t\tlet returnArray = [];\n\t\t\t\t$.each(difference, function (key) {\n\t\t\t\t\treturnArray.push(difference[key]);\n\t\t\t\t});\n\t\t\t\tdifference = returnArray;\n\t\t\t}\n\n\t\t} else {\n\t\t\tif (first !== second) return second;\n\t\t\telse return false;\n\t\t}\n\n        /* No array difference */\n\t\tif (difference.length === 0) return false;\n\t\telse return difference;\n\n\t};\n\n    /**\n     * History constructor\n     * @param [options]\n     * @returns {sky.History}\n     * @constructor\n     */\n    sky.History = function (options) {\n\n\t\t/* Self creation */\n        if (!(this instanceof sky.History))\n            return new sky.History(options);\n\n\t\t/* Reset */\n        this.options = options || {};\n\n\t\t/* Set events */\n        this.events = this.options.events || new callbacks();\n        this.options.events = this.events;\n\n\t\t/* Self return */\n        return this;\n\n    };\n\n    /**\n     * Extending\n     */\n    $.extend(sky.History.prototype, {\n\n        /**\n         * Stores last saved hash\n         */\n        hashString: \"\",\n\n        /**\n         * Stores last saved search\n         */\n        searchString: \"\",\n\n        /**\n         * Stores last saved path\n         */\n        pathString: \"\",\n\n        /**\n         * Stores object with hash params key/value pairs\n         */\n        hashObject: {},\n\n        /**\n         * Stores object with page search params key/value pairs\n         */\n        searchObject: {},\n\n        /**\n         * Stores events\n         */\n        events: undefined,\n\n        /**\n         * Holds hash check function interval id\n         */\n        intervalId: 0,\n\n        /**\n         * This page base url\n         */\n        base: \"\",\n\n        /**\n         * Changes current path to specified\n         * @param {string} path PAth to navigate\n         */\n        navigate: function (path) {\n\n            // Get path\n            path = path.replace(\"~\", this.base);\n\n            // Get current\n            let current = (window.location.pathname + window.location.search).substr(this.base.length);\n\n            // If changes\n            if (current !== path) {\n\n                // Set new state\n                history.pushState({ oldPath: this.pathString, newPath: path, search: this.searchObject}, path, path);\n\n                // Get new\n                this.pathString = window.location.pathname.substr(this.base.length);\n\n                // Get search string\n                this.searchString = this.getWindowSearch();\n\n                // Fire event\n                this.events.fire(\"navigate.path, always\", {hash: this.hashObject, path: this.pathString, search: this.searchObject});\n\n            }\n        },\n\n        /**\n         * Fires on path change\n         */\n        change: function () {\n\n\t\t\t/* Hash difference holder */\n            let hashDifference = {},\n                searchDifference = {},\n                old = this.pathString,\n                hashChanged = false,\n                searchChanged = false;\n\n\t\t\t/* If api supported */\n            if (this.supported)\n                this.pathString = window.location.pathname.substr(this.base.length);\n\n\t\t\t/* Check if hash changed */\n            if (this.hashString !== this.getWindowHash()) {\n\n\t\t\t\t/* Get difference */\n                hashDifference = this.getDifference(this.getWindowHash(), this.hashObject);\n\n\t\t\t\t/* Hash change flag */\n                hashChanged = true;\n\n            }\n\n\t\t\t/* Check if params changed */\n            if (this.searchString !== this.getWindowSearch()) {\n\n\t\t\t\t/* Get difference */\n                searchDifference = this.getDifference(this.getWindowSearch(), this.searchObject);\n\n\t\t\t\t/* Hash change flag */\n                searchChanged = true;\n\n            }\n\n\t\t\t/* If nothing changed */\n            if (this.pathString === old && !hashChanged && !searchChanged)\n                return;\n\n\t\t\t/* Rebuild hash object on new hash str */\n            this.rebuild();\n\n\t\t\t/* Fire */\n            this.events.fire(\"change, always\", {\n                hash: this.hashObject,\n                hashDifference: hashDifference,\n                searchDifference: searchDifference,\n                path: this.pathString,\n                oldPath: old,\n                searchChanged: searchChanged,\n                hashChanged: hashChanged,\n                pathChanged: old !== this.pathString\n            });\n\n        },\n\n        /**\n         * Navigates to specified path\n         * @param path\n         */\n        setHash: function (path) {\n\n\t\t\t/* To not jump top */\n            if (path === \"\" && window.location.hash !== \"\")\n                path = \"none\";\n\n\t\t\t/* Save */\n            this.hashString = path;\n\n\t\t\t/* Set hash */\n            window.location.hash = encodeURI(path);//encodeURI(path);\n\n        },\n\n        /**\n         * Navigates to specified path\n         * @param path\n         */\n        setSearch: function (path) {\n\n\t\t\t/* Set path */\n            this.navigate(window.location.pathname + encodeURI(path !== \"\" ? \"?\" + path : \"\"));\n\n        },\n\n        /**\n         * Sets hash letiable\n         * @param {object}    elements Fields to be set\n         * @param {boolean}    [force]     Replace all stored fields with elements object\n         */\n        set: function (elements, force) {\n\n            let changed = false;\n\n\t\t\t/* Force rewrite */\n            if (force)\n                this.hashObject = elements;\n\n\t\t\t/* Go through elements and add or change them */\n            $.each(elements, (key, value) => {\n\n\t\t\t\t/* If we need delete */\n                if (value === null)\n                    delete this.hashObject[key];\n                else\n                    this.hashObject[key] = value;\n\n\t\t\t\t/* Set as changed */\n                changed = true;\n\n            });\n\n\t\t\t/* If any changes we rebuild hash */\n            if (changed || force)\n                this.setHash(decodeURIComponent(jQuery.param(this.hashObject).replace(/\\+/g, \" \")));\n\n\t\t\t/* Fire */\n            this.events.fire(\"set, always\", {elements: elements, hash: this.hashObject, path: this.pathString});\n\n        },\n\n\n        /**\n         * Sets hash letiable\n         * @param {object}    elements Fields to be set\n         * @param {boolean}    [force]     Replace all stored fields with elements object\n         */\n        search: function (elements, force) {\n\n            let changed = false;\n\n\t\t\t/* Force rewrite */\n            if (force)\n                this.searchObject = elements;\n\n\t\t\t/* Go through elements and add or change them */\n            $.each(elements, $.proxy(function (key, value) {\n\n\t\t\t\t/* If we need delete */\n                if (value === null)\n                    delete this.searchObject[key];\n                else\n                    this.searchObject[key] = value;\n\n\t\t\t\t/* Set as changed */\n                changed = true;\n\n            }, this));\n\n\t\t\t/* If any changes we rebuild hash */\n            if (changed || force)\n                this.setSearch(decodeURIComponent(jQuery.param(this.searchObject).replace(/\\+/g, \" \")));\n\n\t\t\t/* Fire */\n\t\t\tthis.events.fire(\"set, always\", {elements: elements, hash: this.hashObject, path: this.pathString});\n\n        },\n\n        /**\n         * Makes hash from object\n         * @param obj\n         * @returns {*|void|string|XML}\n         */\n        stringFromObject: function (obj) {\n            return jQuery.param(obj).replace(/\\+/g, \" \");\n        },\n\n        /**\n         * Get objects according to hash string\n         * @param {string} paramsString String which contains key=value pairs, would be parsed to object\n         */\n        getObjects: function (paramsString) {\n\n            let objects = {};\n\n\t\t\t/* Remove sharp */\n            if (paramsString.substr(0, 1) === '#' || paramsString.substr(0, 1) === '?')\n                paramsString = paramsString.slice(1, paramsString.length);\n\n\t\t\t/* Split parameters */\n            let subStrings = paramsString.split(\"&\");\n\n\t\t\t/* Get params */\n            $.each(subStrings, function (i, str) {\n\n                let keyAndValue = str.split(\"=\", 2);\n\n\t\t\t\t/* If no assign */\n                if (keyAndValue.length < 2)\n                    return;\n\n                let name = keyAndValue[0];\n\n\t\t\t\t/* Truncate brackets */\n                if (name.substr(-2) === \"[]\")\n                    name = name.substr(0, name.length - 2);\n\n\t\t\t\t/* Special hash for \"=\" in value  */\n                keyAndValue[1] = str.substr(keyAndValue[0].length + 1);\n\n\t\t\t\t/* If object repeats we create array */\n                if (typeof objects[name] === \"undefined\") objects[name] = keyAndValue[1];\n                else {\n                    if (!(objects[name] instanceof Array)) objects[name] = [objects[name]];\n                    objects[name].push(keyAndValue[1]);\n                }\n            });\n\n            return objects;\n\n        },\n\n        /**\n         * Finds difference between current stored hash and parameter\n         * @returns {*}\n         */\n        getDifference: function (string, stored) {\n\n\t\t\t/* Init */\n            let objects = this.getObjects(decodeURI(string));\n            return getObjectsDifference(stored, objects);\n\n        },\n\n        /**\n         * Rebuilds stored hash parameters according to current one\n         */\n        rebuild: function () {\n            this.hashString = this.getWindowHash();\n            this.hashObject = this.getObjects(this.hashString);\n            this.searchString = this.getWindowSearch();\n            this.searchObject = this.getObjects(this.searchString);\n            this.pathString = window.location.pathname;\n            return this;\n\n        },\n\n        /**\n         * Gets current window hash without \"#\"\n         * @returns {string}\n         */\n        getWindowHash: function () {\n\n\t\t\t/* Get decoded hash */\n            let hash = decodeURI(window.location.hash);\n\n\t\t\t/* Remove sharp */\n            if (hash.substr(0, 1) === '#')\n                hash = hash.slice(1);\n\n\t\t\t/* Return */\n            return hash;\n\n        },\n\n        /**\n         * Gets current window parameters without \"?\"\n         * @returns {string}\n         */\n        getWindowSearch: function () {\n\n\t\t\t/* Get decoded hash */\n            let search = decodeURI(window.location.search);\n\n\t\t\t/* Remove question */\n            if (search.substr(0, 1) === '?')\n                search = search.slice(1);\n\n\t\t\t/* Return */\n            return search;\n\n        },\n\n        /**\n         * Set interval execution\n         */\n        start: function () {\n\n            /* Set base if any */\n\t\t\tif (this.options.base)\n\t\t\t\tthis.base = this.options.base;\n\n\t\t\t/* If supported history */\n            if (window.history)\n                window.onpopstate = this.change.bind(this);\n\n            /* Timeout */\n            if (!this.intervalId)\n                this.intervalId = setInterval(this.change.bind(this), this.options.time || 500);\n\n\t\t\t/* Immediately event */\n            this.change();\n            return this;\n        }\n\n    });\n\n});","sky.service(\"localStorage\", [ \"callbacks\" ], function({ callbacks }) {\n\n\t//noinspection JSUnusedLocalSymbols\n\tlet LocalStorage = this.service = class {\n\t\tconstructor(options) {\n\t\t\tthis.name = options.name || \"global\";\n\t\t\tthis.events = callbacks();\n\t\t}\n\n\t\t/**\n\t\t * Loads item form database\n\t\t * @param {*} id Unique id\n\t\t */\n\t\tload(id) {\n\t\t\tlet items = this.getItems();\n\t\t\treturn items ? items[id] : undefined;\n\t\t}\n\n\t\tgetItems() {\n\t\t\ttry {\n\n\t\t\t\t/* Try to get item from storage */\n\t\t\t\tlet items = localStorage.getItem(this.name);\n\n\t\t\t\t/* Trigger error */\n\t\t\t\tif(items !== null)\n\t\t\t\t\treturn $.parseJSON(items);\n\n\t\t\t} catch(e) {\n\t\t\t\tthis.events.fire(\"error\", { storage: this });\n\t\t\t}\n\n\t\t\t/* Undefined on error */\n\t\t\treturn undefined;\n\n\t\t}\n\n\t\t/**\n\t\t * Save data to storage\n\t\t * @param id\n\t\t * @param data\n\t\t * @returns {*}\n\t\t */\n\t\tsave(id, data) {\n\n\t\t\ttry {\n\n\t\t\t\t/* Save */\n\t\t\t\tlet items = this.getItems() || {};\n\n\t\t\t\t/* Add item */\n\t\t\t\titems[id] = data;\n\n\t\t\t\t/* Save keys */\n\t\t\t\tlocalStorage.setItem(this.name, JSON.stringify(items));\n\n\t\t\t} catch(e) {\n\t\t\t\tthis.events.fire(\"error\", { storage: this });\n\t\t\t}\n\n\t\t\t/* Self return */\n\t\t\treturn this;\n\n\t\t}\n\n\t\t/**\n\t\t * Removes from storage\n\t\t * @param id\n\t\t * @returns {*}\n\t\t */\n\t\tremove(id) {\n\t\t\ttry {\n\n\t\t\t\t/* Save */\n\t\t\t\tlet items = this.getItems();\n\n\t\t\t\t/* Add item */\n\t\t\t\tdelete items[id];\n\n\t\t\t\t/* Save keys */\n\t\t\t\tlocalStorage.setItem(this.name, JSON.stringify(items));\n\n\t\t\t} catch(e) {\n\t\t\t\tthis.events.fire(\"error\", { storage: this });\n\t\t\t}\n\n\t\t\t/* Self return */\n\t\t\treturn this;\n\n\t\t}\n\t};\n\n});","sky.service(\"model\", [ \"modelsStorage\", \"callbacks\" ], function({ modelsStorage, callbacks }) {\n\n\t/**\n\t * List of model definitions\n\t */\n\tlet modelsDefinition = {};\n\n\tclass Model {\n\t\tconstructor(type, data) {\n\n\t\t\t/* Init as base */\n\t\t\tthis.definition = BaseDefinition;\n\n\t\t\t/* Get special if defined */\n\t\t\tif(modelsDefinition[type])\n\t\t\t\tthis.definition = modelsDefinition[type];\n\n\t\t\t/* Save id */\n\t\t\tthis.id = data[this.definition.id] || null;\n\t\t\tthis.type = type;\n\t\t\tthis.data = {};\n\t\t\tthis.events = callbacks();\n\t\t\tthis.definition.creation.bind(this)($.extend({}, data, true));\n\n\t\t}\n\t\textend(data) {\n\t\t\tthis.definition.extension.bind(this)($.extend({}, data, true));\n\t\t\treturn this.changed();\n\t\t}\n\t\tchanged() {\n\t\t\tthis.events.fire(\"change\", {model: this});\n\t\t\treturn this;\n\t\t}\n\t\tremoveFromStorage() {\n\t\t\tmodelsStorage.remove(this);\n\t\t}\n\t}\n\n\t/**\n\t * Base model definition witch would be parented\n\t */\n\tlet BaseDefinition = {\n\t\tid       : function() {\n\t\t\treturn this.data[\"id\"]\n\t\t},\n\t\tcreation : function(data) {\n\t\t\tthis.data = data;\n\t\t},\n\t\textension: function(data) {\n\t\t\t$.extend(true, this.data, data);\n\t\t}\n\t};\n\n\tthis.service = {\n\t\t/**\n\t\t * Adds new models definition\n\t\t * @param name\n\t\t * @param definition\n\t\t */\n\t\taddDefinition: function(name, definition) {\n\t\t\tmodelsDefinition[name] = $.extend({}, BaseDefinition, definition);\n\t\t},\n\n\t\tfromData: function(type, data) {\n\n\t\t\tlet model = new this.Model(type, data);\n\t\t\tlet cached = modelsStorage.add(model);\n\n\t\t\tif(cached)\n\t\t\t\treturn cached.extend(data);\n\n\t\t\treturn model;\n\n\t\t}\n\t};\n\n});","sky.service(\"modelsManager\", [\"callbacks\", \"model\"], function({callbacks, model}) {\n\tclass Manager {\n\t\tconstructor(type, arr) {\n\n\t\t\tthis.items = [];\n\t\t\tthis.type = type;\n\t\t\tthis.events = callbacks();\n\n\t\t\t$.each(arr, (_, model) => {\n\t\t\t\tthis.items.push(model)\n\t\t\t});\n\t\t}\n\t\treloadFromArray(arr) {\n\t\t\tthis.items = [];\n\t\t\t$.each(arr, (_, data) => {\n\t\t\t\tthis.items.push(model.fromData(this.type, data))\n\t\t\t});\n\t\t}\n\t\tcount() {\n\t\t\treturn this.items.length;\n\t\t}\n\t\taddListener(func) {\n\t\t\tthis.events.on(\"change\", func);\n\t\t}\n\t\tremoveListener(func) {\n\t\t\tthis.events.off(\"change\", func);\n\t\t}\n\t}\n\n\tthis.service = {\n\t\tfromArray: function(type, arr) {\n\t\t\tlet items = [];\n\t\t\t$.each(arr, (_, data) => {\n\t\t\t\titems.push(sky.model.fromData(type, data));\n\t\t\t});\n\t\t\treturn new Manager(type, items);\n\t\t}\n\t};\n\n});","sky.service(\"modelsStorage\", function() {\n\n    let cache = {};\n\n    this.service = {\n\t\tadd: function(model) {\n\n\t\t\t// Search in cache\n\t\t\tlet cached = this.search(model.type, model.id());\n\n\t\t\t// If found extend\n\t\t\tif(cached)\n\t\t\t\treturn cached;\n\n            // Create type storage if none\n            if(!this.cache[model.type])\n                this.cache[model.type] = {};\n\n            // Save model\n            this.cache[model.type][model.id()] = model;\n\n\t\t},\n\n\t\tsearch: function(type, id) {\n\n\t\t\t// Cache search\n\t\t\tif(cache[type] && cache[type][id])\n\t\t\t\treturn cache[type][id];\n\n\t\t\t// On miss\n\t\t\treturn false;\n\t\t},\n\n\t\tremove: function(model) {\n\t\t\tdelete cache[model.type][model.id()];\n\t\t}\n\t}\n});","/**\n * For work with different type of notifications\n */\nsky.service(\"notifications\", [\"templates\", \"windows\", \"tips\"], function({templates, windows, tips}) {\n\n\tclass Message {\n\t\tconstructor({text, type = \"error\"}) {\n\t\t\tthis.render = templates.render(\"forms-message\", {type, text});\n\t\t}\n\n\t\t/**\n\t\t * Creates new modal window and appends message to it\n\t\t * @returns {*}\n\t\t */\n\t\tmodal() {\n\t\t\treturn windows.modal(this.render);\n\t\t}\n\n\t\t/**\n\t\t * Append to holder of modal window\n\t\t * @param {object} modal\n\t\t */\n\t\tappendToModal(modal) {\n\t\t\tmodal.holder.append(this.render);\n\t\t}\n\n\t\t/**\n\t\t * Shows notification in tip\n\t\t * @param object\n\t\t * @param align\n\t\t */\n\t\ttip(object, align) {\n\t\t\ttips.Tip(object, {create: this.render, close: 5}).show(align || \"top\");\n\t\t}\n\t}\n\n\treturn {\n\t\tmessage      : ({text, type = \"error\"}) => new Message({text, type}),\n\t\tfindInElement: element => element.find(\".notificationMessage\")\n\t}\n\n});","sky.service(\"pagination\", [\"templates\", \"stackList\"], function({ templates, stackList }) {\n\n\tlet list = stackList();\n\n\tclass Pagination {\n\t\tconstructor({ pages, holder, current = 1, }) {\n\n\t\t\t/* Self creation */\n\t\t\tif(!(this instanceof Pagination))\n\t\t\t\treturn new Pagination({ pages, holder, current });\n\n\t\t\t/* Save */\n\t\t\tlist.add(this);\n\n\t\t\t/* Set total pages */\n\t\t\tthis.pages \t\t= pages;\n\t\t\tthis.current \t= current;\n\t\t\tthis.pageWidth\t= 50;\n\t\t\tthis.id \t\t= last;\n\n\t\t\t/* No pages needed */\n\t\t\tif(this.pages < 2)\n\t\t\t\treturn this;\n\n\t\t\t/* Counted params */\n\t\t\tthis.dimensions = {\n\t\t\t\tstartPage      : 1,\n\t\t\t\tlastStartPage  : 0,\n\t\t\t\tpagesVisible   : 0,\n\t\t\t\tpagesInvisible : 0,\n\t\t\t\tscrollAvailable: 0,\n\t\t\t\tscrollStart\t   : 0,\n\t\t\t\ttumbler\t\t   : 10\n\t\t\t};\n\n\t\t\t/* Render */\n\t\t\tthis.dom = {};\n\t\t\tthis.dom.holder  = templates.render(\"pagination\", {}).data(\"pagination\", this);\n\t\t\tthis.dom.slider  = this.dom.holder.find(\".pages\");\n\t\t\tthis.dom.pages   = this.dom.slider.children();\n\t\t\tthis.dom.back \t = this.dom.holder.children(\".left\");\n\t\t\tthis.dom.forward = this.dom.holder.children(\".right\");\n\n\t\t\t/* Insert */\n\t\t\tif(holder)\n\t\t\t\tthis.dom.holder.appendTo(holder);\n\n\t\t\t/* If bigger than 10000 */\n\t\t\tif(this.pages > 9999) {\n\t\t\t\tthis.dom.slider.addClass(\"tenthousand\");\n\t\t\t\tthis.pageWidth = 80;\n\t\t\t}\n\t\t\t/* If bigger than 1000 */\n\t\t\telse if(this.pages > 999) {\n\t\t\t\tthis.dom.slider.addClass(\"thousand\");\n\t\t\t\tthis.pageWidth = 70;\n\t\t\t}\n\t\t\t/* If bigger 100 */\n\t\t\telse if(this.pages > 99 ) {\n\t\t\t\tthis.dom.slider.addClass(\"hundred\");\n\t\t\t\tthis.pageWidth = 60;\n\t\t\t}\n\n\t\t\t/* Make all */\n\t\t\tthis.redraw();\n\n\t\t\t/* Mark page */\n\t\t\tthis.goToPage(this.current);\n\n\t\t\t/* Self return */\n\t\t\treturn this;\n\n\t\t}\n\n\t\t/** */\n\t\tonPageChange(newPage) {}\n\n\t\t/** Removes navigator */\n\t\tremove() {\n\t\t\tthis.dom.holder.remove();\n\t\t\tlist.remove(this);\n\t\t}\n\n\t\t/**\n\t\t * Redraws pagination\n\t\t */\n\t\tredraw() {\n\n            /* No action on invisible */\n            if(!this.dom.holder.is(\":visible\"))\n                return;\n\n\t\t\t/* Reset width */\n\t\t\tthis.dom.slider.css(\"width\", \"auto\");\n\n\t\t\t/* Count visible sizes */\n\t\t\tthis.dimensions.pagesVisible = Math.floor((this.dom.holder.innerWidth() - 100) / this.pageWidth);\n\n\t\t\t/* Count invisible */\n\t\t\tthis.dimensions.pagesInvisible = (this.pages - this.dimensions.pagesVisible) > 0 ? this.pages - this.dimensions.pagesVisible : 0;\n\n\t\t\t/* Count last start */\n\t\t\tthis.dimensions.lastStartPage = this.dimensions.pagesInvisible + 1;\n\n\t\t\t/* Get max pages */\n\t\t\tlet toShow = this.dimensions.pagesVisible > this.pages ? this.pages : this.dimensions.pagesVisible;\n\n\t\t\t/* Crop */\n\t\t\tthis.dom.slider.css(\"width\", toShow * this.pageWidth);\n\n\t\t\t/* Redraw pages */\n\t\t\tthis.drawPages(this.dimensions.startPage);\n\n\t\t\t/* Try to create scroll */\n\t\t\tthis.createScroll();\n\n\t\t\t/* Set scroll position */\n\t\t\tif(this.dom.scrollLine)\n\t\t\t\tthis.dom.runner.css(\"left\", this.calculate().scroll);\n\n\t\t}\n\n\t\t/**\n\t\t * Create scroll line if needed\n\t\t */\n\t\tcreateScroll() {\n\n\t\t\t/* If no scroll needed */\n\t\t\tif(this.pages <= this.dimensions.pagesVisible) {\n\t\t\t\tif(this.dom.scrollLine) {\n\t\t\t\t\tthis.dom.scrollLine.remove();\n\t\t\t\t\tthis.dom.scrollLine = false;\n\t\t\t\t}\n\t\t\t\treturn;\n\t\t\t} else if(!this.dom.scrollLine) {\n\n\t\t\t\t/* Create scroll */\n\t\t\t\tthis.dom.scrollLine = templates.render(\"pagination-scroll\", {}).appendTo(this.dom.slider);\n\t\t\t\tthis.dom.runner = this.dom.scrollLine.children();\n\t\t\t}\n\n\t\t\t/* Count left */\n\t\t\tthis.dimensions.scrollStart = this.dom.scrollLine.position().left + 2;\n\n\t\t\t/* Count scroll line width */\n\t\t\tthis.dimensions.scrollAvailable = this.dom.scrollLine.outerWidth() - this.dom.scrollLine.children().outerWidth() - 4;\n\t\t\n\t\t}\n\n\t\t/**\n\t\t * Calculates related coordinates between scroll and move part\n\t\t */\n\t\tcalculate(position) {\n\n\t\t\t/* Get position */\n\t\t\tif(position === undefined)\n\t\t\t\tposition = this.dom.runner.offset().left  - this.dimensions.scrollStart;\n\n\t\t\t/* Remove start */\n\t\t\tposition = position - this.dimensions.scrollStart;\n\n\t\t\t/* Correct */\n\t\t\tposition = position > 0 ? position : 0;\n\n\t\t\t/* Count pages */\n\t\t\treturn {\n\t\t\t\tpages : Math.floor(this.dimensions.pagesInvisible * (position / this.dimensions.scrollAvailable)) + 1,\n\t\t\t\tscroll: Math.floor(this.dimensions.scrollAvailable * (this.dimensions.startPage - 1)/ this.dimensions.pagesInvisible + this.dimensions.scrollStart)\n\t\t\t}\n\n\t\t}\n\n\t\t/**\n\t\t * Draws pages according to start\n\t\t * @param {int} start Page to start from\n\t\t */\n\t\tdrawPages(start) {\n\n\t\t\t/* Remove old pages */\n\t\t\tthis.dom.pages.html(\"\");\n\n\t\t\t/* Correct */\n\t\t\tif(start > this.dimensions.pagesInvisible)\n\t\t\t\tstart = this.dimensions.pagesInvisible + 1;\n\n\t\t\t/* Correct */\n\t\t\tif(start < 1)\n\t\t\t\tstart = 1;\n\n\t\t\t/* Start position */\n\t\t\tlet i = start;\n\n\t\t\t/* Draw pages */\n\t\t\twhile(i <= this.pages && i < start + this.dimensions.pagesVisible) {\n\t\t\t\ttemplates.render(\"pagination-page\", { page: i, current: this.current }).appendTo(this.dom.pages);\n\t\t\t\ti++;\n\t\t\t}\n\n\t\t\t/* Reset start page */\n\t\t\tthis.dimensions.startPage = start;\n\n\n\t\t}\n\n\t\t/**\n\t\t * Sets page as active\n\t\t * @param {int} page Page number\n\t\t * @returns {Pagination}\n\t\t */\n\t\tgoToPage(page) {\n\n\t\t\t/* If no pages */\n\t\t\tif(this.pages < 2)\n\t\t\t\treturn this;\n\n\t\t\t/* Parse */\n\t\t\tpage = parseInt(page);\n\n\t\t\t/* Correct */\n\t\t\tif(page < 1)\n\t\t\t\tpage = 1;\n\t\t\telse if(page > this.pages)\n\t\t\t\tpage = this.pages;\n\n\t\t\t/* Checks if page is visible */\n\t\t\tlet isVisible = this.dimensions.startPage <= page && page < this.dimensions.startPage + this.dimensions.pagesVisible;\n\n\t\t\t/* Redraws if needed */\n\t\t\tif(!isVisible) {\n\t\t\t\tthis.drawPages(page);\n\t\t\t\tif(this.dom.scrollLine)\n\t\t\t\t\tthis.dom.runner.css(\"left\", this.calculate().scroll);\n\t\t\t}\n\n\t\t\t/* Make active */\n\t\t\tthis.dom.pages.children().removeClass(\"active\").filter(\"[page=\" + page +\"]\").addClass(\"active\");\n\n\t\t\t/* Forward buttons disable */\n\t\t\tif(page > 1) this.dom.back.enable();\n\t\t\telse this.dom.back.disable();\n\n\t\t\t/* Backward button disable */\n\t\t\tif(page === this.pages) this.dom.forward.disable();\n\t\t\telse this.dom.forward.enable();\n\n\t\t\t/* Callback */\n\t\t\tif(this.current !== page)\n\t\t\t\tthis.onPageChange(page);\n\n\t\t\t/* Save page state */\n\t\t\tthis.current = page;\n\n\t\t\t/* Self return */\n\t\t\treturn this;\n\n\t\t}\n\n\t\t/** Set scroll */\n\t\tscroll(event) {\n\n\t\t\tlet pos = event.pageX - 10;\n\t\t\tif(this.dimensions.scrollStart > pos)\n\t\t\t\tpos = this.dimensions.scrollStart;\n\t\t\tif(this.dimensions.scrollStart + this.dimensions.scrollAvailable < pos)\n\t\t\t\tpos = this.dimensions.scrollStart + this.dimensions.scrollAvailable;\n\n\t\t\tthis.dom.runner.css({left: pos});\n\t\t\tthis.drawPages(this.calculate(pos).pages);\n\n\t\t}\n\n\t}\n\n\t/* Bind windows events */\n\t$(window).on(\"resize\", function() {\n\t\tlist.each(() => { this.redraw(); });\n\t});\n\n\t/* Return */\n\tthis.service = {\n\t\tadd: function(options) {\n\t\t\treturn new Pagination(options);\n\t\t}\n\t}\n\n});","sky.service(\"stackList\", [\"utils\"], function({ utils }) {\n\tlet List = this.service = function() {\n\n\t\tif(!(this instanceof List))\n\t\t\treturn new List();\n\n\t\tlet elements = {};\n\t\tlet lastId = 0;\n\t\tlet total = 0;\n\n\t\tthis.last = function() {\n\n\t\t\t/* Holder */\n\t\t\tlet last = undefined;\n\n\t\t\t/* Apply for windows */\n\t\t\tthis.each(element => { last = element });\n\n\t\t\t/* Return */\n\t\t\treturn last;\n\n\t\t};\n\n\t\tthis.add = function(element, id = false) {\n\t\t\tlastId++;\n\t\t\ttotal++;\n\t\t\telements[id || lastId] = element;\n\t\t};\n\n\t\tthis.remove = function(element) {\n\t\t\t/* Apply for windows */\n\t\t\tfor(let index in elements)\n\t\t\t\tif(elements.hasOwnProperty(index) && elements[index] === element) {\n\t\t\t\t\tdelete elements[index];\n\t\t\t\t\ttotal--;\n\t\t\t\t}\n\t\t};\n\n\t\tthis.total = function() {\n\t\t\treturn total;\n\t\t};\n\n\t\tthis.getById = function(id) {\n\t\t\treturn elements[id];\n\t\t};\n\n\t\tthis.elements = function() {\n\t\t\treturn elements;\n\t\t};\n\n\t\tthis.each = function(callback) {\n\t\t\tutils.each(elements, (id, single) => {\n\t\t\t\tcallback.apply(single, [single, id]);\n\t\t\t});\n\n\t\t};\n\n\t}\n});","sky.onReady(({suggester}) => {\n\t$(document).on(\"click\", function(event) {\n\n\t\t/* Get element */\n\t\tlet element = $(event.target || event.srcElement);\n\n\t\t/* If click in replace we should not hide it */\n\t\tif(element.is(\"[type=submit]\") || element.closest(\".suggester\").length || element.data(\"suggester\"))\n\t\t\treturn;\n\n\t\t/* Hide all */\n\t\tsuggester.hide();\n\n\t});\n});\n\nsky.service(\"suggester\", [\"templates\"], function({templates}) {\n\n\tlet render,\n\t\tobject,\n\t\tlastList,\n\t\tsuggester = this.service = {\n\t\t\thide: function() {\n\n\t\t\t\tif(render) {\n\t\t\t\t\trender.remove();\n\t\t\t\t\trender = false;\n\t\t\t\t}\n\t\t\t\tif(object) {\n\t\t\t\t\tobject.removeData(\"suggester\");\n\t\t\t\t\tobject = false;\n\t\t\t\t}\n\t\t\t\t$(document).off(\"keyup.suggester, keydown.suggester\");\n\t\t\t},\n\t\t\tshow: function(input, list) {\n\n\t\t\t\t/* Hide previous */\n\t\t\t\tsuggester.hide();\n\n\t\t\t\t/* Save */\n\t\t\t\tlastList = list;\n\t\t\t\trender = templates.render(\"suggester\", {items: list}).insertAfter(input.closest(\"label, .label\"));\n\t\t\t\tobject = input.data(\"suggester\", render);\n\n\t\t\t\t/* Get positions */\n\t\t\t\tlet elementPosition = input.offset(),\n\t\t\t\t\trenderPosition = render.offset();\n\n\t\t\t\t/* Show */\n\t\t\t\trender.css({\n\t\t\t\t\t\"margin-left\": elementPosition.left - renderPosition.left,\n\t\t\t\t\t\"margin-top\": elementPosition.top - renderPosition.top + input.outerHeight()\n\t\t\t\t});\n\n\t\t\t\t/* Add handlers */\n\t\t\t\tlet children = render.children().on(\"click\", function() {\n\t\t\t\t\tinput.val($(this).html());\n\t\t\t\t\tsuggester.hide();\n\t\t\t\t\tif(lastList[$(this).attr(\"data-index\")].callback)\n\t\t\t\t\t\tlastList[$(this).attr(\"data-index\")].callback();\n\t\t\t\t});\n\n\t\t\t\t$(document).on(\"keyup.suggester\", function(event) {\n\n\t\t\t\t\tif(event.keyCode === 38 || event.keyCode === 40) {\n\n\t\t\t\t\t\tlet selected = children.filter(\".selected\");\n\t\t\t\t\t\tchildren.removeClass(\"selected\");\n\n\t\t\t\t\t\t// Up\n\t\t\t\t\t\tif(event.keyCode === 38) {\n\t\t\t\t\t\t\tif(!selected.length || !selected.prev().length)\n\t\t\t\t\t\t\t\tchildren.last().addClass(\"selected\");\n\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t\tselected.prev().addClass(\"selected\");\n\t\t\t\t\t\t}\n\t\t\t\t\t\t// Down\n\t\t\t\t\t\tif(event.keyCode === 40) {\n\t\t\t\t\t\t\tchildren.removeClass(\"selected\");\n\t\t\t\t\t\t\tif(!selected.length || !selected.next().length) {\n\t\t\t\t\t\t\t\tchildren.first().addClass(\"selected\")\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tselected.next().addClass(\"selected\");\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\t// Esc\n\t\t\t\t\tif(event.keyCode === 27) suggester.hide();\n\n\n\t\t\t\t}).on(\"keydown.suggester\", function(event) {\n\n\t\t\t\t\t// Enter\n\t\t\t\t\tif(event.keyCode !== 13) return;\n\n\t\t\t\t\tlet selected = children.filter(\".selected\");\n\t\t\t\t\tif(selected.length) {\n\t\t\t\t\t\tselected.trigger(\"click\");\n\t\t\t\t\t\tevent.preventDefault();\n\t\t\t\t\t} else {\n\t\t\t\t\t\tsuggester.hide();\n\t\t\t\t\t}\n\n\t\t\t\t});\n\t\t\t}\n\t\t};\n});","/**\n * Module to work with user services\n */\nsky.service(\"supported\", function () {\n\ttry {\n\t\tthis.service.fullScreen = typeof document[\"webkitIsFullScreen\"] !== \"undefined\";\n\t\tthis.service.formData = window.FormData && true;\n\t\t// this.service.XHRIsSupported = XHRIsSupported;\n\t\tthis.service.XHRUpload = (typeof new XMLHttpRequest().upload !== \"undefined\");\n\t\tthis.service.localStorage = !!window.localStorage;\n\t} catch (e) {}\n});","sky.service(\"templates\", [\"localStorage\", \"supported\", \"directives\", \"exceptions\", \"utils\"], function({localStorage, supported, directives, exceptions, utils}) {\n\n\n\tlet templatesList     = {},\n\t\ttemplatesCompiled = {},\n\t\tTemplates         = this.service = {\n\n\t\t\t/** Globals list */\n\t\t\tglobals: {},\n\n\t\t\t/** Local storage support */\n\t\t\tstorage: supported.localStorage ? new localStorage({name: \"jsTemplates\"}) : false,\n\n\t\t\t/**\n\t\t\t * Adds new template to list\n\t\t\t * @param options\n\t\t\t */\n\t\t\tadd: function(options) {\n\t\t\t\ttemplatesList[options.name] = options.template;\n\t\t\t\tif(this.storage) {\n\t\t\t\t\tthis.storage.save(options.name, options.template);\n\t\t\t\t\t$.cookie(\"storedTemplates-\" + options.name, options.date);\n\t\t\t\t}\n\t\t\t},\n\n\t\t\trenderByNameWithHolder: function(name, data, noDirectives) {\n\n\t\t\t\t/* Compile template */\n\t\t\t\tlet template = this.compile(name);\n\n\t\t\t\t/* Add globals */\n\t\t\t\tdata = utils.extend(true, {}, data, {globals: this.globals});\n\n\t\t\t\t/* return */\n\t\t\t\treturn this.coverWithHolder(template.render(data), noDirectives);\n\n\t\t\t},\n\n\t\t\trenderByTextWithHolder: function(text, data, noDirectives) {\n\n\n\t\t\t\t/* Add globals */\n\t\t\t\tdata = utils.extend(true, {}, data, {globals: this.globals});\n\n\t\t\t\t/* return */\n\t\t\t\treturn this.coverWithHolder(Twig.twig({data: text}).render(data), noDirectives);\n\n\t\t\t},\n\n\t\t\tcoverWithHolder: function(text, noDirectives) {\n\n\t\t\t\t/* Render */\n\t\t\t\tlet temp = document.createElement('div');\n\t\t\t\ttemp.innerHTML = text.trim();\n\n\t\t\t\t/* Parse directives */\n\t\t\t\tif(!noDirectives)\n\t\t\t\t\tdirectives.parse(temp);\n\n\t\t\t\t/* Return */\n\t\t\t\treturn temp;\n\n\t\t\t},\n\n\t\t\t/**\n\t\t\t * Renders specified template\n\t\t\t * @param {String} name Template name\n\t\t\t * @param {Object} data Inner data\n\t\t\t * @param {bool} [noDirectives]\n\t\t\t * @returns {*}\n\t\t\t */\n\t\t\trender: function(name, data, noDirectives) {\n\n\t\t\t\t/* Compile template */\n\t\t\t\treturn $(this.renderByNameWithHolder(name, data, noDirectives).childNodes);\n\n\t\t\t},\n\n\t\t\t/**\n\t\t\t * Renders specified template and returns text\n\t\t\t * @param {String} name Template name\n\t\t\t * @param {Object} data Inner data\n\t\t\t * @param {bool} [noDirectives]\n\t\t\t * @returns {*}\n\t\t\t */\n\t\t\trenderToText: function(name, data, noDirectives) {\n\n\t\t\t\t/* Compile template */\n\t\t\t\treturn this.renderByNameWithHolder(name, data, noDirectives).innerHTML;\n\n\t\t\t},\n\n\t\t\t/**\n\t\t\t * Renders template by its text as parameter\n\t\t\t * @param {string} text Template text\n\t\t\t * @param {Object} data Inner data\n\t\t\t * @param {bool} [noDirectives]\n\t\t\t * @returns {XMLList|*}\n\t\t\t */\n\t\t\trenderByText: function(text, data, noDirectives) {\n\t\t\t\treturn $(this.renderByTextWithHolder(text, data, noDirectives).childNodes);\n\t\t\t},\n\n\t\t\t/**\n\t\t\t * Renders template by its text as parameter\n\t\t\t * @param {string} text Template text\n\t\t\t * @param {Object} data Inner data\n\t\t\t * @param noDirectives\n\t\t\t * @returns {XMLList|*}\n\t\t\t */\n\t\t\trenderByTextToText: function(text, data, noDirectives) {\n\t\t\t\treturn this.renderByTextWithHolder(text, data, noDirectives).innerHTML;\n\t\t\t},\n\n\t\t\t/**\n\t\t\t * Compiles specified template\n\t\t\t * @param {string} name Template name\n\t\t\t */\n\t\t\tcompile: function(name) {\n\n\t\t\t\t/* If already compiled */\n\t\t\t\tif(!templatesCompiled[name]) {\n\n\t\t\t\t\t/* Load */\n\t\t\t\t\tlet template = this.load(name);\n\n\t\t\t\t\t/* Compile */\n\t\t\t\t\tlet compiled = Twig.twig({ id: name, data: template });\n\n\t\t\t\t\t/* Check */\n\t\t\t\t\tif(!compiled)\n\t\t\t\t\t\tthrow new exceptions.system.Error('Error during compiling template \"' + name + '\"');\n\n\t\t\t\t\t/* Save */\n\t\t\t\t\ttemplatesCompiled[name] = compiled;\n\n\t\t\t\t}\n\n\t\t\t\t/* Save */\n\t\t\t\treturn templatesCompiled[name];\n\n\t\t\t},\n\n\t\t\t/**\n\t\t\t * Loads specified template\n\t\t\t * @param {string} name Template name\n\t\t\t */\n\t\t\tload: function(name) {\n\n\t\t\t\t/* Loaded */\n\t\t\t\tlet fromLS;\n\n\t\t\t\t/* Try to load from storage */\n\t\t\t\tif(!templatesList[name] && this.storage && (fromLS = this.storage.load(name)))\n\t\t\t\t\treturn templatesList[name] = fromLS;\n\n\t\t\t\t/* If already compiled */\n\t\t\t\tif(templatesList[name])\n\t\t\t\t\treturn templatesList[name];\n\n\t\t\t\t/* Load template */\n\t\t\t\tif(!(templatesList[name] = $('script[type=\"text/template\"][id=' + name + ']').html()))\n\t\t\t\t\tthrow new exceptions.system.Error(\"Can't find template  \" + name);\n\n\t\t\t\t/* Save to LS */\n\t\t\t\tif(this.storage)\n\t\t\t\t\tthis.storage.save(name, {template: templatesList[name]});\n\n\t\t\t\t/* Return */\n\t\t\t\treturn templatesList[name]\n\n\t\t\t}\n\n\t\t};\n\n\tsky.directive('script[type=\"text/template\"], template', function(template, attrs) {\n\t\tTemplates.add({\n\t\t\tname    : attrs.id,\n\t\t\ttemplate: template.html()\n\t\t});\n\t});\n\n\n\t/* Save templates files data */\n\tsky.onReady(() => {\n\t\tif(window.page.data.templates && supported.localStorage) {\n\t\t\tutils.each(window.page.data.templates, function(_, template) {\n\t\t\t\t$.cookie(\"storedTemplates-\" + template.path, template.date);\n\t\t\t});\n\t\t}\n\t});\n\n});\n","sky.service(\"tips\", [\"stackList\", \"callbacks\"], function({ stackList, callbacks }) {\n\n    /** Class to work with tips */\n    let list = stackList(),\n        tips = this.service = {\n\n\t\t\t/**\n\t\t\t * Hides all visible tips\n\t\t\t * @param withoutAutoHide\n\t\t\t * @param caller\n\t\t\t */\n        hideAll: function(withoutAutoHide, caller) {\n\n            /* Hide all tips */\n            list.each((tip) => {\n                if(withoutAutoHide)\n\t\t\t\t\ttip.hide();\n                else if(tip.autoHide && (!caller || !caller.closest(tip.tip).length && !caller.closest(tip.object).length)) {\n\t\t\t\t\ttip.hide();\n                }\n            });\n\n        },\n\n        /**\n         * Returns last open window if any\n         * @returns {tips.Tip|boolean}\n         */\n        getLast: function() {\n            list.last();\n        },\n\n        /**\n         * Add show/hide functions\n         * @param {string}            selector            Object to bind tips for\n         * @param {string}            align                Align of tip\n         * @param options\n         * @see tips.tip\n         */\n        bind: function(selector, align, options) {\n\n            /* Create binds */\n            $(selector).on({\n                \"mouseenter\": function() {\n                    let tip = $(this).data(\"tip\") || tips.Tip(this, options).show(align);\n                },\n                \"mouseleave\": function() {\n                    let tip = $(this).data(\"tip\");\n                    if(tip) tip.hide(align);\n                }\n            });\n\n        },\n\n        /**\n         * Creates new tip object\n         * @param {object}            object                Object to show tip for\n         * @param autoHide\n         * @param create\n         * @param close\n         * @param ajax\n         * @param highlight\n         * @param className\n         * @constructor\n         */\n        Tip: function(object, { autoHide = true, create = false, close = false, ajax = false, highlight = false, className = false } = {}) {\n\n            /* Auto construct */\n            if(!(this instanceof tips.Tip))\n                return new tips.Tip(object, { autoHide, create, close, ajax, highlight, className });\n\n            /* Old tip exists */\n            if($(object).data(\"tip\"))\n                return $(object).data(\"tip\");\n\n            /* Add to list */\n\t\t\tlist.add(this);\n\n            /* Manual create tip by create function */\n            if(typeof create === \"function\") {\n\n                /* Create tip */\n                this.tip = create(object);\n\n                /* If no tip */\n                if(!this.tip) return this;\n\n            }\n\n            /* Object set */\n            this.object = $(object).data(\"tip\", this);\n\n            /* Save callbacks */\n            this.callbacks = callbacks();\n\n            /* Auto hide */\n            this.autoHide = autoHide;\n\n            /* Manual create tip by create function */\n            if(typeof create !== \"function\") {\n\n                /* Create tip */\n                this.tip = $(\"<div/>\").addClass(\"tip\").append('<div class=\"tipContent\"></div>').insertBefore(object);\n\n                /* Title using */\n                if(!create && this.object.attr('title'))\n\t\t\t\t\tcreate = this.object.attr('title');\n                else if(!create)\n\t\t\t\t\tcreate = \" \";\n\n                this.tip.find(\".tipContent\").append(create);\n\n            }\n\n            if(highlight)\n                this.shadow = $('<div/>').css({ opacity: 0, position:\"absolute\", width: \"100%\", height: \"100%\", left:0 ,top:0, background: \"rgba(0,0,0,0.5)\" }).appendTo(\"body\");\n\n            /* If count down */\n            if(typeof close === \"number\")\n                this.closeTimeout = setTimeout(() => this.hide(), close);\n\n            /* If close button */\n            else if(close)\n                $('<div/>').addClass('close').appendTo(this.tip).on(\"click\", () => this.hide());\n\n            /* If stop possible */\n            if(ajax)  ajax.on(\"always\", () => this.hide());\n\n            /* Add to list */\n            if(className)\n                this.tip.addClass(className);\n\n            /* Add to list */\n            this.tip.css(\"display\", \"none\");\n\n            return this;\n\n        }\n\n    };\n\n    /**\n     * Extends tip\n     */\n    $.extend(tips.Tip.prototype, /** @lends tips.tip */ {\n\n        /**\n         * Shows tip according to type\n         * @param {string} [align] Way it would be shown\n         */\n        show: function(align) {\n\n            /* Back link */\n            let self   = this;\n            let offset = this.tip.css({left: \"\", top: \"\", marginLeft: \"\", marginTop: \"\", display: \"\"}).addClass(align).offset();\n\n            /* Stop animation and shows */\n            this.tip.stop();\n\n            /* Save way to show */\n            if(align) this.align = align;\n\n            /* If shadow */\n            if(this.shadow)\n                this.shadow.stop().show().animate({opacity: 1}, 100);\n\n            /* Different actions according to tip position */\n            switch(this.align) {\n\n                /* If show righter than input */\n                case \"right\":\n                {\n                    this.tip.css({\n                        marginLeft: this.object.offset().left + this.object.outerWidth() - offset.left,\n                        marginTop : this.object.offset().top - offset.top + parseInt((this.object.outerHeight() - this.tip.outerHeight()) / 2),\n                        opacity   : 0\n                    });\n                    this.tip.animate({opacity: 1, marginLeft: \"+=10\"}, 100);\n                    break;\n                }\n                /* If show righter than input */\n                case \"left\":\n                {\n                    this.tip.css({\n                        marginLeft: this.object.offset().left - offset.left - this.tip.outerWidth(),\n                        marginTop : this.object.offset().top - offset.top + parseInt((this.object.outerHeight() - this.tip.outerHeight()) / 2),\n                        opacity   : 0\n                    });\n                    this.tip.animate({opacity: 1, marginLeft: \"-=10\"}, 300);\n                    break;\n                }\n                /* If show topper */\n                case \"top\":\n                {\n\n                    // Count left offset\n                    let left = this.object.offset().left - offset.left;\n\n                    /* Reposition */\n                    if(offset.left + left + this.tip.outerWidth() > $(window).outerWidth())\n                        left = left - this.tip.outerWidth() + this.object.outerWidth();\n\n                    /* Position */\n                    this.tip.css({\n                        marginLeft: left,\n                        marginTop : this.object.offset().top - this.tip.outerHeight() - offset.top,\n                        opacity   : 0\n                    });\n\n                    this.tip.animate({opacity: 1, marginTop: \"-=10\"}, 300);\n                    break;\n                }\n                /* If show topper */\n                case \"bottom\":\n                {\n\n                    let left = this.object.offset().left - offset.left;\n\n                    /* Reposition */\n                    if(offset.left + left + this.tip.outerWidth() > $(window).outerWidth())\n                        left = left - this.tip.outerWidth() + this.object.outerWidth();\n\n                    /* Position */\n                    this.tip.css({\n                        marginLeft: left,\n                        marginTop : this.object.offset().top + this.object.outerHeight() - offset.top,\n                        opacity   : 0\n                    });\n\n                    this.tip.animate({opacity: 1, marginTop: \"+=10\"}, 300);\n                    break;\n                }\n                /* If we replace input with tip */\n                case \"instead\":\n                {\n                    this.tip.css({\n                        width  : this.object.outerWidth(),\n                        height : this.object.outerHeight(),\n                        display: \"none\"\n                    });\n                    this.object.fadeOut(100, function() {\n                        self.tip.fadeIn(100);\n                    }).get(0).blur();\n                    break;\n                }\n                case \"inside\":\n                {\n                    this.tip.css({\n                        width  : this.object.outerWidth(),\n                        height : this.object.outerHeight(),\n                        display: \"none\"\n                    });\n                    this.tip.css(\"opacity\", 0).animate({opacity: 1}, 100);\n                    break;\n                }\n                default:\n                    break;\n            }\n\n            this.tip.css({left: \"\", top: \"\"});\n\n            /* Self return */\n            return this;\n\n        },\n\n        /**\n         * Hides current tip\n         */\n        hide: function() {\n\n            /* Remove count down if needed */\n            if(this.closeTimeout)\n                clearTimeout(this.closeTimeout);\n\n            /* Stop animation */\n            this.tip.stop();\n\n            /* Get know how tip was shown */\n            let align = this.align;\n\n            /* Create end animation callback */\n            let callback = () => {\n\n                /* Delete record from global list */\n                list.remove(this);\n\n                /* Remove data */\n                this.object.removeData(\"tip\");\n\n                /* Remove tip */\n                this.tip.remove();\n\n                /* Callback */\n                this.callbacks.fire(\"hide\", this);\n\n            };\n\n            /* If just shown */\n            if(!align)\n                callback();\n\n            /* If shadow */\n            if(this.shadow)\n                this.shadow.animate({opacity: 0}, 100, () => { this.shadow.remove() });\n\n            /* Right way hide */\n            if(align === \"right\")\n                this.tip.animate({opacity: 0, marginLeft: \"+=10\"}, 100, callback);\n\n            /* Left way hide */\n            if(align === \"left\")\n                this.tip.animate({opacity: 0, marginLeft: \"-=10\"}, 100, callback);\n\n            /* Instead way hide */\n            if(align === \"instead\")\n                this.tip.fadeOut({opacity: 0}, 200, callback);\n\n            /* Top way hide */\n            if(align === \"top\")\n                this.tip.animate({opacity: 0, marginTop: \"-=5\"}, 200, callback);\n\n            /* Bottom way hide */\n            if(align === \"bottom\")\n                this.tip.animate({opacity: 0, marginTop: \"+=5\"}, 200, callback);\n\n            /* Inside way hide */\n            if(align === \"inside\")\n                this.tip.animate({opacity: 0}, 200, callback);\n\n            /* Self return */\n            return this;\n\n        },\n\n        /**\n         * Gets tips dom\n         * @returns {*}\n         */\n        get: function() {\n            return this.tip;\n        },\n\n        /**\n         * Sets tip text\n         * @param {string|jQuery} text What to insert to tip body\n         */\n        set: function(text) {\n            this.tip.children(\".tipContent\").html(text);\n            return this;\n        },\n\n        /**\n         * Adds something to tip\n         * @param {string|jQuery} what What to append to tip body\n         */\n        add: function(what) {\n            this.tip.children(\".tipContent\").append(what);\n            return this;\n        }\n\n    });\n\n});","sky.service(\"utils\", function() {\n\tthis.service = {\n\n\t\textend: function() {\n\t\t\treturn $.extend.apply($, arguments);\n\t\t},\n\n\t\teach: function() {\n\t\t\treturn $.each.apply($, arguments);\n\t\t},\n\n\t\t/**\n\t\t * Checks if object has same data\n\t\t * @param first\n\t\t * @param second\n\t\t */\n\t\tisObjectsEqual: function(first, second) {\n\n\t\t\t/* Different types */\n\t\t\tif(typeof first !== typeof second)\n\t\t\t\treturn false;\n\n\t\t\t/* If object or array we will compare each element */\n\t\t\tif(first instanceof Array || first instanceof Object) {\n\t\t\t\tlet key;\n\t\t\t\t/* Check first */\n\t\t\t\tfor(key in first) {\n\t\t\t\t\tif(!first.hasOwnProperty(key)) continue;\n\t\t\t\t\tif(typeof second[key] === \"undefined\") return false;\n\t\t\t\t\telse if(!this.isObjectsEqual(first[key], second[key])) return false;\n\t\t\t\t}\n\n\t\t\t\t/* Check second */\n\t\t\t\tfor(key in second) {\n\t\t\t\t\tif(!second.hasOwnProperty(key)) continue;\n\t\t\t\t\tif(typeof first[key] === \"undefined\") return false;\n\t\t\t\t}\n\n\t\t\t} else if(first !== second) return false;    // For simple types\n\n\t\t\t/* All tests success */\n\t\t\treturn true;\n\n\t\t},\n\n\t\t/**\n\t\t * Adds zero\n\t\t * @param value\n\t\t * @returns {Number}\n\t\t */\n\t\taddLeadingZero: function(value) {\n\n\t\t\t/* Parse */\n\t\t\tvalue = parseInt(value);\n\n\t\t\t/* Ad zero */\n\t\t\tif(value < 10)\n\t\t\t\tvalue = \"0\" + value;\n\n\t\t\t/* Val */\n\t\t\treturn value;\n\n\t\t},\n\n\t\tencode: function(rawStr) {\n\t\t\treturn rawStr.replace(/[\\u00A0-\\u9999<>&]/gim, function(i) {\n\t\t\t\treturn '&#' + i.charCodeAt(0) + ';';\n\t\t\t});\n\t\t},\n\n\t\t/**\n\t\t * Makes data to JSON past\n\t\t * @param data\n\t\t * @param [inputName]\n\t\t * @returns {string}\n\t\t */\n\t\tjsonData: function(data, inputName) {\n\t\t\treturn '<script type=\"application/json\"' + (inputName ? (' input-name=\"' + inputName + '\"') : \"\") + '>' + sky.encode(JSON.stringify(data)) + '</script>';\n\t\t},\n\n\t\tprepareSelectData: function(items, func, {columnSplitOn = 6, maxColumns = 4}) {\n\n\t\t\tlet index        = 0,\n\t\t\t\tcolumns      = [],\n\t\t\t\tcolumnsCount = items.length / columnSplitOn,\n\t\t\t\tgroupHolder,\n\t\t\t\tcompiled;\n\n\t\t\tif(columnsCount < 1)\n\t\t\t\tcolumnsCount = 1;\n\t\t\tif(columnsCount > maxColumns)\n\t\t\t\tcolumnsCount = maxColumns;\n\n\t\t\tlet perColumn = Math.ceil(items.length / columnsCount);\n\n\t\t\tfor(let item of items) {\n\t\t\t\tif(compiled = func({item, index, column: columns.length})) {\n\n\t\t\t\t\tif(index % perColumn === 0) {\n\t\t\t\t\t\tgroupHolder = [];\n\t\t\t\t\t\tcolumns.push(groupHolder);\n\t\t\t\t\t}\n\n\t\t\t\t\tgroupHolder.push(compiled);\n\t\t\t\t\tindex++;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn index === 0 ? [] : {groups: columns}\n\n\t\t}\n\t}\n});","sky.onReady(function({ validator }) {\n\tjQuery.fn.validForm = function() {\n\t\treturn validator.validateForm(this);\n\t}.safe();\n\tjQuery.fn.validationRule = function(name, options) {\n\t\treturn validator.addRule(this, name, options);\n\t}.safe();\n\t$(document).on(\"change keyup\", \"[data-validate]\", function() {\n\t\tvalidator.validateElement($(this));\n\t});\n});\n\nsky.service(\"validator\", function() {\n\n\t/**\n\t * Main validation object\n\t */\n\tlet validator = this.service = {\n\n\t\t/**\n\t\t * Validates specified form, or dom element\n\t\t * @param form\n\t\t */\n\t\tvalidateForm: function(form) {\n\n\t\t\tlet pass = true,\n\t\t\t\tself = this;\n\n\t\t\t/* Go through all elements that need to be validate */\n\t\t\tform.find(\"input, select, textarea, .selectReplace, [data-validate]\").filter(\":visible\").each(function() {\n\n\t\t\t\t/* Get element */\n\t\t\t\tlet element = $(this);\n\n\t\t\t\t/* validate if needed to */\n\t\t\t\tif(self.shouldBeValidated(element) && !self.validateElement(element, form))\n\t\t\t\t\tpass = false;\n\n\t\t\t});\n\n\t\t\t/* Return result */\n\t\t\treturn pass;\n\n\t\t},\n\n\t\t/**\n\t\t * Add rule to specified element\n\t\t * @param element\n\t\t * @param name\n\t\t * @param [options]\n\t\t */\n\t\taddRule: function(element, name, options) {\n\n\t\t\t/* Get or make options and add rule */\n\t\t\tthis.Options(element).addRule(name, options || {});\n\n\t\t\t/* Self return */\n\t\t\treturn this;\n\n\t\t},\n\n\t\t/**\n\t\t *\n\t\t * Validates specified element\n\t\t * @param {*} element Element to validate\n\t\t * @param {*} [form] Form to validate\n\t\t * @returns {boolean}\n\t\t */\n\t\tvalidateElement: function(element, form) {\n\n\t\t\tlet self = this,\n\t\t\t\toptions = this.Options(element),\n\t\t\t\ttotalPass = true,\n\t\t\t\tvalue = element.val(),\n\t\t\t\tlastError = false,\n\t\t\t\tfirstError = false,\n\t\t\t\tlastSuccess = false,\n\t\t\t\tfirstSuccess = false;\n\n\t\t\t/* Select replace */\n\t\t\tif(element.is(\".selectReplace\")) {\n\t\t\t\tlet inputs = element.next().find(\"input:checked\");\n\t\t\t\tif(!inputs.length)\n\t\t\t\t\tvalue = \"\";\n\t\t\t\telse if(element.is(\".single\"))\n\t\t\t\t\tvalue = element.next().find(\"input:checked\").val();\n\t\t\t\telse\n\t\t\t\t\tvalue = element.next().find(\"input:checked\").length ? \"true\" : \"\";\n\t\t\t}\n\n\t\t\t/* Go through rules */\n\t\t\t$.each(options.rules, function(name, ruleOverload) {\n\n\t\t\t\t/* Make compiled rule */\n\t\t\t\tlet compiledRule = jQuery.extend(true, {}, self.rules[name] || self.Rule({}), ruleOverload || {});\n\n\t\t\t\t/* Execute message is needed */\n\t\t\t\tif(typeof compiledRule.message === \"function\")\n\t\t\t\t\tcompiledRule.message = compiledRule.message.call(this);\n\n\t\t\t\t/* Check if element pass validation */\n\t\t\t\tlet pass = self.validate(value, compiledRule, element, form);\n\n\t\t\t\t/* Perform action according to result */\n\t\t\t\tif(pass) {\n\t\t\t\t\tcompiledRule.onSuccess(element, compiledRule);\n\t\t\t\t\tlastSuccess = compiledRule;\n\t\t\t\t\tif(!firstSuccess)\n\t\t\t\t\t\tfirstSuccess = compiledRule;\n\t\t\t\t} else {\n\t\t\t\t\tcompiledRule.onError(element, compiledRule);\n\t\t\t\t\tlastError = compiledRule;\n\t\t\t\t\tif(!firstError)\n\t\t\t\t\t\tfirstError = compiledRule;\n\t\t\t\t\ttotalPass = false;\n\t\t\t\t}\n\n\t\t\t});\n\n\t\t\t/* Total callbacks */\n\t\t\tif(totalPass)\n\t\t\t\toptions.onSuccess(element, lastSuccess);\n\t\t\telse\n\t\t\t\toptions.onError(element, firstError);\n\n\t\t\t/* Return true of element passed all validations */\n\t\t\treturn totalPass;\n\n\t\t},\n\n\t\t/**\n\t\t * Return true if element should be validated\n\t\t * @param {*} element Element to validate\n\t\t * @returns {boolean}\n\t\t */\n\t\tshouldBeValidated: function(element) {\n\t\t\treturn element.attr(\"data-validate\") || element.data(\"validationOptions\");\n\t\t},\n\n\t\t/**\n\t\t * Return true if element passed validation\n\t\t * @param element\n\t\t * @param compiledRule\n\t\t * @param form\n\t\t * @returns {*}\n\t\t * @param value\n\t\t */\n\t\tvalidate: function(value, compiledRule, element, form) {\n\t\t\treturn compiledRule.rule.call(compiledRule, value, element, form);\n\t\t}\n\n\t};\n\n\t/**\n\t * Defaults\n\t */\n\tvalidator.ruleDefaults = {\n\n\t};\n\n\t/**\n\t * Defaults\n\t * @type {{onSuccess: onSuccess, onError: onError}}\n\t */\n\tvalidator.optionsDefaults = {\n\n\t\t/* Fires on success */\n\t\tonSuccess: function(element) {\n\n\t\t\t/* Remove error */\n\t\t\telement.removeClass(this.errorClass);\n\n\t\t\t/* Add success */\n\t\t\tif(this.successClass)\n\t\t\t\telement.addClass(this.successClass);\n\n\t\t},\n\n\t\t/* Fires on error */\n\t\tonError: function(element) {\n\n\t\t\t/* Add error */\n\t\t\telement.addClass(this.errorClass);\n\n\t\t\t/* Remove success */\n\t\t\tif(this.successClass)\n\t\t\t\telement.removeClass(this.successClass);\n\n\t\t}\n\t};\n\n\t/**\n\t * Base rule object\n\t * @param overload\n\t * @returns {validator.Rule}\n\t * @constructor\n\t */\n\tvalidator.Rule = function(overload) {\n\n\t\t/* Self creation if needed */\n\t\tif(!(this instanceof validator.Rule))\n\t\t\treturn new validator.Rule(overload);\n\n\t\t/* Dump rule to check validation */\n\t\tthis.rule = function() { return true; };\n\n\t\t/* Dump message */\n\t\tthis.message = \"    \";\n\n\t\t/* List of options to make validation according to */\n\t\tthis.options = [];\n\n\t\t/* Fires on success */\n\t\tthis.onSuccess = function(element) {};\n\n\t\t/* Fires on error */\n\t\tthis.onError = function(element) {};\n\n\t\t/* Self extend with overload */\n\t\tjQuery.extend(this, overload);\n\n\t\t/* Return */\n\t\treturn this;\n\n\t};\n\n\t/**\n\t * List of default rules\n\t * @type {{required: validator.Rule}}\n\t */\n\tvalidator.rules = {\n\t\trequired: validator.Rule({\n\t\t\trule: function(value) {\n\t\t\t\treturn !!value.length;\n\t\t\t},\n\t\t\tmessage: \"   \"\n\t\t}),\n\t\trequiredIfFilled: validator.Rule({\n\t\t\trule: function(value) {\n\t\t\t\tlet item = $(this.options[0]);\n\t\t\t\treturn item.is(\":radio, :checkbox\") ? !item.is(\":checked\") || value : item.val() === \"\" || value;\n\t\t\t},\n\t\t\tmessage: \"   \"\n\t\t}),\n\t\tdate: validator.Rule({\n\t\t\trule: function(value) {\n\t\t\t\treturn !value || (\n\t\t\t\t\tvalue.match(/^\\d{4}-\\d{2}-\\d{2}( \\d{2}:\\d{2}(:\\d{2})?)?$/) ||\n\t\t\t\t\tvalue.match(/^\\d{2}.\\d{2}.\\d{4}( \\d{2}:\\d{2}(:\\d{2})?)?$/)\n\t\t\t\t\t);\n\t\t\t},\n\t\t\tmessage: \"  \"\n\t\t}),\n\t\tperiod: validator.Rule({\n\t\t\trule: function(value) {\n\t\t\t\treturn !value || (\n\t\t\t\t\tvalue.match(/^\\d{4}-\\d{2}-\\d{2}$/) ||\n\t\t\t\t\tvalue.match(/^\\d{2}.\\d{2}.\\d{4}$/) ||\n\t\t\t\t\tvalue.match(/^\\d{2}.\\d{2}.\\d{4}\\s*-\\s*\\d{2}.\\d{2}.\\d{4}$/) ||\n\t\t\t\t\tvalue.match(/^\\d{4}-\\d{2}-\\d{2}\\s*-\\s*\\d{4}-\\d{2}-\\d{2}$/)\n\t\t\t\t\t);\n\t\t\t},\n\t\t\tmessage: \"  \"\n\t\t}),\n\t\temail: validator.Rule({\n\t\t\trule: function(value) {\n\t\t\t\treturn value && value.match(/[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*@(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?/);\n\t\t\t},\n\t\t\tmessage: \"   \"\n\t\t}),\n\t\tsame: validator.Rule({\n\t\t\trule: function(value) {\n\t\t\t\treturn value === $('[name=\"' + this.options[0] + '\"]').val();\n\t\t\t},\n\t\t\tmessage: \"  \"\n\t\t}),\n\t\turl: validator.Rule({\n\t\t\trule: function(value) {\n\t\t\t\treturn value === \"\" || value.match(/^(https?:\\/\\/.+)$/);\n\t\t\t},\n\t\t\tmessage: \"   URI\"\n\t\t}),\n\t\tregexp: validator.Rule({\n\t\t\trule: function(value) {\n\t\t\t\treturn value === \"\" || value.match(new RegExp(this.options[0]));\n\t\t\t},\n\t\t\tmessage: \"  \"\n\t\t}),\n\t\tnumeric: validator.Rule({\n\t\t\trule: function(value) {\n\t\t\t\treturn value === \"\" || value.match(/^-?[0-9]+(\\.[0-9]+)?$/);\n\t\t\t},\n\t\t\tmessage: \" \"\n\t\t}),\n\t\tpositive: validator.Rule({\n\t\t\trule: function(value) {\n\t\t\t\treturn value === \"\" || value.match(/^[0-9]+(\\.[0-9]+)?$/) && parseFloat(value) > 0;\n\t\t\t},\n\t\t\tmessage: \"  \"\n\t\t}),\n\t\tmax: validator.Rule({\n\t\t\trule: function(value) {\n\t\t\t\treturn value === \"\" || value.match(/^[0-9]+(\\.[0-9]+)?$/) && parseFloat(value) <= parseFloat(this.options[0] || 0);\n\t\t\t},\n\t\t\tmessage: function() {\n\t\t\t\treturn \" ,    \" + (this.options[0] || 0)\n\t\t\t}\n\t\t}),\n\t\tmin: validator.Rule({\n\t\t\trule: function(value) {\n\t\t\t\treturn value === \"\" || value.match(/^[0-9]+(\\.[0-9]+)?$/) && parseFloat(value) >= parseFloat(this.options[0] || 0);\n\t\t\t},\n\t\t\tmessage: function() {\n\t\t\t\treturn \" ,    \" + (this.options[0] || 0);\n\t\t\t}\n\t\t}),\n\t\tminLength: validator.Rule({\n\t\t\trule: function(value) {\n\t\t\t\treturn value === \"\" || value.length >= (this.options[0] || 0)\n\t\t\t},\n\t\t\tmessage: \"    \"\n\t\t}),\n\t\tmaxLength: validator.Rule({\n\t\t\trule: function(value) {\n\t\t\t\treturn value === \"\" || value.length <= (this.options[0] || 0)\n\t\t\t},\n\t\t\tmessage: \"     \"\n\t\t})\n\t};\n\n\t/**\n\t * Holds element validation options\n\t * @param element\n\t * @constructor\n\t */\n\tvalidator.Options = function(element) {\n\n\t\t/* Create or return */\n\t\tif(!(this instanceof validator.Options))\n\t\t\treturn element.data(\"validationOptions\") || new validator.Options(element);\n\n\t\t/* Callbacks after all checks */\n\t\tthis.onSuccess = function() {};\n\t\tthis.onError = function() {};\n\n\t\t/* Adds to element on success */\n\t\tthis.successClass = false;\n\n\t\t/* Adds to element on error */\n\t\tthis.errorClass   = \"error\";\n\n\t\t/* Overlay defaults */\n\t\tjQuery.extend(true, this, validator.optionsDefaults);\n\n\t\t/* Holds list of validating rules */\n\t\tthis.rules = {};\n\n\t\t/* Save element */\n\t\tthis.element = element;\n\n\t\t/* Get rules that declared in element definition */\n\t\tthis.getDeclaredRules();\n\n\t\t/* Save option */\n\t\tthis.element.data(\"validationOptions\", this);\n\n\t\t/* Self return */\n\t\treturn this;\n\n\t};\n\n\tvalidator.Options.prototype = {\n\n\t\t/**\n\t\t * Gets list of rules that are set in declared way\n\t\t */\n\t\tgetDeclaredRules: function() {\n\n\t\t\t/* Get attribute value */\n\t\t\tlet attr = this.element.attr(\"data-validate\"),\n\t\t\t\tself = this;\n\n\t\t\t/* If none */\n\t\t\tif(!attr)\n\t\t\t\treturn;\n\n\t\t\t/* Get list */\n\t\t\t$.each(attr.split(\";\"), function(_, name) {\n\n\t\t\t\t/* Get parameters */\n\t\t\t\tlet params = name.match(/(\\w+)\\((.*)\\)/);\n\n\t\t\t\t/* Parse */\n\t\t\t\tif(params) {\n\n\t\t\t\t\t/* Get function */\n\t\t\t\t\tname = params[1];\n\n\t\t\t\t\t/* Parse params */\n\t\t\t\t\tparams = params[2].match(/(('[^']+')|([\\d\\w]+))/g);\n\t\t\t\t\t$.each(params, function(i, val) {\n\t\t\t\t\t\tparams[i] = eval(val.trim());\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\t/* Add rule to options */\n\t\t\t\tself.addRule(name.trim(), { options: params || [] });\n\n\t\t\t});\n\n\n\t\t},\n\n\t\t/**\n\t\t * Adds new rule for element\n\t\t * @param {string} name Rule name\n\t\t * @param {object} options Rule options\n\t\t * @returns {validator.Options}\n\t\t */\n\t\taddRule: function(name, options) {\n\n\t\t\t/* Create and save new rule */\n\t\t\tthis.rules[name] = jQuery.extend({}, validator.ruleDefaults, options);\n\n\t\t\t/* Mark for auto validation */\n\t\t\tif(!this.element.attr(\"data-validate\"))\n\t\t\t\tthis.element.attr(\"data-validate\", \"true\");\n\n\t\t\t/* Self returning */\n\t\t\treturn this;\n\t\t}\n\n\t}\n\n});","sky.service(\"visibleCalculator\", function() {\n\n\tlet Calculator = class {\n\n\t\tconstructor(holder, minHeight, scrollable) {\n\n\t\t\t/* Check if class */\n\t\t\tif(!(this instanceof Calculator))\n\t\t\t\treturn new Calculator(holder, minHeight, scrollable);\n\n\t\t\t/* Re get holder */\n\t\t\tthis.holder = $(holder);\n\t\t\tthis.scrollable = scrollable || $('body');\n\t\t\tthis.minHeight = minHeight || 0;\n\n\t\t\t/* Init */\n\t\t\tthis.init();\n\n\t\t}\n\n\t\t/* Init func */\n\t\tinit() {\n\n\t\t\t/* Count offset */\n\t\t\tlet offset = this.holder.offset();\n\n\t\t\t/* Get holder rect */\n\t\t\tthis.holderRect = {\n\t\t\t\tleft  : offset.left,\n\t\t\t\ttop   : offset.top,\n\t\t\t\twidth : this.holder.outerWidth(),\n\t\t\t\theight: this.holder.outerHeight()\n\t\t\t};\n\n\t\t}\n\n\t\t/* Calculating function */\n\t\tcalculate() {\n\n\t\t\t/* How much is scrolled */\n\t\t\tlet scrollTop    = $(this.scrollable).scrollTop(),\n\t\t\t\twindowHeight = $(window).height(),\n\t\t\t\twindowWidth  = $(window).width(),\n\t\t\t\tsizes        = {\n\t\t\t\t\tleft        : this.holderRect.left,\n\t\t\t\t\tright       : this.holderRect.left + this.holderRect.width,\n\t\t\t\t\ttop         : this.holderRect.top - scrollTop,\n\t\t\t\t\twidth       : this.holderRect.width,\n\t\t\t\t\theight      : this.holderRect.height,\n\t\t\t\t\trealHeight  : this.holderRect.height,\n\t\t\t\t\tbottom\t\t: 0,\n\t\t\t\t\tscrollTop   : scrollTop,\n\t\t\t\t\tscrollLeft  : 0,\n\t\t\t\t\twindowHeight: windowHeight,\n\t\t\t\t\twindowWidth : windowWidth,\n\t\t\t\t};\n\n\t\t\t/* Min height */\n\t\t\tif(sizes.height < this.minHeight)\n\t\t\t\tsizes.height = this.minHeight;\n\n\t\t\t/* Count bottom */\n\t\t\tsizes.bottom = sizes.top + sizes.height;\n\n\t\t\t/* If top border near than holder */\n\t\t\tif(sizes.top < 0) {\n\t\t\t\t// If visible less than min\n\t\t\t\tif(sizes.bottom < this.minHeight) {\n\t\t\t\t\tsizes.bottom = sizes.bottom < 0 ? 0 : sizes.bottom;\n\t\t\t\t\tsizes.top = sizes.bottom - this.minHeight;\n\t\t\t\t\tsizes.height = this.minHeight;\n\t\t\t\t}\n\t\t\t\t// If visible more than min\n\t\t\t\telse {\n\t\t\t\t\tsizes.height = sizes.bottom;\n\t\t\t\t\tsizes.top = 0;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t/* Get visible bottom */\n\t\t\tif(windowHeight < sizes.bottom) {\n\t\t\t\t// If visible less than min\n\t\t\t\tif(windowHeight - sizes.top < this.minHeight) {\n\t\t\t\t\tsizes.height = this.minHeight;\n\t\t\t\t\tsizes.top = windowHeight - sizes.top < 0 ? 0 : sizes.top;\n\t\t\t\t\tsizes.bottom = sizes.top + this.minHeight;\n\t\t\t\t}\n\t\t\t\t// If visible more than min\n\t\t\t\telse {\n\t\t\t\t\tsizes.height = windowHeight - sizes.top;\n\t\t\t\t\tsizes.bottom = 0;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t/* Return */\n\t\t\treturn sizes;\n\n\t\t}\n\n\t\tgetDropOffset(replace, popup) {\n\n\t\t\t/* Get drop */\n\t\t\tif(!popup.is(\":visible\")) return;\n\n\t\t\t/* Set position to zeros to get max width and height */\n\t\t\tpopup.removeClass('hidden').css({left: 0, top: 0});\n\n\t\t\t/* Init */\n\t\t\tlet popupWidth  = popup.outerWidth(),\n\t\t\t\tpopupHeight = popup.outerHeight();\n\n\t\t\t/* Reset position */\n\t\t\tpopup.css({marginLeft: \"\", marginTop: \"\", width: \"\", left: \"\", top: \"\"});\n\n\t\t\t/* Init */\n\t\t\tlet win            = $(window),\n\t\t\t\treplaceOffset  = replace.offset(),\n\t\t\t\tpopupOffset    = popup.offset(),\n\t\t\t\tleftDifference = popupOffset.left - replaceOffset.left,\n\t\t\t\ttopDifference  = popupOffset.top - replaceOffset.top,\n\t\t\t\tmiddle         = false,\n\t\t\t\tvisible        = this.calculate(),\n\t\t\t\ttop = 0, left = 0;\n\n\t\t\t// Drop down\n\t\t\tif(visible.bottom + popupHeight <= visible.windowHeight)\n\t\t\t\ttop = -topDifference + visible.realHeight + 1;\n\t\t\t// Drop up\n\t\t\telse if(visible.top > popupHeight)\n\t\t\t\ttop = -topDifference - 1 - popupHeight;\n\t\t\t// Drop left\n\t\t\telse {\n\t\t\t\ttop = -topDifference - (popupHeight - visible.realHeight) / 2;\n\t\t\t\tmiddle = true;\n\t\t\t}\n\t\t\t\n\t\t\t/* Set position */\n\t\t\tif(!middle) {\n\t\t\t\tif(visible.windowWidth > visible.left + popupWidth)\n\t\t\t\t\tleft = -leftDifference;\n\t\t\t\telse\n\t\t\t\t\tleft = -leftDifference - popupWidth + visible.width;\n\t\t\t} else {\n\t\t\t\tif(win.width() > replaceOffset.left + popupWidth + visible.width)\n\t\t\t\t\tleft = replaceOffset.left - popupOffset.left + visible.width;\n\t\t\t\telse\n\t\t\t\t\tleft = replaceOffset.left - popupOffset.left - popupWidth;\n\t\t\t}\n\n\t\t\treturn { top, left };\n\t\t\t\n\t\t}\n\t};\n\tthis.service = Calculator;\n});","/**\n * Holds classes to work with modal/new windows\n */\nsky.service('windows', [\"templates\", \"callbacks\", \"stackList\"], function ({templates, callbacks, stackList}) {\n\n\tlet tips = false,\n\t\tlist = stackList(),\n\t\twindows = this.service = {\n\t\t\t/**\n\t\t\t * Returns last open window if any\n\t\t\t * @returns {Modal|undefined}\n\t\t\t */\n\t\t\tgetLast: () => list.last(),\n\t\t\t/**\n\t\t\t * Returns new modal window\n\t\t\t * @returns {Modal}\n\t\t\t */\n\t\t\tmodal: (name, data) => new Modal(name, data)\n\t\t};\n\n\n\t/**\n\t * Creates new modal window\n\t * @param {*} name Window name\n\t * @param {*} [data] Data to send with request\n\t */\n\tclass Modal {\n\t\tconstructor (name, data) {\n\n\t\t\t/* Create window */\n\t\t\tthis.locked \t\t= false;\n\t\t\tthis.background \t= templates.render(\"windows-modal\", {}).appendTo(\"#pageContentHolder\").data(\"modalWindow\", this);\n\t\t\tthis.dataContainer \t= this.background.children();\n\t\t\tthis.holder \t\t= this.dataContainer.children(\".windowData\");\n\t\t\tthis.closeButton \t= this.dataContainer.children(\".close\");\n\n\t\t\t/* Make body un scrollable */\n\t\t\t$(document.body).css(\"overflow\", \"hidden\");\n\n\t\t\t/* Callbacks */\n\t\t\tthis.callbacks = callbacks();\n\n\t\t\t/* Render content */\n\t\t\ttry {\n\t\t\t\tthis.reRender(name, data);\n\t\t\t} catch (e) {\n\t\t\t\tthis.close(false);\n\t\t\t\tthrow e;\n\t\t\t}\n\n\t\t\t/* Return */\n\t\t\treturn this;\n\n\t\t}\n\n\t\t/**\n\t\t * Renders window content\n\t\t * @param {*} name Window name\n\t\t * @param {*} [data] Data to send with request\n\t\t */\n\t\treRender(name, data) {\n\n\t\t\t/* Close all tips */\n\t\t\tif(tips) tips.hideAll(true);\n\n\t\t\t/* Clear */\n\t\t\tthis.holder.html('');\n\n\t\t\t/* Render content */\n\t\t\tif (name instanceof jQuery)\n\t\t\t\tthis.template = name.appendTo(this.holder);\n\t\t\telse if (typeof name === \"string\")\n\t\t\t\tthis.template = templates.render(name, data).appendTo(this.holder);\n\n\t\t\t/* Self return */\n\t\t\treturn this;\n\t\t}\n\n\t\t/**\n\t\t * Removes all except that was rendered\n\t\t */\n\t\tclearExceptTemplate() {\n\t\t\tthis.holder.children().detach();\n\t\t\tthis.holder.append(this.template);\n\t\t}\n\n\t\t/**\n\t\t * Removes all except that was rendered\n\t\t */\n\t\tremoveNotifications() {\n\t\t\ttry {\n\t\t\t\tsky.service(\"notifications\").findInElement(this.holder).remove();\n\t\t\t} catch(e) {}\n\t\t}\n\n\t\t/**\n\t\t * Locks window so it can't be closed\n\t\t * @var {*} ajax Ajax object\n\t\t * @returns {Modal}\n\t\t */\n\t\tlock(ajax = false) {\n\t\t\tthis.locked = true;\n\t\t\tthis.closeButton.hide();\n\t\t\tif (ajax) ajax\n\t\t\t\t.on(\"preSuccess\", function () {\n\t\t\t\t\tthis.dataContainer.css(\"height\", this.dataContainer.innerHeight());\n\t\t\t\t}, this)\n\t\t\t\t.on(\"notAbort\", function () {\n\t\t\t\t\tlet self = this;\n\t\t\t\t\tthis.unlock();\n\t\t\t\t\tthis.dataContainer.css(\"height\", this.holder.outerHeight());\n\t\t\t\t\tsetTimeout(function () {\n\t\t\t\t\t\tself.dataContainer.css(\"height\", \"\");\n\t\t\t\t\t}, 500)\n\t\t\t\t}, this)\n\t\t\t\t.on(\"abort\", function () {\n\t\t\t\t\tthis.unlock().close();\n\t\t\t\t}, this);\n\t\t\treturn this;\n\t\t}\n\n\t\t/**\n\t\t * Unlocks window so it can be closed\n\t\t * @returns {Modal}\n\t\t */\n\t\tunlock() {\n\t\t\tthis.locked = false;\n\t\t\tthis.closeButton.show();\n\t\t\treturn this;\n\t\t}\n\n\t\t/**\n\t\t * Closes current window\n\t\t * @param {boolean} [byUser] Indicates that window was closed not by user\n\t\t */\n\t\tclose(byUser = false) {\n\n\t\t\t/* If windows is locked */\n\t\t\tif (this.locked)\n\t\t\t\treturn;\n\n\t\t\t/* Remove elements */\n\t\t\tthis.background.fadeOut(\"fast\", function () {\n\t\t\t\t$(this).remove()\n\t\t\t});\n\n\t\t\t/* Delete from list */\n\t\t\tlist.remove(this);\n\n\t\t\t/* Call close callback */\n\t\t\tthis.callbacks.fire(\"close\", {byUser: byUser});\n\n\t\t\t/* Close all tips */\n\t\t\ttry {\n\t\t\t\ttips = sky.service(\"tips\").hideAll(true);\n\t\t\t} catch (e) {}\n\n\t\t\t/* Make body scrollable */\n\t\t\tif (list.total() < 1)\n\t\t\t\t$(document.body).css(\"overflow\", \"\");\n\n\t\t\treturn this;\n\n\t\t}\n\t}\n\n\ttry {\n\t\ttips = sky.service(\"tips\");\n\t} catch (e) {}\n\n\t/* Add handler to black area click */\n\t$(document)\n\t\t.on(\"keyup\", sky.func(function (event) {\n\t\t\tlet last;\n\n\t\t\t/* If slide show was disabled */\n\t\t\tif (document[\"webkitIsFullScreen\"] || document[\"mozIsFullScreen\"] || document[\"isFullScreen\"])\n\t\t\t\treturn;\n\n\t\t\t/* Close current window */\n\t\t\tif (event.keyCode === 27 && (last = windows.getLast()))\n\t\t\t\tlast.close(true);\n\n\t\t}));\n\n});","sky.action(\"pagination\", {\n\n\tsetPage: function(button, _, page) {\n\n\t\t/* Get pagination */\n\t\tlet pagination = button.parents(\".pagination\").data(\"pagination\");\n\n\t\t/* Correct page */\n\t\tif(page === \"next\")\n\t\t\tpage = pagination.current + 1;\n\n\t\t/* Correct  */\n\t\tif(page === \"previous\")\n\t\t\tpage = pagination.current - 1;\n\n\t\t/* Go to page */\n\t\tpagination.goToPage(page);\n\n\t},\n\n\tscrollTo: function(element, event) {\n\n\t\t/* Get pagination */\n\t\tlet pagination = element.parents(\".pagination\").data(\"pagination\");\n\n\t\t/* Move */\n\t\tpagination.scroll(event);\n\n\t},\n\n\tgrab: function(runner) {\n\n\t\t/* Get pagination */\n\t\tlet pagination = runner.parents(\".pagination\").data(\"pagination\");\n\n\t\t/* Binds */\n\t\t$(window)\n\t\t\t.on(\"mouseup.pagination\", function() {\n\t\t\t\t$(window).off(\"mouseup.pagination mousemove.pagination\");\n\t\t\t}).on(\"mousemove.pagination\", function(event) {\n\t\t\t\tpagination.scroll(event);\n\t\t\t});\n\n\t},\n\n\tnext: function(button, _) {\n\t\tthis.setPage(button, _, \"next\")\n\t},\n\n\tprevious: function(button, _) {\n\t\tthis.setPage(button, _, \"previous\")\n\t}\n\n});","sky.action(\"selectReplace\", function({ visibleCalculator }) {\n\n    let filter = function(self, event) {\n\n        /* Get drop */\n        let popup  = self.closest(\".selectReplaceChoose\"),\n            inputs = popup.find(\"input[name]\");\n\n        /* On enter */\n        if(event.which === 13) {\n            let visible = popup.find(\"label:visible\");\n            if(visible.length > 0) {\n                inputs.prop(\"checked\", false);\n                visible.children(\"input\").prop(\"checked\", true).trigger(\"change\");\n            }\n            event.stopPropagation();\n        }\n\n        /* Get value */\n\t\tlet value = self.val(),\n\t\t\t rus              = \"\",\n             eng              = \"qwertyuiop[]asdfghjkl;'\\\\zxcvbnm,.\",\n             expression       = new RegExp(value.toLowerCase()),\n             expressionInvert = new RegExp(value.toLowerCase().replace(/[a-z-]/g, (character) => {\n                if(rus.indexOf(character) > -1) return eng[rus.indexOf(character)];\n                if(eng.indexOf(character) > -1) return rus[eng.indexOf(character)];\n                return character;\n            }));\n\n        /* Hide */\n        inputs.each((_, input) => {\n\n        \tinput = $(input);\n\n            if(input.parent().hasClass('hidden'))\n                return;\n\n            let inputHtml = input.next().html().toLowerCase();\n\n            try {\n                if(!inputHtml.match(expression) && !inputHtml.match(expressionInvert)) input.parent().hide();\n                else input.parent().show();\n            } catch(e) {}\n\n        });\n    };\n\n    return {\n\n        filter: filter,\n\n        selectAll: function(button) {\n\n            /* Get drop */\n            let popup = button.closest(\".selectReplaceChoose\");\n            popup.find(\":checkbox:visible\").prop(\"checked\", true).first().trigger(\"change\");\n\n        },\n\n        unSelectAll: function(button) {\n\n            /* Get drop */\n            let popup = button.closest(\".selectReplaceChoose\");\n            popup.find(\":checkbox:visible\").prop(\"checked\", false).first().trigger(\"change\");\n\n        },\n\n        close: function(element, event) {\n            if(element.get(0) === event.target)\n                $(\".selectReplaceChoose\").addClass('hidden');\n        },\n\n\t\tshowTip: function(label) {\n\n\t\t\tlet originalTip = label.find(\".checkItemTip\");\n\n\t\t\t/* If no tip element or tip already shown */\n\t\t\tif(!originalTip.length || label.data(\"tip\"))\n\t\t\t    return;\n\n            let popup = label.closest(\".selectReplaceChoose\");\n            let tip = originalTip.clone().removeClass(\"hidden\").appendTo(\"body\");\n            tip.css({\n                left: popup.offset().left,\n                top : popup.offset().top + popup.outerHeight() + 5\n            });\n            label.data(\"tip\", tip);\n\n\n\t\t},\n\n        hideTip: function(label) {\n\t\t\tif(!label.data(\"tip\"))\n\t\t\t    return;\n            label.data(\"tip\").remove();\n            label.removeData(\"tip\");\n\t\t},\n\n        /**\n         * Shows drop down\n         * @param replace Input\n         */\n        drop: function (replace) {\n\n            /* Hide all */\n\t\t\t$(\".selectReplaceChoose\").addClass('hidden');\n\n            /* Get drop */\n            let popup = replace.next(),\n                dropOffset = (new visibleCalculator(replace)).getDropOffset(replace, popup.removeClass('hidden'));\n\n            /* If cant calculate offset */\n            if(!dropOffset) return;\n\n\t\t\tpopup.css({ marginLeft: dropOffset.left, marginTop: dropOffset.top });\n\n\t\t\tif(replace.outerWidth() > popup.outerWidth())\n\t\t\t\tpopup.css(\"width\", replace.outerWidth());\n\n\t\t\t/* Search focus */\n\t\t\tif (popup.find(\".search\").length)\n\t\t\t\tpopup.find(\".search input\").val('').focus();\n\n        },\n\n        change: function(element, event) {\n\n\t\t\t/* Get inputs */\n\t\t\tlet popup = element.closest(\".selectReplaceChoose\"),\n\t\t\t\tinputs = popup.find(\"input:radio, input:checkbox\"),\n\t\t\t\tcurrent, change, children = false, replace = popup.prev(),\n\t\t\t\tval = \"\";\n\n\t\t\tlet { defaultValue, defaultAllValue } = replace.data(\"defaults\");\n\n\t\t\t/* Un select all */\n\t\t\tpopup.find(\"label\").removeClass(\"selected\");\n\n            /* Get checked */\n\t\t\tlet filtered = inputs.filter(\":checked\").each(function() {\n\t\t\t\tcurrent = $(this);\n\t\t\t\tcurrent.closest(\"label\").addClass(\"selected\");\n\t\t\t\tchildren = current.next();\n\t\t\t\tval = (val && val + \", \") + children.text();\n\t\t\t});\n\n            /* Make text shorter */\n\t\t\tif(val.length > 26)\n\t\t\t\tval = val.substr(0, 26).trim() + \"...\";\n\n\t\t\t/* If all checked */\n\t\t\tif(filtered.length === inputs.length && !popup.hasClass(\"single\"))\n\t\t\t\tval = defaultAllValue;\n\n\t\t\t/* Set input html */\n\t\t\tif(popup.hasClass(\"single\") && children)\n\t\t\t\treplace.html('').prepend(children.clone().removeClass(\"name\"));\n\t\t\telse if(!children)\n\t\t\t\treplace.html(defaultValue);\n\t\t\telse\n\t\t\t\treplace.text(val);\n\n            /* If not fake event */\n\t\t\tif(event && current)\n\t\t\t\treplace.trigger(\"change\", { value: current.val(), item: element });\n\n\t\t\t/* Hide on single-select */\n\t\t\tif(popup.hasClass(\"single\"))\n\t\t\t\tpopup.addClass('hidden');\n\n        }\n\n    }\n});","sky.directive(\"select\", (select, attrs) => {\r\n\tlet options = attrs || {};\r\n\toptions.items = [];\r\n\tselect.find(\"option\").each((_, option) => {\r\n\t\toptions.items.push({ html: option.innerHTML, value: option.value, checked: !!option.checked });\r\n\t});\r\n\tlet replace = sky.service(\"templates\").renderByText(\"{% import forms as forms %}{{ forms.selectReplace(options, items) }}\", { options: options, items: options.items });\r\n\treplace.replaceElement(select);\r\n});\r\nsky.directive(\".selectReplaceChoose\", (popup, attrs) => {\r\n\t\tlet replace = popup.prev();\r\n\t\treplace.data(\"defaults\", {\r\n\t\t\tdefaultValue: replace.html() || '-',\r\n\t\t\tdefaultAllValue: replace.text() || \"\"\r\n\t\t});\r\n\r\n\t\t/* Trigger */\r\n\t\tsetTimeout(() => { popup.find(\"input:radio, input:checkbox\").first().trigger(\"change\"); }, 1);\r\n\r\n});\r\n\r\nsky.onReady(() => {\r\n\t$(document).on(\"click touchstart\", function(event) {\r\n\r\n\t\t/* Get element */\r\n\t\tlet element = $(event.target || event.srcElement);\r\n\r\n\r\n\t\t/* If click in replace we should not hide it */\r\n\t\tif(element.closest(\".selectReplaceChoose\").length || element.closest(\".selectReplace\").length)\r\n\t\t\treturn;\r\n\r\n\t\t/* Hide all */\r\n\t\t$(\".selectReplaceChoose\").addClass('hidden');\r\n\r\n\t})\r\n});\r\n","sky.action(\"suggest\", function(suggester) {\r\n   return {\r\n       adverts: function(input, event) {\r\n\r\n           // Events\r\n           if(event.keyCode == 38 || event.keyCode == 40 || event.keyCode == 13 || event.keyCode == 27)\r\n               return;\r\n\r\n           // Stop if any other\r\n           if(this.suggestAjax)\r\n               this.suggestAjax.stop();\r\n\r\n           // Nothing\r\n           if(input.val() == \"\" || input.val().length < 2) {\r\n               suggester.hideAll();\r\n               return;\r\n           }\r\n\r\n           this.suggestAjax = sky.ajax(\"/ajax/members/search\", { name: input.val() })\r\n               .on(\"success\", function(response) {\r\n\r\n                   // No filtered\r\n                   if(!response.adverts || !response.adverts.length)\r\n                       suggester.hideAll();\r\n\r\n                   var filtered = [];\r\n\r\n                   $.each(response.adverts, function(_, advert) {\r\n                       filtered.push(advert.username);\r\n                   });\r\n\r\n                   // Show\r\n                   suggester.show(input, filtered);\r\n\r\n               }).on(\"error\", function() {\r\n                   suggester.hideAll();\r\n               });\r\n\r\n       },\r\n\r\n       campaigns: function(input, event){\r\n\r\n           // Events\r\n           if(event.keyCode == 38 || event.keyCode == 40 || event.keyCode == 13 || event.keyCode == 27)\r\n               return;\r\n\r\n           // Stop if any other\r\n           if(this.suggestAjax)\r\n               this.suggestAjax.stop();\r\n\r\n           // Nothing\r\n           if(input.val() == \"\" || input.val().length < 2) {\r\n               suggester.hideAll();\r\n               return;\r\n           }\r\n\r\n           this.suggestAjax = sky.ajax(\"/ajax/campaigns/search\", { name: input.val() })\r\n               .on(\"success\", function(response) {\r\n\r\n                   // No filtered\r\n                   if(!response.campaigns || !response.campaigns.length)\r\n                       suggester.hideAll();\r\n\r\n                   var filtered = [];\r\n\r\n                   $.each(response.campaigns, function(_, campaign) {\r\n\r\n                       filtered.push({ html: campaign.name });\r\n                   });\r\n\r\n                   // Show\r\n                   suggester.show(input, filtered);\r\n\r\n               }).on(\"error\", function() {\r\n                   suggester.hideAll();\r\n               });\r\n       },\r\n\r\n       campaignsSpecial: function(input, event){\r\n           // Events\r\n           if(event.keyCode == 38 || event.keyCode == 40 || event.keyCode == 13 || event.keyCode == 27)\r\n               return;\r\n\r\n           // Nothing\r\n           if(input.val() == \"\" || input.val().length < 2) {\r\n               suggester.hideAll();\r\n               return;\r\n           }\r\n\r\n           if(this.suggestAjax)\r\n               this.suggestAjax.stop();\r\n\r\n           this.suggestAjax = sky.ajax(\"/ajax/campaigns/search\", { name: input.val() })\r\n               .on(\"success\", function(response) {\r\n\r\n                   // No filtered\r\n                   if(!response.campaigns || !response.campaigns.length)\r\n                       suggester.hideAll();\r\n\r\n                   var filtered = [];\r\n\r\n                   $.each(response.campaigns, function(_, campaign) {\r\n\r\n                       filtered.push({ html: campaign.name+\" (\"+campaign.advert.username+\")\", callback: function(){\r\n                           sky.actions.perform(null, null, \"page.selectCampaign\", [campaign.id]);\r\n                       }});\r\n                   });\r\n\r\n                   // Show\r\n                   suggester.show(input, filtered);\r\n\r\n               }).on(\"error\", function() {\r\n                   suggester.hideAll();\r\n               });\r\n       }\r\n   }\r\n});","sky.directive(\"[data-suggests]\", function(element, attributes) {\n\telement.attr(\"data-event\", \"keyup: suggest.\" + attributes[\"data-suggests\"]).attr(\"autocomplete\", \"off\");\n});","sky.action(\"tips\", ({ tips }) => {\n\n\t// Get\n\tlet body = $('body'),\n\t\tevents  = body.attr(\"data-event\") || \"\",\n\t\tevent   = \"click: tips.hideTips\";\n\n\t// Add\n\tbody.attr(\"data-event\", events ? events + \"; \" + event: event);\n\n\tlet self = {\n\n\t\tshowTip: function(button, _, name) {\n\n\t\t\tif(button.data(\"tip\")) {\n\t\t\t\tbutton.data(\"tip\").hide();\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// Hide others\n\t\t\tself.hideTips(button, false);\n\n\t\t\t// Create\n\t\t\tlet tip = tips.Tip(button, {\n\t\t\t\tcreate: $('<div/>').css(\"overflow\", \"hidden\").append($(\"#\" + name + \"TipText\").html())\n\t\t\t});\n\n\t\t\t// Show\n\t\t\ttip.show(\"top\");\n\n\t\t},\n\n\t\tshowTipWithText: function(button, _, text) {\n\n\t\t\tif(button.data(\"tip\")) {\n\t\t\t\tbutton.data(\"tip\").hide();\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// Hide others\n\t\t\tself.hideTips(button, false);\n\n\t\t\t// Create\n\t\t\tlet tip = tips.Tip(button, {\n\t\t\t\tcreate: $('<div/>').css(\"overflow\", \"hidden\").append(text)\n\t\t\t});\n\n\t\t\t// Show\n\t\t\ttip.show(\"top\");\n\n\t\t},\n\n\t\thideTips: function(element, event) {\n\t\t\ttips.hideAll(false, $(event.target));\n\t\t},\n\n\t\t/**\n\t\t *\n\t\t */\n\t\tforceHideTips: function() {\n\t\t\ttips.hideAll(true);\n\t\t}\n\t};\n\treturn self;\n});","sky.directive(\"[data-tip]\", function(button, attributes) {\n\n\t// Get\n\tlet events  = attributes[\"data-event\"] || \"\",\n\t\ttipName = attributes[\"data-tip\"],\n\t\tevent   = \"click: tips.showTip('\" + tipName + \"')\";\n\n\t// Set new\n\tevents = events ? events + \"; \" + event: event;\n\n\t// Add\n\tbutton.attr(\"data-event\", events).addClass(\"dashed\");\n\n});\nsky.directive(\"[data-tip-text]\", function(button, attributes) {\n\n\t// Get\n\tlet events  = attributes[\"data-event\"] || \"\",\n\t\ttipText = attributes[\"data-tip-hover\"] || attributes[\"data-tip-text\"],\n\t\tevent   = \"click: tips.showTipWithText('\" + tipText + \"')\";\n\n\t// Set new\n\tevents = events ? events + \"; \" + event: event;\n\n\t// Add\n\tbutton.attr(\"data-event\", events).addClass(\"dashed\");\n\n});\nsky.directive(\"[data-tip-hover]\", function(button, attributes) {\n\n\t// Get\n\tlet tipText = attributes[\"data-tip-hover\"];\n\n\tsky.service(\"tips\").bind(button, \"top\", {create: tipText});\n\n\t// Set new\n\tlet events = attributes[\"data-event\"] || \"\",\n\t\tevent  = \"click: tips.showTipWithText('\" + tipText + \"')\";\n\tevents = events ? events + \"; \" + event : event;\n\n\t// Add\n\tbutton.attr(\"data-event\", events).addClass(\"dashed\");\n\n});","/**\n * Fire services init done\n */\nsky.exec(function() {\n\tsky.servicesDeferred.resolve();\n});","sky.directive(\"input.autoHttp\", function(input) {\n\tinput.on(\"focus\", function() {\n\t\tif(input.val() === \"\") input.val(\"http://\").get(0).selectionStart = 7;\n\t});\n});","/**\n * Fire project init done\n */\nsky.exec(function() {\n    document.body.classList.remove(\"hidden\");\n    sky.projectDeffered.resolve();\n});"]}