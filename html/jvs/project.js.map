{"version":3,"sources":["actions/actions.js","ajax/ajax.js","calendar/calendar.js","ajaxFiles/ajaxFiles.dropZone.js","ajaxFiles/ajaxFiles.iframe.js","ajaxFiles/ajaxFiles.js","ajaxFiles/ajaxFiles.xhr.js","callbacks/callback.js","callbacks/callbacks.js","dataOperator/dataOperator.js","dataOperator/inputsIO.js","directives/directives.js","drag/drag.js","history/history.js","localStorage/localStorage.js","models/models.js","models/modelsManager.js","models/modelsStorage.js","notifications/notifications.js","pagination/pagination.js","stacklist/stacklist.js","suggester/suggester.js","supported/supported.js","templates/templates.js","tips/tips.js","utils/utils.js","validator/validator.js","visibleCalculator/visibleCalculator.js","windows/windows.js","pagination/actions/paginationActions.js","selectReplace/actions/selectReplace.js","selectReplace/directives/select.js","suggester/actions/suggests.js","suggester/directives/suggests.js","tips/actions/tips.js","tips/directives/tips.js","servicesInit.js","shared.js","projectInit.js"],"names":["sky","service","_ref","exceptions","list","actions","this","perform","element","event","action","options","params","match","split","$","each","i","val","eval","trim","extend","self","path","current","name","isDisabled","elem","length","system","Error","apply","concat","add","events","safe","_typeof","fn","selector","on","data","call","document","_this","skyEvent","getAttribute","indexOf","type","preventDefault","map","eventString","parts","target","get","callbacks","url","_ref2","_ref2$object","object","undefined","_ref2$callbackData","callbackData","_ref2$ajaxExtend","ajaxExtend","filter","disable","ajaxCallbacks","stop","ajax","abort","dataType","timeout","success","response","textStatus","jqXHR","error","text","fire","errorThrown","errorText","responseText","status","codes","code","promise","always","enable","400","401","402","403","404","405","406","407","408","409","410","411","412","413","414","415","416","417","422","423","424","425","426","428","429","431","451","456","499","500","501","502","503","504","505","506","507","508","509","510","511","templates","calendar","monthsNames","window","page","renderDays","moment","date","weeks","currentWeek","month","day","number","isoWeek","days","push","clone","dateStr","format","dates","html","append","render","period","since","till","setTime","dayPick","dayDiv","notClose","parseInt","field","getInputValue","trigger","close","useTime","isSame","setDayPick","pickedDateView","position","holder","insertAfter","parent","css","marginTop","marginLeft","offset","top","outerHeight","left","find","periodChangeDay","reset","lastModified","isBefore","isAfter","markSelected","removeClass","addClass","changeDay","attr","hour","minute","changeYear","year","yearView","changeMonth","monthView","getDatePeriod","dateString","getDate","remove","off","show","showTime","lastPicked","is","subtract","value","dateOriginal","elementFromPoint","clientX","originalEvent","touches","clientY","bind","onReady","srcElement","parents","keyCode","calendars","supported","_class","zone","_classCallCheck","files","XHRIsSupported","attachEvents","_createClass","key","dragenter","dragleave","dragend","drop","dragover","isValidFileDrag","effect","dataTransfer","effectAllowed","dropEffect","e","onStart","dt","isWebkit","navigator","userAgent","types","contains","ajaxFilesXHR","ajaxFilesIFrame","AjaxFiles","input","inputs","saveFiles","XHRUpload","_iteratorNormalCompletion","_didIteratorError","_iteratorError","_step","_iterator","Symbol","iterator","next","done","file","inputName","err","return","send","parallel","_","handler","sendParallel","sendConsequentially","_this2","id","_iteratorNormalCompletion2","_didIteratorError2","_iteratorError2","_step2","_iterator2","defaultSend","closest","notifications","windows","filesAjax","modal","getLast","currentFile","lock","unlock","clearExceptTemplate","message","appendToModal","totalPercent","percent","stackList","toProceed","inProgress","total","totalLoaded","totalSize","fileRequests","size","Math","random","getName","loaded","queryString","jQuery","param","args","formData","form","FormData","processData","contentType","xhr","XMLHttpRequest","upload","toFixed","onProgress","beforeSend","func","setRequestHeader","encodeURI","all","notSuccess","delete","fileRequestData","request","replace","Callback","flags","functions","toRun","context","prototype","once","removeByContext","splice","removeByCallback","fireNext","result","callback","Callbacks","advancedCallbacks","callbacksFlags","removeListener","listener","Object","getEventsNames","slice","possible","names","elements","j","join","arguments","inputsIO","utils","searchField","virtual","default","Array","isObjectsEqual","searchRead","hashRead","readInputsValues","writeInputsValue","hashValue","history","hashObject","searchValue","searchObject","baseOptions","fields","historyType","DataOperator","lastRequestData","beforeRequest","setOptions","onFormSubmit","validForm","force","reload","set","search","fromUrl","readSearch","writeForm","readHash","read","writeHash","writeSearch","prepareRequest","lastResponse","loading","reloadContent","item","fieldsList","valueOrNullOnDefault","write","fieldName","substring","initOperator","initLoader","loader","pagination","_ref2$reload","_ref2$history","pages","onPageChange","pageNum","searchChanged","hashChanged","readInputValue","valuesNamed","valuesLined","writeInputValue","prop","first","notByUser","values","directives","directive","getAttributes","attributes","nodeName","nodeValue","parseElement","jsonScript","children","json","JSON","parse","tag","parseDirectives","bindEvents","start","move","started","button","x","pageX","y","pageY","History","hashString","searchString","pathString","intervalId","base","navigate","location","pathname","substr","pushState","oldPath","newPath","getWindowSearch","hash","change","hashDifference","searchDifference","old","getWindowHash","getDifference","rebuild","pathChanged","setHash","setSearch","changed","decodeURIComponent","proxy","stringFromObject","obj","getObjects","paramsString","objects","subStrings","str","keyAndValue","string","stored","getObjectsDifference","second","difference","localDiff","returnArray","decodeURI","onpopstate","setInterval","time","items","getItems","localStorage","getItem","parseJSON","storage","setItem","stringify","modelsStorage","modelsDefinition","BaseDefinition","Model","definition","creation","extension","model","addDefinition","fromData","cached","Manager","arr","fromArray","cache","visibleCalculator","tips","Modal","tip","align","Tip","create","loadings","global","appendTo","click","hide","inModalWindow","content","contentHolder","calc","setPosition","calculate","width","height","setHolder","reCalculate","instance","init","services","Pagination","_ref2$current","pageWidth","last","dimensions","startPage","lastStartPage","pagesVisible","pagesInvisible","scrollAvailable","scrollStart","tumbler","dom","slider","back","forward","redraw","goToPage","newPage","floor","innerWidth","toShow","drawPages","createScroll","scrollLine","runner","scroll","outerWidth","pos","List","lastId","index","hasOwnProperty","single","suggester","lastList","removeData","elementPosition","renderPosition","margin-left","margin-top","selected","prev","fullScreen","templatesList","templatesCompiled","Templates","globals","template","save","renderWithHolder","noDirectives","compile","temp","renderToText","renderByText","twig","renderByTextToText","load","compiled","fromLS","cookie","hideAll","withoutAutoHide","autoHide","mouseenter","mouseleave","_ref2$autoHide","_ref2$create","_ref2$close","_ref2$ajax","_ref2$highlight","highlight","insertBefore","shadow","opacity","background","closeTimeout","setTimeout","display","animate","fadeOut","fadeIn","blur","clearTimeout","what","addLeadingZero","encode","rawStr","charCodeAt","jsonData","prepareSelectData","_ref$columnSplitOn","columnSplitOn","_ref$maxColumns","maxColumns","columns","columnsCount","groupHolder","perColumn","ceil","column","groups","validator","validateForm","validationRule","addRule","validateElement","pass","shouldBeValidated","Options","totalPass","firstError","lastSuccess","firstSuccess","rules","ruleOverload","compiledRule","Rule","validate","onSuccess","onError","rule","ruleDefaults","optionsDefaults","errorClass","successClass","overload","required","requiredIfFilled","email","same","regexp","RegExp","numeric","positive","parseFloat","max","min","minLength","maxLength","getDeclaredRules","Calculator","minHeight","scrollable","holderRect","scrollTop","windowHeight","windowWidth","sizes","right","realHeight","scrollLeft","bottom","popup","popupWidth","popupHeight","win","replaceOffset","popupOffset","leftDifference","topDifference","middle","visible","selfOffset","selfWidth","locked","dataContainer","closeButton","body","reRender","detach","removeMessages","innerHeight","byUser","setPage","scrollTo","grab","previous","which","stopPropagation","rus","eng","expression","toLowerCase","expressionInvert","character","hasClass","inputHtml","selectAll","unSelectAll","dropOffset","getDropOffset","margintop","focus","attrs","labels","defaultValue","defaultAllValue","multiple","filtered","prepend","root","label","originalTip","adverts","suggestAjax","advert","username","campaigns","campaign","campaignsSpecial","showTip","showTipWithText","hideTips","forceHideTips","tipText","exec","servicesDeferred","resolve","closeWindow","submit","clearForm","changeOrder","orderField","order","table","trs","cell1","cell2","convert","sort","firstTr","secondTr","val1","val2","isNaN","changeOrderReload","currentLoader","selectionStart","classList","projectDeffered"],"mappings":"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","file":"project.js","sourcesContent":["sky.service(\"actions\", [\"exceptions\"], function ({exceptions}) {\n\n\tlet list = {},\n\t\tactions = this.service = {\n\n\t\t\t/**\n\t\t\t * Performs action\n\t\t\t * @param element\n\t\t\t * @param event\n\t\t\t * @param action\n\t\t\t * @param {Array} [options]\n\t\t\t */\n\t\t\tperform: function (element, event, action, options) {\n\n\t\t\t\t/* Get parameters */\n\t\t\t\tlet params = action.match(/(.+)\\((.*)\\)/);\n\n\t\t\t\t/* Parse */\n\t\t\t\tif (params) {\n\n\t\t\t\t\t/* Get function */\n\t\t\t\t\taction = params[1];\n\n\t\t\t\t\t/* Parse params */\n\t\t\t\t\tparams = params[2].split(\",\");\n\t\t\t\t\t$.each(params, function (i, val) {\n\t\t\t\t\t\tparams[i] = eval(val.trim());\n\t\t\t\t\t})\n\t\t\t\t}\n\n\t\t\t\t/* Options */\n\t\t\t\tif (options)\n\t\t\t\t\tparams = $.extend(params || [], options);\n\n\t\t\t\t/* Get */\n\t\t\t\tlet self = element ? $(element) : false,\n\t\t\t\t\tpath = action.split(\".\"),\n\t\t\t\t\tcurrent = list,\n\t\t\t\t\tname = action;\n\n\t\t\t\t/* If disabled */\n\t\t\t\tif (self && self.isDisabled && self.isDisabled())\n\t\t\t\t\treturn;\n\n\t\t\t\t$.each(path, function (i, elem) {\n\n\t\t\t\t\t/* Search */\n\t\t\t\t\tif (i + 1 < path.length && !current[elem])\n\t\t\t\t\t\tthrow new exceptions.system.Error(\"No action - \" + action + \", because can't find '\" + elem + \"'\");\n\n\t\t\t\t\t/* Get new elem */\n\t\t\t\t\tif (i + 1 < path.length)\n\t\t\t\t\t\tcurrent = current[elem];\n\n\t\t\t\t\t/* Save name */\n\t\t\t\t\tname = elem;\n\n\t\t\t\t});\n\n\t\t\t\t/* If no */\n\t\t\t\tif (!current[name])\n\t\t\t\t\tthrow new exceptions.system.Error(\"No action - \" + action);\n\n\t\t\t\t/* Call */\n\t\t\t\tcurrent[name].apply(current, [self, event].concat(params || []));\n\n\t\t\t},\n\n\t\t\t/**\n\t\t\t * Adds actions to list\n\t\t\t * @param name Group name\n\t\t\t * @param events List\n\t\t\t */\n\t\t\tadd: function (name, events) {\n\n\t\t\t\tif (typeof events === \"function\")\n\t\t\t\t\tevents = events.safe(true)();\n\n\t\t\t\t// Check\n\t\t\t\tif (!events || typeof events !== 'object')\n\t\t\t\t\tthrow new exceptions.system.Error(\"No event object for events '\" + name + \"' provided\");\n\n\t\t\t\t// Save\n\t\t\t\tlist[name] = $.extend(list[name] || {}, events);\n\n\t\t\t}\n\n\t\t};\n\n\n\t/**\n\t * Adds special bind function\n\t * @param {string} name Event name\n\t * @param {*} selector Selector string\n\t * @param {function} [action] Action function\n\t * @returns {jQuery}\n\t */\n\t$.fn.action = function(name, selector, action) {\n\n\t\t/* Parameters skip */\n\t\tif(typeof action === \"undefined\") { action = selector; selector = null; }\n\n\t\t/* Bind */\n\t\treturn this.on(name, selector, function(event, data) {\n\t\t\taction.call(this, event, $(this), data);\n\t\t}.safe());\n\t};\n\n\t/*\n\t * Bind declarative events\n\t */\n\t$(document).action(\"click submit keyup keydown dblclick mouseover mouseout mouseleave mouseenter change mousedown mouseup touchstart\", '[data-event]', function (event, self, data) {\n\n\t\t/* Get string */\n\t\tlet skyEvent = this.getAttribute(\"data-event\");\n\n\t\t/* If no such event in data-event attribute */\n\t\tif (skyEvent.indexOf(event.type) === -1)\n\t\t\treturn;\n\n\t\t/* If disabled */\n\t\tif (self.isDisabled && self.isDisabled()) {\n\t\t\tevent.preventDefault();\n\t\t\treturn;\n\t\t}\n\n\t\tskyEvent.split(\";\").map(eventString => {\n\n\t\t\t/* Get elements */\n\t\t\tlet parts = eventString.match(/(\\w+):(.*)/);\n\n\t\t\t/* Wrong */\n\t\t\tif (parts.length !== 3)\n\t\t\t\tthrow new exceptions.system.Error(\"Wrong action format in data-event: \" + eventString);\n\n\t\t\t/* Get elements */\n\t\t\tlet name = parts[1].trim(),\n\t\t\t\taction = parts[2].trim();\n\n\t\t\t/* Another event */\n\t\t\tif (name !== event.type)\n\t\t\t\treturn;\n\n\t\t\t/* No default go */\n\t\t\tif (event.target === self.get(0))\n\t\t\t\tevent.preventDefault();\n\n\t\t\t/* Passed data */\n\t\t\tevent.data = data;\n\n\t\t\t/* Perform action */\n\t\t\tactions.perform(this, event, action);\n\n\t\t});\n\n\t});\n\n});","sky.service(\"ajax\", [\"callbacks\"], function({ callbacks }) {\n\n\t/**\n\t * Advanced ajax execution\n\t * To abort call stop() method instead of abort() because it's used for abort callback set, or .ajax.abort()\n\t * You may skip type, don't skip it if lock is string set false in object and data\n\t * @param {string} url\t\t\t\tRequested url\n\t * @param {object} [data]\t\t\tHolds request parameters\n\t * @param {jQuery} [object]\t\t\tObject which performs request, to disable it during request\n\t * @param {object} [ajaxExtend]\t\tAdditional ajax options, see http://api.jquery.com/jQuery.ajaxSetup/\n\t * @param {object} [callbackData]\tAdditional params that passed to any callback\n\t */\n\tthis.service = function(url, data, { object = null, callbackData = {}, ajaxExtend = {} }) {\n\n\t\t/* Lock button */\n\t\tif(object)\n\t\t\tobject = $(object).filter(\":not(.disabled)\").disable();\n\n\t\t/* New object to store callbacks */\n\t\tlet ajaxCallbacks = new callbacks();\n\t\tajaxCallbacks.stop = function() { ajaxCallbacks.ajax.abort(); };\n\n\t\t/* Perform ajax request */\n\t\tajaxCallbacks.ajax = $.ajax($.extend(true, {\n\n\t\t\t/* Set base options */\n\t\t\turl     \t: url,\n\t\t\tdata    \t: data,\n\t\t\tdataType\t: \"json\",\n\t\t\ttype    \t: \"post\",\n\t\t\ttimeout\t\t: 480 * 1000,\n\t\t\tsuccess: function(response, textStatus, jqXHR) {\n\n\t\t\t\t/* Possible params list */\n\t\t\t\tlet params = $.extend({ jqXHR: jqXHR, textStatus: textStatus, object: object }, callbackData);\n\n\t\t\t\t/* If empty response */\n\t\t\t\tif(response === null) {\n\t\t\t\t\tparams.error = \"Данные небыли переданы\";\n\t\t\t\t\tparams.type = \"noData\";\n\t\t\t\t}\n\n\t\t\t\t/* If response returned with error */\n\t\t\t\tif(response.error) {\n\t\t\t\t\tparams.error = response.text;\n\t\t\t\t\tparams.type = \"php\";\n\t\t\t\t}\n\n\t\t\t\t/* If error type set */\n\t\t\t\tif(params.type)\n\t\t\t\t\treturn ajaxCallbacks.fire(\"notSuccess, error\", params); // No data\n\n\t\t\t\t/* Set response in possible params */\n\t\t\t\tparams.response = params.data = response;\n\n\t\t\t\t/* User success function */\n\t\t\t\treturn ajaxCallbacks.fire(\"preSuccess, success, notAbort\", params);\n\n\t\t\t}.safe(),\n\t\t\terror: function(jqXHR, textStatus, errorThrown) {\n\n\t\t\t\t/* Defaults */\n\t\t\t\tlet type        = \"Unknown\",\n\t\t\t\t\terrorText   = \"Во время выполнения запроса произошла ошибка, пожалуйста попробуйте позже\";\n\n\t\t\t\t/* Get error text according to response data */\n\t\t\t\tif(textStatus === \"abort\") {\n\t\t\t\t\ttype \t  = \"abort\";\n\t\t\t\t\terrorText = 'Выполнение запроса прервано';\n\t\t\t\t} else if(textStatus === 'parsererror') {\n\t\t\t\t\ttype \t  = \"parse\";\n\t\t\t\t\terrorText = \"Ответ пришел в неверном формате, пожалуйста попробуйте позже, текст:<br/>\" + jqXHR.responseText;\n\t\t\t\t} else if(textStatus === 'timeout') {\n\t\t\t\t\ttype \t  = \"timeout\";\n\t\t\t\t\terrorText = 'Время ожидания ответа истекло';\n\t\t\t\t} else if(jqXHR.status === 0) {\n\t\t\t\t\ttype \t  = \"stopped\";\n\t\t\t\t\terrorText = 'Загрузка остановлена, проверьте свои настройки сети';\n\t\t\t\t} else if(codes[jqXHR.status]) {\n\t\t\t\t\ttype = jqXHR.status;\n\t\t\t\t\terrorText = 'Ошибка во времы выполнения запроса <br/> ' + codes[jqXHR.status];\n\t\t\t\t}\n\n\t\t\t\t/* Possible params list */\n\t\t\t\tlet params = $.extend({\n\t\t\t\t\terror      : errorText,\n\t\t\t\t\ttype       : type,\n\t\t\t\t\tcode\t   : type,\n\t\t\t\t\tjqXHR      : jqXHR,\n\t\t\t\t\ttextStatus : textStatus,\n\t\t\t\t\tstatus     : textStatus,\n\t\t\t\t\terrorThrown: errorThrown,\n\t\t\t\t\tobject     : object\n\t\t\t\t}, callbackData);\n\n\t\t\t\t/* Execute callback */\n\t\t\t\tajaxCallbacks.fire(\"notSuccess\", params);\n\n\t\t\t\t/* Execute special ajaxCallbacks */\n\t\t\t\tajaxCallbacks.fire(textStatus === \"abort\" ? \"abort\" : \"error, notAbort\", params);\n\n\t\t\t}.safe()\n\n\t\t}, ajaxExtend));\n\n\t\t/* On always set */\n\t\tajaxCallbacks.ajax.promise().always(function(jqXHR, textStatus, errorThrown) {\n\n\t\t\t/* Unlock objects */\n\t\t\tif(object)\n\t\t\t\tobject.enable();\n\n\t\t\t/* Always callback */\n\t\t\tajaxCallbacks.fire(\"always\", { errorThrown: errorThrown, textStatus: textStatus, jqXHR: jqXHR, object: object});\n\n\t\t}.safe());\n\n\t\treturn ajaxCallbacks;\n\n\t};\n\n\t/**\n\t * Contains http codes\n\t */\n\tlet codes = {\n\n\t\t/* Request errors */\n\t\t400: \"Неверный запрос\",\n\t\t401: \"Для выполнеия запроса нужня авторизация\",\n\t\t402: \"Для доступа к ресурсу необходима оплата\",\n\t\t403: \"Доступ к ресурсу запрещен\",\n\t\t404: \"Сервер для выполнения запроса не найден или запрос выполнялся слишком долго\",\n\t\t405: \"Не поддерживаемый метод HTTP\",\n\t\t406: \"Не приемлемо\",\n\t\t407: \"Необходима аутентификация прокси\",\n\t\t408: \"Истекло время ожидания\",\n\t\t409: \"Конфликт\",\n\t\t410: \"Ресурс удален\",\n\t\t411: \"В запросе не указана длинна\",\n\t\t412: \"Условие ложно\",\n\t\t413: \"Размер запроса слишком велик\",\n\t\t414: \"Запрашиваемый URI слишком длинный\",\n\t\t415: \"Неподдерживаемый тип данных\",\n\t\t416: \"Запрашиваемый диапазон не достижим\",\n\t\t417: \"Ожидаемое неприемлемо\",\n\t\t422: \"Необрабатываемый экземпляр\",\n\t\t423: \"Ресурс заблокирован\",\n\t\t424: \"Невыполненная зависимость\",\n\t\t425: \"Неупорядоченный набор\",\n\t\t426: \"Необходимо обновление\",\n\t\t428: \"Необходимо предусловие\",\n\t\t429: \"Слишком много запросов\",\n\t\t431: \"Поля заголовка запроса слишком большие\",\n\t\t451: \"Недоступно по юридическим причинам\",\n\t\t456: \"Некорректируемая ошибка\",\n\t\t499: \"Используется Nginx, соединение закрыто до получения ответа\",\n\n\t\t/* Server error */\n\t\t500: \"Внутренняя ошибка сервера\",\n\t\t501: \"Не реализовано\",\n\t\t502: \"Плохой или ошибочный шлюз\",\n\t\t503: \"Сервис недоступен\",\n\t\t504: \"Шлюз не отвечает\",\n\t\t505: \"Версия HTTP не поддерживается\",\n\t\t506: \"Вариант тоже проводит согласование\",\n\t\t507: \"Переполнение хранилища\",\n\t\t508: \"Запрос зациклен\",\n\t\t509: \"Исчерпана пропускная ширина канала\",\n\t\t510: \"Не расширено\",\n\t\t511: \"Требуется сетевая аутентификация\"\n\n\t};\n\n});","sky.service(\"calendar\", [ \"templates\" ], function ({ templates }) {\n\n\t/* This class is for showing calendar to pick date on page */\n\tlet calendar = {\n\n\t\t/* Days set */\n\t\tmonthsNames: window.page.data.monthsNames || [\"Январь\", \"Февраль\", \"Март\", \"Апрель\", \"Май\", \"Июнь\", \"Июль\", \"Август\", \"Сентябрь\", \"Октябрь\", \"Ноябрь\", \"Декабрь\"],\n\n\t\trenderDays: function () {\n\n\t\t\t/* Clone */\n\t\t\tlet current = moment(this.date),\n\t\t\t\tweeks = [],\n\t\t\t\tcurrentWeek = false;\n\n\t\t\t/* From first */\n\t\t\tcurrent.date(1);\n\n\t\t\t/* Go through */\n\t\t\twhile (current.month() === this.date.month()) {\n\n\t\t\t\t/* Make week if new */\n\t\t\t\tif (!currentWeek || current.day() === 1) {\n\t\t\t\t\tcurrentWeek = {number: current.isoWeek(), days: []};\n\t\t\t\t\tweeks.push(currentWeek);\n\t\t\t\t}\n\n\t\t\t\t/* Push */\n\t\t\t\tcurrentWeek.days.push({date: current.clone(), dateStr: current.format(\"YYYY.MM.DD\"), day: current.day() === 0 ? 6 : current.day() - 1});\n\n\t\t\t\t/* Go next day */\n\t\t\t\tcurrent.add(1, \"d\");\n\n\t\t\t}\n\n\t\t\t/* Render */\n\t\t\tthis.dates.html('').append(templates.render(\"calendar-dates\", {\n\t\t\t\tweeks: weeks,\n\t\t\t\tdateStr: this.date.format(\"YYYY.MM.DD\"),\n\t\t\t\tcurrent: this.date,\n\t\t\t\tperiod: this.period,\n\t\t\t\tsince: this.since,\n\t\t\t\ttill: this.till\n\t\t\t}));\n\n\t\t\t/* Render */\n\t\t\tthis.setTime();\n\n\t\t},\n\n\t\t/**\n\t\t * When user picks date\n\t\t * @param {*} dayDiv Div that user clicked, if he did\n\t\t * @param notClose\n\t\t */\n\t\tdayPick: function (dayDiv, notClose) {\n\n\t\t\t/* Set date */\n\t\t\tif (dayDiv)\n\t\t\t\tthis.date.date(parseInt(dayDiv.html()));\n\n\t\t\tthis.field.val(this.getInputValue()).trigger(\"change\").trigger(\"keyup\");\n\t\t\tif (!notClose) this.close();\n\n\t\t},\n\n\t\tgetInputValue: function () {\n\n\t\t\t/* Get field new value */\n\t\t\tif (this.useTime)\n\t\t\t\treturn this.date.format(\"DD.MM.YYYY HH:mm\");\n\t\t\telse if (this.period && this.since.isSame(this.till))\n\t\t\t\treturn this.since.format(\"DD.MM.YYYY\");\n\t\t\telse if (this.period)\n\t\t\t\treturn this.since.format(\"DD.MM.YYYY\") + ' - ' + this.till.format(\"DD.MM.YYYY\");\n\n\t\t\t/* Default */\n\t\t\treturn this.date.format(\"DD.MM.YYYY\");\n\n\t\t},\n\n\t\tsetDayPick: function () {\n\t\t\tthis.pickedDateView.html(this.getInputValue());\n\t\t},\n\n\t\t/**\n\t\t * Position date picker\n\t\t * @param {*} field Item that we should position under\n\t\t */\n\t\tposition: function (field) {\n\n\t\t\tthis.holder.insertAfter(field.parent()).css({\n\t\t\t\tmarginTop: 0,\n\t\t\t\tmarginLeft: 0,\n\t\t\t\tposition: \"absolute\"\n\t\t\t}).css({\n\t\t\t\tmarginTop: field.offset().top - this.holder.offset().top + field.outerHeight() + 1,\n\t\t\t\tmarginLeft: field.offset().left - this.holder.offset().left + 1\n\t\t\t});\n\n\t\t},\n\n\t\t/**\n\t\t * Sets time inputs in calendar values\n\t\t */\n\t\tsetTime: function () {\n\n\t\t\t/* Set time */\n\t\t\tthis.holder.find(\".time .hour\").val(this.date.format(\"HH\"));\n\t\t\tthis.holder.find(\".time .minute\").val(this.date.format(\"mm\"));\n\n\t\t},\n\n\t\tperiodChangeDay: function () {\n\n\t\t\tlet reset = function () {\n\t\t\t\tcalendar.since = calendar.date.clone();\n\t\t\t\tcalendar.till = calendar.date.clone();\n\t\t\t\tcalendar.lastModified = \"none\"\n\t\t\t};\n\n\t\t\tif (this.date.isBefore(this.since)) {\n\t\t\t\tif (this.lastModified !== \"since\") {\n\t\t\t\t\tthis.since = this.date.clone();\n\t\t\t\t\tthis.lastModified = \"since\"\n\t\t\t\t}\n\t\t\t\telse reset();\n\t\t\t} else if (this.date.isAfter(this.till)) {\n\t\t\t\tif (this.lastModified !== \"till\") {\n\t\t\t\t\tthis.till = this.date.clone();\n\t\t\t\t\tthis.lastModified = \"till\"\n\t\t\t\t}\n\t\t\t\telse reset();\n\t\t\t} else if (this.date.isSame(this.till) || this.date.isSame(this.since))\n\t\t\t\treset();\n\t\t\telse {\n\t\t\t\tif (this.lastModified === \"since\") {\n\t\t\t\t\tthis.till = this.date.clone();\n\t\t\t\t\tthis.lastModified = \"till\"\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tthis.since = this.date.clone();\n\t\t\t\t\tthis.lastModified = \"since\"\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tcalendar.markSelected();\n\n\t\t},\n\n\t\tmarkSelected: function () {\n\n\t\t\tthis.dates.find(\".day\").removeClass(\"selected\").removeClass(\"subSelected\").each(function () {\n\n\n\t\t\t\tlet element = $(this),\n\t\t\t\t\tdate = calendar.date.clone().date(parseInt(element.html()));\n\n\t\t\t\tif (!calendar.period) {\n\t\t\t\t\tif (date.format(\"DD.MM.YYYY\") === calendar.date.format(\"DD.MM.YYYY\"))\n\t\t\t\t\t\telement.addClass(\"subSelected\");\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (date.isAfter(calendar.since) && date.isBefore(calendar.till))\n\t\t\t\t\telement.addClass(\"subSelected\");\n\t\t\t\telse if (date.isSame(calendar.since) || date.isSame(calendar.till))\n\t\t\t\t\telement.addClass(\"selected\");\n\n\t\t\t});\n\n\t\t},\n\n\t\t/**\n\t\t * Changes day\n\t\t * @param {*} element Day picker\n\t\t * @returns {undefined}\n\t\t */\n\t\tchangeDay: function (element) {\n\n\t\t\t/* If pick today */\n\t\t\tthis.date.date(parseInt(element.html()));\n\n\t\t\t/* No more for period */\n\t\t\tif (this.period) {\n\t\t\t\tthis.periodChangeDay();\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tcalendar.markSelected();\n\n\t\t\t/* Set time */\n\t\t\tif (this.field.attr(\"name\") === \"since\")\n\t\t\t\tthis.date.hour(0).minute(0);\n\t\t\telse if (this.date.format(\"DD-MM-YYYY\") === moment().format(\"DD-MM-YYYY\"))\n\t\t\t\tthis.date.hour(moment().hour()).minute(moment().minute());\n\t\t\telse\n\t\t\t\tthis.date.hour(23).minute(59);\n\n\t\t\t/* Pick */\n\t\t\tif (!this.useTime)\n\t\t\t\tthis.dayPick(element);\n\t\t\telse\n\t\t\t\tthis.setTime();\n\n\t\t},\n\n\t\t/**\n\t\t * Sets specified year\n\t\t * @param {int} year Year that need to be set\n\t\t */\n\t\tchangeYear: function (year) {\n\n\t\t\t/* Set year */\n\t\t\tthis.date.year(year);\n\n\t\t\t/* Update */\n\t\t\tthis.yearView.html(year);\n\n\t\t\t/* Dates redraw */\n\t\t\tthis.renderDays();\n\n\t\t},\n\n\t\t/**\n\t\t * Sets specified month\n\t\t * @param {int} month Month to be set\n\t\t */\n\t\tchangeMonth: function (month) {\n\n\t\t\t/* Set year */\n\t\t\tthis.date.month(month);\n\n\t\t\t/* Updates */\n\t\t\tthis.monthView.html(this.monthsNames[this.date.month()] + ' ' + this.date.year());\n\n\t\t\t/* Reload year */\n\t\t\tthis.changeYear(this.date.year());\n\n\t\t},\n\n\t\tgetDatePeriod: function (dateString) {\n\n\t\t\t// Split and get since\n\t\t\tlet parts = dateString.split('-'),\n\t\t\t\ttill,\n\t\t\t\tsince = this.getDate(parts[0].trim());\n\n\t\t\t// Get till\n\t\t\tif (parts.length > 1)\n\t\t\t\ttill = this.getDate(parts[1].trim());\n\t\t\telse\n\t\t\t\ttill = this.getDate(parts[0].trim());\n\n\t\t\t// Set inner lets\n\t\t\tthis.since = since;\n\t\t\tthis.till = till;\n\t\t\tthis.date = since.clone();\n\n\t\t},\n\n\t\t/**\n\t\t * Creates today date\n\t\t */\n\t\tgetDate: function (dateString) {\n\n\t\t\t/* Set calendar date */\n\t\t\tlet date = false;\n\n\t\t\t/* If input has datetime format value */\n\t\t\tif (dateString.match(/^\\d{4}-\\d{2}-\\d{2} \\d{1,2}:\\d{1,2}$/))\n\t\t\t\tdate = moment(dateString, \"YYYY-MM-DD HH:mm\");\n\n\t\t\t/* Id input has date format value */\n\t\t\tif (dateString.match(/^\\d{4}-\\d{2}-\\d{2}$/))\n\t\t\t\tdate = moment(dateString, \"YYYY-MM-DD\");\n\n\t\t\t/* Id input has date format value */\n\t\t\tif (dateString.match(/^\\d{2}.\\d{2}.\\d{4}$/))\n\t\t\t\tdate = moment(dateString, \"DD.MM.YYYY\");\n\n\t\t\t/* Id input has date format value */\n\t\t\tif (dateString.match(/^\\d{2}.\\d{2}.\\d{4} \\d{2}:\\d{2}$/))\n\t\t\t\tdate = moment(dateString, \"DD.MM.YYYY HH:mm\");\n\n\t\t\t/*  If still no */\n\t\t\tif (!date) {\n\t\t\t\tdate = moment();\n\n\t\t\t\t/* Set time */\n\t\t\t\tif (this.field.attr(\"name\") === \"since\")\n\t\t\t\t\tdate.hour(0).minute(0);\n\t\t\t}\n\n\t\t\t/* Reset time */\n\t\t\tif (!this.useTime)\n\t\t\t\tdate.hour(0).minute(0);\n\n\t\t\t/* Additional check */\n\t\t\treturn this.date = date;\n\n\t\t},\n\n\t\t/**\n\t\t * Closes windows\n\t\t */\n\t\tclose: function () {\n\n\t\t\t/* Remove calendar */\n\t\t\tif (this.holder)\n\t\t\t\tthis.holder.remove();\n\n\t\t\t/* Unset */\n\t\t\tif (this.field) {\n\t\t\t\tthis.field.off(\"keyup.calendar\");\n\t\t\t\tthis.field = false;\n\t\t\t}\n\t\t}\n\t};\n\n\tlet show = function (field, showTime) {\n\n\t\t/* Remove old calendars */\n\t\tthis.close();\n\n\t\t/* Begins from current date */\n\t\tthis.field = field;\n\t\tthis.period = false;\n\t\tthis.useTime = showTime ? showTime : false;\n\t\tthis.lastPicked = \"none\";\n\n\t\tif (field.is(\"input.datePeriod\")) {\n\t\t\tthis.period = true;\n\t\t\tthis.getDatePeriod(field.val());\n\t\t} else\n\t\t\tthis.getDate(field.val());\n\n\t\t/* Render */\n\t\tthis.holder = templates.render(\"calendar\", this);\n\n\t\t/* Actions */\n\t\tthis.holder\n\n\t\t/* Months changer */\n\t\t\t.action(\"click\", \".month .next\", function (event) {\n\t\t\t\tevent.preventDefault();\n\t\t\t\tcalendar.changeMonth(calendar.date.month() + 1);\n\t\t\t})\n\t\t\t.action(\"click\", \".month .prev\", function (event) {\n\t\t\t\tevent.preventDefault();\n\t\t\t\tcalendar.changeMonth(calendar.date.month() - 1);\n\t\t\t})\n\n\t\t\t/* Years */\n\t\t\t.action(\"click\", \".year .next\", function (event) {\n\t\t\t\tevent.preventDefault();\n\t\t\t\tcalendar.changeYear(calendar.date.year() + 1);\n\t\t\t})\n\t\t\t.action(\"click\", \".year .prev\", function (event) {\n\t\t\t\tevent.preventDefault();\n\t\t\t\tcalendar.changeYear(calendar.date.year() - 1);\n\t\t\t})\n\t\t\t.action(\"click\", \".setNow\", function (event) {\n\t\t\t\tevent.preventDefault();\n\t\t\t\tcalendar.date = moment();\n\t\t\t\tcalendar.renderDays();\n\t\t\t\tcalendar.setTime();\n\t\t\t})\n\t\t\t.action(\"click\", \".setToday\", function (event) {\n\t\t\t\tevent.preventDefault();\n\t\t\t\tcalendar.date = moment();\n\t\t\t\tcalendar.date.hour(0);\n\t\t\t\tcalendar.date.minute(0);\n\t\t\t\tcalendar.renderDays();\n\t\t\t\tcalendar.setTime();\n\t\t\t})\n\t\t\t.action(\"click\", \".setWeek\", function (event) {\n\t\t\t\tevent.preventDefault();\n\t\t\t\tcalendar.date = moment();\n\t\t\t\tcalendar.date.subtract(7, \"d\");\n\t\t\t\tcalendar.renderDays();\n\t\t\t\tcalendar.setTime();\n\t\t\t})\n\n\t\t\t/* Day */\n\t\t\t.action(\"click\", \".dates .day\", function (event) {\n\t\t\t\tevent.preventDefault();\n\t\t\t\tlet self = $(this);\n\n\t\t\t\tif (self.is(\".selected\") && !calendar.period)\n\t\t\t\t\tcalendar.dayPick($(this));\n\t\t\t\telse {\n\t\t\t\t\tcalendar.changeDay($(this));\n\t\t\t\t\tcalendar.dayPick(false, true);\n\t\t\t\t}\n\t\t\t})\n\n\t\t\t/* Apply button */\n\t\t\t.action(\"click\", \".apply\", function (event) {\n\t\t\t\tevent.preventDefault();\n\t\t\t\tcalendar.dayPick();\n\t\t\t})\n\n\t\t\t/* Time */\n\t\t\t.action(\"click\", \".time a\", function (event) {\n\t\t\t\tevent.preventDefault();\n\t\t\t\tcalendar.date.hour(moment().hour());\n\t\t\t\tcalendar.date.minute(moment().minute());\n\t\t\t\tcalendar.setTime();\n\t\t\t})\n\t\t\t.action(\"keyup\", \".time .hour\", function () {\n\t\t\t\tcalendar.date.hour(this.value);\n\t\t\t})\n\t\t\t.action(\"keyup\", \".time .minute\", function () {\n\t\t\t\tcalendar.date.minute(this.value);\n\t\t\t});\n\n\n\t\t/* Close and containers */\n\t\tthis.dates = this.holder.find(\".dates\");\n\t\tthis.yearView = this.holder.find(\".year .value\");\n\t\tthis.monthView = this.holder.find(\".month .value\");\n\t\tthis.pickedDateView = this.holder.find(\".pickedDate\");\n\n\t\t/* Refresh days */\n\t\tthis.renderDays();\n\n\t\t/* Reposition */\n\t\tthis.position(field);\n\t\tthis.setDayPick();\n\n\t\t/* Auto change */\n\t\tthis.field.on(\"keyup.calendar\", function () {\n\t\t\tshow(field, showTime);\n\t\t});\n\n\t\tlet dateOriginal;\n\t\tthis.dates.on(\"touchstart\", function (event) {\n\n\t\t\tlet element = $(event.target);\n\t\t\tif (!element.is(\".day\")) return;\n\t\t\tdateOriginal = calendar.date.clone().date(parseInt(element.html()));\n\n\t\t}).on(\"touchmove\", function (event) {\n\n\t\t\t/* No original event */\n\t\t\tevent.preventDefault();\n\n\t\t\tlet element = document.elementFromPoint((event.clientX || event.originalEvent.touches[0].clientX), (event.clientY || event.originalEvent.touches[0].clientY));\n\t\t\telement = $(element);\n\n\t\t\tif (!element.is(\".day\")) return;\n\n\t\t\tlet date = dateOriginal.clone().date(parseInt(element.html()));\n\n\t\t\tif (date.isBefore(dateOriginal)) {\n\t\t\t\tcalendar.since = date.clone();\n\t\t\t\tcalendar.till = dateOriginal.clone();\n\t\t\t} else {\n\t\t\t\tcalendar.since = dateOriginal.clone();\n\t\t\t\tcalendar.till = date.clone();\n\t\t\t}\n\t\t\tcalendar.lastModified = \"none\";\n\t\t\tcalendar.markSelected();\n\t\t\t// $(this).trigger(\"click\");\n\n\t\t});\n\n\t}.bind(calendar);\n\n\t/* Return */\n\tthis.service = show;\n\n});\n\nsky.onReady(({calendar}) => {\n\n\t/* Calendar show */\n\t$(document).action(\"click.calendar\", function (event) {\n\n\t\t/* Get element */\n\t\tlet element = $(event.target || event.srcElement);\n\n\t\t/* Remove calendar */\n\t\tif (!element.is(\".calendar\") && !element.parents(\".calendar\").length)\n\t\t\t$(\".calendar\").remove();\n\n\t\t/* Calendar show */\n\t\tif (element.is(\"input.date\"))\n\t\t\tcalendar(element);\n\n\t\t/* Calendar show */\n\t\tif (element.is(\"input.datePeriod\"))\n\t\t\tcalendar(element, false, true);\n\n\t\t/* Calendar show */\n\t\tif (element.is(\"input.datetime\"))\n\t\t\tcalendar(element, true);\n\n\t\t/* Calendar show */\n\t\tif (element.is(\"input.datehour\"))\n\t\t\tcalendar(element, true);\n\n\t}).action(\"keydown.calendar\", function (event) {\n\t\tif (event.keyCode === 13) {\n\t\t\tlet calendars = $(\".calendar\");\n\t\t\tif (calendars.length) {\n\t\t\t\tcalendars.find(\".day.selected\").trigger(\"click\");\n\t\t\t\tevent.preventDefault();\n\t\t\t}\n\t\t}\n\t});\n});","/** Class to work with drop zone for File api */\nsky.service(\"ajaxFilesDropZone\", [\"supported\", \"callbacks\"], function({ supported, callbacks }) {\n\tthis.service = class {\n\t\tconstructor({ zone, data, url, options }) {\n\n\t\t\t/* Save options */\n\t\t\tthis.options   = options;\n\t\t\tthis.zone      = zone;\n\t\t\tthis.callbacks = callbacks();\n\t\t\tthis.data      = data;\n\t\t\tthis.url       = url;\n\t\t\tthis.files     = [];\n\n\t\t\t/* If no XHR supported, no file drip needed */\n\t\t\tif(!supported.XHRIsSupported) {\n\t\t\t\tthis.callbacks.fire(\"nonSupported\");\n\t\t\t\treturn this;\n\t\t\t}\n\n\t\t\t/* Bind events */\n\t\t\tthis.attachEvents();\n\n\t\t}\n\n\t\tattachEvents() {\n\n\t\t\t/* While over event */\n\t\t\tthis.zone.on({\n\n\t\t\t\tdragenter: (event) => { this.callbacks.fire(\"dragenter\", this, [event]); },\n\t\t\t\tdragleave: (event) => { this.callbacks.fire(\"dragleave\", this, [event]); },\n\t\t\t\tdragend  : (event) => { this.callbacks.fire(\"dragend\", this, [event]); \t },\n\t\t\t\tdrop     : (event) => { this.callbacks.fire(\"drop\", this, [event]);\t\t },\n\t\t\t\tdragover : (event) => {\n\n\t\t\t\t\t/* Get event */\n\t\t\t\t\tevent = event.originalEvent;\n\n\t\t\t\t\t/* Check if drag is valid */\n\t\t\t\t\tif(!this.isValidFileDrag(event))\n\t\t\t\t\t\treturn;\n\n\t\t\t\t\t/* Get effect */\n\t\t\t\t\tlet effect = event.dataTransfer.effectAllowed;\n\n\t\t\t\t\t/* Set proper */\n\t\t\t\t\tif(effect === 'move' || effect === 'linkMove') {\n\t\t\t\t\t\tevent.dataTransfer.dropEffect = 'move'; // for FF (only move allowed)\n\t\t\t\t\t} else {\n\t\t\t\t\t\tevent.dataTransfer.dropEffect = 'copy'; // for Chrome\n\t\t\t\t\t}\n\n\t\t\t\t\t/* Prevent */\n\t\t\t\t\tevent.preventDefault();\n\n\t\t\t\t}\n\t\t\t});\n\n\t\t\t/* Stop file opening when drop on browser window */\n\t\t\t$(document).bind({\n\t\t\t\tdragover : function(e) {\n\t\t\t\t\te = e.originalEvent;\n\t\t\t\t\tif(e.dataTransfer) {\n\t\t\t\t\t\te.dataTransfer.dropEffect = 'none';\n\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tdragenter: function(e) {\n\t\t\t\t\tif(typeof self.options.onStart !== \"undefined\")\n\t\t\t\t\t\tself.options.onStart.apply(self, [e]);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tstatic isValidFileDrag(event) {\n\n\t\t\tlet dt = event.dataTransfer,\n\t\t\t// do not check dt.types.contains in webkit, because it crashes safari 4\n\t\t\t\tisWebkit = navigator.userAgent.indexOf(\"AppleWebKit\") > -1;\n\n\t\t\t// dt.effectAllowed is none in Safari 5\n\t\t\t// dt.types.contains check is for firefox\n\t\t\treturn dt && dt.effectAllowed !== 'none' &&\n\t\t\t\t(dt.files || (!isWebkit && dt.types.contains && dt.types.contains('Files')));\n\n\t\t}\n\n\t};\n\n});","sky.service(\"ajaxFilesIFrame\", function() {\n\n\tlet AjaxFilesIFrame = function(options) {\n\n\t\t/* Save options */\n\t\tthis.options \t= options;\n\t\tthis.files    \t= options.files;\n\t\tthis.input   \t= options.input;\n\t\tthis.url  \t \t= options.url;\n\t\tthis.data \t \t= options.data;\n\t\tthis.callbacks \t= options.callbacks;\n\n\t};\n\n\tAjaxFilesIFrame.prototype = {\n\n\t\tgetName: function(name){\n\n\t\t\t// get input value and remove path to normalize\n\t\t\treturn name.replace(/.*(\\/|\\\\)/, \"\");\n\n\t\t},\n\n\t\tcancel: function(id){\n\n\t\t\tthis.options.onAbort(id, this.getName(this.input.value));\n\n\t\t\tthis.IFrame.setAttribute('src', 'javascript:false;').remove();\n\n\t\t},\n\n\t\t/**\n\t\t * Upload file function\n\t\t */\n\t\tsend: function() {\n\n\t\t\t/* letiables */\n\t\t\tlet self \t = this;\n\t\t\tlet input \t = this.input;\n\t\t\tlet fileName = this.getName(input.value);\n\n\t\t\t/* Create new input */\n\t\t\t$(input).clone().val(\"\").insertBefore(input);\n\n\t\t\t/* Create elements */\n\t\t\tthis.IFrame = this.createIframe();\n\t\t\tthis.form = this.createForm(this.IFrame, this.options.data).append(input);\n\n\t\t\tthis.attachLoadEvent(this.IFrame, function() {\n\n\t\t\t\tlet response = self.getIframeContentJSON(self.IFrame);\n\n\t\t\t\tif(response) self.options.onSuccess(response);\n\n\t\t\t\t// timeout added to fix busy state in FF3.6\n\t\t\t\tsetTimeout(function(){ self.IFrame.remove(); }, 1);\n\n\t\t\t});\n\n\t\t\tthis.form.trigger(\"submit\");\n\n\t\t},\n\n\t\t/**\n\t\t * Attach load event to IFrame\n\t\t */\n\t\tattachLoadEvent: function(iframe, callback){\n\n\t\t\tiframe.load(function(){\n\n\t\t\t\tif (!this.parentNode) return;\n\n\t\t\t\t// fixing Opera 10.53\n\t\t\t\tif (this.contentDocument &&\n\t\t\t\t\tthis.contentDocument.body &&\n\t\t\t\t\tthis.contentDocument.body.innerHTML === \"false\") return;\n\n\t\t\t\tcallback();\n\n\t\t\t});\n\n\t\t},\n\n\t\t/**\n\t\t * Returns json object received by IFrame from server.\n\t\t */\n\t\tgetIframeContentJSON: function(iframe){\n\n\t\t\t/* IFrame.contentWindow.document - for IE<7 */\n\t\t\tlet doc = iframe.get(0).contentDocument ? iframe.get(0).contentDocument: iframe.get(0).contentWindow.document;\n\n\t\t\tlet response = doc.body.innerHTML\n\n\t\t\t/* Check for empty response */\n\t\t\tif(response === \"\") {\n\t\t\t\tif(self.callbacks) self.callbacks.onError(\"Данные небыли переданы\"); // No data\n\t\t\t\treturn false;\n\t\t\t}\n\n\n\t\t\t/* Try to get json data */\n\t\t\ttry {\n\t\t\t\tresponse = jQuery.parseJSON(response);\n\t\t\t} catch(e) {\n\t\t\t\tif(self.callbacks) {\n\t\t\t\t\tself.callbacks.onError(\"Неверный формат данных\"); // No data\n\t\t\t\t\tconsole.log(response);\n\t\t\t\t}\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\t/* If response returned with error */\n\t\t\tif(response.error) {\n\t\t\t\tif(self.callbacks) self.callbacks.onError(response.text); // Execute user error handler\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\treturn response;\n\t\t},\n\n\t\t/**\n\t\t * Creates IFrame with unique name\n\t\t */\n\t\tcreateIframe: function() {\n\n\t\t\treturn $('<IFrame/>', { src: \"javascript:false;\", name: \"uploadIFrame\" + Math.floor(Math.random()*1000000) }).css(\"display\", \"none\").appendTo('body');\n\n\t\t},\n\n\t\t/**\n\t\t * Creates form, that will be submitted to IFrame\n\t\t */\n\t\tcreateForm: function(iframe, params) {\n\n\t\t\tlet queryString = this.url + \"?\" + jQuery.param(params);\n\n\t\t\treturn $('<form/>', {\n\t\t\t\tmethod: \"post\", enctype: \"multipart/form-data\", action: queryString, target: iframe.attr(\"name\")\n\t\t\t}).css(\"display\", \"none\").appendTo('body');\n\n\t\t}\n\n\t};\n\n});","/**\n * Module to work with ajax file upload\n */\nsky.service(\"ajaxFiles\", [\"supported\", \"callbacks\", \"ajaxFilesXHR\", \"ajaxFilesIFrame\"], function({ callbacks, supported, ajaxFilesXHR, ajaxFilesIFrame }) {\n\n\t/**\n\t * Class to work with dynamic file upload\n\t * @param {html|string} input Input to be used to upload\n\t * @param {string} url Url to upload\n\t * @param {object} data Data to be send with request\n\t */\n\tlet AjaxFiles = this.service = function(input, url, data) {\n\n\t\t/* Self construct */\n\t\tif(!(this instanceof AjaxFiles))\n\t\t\treturn new AjaxFiles(input, url, data);\n\n\t\t/* Save items */\n\t\tthis.inputs \t= $(input);\n\t\tthis.url   \t\t= url;\n\t\tthis.data  \t\t= data;\n\t\tthis.callbacks \t= callbacks();\n\t\tthis.files\t\t= [];\n\n\t\t/**\n\t\t * Function to handle file input change\n\t\t */\n\t\tthis.saveFiles = function(input) {\n\n\t\t\t/* Get files list */\n\t\t\tif(supported.XHRUpload) {\n\n\t\t\t\t/* Get files from event */\n\t\t\t\tlet files = input.get(0).files;\n\n\t\t\t\t/* Save them to this */\n\t\t\t\tfor(let file of files)\n\t\t\t\t\tthis.files.push({ file: file, input: input, inputName: input.attr(\"name\") });\n\n\t\t\t} else this.files.push(input.get(0));\n\n\t\t};\n\n\t\t/**\n\t\t * Sends ajax files\n\t\t * @param {bool} parallel If try files would be send in parallel\n\t\t * @returns {*}\n\t\t */\n\t\tthis.send = function(parallel) {\n\n\t\t\t/* Clear */\n\t\t\tthis.files = [];\n\n\t\t\t/* Get files list */\n\t\t\tthis.inputs.each((_, input) => { this.saveFiles($(input)); });\n\n\t\t\t/* If no files */\n\t\t\tif(!this.files.length)\n\t\t\t\treturn false;\n\n\t\t\t/* Create supported handler */\n\t\t\tlet handler;\n\t\t\tif(supported.XHRUpload)\n\t\t\t\thandler = new ajaxFilesXHR(this);\n\t\t\telse\n\t\t\t\thandler = new ajaxFilesIFrame(this);\n\n\t\t\t/* Send files */\n\t\t\tif(parallel)\n\t\t\t\tthis.sendParallel(handler);\n\t\t\telse\n\t\t\t\tthis.sendConsequentially(handler);\n\n\t\t\t/* return send handler */\n\t\t\treturn handler;\n\n\t\t};\n\n\t\t/**\n\t\t * Sends files consequentially\n\t\t * @param handler\n\t\t */\n\t\tthis.sendConsequentially = function(handler) {\n\n\t\t\t/* First id */\n\t\t\tlet id = 0;\n\n\t\t\t/* Set sending next after this one */\n\t\t\tthis.callbacks.on(\"always\", () => {\n\t\t\t\tid++;\n\t\t\t\tif(this.files[id])\n\t\t\t\t\thandler.send(this.files[id]);\n\t\t\t});\n\n\t\t\t/* Send first */\n\t\t\thandler.send(self.files[id]);\n\n\t\t};\n\n\t\t/**\n\t\t * Sends files parallel\n\t\t * @param handler\n\t\t */\n\t\tthis.sendParallel = function(handler) {\n\n\t\t\t/* Send files through them */\n\t\t\tfor(let file of this.files)\n\t\t\t\thandler.send(file);\n\n\t\t};\n\n\t\t/* Self return */\n\t\treturn this;\n\n\t};\n\n\t/**\n\t * Performs default file send\n\t * @param {string} url\n\t * @param element\n\t * @param data\n\t */\n\tAjaxFiles.defaultSend = function(url, element, data) {\n\n\t\t// Get input\n\t\tlet input = element.is(\"input[type=file]\") ? element : element.closest(\"label, .label\").find(\"input[type=file]\"),\n\t\t\texceptions = sky.service(\"exceptions\"),\n\t\t\ttemplates = sky.service(\"templates\"),\n\t\t\tnotifications = sky.service(\"notifications\"),\n\t\t\twindows = sky.service.windows(\"windows\");\n\n\t\t// Check\n\t\tif(!input.length)\n\t\t\tthrow new exceptions.system.Error(\"No proper input provided for file send\");\n\n\t\t// Init\n\t\tlet filesAjax = AjaxFiles(input, url, data),\n\t\t\tmodal = windows.getLast(),\n\t\t\tcurrentFile;\n\n\t\t/*  Bind events */\n\t\tfilesAjax.callbacks\n\t\t\t.on(\"begin\", function (file) {\n\t\t\t\tif(modal) {\n\t\t\t\t\tmodal.holder.find(\".preview\").remove();\n\t\t\t\t\tmodal.lock();\n\t\t\t\t}\n\t\t\t\tcurrentFile = templates.render(\"files-single-upload\", file).insertAfter(element.parent());\n\t\t\t})\n\t\t\t.on(\"always\", function () {\n\t\t\t\tcurrentFile.remove();\n\t\t\t\tif(modal)\n\t\t\t\t\tmodal.unlock();\n\t\t\t})\n\t\t\t.on(\"notSuccess\", function (error) {\n\t\t\t\tmodal.clearExceptTemplate();\n\t\t\t\tnotifications.message({text: error}).appendToModal(modal);\n\t\t\t})\n\t\t\t.on(\"progress\", function (totalPercent, percent) {\n\t\t\t\tcurrentFile.find(\".total\").html(percent + \"%\");\n\t\t\t\tcurrentFile.find(\".progressBar div\").css(\"width\", percent + \"%\");\n\n\t\t\t\t// If loaded\n\t\t\t\tif (percent === 100)\n\t\t\t\t\tcurrentFile.find(\".total\").html(\"100%, обработка\");\n\n\n\t\t\t})\n\t\t\t.on(\"start\", function () {\n\n\t\t\t});\n\n\t\t/* Send */\n\t\tfilesAjax.send();\n\t\treturn filesAjax;\n\n\t};\n\n});","/** Sends file data via HttpRequest */\nsky.service(\"ajaxFilesXHR\", [\"supported\", \"ajax\", \"stackList\"], function({supported, ajax, stackList}) {\n\tthis.service = class {\n\t\tconstructor(options) {\n\n\t\t\t/* Save options */\n\t\t\tthis.options \t\t= options;\n\t\t\tthis.files \t\t\t= options.files;\n\t\t\tthis.input \t\t\t= options.input;\n\t\t\tthis.url \t\t\t= options.url;\n\t\t\tthis.data \t\t\t= options.data;\n\t\t\tthis.callbacks \t\t= options.callbacks;\n\t\t\tthis.toProceed \t\t= options.files.length;\n\t\t\tthis.inProgress \t= 0;\n\t\t\tthis.total \t\t\t= options.files.length;\n\t\t\tthis.totalLoaded \t= 0;\n\t\t\tthis.totalSize \t\t= 0;\n\t\t\tthis.totalPercent \t= 0;\n\t\t\tthis.current \t\t= 0;\n\t\t\tthis.fileRequests \t= stackList();\n\n\t\t\t/* Go through */\n\t\t\tfor(file of options.files)\n\t\t\t\tthis.totalSize += file.size;\n\n\t\t}\n\n\t\t/**\n\t\t * Get file name\n\t\t * @param {*} file File\n\t\t * @returns {string}\n\t\t */\n\t\tstatic getName(file) {\n\t\t\treturn file.name.replace(/.*(\\/|\\\\)/, \"\");\n\t\t}\n\n\t\t/**\n\t\t * Uploads file\n\t\t * @param {*} file File name in files stack\n\t\t */\n\t\tsend(file) {\n\n\t\t\t/* This obj will store data associated with XHR */\n\t\t\t$.extend(file, {\n\t\t\t\tid     : Math.random(),\n\t\t\t\tname   : this.getName(file.file),\n\t\t\t\tsize   : file.file.size,\n\t\t\t\tajax   : false,\n\t\t\t\tpercent: false,\n\t\t\t\tloaded : 0\n\t\t\t});\n\n\t\t\t/* Prepare params */\n\t\t\tlet self        = this,\n\t\t\t\tparams      = this.data || {},\n\t\t\t\tqueryString = this.url + \"?ajaxFile=\" + file.name + \"&\" + jQuery.param(params);\n\n\t\t\t/**\n\t\t\t * Params extend\n\t\t\t * @param {object} args Object to be extended\n\t\t\t * @returns {*}\n\t\t\t */\n\t\t\tthis.extend = function(args) {\n\t\t\t\treturn jQuery.extend(args, {\n\t\t\t\t\ttotalLoaded : self.totalLoaded,\n\t\t\t\t\ttotalSize   : self.totalSize,\n\t\t\t\t\ttotalPercent: self.totalPercent,\n\t\t\t\t\tfile        : file,\n\t\t\t\t\tloaded      : file.loaded,\n\t\t\t\t\tsize        : file.size,\n\t\t\t\t\tpercent     : file.percent,\n\t\t\t\t\ttoProceed   : self.toProceed,\n\t\t\t\t\tcurrent     : self.current,\n\t\t\t\t\ttotal       : self.total\n\t\t\t\t});\n\t\t\t};\n\n\t\t\t/* Send */\n\t\t\tif(supported.formData) {\n\n\t\t\t\t/* Create form data sender */\n\t\t\t\tlet form = new FormData();\n\t\t\t\tform.append(file.inputName, file.file);\n\n\t\t\t\t/* Send start */\n\t\t\t\tfile.ajax = ajax(queryString, form, { ajaxExtend: {\n\t\t\t\t\t\tprocessData: false,\n\t\t\t\t\t\tcontentType: false,\n\t\t\t\t\t\ttype       : \"POST\",\n\t\t\t\t\t\txhr        : (() => {\n\t\t\t\t\t\t\ttry {\n\n\t\t\t\t\t\t\t\t/* Create XHR */\n\t\t\t\t\t\t\t\tlet xhr = new XMLHttpRequest();\n\n\t\t\t\t\t\t\t\t/* Set special upload api handlers */\n\t\t\t\t\t\t\t\txhr.upload[\"onloadstart\"] = function() {\n\t\t\t\t\t\t\t\t\tthis.inProgress++;\n\t\t\t\t\t\t\t\t\tthis.callbacks.fire(\"begin\", this.extend({}));\n\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t\txhr.upload[\"onprogress\"] = function(event) {\n\t\t\t\t\t\t\t\t\tthis.totalLoaded += event.loaded - file.loaded;\n\t\t\t\t\t\t\t\t\tthis.totalPercent = (this.totalLoaded / this.totalSize * 100).toFixed(0);\n\t\t\t\t\t\t\t\t\tthis.onProgress(event, file);\n\t\t\t\t\t\t\t\t};\n\n\t\t\t\t\t\t\t\t/* Return create XHR */\n\t\t\t\t\t\t\t\treturn xhr;\n\n\t\t\t\t\t\t\t} catch(e) {\n\t\t\t\t\t\t\t\treturn undefined;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}).safe()\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t} else {\n\n\t\t\t\t/* Send start */\n\t\t\t\tfile.ajax = ajax(queryString, file.file, {\n\t\t\t\t\tprocessData: false,\n\t\t\t\t\tcontentType: false,\n\t\t\t\t\ttype       : \"POST\",\n\t\t\t\t\tbeforeSend : sky.func(function(jqXHR) {\n\t\t\t\t\t\tjqXHR.setRequestHeader(\"X-Requested-With\", \"XMLHttpRequest\");\n\t\t\t\t\t\tjqXHR.setRequestHeader(\"X-File-Name\", encodeURI(file.name));\n\t\t\t\t\t\tjqXHR.setRequestHeader(\"Content-Type\", \"multipart/form-data\");\n\t\t\t\t\t\tjqXHR.setRequestHeader(\"Content-Disposition\", 'attachment; filename=\"' + encodeURI(file.name) + '\"');\n\t\t\t\t\t\tjqXHR.setRequestHeader(\"Accept\", \"text/html,application/xhtml+xml,application/xml;q=0.9\");\n\t\t\t\t\t})\n\t\t\t\t});\n\n\t\t\t}\n\n\t\t\t/* Set ajax callbacks */\n\t\t\tfile.ajax.on({\n\t\t\t\tsuccess:\t(all) => { this.callbacks.fire(\"success\", this.extend(all)); },\n\t\t\t\terror: \t\t(all) => { this.callbacks.fire(\"error\", this.extend(all)); },\n\t\t\t\tnotSuccess: (all) => { this.callbacks.fire(\"notSuccess\", this.extend(all)); },\n\t\t\t\talways: \t(all) => {\n\n\t\t\t\t\t/* Counters */\n\t\t\t\t\tthis.inProgress--;\n\t\t\t\t\tthis.toProceed--;\n\n\t\t\t\t\t/* Call always method */\n\t\t\t\t\tthis.callbacks.fire(\"always\", this.extend(all));\n\n\t\t\t\t\t/* Delete connection */\n\t\t\t\t\tthis.fileRequests.delete(file);\n\n\t\t\t\t}\n\t\t\t});\n\n\t\t\t/* Save */\n\t\t\tthis.fileRequests.add(file);\n\n\t\t}\n\n\t\t/**\n\t\t * Fores on progress change\n\t\t * @param event\n\t\t * @param fileRequestData\n\t\t */\n\t\tonProgress(event, fileRequestData) {\n\n\t\t\t/* Count percentage */\n\t\t\tlet percent = (event.loaded / event[\"total\"] * 100).toFixed(0);\n\t\t\tfileRequestData.loaded = event.loaded;\n\n\t\t\t/* If percent changed */\n\t\t\tif(percent !== fileRequestData.percent && event[\"lengthComputable\"]) {\n\t\t\t\tfileRequestData.percent = percent;\n\t\t\t\tthis.callbacks.fire(\"progress\", this.extend({}));\n\t\t\t}\n\n\t\t}\n\n\t\t/**\n\t\t * Aborts current download\n\t\t */\n\t\tabort() {\n\n\t\t\t/* Stop each request */\n\t\t\tthis.fileRequests.each(request => { request.ajax.stop() });\n\n\t\t\t/* Call always method */\n\t\t\tthis.callbacks.fire(\"abort\", this.extend({}));\n\n\t\t}\n\n\t};\n\n});","sky.service(\"callback\", function() {\n\n\t/**\n\t * Creates callback object that holds functions list\n\t * @param {string} [flags]\n\t * @returns {*}\n\t * @constructor\n\t */\n\tlet Callback = function(flags) {\n\n\t\t/* Self construct */\n\t\tif(!(this instanceof Callback))\n\t\t\treturn new Callback(flags);\n\n\t\t/**\n\t\t * Functions list holder\n\t\t * @type {Array}\n\t\t */\n\t\tthis.functions = [];\n\t\tthis.toRun =  0;\n\t\tthis.context = this;\n\n\t\t/* Self return for next usage */\n\t\treturn this;\n\n\t};\n\n\t/**\n\t * Base\n\t * @type {{functions: Array, toRun: number, context: *, add: add, removeByContext: removeByContext, fire: fire, fireNext: fireNext}}\n\t */\n\tCallback.prototype = {\n\n\t\t/**\n\t\t * Adds new function to stack\n\t\t * @param {Function} func Function to add\n\t\t * @param {Object} context Function context\n\t\t * @param {Object} options Call options\n\t\t */\n\t\tadd: function(func, context, options) {\n\t\t\tthis.functions.push({\n\t\t\t\tfunc: func,\n\t\t\t\tcontext: context || false,\n\t\t\t\tonce: options && options.once\n\t\t\t});\n\t\t\treturn this;\n\t\t},\n\n\t\t/**\n\t\t * Removes function from list by context\n\t\t * @param context\n\t\t */\n\t\tremoveByContext: function(context) {\n\n\t\t\t/* Find listener */\n\t\t\tlet i;\n\t\t\tfor(i in this.functions)\n\t\t\t\tif(this.functions[i].context === context)\n\t\t\t\t\tthis.functions.splice(i, 1);\n\n\t\t\t/* Self return */\n\t\t\treturn this;\n\n\t\t},\n\n\t\t/**\n\t\t * Removes function from list by context\n\t\t * @param func\n\t\t */\n\t\tremoveByCallback: function(func) {\n\n\t\t\t/* Find listener */\n\t\t\tlet i;\n\t\t\tfor(i in this.functions)\n\t\t\t\tif(this.functions[i].func === func)\n\t\t\t\t\tthis.functions.splice(i, 1);\n\n\t\t\t/* Self return */\n\t\t\treturn this;\n\n\t\t},\n\n\t\t/**\n\t\t * Fires all functions\n\t\t * @param {Object} context Function context\n\t\t * @param {Array} args Arguments\n\t\t */\n\t\tfire: function(context, args) {\n\t\t\tfor(let func of this.functions)\n\t\t\t\tfunc.func.apply(func.context || context, args);\n\t\t},\n\n\t\t/**\n\t\t * Fires next function\n\t\t * @param {Array|Object} args Arguments\n\t\t * @param {Object} context Function context\n\t\t */\n\t\tfireNext: function(args, context) {\n\n\t\t\t/* If no more to run */\n\t\t\tif(this.functions.length <= this.toRun)\n\t\t\t\treturn false;\n\n\t\t\t/* Set next to run */\n\t\t\tthis.toRun++;\n\n\t\t\t/* Function to run */\n\t\t\tlet current = this.functions[this.toRun - 1],\n\t\t\t\tresult,\n\t\t\t\tfunc = current.func;\n\n\t\t\t/* Set context */\n\t\t\tcontext = current.context || context || window;\n\n\t\t\t/* Get function in string */\n\t\t\tif(typeof func === \"string\")\n\t\t\t\tfunc = context[func];\n\n\t\t\t/* If no function found */\n\t\t\tif(!func)\n\t\t\t\treturn true;\n\n\t\t\t/* Call function */\n\t\t\tresult =  func.apply(current.context || context, args) !== false;\n\n\t\t\t/* If call once */\n\t\t\tif(current.once) {\n\t\t\t\tthis.functions.splice(this.toRun - 2, 1);\n\t\t\t\tthis.toRun--;\n\t\t\t}\n\n\t\t\t/* Return function result */\n\t\t\treturn result;\n\t\t}\n\n\t};\n\n\tthis.service = Callback;\n\n});","sky.service(\"callbacks\", [\"callback\"], function({ callback }) {\n\n\t/**\n\t *\n\t * Callbacks prepared object\n\t * @param {*} [flags] Flags list for jQuery.Callbacks\n\t * @constructor\n\t */\n\tlet Callbacks = function(flags) {\n\n\t\t/* Self construction */\n\t\tif(!(this instanceof Callbacks))\n\t\t\treturn new Callbacks(flags);\n\n\t\t/* Add properties */\n\t\t$.extend(true, this, Callbacks.extend);\n\n\t\t/* Callbacks list */\n\t\tthis.advancedCallbacks = {};\n\n\t\t/* Set default flags and self context */\n\t\treturn this.flags(flags);\n\n\t};\n\n\t/**\n\t * Prototype\n\t * @type {{on: on, fire: fire, off: off, flags: flags, setContext: setContext}}\n\t */\n\tCallbacks.prototype = {\n\n\t\t\t/**\n\t\t\t * Flags for sky.Callback\n\t\t\t * @param {object} flags Flags list\n\t\t\t * @returns {*}\n\t\t\t */\n\t\t\tflags: function(flags) {\n\t\t\t\tthis.callbacksFlags = flags;\n\t\t\t\treturn this;\n\t\t\t},\n\n\t\t\t/**\n\t\t\t * Remove by listener\n\t\t\t * @param {string} name Event name\n\t\t\t * @param {string} listener Listener object\n\t\t\t */\n\t\t\tremoveListener: function(name, listener) {\n\t\t\t\tif(this.advancedCallbacks[name]) {\n\t\t\t\t\tthis.advancedCallbacks[name].removeByContext(listener);\n\t\t\t\t}\n\t\t\t},\n\n\t\t\t/**\n\t\t\t * Adds new event handler\n\t\t\t * @param {string} \t name \t\t\tName of event\n\t\t\t * @param {function|string} func \tFunction be called on event fires\n\t\t\t * @param {object}   [context]\t\tFunction options\n\t\t\t * @param {object}   [options]\t\tFunction options\n\t\t\t */\n\t\t\ton:  function(name, func, context, options) {\n\n\n\t\t\t\tif(name instanceof Object)\n\t\t\t\t\t$.each(name, (event, func) => { this.on(event, func) });\n\n\t\t\t\telse $.each(this.getEventsNames(name), (_, name) => {\n\n\t\t\t\t\t/* Create callbacks */\n\t\t\t\t\tif(!this.advancedCallbacks[name])\n\t\t\t\t\t\tthis.advancedCallbacks[name] = callback(this.callbacksFlags);\n\n\t\t\t\t\t/* Add function */\n\t\t\t\t\tthis.advancedCallbacks[name].add(func, context ? context : self.context, options || {});\n\n\t\t\t\t});\n\n\t\t\t\treturn this;\n\t\t\t},\n\n\t\t\t/**\n\t\t\t * Fires callbacks for specified event\n\t\t\t * @param {string} name Name of event\n\t\t\t * @param {object} args Arguments to be passed\n\t\t\t * @param {object} [options] Additional options\n\t\t\t */\n\t\t\tfire: function(name, args, options) {\n\n\t\t\t\t/* Success last */\n\t\t\t\tlet events = this.getEventsNames(name),\n\t\t\t\t\tself = this,\n\t\t\t\t\tnext = false;\n\t\t\t\t\toptions = options || {};\n\n\t\t\t\t/* Remove global if need */\n\t\t\t\tif(options[\"noGlobal\"])\n\t\t\t\t\tevents = events.slice(1);\n\n\t\t\t\t/* Fire events */\n\t\t\t\t$.each(events, function(_, event) {\n\n\t\t\t\t\t/* If no callback */\n\t\t\t\t\tif(!self.advancedCallbacks[event])\n\t\t\t\t\t\treturn;\n\n\t\t\t\t\t/* Run */\n\t\t\t\t\tdo {\n\t\t\t\t\t\tnext = self.advancedCallbacks[event].fireNext(jQuery.extend({ event: event }, args || []), self.context, options.possible);\n\t\t\t\t\t} while(next);\n\n\t\t\t\t\t/* Reset */\n\t\t\t\t\tif(!options.once)\n\t\t\t\t\t\tself.advancedCallbacks[event].toRun = 0;\n\n\t\t\t\t});\n\n\t\t\t},\n\n\t\t\t/**\n\t\t\t * Get all event names from global name\n\t\t\t * @param {String} name Global event name\n\t\t\t * @returns {Array}\n\t\t\t */\n\t\t\tgetEventsNames: function(name) {\n\n\t\t\t\t/* Get events names */\n\t\t\t\tlet names = name.split(\",\"), events = [];\n\n\t\t\t\t/* Go through */\n\t\t\t\t$.each(names, function(i, name) {\n\n\t\t\t\t\t/* Remove spaces */\n\t\t\t\t\tname = name.replace(\" \", \"\");\n\n\t\t\t\t\t/* Get elements */\n\t\t\t\t\tlet elements = name.split(\".\");\n\t\t\t\t\tevents.push(elements[0]);\n\n\t\t\t\t\t/* Go through */\n\t\t\t\t\tfor(let j = 1; j < elements.length; j++)\n\t\t\t\t\t\tevents.push(elements[0] + \".\" + elements[j]);\n\n\t\t\t\t\t/* Global event */\n\t\t\t\t\tif(elements.length > 2)\n\t\t\t\t\t\tevents.push(elements.join(\".\"));\n\n\t\t\t\t});\n\n\t\t\t\t/* Return */\n\t\t\t\treturn events;\n\n\t\t\t},\n\n\t\t/**\n\t\t * Removes event handlers and functions\n\t\t * @param {string} name Event name\n\t\t * @param func\n\t\t */\n\t\t\toff: function(name, func = null) {\n\t\t\t\tif(func && this.advancedCallbacks[name])\n\t\t\t\t\tthis.advancedCallbacks[name].removeByCallback(func);\n\t\t\t\telse\n\t\t\t\t\tdelete this.advancedCallbacks[name];\n\t\t\t}\n\n\t\t};\n\n\t\tthis.service = Callbacks;\n\n});","sky.service(\"dataOperator\", [ \"inputsIO\", \"notifications\", \"templates\", \"utils\", \"ajax\", \"actions\" ], function ({ inputsIO, notifications, templates, utils, ajax, actions }) {\n\n\tclass searchField {\n\t\tconstructor(name, virtual) {\n\t\t\tthis.name = name;\n\t\t\tthis.inputName = name;\n\t\t\tthis.virtual = virtual || false;\n\t\t\tthis.default = null;\n\t\t\tthis.input = false;\n\t\t\tthis.value = null;\n\t\t}\n\t\tvalueOrNullOnDefault() {\n\t\t\tif ((this.default instanceof Array) && (this.value instanceof Array))\n\t\t\t\treturn utils.isObjectsEqual(this.value, this.default) ? null : this.value;\n\n\t\t\treturn this.value === this.default ? null : this.value;\n\t\t}\n\t\tread() {\n\t\t\tif (this.virtual === \"search\")\n\t\t\t\treturn this.searchRead();\n\t\t\telse if (this.virtual)\n\t\t\t\treturn this.hashRead();\n\t\t\telse if (this.input)\n\t\t\t\tthis.value = inputsIO.readInputsValues(this.input);\n\n\t\t\treturn this.value;\n\t\t}\n\t\twrite() {\n\t\t\tif (this.input)\n\t\t\t\tinputsIO.writeInputsValue(this.value === null ? this.default : this.value, this.input);\n\t\t\treturn this.value;\n\t\t}\n\t\thashRead() {\n\t\t\tlet hashValue = page.history.hashObject[this.name];\n\t\t\treturn this.value = (typeof hashValue === \"undefined\") ? this.default : hashValue;\n\t\t}\n\t\tsearchRead () {\n\t\t\tlet searchValue = page.history.searchObject[this.name];\n\t\t\treturn this.value = (typeof searchValue === \"undefined\") ? this.default : searchValue;\n\t\t}\n\t}\n\n\t/**\n\t * Default options\n\t * @type {{}}\n\t */\n\tlet baseOptions = {\n\t\tfields: {},\n\t\thistoryType: \"hash\"\n\t};\n\n\t/* Creates new data operator */\n\tclass DataOperator {\n\t\tconstructor(options) {\n\n\t\t\t/* Stores last request object */\n\t\t\tthis.lastRequestData = false;\n\n\t\t\t/* Func that calls before request */\n\t\t\tthis.beforeRequest = false;\n\t\t\t\n\t\t\t/* Fields list */\n\t\t\tthis.fields = {};\n\n\t\t\t/* Add base options, but only not set, that's why so fun construction */\n\t\t\tthis.options = $.extend({}, baseOptions, true);\n\n\t\t\t/* Options init */\n\t\t\tthis.setOptions(options);\n\n\t\t}\n\n\t\t/** Saves to options */\n\t\tsetOptions(options) {\n\n\t\t\t/* Back link */\n\t\t\tlet self = this;\n\n\t\t\t/* Set submit handler */\n\t\t\tif (options.form)\n\t\t\t\t$(options.form).action(\"submit\", this.onFormSubmit.bind(this));\n\n\t\t\t/* Add to options */\n\t\t\t$.extend(this.options, options, true);\n\n\t\t\t/* Self return */\n\t\t\treturn this;\n\t\t}\n\n\t\t/**\n\t\t * On form submit\n\t\t * @param event\n\t\t */\n\t\tonFormSubmit(event) {\n\n\t\t\t/* Prevent */\n\t\t\tevent.preventDefault();\n\n\t\t\t/* If form not valid */\n\t\t\tif (!$(this.options.form).validForm())\n\t\t\t\treturn;\n\n\t\t\tlet options = {force: true};\n\n\t\t\tif (this.fields[\"page\"])\n\t\t\t\toptions[this.options.historyType === \"search\" ? \"search\" : \"hash\"] = {page: 1};\n\n\t\t\t/* Update */\n\t\t\tthis.reload(options);\n\n\t\t}\n\n\t\tprepareRequest(options) {\n\n\t\t\t/* On empty */\n\t\t\toptions = options || {};\n\n\t\t\t/* Hash fields */\n\t\t\tif (options[\"hash\"])\n\t\t\t\tpage.history.set(options[\"hash\"]);\n\n\t\t\t/* Hash fields */\n\t\t\tif (options[\"search\"])\n\t\t\t\tpage.history.search(options[\"search\"]);\n\n\t\t\t/* Hash fields */\n\t\t\tif (options[\"virtual\"]) {\n\t\t\t\tif (this.options.historyType === \"search\")\n\t\t\t\t\tpage.history.search(options[\"virtual\"]);\n\t\t\t\telse\n\t\t\t\t\tpage.history.set(options[\"virtual\"]);\n\t\t\t}\n\n\t\t\t/* Write to form from hash */\n\t\t\tif (options.fromUrl) {\n\t\t\t\tif (this.options.historyType === \"search\")\n\t\t\t\t\tthis.readSearch().writeForm();\n\t\t\t\telse\n\t\t\t\t\tthis.readHash().writeForm();\n\t\t\t}\n\n\t\t\t/* jQuery wrap */\n\t\t\tif (this.options.form && !$(this.options.form).validForm())\n\t\t\t\treturn false;\n\n\t\t\t/* Read */\n\t\t\tlet data = this.read();\n\n\t\t\t/* Add additional data */\n\t\t\tif (this.options[\"requestData\"])\n\t\t\t\tdata = $.extend(data, this.options[\"requestData\"]);\n\n\t\t\t/* Check is same and no force requested */\n\t\t\tif (this.lastRequestData !== false && utils.isObjectsEqual(this.lastRequestData, data) && !options[\"force\"])\n\t\t\t\treturn false;\n\n\t\t\t/* Set hash data */\n\t\t\tif (!options.fromUrl && this.options.historyType === \"search\")\n\t\t\t\tthis.writeSearch();\n\t\t\telse if (!options.fromUrl)\n\t\t\t\tthis.writeHash();\n\n\t\t\t/* Before request call */\n\t\t\tif (this.beforeRequest)\n\t\t\t\tif (this.beforeRequest(data, options) === false)\n\t\t\t\t\treturn false;\n\n\t\t\t/* Return data */\n\t\t\treturn data;\n\n\t\t}\n\n\t\t/**\n\t\t * Reloads data according to params\n\t\t * @param options\n\t\t * @returns {DataOperator}\n\t\t */\n\t\treload(options) {\n\n\t\t\t/* Prepare */\n\t\t\tlet data = this.prepareRequest(options);\n\n\t\t\t/* Reload */\n\t\t\tif (data)\n\t\t\t\tthis.request(data);\n\n\t\t\t/* Self return */\n\t\t\treturn this;\n\n\t\t}\n\n\t\t/**\n\t\t * Performs request to reload data\n\t\t * @param data\n\t\t */\n\t\trequest(data) {\n\n\t\t\t/* Back link */\n\t\t\tlet self = this;\n\n\t\t\t/* Save last data */\n\t\t\tself.lastRequestData = data;\n\n\t\t\t/* Stop old request */\n\t\t\tif (this.ajax)\n\t\t\t\tthis.ajax.stop();\n\n\t\t\t/* Request */\n\t\t\tthis.ajax = ajax(this.options.url, data)\n\t\t\t\t.on(\"success\", function (response) {\n\t\t\t\t\tself.lastResponse = response;\n\t\t\t\t\tself.render(response, data);\n\t\t\t\t})\n\t\t\t\t.on(\"error\", function (error) {\n\t\t\t\t\tself.error(error)\n\t\t\t\t})\n\t\t\t\t.on(\"always\", function () {\n\t\t\t\t\tself.ajax = false;\n\t\t\t\t});\n\n\t\t\t/* Create loading, auto remove when ajax finishes */\n\t\t\tnotifications.loading(this.ajax).reloadContent(this.options.holder);\n\n\t\t}\n\n\t\t/**\n\t\t * On success, have to be overloaded\n\t\t * @param data\n\t\t * @param request\n\t\t */\n\t\trender(data, request) {}\n\n\t\t/**\n\t\t * On error, have to be overloaded\n\t\t * @param error\n\t\t */\n\t\terror(error) {}\n\n\t\t/**\n\t\t * Adds list of fields to current list\n\t\t * @param {Array} list List of names\n\t\t * @param {Boolean} [virtual] Virtual fields flag\n\t\t */\n\t\tfieldsList(list, virtual) {\n\n\t\t\t/* Back link */\n\t\t\tlet self = this;\n\n\t\t\t/* Go through and push */\n\t\t\t$.each(list, function (_, item) {\n\t\t\t\tself.options.fields[item] = virtual;\n\t\t\t});\n\n\t\t\t/* Self return */\n\t\t\treturn this;\n\t\t\t\n\t\t}\n\n\t\t/**\n\t\t * Sets form fields\n\t\t * @param list\n\t\t * @returns {*}\n\t\t */\n\t\trealFieldsList(list) {\n\t\t\treturn this.fieldsList(list);\n\t\t}\n\n\t\t/**\n\t\t * Set none forms fields\n\t\t * @param list\n\t\t * @returns {*}\n\t\t */\n\t\tvirtualFieldsList(list) {\n\t\t\treturn this.fieldsList(list, true);\n\t\t}\n\n\t\t/**\n\t\t * Reads real fields\n\t\t * @returns {{}}\n\t\t */\n\t\treadReal() {\n\n\t\t\t/* Data holder */\n\t\t\tlet data = {};\n\n\t\t\t/* Go through */\n\t\t\t$.each(this.fields, function (i, field) {\n\t\t\t\t/** @let field searchField */\n\n\t\t\t\tif (field.virtual)\n\t\t\t\t\treturn;\n\n\t\t\t\t/* Read */\n\t\t\t\tfield.read();\n\n\t\t\t\t/* Get non default or null */\n\t\t\t\tlet val = field.valueOrNullOnDefault();\n\n\t\t\t\t/* If value not same as default */\n\t\t\t\tif (val !== null)\n\t\t\t\t\tdata[field.name] = val;\n\n\t\t\t});\n\n\t\t\t/* Self return */\n\t\t\treturn data;\n\n\t\t}\n\n\t\t/** Reads form to fields */\n\t\tread() {\n\n\t\t\t/* Data holder */\n\t\t\tlet data = {};\n\n\t\t\t/* Go through */\n\t\t\t$.each(this.fields, function (i, field) {\n\t\t\t\t/** @let field searchField */\n\n\t\t\t\t/* Read */\n\t\t\t\tfield.read();\n\n\t\t\t\t/* Get non default or null */\n\t\t\t\tlet val = field.valueOrNullOnDefault();\n\n\t\t\t\t/* If value not same as default */\n\t\t\t\tif (val !== null)\n\t\t\t\t\tdata[field.name] = val;\n\n\t\t\t});\n\n\t\t\t/* Self return */\n\t\t\treturn data;\n\t\t}\n\n\t\t/** Write current field to form */\n\t\twriteForm() {\n\t\t\t$.each(this.fields, function (i, field) {\n\t\t\t\t/** @let field searchField */\n\t\t\t\tfield.write();\n\t\t\t});\n\n\t\t\t/* Self return */\n\t\t\treturn this;\n\t\t}\n\n\t\t/** Reads hash to fields */\n\t\treadHash() {\n\t\t\t$.each(this.fields, function (i, field) {\n\t\t\t\t/** @let field searchField */\n\t\t\t\tfield.hashRead();\n\t\t\t});\n\n\t\t\t/* Self return */\n\t\t\treturn this;\n\t\t}\n\n\t\t/** Reads hash to fields */\n\t\treadSearch() {\n\t\t\t$.each(this.fields, function (i, field) {\n\t\t\t\t/** @let field searchField */\n\t\t\t\tfield.searchRead();\n\t\t\t});\n\n\t\t\t/* Self return */\n\t\t\treturn this;\n\t\t}\n\n\t\t/** Writes current fields to hash */\n\t\twriteHash() {\n\n\t\t\t/* To write */\n\t\t\tlet write = {};\n\n\t\t\t/* Go through */\n\t\t\t$.each(this.fields, function (i, field) {\n\t\t\t\t/** @let field searchField */\n\t\t\t\twrite[field.name] = field.valueOrNullOnDefault();\n\t\t\t});\n\n\t\t\t/* Write to hash */\n\t\t\tpage.history.set(write);\n\n\t\t\t/* Self return */\n\t\t\treturn this;\n\t\t}\n\n\t\t/** Writes current fields to hash */\n\t\twriteSearch() {\n\n\t\t\t/* To write */\n\t\t\tlet write = {};\n\n\t\t\t/* Go through */\n\t\t\t$.each(this.fields, function (i, field) {\n\t\t\t\t/** @let field searchField */\n\t\t\t\twrite[field.name] = field.valueOrNullOnDefault();\n\t\t\t});\n\n\t\t\t/* Write to hash */\n\t\t\tpage.history.search(write);\n\n\t\t\t/* Self return */\n\t\t\treturn this;\n\n\t\t}\n\n\t\t/** Finds inputs associated with fields */\n\t\tinitInputs() {\n\n\t\t\t/* Back link */\n\t\t\tlet self = this;\n\n\t\t\t$.each(this.options.fields, function (fieldName, virtual) {\n\n\t\t\t\t// Create search field\n\t\t\t\tlet field = new searchField(fieldName, virtual ? self.options.historyType : false);\n\n\t\t\t\t/** @let field searchField */\n\t\t\t\tif (!field.virtual) {\n\n\t\t\t\t\t/* Find input */\n\t\t\t\t\tif (field.name[0] === \"*\") {\n\t\t\t\t\t\tfield.name = field.name.substring(1);\n\t\t\t\t\t\tfield.input = $(self.options.form).find(\".selectReplaceChoose[data-input=\" + field.name + \"]\");\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t\tfield.input = $(self.options.form).find('[name=\"' + field.name + '\"]');\n\n\t\t\t\t\t/* Remove fields without input */\n\t\t\t\t\tif (!field.input || !field.input.length) {\n\t\t\t\t\t\tdelete self.fields[fieldName];\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\t/* Save */\n\t\t\t\t\tself.fields[fieldName] = field;\n\n\t\t\t\t\t/* Read default */\n\t\t\t\t\tfield.default = field.read();\n\t\t\t\t\tfield.value = null;\n\t\t\t\t} else {\n\t\t\t\t\tif (self.options.historyType === \"search\")\n\t\t\t\t\t\tfield.virtual = \"search\";\n\t\t\t\t\tself.fields[fieldName] = field;\n\t\t\t\t}\n\t\t\t});\n\n\t\t\t/* Self return */\n\t\t\treturn this;\n\t\t}\n\t};\n\n\t/* Interface */\n\tthis.service = {\n\t\tinitOperator: options => new DataOperator(options),\n\t\tsearchField: searchField,\n\t\tinitLoader: function (loader, notifications, pagination, { reload = true, history = true }) {\n\n\t\t\t/* Add count */\n\t\t\tloader.beforeRequest = function (data, options) {\n\t\t\t\tif (!this.lastRequestData || options.force)\n\t\t\t\t\tdata[\"count\"] = true;\n\t\t\t};\n\n\t\t\t/* Render function */\n\t\t\tloader.render = function (response) {\n\n\t\t\t\t// Re render\n\t\t\t\t$(this.options.holder).html('').append(\n\t\t\t\t\ttemplates.render(\"page-result-render\", response)\n\t\t\t\t);\n\n\t\t\t\t// Remove old\n\t\t\t\tif (this.pagination)\n\t\t\t\t\tthis.pagination = this.pagination.remove();\n\n\t\t\t\tif (typeof response.pages !== \"undefined\") {\n\n\t\t\t\t\t// Pages holder\n\t\t\t\t\tlet holder = $(\"#pages\").html('');\n\n\t\t\t\t\t// Create new\n\t\t\t\t\tif (response.pages > 1 && pagination) {\n\t\t\t\t\t\tthis.pagination = pagination.add({\n\t\t\t\t\t\t\tpages: response.pages,\n\t\t\t\t\t\t\tcurrent: response.page,\n\t\t\t\t\t\t\tholder: holder\n\t\t\t\t\t\t});\n\t\t\t\t\t\tthis.pagination.onPageChange = function (pageNum) {\n\t\t\t\t\t\t\tloader.reload({virtual: {page: pageNum}});\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t};\n\n\t\t\t/* On loading error */\n\t\t\tloader.error = function (error) {\n\n\t\t\t\t// Remove pagination on error\n\t\t\t\tif (this.pagination)\n\t\t\t\t\tthis.pagination = this.pagination.remove();\n\n\t\t\t\t// Clear\n\t\t\t\t$(this.options.holder).html('').append(notifications.message({text: error}).render);\n\t\t\t};\n\n\t\t\t/* Reload */\n\t\t\tif (reload)\n\t\t\t\tloader.reload({fromUrl: true});\n\n\t\t\t/* Set handler */\n\t\t\tif (history)\n\t\t\t\tpage.history.on(\"change\", function (searchChanged, hashChanged) {\n\t\t\t\t\tif (searchChanged || hashChanged)\n\t\t\t\t\t\tloader.reload({fromUrl: true});\n\t\t\t\t});\n\n\t\t}\n\t}\n\n});","sky.service(\"inputsIO\", function () {\n\n\tthis.service = {\n\n\t\t/**\n\t\t * Get value of single input\n\t\t * @param input\n\t\t * @returns {*}\n\t\t */\n\t\treadInputValue: function (input) {\n\n\t\t\tif (input.is(\".selectReplaceChoose\")) {\n\n\t\t\t\t// Get inputs\n\t\t\t\tlet inputs = input.find(\"input\");\n\n\t\t\t\t// Read\n\t\t\t\tlet data = this.readInputsValues(inputs);\n\n\t\t\t\t// If all checked\n\t\t\t\tif (data.length === inputs.length)\n\t\t\t\t\treturn true;\n\n\t\t\t\t// Return data\n\t\t\t\treturn data;\n\n\t\t\t} else if (input.is(\":checkbox\") || input.is(\":radio\")) {\n\t\t\t\treturn input.is(\":checked\") ? input.val() : false;\n\t\t\t} else\n\t\t\t\treturn input.val() === \"\" ? false : input.val();\n\n\n\t\t},\n\n\t\t/**\n\t\t * Get value of multiple inputs\n\t\t * @param inputs\n\t\t * @returns {*}\n\t\t */\n\t\treadInputsValues: function (inputs) {\n\n\t\t\t/* If single input */\n\t\t\tif (inputs.length === 1)\n\t\t\t\treturn this.readInputValue(inputs);\n\n\t\t\t/* Values holder */\n\t\t\tlet valuesNamed = [],\n\t\t\t\tvaluesLined = [],\n\t\t\t\tself = this;\n\n\t\t\t/* Go through */\n\t\t\tinputs.each(function () {\n\n\t\t\t\t/* Get value */\n\t\t\t\tlet input = $(this),\n\t\t\t\t\tvalue = self.readInputValue(input);\n\n\t\t\t\t/* If we get values */\n\t\t\t\tif (value !== false) {\n\t\t\t\t\tvaluesNamed.push({name: input.attr(\"name\"), value: value});\n\t\t\t\t\tvaluesLined.push(value);\n\t\t\t\t}\n\n\t\t\t});\n\n\t\t\t/* Single */\n\t\t\tif (valuesLined.length === 1) {\n\t\t\t\treturn valuesLined[0];\n\t\t\t}\n\n\t\t\t/* Return */\n\t\t\treturn valuesLined.length ? valuesLined : false;\n\n\t\t},\n\n\t\t/**\n\t\t * Write single input value\n\t\t * @param value\n\t\t * @param input\n\t\t * @returns {*}\n\t\t */\n\t\twriteInputValue: function (value, input) {\n\n\t\t\tif (input.is(\".selectReplaceChoose\")) {\n\n\t\t\t\t// Get inputs\n\t\t\t\tlet inputs = input.find(\"input\");\n\n\t\t\t\t// If all checked\n\t\t\t\tif (value === true)\n\t\t\t\t\tinputs.prop(\"checked\", true);\n\t\t\t\telse\n\t\t\t\t\tthis.writeInputsValue(value, inputs);\n\n\t\t\t\tif (inputs.length)\n\t\t\t\t\tinputs.first().trigger(\"change\", {notByUser: true});\n\n\t\t\t} else if (input.is(\":checkbox\") || input.is(\":radio\")) {\n\t\t\t\treturn input.prop(\"checked\", value !== false);\n\t\t\t} else\n\t\t\t\treturn input.val(value === false ? \"\" : value);\n\t\t},\n\n\t\t/**\n\t\t * Write multiple inputs value\n\t\t * @param values\n\t\t * @param inputs\n\t\t * @returns {*}\n\t\t */\n\t\twriteInputsValue: function (values, inputs) {\n\n\t\t\t/* Write single */\n\t\t\tif (inputs.length < 2)\n\t\t\t\treturn this.writeInputValue(values, inputs);\n\n\t\t\t/* Multiple */\n\t\t\tif (inputs.is(\":checkbox\") || inputs.is(\":radio\")) {\n\t\t\t\tinputs.prop(\"checked\", false);\n\t\t\t\tif (values instanceof Array) {\n\t\t\t\t\t$.each(values, function (_, val) {\n\t\t\t\t\t\tinputs.filter('[value=\"' + val + '\"]').prop(\"checked\", true);\n\t\t\t\t\t});\n\t\t\t\t\tinputs.first().trigger(\"change\", {notByUser: true});\n\t\t\t\t} else {\n\t\t\t\t\tif (values === false || values === true)\n\t\t\t\t\t\tinputs.prop(\"checked\", values).first().trigger(\"change\", {notByUser: true});\n\t\t\t\t\telse\n\t\t\t\t\t\tinputs.filter('[value=\"' + values + '\"]').prop(\"checked\", true).trigger(\"change\", {notByUser: true});\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tinputs.val(values);\n\t\t\t}\n\t\t}\n\n\t}\n\n});","sky.service(\"directives\", [\"exceptions\"], function ({exceptions}) {\n\n\tlet list = {},\n\t\tdirectives = this.service = {\n\n\t\t\t/**\n\t\t\t * Adds new directive\n\t\t\t * @param {string} name Directive name\n\t\t\t * @param {*} options Directive options\n\t\t\t * @param {function} directive How to parse directive\n\t\t\t */\n\t\t\tadd: function (name, options, directive) {\n\n\t\t\t\t/* Reset */\n\t\t\t\tif (!directive && typeof options === \"function\") {\n\t\t\t\t\tdirective = options;\n\t\t\t\t\toptions = {};\n\t\t\t\t}\n\t\t\t\toptions.directive = directive;\n\t\t\t\toptions.selector = name;\n\n\t\t\t\t/* Save */\n\t\t\t\tlist[name] = options;\n\n\t\t\t\t/* Self return*/\n\t\t\t\treturn this;\n\n\t\t\t},\n\n\t\t\t/**\n\t\t\t * Get element attributes\n\t\t\t * @param element\n\t\t\t * @returns {{}}\n\t\t\t */\n\t\t\tgetAttributes: function (element) {\n\n\t\t\t\t/* Holds attributes */\n\t\t\t\tlet attributes = {};\n\n\t\t\t\t/* Copy them to list */\n\t\t\t\tfor(let attr of element.get(0).attributes)\n\t\t\t\t\tattributes[attr.nodeName] = attr.nodeValue;\n\n\t\t\t\t/* Return */\n\t\t\t\treturn attributes;\n\n\t\t\t},\n\n\t\t\t/**\n\t\t\t * Applies directive convert to element\n\t\t\t * @param element\n\t\t\t * @param options\n\t\t\t */\n\t\t\tparseElement: function (element, options) {\n\n\t\t\t\t/* Get element */\n\t\t\t\telement = $(element);\n\n\t\t\t\t/* Get element attributes */\n\t\t\t\tlet attributes = this.getAttributes(element);\n\n\t\t\t\t/* Parse body for jason data */\n\t\t\t\tif (options[\"json\"] || options[\"jsonToData\"]) {\n\n\t\t\t\t\t/* Get child */\n\t\t\t\t\tlet jsonScript = element.children('script[type=\"application/json\"]');\n\n\t\t\t\t\t/* If we have json encoded data */\n\t\t\t\t\tif (jsonScript.length) {\n\n\t\t\t\t\t\ttry {\n\n\t\t\t\t\t\t\t/* Parse json */\n\t\t\t\t\t\t\tlet json = JSON.parse(jsonScript.text());\n\n\t\t\t\t\t\t\t/* Extend */\n\t\t\t\t\t\t\t$.extend(attributes, json);\n\n\t\t\t\t\t\t\t/* Save to data */\n\t\t\t\t\t\t\tif (options[\"jsonToData\"])\n\t\t\t\t\t\t\t\telement.data(\"json\", json);\n\n\t\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\t\tthrow new exceptions.system.Error(\"Element \" + options.selector + \" should have json stored content, but error on parse appears\");\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t/* Call parse function */\n\t\t\t\tif (typeof options.directive === \"function\")\n\t\t\t\t\toptions.directive(element, attributes);\n\t\t\t},\n\n\t\t\t/**\n\t\t\t * Searches and replaces directives in element\n\t\t\t * @param element\n\t\t\t */\n\t\t\tparse: function (element) {\n\t\t\t\t$.each(list, function (tag, options) {\n\t\t\t\t\t$(tag, element).each(function () {\n\t\t\t\t\t\tdirectives.parseElement(this, options);\n\t\t\t\t\t});\n\t\t\t\t\tif (element.is(tag))\n\t\t\t\t\t\tdirectives.parseElement(element, options);\n\t\t\t\t});\n\t\t\t}\n\n\n\t\t};\n\n\t/* Add jQuery fn */\n\tjQuery.fn.parseDirectives = function () {\n\n\t\t/* Parse */\n\t\tdirectives.parse(this);\n\n\t\t/* Return */\n\t\treturn this;\n\n\t};\n\n\t/* Parse body for directives when all ready */\n\tsky.onReady(function () {\n\t\t$(\"body\").parseDirectives();\n\t});\n\n});","sky.service(\"drag\", [\"callbacks\"], function({callbacks}) {\n\tlet self = {\n\t\tbindEvents: (event, events) => {\n\t\t\tself.bind(event)\n\t\t\t\t.on(\"start\", events.start)\n\t\t\t\t.on(\"move\", events.move)\n\t\t\t\t.on(\"stop\", events.stop)\n\t\t},\n\t\tbind: event => {\n\n\t\t\t// Get original event\n\t\t\tevent = event.originalEvent || event;\n\n\t\t\t// Init vars\n\t\t\tlet started = false,\n\t\t\t\tcallbacks = callbacks();\n\n\t\t\t// Check button\n\t\t\tif(event.button && event.button !== 1)\n\t\t\t\treturn callbacks;\n\n\t\t\t// Stop default action\n\t\t\tevent.preventDefault();\n\n\t\t\t$(document).on(\"mousemove.drag\", function(event) {\n\n\t\t\t\t// Start\n\t\t\t\tif(!started) {\n\t\t\t\t\tstarted = true;\n\t\t\t\t\tcallbacks.fire(\"start\", { event: event, x: event.pageX, y: event.pageY });\n\t\t\t\t}\n\t\t\t\t// Move\n\t\t\t\telse callbacks.fire(\"move\", { event: event, x: event.pageX, y: event.pageY });\n\n\t\t\t\t// Prevent default\n\t\t\t\tevent.preventDefault();\n\t\t\t\treturn false;\n\n\t\t\t}).on(\"mouseup.drag\", function(event) {\n\n\t\t\t\t// Off events\n\t\t\t\t$(document).off(\"mousemove.drag\").off(\"mouseup.drag\");\n\n\t\t\t\t// If not started\n\t\t\t\tif(!started)\n\t\t\t\t\treturn;\n\n\t\t\t\t// Stop default action\n\t\t\t\tevent.preventDefault();\n\n\t\t\t\t// Call stop callback\n\t\t\t\tcallbacks.fire(\"stop\", { event: event, x: event.pageX, y: event.pageY });\n\n\t\t\t});\n\n\t\t\treturn callbacks;\n\t\t}\n\t};\n\treturn self;\n});","sky.service(\"history\", [ \"callbacks\", \"supported\" ], function ({ callbacks, supported }) {\n\n\n\t/**\n\t * Get difference fields in objects\n\t * @param {object} first  Object to compare\n\t * @param {object} second Object to compare\n\t */\n    let getObjectsDifference = function (first, second) {\n\n\t\tlet difference = {},\n\t\t    localDiff = false;\n\n        /* If both arrays or objects */\n\t\tif ((first instanceof Array && second instanceof Array) || (first instanceof Object && second instanceof Object)) {\n\n            /* Find what was changed or deleted in second */\n\t\t\t$.each(first, function (key, value) {\n\n                /* If no such elements in second */\n\t\t\t\tif (typeof second[key] === \"undefined\")\n\t\t\t\t\tdifference[key] = null; // Set to null\n\n                /* Check if different */\n\t\t\t\telse if (localDiff = getObjectsDifference(value, second[key])) {\n\t\t\t\t\tdifference[key] = localDiff;\n\t\t\t\t}\n\n\t\t\t});\n\n            /* If was added */\n\t\t\t$.each(second, function (key, value) {\n\t\t\t\tif (typeof first[key] === \"undefined\")\n\t\t\t\t\tdifference[key] = value;\n\t\t\t});\n\n            /* Convert object to array */\n\t\t\tif (first instanceof Array) {\n\t\t\t\tlet returnArray = [];\n\t\t\t\t$.each(difference, function (key) {\n\t\t\t\t\treturnArray.push(difference[key]);\n\t\t\t\t});\n\t\t\t\tdifference = returnArray;\n\t\t\t}\n\n\t\t} else {\n\t\t\tif (first !== second) return second;\n\t\t\telse return false;\n\t\t}\n\n        /* No array difference */\n\t\tif (difference.length === 0) return false;\n\t\telse return difference;\n\n\t};\n\n    /**\n     * History constructor\n     * @param [options]\n     * @returns {sky.History}\n     * @constructor\n     */\n    sky.History = function (options) {\n\n\t\t/* Self creation */\n        if (!(this instanceof sky.History))\n            return new sky.History(options);\n\n\t\t/* Reset */\n        this.options = options || {};\n\n\t\t/* Set events */\n        this.events = this.options.events || new callbacks();\n        this.options.events = this.events;\n\n\t\t/* Self return */\n        return this;\n\n    };\n\n    /**\n     * Extending\n     */\n    $.extend(sky.History.prototype, {\n\n        /**\n         * Stores last saved hash\n         */\n        hashString: \"\",\n\n        /**\n         * Stores last saved search\n         */\n        searchString: \"\",\n\n        /**\n         * Stores last saved path\n         */\n        pathString: \"\",\n\n        /**\n         * Stores object with hash params key/value pairs\n         */\n        hashObject: {},\n\n        /**\n         * Stores object with page search params key/value pairs\n         */\n        searchObject: {},\n\n        /**\n         * Stores events\n         */\n        events: undefined,\n\n        /**\n         * Holds hash check function interval id\n         */\n        intervalId: 0,\n\n        /**\n         * This page base url\n         */\n        base: \"\",\n\n        /**\n         * Changes current path to specified\n         * @param {string} path PAth to navigate\n         */\n        navigate: function (path) {\n\n            // Get path\n            path = path.replace(\"~\", this.base);\n\n            // Get current\n            let current = (window.location.pathname + window.location.search).substr(this.base.length);\n\n            // If changes\n            if (current !== path) {\n\n                // Set new state\n                history.pushState({ oldPath: this.pathString, newPath: path, search: this.searchObject}, path, path);\n\n                // Get new\n                this.pathString = window.location.pathname.substr(this.base.length);\n\n                // Get search string\n                this.searchString = this.getWindowSearch();\n\n                // Fire event\n                this.events.fire(\"navigate.path, always\", {hash: this.hashObject, path: this.pathString, search: this.searchObject});\n\n            }\n        },\n\n        /**\n         * Fires on path change\n         */\n        change: function () {\n\n\t\t\t/* Hash difference holder */\n            let hashDifference = {},\n                searchDifference = {},\n                old = this.pathString,\n                hashChanged = false,\n                searchChanged = false;\n\n\t\t\t/* If api supported */\n            if (this.supported)\n                this.pathString = window.location.pathname.substr(this.base.length);\n\n\t\t\t/* Check if hash changed */\n            if (this.hashString !== this.getWindowHash()) {\n\n\t\t\t\t/* Get difference */\n                hashDifference = this.getDifference(this.getWindowHash(), this.hashObject);\n\n\t\t\t\t/* Hash change flag */\n                hashChanged = true;\n\n            }\n\n\t\t\t/* Check if params changed */\n            if (this.searchString !== this.getWindowSearch()) {\n\n\t\t\t\t/* Get difference */\n                searchDifference = this.getDifference(this.getWindowSearch(), this.searchObject);\n\n\t\t\t\t/* Hash change flag */\n                searchChanged = true;\n\n            }\n\n\t\t\t/* If nothing changed */\n            if (this.pathString === old && !hashChanged && !searchChanged)\n                return;\n\n\t\t\t/* Rebuild hash object on new hash str */\n            this.rebuild();\n\n\t\t\t/* Fire */\n            this.events.fire(\"change, always\", {\n                hash: this.hashObject,\n                hashDifference: hashDifference,\n                searchDifference: searchDifference,\n                path: this.pathString,\n                oldPath: old,\n                searchChanged: searchChanged,\n                hashChanged: hashChanged,\n                pathChanged: old !== this.pathString\n            });\n\n        },\n\n        /**\n         * Navigates to specified path\n         * @param path\n         */\n        setHash: function (path) {\n\n\t\t\t/* To not jump top */\n            if (path === \"\" && window.location.hash !== \"\")\n                path = \"none\";\n\n\t\t\t/* Save */\n            this.hashString = path;\n\n\t\t\t/* Set hash */\n            window.location.hash = encodeURI(path);//encodeURI(path);\n\n        },\n\n        /**\n         * Navigates to specified path\n         * @param path\n         */\n        setSearch: function (path) {\n\n\t\t\t/* Set path */\n            this.navigate(window.location.pathname + encodeURI(path !== \"\" ? \"?\" + path : \"\"));\n\n        },\n\n        /**\n         * Sets hash letiable\n         * @param {object}    elements Fields to be set\n         * @param {boolean}    [force]     Replace all stored fields with elements object\n         */\n        set: function (elements, force) {\n\n            let changed = false;\n\n\t\t\t/* Force rewrite */\n            if (force)\n                this.hashObject = elements;\n\n\t\t\t/* Go through elements and add or change them */\n            $.each(elements, (key, value) => {\n\n\t\t\t\t/* If we need delete */\n                if (value === null)\n                    delete this.hashObject[key];\n                else\n                    this.hashObject[key] = value;\n\n\t\t\t\t/* Set as changed */\n                changed = true;\n\n            });\n\n\t\t\t/* If any changes we rebuild hash */\n            if (changed || force)\n                this.setHash(decodeURIComponent(jQuery.param(this.hashObject).replace(/\\+/g, \" \")));\n\n\t\t\t/* Fire */\n            this.events.fire(\"set, always\", {elements: elements, hash: this.hashObject, path: this.pathString});\n\n        },\n\n\n        /**\n         * Sets hash letiable\n         * @param {object}    elements Fields to be set\n         * @param {boolean}    [force]     Replace all stored fields with elements object\n         */\n        search: function (elements, force) {\n\n            let changed = false;\n\n\t\t\t/* Force rewrite */\n            if (force)\n                this.searchObject = elements;\n\n\t\t\t/* Go through elements and add or change them */\n            $.each(elements, $.proxy(function (key, value) {\n\n\t\t\t\t/* If we need delete */\n                if (value === null)\n                    delete this.searchObject[key];\n                else\n                    this.searchObject[key] = value;\n\n\t\t\t\t/* Set as changed */\n                changed = true;\n\n            }, this));\n\n\t\t\t/* If any changes we rebuild hash */\n            if (changed || force)\n                this.setSearch(decodeURIComponent(jQuery.param(this.searchObject).replace(/\\+/g, \" \")));\n\n\t\t\t/* Fire */\n\t\t\tthis.events.fire(\"set, always\", {elements: elements, hash: this.hashObject, path: this.pathString});\n\n        },\n\n        /**\n         * Makes hash from object\n         * @param obj\n         * @returns {*|void|string|XML}\n         */\n        stringFromObject: function (obj) {\n            return jQuery.param(obj).replace(/\\+/g, \" \");\n        },\n\n        /**\n         * Get objects according to hash string\n         * @param {string} paramsString String which contains key=value pairs, would be parsed to object\n         */\n        getObjects: function (paramsString) {\n\n            let objects = {};\n\n\t\t\t/* Remove sharp */\n            if (paramsString.substr(0, 1) === '#' || paramsString.substr(0, 1) === '?')\n                paramsString = paramsString.slice(1, paramsString.length);\n\n\t\t\t/* Split parameters */\n            let subStrings = paramsString.split(\"&\");\n\n\t\t\t/* Get params */\n            $.each(subStrings, function (i, str) {\n\n                let keyAndValue = str.split(\"=\", 2);\n\n\t\t\t\t/* If no assign */\n                if (keyAndValue.length < 2)\n                    return;\n\n                let name = keyAndValue[0];\n\n\t\t\t\t/* Truncate brackets */\n                if (name.substr(-2) === \"[]\")\n                    name = name.substr(0, name.length - 2);\n\n\t\t\t\t/* Special hash for \"=\" in value  */\n                keyAndValue[1] = str.substr(keyAndValue[0].length + 1);\n\n\t\t\t\t/* If object repeats we create array */\n                if (typeof objects[name] === \"undefined\") objects[name] = keyAndValue[1];\n                else {\n                    if (!(objects[name] instanceof Array)) objects[name] = [objects[name]];\n                    objects[name].push(keyAndValue[1]);\n                }\n            });\n\n            return objects;\n\n        },\n\n        /**\n         * Finds difference between current stored hash and parameter\n         * @returns {*}\n         */\n        getDifference: function (string, stored) {\n\n\t\t\t/* Init */\n            let objects = this.getObjects(decodeURI(string));\n            return getObjectsDifference(stored, objects);\n\n        },\n\n        /**\n         * Rebuilds stored hash parameters according to current one\n         */\n        rebuild: function () {\n            this.hashString = this.getWindowHash();\n            this.hashObject = this.getObjects(this.hashString);\n            this.searchString = this.getWindowSearch();\n            this.searchObject = this.getObjects(this.searchString);\n            this.pathString = window.location.pathname;\n            return this;\n\n        },\n\n        /**\n         * Gets current window hash without \"#\"\n         * @returns {string}\n         */\n        getWindowHash: function () {\n\n\t\t\t/* Get decoded hash */\n            let hash = decodeURI(window.location.hash);\n\n\t\t\t/* Remove sharp */\n            if (hash.substr(0, 1) === '#')\n                hash = hash.slice(1);\n\n\t\t\t/* Return */\n            return hash;\n\n        },\n\n        /**\n         * Gets current window parameters without \"?\"\n         * @returns {string}\n         */\n        getWindowSearch: function () {\n\n\t\t\t/* Get decoded hash */\n            let search = decodeURI(window.location.search);\n\n\t\t\t/* Remove question */\n            if (search.substr(0, 1) === '?')\n                search = search.slice(1);\n\n\t\t\t/* Return */\n            return search;\n\n        },\n\n        /**\n         * Set interval execution\n         */\n        start: function () {\n\n            /* Set base if any */\n\t\t\tif (this.options.base)\n\t\t\t\tthis.base = this.options.base;\n\n\t\t\t/* If supported history */\n            if (window.history)\n                window.onpopstate = this.change.bind(this);\n\n            /* Timeout */\n            if (!this.intervalId)\n                this.intervalId = setInterval(this.change.bind(this), this.options.time || 500);\n\n\t\t\t/* Immediately event */\n            this.change();\n            return this;\n        }\n\n    });\n\n});","sky.service(\"localStorage\", [ \"callbacks\" ], function({ callbacks }) {\n\n\t//noinspection JSUnusedLocalSymbols\n\tlet LocalStorage = this.service = class {\n\t\tconstructor(options) {\n\t\t\tthis.name = options.name || \"global\";\n\t\t\tthis.events = callbacks();\n\t\t}\n\n\t\t/**\n\t\t * Loads item form database\n\t\t * @param {*} id Unique id\n\t\t */\n\t\tload(id) {\n\t\t\tlet items = this.getItems();\n\t\t\treturn items ? items[id] : undefined;\n\t\t}\n\n\t\tgetItems() {\n\t\t\ttry {\n\n\t\t\t\t/* Try to get item from storage */\n\t\t\t\tlet items = localStorage.getItem(this.name);\n\n\t\t\t\t/* Trigger error */\n\t\t\t\tif(items !== null)\n\t\t\t\t\treturn $.parseJSON(items);\n\n\t\t\t} catch(e) {\n\t\t\t\tthis.events.fire(\"error\", { storage: this });\n\t\t\t}\n\n\t\t\t/* Undefined on error */\n\t\t\treturn undefined;\n\n\t\t}\n\n\t\t/**\n\t\t * Save data to storage\n\t\t * @param id\n\t\t * @param data\n\t\t * @returns {*}\n\t\t */\n\t\tsave(id, data) {\n\n\t\t\ttry {\n\n\t\t\t\t/* Save */\n\t\t\t\tlet items = this.getItems();\n\n\t\t\t\t/* Add item */\n\t\t\t\titems[id] = data;\n\n\t\t\t\t/* Save keys */\n\t\t\t\tlocalStorage.setItem(this.name, JSON.stringify(items));\n\n\t\t\t} catch(e) {\n\t\t\t\tthis.events.fire(\"error\", { storage: this });\n\t\t\t}\n\n\t\t\t/* Self return */\n\t\t\treturn this;\n\n\t\t}\n\n\t\t/**\n\t\t * Removes from storage\n\t\t * @param id\n\t\t * @returns {*}\n\t\t */\n\t\tremove(id) {\n\t\t\ttry {\n\n\t\t\t\t/* Save */\n\t\t\t\tlet items = this.getItems();\n\n\t\t\t\t/* Add item */\n\t\t\t\tdelete items[id];\n\n\t\t\t\t/* Save keys */\n\t\t\t\tlocalStorage.setItem(this.name, JSON.stringify(items));\n\n\t\t\t} catch(e) {\n\t\t\t\tthis.events.fire(\"error\", { storage: this });\n\t\t\t}\n\n\t\t\t/* Self return */\n\t\t\treturn this;\n\n\t\t}\n\t};\n\n});","sky.service(\"model\", [ \"modelsStorage\", \"callbacks\" ], function({ modelsStorage, callbacks }) {\n\n\t/**\n\t * List of model definitions\n\t */\n\tlet modelsDefinition = {};\n\n\tclass Model {\n\t\tconstructor(type, data) {\n\n\t\t\t/* Init as base */\n\t\t\tthis.definition = BaseDefinition;\n\n\t\t\t/* Get special if defined */\n\t\t\tif(modelsDefinition[type])\n\t\t\t\tthis.definition = modelsDefinition[type];\n\n\t\t\t/* Save id */\n\t\t\tthis.id = data[this.definition.id] || null;\n\t\t\tthis.type = type;\n\t\t\tthis.data = {};\n\t\t\tthis.callbacks = callbacks();\n\t\t\tthis.definition.creation.bind(this)($.extend({}, data, true));\n\n\t\t}\n\t\textend(data) {\n\t\t\tthis.definition.extension.bind(this)($.extend({}, data, true));\n\t\t\treturn this.changed();\n\t\t}\n\t\tchanged() {\n\t\t\tthis.callbacks.fire(\"change\", {model: this});\n\t\t\treturn this;\n\t\t}\n\t\tremoveFromStorage() {\n\t\t\tmodelsStorage.remove(this);\n\t\t}\n\t\taddListener(func) {\n\t\t\tthis.callbacks.on(\"change\", func);\n\t\t}\n\t\tremoveListener(func) {\n\t\t\tthis.callbacks.off(\"change\", func);\n\t\t}\n\t}\n\n\t/**\n\t * Base model definition witch would be parented\n\t */\n\tlet BaseDefinition = {\n\t\tid: \"id\",\n\t\tcreation: function(data) {\n\t\t\tthis.data = data;\n\t\t},\n\t\textension: function(data) {\n\t\t\t$.extend(true, this.data, data);\n\t\t}\n\t};\n\n\tthis.service = {\n\t\t/**\n\t\t * Adds new models definition\n\t\t * @param name\n\t\t * @param definition\n\t\t */\n\t\taddDefinition: function(name, definition) {\n\t\t\tmodelsDefinition[name] = $.extend({}, BaseDefinition, definition);\n\t\t},\n\n\t\tfromData: function(type, data) {\n\n\t\t\tlet model = new this.Model(type, data);\n\t\t\tlet cached = modelsStorage.add(model);\n\n\t\t\tif(cached)\n\t\t\t\treturn cached.extend(data);\n\n\t\t\treturn model;\n\n\t\t}\n\t};\n\n});","sky.service(\"modelsManager\", [\"callbacks\", \"model\"], function({callbacks, model}) {\n\tclass Manager {\n\t\tconstructor(type, arr) {\n\n\t\t\tthis.items = [];\n\t\t\tthis.type = type;\n\t\t\tthis.callbacks = callbacks();\n\n\t\t\t$.each(arr, (_, model) => {\n\t\t\t\tthis.items.push(model)\n\t\t\t});\n\t\t}\n\t\treloadFromArray(arr) {\n\t\t\tthis.items = [];\n\t\t\t$.each(arr, (_, data) => {\n\t\t\t\tthis.items.push(model.fromData(this.type, data))\n\t\t\t});\n\t\t}\n\t\tcount() {\n\t\t\treturn this.items.length;\n\t\t}\n\t\taddListener(func) {\n\t\t\tthis.callbacks.on(\"change\", func);\n\t\t}\n\t\tremoveListener(func) {\n\t\t\tthis.callbacks.off(\"change\", func);\n\t\t}\n\t}\n\n\tthis.service = {\n\t\tfromArray: function(type, arr) {\n\t\t\tlet items = [];\n\t\t\t$.each(arr, (_, data) => {\n\t\t\t\titems.push(sky.model.fromData(type, data));\n\t\t\t});\n\t\t\treturn new Manager(type, items);\n\t\t}\n\t};\n\n});","sky.service(\"modelsStorage\", function() {\n\n    let cache = {};\n\n    this.service = {\n\t\tadd: function(model) {\n\n\t\t\t// Search in cache\n\t\t\tlet cached = this.search(model.type, model.id);\n\n\t\t\t// If found extend\n\t\t\tif(cached)\n\t\t\t\treturn cached;\n\n            // Create type storage if none\n            if(!this.cache[model.type])\n                this.cache[model.type] = {};\n\n            // Save model\n            this.cache[model.type][model.id] = model;\n\n\t\t},\n\n\t\tsearch: function(type, id) {\n\n\t\t\t// Cache search\n\t\t\tif(cache[type] && cache[type][id])\n\t\t\t\treturn cache[type][id];\n\n\t\t\t// On miss\n\t\t\treturn false;\n\t\t},\n\n\t\tremove: function(model) {\n\t\t\tdelete cache[model.type][model.id];\n\t\t}\n\t}\n});","/**\n * For work with different type of notifications\n */\nsky.service(\"notifications\", [ \"stackList\", \"callbacks\", \"visibleCalculator\", \"templates\", \"windows\", \"tips\" ], function({ stackList, callbacks, visibleCalculator, templates, windows, tips }) {\n\n\tlet notification = function(options) {\n\t\t/* Self creation */\n\t\tif(!(this instanceof notification))\n\t\t\treturn new notification(options);\n\n\t\tthis.render = templates.render(\"forms-notification\", options);\n\t};\n\tlet message = function(options) {\n\n\t\t/* Self creation */\n\t\tif(!(this instanceof message))\n\t\t\treturn new message(options);\n\n\t\tthis.render = templates.render(\"forms-message\", options);\n\t};\n\n\tmessage.prototype = {\n\t\tmodal: function() {\n\t\t\treturn windows.Modal(this.render);\n\t\t},\n\n\t\t/**\n\t\t * Append to holder of modal window\n\t\t * @param {object} modal\n\t\t */\n\t\tappendToModal: function(modal) {\n\t\t\tmodal.holder.append(this.render);\n\t\t},\n\n\t\ttip: function(object, align) {\n\t\t\ttips.Tip(object, { create: this.render, close: 5 }).show(align || \"top\",);\n\t\t}\n\t};\n\n\tlet loadings = stackList();\n\n\t/**\n\t * Loading\n\t */\n\tlet loading = function(ajax, global = true) {\n\n\t\t/* Self creation */\n        if(!(this instanceof loading))\n            return new loading(ajax, global);\n\n\t\t/* Back link */\n\t\tthis.global = global;\n\n\t\t/* Render */\n\t\tthis.render = $('<div><div></div></div>').addClass(\"ajaxLoading\");\n\n\t\t/* Global insert */\n\t\tif(this.global)\n\t\t\tthis.render.addClass(\"fixed\").appendTo(\"body\");\n\n\t\t/* If stop possible */\n\t\tif(ajax) {\n\t\t\t$(\"<span/>\").appendTo(this.render.addClass(\"cancelable\")).click(function() { ajax.stop(); });\n\t\t\tajax.on(\"always\", () => { this.hide(); });\n\t\t}\n\n\t\t/* Callbacks */\n\t\tthis.callbacks = callbacks();\n\n\t\t/* List save */\n\t\tloadings.add(this);\n\n\t};\n\n\t/**\n\t * Prototype\n\t * @type {{render: null, hide: hide}}\n\t */\n\tloading.prototype = {\n\n\t\t/**\n\t\t * Loads loading in modal window\n\t\t * @param {object} modal Window\n\t\t */\n\t\tinModalWindow: function(modal) {\n\n\t\t\t/* Hide */\n\t\t\tlet content = modal.holder.children().hide();\n\n\t\t\t/* Insert */\n\t\t\tthis.render.appendTo(modal.holder);\n\n\t\t\t/* Restore on hide */\n\t\t\tthis.callbacks.on(\"hide\", () => content.show());\n\n\t\t},\n\n\t\t/**\n\t\t *\n\t\t * @param contentHolder\n\t\t */\n\t\treloadContent: function(contentHolder) {\n\n\t\t\t/* If no holder */\n\t\t\tif(!this.holder.length)\n\t\t\t\treturn;\n\n\t\t\t/* Safe */\n\t\t\tthis.holder = contentHolder = $(contentHolder).addClass(\"withLoading\");\n\n\t\t\t/* Get children */\n\t\t\tlet content = contentHolder.children();\n\n\t\t\t/* Different content disable */\n\t\t\tif(this.global) {\n\n\t\t\t\tcontent.disable();\n\n\t\t\t\t/* Make sizes calculator */\n\t\t\t\tthis.calc = visibleCalculator(contentHolder, this.render.outerHeight(), \"body\");\n\n\t\t\t\t/* Set position func */\n\t\t\t\tthis.setPosition = function() {\n\t\t\t\t\tlet position = this.calc.calculate();\n\t\t\t\t\tthis.render.css({\n\t\t\t\t\t\tleft: position.left + (position.width) / 2,\n\t\t\t\t\t\ttop: position.top + (position.height) / 2\n\t\t\t\t\t})\n\t\t\t\t};\n\t\t\t\tthis.setPosition();\n\n\t\t\t\t/* Re enable */\n\t\t\t\tthis.callbacks.on(\"hide\", () => {\n\t\t\t\t\tcontent.enable();\n\t\t\t\t\t$(window).off(\"scroll.notification\");\n\t\t\t\t});\n\n\t\t\t\t$(window).on(\"scroll.notification\", () => { this.setPosition();\t});\n\n\t\t\t} else {\n\n\t\t\t\t/*  Hide */\n\t\t\t\tcontent.hide();\n\n\t\t\t\t/* Insert */\n\t\t\t\tthis.render.appendTo(this.holder);\n\n\t\t\t\t/* Re enable */\n\t\t\t\tthis.callbacks.on(\"hide\", function() {\n\t\t\t\t\tcontent.show();\n\t\t\t\t});\n\t\t\t}\n\n\t\t\treturn this;\n\n\t\t},\n\n\t\tsetHolder: function(holder) {\n\n\t\t\t/* Append and save */\n\t\t\tthis.holder = $(holder).addClass(\"withLoading\").append(this.render);\n\n\t\t\t/* Self return */\n\t\t\treturn this;\n\n\t\t},\n\n\t\t/**\n\t\t * Hides current loading\n\t\t */\n\t\thide: function() {\n\n\t\t\tif(this.holder)\n\t\t\t\tthis.holder.removeClass(\"withLoading\");\n\n\t\t\tthis.render.remove();\n\t\t\tthis.callbacks.fire(\"hide\");\n\n\t\t\t/* Remove from list */\n\t\t\tloadings.remove(this);\n\n\t\t}\n\t};\n\n\treturn {\n\t\tloading: loading,\n\t\tmessage: message,\n\t\treCalculate: function() {\n\t\t\tloadings.each(function(instance) {\n\t\t\t\tinstance.calc.init();\n\t\t\t\tinstance.setPosition();\n\t\t\t})\n\t\t}\n\t}\n\n});","sky.services.add(\"pagination\", [\"templates\", \"stackList\"], function({ templates, stackList }) {\n\n\tlet list = stackList();\n\n\tclass Pagination {\n\t\tconstructor({ pages, holder, current = 1, }) {\n\n\t\t\t/* Self creation */\n\t\t\tif(!(this instanceof Pagination))\n\t\t\t\treturn new Pagination({ pages, holder, current });\n\n\t\t\t/* Save */\n\t\t\tlist.add(this);\n\n\t\t\t/* Set total pages */\n\t\t\tthis.pages \t\t= pages;\n\t\t\tthis.current \t= current;\n\t\t\tthis.pageWidth\t= 50;\n\t\t\tthis.id \t\t= last;\n\n\t\t\t/* No pages needed */\n\t\t\tif(this.pages < 2)\n\t\t\t\treturn this;\n\n\t\t\t/* Counted params */\n\t\t\tthis.dimensions = {\n\t\t\t\tstartPage      : 1,\n\t\t\t\tlastStartPage  : 0,\n\t\t\t\tpagesVisible   : 0,\n\t\t\t\tpagesInvisible : 0,\n\t\t\t\tscrollAvailable: 0,\n\t\t\t\tscrollStart\t   : 0,\n\t\t\t\ttumbler\t\t   : 10\n\t\t\t};\n\n\t\t\t/* Render */\n\t\t\tthis.dom = {};\n\t\t\tthis.dom.holder  = templates.render(\"pagination\", {}).data(\"pagination\", this);\n\t\t\tthis.dom.slider  = this.dom.holder.find(\".pages\");\n\t\t\tthis.dom.pages   = this.dom.slider.children();\n\t\t\tthis.dom.back \t = this.dom.holder.children(\".left\");\n\t\t\tthis.dom.forward = this.dom.holder.children(\".right\");\n\n\t\t\t/* Insert */\n\t\t\tif(holder)\n\t\t\t\tthis.dom.holder.appendTo(holder);\n\n\t\t\t/* If bigger than 10000 */\n\t\t\tif(this.pages > 9999) {\n\t\t\t\tthis.dom.slider.addClass(\"tenthousand\");\n\t\t\t\tthis.pageWidth = 80;\n\t\t\t}\n\t\t\t/* If bigger than 1000 */\n\t\t\telse if(this.pages > 999) {\n\t\t\t\tthis.dom.slider.addClass(\"thousand\");\n\t\t\t\tthis.pageWidth = 70;\n\t\t\t}\n\t\t\t/* If bigger 100 */\n\t\t\telse if(this.pages > 99 ) {\n\t\t\t\tthis.dom.slider.addClass(\"hundred\");\n\t\t\t\tthis.pageWidth = 60;\n\t\t\t}\n\n\t\t\t/* Make all */\n\t\t\tthis.redraw();\n\n\t\t\t/* Mark page */\n\t\t\tthis.goToPage(this.current);\n\n\t\t\t/* Self return */\n\t\t\treturn this;\n\n\t\t}\n\n\t\t/** */\n\t\tonPageChange(newPage) {}\n\n\t\t/** Removes navigator */\n\t\tremove() {\n\t\t\tthis.dom.holder.remove();\n\t\t\tlist.remove(this);\n\t\t}\n\n\t\t/**\n\t\t * Redraws pagination\n\t\t */\n\t\tredraw() {\n\n            /* No action on invisible */\n            if(!this.dom.holder.is(\":visible\"))\n                return;\n\n\t\t\t/* Reset width */\n\t\t\tthis.dom.slider.css(\"width\", \"auto\");\n\n\t\t\t/* Count visible sizes */\n\t\t\tthis.dimensions.pagesVisible = Math.floor((this.dom.holder.innerWidth() - 100) / this.pageWidth);\n\n\t\t\t/* Count invisible */\n\t\t\tthis.dimensions.pagesInvisible = (this.pages - this.dimensions.pagesVisible) > 0 ? this.pages - this.dimensions.pagesVisible : 0;\n\n\t\t\t/* Count last start */\n\t\t\tthis.dimensions.lastStartPage = this.dimensions.pagesInvisible + 1;\n\n\t\t\t/* Get max pages */\n\t\t\tlet toShow = this.dimensions.pagesVisible > this.pages ? this.pages : this.dimensions.pagesVisible;\n\n\t\t\t/* Crop */\n\t\t\tthis.dom.slider.css(\"width\", toShow * this.pageWidth);\n\n\t\t\t/* Redraw pages */\n\t\t\tthis.drawPages(this.dimensions.startPage);\n\n\t\t\t/* Try to create scroll */\n\t\t\tthis.createScroll();\n\n\t\t\t/* Set scroll position */\n\t\t\tif(this.dom.scrollLine)\n\t\t\t\tthis.dom.runner.css(\"left\", this.calculate().scroll);\n\n\t\t}\n\n\t\t/**\n\t\t * Create scroll line if needed\n\t\t */\n\t\tcreateScroll() {\n\n\t\t\t/* If no scroll needed */\n\t\t\tif(this.pages <= this.dimensions.pagesVisible) {\n\t\t\t\tif(this.dom.scrollLine) {\n\t\t\t\t\tthis.dom.scrollLine.remove();\n\t\t\t\t\tthis.dom.scrollLine = false;\n\t\t\t\t}\n\t\t\t\treturn;\n\t\t\t} else if(!this.dom.scrollLine) {\n\n\t\t\t\t/* Create scroll */\n\t\t\t\tthis.dom.scrollLine = templates.render(\"pagination-scroll\", {}).appendTo(this.dom.slider);\n\t\t\t\tthis.dom.runner = this.dom.scrollLine.children();\n\t\t\t}\n\n\t\t\t/* Count left */\n\t\t\tthis.dimensions.scrollStart = this.dom.scrollLine.position().left + 2;\n\n\t\t\t/* Count scroll line width */\n\t\t\tthis.dimensions.scrollAvailable = this.dom.scrollLine.outerWidth() - this.dom.scrollLine.children().outerWidth() - 4;\n\t\t\n\t\t}\n\n\t\t/**\n\t\t * Calculates related coordinates between scroll and move part\n\t\t */\n\t\tcalculate(position) {\n\n\t\t\t/* Get position */\n\t\t\tif(position === undefined)\n\t\t\t\tposition = this.dom.runner.offset().left  - this.dimensions.scrollStart;\n\n\t\t\t/* Remove start */\n\t\t\tposition = position - this.dimensions.scrollStart;\n\n\t\t\t/* Correct */\n\t\t\tposition = position > 0 ? position : 0;\n\n\t\t\t/* Count pages */\n\t\t\treturn {\n\t\t\t\tpages : Math.floor(this.dimensions.pagesInvisible * (position / this.dimensions.scrollAvailable)) + 1,\n\t\t\t\tscroll: Math.floor(this.dimensions.scrollAvailable * (this.dimensions.startPage - 1)/ this.dimensions.pagesInvisible + this.dimensions.scrollStart)\n\t\t\t}\n\n\t\t}\n\n\t\t/**\n\t\t * Draws pages according to start\n\t\t * @param {int} start Page to start from\n\t\t */\n\t\tdrawPages(start) {\n\n\t\t\t/* Remove old pages */\n\t\t\tthis.dom.pages.html(\"\");\n\n\t\t\t/* Correct */\n\t\t\tif(start > this.dimensions.pagesInvisible)\n\t\t\t\tstart = this.dimensions.pagesInvisible + 1;\n\n\t\t\t/* Correct */\n\t\t\tif(start < 1)\n\t\t\t\tstart = 1;\n\n\t\t\t/* Start position */\n\t\t\tlet i = start;\n\n\t\t\t/* Draw pages */\n\t\t\twhile(i <= this.pages && i < start + this.dimensions.pagesVisible) {\n\t\t\t\ttemplates.render(\"pagination-page\", { page: i, current: this.current }).appendTo(this.dom.pages);\n\t\t\t\ti++;\n\t\t\t}\n\n\t\t\t/* Reset start page */\n\t\t\tthis.dimensions.startPage = start;\n\n\n\t\t}\n\n\t\t/**\n\t\t * Sets page as active\n\t\t * @param {int} page Page number\n\t\t * @returns {Pagination}\n\t\t */\n\t\tgoToPage(page) {\n\n\t\t\t/* If no pages */\n\t\t\tif(this.pages < 2)\n\t\t\t\treturn this;\n\n\t\t\t/* Parse */\n\t\t\tpage = parseInt(page);\n\n\t\t\t/* Correct */\n\t\t\tif(page < 1)\n\t\t\t\tpage = 1;\n\t\t\telse if(page > this.pages)\n\t\t\t\tpage = this.pages;\n\n\t\t\t/* Checks if page is visible */\n\t\t\tlet isVisible = this.dimensions.startPage <= page && page < this.dimensions.startPage + this.dimensions.pagesVisible;\n\n\t\t\t/* Redraws if needed */\n\t\t\tif(!isVisible) {\n\t\t\t\tthis.drawPages(page);\n\t\t\t\tif(this.dom.scrollLine)\n\t\t\t\t\tthis.dom.runner.css(\"left\", this.calculate().scroll);\n\t\t\t}\n\n\t\t\t/* Make active */\n\t\t\tthis.dom.pages.children().removeClass(\"active\").filter(\"[page=\" + page +\"]\").addClass(\"active\");\n\n\t\t\t/* Forward buttons disable */\n\t\t\tif(page > 1) this.dom.back.enable();\n\t\t\telse this.dom.back.disable();\n\n\t\t\t/* Backward button disable */\n\t\t\tif(page === this.pages) this.dom.forward.disable();\n\t\t\telse this.dom.forward.enable();\n\n\t\t\t/* Callback */\n\t\t\tif(this.current !== page)\n\t\t\t\tthis.onPageChange(page);\n\n\t\t\t/* Save page state */\n\t\t\tthis.current = page;\n\n\t\t\t/* Self return */\n\t\t\treturn this;\n\n\t\t}\n\n\t\t/** Set scroll */\n\t\tscroll(event) {\n\n\t\t\tlet pos = event.pageX - 10;\n\t\t\tif(this.dimensions.scrollStart > pos)\n\t\t\t\tpos = this.dimensions.scrollStart;\n\t\t\tif(this.dimensions.scrollStart + this.dimensions.scrollAvailable < pos)\n\t\t\t\tpos = this.dimensions.scrollStart + this.dimensions.scrollAvailable;\n\n\t\t\tthis.dom.runner.css({left: pos});\n\t\t\tthis.drawPages(this.calculate(pos).pages);\n\n\t\t}\n\n\t}\n\n\t/* Bind windows events */\n\t$(window).on(\"resize\", function() {\n\t\tlist.each(() => { this.redraw(); });\n\t});\n\n\t/* Return */\n\tthis.service = {\n\t\tadd: function(options) {\n\t\t\treturn new Pagination(options);\n\t\t}\n\t}\n\n});","sky.service(\"stackList\", function() {\n\tlet List = this.service = function() {\n\n\t\tif(!(this instanceof List))\n\t\t\treturn new List();\n\n\t\tlet elements = {};\n\t\tlet lastId = 0;\n\t\tlet total = 0;\n\n\t\tthis.last = function() {\n\n\t\t\t/* Holder */\n\t\t\tlet last;\n\n\t\t\t/* Apply for windows */\n\t\t\tfor(let element of elements) last = element;\n\n\t\t\t/* Return */\n\t\t\treturn last || false;\n\n\t\t};\n\n\t\tthis.add = function(element) {\n\t\t\tlastId++;\n\t\t\ttotal++;\n\t\t\telement[lastId] = element;\n\t\t};\n\n\t\tthis.remove = function(element) {\n\t\t\t/* Apply for windows */\n\t\t\tfor(let index in elements)\n\t\t\t\tif(elements.hasOwnProperty(index) && elements[index] === element) {\n\t\t\t\t\tdelete elements[index];\n\t\t\t\t\ttotal--;\n\t\t\t\t}\n\t\t};\n\n\t\tthis.total = function() {\n\t\t\treturn total;\n\t\t};\n\n\t\tthis.elements = function() {\n\t\t\treturn elements;\n\t\t};\n\n\t\tthis.each = function(callback) {\n\t\t\tfor(let single of elements)\n\t\t\t\tcallback.apply(single, single);\n\t\t};\n\n\t}\n});","sky.onReady(({suggester}) => {\n\t$(document).on(\"click\", function(event) {\n\n\t\t/* Get element */\n\t\tlet element = $(event.target || event.srcElement);\n\n\t\t/* If click in replace we should not hide it */\n\t\tif(element.is(\"[type=submit]\") || element.closest(\".suggester\").length || element.data(\"suggester\"))\n\t\t\treturn;\n\n\t\t/* Hide all */\n\t\tsuggester.hide();\n\n\t});\n});\n\nsky.service(\"suggester\", [\"templates\"], function({templates}) {\n\n\tlet render,\n\t\tobject,\n\t\tlastList,\n\t\tsuggester = this.service = {\n\t\t\thide: function() {\n\n\t\t\t\tif(render) {\n\t\t\t\t\trender.remove();\n\t\t\t\t\trender = false;\n\t\t\t\t}\n\t\t\t\tif(object) {\n\t\t\t\t\tobject.removeData(\"suggester\");\n\t\t\t\t\tobject = false;\n\t\t\t\t}\n\t\t\t\t$(document).off(\"keyup.suggester, keydown.suggester\");\n\t\t\t},\n\t\t\tshow: function(input, list) {\n\n\t\t\t\t/* Hide previous */\n\t\t\t\tsuggester.hide();\n\n\t\t\t\t/* Save */\n\t\t\t\tlastList = list;\n\t\t\t\trender = templates.render(\"suggester\", {items: list}).insertAfter(input.closest(\"label, .label\"));\n\t\t\t\tobject = input.data(\"suggester\", render);\n\n\t\t\t\t/* Get positions */\n\t\t\t\tlet elementPosition = input.offset(),\n\t\t\t\t\trenderPosition = render.offset();\n\n\t\t\t\t/* Show */\n\t\t\t\trender.css({\n\t\t\t\t\t\"margin-left\": elementPosition.left - renderPosition.left,\n\t\t\t\t\t\"margin-top\": elementPosition.top - renderPosition.top + input.outerHeight()\n\t\t\t\t});\n\n\t\t\t\t/* Add handlers */\n\t\t\t\tlet children = render.children().on(\"click\", function() {\n\t\t\t\t\tinput.val($(this).html());\n\t\t\t\t\tsuggester.hide();\n\t\t\t\t\tif(lastList[$(this).attr(\"data-index\")].callback)\n\t\t\t\t\t\tlastList[$(this).attr(\"data-index\")].callback();\n\t\t\t\t});\n\n\t\t\t\t$(document).on(\"keyup.suggester\", function(event) {\n\n\t\t\t\t\tif(event.keyCode === 38 || event.keyCode === 40) {\n\n\t\t\t\t\t\tlet selected = children.filter(\".selected\");\n\t\t\t\t\t\tchildren.removeClass(\"selected\");\n\n\t\t\t\t\t\t// Up\n\t\t\t\t\t\tif(event.keyCode === 38) {\n\t\t\t\t\t\t\tif(!selected.length || !selected.prev().length)\n\t\t\t\t\t\t\t\tchildren.last().addClass(\"selected\");\n\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t\tselected.prev().addClass(\"selected\");\n\t\t\t\t\t\t}\n\t\t\t\t\t\t// Down\n\t\t\t\t\t\tif(event.keyCode === 40) {\n\t\t\t\t\t\t\tchildren.removeClass(\"selected\");\n\t\t\t\t\t\t\tif(!selected.length || !selected.next().length) {\n\t\t\t\t\t\t\t\tchildren.first().addClass(\"selected\")\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tselected.next().addClass(\"selected\");\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\t// Esc\n\t\t\t\t\tif(event.keyCode === 27) suggester.hide();\n\n\n\t\t\t\t}).on(\"keydown.suggester\", function(event) {\n\n\t\t\t\t\t// Enter\n\t\t\t\t\tif(event.keyCode !== 13) return;\n\n\t\t\t\t\tlet selected = children.filter(\".selected\");\n\t\t\t\t\tif(selected.length) {\n\t\t\t\t\t\tselected.trigger(\"click\");\n\t\t\t\t\t\tevent.preventDefault();\n\t\t\t\t\t} else {\n\t\t\t\t\t\tsuggester.hide();\n\t\t\t\t\t}\n\n\t\t\t\t});\n\t\t\t}\n\t\t};\n});","/**\n * Module to work with user services\n */\nsky.service(\"supported\", function () {\n\ttry {\n\t\tthis.service.fullScreen = typeof document[\"webkitIsFullScreen\"] !== \"undefined\";\n\t\tthis.service.formData = window.FormData && true;\n\t\tthis.service.XHRIsSupported = XHRIsSupported;\n\t\tthis.service.XHRUpload = (typeof new XMLHttpRequest().upload !== \"undefined\");\n\t\tthis.service.localStorage = !!window.localStorage;\n\t} catch (e) {}\n});","sky.service(\"templates\", [\"localStorage\", \"supported\", \"directives\", \"exceptions\"], function({ localStorage, supported, directives, exceptions }) {\n\n\t\n\tlet templatesList = {},\n\t\ttemplatesCompiled = {},\n\t\tTemplates = this.service = {\n\n\t\t/** Globals list */\n\t\tglobals : {},\n\n\t\t/** Local storage support */\n\t\tstorage: supported.localStorage ? localStorage({ name: \"jsTemplates\" }) : false,\n\n\t\t/**\n\t\t * Adds new template to list\n\t\t * @param options\n\t\t */\n\t\tadd: function(options) {\n\t\t\ttemplatesList[options.name] = options.template;\n\t\t\tif(this.storage) {\n\t\t\t\tthis.storage.save(options.name, options.template);\n\t\t\t\t//$.cookie(\"storedTemplates-\" + options.name, options.date);\n\t\t\t}\n\t\t},\n\n\t\t/**\n\t\t * Renders specified template\n\t\t * @param {String} name Template name\n\t\t * @param {Object} data Inner data\n\t\t * @param {bool} [noDirectives]\n\t\t * @returns {*}\n\t\t */\n\t\trenderWithHolder: function(name, data, noDirectives) {\n\n\t\t\t/* Compile template */\n\t\t\tthis.compile(name);\n\n\t\t\t/* Add globals */\n\t\t\tdata = $.extend(true, {}, data, { globals: this.globals });\n\n\t\t\t/* Render */\n\t\t\tlet temp = $('<div/>').append(templatesCompiled[name].render(data));\n\n\t\t\t/* Parse directives */\n\t\t\tif(!noDirectives)\n\t\t\t\tdirectives.parse(temp);\n\n\t\t\t/* Return */\n\t\t\treturn temp;\n\n\t\t},\n\n\t\t/**\n\t\t * Renders specified template\n\t\t * @param {String} name Template name\n\t\t * @param {Object} data Inner data\n\t\t * @param {bool} [noDirectives]\n\t\t * @returns {*}\n\t\t */\n\t\trender: function(name, data, noDirectives) {\n\n\t\t\t/* Compile template */\n\t\t\treturn this.renderWithHolder(name, data, noDirectives).children();\n\n\t\t},\n\n\t\t/**\n\t\t * Renders specified template and returns text\n\t\t * @param {String} name Template name\n\t\t * @param {Object} data Inner data\n\t\t * @param {bool} [noDirectives]\n\t\t * @returns {*}\n\t\t */\n\t\trenderToText: function(name, data, noDirectives) {\n\n\t\t\t/* Compile template */\n\t\t\treturn this.renderWithHolder(name, data, noDirectives).html();\n\n\t\t},\n\n\t\t/**\n\t\t * Renders template by its text as parameter\n\t\t * @param {string} text Template text\n\t\t * @param {Object} data Inner data\n\t\t * @param {bool} [noDirectives]\n\t\t * @returns {XMLList|*}\n\t\t */\n\t\trenderByText: function(text, data, noDirectives) {\n\n\t\t\t/* Add globals */\n\t\t\tdata = jQuery.extend(true, data, { globals: this.globals });\n\n\t\t\t/* Render */\n\t\t\tlet temp = $('<div/>').append(twig({ data: text }).render(data));\n\n\t\t\t/* Parse directives */\n\t\t\tif(!noDirectives)\n\t\t\t\tdirectives.parse(temp);\n\n\t\t\t/* Return */\n\t\t\treturn temp.children();\n\n\t\t},\n\n\t\t/**\n\t\t * Renders template by its text as parameter\n\t\t * @param {string} text Template text\n\t\t * @param {Object} data Inner data\n\t\t * @param noDirectives\n\t\t * @returns {XMLList|*}\n\t\t */\n\t\trenderByTextToText: function(text, data, noDirectives)  {\n\t\t\treturn $('<div/>').append(this.renderByText(text, data, noDirectives)).html();\n\t\t},\n\n\t\t/**\n\t\t * Compiles specified template\n\t\t * @param {string} name Template name\n\t\t */\n\t\tcompile: function(name) {\n\n\t\t\t/* If already compiled */\n\t\t\tif(templatesCompiled[name])\n\t\t\t\treturn;\n\n\t\t\t/* Load */\n\t\t\tthis.load(name);\n\n\t\t\t/* Compile */\n\t\t\tlet compiled = twig({ id: name, data: templatesList[name] });\n\n\t\t\t/* Check */\n\t\t\tif(!compiled)\n\t\t\t\tthrow new exceptions.system.Error('Error during compiling template \"' + name + '\"');\n\n\t\t\t/* Save */\n\t\t\ttemplatesCompiled[name] = compiled;\n\n\t\t},\n\n\t\t/**\n\t\t * Loads specified template\n\t\t * @param {string} name Template name\n\t\t */\n\t\tload: function(name) {\n\n\t\t\t/* Loaded */\n\t\t\tlet fromLS;\n\n\t\t\t/* Try to load from storage */\n\t\t\tif(!templatesList[name] && this.storage && (fromLS = this.storage.load(name)))\n\t\t\t\treturn templatesList[name] = fromLS;\n\n\t\t\t/* If already compiled */\n\t\t\tif(templatesList[name])\n\t\t\t\treturn templatesList[name];\n\n\t\t\t/* Load template */\n\t\t\tif(!(templatesList[name] = $('script[type=\"text/template\"][id='+ name +']').html()))\n\t\t\t\tthrow new exceptions.system.Error(\"Can't find template – \"  + name);\n\n\t\t\t/* Save to LS */\n\t\t\tif(this.storage)\n\t\t\t\tthis.storage.save(name, { template: templatesList[name] });\n\n\t\t\t/* Return */\n\t\t\treturn templatesList[name]\n\n\t\t}\n\n\t};\n\n\t/**\n\t * Load templates on ready\n\t */\n\t$(document).on(\"ready\", sky.func(function() {\n\n\t\t/* Find templates and save them */\n\t\t$('script[type=\"text/template\"]').each(function() {\n\t\t\tlet self = $(this);\n\t\t\tTemplates.add({\n\t\t\t\tname        : self.attr('id'),\n\t\t\t\ttemplate    : self.html()\n\t\t\t\t//dependencies: self.attr('dependencies') ? self.attr('dependencies').replace(\" \", \"\").split(\",\") : false\n\t\t\t});\n\t\t});\n\n\t\t/* Save templates files data */\n\t\tif(window.page.data[\"templates\"] && Templates.storage) {\n\t\t\t$.each(window.page.data[\"templates\"], function() {\n\t\t\t\t$.cookie(\"storedTemplates-\" + this.path, this.date);\n\t\t\t});\n\t\t}\n\n\t}));\n\n});\n","sky.service(\"tips\", [\"stackList\", \"callbacks\"], function({ stackList, callbacks }) {\n\n    /** Class to work with tips */\n    let list = stackList(),\n        tips = this.service = {\n\n        /**\n         * Hides all visible tips\n         * @param withoutAutoHide\n         */\n        hideAll: function(withoutAutoHide) {\n\n            /* Hide all tips */\n            $.each(list.elements(), function(_, tip) {\n                if(withoutAutoHide || tip.autoHide)\n                    this.hide();\n            });\n\n        },\n\n        /**\n         * Returns last open window if any\n         * @returns {tips.Tip|boolean}\n         */\n        getLast: function() {\n            list.last();\n        },\n\n        /**\n         * Add show/hide functions\n         * @param {string}            selector            Object to bind tips for\n         * @param {string}            align                Align of tip\n         * @param options\n         * @see tips.tip\n         */\n        bind: function(selector, align, options) {\n\n            /* Create binds */\n            $(selector).on({\n                \"mouseenter\": function() {\n                    let tip = $(this).data(\"tip\") || tips.Tip(this, options).show(align);\n                },\n                \"mouseleave\": function() {\n                    let tip = $(this).data(\"tip\");\n                    if(tip) tip.hide(align);\n                }\n            });\n\n        },\n\n        /**\n         * Creates new tip object\n         * @param {object}            object                Object to show tip for\n         * @param autoHide\n         * @param create\n         * @param close\n         * @param ajax\n         * @param highlight\n         * @constructor\n         */\n        Tip: function(object, { autoHide = true, create = false, close = false, ajax = false, highlight = false } = {}) {\n\n            /* Auto construct */\n            if(!(this instanceof tips.Tip))\n                return new tips.Tip(object, { autoHide, create, close, ajax, highlight });\n\n            /* Manual create tip by create function */\n            if(typeof create === \"function\") {\n\n                /* Create tip */\n                this.tip = create(object);\n\n                /* If no tip */\n                if(!this.tip) return this;\n\n            }\n\n            /* Object set */\n            this.object = $(object).data(\"tip\", this);\n\n            /* Save callbacks */\n            this.callbacks = callbacks();\n\n            /* Auto hide */\n            this.autoHide = autoHide;\n\n            /* Manual create tip by create function */\n            if(typeof create !== \"function\") {\n\n                /* Create tip */\n                this.tip = $(\"<div/>\").addClass(\"tip\").append('<div class=\"tipContent\"></div>').insertBefore(object);\n\n                /* Title using */\n                if(!create && this.object.attr('title'))\n\t\t\t\t\tcreate = this.object.attr('title');\n                else if(!create)\n\t\t\t\t\tcreate = \"Пожалуйста подождите\";\n\n                this.tip.find(\".tipContent\").append(create);\n\n            }\n\n            if(highlight)\n                this.shadow = $('<div/>').css({ opacity: 0, position:\"absolute\", width: \"100%\", height: \"100%\", left:0 ,top:0, background: \"rgba(0,0,0,0.5)\" }).appendTo(\"body\");\n\n            /* If count down */\n            if(typeof close === \"number\")\n                this.closeTimeout = setTimeout(() => this.hide(), close);\n\n            /* If close button */\n            else if(close)\n                $('<div/>').addClass('close').appendTo(this.tip).on(\"click\", () => this.hide());\n\n            /* If stop possible */\n            if(ajax)  ajax.on(\"always\", () => this.hide());\n\n            /* Add to list */\n            this.tip.css(\"display\", \"none\");\n\t\t\tlist.add(this);\n            return this;\n\n        }\n\n    };\n\n    /**\n     * Extends tip\n     */\n    $.extend(tips.Tip.prototype, /** @lends tips.tip */ {\n\n        /**\n         * Shows tip according to type\n         * @param {string} [align] Way it would be shown\n         */\n        show: function(align) {\n\n            /* Back link */\n            let self   = this;\n            let offset = this.tip.css({left: \"\", top: \"\", marginLeft: \"\", marginTop: \"\", display: \"\"}).offset();\n\n            /* Stop animation and shows */\n            this.tip.stop();\n\n            /* Save way to show */\n            if(align) this.align = align;\n\n            /* If shadow */\n            if(this.shadow)\n                this.shadow.stop().show().animate({opacity: 1}, 100);\n\n            /* Different actions according to tip position */\n            switch(this.align) {\n\n                /* If show righter than input */\n                case \"right\":\n                {\n                    this.tip.addClass(\"right\").css({\n                        marginLeft: this.object.offset().left + this.object.outerWidth() - offset.left,\n                        marginTop : this.object.offset().top - offset.top + parseInt((this.object.outerHeight() - this.tip.outerHeight()) / 2),\n                        opacity   : 0\n                    });\n                    this.tip.animate({opacity: 1, marginLeft: \"+=10\"}, 100);\n                    break;\n                }\n                /* If show righter than input */\n                case \"left\":\n                {\n                    this.tip.addClass(\"left\").css({\n                        marginLeft: this.object.offset().left - offset.left - this.tip.outerWidth(),\n                        marginTop : this.object.offset().top - offset.top + parseInt((this.object.outerHeight() - this.tip.outerHeight()) / 2),\n                        opacity   : 0\n                    });\n                    this.tip.animate({opacity: 1, marginLeft: \"-=10\"}, 300);\n                    break;\n                }\n                /* If show topper */\n                case \"top\":\n                {\n\n                    // Count left offset\n                    let left = this.object.offset().left - offset.left;\n\n                    /* Reposition */\n                    if(offset.left + left + this.tip.outerWidth() > $(window).outerWidth())\n                        left = left - this.tip.outerWidth() + this.object.outerWidth();\n\n                    /* Position */\n                    this.tip.addClass(\"top\").css({\n                        marginLeft: left,\n                        marginTop : this.object.offset().top - this.tip.outerHeight() - offset.top,\n                        opacity   : 0\n                    });\n\n                    this.tip.animate({opacity: 1, marginTop: \"-=10\"}, 300);\n                    break;\n                }\n                /* If show topper */\n                case \"bottom\":\n                {\n\n                    let left = this.object.offset().left - offset.left;\n\n                    /* Reposition */\n                    if(offset.left + left + this.tip.outerWidth() > $(window).outerWidth())\n                        left = left - this.tip.outerWidth() + this.object.outerWidth();\n\n                    /* Position */\n                    this.tip.addClass(\"bottom\").css({\n                        marginLeft: left,\n                        marginTop : this.object.offset().top + this.object.outerHeight() - offset.top,\n                        opacity   : 0\n                    });\n\n                    this.tip.animate({opacity: 1, marginTop: \"+=10\"}, 300);\n                    break;\n                }\n                /* If we replace input with tip */\n                case \"instead\":\n                {\n                    this.tip.css({\n                        width  : this.object.outerWidth(),\n                        height : this.object.outerHeight(),\n                        display: \"none\"\n                    });\n                    this.object.fadeOut(100, function() {\n                        self.tip.fadeIn(100);\n                    }).get(0).blur();\n                    break;\n                }\n                case \"inside\":\n                {\n                    this.tip.css({\n                        width  : this.object.outerWidth(),\n                        height : this.object.outerHeight(),\n                        display: \"none\"\n                    });\n                    this.tip.css(\"opacity\", 0).animate({opacity: 1}, 100);\n                    break;\n                }\n                default:\n                    break;\n            }\n\n            this.tip.css({left: \"\", top: \"\"});\n\n            /* Self return */\n            return this;\n\n        },\n\n        /**\n         * Hides current tip\n         */\n        hide: function() {\n\n            /* Remove count down if needed */\n            if(this.closeTimeout)\n                clearTimeout(this.closeTimeout);\n\n            /* Stop animation */\n            this.tip.stop();\n\n            /* Get know how tip was shown */\n            let align = this.align;\n\n            /* Create end animation callback */\n            let callback = () => {\n\n                /* Delete record from global list */\n                list.remove(this);\n\n                /* Remove data */\n                this.object.removeData(\"tip\");\n\n                /* Remove tip */\n                this.tip.remove();\n\n                /* Callback */\n                this.callbacks.fire(\"hide\", this);\n\n            };\n\n            /* If just shown */\n            if(!align)\n                callback();\n\n            /* If shadow */\n            if(this.shadow)\n                this.shadow.animate({opacity: 0}, 100, () => { this.shadow.remove() });\n\n            /* Right way hide */\n            if(align === \"right\")\n                this.tip.animate({opacity: 0, marginLeft: \"+=10\"}, 100, callback);\n\n            /* Left way hide */\n            if(align === \"left\")\n                this.tip.animate({opacity: 0, marginLeft: \"-=10\"}, 100, callback);\n\n            /* Instead way hide */\n            if(align === \"instead\")\n                this.tip.fadeOut({opacity: 0}, 200, callback);\n\n            /* Top way hide */\n            if(align === \"top\")\n                this.tip.animate({opacity: 0, marginTop: \"-=5\"}, 200, callback);\n\n            /* Bottom way hide */\n            if(align === \"bottom\")\n                this.tip.animate({opacity: 0, marginTop: \"+=5\"}, 200, callback);\n\n            /* Inside way hide */\n            if(align === \"inside\")\n                this.tip.animate({opacity: 0}, 200, callback);\n\n            /* Self return */\n            return this;\n\n        },\n\n        /**\n         * Gets tips dom\n         * @returns {*}\n         */\n        get: function() {\n            return this.tip;\n        },\n\n        /**\n         * Sets tip text\n         * @param {string|jQuery} text What to insert to tip body\n         */\n        set: function(text) {\n            this.tip.children(\".tipContent\").html(text);\n            return this;\n        },\n\n        /**\n         * Adds something to tip\n         * @param {string|jQuery} what What to append to tip body\n         */\n        add: function(what) {\n            this.tip.children(\".tipContent\").append(what);\n            return this;\n        }\n\n    });\n\n});","sky.service(\"utils\", function() {\n\tthis.service = {\n\n\t\t/**\n\t\t * Checks if object has same data\n\t\t * @param first\n\t\t * @param second\n\t\t */\n\t\tisObjectsEqual: function(first, second) {\n\n\t\t\t/* Different types */\n\t\t\tif(typeof first !== typeof second)\n\t\t\t\treturn false;\n\n\t\t\t/* If object or array we will compare each element */\n\t\t\tif(first instanceof Array || first instanceof Object) {\n\t\t\t\tlet key;\n\t\t\t\t/* Check first */\n\t\t\t\tfor(key in first) {\n\t\t\t\t\tif(!first.hasOwnProperty(key)) continue;\n\t\t\t\t\tif(typeof second[key] === \"undefined\") return false;\n\t\t\t\t\telse if(!this.isObjectsEqual(first[key], second[key])) return false;\n\t\t\t\t}\n\n\t\t\t\t/* Check second */\n\t\t\t\tfor(key in second) {\n\t\t\t\t\tif(!second.hasOwnProperty(key)) continue;\n\t\t\t\t\tif(typeof first[key] === \"undefined\") return false;\n\t\t\t\t}\n\n\t\t\t} else if(first !== second) return false;    // For simple types\n\n\t\t\t/* All tests success */\n\t\t\treturn true;\n\n\t\t},\n\n\t\t/**\n\t\t * Adds zero\n\t\t * @param value\n\t\t * @returns {Number}\n\t\t */\n\t\taddLeadingZero: function(value) {\n\n\t\t\t/* Parse */\n\t\t\tvalue = parseInt(value);\n\n\t\t\t/* Ad zero */\n\t\t\tif(value < 10)\n\t\t\t\tvalue = \"0\" + value;\n\n\t\t\t/* Val */\n\t\t\treturn value;\n\n\t\t},\n\n\t\tencode: function(rawStr) {\n\t\t\treturn rawStr.replace(/[\\u00A0-\\u9999<>&]/gim, function(i) {\n\t\t\t\treturn '&#' + i.charCodeAt(0) + ';';\n\t\t\t});\n\t\t},\n\n\t\t/**\n\t\t * Makes data to JSON past\n\t\t * @param data\n\t\t * @param [inputName]\n\t\t * @returns {string}\n\t\t */\n\t\tjsonData: function(data, inputName) {\n\t\t\treturn '<script type=\"application/json\"' + (inputName ? (' input-name=\"' + inputName + '\"') : \"\") + '>' + sky.encode(JSON.stringify(data)) + '</script>';\n\t\t},\n\n\t\tprepareSelectData: function(items, func, {columnSplitOn = 6, maxColumns = 4}) {\n\n\t\t\tlet index        = 0,\n\t\t\t\tcolumns      = [],\n\t\t\t\tcolumnsCount = items.length / columnSplitOn,\n\t\t\t\tgroupHolder,\n\t\t\t\tcompiled;\n\n\t\t\tif(columnsCount < 1)\n\t\t\t\tcolumnsCount = 1;\n\t\t\tif(columnsCount > maxColumns)\n\t\t\t\tcolumnsCount = maxColumns;\n\n\t\t\tlet perColumn = Math.ceil(items.length / columnsCount);\n\n\t\t\tfor(let item of items) {\n\t\t\t\tif(compiled = func({item, index, column: columns.length})) {\n\n\t\t\t\t\tif(index % perColumn === 0) {\n\t\t\t\t\t\tgroupHolder = [];\n\t\t\t\t\t\tcolumns.push(groupHolder);\n\t\t\t\t\t}\n\n\t\t\t\t\tgroupHolder.push(compiled);\n\t\t\t\t\tindex++;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn index === 0 ? [] : {groups: columns}\n\n\t\t}\n\t}\n});","sky.onReady(function({ validator }) {\n\tjQuery.fn.validForm = function() {\n\t\treturn validator.validateForm(this);\n\t}.safe();\n\tjQuery.fn.validationRule = function(name, options) {\n\t\treturn validator.addRule(this, name, options);\n\t}.safe();\n\t$(document).on(\"change keyup\", \"[data-validate]\", function() {\n\t\tvalidator.validateElement($(this));\n\t});\n});\n\nsky.service(\"validator\", function() {\n\n\t/**\n\t * Main validation object\n\t */\n\tlet validator = this.service = {\n\n\t\t/**\n\t\t * Validates specified form, or dom element\n\t\t * @param form\n\t\t */\n\t\tvalidateForm: function(form) {\n\n\t\t\tlet pass = true,\n\t\t\t\tself = this;\n\n\t\t\t/* Go through all elements that need to be validate */\n\t\t\tform.find(\"input, select, textarea, .selectReplace, [data-validate]\").filter(\":visible\").each(function() {\n\n\t\t\t\t/* Get element */\n\t\t\t\tlet element = $(this);\n\n\t\t\t\t/* validate if needed to */\n\t\t\t\tif(self.shouldBeValidated(element) && !self.validateElement(element, form))\n\t\t\t\t\tpass = false;\n\n\t\t\t});\n\n\t\t\t/* Return result */\n\t\t\treturn pass;\n\n\t\t},\n\n\t\t/**\n\t\t * Add rule to specified element\n\t\t * @param element\n\t\t * @param name\n\t\t * @param [options]\n\t\t */\n\t\taddRule: function(element, name, options) {\n\n\t\t\t/* Get or make options and add rule */\n\t\t\tthis.Options(element).addRule(name, options || {});\n\n\t\t\t/* Self return */\n\t\t\treturn this;\n\n\t\t},\n\n\t\t/**\n\t\t *\n\t\t * Validates specified element\n\t\t * @param {*} element Element to validate\n\t\t * @param {*} [form] Form to validate\n\t\t * @returns {boolean}\n\t\t */\n\t\tvalidateElement: function(element, form) {\n\n\t\t\tlet self = this,\n\t\t\t\toptions = this.Options(element),\n\t\t\t\ttotalPass = true,\n\t\t\t\tvalue = element.val(),\n\t\t\t\tlastError = false,\n\t\t\t\tfirstError = false,\n\t\t\t\tlastSuccess = false,\n\t\t\t\tfirstSuccess = false;\n\n\t\t\t/* Select replace */\n\t\t\tif(element.is(\".selectReplace\")) {\n\t\t\t\tlet inputs = element.next().find(\"input:checked\");\n\t\t\t\tif(!inputs.length)\n\t\t\t\t\tvalue = \"\";\n\t\t\t\telse if(element.is(\".single\"))\n\t\t\t\t\tvalue = element.next().find(\"input:checked\").val();\n\t\t\t\telse\n\t\t\t\t\tvalue = element.next().find(\"input:checked\").length ? \"true\" : \"\";\n\t\t\t}\n\n\t\t\t/* Go through rules */\n\t\t\t$.each(options.rules, function(name, ruleOverload) {\n\n\t\t\t\t/* Make compiled rule */\n\t\t\t\tlet compiledRule = jQuery.extend(true, {}, self.rules[name] || self.Rule({}), ruleOverload || {});\n\n\t\t\t\t/* Execute message is needed */\n\t\t\t\tif(typeof compiledRule.message === \"function\")\n\t\t\t\t\tcompiledRule.message = compiledRule.message.call(this);\n\n\t\t\t\t/* Check if element pass validation */\n\t\t\t\tlet pass = self.validate(value, compiledRule, element, form);\n\n\t\t\t\t/* Perform action according to result */\n\t\t\t\tif(pass) {\n\t\t\t\t\tcompiledRule.onSuccess(element, compiledRule);\n\t\t\t\t\tlastSuccess = compiledRule;\n\t\t\t\t\tif(!firstSuccess)\n\t\t\t\t\t\tfirstSuccess = compiledRule;\n\t\t\t\t} else {\n\t\t\t\t\tcompiledRule.onError(element, compiledRule);\n\t\t\t\t\tlastError = compiledRule;\n\t\t\t\t\tif(!firstError)\n\t\t\t\t\t\tfirstError = compiledRule;\n\t\t\t\t\ttotalPass = false;\n\t\t\t\t}\n\n\t\t\t});\n\n\t\t\t/* Total callbacks */\n\t\t\tif(totalPass)\n\t\t\t\toptions.onSuccess(element, lastSuccess);\n\t\t\telse\n\t\t\t\toptions.onError(element, firstError);\n\n\t\t\t/* Return true of element passed all validations */\n\t\t\treturn totalPass;\n\n\t\t},\n\n\t\t/**\n\t\t * Return true if element should be validated\n\t\t * @param {*} element Element to validate\n\t\t * @returns {boolean}\n\t\t */\n\t\tshouldBeValidated: function(element) {\n\t\t\treturn element.attr(\"data-validate\") || element.data(\"validationOptions\");\n\t\t},\n\n\t\t/**\n\t\t * Return true if element passed validation\n\t\t * @param element\n\t\t * @param compiledRule\n\t\t * @param form\n\t\t * @returns {*}\n\t\t * @param value\n\t\t */\n\t\tvalidate: function(value, compiledRule, element, form) {\n\t\t\treturn compiledRule.rule.call(compiledRule, value, element, form);\n\t\t}\n\n\t};\n\n\t/**\n\t * Defaults\n\t */\n\tvalidator.ruleDefaults = {\n\n\t};\n\n\t/**\n\t * Defaults\n\t * @type {{onSuccess: onSuccess, onError: onError}}\n\t */\n\tvalidator.optionsDefaults = {\n\n\t\t/* Fires on success */\n\t\tonSuccess: function(element) {\n\n\t\t\t/* Remove error */\n\t\t\telement.removeClass(this.errorClass);\n\n\t\t\t/* Add success */\n\t\t\tif(this.successClass)\n\t\t\t\telement.addClass(this.successClass);\n\n\t\t},\n\n\t\t/* Fires on error */\n\t\tonError: function(element) {\n\n\t\t\t/* Add error */\n\t\t\telement.addClass(this.errorClass);\n\n\t\t\t/* Remove success */\n\t\t\tif(this.successClass)\n\t\t\t\telement.removeClass(this.successClass);\n\n\t\t}\n\t};\n\n\t/**\n\t * Base rule object\n\t * @param overload\n\t * @returns {validator.Rule}\n\t * @constructor\n\t */\n\tvalidator.Rule = function(overload) {\n\n\t\t/* Self creation if needed */\n\t\tif(!(this instanceof validator.Rule))\n\t\t\treturn new validator.Rule(overload);\n\n\t\t/* Dump rule to check validation */\n\t\tthis.rule = function() { return true; };\n\n\t\t/* Dump message */\n\t\tthis.message = \"Это поле заполнено не верно\";\n\n\t\t/* List of options to make validation according to */\n\t\tthis.options = [];\n\n\t\t/* Fires on success */\n\t\tthis.onSuccess = function(element) {};\n\n\t\t/* Fires on error */\n\t\tthis.onError = function(element) {};\n\n\t\t/* Self extend with overload */\n\t\tjQuery.extend(this, overload);\n\n\t\t/* Return */\n\t\treturn this;\n\n\t};\n\n\t/**\n\t * List of default rules\n\t * @type {{required: validator.Rule}}\n\t */\n\tvalidator.rules = {\n\t\trequired: validator.Rule({\n\t\t\trule: function(value) {\n\t\t\t\treturn !!value.length;\n\t\t\t},\n\t\t\tmessage: \"Это поле необходимо заполнить\"\n\t\t}),\n\t\trequiredIfFilled: validator.Rule({\n\t\t\trule: function(value) {\n\t\t\t\tlet item = $(this.options[0]);\n\t\t\t\treturn item.is(\":radio, :checkbox\") ? !item.is(\":checked\") || value : item.val() === \"\" || value;\n\t\t\t},\n\t\t\tmessage: \"Это поле необходимо заполнить\"\n\t\t}),\n\t\tdate: validator.Rule({\n\t\t\trule: function(value) {\n\t\t\t\treturn !value || (\n\t\t\t\t\tvalue.match(/^\\d{4}-\\d{2}-\\d{2}( \\d{2}:\\d{2}(:\\d{2})?)?$/) ||\n\t\t\t\t\tvalue.match(/^\\d{2}.\\d{2}.\\d{4}( \\d{2}:\\d{2}(:\\d{2})?)?$/)\n\t\t\t\t\t);\n\t\t\t},\n\t\t\tmessage: \"Дата указана неверно\"\n\t\t}),\n\t\tperiod: validator.Rule({\n\t\t\trule: function(value) {\n\t\t\t\treturn !value || (\n\t\t\t\t\tvalue.match(/^\\d{4}-\\d{2}-\\d{2}$/) ||\n\t\t\t\t\tvalue.match(/^\\d{2}.\\d{2}.\\d{4}$/) ||\n\t\t\t\t\tvalue.match(/^\\d{2}.\\d{2}.\\d{4}\\s*-\\s*\\d{2}.\\d{2}.\\d{4}$/) ||\n\t\t\t\t\tvalue.match(/^\\d{4}-\\d{2}-\\d{2}\\s*-\\s*\\d{4}-\\d{2}-\\d{2}$/)\n\t\t\t\t\t);\n\t\t\t},\n\t\t\tmessage: \"Период указан неверно\"\n\t\t}),\n\t\temail: validator.Rule({\n\t\t\trule: function(value) {\n\t\t\t\treturn value && value.match(/[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*@(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?/);\n\t\t\t},\n\t\t\tmessage: \"Почтовый адрес указан неверно\"\n\t\t}),\n\t\tsame: validator.Rule({\n\t\t\trule: function(value) {\n\t\t\t\treturn value === $('[name=\"' + this.options[0] + '\"]').val();\n\t\t\t},\n\t\t\tmessage: \"Поля не совпадают\"\n\t\t}),\n\t\turl: validator.Rule({\n\t\t\trule: function(value) {\n\t\t\t\treturn value === \"\" || value.match(/^(https?:\\/\\/.+)$/);\n\t\t\t},\n\t\t\tmessage: \"Не корректный адрес URI\"\n\t\t}),\n\t\tregexp: validator.Rule({\n\t\t\trule: function(value) {\n\t\t\t\treturn value === \"\" || value.match(new RegExp(this.options[0]));\n\t\t\t},\n\t\t\tmessage: \"Введите корректное значение\"\n\t\t}),\n\t\tnumeric: validator.Rule({\n\t\t\trule: function(value) {\n\t\t\t\treturn value === \"\" || value.match(/^-?[0-9]+(\\.[0-9]+)?$/);\n\t\t\t},\n\t\t\tmessage: \"Введите число\"\n\t\t}),\n\t\tpositive: validator.Rule({\n\t\t\trule: function(value) {\n\t\t\t\treturn value === \"\" || value.match(/^[0-9]+(\\.[0-9]+)?$/) && parseFloat(value) > 0;\n\t\t\t},\n\t\t\tmessage: \"Введите положительное число\"\n\t\t}),\n\t\tmax: validator.Rule({\n\t\t\trule: function(value) {\n\t\t\t\treturn value === \"\" || value.match(/^[0-9]+(\\.[0-9]+)?$/) && parseFloat(value) <= parseFloat(this.options[0] || 0);\n\t\t\t},\n\t\t\tmessage: function() {\n\t\t\t\treturn \"Введите число, не обльше чем \" + (this.options[0] || 0)\n\t\t\t}\n\t\t}),\n\t\tmin: validator.Rule({\n\t\t\trule: function(value) {\n\t\t\t\treturn value === \"\" || value.match(/^[0-9]+(\\.[0-9]+)?$/) && parseFloat(value) >= parseFloat(this.options[0] || 0);\n\t\t\t},\n\t\t\tmessage: function() {\n\t\t\t\treturn \"Введите число, не меньше чем \" + (this.options[0] || 0);\n\t\t\t}\n\t\t}),\n\t\tminLength: validator.Rule({\n\t\t\trule: function(value) {\n\t\t\t\treturn value === \"\" || value.length >= (this.options[0] || 0)\n\t\t\t},\n\t\t\tmessage: \"В этом поле нехватает символов\"\n\t\t}),\n\t\tmaxLength: validator.Rule({\n\t\t\trule: function(value) {\n\t\t\t\treturn value === \"\" || value.length <= (this.options[0] || 0)\n\t\t\t},\n\t\t\tmessage: \"В этом поле слишком много символов\"\n\t\t})\n\t};\n\n\t/**\n\t * Holds element validation options\n\t * @param element\n\t * @constructor\n\t */\n\tvalidator.Options = function(element) {\n\n\t\t/* Create or return */\n\t\tif(!(this instanceof validator.Options))\n\t\t\treturn element.data(\"validationOptions\") || new validator.Options(element);\n\n\t\t/* Callbacks after all checks */\n\t\tthis.onSuccess = function() {};\n\t\tthis.onError = function() {};\n\n\t\t/* Adds to element on success */\n\t\tthis.successClass = false;\n\n\t\t/* Adds to element on error */\n\t\tthis.errorClass   = \"error\";\n\n\t\t/* Overlay defaults */\n\t\tjQuery.extend(true, this, validator.optionsDefaults);\n\n\t\t/* Holds list of validating rules */\n\t\tthis.rules = {};\n\n\t\t/* Save element */\n\t\tthis.element = element;\n\n\t\t/* Get rules that declared in element definition */\n\t\tthis.getDeclaredRules();\n\n\t\t/* Save option */\n\t\tthis.element.data(\"validationOptions\", this);\n\n\t\t/* Self return */\n\t\treturn this;\n\n\t};\n\n\tvalidator.Options.prototype = {\n\n\t\t/**\n\t\t * Gets list of rules that are set in declared way\n\t\t */\n\t\tgetDeclaredRules: function() {\n\n\t\t\t/* Get attribute value */\n\t\t\tlet attr = this.element.attr(\"data-validate\"),\n\t\t\t\tself = this;\n\n\t\t\t/* If none */\n\t\t\tif(!attr)\n\t\t\t\treturn;\n\n\t\t\t/* Get list */\n\t\t\t$.each(attr.split(\";\"), function(_, name) {\n\n\t\t\t\t/* Get parameters */\n\t\t\t\tlet params = name.match(/(\\w+)\\((.*)\\)/);\n\n\t\t\t\t/* Parse */\n\t\t\t\tif(params) {\n\n\t\t\t\t\t/* Get function */\n\t\t\t\t\tname = params[1];\n\n\t\t\t\t\t/* Parse params */\n\t\t\t\t\tparams = params[2].match(/(('[^']+')|([\\d\\w]+))/g);\n\t\t\t\t\t$.each(params, function(i, val) {\n\t\t\t\t\t\tparams[i] = eval(val.trim());\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\t/* Add rule to options */\n\t\t\t\tself.addRule(name.trim(), { options: params || [] });\n\n\t\t\t});\n\n\n\t\t},\n\n\t\t/**\n\t\t * Adds new rule for element\n\t\t * @param {string} name Rule name\n\t\t * @param {object} options Rule options\n\t\t * @returns {validator.Options}\n\t\t */\n\t\taddRule: function(name, options) {\n\n\t\t\t/* Create and save new rule */\n\t\t\tthis.rules[name] = jQuery.extend({}, validator.ruleDefaults, options);\n\n\t\t\t/* Mark for auto validation */\n\t\t\tif(!this.element.attr(\"data-validate\"))\n\t\t\t\tthis.element.attr(\"data-validate\", \"true\");\n\n\t\t\t/* Self returning */\n\t\t\treturn this;\n\t\t}\n\n\t}\n\n});","sky.service(\"visibleCalculator\", function() {\n\n\tlet Calculator = this.service = class {\n\n\t\tconstructor(holder, minHeight, scrollable) {\n\n\t\t\t/* Check if class */\n\t\t\tif(!(this instanceof Calculator))\n\t\t\t\treturn new Calculator(holder, minHeight, scrollable);\n\n\t\t\t/* Re get holder */\n\t\t\tthis.holder = $(holder);\n\t\t\tthis.scrollable = scrollable;\n\t\t\tthis.minHeight = minHeight;\n\n\t\t\t/* Init */\n\t\t\tthis.init();\n\n\t\t}\n\n\t\t/* Init func */\n\t\tinit() {\n\n\t\t\t/* Count offset */\n\t\t\tlet offset = this.holder.offset();\n\n\t\t\t/* Get holder rect */\n\t\t\tthis.holderRect = {\n\t\t\t\tleft  : offset.left,\n\t\t\t\ttop   : offset.top,\n\t\t\t\twidth : this.holder.outerWidth(),\n\t\t\t\theight: this.holder.outerHeight()\n\t\t\t};\n\n\t\t}\n\n\t\t/* Calculating function */\n\t\tcalculate() {\n\n\t\t\t/* How much is scrolled */\n\t\t\tlet scrollTop    = $(this.scrollable).scrollTop(),\n\t\t\t\twindowHeight = $(window).height(),\n\t\t\t\twindowWidth  = $(window).width(),\n\t\t\t\tsizes        = {\n\t\t\t\t\tleft        : this.holderRect.left,\n\t\t\t\t\tright       : this.holderRect.left + this.holderRect.width,\n\t\t\t\t\ttop         : this.holderRect.top - scrollTop,\n\t\t\t\t\twidth       : this.holderRect.width,\n\t\t\t\t\theight      : this.holderRect.height,\n\t\t\t\t\trealHeight  : this.holderRect.height,\n\t\t\t\t\tscrollTop   : scrollTop,\n\t\t\t\t\tscrollLeft  : 0,\n\t\t\t\t\twindowHeight: windowHeight,\n\t\t\t\t\twindowWidth : windowWidth,\n\t\t\t\t};\n\n\t\t\t/* Min height */\n\t\t\tif(sizes.height < this.minHeight)\n\t\t\t\tsizes.height = this.minHeight;\n\n\t\t\t/* Count bottom */\n\t\t\tsizes.bottom = sizes.top + sizes.height;\n\n\t\t\t/* If top border near than holder */\n\t\t\tif(sizes.top < 0) {\n\t\t\t\t// If visible less than min\n\t\t\t\tif(sizes.bottom < this.minHeight) {\n\t\t\t\t\tsizes.bottom = sizes.bottom < 0 ? 0 : sizes.bottom;\n\t\t\t\t\tsizes.top = sizes.bottom - this.minHeight;\n\t\t\t\t\tsizes.height = this.minHeight;\n\t\t\t\t}\n\t\t\t\t// If visible more than min\n\t\t\t\telse {\n\t\t\t\t\tsizes.height = sizes.bottom;\n\t\t\t\t\tsizes.top = 0;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t/* Get visible bottom */\n\t\t\tif(windowHeight < sizes.bottom) {\n\t\t\t\t// If visible less than min\n\t\t\t\tif(windowHeight - sizes.top < this.minHeight) {\n\t\t\t\t\tsizes.height = this.minHeight;\n\t\t\t\t\tsizes.top = windowHeight - sizes.top < 0 ? 0 : sizes.top;\n\t\t\t\t\tsizes.bottom = sizes.top + this.minHeight;\n\t\t\t\t}\n\t\t\t\t// If visible more than min\n\t\t\t\telse {\n\t\t\t\t\tsizes.height = windowHeight - sizes.top;\n\t\t\t\t\tsizes.bottom = 0;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t/* Return */\n\t\t\treturn sizes;\n\n\t\t}\n\n\t\tgetDropOffset(replace, popup) {\n\n\t\t\t/* Get drop */\n\t\t\tif(!popup.is(\":visible\")) return;\n\n\t\t\t/* Set position to zeros to get max width and height */\n\t\t\tpopup.removeClass('hidden').css({left: 0, top: 0});\n\n\t\t\t/* Init */\n\t\t\tlet popupWidth  = popup.outerWidth(),\n\t\t\t\tpopupHeight = popup.outerHeight();\n\n\t\t\t/* Reset position */\n\t\t\tpopup.css({marginLeft: \"\", marginTop: \"\", width: \"\", left: \"\", top: \"\"});\n\n\t\t\t/* Init */\n\t\t\tlet win            = $(window),\n\t\t\t\treplaceOffset  = replace.offset(),\n\t\t\t\tpopupOffset    = popup.offset(),\n\t\t\t\tleftDifference = popupOffset.left - replaceOffset.left,\n\t\t\t\ttopDifference  = popupOffset.top - replaceOffset.top,\n\t\t\t\tmiddle         = false,\n\t\t\t\tvisible        = this.calculate();\n\n\t\t\t// Drop down\n\t\t\tif(visible.bottom + popupHeight >= visible.windowHeight)\n\t\t\t\tpopup.css(\"marginTop\", topDifference + visible.realHeight + 1);\n\t\t\t// Drop up\n\t\t\telse if(visible.top > popupHeight)\n\t\t\t\tpopup.css(\"marginTop\", -topDifference - 1);\n\t\t\t// Drop left\n\t\t\telse {\n\t\t\t\tpopup.css(\"marginTop\", -topDifference - (popupHeight - visible.realHeight) / 2);\n\t\t\t\tmiddle = true;\n\t\t\t}\n\n\n\t\t\t/* Set position */\n\t\t\tif(!middle) {\n\t\t\t\tif(visible.windowWidth > visible.left + popupWidth)\n\t\t\t\t\tpopup.css(\"marginLeft\", leftDifference);\n\t\t\t\telse\n\t\t\t\t\tpopup.css(\"marginLeft\", leftDifference - popupWidth + visible.width);\n\t\t\t} else {\n\n\t\t\t\tif(win.width() > selfOffset.left + popupWidth + selfWidth)\n\t\t\t\t\tpopup.css({\n\t\t\t\t\t\tmarginLeft: selfOffset.left - popupOffset.left + selfWidth\n\t\t\t\t\t});\n\t\t\t\telse\n\t\t\t\t\tpopup.css({\n\t\t\t\t\t\tmarginLeft: selfOffset.left - popupOffset.left - popupWidth\n\t\t\t\t\t});\n\n\t\t\t}\n\n\t\t}\n\t}\n\n})\n;","/**\n * Holds classes to work with modal/new windows\n */\nsky.service('windows', [\"templates\", \"callbacks\", \"stackList\"], function ({templates, callbacks, stackList}) {\n\n\tlet tips = false,\n\t\tlist = stackList(),\n\t\twindows = this.service = {\n\n\t\t\t/**\n\t\t\t * Returns last open window if any\n\t\t\t * @returns {windows.Modal|boolean}\n\t\t\t */\n\t\t\tgetLast: function () {\n\t\t\t\treturn list.last()\n\t\t\t},\n\n\t\t\t/**\n\t\t\t * Creates new modal window\n\t\t\t * @param {*} name Window name\n\t\t\t * @param {*} [data] Data to send with request\n\t\t\t */\n\t\t\tModal: function (name, data) {\n\n\t\t\t\t/* Self construct */\n\t\t\t\tif (!(this instanceof windows.Modal))\n\t\t\t\t\treturn new windows.Modal(name, data);\n\n\t\t\t\t/* Create window */\n\t\t\t\tthis.locked \t\t= false;\n\t\t\t\tthis.background \t= templates.render(\"windows-modal\", {}).appendTo(\"#pageContentHolder\").data(\"modalWindow\", this);\n\t\t\t\tthis.dataContainer \t= this.background.children();\n\t\t\t\tthis.holder \t\t= this.dataContainer.children(\".windowData\");\n\t\t\t\tthis.closeButton \t= this.dataContainer.children(\".close\");\n\n\t\t\t\t/* Make body un scrollable */\n\t\t\t\t$(document.body).css(\"overflow\", \"hidden\");\n\n\t\t\t\t/* Callbacks */\n\t\t\t\tthis.callbacks = callbacks();\n\n\t\t\t\t/* Render content */\n\t\t\t\ttry {\n\t\t\t\t\tthis.reRender(name, data);\n\t\t\t\t} catch (e) {\n\t\t\t\t\tthis.close(false);\n\t\t\t\t\tthrow e;\n\t\t\t\t}\n\n\t\t\t\t/* Return */\n\t\t\t\treturn this;\n\n\t\t\t}\n\n\t\t};\n\n\t/**\n\t * Modal window prototype\n\t */\n\twindows.Modal.prototype = {\n\n\t\t/**\n\t\t * Renders window content\n\t\t * @param {*} name Window name\n\t\t * @param {*} [data] Data to send with request\n\t\t */\n\t\treRender: function (name, data) {\n\n\t\t\t/* Close all tips */\n\t\t\tif(tips) tips.hideAll(true);\n\n\t\t\t/* Clear */\n\t\t\tthis.holder.html('');\n\n\t\t\t/* Render content */\n\t\t\tif (name instanceof jQuery)\n\t\t\t\tthis.template = name.appendTo(this.holder);\n\t\t\telse if (typeof name === \"string\")\n\t\t\t\tthis.template = templates.render(name, data).appendTo(this.holder);\n\n\t\t\t/* Self return */\n\t\t\treturn this;\n\t\t},\n\n\t\t/**\n\t\t * Removes all except that was rendered\n\t\t */\n\t\tclearExceptTemplate: function () {\n\t\t\tthis.holder.children().detach();\n\t\t\tthis.holder.append(this.template);\n\t\t},\n\n\t\t/**\n\t\t * Removes all except that was rendered\n\t\t */\n\t\tremoveMessages: function () {\n\t\t\tthis.holder.find(\".notificationMessage\").remove();\n\t\t\treturn this;\n\t\t},\n\n\t\t/**\n\t\t * Locks window so it can't be closed\n\t\t * @returns {windows.Modal}\n\t\t */\n\t\tlock: function (ajax) {\n\t\t\tthis.locked = true;\n\t\t\tthis.closeButton.hide();\n\t\t\tif (ajax) ajax\n\t\t\t\t.on(\"preSuccess\", function () {\n\t\t\t\t\tthis.dataContainer.css(\"height\", this.dataContainer.innerHeight());\n\t\t\t\t}, this)\n\t\t\t\t.on(\"notAbort\", function () {\n\t\t\t\t\tlet self = this;\n\t\t\t\t\tthis.unlock();\n\t\t\t\t\tthis.dataContainer.css(\"height\", this.holder.outerHeight());\n\t\t\t\t\tsetTimeout(function () {\n\t\t\t\t\t\tself.dataContainer.css(\"height\", \"\");\n\t\t\t\t\t}, 500)\n\t\t\t\t}, this)\n\t\t\t\t.on(\"abort\", function () {\n\t\t\t\t\tthis.unlock().close();\n\t\t\t\t}, this);\n\t\t\treturn this;\n\t\t},\n\n\t\t/**\n\t\t * Unlocks window so it can be closed\n\t\t * @returns {windows.Modal}\n\t\t */\n\t\tunlock: function () {\n\t\t\tthis.locked = false;\n\t\t\tthis.closeButton.show();\n\t\t\treturn this;\n\t\t},\n\n\t\t/**\n\t\t * Closes current window\n\t\t * @param {boolean} [byUser] Indicates that window was closed not by user\n\t\t */\n\t\tclose: function (byUser = false) {\n\n\t\t\t/* If windows is locked */\n\t\t\tif (this.locked)\n\t\t\t\treturn;\n\n\t\t\t/* Remove elements */\n\t\t\tthis.background.fadeOut(\"fast\", function () {\n\t\t\t\t$(this).remove()\n\t\t\t});\n\n\t\t\t/* Delete from list */\n\t\t\tlist.remove(this);\n\n\t\t\t/* Call close callback */\n\t\t\tthis.callbacks.fire(\"close\", {byUser: byUser});\n\n\t\t\t/* Close all tips */\n\t\t\tif(tips) tips.hideAll(true);\n\n\t\t\t/* Make body scrollable */\n\t\t\tif (list.total() < 1)\n\t\t\t\t$(document.body).css(\"overflow\", \"\");\n\n\t\t\treturn this;\n\n\t\t}\n\n\t};\n\n\ttry {\n\t\ttips = sky.service(\"tips\");\n\t} catch (e) {}\n\n\t/* Add handler to black area click */\n\t$(document)\n\t\t.on(\"keyup\", sky.func(function (event) {\n\t\t\tlet last;\n\n\t\t\t/* If slide show was disabled */\n\t\t\tif (document[\"webkitIsFullScreen\"] || document[\"mozIsFullScreen\"] || document[\"isFullScreen\"])\n\t\t\t\treturn;\n\n\t\t\t/* Close current window */\n\t\t\tif (event.keyCode === 27 && (last = windows.getLast()))\n\t\t\t\tlast.close(true);\n\n\t\t}));\n\n});","sky.action(\"pagination\", {\n\n\tsetPage: function(button, _, page) {\n\n\t\t/* Get pagination */\n\t\tlet pagination = button.parents(\".pagination\").data(\"pagination\");\n\n\t\t/* Correct page */\n\t\tif(page === \"next\")\n\t\t\tpage = pagination.current + 1;\n\n\t\t/* Correct  */\n\t\tif(page === \"previous\")\n\t\t\tpage = pagination.current - 1;\n\n\t\t/* Go to page */\n\t\tpagination.goToPage(page);\n\n\t},\n\n\tscrollTo: function(element, event) {\n\n\t\t/* Get pagination */\n\t\tlet pagination = element.parents(\".pagination\").data(\"pagination\");\n\n\t\t/* Move */\n\t\tpagination.scroll(event);\n\n\t},\n\n\tgrab: function(runner) {\n\n\t\t/* Get pagination */\n\t\tlet pagination = runner.parents(\".pagination\").data(\"pagination\");\n\n\t\t/* Binds */\n\t\t$(window)\n\t\t\t.on(\"mouseup.pagination\", function() {\n\t\t\t\t$(window).off(\"mouseup.pagination mousemove.pagination\");\n\t\t\t}).on(\"mousemove.pagination\", function(event) {\n\t\t\t\tpagination.scroll(event);\n\t\t\t});\n\n\t},\n\n\tnext: function(button, _) {\n\t\tthis.setPage(button, _, \"next\")\n\t},\n\n\tprevious: function(button, _) {\n\t\tthis.setPage(button, _, \"previous\")\n\t}\n\n});","sky.action(\"selectReplace\", function({ visibleCalculator }) {\n\n    let filter = function(self, event) {\n\n        /* Get drop */\n        let popup  = self.closest(\".selectReplaceChoose\"),\n            inputs = popup.find(\"input[name]\");\n\n        /* On enter */\n        if(event.which === 13) {\n            let visible = popup.find(\"label:visible\");\n            if(visible.length > 0) {\n                inputs.prop(\"checked\", false);\n                visible.children(\"input\").prop(\"checked\", true).trigger(\"change\");\n            }\n            event.stopPropagation();\n        }\n\n        /* Get value */\n\t\tlet value = self.val(),\n\t\t\t rus              = \"йцукенгшщзхъфывапролджэёячсмитьбю\",\n             eng              = \"qwertyuiop[]asdfghjkl;'\\\\zxcvbnm,.\",\n             expression       = new RegExp(value.toLowerCase()),\n             expressionInvert = new RegExp(value.toLowerCase().replace(/[a-zа-яё]/g, (character) => {\n                if(rus.indexOf(character) > -1) return eng[rus.indexOf(character)];\n                if(eng.indexOf(character) > -1) return rus[eng.indexOf(character)];\n                return character;\n            }));\n\n        /* Hide */\n        for(let input of inputs) {\n\n            if(input.parent().hasClass('hidden'))\n                return;\n\n            let inputHtml = input.next().html().toLowerCase();\n\n            try {\n                if(!inputHtml.match(expression) && !inputHtml.match(expressionInvert)) input.parent().hide();\n                else input.parent().show();\n            } catch(e) {}\n\n        }\n    };\n\n    return {\n\n        filter: filter,\n\n        selectAll: function(button) {\n\n            /* Get drop */\n            let popup = button.closest(\".selectReplaceChoose\");\n            popup.find(\":checkbox:visible\").prop(\"checked\", true).first().trigger(\"change\");\n\n        },\n\n        unSelectAll: function(button) {\n\n            /* Get drop */\n            let popup = button.closest(\".selectReplaceChoose\");\n            popup.find(\":checkbox:visible\").prop(\"checked\", false).first().trigger(\"change\");\n\n        },\n\n        close: function(element, event) {\n            if(element.get(0) === event.target)\n                $(\".selectReplaceChoose\").addClass('hidden');\n        },\n\n        /**\n         * Shows drop down\n         * @param replace Input\n         */\n        drop: function (replace) {\n\n            /* Hide all */\n\t\t\t$(\".selectReplaceChoose\").addClass('hidden');\n\n            /* Get drop */\n            let popup = replace.next(),\n                dropOffset = visibleCalculator.getDropOffset(replace, popup);\n\n\t\t\t/* If visible just hide */\n\t\t\tif(dropOffset) {\n\t\t\t\tpopup.removeClass('hidden').css({ marginLeft: dropOffset.left, margintop: dropOffset.top });\n\n\t\t\t\tif(replace.outerWidth() > popup.outerWidth())\n\t\t\t\t\tpopup.css(\"width\", replace.outerWidth());\n\n                /* Search focus */\n\t\t\t\tif (popup.find(\".search\").length)\n\t\t\t\t\tpopup.find(\".search input\").val('').focus();\n\n            }\n\n        }\n    }\n});","sky.directive(\".selectReplaceChoose\", function(popup, attrs) {\r\n\r\n\t\t/* Get inputs */\r\n\t\tlet labels = popup.find(\"label\"),\r\n\t\t\tinputs = popup.find(\"input:radio, input:checkbox\"),\r\n\t\t\tcurrent, change, children, replace = popup.prev(),\r\n\t\t\tval = \"\",\r\n            defaultValue = replace.html() || '-',\r\n            defaultAllValue = replace.text() || \"Все\";\r\n\r\n\t\treplace.data(\"addItem\", function(item) {\r\n\t\t\tvar newInput = sky.templates.renderByText(\"{% skyImport forms as forms %}{{ forms.selectReplaceGroup(items, options) }}\", { items: [item], options: {\r\n\t\t\t\tname: replace.attr(\"input\"),\r\n\t\t\t\tmultiple:  !replace.hasClass(\"single\")\r\n\t\t\t}});\r\n\t\t\tnewInput.insertAfter(inputs.filter(\":last\").parent());\r\n\t\t\tinputs = popup.find(\"input\");\r\n\t\t});\r\n\r\n\t\t/* On change */\r\n\t\t$(document).on(\"change\", '[data-input=\"'+ attrs[\"data-input\"] + '\"] input', change = function(event, data) {\r\n\r\n\t\t\t/* Remove selected styles */\r\n\t\t\tlabels.removeClass(\"selected\");\r\n\r\n\t\t\t/* Base text */\r\n\t\t\tval = \"\";\r\n\t\t\tchildren = false;\r\n\r\n\t\t\t/* Get checked */\r\n\t\t\tvar filtered = inputs.filter(\":checked\").each(function() {\r\n\t\t\t\tcurrent = $(this);\r\n\t\t\t\tcurrent.closest(\"label\").addClass(\"selected\");\r\n\t\t\t\tval = (val && val + \", \") + current.next().text();\r\n\t\t\t\tchildren = current.next();\r\n\t\t\t});\r\n\r\n\t\t\t/* Make text shorter */\r\n\t\t\tif(val.length > 26)\r\n\t\t\t\tval = val.substr(0, 26).trim() + \"...\";\r\n\r\n\t\t\tif(filtered.length === inputs.length && !popup.hasClass(\"single\"))\r\n\t\t\t\tval = defaultAllValue;\r\n\r\n\t\t\tif(popup.hasClass(\"single\") && children)\r\n\t\t\t\treplace.html('').prepend(children.clone().removeClass(\"name\"));\r\n\t\t\telse if(!children)\r\n\t\t\t\treplace.html(defaultValue);\r\n\t\t\telse\r\n\t\t\t\treplace.text(val);\r\n\r\n\t\t\t/* If not fake event */\r\n\t\t\tif(event && current) {\r\n                replace.trigger(\"change\", $.extend(data || {}, {\r\n                    value: current.val(),\r\n                    item: $(this)\r\n                }));\r\n            }\r\n\r\n            if(popup.hasClass(\"single\"))\r\n\t\t\t\t$(\".selectReplaceChoose\").addClass('hidden');\r\n\t\t});\r\n\r\n\t\t/* Trigger */\r\n\t\tsetTimeout(function() { change(false) }, 1);\r\n\r\n\t});\r\n\r\n\r\n$(document)\r\n\t.on(\"click touchstart\", function(event) {\r\n\r\n\t\t/* Get element */\r\n\t\tvar element = $(event.target || event.srcElement);\r\n\r\n\r\n\t\t/* If click in replace we should not hide it */\r\n\t\tif(element.closest(\".selectReplaceChoose\").length || element.closest(\".selectReplace\").length)\r\n\t\t\treturn;\r\n\r\n\t\t/* Hide all */\r\n\t\t$(\".selectReplaceChoose\").addClass('hidden');\r\n\r\n\t}).on(\"change\", \".specialSelect input\", function(event) {\r\n\t\tvar root = $(this).closest(\".specialSelect\");\r\n\t\troot.find(\".selected\").removeClass(\"selected\");\r\n\t\troot.find(\"input\").each(function() {\r\n\t\t\tvar self = $(this);\r\n\r\n\t\t\tif(self.is(\":checked\"))\r\n\t\t\t\tself.parent().addClass(\"selected\");\r\n\r\n\t\t});\r\n\r\n\t\t//root.closest(\"form\").trigger(\"submit\");\r\n\r\n\t}).on(\"mouseover\", \".selectReplaceChoose label\", function() {\r\n\r\n\t\tvar label = $(this);\r\n\t\tvar originalTip = label.find(\".checkItemTip\");\r\n\r\n\t\tif(originalTip.length && !label.data(\"tip\")) {\r\n\t\t\tvar popup = label.closest(\".selectReplaceChoose\");\r\n\t\t\tvar tip = originalTip.clone().removeClass(\"hidden\").appendTo(\"body\");\r\n\t\t\ttip.css({\r\n\t\t\t\tleft: popup.offset().left,\r\n\t\t\t\ttop: popup.offset().top + popup.outerHeight() + 5\r\n\t\t\t});\r\n\t\t\tlabel.data(\"tip\", tip);\r\n\t\t}\r\n\r\n\t}).on(\"mouseout\", \".selectReplaceChoose label\", function() {\r\n\r\n\t\tvar label = $(this);\r\n\r\n\t\tif(label.data(\"tip\")) {\r\n\t\t\tlabel.data(\"tip\").remove();\r\n\t\t\tlabel.removeData(\"tip\");\r\n\t\t}\r\n\r\n\t})\r\n\r\n;\r\n","sky.action(\"suggest\", function(suggester) {\r\n   return {\r\n       adverts: function(input, event) {\r\n\r\n           // Events\r\n           if(event.keyCode == 38 || event.keyCode == 40 || event.keyCode == 13 || event.keyCode == 27)\r\n               return;\r\n\r\n           // Stop if any other\r\n           if(this.suggestAjax)\r\n               this.suggestAjax.stop();\r\n\r\n           // Nothing\r\n           if(input.val() == \"\" || input.val().length < 2) {\r\n               suggester.hideAll();\r\n               return;\r\n           }\r\n\r\n           this.suggestAjax = sky.ajax(\"/ajax/members/search\", { name: input.val() })\r\n               .on(\"success\", function(response) {\r\n\r\n                   // No filtered\r\n                   if(!response.adverts || !response.adverts.length)\r\n                       suggester.hideAll();\r\n\r\n                   var filtered = [];\r\n\r\n                   $.each(response.adverts, function(_, advert) {\r\n                       filtered.push(advert.username);\r\n                   });\r\n\r\n                   // Show\r\n                   suggester.show(input, filtered);\r\n\r\n               }).on(\"error\", function() {\r\n                   suggester.hideAll();\r\n               });\r\n\r\n       },\r\n\r\n       campaigns: function(input, event){\r\n\r\n           // Events\r\n           if(event.keyCode == 38 || event.keyCode == 40 || event.keyCode == 13 || event.keyCode == 27)\r\n               return;\r\n\r\n           // Stop if any other\r\n           if(this.suggestAjax)\r\n               this.suggestAjax.stop();\r\n\r\n           // Nothing\r\n           if(input.val() == \"\" || input.val().length < 2) {\r\n               suggester.hideAll();\r\n               return;\r\n           }\r\n\r\n           this.suggestAjax = sky.ajax(\"/ajax/campaigns/search\", { name: input.val() })\r\n               .on(\"success\", function(response) {\r\n\r\n                   // No filtered\r\n                   if(!response.campaigns || !response.campaigns.length)\r\n                       suggester.hideAll();\r\n\r\n                   var filtered = [];\r\n\r\n                   $.each(response.campaigns, function(_, campaign) {\r\n\r\n                       filtered.push({ html: campaign.name });\r\n                   });\r\n\r\n                   // Show\r\n                   suggester.show(input, filtered);\r\n\r\n               }).on(\"error\", function() {\r\n                   suggester.hideAll();\r\n               });\r\n       },\r\n\r\n       campaignsSpecial: function(input, event){\r\n           // Events\r\n           if(event.keyCode == 38 || event.keyCode == 40 || event.keyCode == 13 || event.keyCode == 27)\r\n               return;\r\n\r\n           // Nothing\r\n           if(input.val() == \"\" || input.val().length < 2) {\r\n               suggester.hideAll();\r\n               return;\r\n           }\r\n\r\n           if(this.suggestAjax)\r\n               this.suggestAjax.stop();\r\n\r\n           this.suggestAjax = sky.ajax(\"/ajax/campaigns/search\", { name: input.val() })\r\n               .on(\"success\", function(response) {\r\n\r\n                   // No filtered\r\n                   if(!response.campaigns || !response.campaigns.length)\r\n                       suggester.hideAll();\r\n\r\n                   var filtered = [];\r\n\r\n                   $.each(response.campaigns, function(_, campaign) {\r\n\r\n                       filtered.push({ html: campaign.name+\" (\"+campaign.advert.username+\")\", callback: function(){\r\n                           sky.actions.perform(null, null, \"page.selectCampaign\", [campaign.id]);\r\n                       }});\r\n                   });\r\n\r\n                   // Show\r\n                   suggester.show(input, filtered);\r\n\r\n               }).on(\"error\", function() {\r\n                   suggester.hideAll();\r\n               });\r\n       }\r\n   }\r\n});","sky.directive(\"[data-suggests]\", function(element, attributes) {\n\telement.attr(\"data-event\", \"keyup: suggest.\" + attributes[\"data-suggests\"]).attr(\"autocomplete\", \"off\");\n});","sky.action(\"tips\", {\n\n\tshowTip: function (button, _, name) {\n\n\t\tif (button.data(\"tip\")) {\n\t\t\tbutton.data(\"tip\").hide();\n\t\t\treturn;\n\t\t}\n\n\t\t// Hide others\n\t\tsky.actions.perform(button, false, \"shared.hideTips\", [name]);\n\n\t\t// Create\n\t\tlet tip = sky.tips.Tip(\"bottom\", button, {\n\t\t\tcreate: $('<div/>').css(\"overflow\", \"hidden\").append($(\"#\" + name + \"TipText\").html())\n\t\t});\n\n\t\t// Show\n\t\ttip.show();\n\n\t},\n\n\tshowTipWithText: function (button, _, text) {\n\n\t\tif (button.data(\"tip\")) {\n\t\t\tbutton.data(\"tip\").hide();\n\t\t\treturn;\n\t\t}\n\n\t\t// Hide others\n\t\tsky.actions.perform(button, false, \"shared.hideTips\");\n\n\t\t// Create\n\t\tlet tip = sky.tips.Tip(\"bottom\", button, {\n\t\t\tcreate: $('<div/>').css(\"overflow\", \"hidden\").append(text)\n\t\t});\n\n\t\t// Show\n\t\ttip.show();\n\n\t},\n\n\thideTips: function (element, event) {\n\t\tlet target;\n\n\t\tif (event && event.target) {\n\t\t\ttarget = $(event.target);\n\t\t\tif (target.is(\"[sky-tip]\") || target.is(\"[sky-tip-text]\") || target.closest(\".tipContent\").length)\n\t\t\t\treturn;\n\t\t}\n\n\t\tsky.tips.hideAll();\n\n\t},\n\n\t/**\n\t *\n\t */\n\tforceHideTips: function () {\n\t\tsky.tips.hideAll(true);\n\t}\n});","sky.directive(\"[data-tip]\", function(button, attributes) {\n\n\t// Get\n\tlet events  = attributes[\"data-event\"] || \"\",\n\t\ttipName = attributes[\"data-tip\"],\n\t\tevent   = \"click: shared.showTip('\" + tipName + \"')\";\n\n\t// Set new\n\tevents = events ? event : events + \"; \" + event;\n\n\t// Add\n\tbutton.attr(\"data-event\", events).addClass(\"dashed\");\n\n});\nsky.directive(\"[data-tip-text]\", function(button, attributes) {\n\n\t// Get\n\tlet events  = attributes[\"data-event\"] || \"\",\n\t\ttipText = attributes[\"data-tip-hover\"] || attributes[\"data-tip-text\"],\n\t\tevent   = \"click: shared.showTipWithText('\" + tipText + \"')\";\n\n\t// Set new\n\tevents = events ? event : events + \"; \" + event;\n\n\t// Add\n\tbutton.attr(\"data-event\", events).addClass(\"dashed\");\n\n});\nsky.directive(\"[data-tip-hover]\", function(button, attributes) {\n\n\t// Get\n\tlet tipText = attributes[\"data-tip-hover\"];\n\n\tsky.service(\"tips\").bind(button, \"top\", {create: tipText});\n\n\t// Set new\n\tlet events = attributes[\"data-event\"] || \"\",\n\t\tevent  = \"click: shared.showTipWithText('\" + tipText + \"')\";\n\tevents = events ? event : events + \"; \" + event;\n\n\t// Add\n\tbutton.attr(\"data-event\", events).addClass(\"dashed\");\n\n});","/**\n * Fire services init done\n */\nsky.exec(function() {\n\tsky.servicesDeferred.resolve();\n});","sky.directive(\"input.autoHttp\", function(input) {\n\tinput.on(\"focus\", function() {\n\t\tif(input.val() === \"\") input.val(\"http://\").get(0).selectionStart = 7;\n\t});\n});","/**\n * Fire project init done\n */\nsky.exec(function() {\n    document.body.classList.remove(\"hidden\");\n    sky.projectDeffered.resolve();\n});"]}