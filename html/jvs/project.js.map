{"version":3,"sources":["actions.js","ajax.js","ajaxFiles.dropZone.js","ajaxFiles.iframe.js","ajaxFiles.js","ajaxFiles.xhr.js","calendar.js","callback.js","callbacks.js","dataOperator.js","directives.js","drag.js","history.js","inputsIO.js","localStorage.js","models.js","modelsManager.js","modelsStorage.js","notifications.js","pagination.js","stacklist.js","suggester.js","supported.js","templates.js","tips.js","utils.js","validator.js","visibleCalculator.js","windows.js","servicesInit.js","paginationActions.js","selectReplace.js","shared.js","suggests.js","select.js","projectInit.js"],"names":["sky","service","_ref","exceptions","list","actions","this","perform","element","event","action","options","params","match","split","$","each","i","val","eval","trim","extend","self","path","current","name","isDisabled","elem","length","system","Error","apply","concat","add","events","safe","_typeof","fn","selector","on","data","call","document","skyEvent","getAttribute","indexOf","type","preventDefault","parts","target","get","actionData","callbacks","url","_ref2","_ref2$object","object","undefined","_ref2$callbackData","callbackData","_ref2$ajaxExtend","ajaxExtend","filter","disable","ajaxCallbacks","stop","ajax","abort","dataType","timeout","success","response","textStatus","jqXHR","error","text","fire","errorThrown","errorText","responseText","status","codes","code","promise","always","enable","400","401","402","403","404","405","406","407","408","409","410","411","412","413","414","415","416","417","422","423","424","425","426","428","429","431","451","456","499","500","501","502","503","504","505","506","507","508","509","510","511","supported","_class","zone","_classCallCheck","files","XHRIsSupported","attachEvents","_createClass","key","value","_this","dragenter","dragleave","dragend","drop","dragover","originalEvent","isValidFileDrag","effect","dataTransfer","effectAllowed","dropEffect","bind","e","onStart","dt","isWebkit","navigator","userAgent","types","contains","ajaxFilesXHR","ajaxFilesIFrame","AjaxFiles","input","inputs","saveFiles","XHRUpload","_iteratorNormalCompletion","_didIteratorError","_iteratorError","_step","_iterator","Symbol","iterator","next","done","file","push","inputName","attr","err","return","send","parallel","_","handler","sendParallel","sendConsequentially","_this2","id","_iteratorNormalCompletion2","_didIteratorError2","_iteratorError2","_step2","_iterator2","defaultSend","is","closest","find","templates","notifications","windows","filesAjax","modal","getLast","currentFile","holder","remove","lock","render","insertAfter","parent","unlock","clearExceptTemplate","message","appendToModal","totalPercent","percent","html","css","stackList","toProceed","inProgress","total","totalLoaded","totalSize","fileRequests","size","Math","random","getName","loaded","queryString","jQuery","param","args","formData","form","FormData","append","processData","contentType","xhr","XMLHttpRequest","upload","toFixed","onProgress","beforeSend","func","setRequestHeader","encodeURI","all","notSuccess","delete","fileRequestData","request","replace","calendar","monthsNames","window","page","renderDays","moment","date","weeks","currentWeek","month","day","number","isoWeek","days","clone","dateStr","format","dates","period","since","till","setTime","dayPick","dayDiv","notClose","parseInt","field","getInputValue","trigger","close","useTime","isSame","setDayPick","pickedDateView","position","marginTop","marginLeft","offset","top","outerHeight","left","periodChangeDay","reset","lastModified","isBefore","isAfter","markSelected","removeClass","addClass","changeDay","hour","minute","changeYear","year","yearView","changeMonth","monthView","getDatePeriod","dateString","getDate","off","show","showTime","lastPicked","subtract","dateOriginal","elementFromPoint","clientX","touches","clientY","onReady","srcElement","parents","keyCode","calendars","Callback","flags","functions","toRun","context","prototype","once","removeByContext","splice","removeByCallback","fireNext","result","callback","Callbacks","advancedCallbacks","callbacksFlags","removeListener","listener","Object","getEventsNames","slice","possible","names","elements","j","join","arguments","inputsIO","utils","searchField","virtual","default","Array","isObjectsEqual","searchRead","hashRead","readInputsValues","writeInputsValue","hashValue","history","hashObject","searchValue","searchObject","baseOptions","fields","historyType","DataOperator","lastRequestData","beforeRequest","setOptions","onFormSubmit","validForm","force","reload","set","search","fromUrl","readSearch","writeForm","readHash","read","writeHash","writeSearch","prepareRequest","lastResponse","loading","reloadContent","item","fieldsList","valueOrNullOnDefault","write","fieldName","substring","initOperator","initLoader","loader","pagination","_ref2$reload","_ref2$history","pages","onPageChange","pageNum","searchChanged","hashChanged","directives","directive","getAttributes","attributes","nodeName","nodeValue","parseElement","jsonScript","children","json","JSON","parse","tag","parseDirectives","bindEvents","start","move","button","started","x","pageX","y","pageY","History","hashString","searchString","pathString","intervalId","base","navigate","location","pathname","substr","pushState","oldPath","newPath","getWindowSearch","hash","change","hashDifference","searchDifference","old","getWindowHash","getDifference","rebuild","pathChanged","setHash","setSearch","changed","decodeURIComponent","proxy","stringFromObject","obj","getObjects","paramsString","objects","subStrings","str","keyAndValue","string","stored","getObjectsDifference","first","second","difference","localDiff","returnArray","decodeURI","onpopstate","setInterval","time","readInputValue","valuesNamed","valuesLined","writeInputValue","prop","notByUser","values","LocalStorage","prefix","fullName","itemPrefix","ids","onLoad","localStorage","getItem","storage","parseJSON","itemsIds","items","getIds","load","setItem","stringify","console","log","index","models","save","removeItem","modelsStorage","modelsDefinition","BaseDefinition","Model","definition","creation","extension","model","addDefinition","fromData","cached","Manager","arr","fromArray","cache","visibleCalculator","tips","Modal","tip","align","Tip","create","loadings","global","appendTo","click","hide","inModalWindow","content","contentHolder","calc","setPosition","calculate","width","height","setHolder","reCalculate","instance","init","services","Pagination","_ref2$current","pageWidth","last","dimensions","startPage","lastStartPage","pagesVisible","pagesInvisible","scrollAvailable","scrollStart","tumbler","dom","slider","back","forward","redraw","goToPage","newPage","floor","innerWidth","toShow","drawPages","createScroll","scrollLine","runner","scroll","outerWidth","pos","List","lastId","single","suggester","lastList","removeData","elementPosition","renderPosition","margin-left","margin-top","selected","prev","fullScreen","templatesList","templatesCompiled","Templates","globals","template","renderWithHolder","noDirectives","compile","temp","renderToText","renderByText","twig","renderByTextToText","compiled","fromLS","cookie","hideAll","withoutAutoHide","autoHide","mouseenter","mouseleave","_ref2$autoHide","_ref2$create","_ref2$close","_ref2$ajax","_ref2$highlight","highlight","insertBefore","shadow","opacity","background","closeTimeout","setTimeout","display","animate","fadeOut","fadeIn","blur","clearTimeout","what","hasOwnProperty","addLeadingZero","encode","rawStr","charCodeAt","jsonData","prepareSelectData","_ref$columnSplitOn","columnSplitOn","_ref$maxColumns","maxColumns","groupHolder","columns","columnsCount","perColumn","ceil","column","groups","validator","validateForm","validationRule","addRule","validateElement","pass","shouldBeValidated","Options","totalPass","firstError","lastSuccess","firstSuccess","rules","ruleOverload","compiledRule","Rule","validate","onSuccess","onError","rule","ruleDefaults","optionsDefaults","errorClass","successClass","overload","required","requiredIfFilled","email","same","regexp","RegExp","numeric","positive","parseFloat","max","min","minLength","maxLength","getDeclaredRules","Calculator","minHeight","scrollable","holderRect","scrollTop","windowHeight","windowWidth","sizes","right","realHeight","scrollLeft","bottom","popup","popupWidth","popupHeight","win","replaceOffset","popupOffset","leftDifference","topDifference","middle","visible","selfOffset","selfWidth","locked","dataContainer","closeButton","body","reRender","detach","removeMessages","innerHeight","byUser","exec","servicesDeferred","resolve","setPage","scrollTo","grab","previous","which","stopPropagation","rus","eng","expression","toLowerCase","expressionInvert","character","hasClass","inputHtml","selectAll","unSelectAll","dropOffset","getDropOffset","margintop","focus","closeWindow","submit","clearForm","showTip","showTipWithText","hideTips","forceHideTips","changeOrder","orderField","order","table","trs","cell1","cell2","convert","sort","firstTr","secondTr","val1","val2","isNaN","changeOrderReload","currentLoader","adverts","suggestAjax","filtered","advert","username","campaigns","campaign","campaignsSpecial","attrs","labels","defaultValue","defaultAllValue","multiple","prepend","root","label","originalTip","tipText","selectionStart","projectDeffered"],"mappings":"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","file":"project.js","sourcesContent":["sky.service(\"actions\", [\"exceptions\"], function ({exceptions}) {\n\n\tlet list = {},\n\t\tactions = this.service = {\n\n\t\t\t/**\n\t\t\t * Performs action\n\t\t\t * @param element\n\t\t\t * @param event\n\t\t\t * @param action\n\t\t\t * @param {Array} [options]\n\t\t\t */\n\t\t\tperform: function (element, event, action, options) {\n\n\t\t\t\t/* Get parameters */\n\t\t\t\tlet params = action.match(/(.+)\\((.*)\\)/);\n\n\t\t\t\t/* Parse */\n\t\t\t\tif (params) {\n\n\t\t\t\t\t/* Get function */\n\t\t\t\t\taction = params[1];\n\n\t\t\t\t\t/* Parse params */\n\t\t\t\t\tparams = params[2].split(\",\");\n\t\t\t\t\t$.each(params, function (i, val) {\n\t\t\t\t\t\tparams[i] = eval(val.trim());\n\t\t\t\t\t})\n\t\t\t\t}\n\n\t\t\t\t/* Options */\n\t\t\t\tif (options)\n\t\t\t\t\tparams = $.extend(params || [], options);\n\n\t\t\t\t/* Get */\n\t\t\t\tlet self = element ? $(element) : false,\n\t\t\t\t\tpath = action.split(\".\"),\n\t\t\t\t\tcurrent = list,\n\t\t\t\t\tname = action;\n\n\t\t\t\t/* If disabled */\n\t\t\t\tif (self && self.isDisabled && self.isDisabled())\n\t\t\t\t\treturn;\n\n\t\t\t\t$.each(path, function (i, elem) {\n\n\t\t\t\t\t/* Search */\n\t\t\t\t\tif (i + 1 < path.length && !current[elem])\n\t\t\t\t\t\tthrow new exceptions.system.Error(\"No action - \" + action + \", because can't find '\" + elem + \"'\");\n\n\t\t\t\t\t/* Get new elem */\n\t\t\t\t\tif (i + 1 < path.length)\n\t\t\t\t\t\tcurrent = current[elem];\n\n\t\t\t\t\t/* Save name */\n\t\t\t\t\tname = elem;\n\n\t\t\t\t});\n\n\t\t\t\t/* If no */\n\t\t\t\tif (!current[name])\n\t\t\t\t\tthrow new exceptions.system.Error(\"No action - \" + action);\n\n\t\t\t\t/* Call */\n\t\t\t\tcurrent[name].apply(current, [self, event].concat(params || []));\n\n\t\t\t},\n\n\t\t\t/**\n\t\t\t * Adds actions to list\n\t\t\t * @param name Group name\n\t\t\t * @param events List\n\t\t\t */\n\t\t\tadd: function (name, events) {\n\n\t\t\t\tif (typeof events === \"function\")\n\t\t\t\t\tevents = events.safe(true)();\n\n\t\t\t\t// Check\n\t\t\t\tif (!events || typeof events !== 'object')\n\t\t\t\t\tthrow new exceptions.system.Error(\"No event object for events '\" + name + \"' provided\");\n\n\t\t\t\t// Save\n\t\t\t\tlist[name] = $.extend(list[name] || {}, events);\n\n\t\t\t}\n\n\t\t};\n\n\n\t/**\n\t * Adds special bind function\n\t * @param {string} name Event name\n\t * @param {*} selector Selector string\n\t * @param {function} [action] Action function\n\t * @returns {jQuery}\n\t */\n\t$.fn.action = function(name, selector, action) {\n\n\t\t/* Parameters skip */\n\t\tif(typeof action === \"undefined\") { action = selector; selector = null; }\n\n\t\t/* Bind */\n\t\treturn this.on(name, selector, function(event, data) {\n\t\t\taction.call(this, event, $(this), data);\n\t\t}.safe());\n\t};\n\n\t/*\n\t * Bind declarative events\n\t */\n\t$(document).action(\"click submit keyup keydown dblclick mouseover mouseout mouseleave mouseenter change mousedown mouseup touchstart\", '[data-event]', function (event, self, data) {\n\n\t\t/* Get string */\n\t\tlet skyEvent = this.getAttribute(\"data-event\");\n\n\t\t/* If no such string */\n\t\tif (skyEvent.indexOf(event.type) === -1)\n\t\t\treturn;\n\n\t\t/* If disabled */\n\t\tif (self.isDisabled && self.isDisabled()) {\n\t\t\tevent.preventDefault();\n\t\t\treturn;\n\t\t}\n\n\t\t/* Split */\n\t\tlet list = skyEvent.split(\";\"), i;\n\n\t\t/* Go through */\n\t\tfor (i = 0; i < list.length; i++) {\n\n\t\t\t/* Get elements */\n\t\t\tlet parts = list[i].match(/(\\w+):(.*)/);\n\n\t\t\t/* Wrong */\n\t\t\tif (parts.length !== 3)\n\t\t\t\tthrow new exceptions.system.Error(\"Wrong action format in data-event: \" + list[i]);\n\n\t\t\t/* Get elements */\n\t\t\tlet name = parts[1].trim(),\n\t\t\t\taction = parts[2].trim();\n\n\t\t\t/* Another event */\n\t\t\tif (name !== event.type)\n\t\t\t\tcontinue;\n\n\t\t\t/* No default go */\n\t\t\tif (event.target === self.get(0))\n\t\t\t\tevent.preventDefault();\n\n\t\t\t/* Passed data */\n\t\t\tif (data)\n\t\t\t\tevent.data = data;\n\n\t\t\t/* Get action data */\n\t\t\tlet actionData = self.data(\"skyActionData\");\n\n\t\t\t/* Save */\n\t\t\tif (actionData)\n\t\t\t\tevent.data = actionData;\n\n\t\t\t/* Dump action */\n\t\t\tif (action === \"false\")\n\t\t\t\tcontinue;\n\n\t\t\t/* Perform action */\n\t\t\tactions.perform(this, event, action);\n\n\t\t}\n\n\t});\n\n});","sky.service(\"ajax\", [\"callbacks\"], function({ callbacks }) {\n\n\t/**\n\t * Advanced ajax execution\n\t * To abort call stop() method instead of abort() because it's used for abort callback set, or .ajax.abort()\n\t * You may skip type, don't skip it if lock is string set false in object and data\n\t * @param {string} url\t\t\t\tRequested url\n\t * @param {object} [data]\t\t\tHolds request parameters\n\t * @param {jQuery} [object]\t\t\tObject which performs request, to disable it during request\n\t * @param {object} [ajaxExtend]\t\tAdditional ajax options, see http://api.jquery.com/jQuery.ajaxSetup/\n\t * @param {object} [callbackData]\tAdditional params that passed to any callback\n\t */\n\tthis.service = function(url, data, { object = null, callbackData = {}, ajaxExtend = {} }) {\n\n\t\t/* Lock button */\n\t\tif(object)\n\t\t\tobject = $(object).filter(\":not(.disabled)\").disable();\n\n\t\t/* New object to store callbacks */\n\t\tlet ajaxCallbacks = new callbacks();\n\t\tajaxCallbacks.stop = function() { ajaxCallbacks.ajax.abort(); };\n\n\t\t/* Perform ajax request */\n\t\tajaxCallbacks.ajax = $.ajax($.extend(true, {\n\n\t\t\t/* Set base options */\n\t\t\turl     \t: url,\n\t\t\tdata    \t: data,\n\t\t\tdataType\t: \"json\",\n\t\t\ttype    \t: \"post\",\n\t\t\ttimeout\t\t: 480 * 1000,\n\t\t\tsuccess: function(response, textStatus, jqXHR) {\n\n\t\t\t\t/* Possible params list */\n\t\t\t\tlet params = $.extend({ jqXHR: jqXHR, textStatus: textStatus, object: object }, callbackData);\n\n\t\t\t\t/* If empty response */\n\t\t\t\tif(response === null) {\n\t\t\t\t\tparams.error = \"  \";\n\t\t\t\t\tparams.type = \"noData\";\n\t\t\t\t}\n\n\t\t\t\t/* If response returned with error */\n\t\t\t\tif(response.error) {\n\t\t\t\t\tparams.error = response.text;\n\t\t\t\t\tparams.type = \"php\";\n\t\t\t\t}\n\n\t\t\t\t/* If error type set */\n\t\t\t\tif(params.type)\n\t\t\t\t\treturn ajaxCallbacks.fire(\"notSuccess, error\", params); // No data\n\n\t\t\t\t/* Set response in possible params */\n\t\t\t\tparams.response = params.data = response;\n\n\t\t\t\t/* User success function */\n\t\t\t\treturn ajaxCallbacks.fire(\"preSuccess, success, notAbort\", params);\n\n\t\t\t}.safe(),\n\t\t\terror: function(jqXHR, textStatus, errorThrown) {\n\n\t\t\t\t/* Defaults */\n\t\t\t\tlet type        = \"Unknown\",\n\t\t\t\t\terrorText   = \"     ,   \";\n\n\t\t\t\t/* Get error text according to response data */\n\t\t\t\tif(textStatus === \"abort\") {\n\t\t\t\t\ttype \t  = \"abort\";\n\t\t\t\t\terrorText = '  ';\n\t\t\t\t} else if(textStatus === 'parsererror') {\n\t\t\t\t\ttype \t  = \"parse\";\n\t\t\t\t\terrorText = \"    ,   , :<br/>\" + jqXHR.responseText;\n\t\t\t\t} else if(textStatus === 'timeout') {\n\t\t\t\t\ttype \t  = \"timeout\";\n\t\t\t\t\terrorText = '   ';\n\t\t\t\t} else if(jqXHR.status === 0) {\n\t\t\t\t\ttype \t  = \"stopped\";\n\t\t\t\t\terrorText = ' ,    ';\n\t\t\t\t} else if(codes[jqXHR.status]) {\n\t\t\t\t\ttype = jqXHR.status;\n\t\t\t\t\terrorText = '     <br/> ' + codes[jqXHR.status];\n\t\t\t\t}\n\n\t\t\t\t/* Possible params list */\n\t\t\t\tlet params = $.extend({\n\t\t\t\t\terror      : errorText,\n\t\t\t\t\ttype       : type,\n\t\t\t\t\tcode\t   : type,\n\t\t\t\t\tjqXHR      : jqXHR,\n\t\t\t\t\ttextStatus : textStatus,\n\t\t\t\t\tstatus     : textStatus,\n\t\t\t\t\terrorThrown: errorThrown,\n\t\t\t\t\tobject     : object\n\t\t\t\t}, callbackData);\n\n\t\t\t\t/* Execute callback */\n\t\t\t\tajaxCallbacks.fire(\"notSuccess\", params);\n\n\t\t\t\t/* Execute special ajaxCallbacks */\n\t\t\t\tajaxCallbacks.fire(textStatus === \"abort\" ? \"abort\" : \"error, notAbort\", params);\n\n\t\t\t}.safe()\n\n\t\t}, ajaxExtend));\n\n\t\t/* On always set */\n\t\tajaxCallbacks.ajax.promise().always(function(jqXHR, textStatus, errorThrown) {\n\n\t\t\t/* Unlock objects */\n\t\t\tif(object)\n\t\t\t\tobject.enable();\n\n\t\t\t/* Always callback */\n\t\t\tajaxCallbacks.fire(\"always\", { errorThrown: errorThrown, textStatus: textStatus, jqXHR: jqXHR, object: object});\n\n\t\t}.safe());\n\n\t\treturn ajaxCallbacks;\n\n\t};\n\n\t/**\n\t * Contains http codes\n\t */\n\tlet codes = {\n\n\t\t/* Request errors */\n\t\t400: \" \",\n\t\t401: \"    \",\n\t\t402: \"     \",\n\t\t403: \"   \",\n\t\t404: \"          \",\n\t\t405: \"   HTTP\",\n\t\t406: \" \",\n\t\t407: \"  \",\n\t\t408: \"  \",\n\t\t409: \"\",\n\t\t410: \" \",\n\t\t411: \"    \",\n\t\t412: \" \",\n\t\t413: \"   \",\n\t\t414: \" URI  \",\n\t\t415: \"  \",\n\t\t416: \"   \",\n\t\t417: \" \",\n\t\t422: \" \",\n\t\t423: \" \",\n\t\t424: \" \",\n\t\t425: \" \",\n\t\t426: \" \",\n\t\t428: \" \",\n\t\t429: \"  \",\n\t\t431: \"    \",\n\t\t451: \"   \",\n\t\t456: \" \",\n\t\t499: \" Nginx,     \",\n\n\t\t/* Server error */\n\t\t500: \"  \",\n\t\t501: \" \",\n\t\t502: \"   \",\n\t\t503: \" \",\n\t\t504: \"  \",\n\t\t505: \" HTTP  \",\n\t\t506: \"   \",\n\t\t507: \" \",\n\t\t508: \" \",\n\t\t509: \"   \",\n\t\t510: \" \",\n\t\t511: \"  \"\n\n\t};\n\n});","/** Class to work with drop zone for File api */\nsky.service(\"ajaxFilesDropZone\", [\"supported\", \"callbacks\"], function({ supported, callbacks }) {\n\tthis.service = class {\n\t\tconstructor({ zone, data, url, options }) {\n\n\t\t\t/* Save options */\n\t\t\tthis.options   = options;\n\t\t\tthis.zone      = zone;\n\t\t\tthis.callbacks = callbacks();\n\t\t\tthis.data      = data;\n\t\t\tthis.url       = url;\n\t\t\tthis.files     = [];\n\n\t\t\t/* If no XHR supported, no file drip needed */\n\t\t\tif(!supported.XHRIsSupported) {\n\t\t\t\tthis.callbacks.fire(\"nonSupported\");\n\t\t\t\treturn this;\n\t\t\t}\n\n\t\t\t/* Bind events */\n\t\t\tthis.attachEvents();\n\n\t\t}\n\n\t\tattachEvents() {\n\n\t\t\t/* While over event */\n\t\t\tthis.zone.on({\n\n\t\t\t\tdragenter: (event) => { this.callbacks.fire(\"dragenter\", this, [event]); },\n\t\t\t\tdragleave: (event) => { this.callbacks.fire(\"dragleave\", this, [event]); },\n\t\t\t\tdragend  : (event) => { this.callbacks.fire(\"dragend\", this, [event]); \t },\n\t\t\t\tdrop     : (event) => { this.callbacks.fire(\"drop\", this, [event]);\t\t },\n\t\t\t\tdragover : (event) => {\n\n\t\t\t\t\t/* Get event */\n\t\t\t\t\tevent = event.originalEvent;\n\n\t\t\t\t\t/* Check if drag is valid */\n\t\t\t\t\tif(!this.isValidFileDrag(event))\n\t\t\t\t\t\treturn;\n\n\t\t\t\t\t/* Get effect */\n\t\t\t\t\tlet effect = event.dataTransfer.effectAllowed;\n\n\t\t\t\t\t/* Set proper */\n\t\t\t\t\tif(effect === 'move' || effect === 'linkMove') {\n\t\t\t\t\t\tevent.dataTransfer.dropEffect = 'move'; // for FF (only move allowed)\n\t\t\t\t\t} else {\n\t\t\t\t\t\tevent.dataTransfer.dropEffect = 'copy'; // for Chrome\n\t\t\t\t\t}\n\n\t\t\t\t\t/* Prevent */\n\t\t\t\t\tevent.preventDefault();\n\n\t\t\t\t}\n\t\t\t});\n\n\t\t\t/* Stop file opening when drop on browser window */\n\t\t\t$(document).bind({\n\t\t\t\tdragover : function(e) {\n\t\t\t\t\te = e.originalEvent;\n\t\t\t\t\tif(e.dataTransfer) {\n\t\t\t\t\t\te.dataTransfer.dropEffect = 'none';\n\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tdragenter: function(e) {\n\t\t\t\t\tif(typeof self.options.onStart !== \"undefined\")\n\t\t\t\t\t\tself.options.onStart.apply(self, [e]);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tstatic isValidFileDrag(event) {\n\n\t\t\tlet dt = event.dataTransfer,\n\t\t\t// do not check dt.types.contains in webkit, because it crashes safari 4\n\t\t\t\tisWebkit = navigator.userAgent.indexOf(\"AppleWebKit\") > -1;\n\n\t\t\t// dt.effectAllowed is none in Safari 5\n\t\t\t// dt.types.contains check is for firefox\n\t\t\treturn dt && dt.effectAllowed !== 'none' &&\n\t\t\t\t(dt.files || (!isWebkit && dt.types.contains && dt.types.contains('Files')));\n\n\t\t}\n\n\t};\n\n});","sky.service(\"ajaxFilesIFrame\", function() {\n\n\tlet AjaxFilesIFrame = function(options) {\n\n\t\t/* Save options */\n\t\tthis.options \t= options;\n\t\tthis.files    \t= options.files;\n\t\tthis.input   \t= options.input;\n\t\tthis.url  \t \t= options.url;\n\t\tthis.data \t \t= options.data;\n\t\tthis.callbacks \t= options.callbacks;\n\n\t};\n\n\tAjaxFilesIFrame.prototype = {\n\n\t\tgetName: function(name){\n\n\t\t\t// get input value and remove path to normalize\n\t\t\treturn name.replace(/.*(\\/|\\\\)/, \"\");\n\n\t\t},\n\n\t\tcancel: function(id){\n\n\t\t\tthis.options.onAbort(id, this.getName(this.input.value));\n\n\t\t\tthis.IFrame.setAttribute('src', 'javascript:false;').remove();\n\n\t\t},\n\n\t\t/**\n\t\t * Upload file function\n\t\t */\n\t\tsend: function() {\n\n\t\t\t/* letiables */\n\t\t\tlet self \t = this;\n\t\t\tlet input \t = this.input;\n\t\t\tlet fileName = this.getName(input.value);\n\n\t\t\t/* Create new input */\n\t\t\t$(input).clone().val(\"\").insertBefore(input);\n\n\t\t\t/* Create elements */\n\t\t\tthis.IFrame = this.createIframe();\n\t\t\tthis.form = this.createForm(this.IFrame, this.options.data).append(input);\n\n\t\t\tthis.attachLoadEvent(this.IFrame, function() {\n\n\t\t\t\tlet response = self.getIframeContentJSON(self.IFrame);\n\n\t\t\t\tif(response) self.options.onSuccess(response);\n\n\t\t\t\t// timeout added to fix busy state in FF3.6\n\t\t\t\tsetTimeout(function(){ self.IFrame.remove(); }, 1);\n\n\t\t\t});\n\n\t\t\tthis.form.trigger(\"submit\");\n\n\t\t},\n\n\t\t/**\n\t\t * Attach load event to IFrame\n\t\t */\n\t\tattachLoadEvent: function(iframe, callback){\n\n\t\t\tiframe.load(function(){\n\n\t\t\t\tif (!this.parentNode) return;\n\n\t\t\t\t// fixing Opera 10.53\n\t\t\t\tif (this.contentDocument &&\n\t\t\t\t\tthis.contentDocument.body &&\n\t\t\t\t\tthis.contentDocument.body.innerHTML === \"false\") return;\n\n\t\t\t\tcallback();\n\n\t\t\t});\n\n\t\t},\n\n\t\t/**\n\t\t * Returns json object received by IFrame from server.\n\t\t */\n\t\tgetIframeContentJSON: function(iframe){\n\n\t\t\t/* IFrame.contentWindow.document - for IE<7 */\n\t\t\tlet doc = iframe.get(0).contentDocument ? iframe.get(0).contentDocument: iframe.get(0).contentWindow.document;\n\n\t\t\tlet response = doc.body.innerHTML\n\n\t\t\t/* Check for empty response */\n\t\t\tif(response === \"\") {\n\t\t\t\tif(self.callbacks) self.callbacks.onError(\"  \"); // No data\n\t\t\t\treturn false;\n\t\t\t}\n\n\n\t\t\t/* Try to get json data */\n\t\t\ttry {\n\t\t\t\tresponse = jQuery.parseJSON(response);\n\t\t\t} catch(e) {\n\t\t\t\tif(self.callbacks) {\n\t\t\t\t\tself.callbacks.onError(\"  \"); // No data\n\t\t\t\t\tconsole.log(response);\n\t\t\t\t}\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\t/* If response returned with error */\n\t\t\tif(response.error) {\n\t\t\t\tif(self.callbacks) self.callbacks.onError(response.text); // Execute user error handler\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\treturn response;\n\t\t},\n\n\t\t/**\n\t\t * Creates IFrame with unique name\n\t\t */\n\t\tcreateIframe: function() {\n\n\t\t\treturn $('<IFrame/>', { src: \"javascript:false;\", name: \"uploadIFrame\" + Math.floor(Math.random()*1000000) }).css(\"display\", \"none\").appendTo('body');\n\n\t\t},\n\n\t\t/**\n\t\t * Creates form, that will be submitted to IFrame\n\t\t */\n\t\tcreateForm: function(iframe, params) {\n\n\t\t\tlet queryString = this.url + \"?\" + jQuery.param(params);\n\n\t\t\treturn $('<form/>', {\n\t\t\t\tmethod: \"post\", enctype: \"multipart/form-data\", action: queryString, target: iframe.attr(\"name\")\n\t\t\t}).css(\"display\", \"none\").appendTo('body');\n\n\t\t}\n\n\t};\n\n});","/**\n * Module to work with ajax file upload\n */\nsky.service(\"ajaxFiles\", [\"supported\", \"callbacks\", \"ajaxFilesXHR\", \"ajaxFilesIFrame\"], function({ callbacks, supported, ajaxFilesXHR, ajaxFilesIFrame }) {\n\n\t/**\n\t * Class to work with dynamic file upload\n\t * @param {html|string} input Input to be used to upload\n\t * @param {string} url Url to upload\n\t * @param {object} data Data to be send with request\n\t */\n\tlet AjaxFiles = this.service = function(input, url, data) {\n\n\t\t/* Self construct */\n\t\tif(!(this instanceof AjaxFiles))\n\t\t\treturn new AjaxFiles(input, url, data);\n\n\t\t/* Save items */\n\t\tthis.inputs \t= $(input);\n\t\tthis.url   \t\t= url;\n\t\tthis.data  \t\t= data;\n\t\tthis.callbacks \t= callbacks();\n\t\tthis.files\t\t= [];\n\n\t\t/**\n\t\t * Function to handle file input change\n\t\t */\n\t\tthis.saveFiles = function(input) {\n\n\t\t\t/* Get files list */\n\t\t\tif(supported.XHRUpload) {\n\n\t\t\t\t/* Get files from event */\n\t\t\t\tlet files = input.get(0).files;\n\n\t\t\t\t/* Save them to this */\n\t\t\t\tfor(let file of files)\n\t\t\t\t\tthis.files.push({ file: file, input: input, inputName: input.attr(\"name\") });\n\n\t\t\t} else this.files.push(input.get(0));\n\n\t\t};\n\n\t\t/**\n\t\t * Sends ajax files\n\t\t * @param {bool} parallel If try files would be send in parallel\n\t\t * @returns {*}\n\t\t */\n\t\tthis.send = function(parallel) {\n\n\t\t\t/* Clear */\n\t\t\tthis.files = [];\n\n\t\t\t/* Get files list */\n\t\t\tthis.inputs.each((_, input) => { this.saveFiles($(input)); });\n\n\t\t\t/* If no files */\n\t\t\tif(!this.files.length)\n\t\t\t\treturn false;\n\n\t\t\t/* Create supported handler */\n\t\t\tlet handler;\n\t\t\tif(supported.XHRUpload)\n\t\t\t\thandler = new ajaxFilesXHR(this);\n\t\t\telse\n\t\t\t\thandler = new ajaxFilesIFrame(this);\n\n\t\t\t/* Send files */\n\t\t\tif(parallel)\n\t\t\t\tthis.sendParallel(handler);\n\t\t\telse\n\t\t\t\tthis.sendConsequentially(handler);\n\n\t\t\t/* return send handler */\n\t\t\treturn handler;\n\n\t\t};\n\n\t\t/**\n\t\t * Sends files consequentially\n\t\t * @param handler\n\t\t */\n\t\tthis.sendConsequentially = function(handler) {\n\n\t\t\t/* First id */\n\t\t\tlet id = 0;\n\n\t\t\t/* Set sending next after this one */\n\t\t\tthis.callbacks.on(\"always\", () => {\n\t\t\t\tid++;\n\t\t\t\tif(this.files[id])\n\t\t\t\t\thandler.send(this.files[id]);\n\t\t\t});\n\n\t\t\t/* Send first */\n\t\t\thandler.send(self.files[id]);\n\n\t\t};\n\n\t\t/**\n\t\t * Sends files parallel\n\t\t * @param handler\n\t\t */\n\t\tthis.sendParallel = function(handler) {\n\n\t\t\t/* Send files through them */\n\t\t\tfor(let file of this.files)\n\t\t\t\thandler.send(file);\n\n\t\t};\n\n\t\t/* Self return */\n\t\treturn this;\n\n\t};\n\n\t/**\n\t * Performs default file send\n\t * @param {string} url\n\t * @param element\n\t * @param data\n\t */\n\tAjaxFiles.defaultSend = function(url, element, data) {\n\n\t\t// Get input\n\t\tlet input = element.is(\"input[type=file]\") ? element : element.closest(\"label, .label\").find(\"input[type=file]\"),\n\t\t\texceptions = sky.service(\"exceptions\"),\n\t\t\ttemplates = sky.service(\"templates\"),\n\t\t\tnotifications = sky.service(\"notifications\"),\n\t\t\twindows = sky.service.windows(\"windows\");\n\n\t\t// Check\n\t\tif(!input.length)\n\t\t\tthrow new exceptions.system.Error(\"No proper input provided for file send\");\n\n\t\t// Init\n\t\tlet filesAjax = AjaxFiles(input, url, data),\n\t\t\tmodal = windows.getLast(),\n\t\t\tcurrentFile;\n\n\t\t/*  Bind events */\n\t\tfilesAjax.callbacks\n\t\t\t.on(\"begin\", function (file) {\n\t\t\t\tif(modal) {\n\t\t\t\t\tmodal.holder.find(\".preview\").remove();\n\t\t\t\t\tmodal.lock();\n\t\t\t\t}\n\t\t\t\tcurrentFile = templates.render(\"files-single-upload\", file).insertAfter(element.parent());\n\t\t\t})\n\t\t\t.on(\"always\", function () {\n\t\t\t\tcurrentFile.remove();\n\t\t\t\tif(modal)\n\t\t\t\t\tmodal.unlock();\n\t\t\t})\n\t\t\t.on(\"notSuccess\", function (error) {\n\t\t\t\tmodal.clearExceptTemplate();\n\t\t\t\tnotifications.message({text: error}).appendToModal(modal);\n\t\t\t})\n\t\t\t.on(\"progress\", function (totalPercent, percent) {\n\t\t\t\tcurrentFile.find(\".total\").html(percent + \"%\");\n\t\t\t\tcurrentFile.find(\".progressBar div\").css(\"width\", percent + \"%\");\n\n\t\t\t\t// If loaded\n\t\t\t\tif (percent === 100)\n\t\t\t\t\tcurrentFile.find(\".total\").html(\"100%, \");\n\n\n\t\t\t})\n\t\t\t.on(\"start\", function () {\n\n\t\t\t});\n\n\t\t/* Send */\n\t\tfilesAjax.send();\n\t\treturn filesAjax;\n\n\t};\n\n});","/** Sends file data via HttpRequest */\nsky.service(\"ajaxFilesXHR\", [\"supported\", \"ajax\", \"stackList\"], function({supported, ajax, stackList}) {\n\tthis.service = class {\n\t\tconstructor(options) {\n\n\t\t\t/* Save options */\n\t\t\tthis.options \t\t= options;\n\t\t\tthis.files \t\t\t= options.files;\n\t\t\tthis.input \t\t\t= options.input;\n\t\t\tthis.url \t\t\t= options.url;\n\t\t\tthis.data \t\t\t= options.data;\n\t\t\tthis.callbacks \t\t= options.callbacks;\n\t\t\tthis.toProceed \t\t= options.files.length;\n\t\t\tthis.inProgress \t= 0;\n\t\t\tthis.total \t\t\t= options.files.length;\n\t\t\tthis.totalLoaded \t= 0;\n\t\t\tthis.totalSize \t\t= 0;\n\t\t\tthis.totalPercent \t= 0;\n\t\t\tthis.current \t\t= 0;\n\t\t\tthis.fileRequests \t= stackList();\n\n\t\t\t/* Go through */\n\t\t\tfor(file of options.files)\n\t\t\t\tthis.totalSize += file.size;\n\n\t\t}\n\n\t\t/**\n\t\t * Get file name\n\t\t * @param {*} file File\n\t\t * @returns {string}\n\t\t */\n\t\tstatic getName(file) {\n\t\t\treturn file.name.replace(/.*(\\/|\\\\)/, \"\");\n\t\t}\n\n\t\t/**\n\t\t * Uploads file\n\t\t * @param {*} file File name in files stack\n\t\t */\n\t\tsend(file) {\n\n\t\t\t/* This obj will store data associated with XHR */\n\t\t\t$.extend(file, {\n\t\t\t\tid     : Math.random(),\n\t\t\t\tname   : this.getName(file.file),\n\t\t\t\tsize   : file.file.size,\n\t\t\t\tajax   : false,\n\t\t\t\tpercent: false,\n\t\t\t\tloaded : 0\n\t\t\t});\n\n\t\t\t/* Prepare params */\n\t\t\tlet self        = this,\n\t\t\t\tparams      = this.data || {},\n\t\t\t\tqueryString = this.url + \"?ajaxFile=\" + file.name + \"&\" + jQuery.param(params);\n\n\t\t\t/**\n\t\t\t * Params extend\n\t\t\t * @param {object} args Object to be extended\n\t\t\t * @returns {*}\n\t\t\t */\n\t\t\tthis.extend = function(args) {\n\t\t\t\treturn jQuery.extend(args, {\n\t\t\t\t\ttotalLoaded : self.totalLoaded,\n\t\t\t\t\ttotalSize   : self.totalSize,\n\t\t\t\t\ttotalPercent: self.totalPercent,\n\t\t\t\t\tfile        : file,\n\t\t\t\t\tloaded      : file.loaded,\n\t\t\t\t\tsize        : file.size,\n\t\t\t\t\tpercent     : file.percent,\n\t\t\t\t\ttoProceed   : self.toProceed,\n\t\t\t\t\tcurrent     : self.current,\n\t\t\t\t\ttotal       : self.total\n\t\t\t\t});\n\t\t\t};\n\n\t\t\t/* Send */\n\t\t\tif(supported.formData) {\n\n\t\t\t\t/* Create form data sender */\n\t\t\t\tlet form = new FormData();\n\t\t\t\tform.append(file.inputName, file.file);\n\n\t\t\t\t/* Send start */\n\t\t\t\tfile.ajax = ajax(queryString, form, { ajaxExtend: {\n\t\t\t\t\t\tprocessData: false,\n\t\t\t\t\t\tcontentType: false,\n\t\t\t\t\t\ttype       : \"POST\",\n\t\t\t\t\t\txhr        : (() => {\n\t\t\t\t\t\t\ttry {\n\n\t\t\t\t\t\t\t\t/* Create XHR */\n\t\t\t\t\t\t\t\tlet xhr = new XMLHttpRequest();\n\n\t\t\t\t\t\t\t\t/* Set special upload api handlers */\n\t\t\t\t\t\t\t\txhr.upload[\"onloadstart\"] = function() {\n\t\t\t\t\t\t\t\t\tthis.inProgress++;\n\t\t\t\t\t\t\t\t\tthis.callbacks.fire(\"begin\", this.extend({}));\n\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t\txhr.upload[\"onprogress\"] = function(event) {\n\t\t\t\t\t\t\t\t\tthis.totalLoaded += event.loaded - file.loaded;\n\t\t\t\t\t\t\t\t\tthis.totalPercent = (this.totalLoaded / this.totalSize * 100).toFixed(0);\n\t\t\t\t\t\t\t\t\tthis.onProgress(event, file);\n\t\t\t\t\t\t\t\t};\n\n\t\t\t\t\t\t\t\t/* Return create XHR */\n\t\t\t\t\t\t\t\treturn xhr;\n\n\t\t\t\t\t\t\t} catch(e) {\n\t\t\t\t\t\t\t\treturn undefined;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}).safe()\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t} else {\n\n\t\t\t\t/* Send start */\n\t\t\t\tfile.ajax = ajax(queryString, file.file, {\n\t\t\t\t\tprocessData: false,\n\t\t\t\t\tcontentType: false,\n\t\t\t\t\ttype       : \"POST\",\n\t\t\t\t\tbeforeSend : sky.func(function(jqXHR) {\n\t\t\t\t\t\tjqXHR.setRequestHeader(\"X-Requested-With\", \"XMLHttpRequest\");\n\t\t\t\t\t\tjqXHR.setRequestHeader(\"X-File-Name\", encodeURI(file.name));\n\t\t\t\t\t\tjqXHR.setRequestHeader(\"Content-Type\", \"multipart/form-data\");\n\t\t\t\t\t\tjqXHR.setRequestHeader(\"Content-Disposition\", 'attachment; filename=\"' + encodeURI(file.name) + '\"');\n\t\t\t\t\t\tjqXHR.setRequestHeader(\"Accept\", \"text/html,application/xhtml+xml,application/xml;q=0.9\");\n\t\t\t\t\t})\n\t\t\t\t});\n\n\t\t\t}\n\n\t\t\t/* Set ajax callbacks */\n\t\t\tfile.ajax.on({\n\t\t\t\tsuccess:\t(all) => { this.callbacks.fire(\"success\", this.extend(all)); },\n\t\t\t\terror: \t\t(all) => { this.callbacks.fire(\"error\", this.extend(all)); },\n\t\t\t\tnotSuccess: (all) => { this.callbacks.fire(\"notSuccess\", this.extend(all)); },\n\t\t\t\talways: \t(all) => {\n\n\t\t\t\t\t/* Counters */\n\t\t\t\t\tthis.inProgress--;\n\t\t\t\t\tthis.toProceed--;\n\n\t\t\t\t\t/* Call always method */\n\t\t\t\t\tthis.callbacks.fire(\"always\", this.extend(all));\n\n\t\t\t\t\t/* Delete connection */\n\t\t\t\t\tthis.fileRequests.delete(file);\n\n\t\t\t\t}\n\t\t\t});\n\n\t\t\t/* Save */\n\t\t\tthis.fileRequests.add(file);\n\n\t\t}\n\n\t\t/**\n\t\t * Fores on progress change\n\t\t * @param event\n\t\t * @param fileRequestData\n\t\t */\n\t\tonProgress(event, fileRequestData) {\n\n\t\t\t/* Count percentage */\n\t\t\tlet percent = (event.loaded / event[\"total\"] * 100).toFixed(0);\n\t\t\tfileRequestData.loaded = event.loaded;\n\n\t\t\t/* If percent changed */\n\t\t\tif(percent !== fileRequestData.percent && event[\"lengthComputable\"]) {\n\t\t\t\tfileRequestData.percent = percent;\n\t\t\t\tthis.callbacks.fire(\"progress\", this.extend({}));\n\t\t\t}\n\n\t\t}\n\n\t\t/**\n\t\t * Aborts current download\n\t\t */\n\t\tabort() {\n\n\t\t\t/* Stop each request */\n\t\t\tthis.fileRequests.each(request => { request.ajax.stop() });\n\n\t\t\t/* Call always method */\n\t\t\tthis.callbacks.fire(\"abort\", this.extend({}));\n\n\t\t}\n\n\t};\n\n});","sky.service(\"calendar\", [ \"templates\" ], function ({ templates }) {\n\n\t/* This class is for showing calendar to pick date on page */\n\tlet calendar = {\n\n\t\t/* Days set */\n\t\tmonthsNames: window.page.data.monthsNames || [\"\", \"\", \"\", \"\", \"\", \"\", \"\", \"\", \"\", \"\", \"\", \"\"],\n\n\t\trenderDays: function () {\n\n\t\t\t/* Clone */\n\t\t\tlet current = moment(this.date),\n\t\t\t\tweeks = [],\n\t\t\t\tcurrentWeek = false;\n\n\t\t\t/* From first */\n\t\t\tcurrent.date(1);\n\n\t\t\t/* Go through */\n\t\t\twhile (current.month() === this.date.month()) {\n\n\t\t\t\t/* Make week if new */\n\t\t\t\tif (!currentWeek || current.day() === 1) {\n\t\t\t\t\tcurrentWeek = {number: current.isoWeek(), days: []};\n\t\t\t\t\tweeks.push(currentWeek);\n\t\t\t\t}\n\n\t\t\t\t/* Push */\n\t\t\t\tcurrentWeek.days.push({date: current.clone(), dateStr: current.format(\"YYYY.MM.DD\"), day: current.day() === 0 ? 6 : current.day() - 1});\n\n\t\t\t\t/* Go next day */\n\t\t\t\tcurrent.add(1, \"d\");\n\n\t\t\t}\n\n\t\t\t/* Render */\n\t\t\tthis.dates.html('').append(templates.render(\"calendar-dates\", {\n\t\t\t\tweeks: weeks,\n\t\t\t\tdateStr: this.date.format(\"YYYY.MM.DD\"),\n\t\t\t\tcurrent: this.date,\n\t\t\t\tperiod: this.period,\n\t\t\t\tsince: this.since,\n\t\t\t\ttill: this.till\n\t\t\t}));\n\n\t\t\t/* Render */\n\t\t\tthis.setTime();\n\n\t\t},\n\n\t\t/**\n\t\t * When user picks date\n\t\t * @param {*} dayDiv Div that user clicked, if he did\n\t\t * @param notClose\n\t\t */\n\t\tdayPick: function (dayDiv, notClose) {\n\n\t\t\t/* Set date */\n\t\t\tif (dayDiv)\n\t\t\t\tthis.date.date(parseInt(dayDiv.html()));\n\n\t\t\tthis.field.val(this.getInputValue()).trigger(\"change\").trigger(\"keyup\");\n\t\t\tif (!notClose) this.close();\n\n\t\t},\n\n\t\tgetInputValue: function () {\n\n\t\t\t/* Get field new value */\n\t\t\tif (this.useTime)\n\t\t\t\treturn this.date.format(\"DD.MM.YYYY HH:mm\");\n\t\t\telse if (this.period && this.since.isSame(this.till))\n\t\t\t\treturn this.since.format(\"DD.MM.YYYY\");\n\t\t\telse if (this.period)\n\t\t\t\treturn this.since.format(\"DD.MM.YYYY\") + ' - ' + this.till.format(\"DD.MM.YYYY\");\n\n\t\t\t/* Default */\n\t\t\treturn this.date.format(\"DD.MM.YYYY\");\n\n\t\t},\n\n\t\tsetDayPick: function () {\n\t\t\tthis.pickedDateView.html(this.getInputValue());\n\t\t},\n\n\t\t/**\n\t\t * Position date picker\n\t\t * @param {*} field Item that we should position under\n\t\t */\n\t\tposition: function (field) {\n\n\t\t\tthis.holder.insertAfter(field.parent()).css({\n\t\t\t\tmarginTop: 0,\n\t\t\t\tmarginLeft: 0,\n\t\t\t\tposition: \"absolute\"\n\t\t\t}).css({\n\t\t\t\tmarginTop: field.offset().top - this.holder.offset().top + field.outerHeight() + 1,\n\t\t\t\tmarginLeft: field.offset().left - this.holder.offset().left + 1\n\t\t\t});\n\n\t\t},\n\n\t\t/**\n\t\t * Sets time inputs in calendar values\n\t\t */\n\t\tsetTime: function () {\n\n\t\t\t/* Set time */\n\t\t\tthis.holder.find(\".time .hour\").val(this.date.format(\"HH\"));\n\t\t\tthis.holder.find(\".time .minute\").val(this.date.format(\"mm\"));\n\n\t\t},\n\n\t\tperiodChangeDay: function () {\n\n\t\t\tlet reset = function () {\n\t\t\t\tcalendar.since = calendar.date.clone();\n\t\t\t\tcalendar.till = calendar.date.clone();\n\t\t\t\tcalendar.lastModified = \"none\"\n\t\t\t};\n\n\t\t\tif (this.date.isBefore(this.since)) {\n\t\t\t\tif (this.lastModified !== \"since\") {\n\t\t\t\t\tthis.since = this.date.clone();\n\t\t\t\t\tthis.lastModified = \"since\"\n\t\t\t\t}\n\t\t\t\telse reset();\n\t\t\t} else if (this.date.isAfter(this.till)) {\n\t\t\t\tif (this.lastModified !== \"till\") {\n\t\t\t\t\tthis.till = this.date.clone();\n\t\t\t\t\tthis.lastModified = \"till\"\n\t\t\t\t}\n\t\t\t\telse reset();\n\t\t\t} else if (this.date.isSame(this.till) || this.date.isSame(this.since))\n\t\t\t\treset();\n\t\t\telse {\n\t\t\t\tif (this.lastModified === \"since\") {\n\t\t\t\t\tthis.till = this.date.clone();\n\t\t\t\t\tthis.lastModified = \"till\"\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tthis.since = this.date.clone();\n\t\t\t\t\tthis.lastModified = \"since\"\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tcalendar.markSelected();\n\n\t\t},\n\n\t\tmarkSelected: function () {\n\n\t\t\tthis.dates.find(\".day\").removeClass(\"selected\").removeClass(\"subSelected\").each(function () {\n\n\n\t\t\t\tlet element = $(this),\n\t\t\t\t\tdate = calendar.date.clone().date(parseInt(element.html()));\n\n\t\t\t\tif (!calendar.period) {\n\t\t\t\t\tif (date.format(\"DD.MM.YYYY\") === calendar.date.format(\"DD.MM.YYYY\"))\n\t\t\t\t\t\telement.addClass(\"subSelected\");\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (date.isAfter(calendar.since) && date.isBefore(calendar.till))\n\t\t\t\t\telement.addClass(\"subSelected\");\n\t\t\t\telse if (date.isSame(calendar.since) || date.isSame(calendar.till))\n\t\t\t\t\telement.addClass(\"selected\");\n\n\t\t\t});\n\n\t\t},\n\n\t\t/**\n\t\t * Changes day\n\t\t * @param {*} element Day picker\n\t\t * @returns {undefined}\n\t\t */\n\t\tchangeDay: function (element) {\n\n\t\t\t/* If pick today */\n\t\t\tthis.date.date(parseInt(element.html()));\n\n\t\t\t/* No more for period */\n\t\t\tif (this.period) {\n\t\t\t\tthis.periodChangeDay();\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tcalendar.markSelected();\n\n\t\t\t/* Set time */\n\t\t\tif (this.field.attr(\"name\") === \"since\")\n\t\t\t\tthis.date.hour(0).minute(0);\n\t\t\telse if (this.date.format(\"DD-MM-YYYY\") === moment().format(\"DD-MM-YYYY\"))\n\t\t\t\tthis.date.hour(moment().hour()).minute(moment().minute());\n\t\t\telse\n\t\t\t\tthis.date.hour(23).minute(59);\n\n\t\t\t/* Pick */\n\t\t\tif (!this.useTime)\n\t\t\t\tthis.dayPick(element);\n\t\t\telse\n\t\t\t\tthis.setTime();\n\n\t\t},\n\n\t\t/**\n\t\t * Sets specified year\n\t\t * @param {int} year Year that need to be set\n\t\t */\n\t\tchangeYear: function (year) {\n\n\t\t\t/* Set year */\n\t\t\tthis.date.year(year);\n\n\t\t\t/* Update */\n\t\t\tthis.yearView.html(year);\n\n\t\t\t/* Dates redraw */\n\t\t\tthis.renderDays();\n\n\t\t},\n\n\t\t/**\n\t\t * Sets specified month\n\t\t * @param {int} month Month to be set\n\t\t */\n\t\tchangeMonth: function (month) {\n\n\t\t\t/* Set year */\n\t\t\tthis.date.month(month);\n\n\t\t\t/* Updates */\n\t\t\tthis.monthView.html(this.monthsNames[this.date.month()] + ' ' + this.date.year());\n\n\t\t\t/* Reload year */\n\t\t\tthis.changeYear(this.date.year());\n\n\t\t},\n\n\t\tgetDatePeriod: function (dateString) {\n\n\t\t\t// Split and get since\n\t\t\tlet parts = dateString.split('-'),\n\t\t\t\ttill,\n\t\t\t\tsince = this.getDate(parts[0].trim());\n\n\t\t\t// Get till\n\t\t\tif (parts.length > 1)\n\t\t\t\ttill = this.getDate(parts[1].trim());\n\t\t\telse\n\t\t\t\ttill = this.getDate(parts[0].trim());\n\n\t\t\t// Set inner lets\n\t\t\tthis.since = since;\n\t\t\tthis.till = till;\n\t\t\tthis.date = since.clone();\n\n\t\t},\n\n\t\t/**\n\t\t * Creates today date\n\t\t */\n\t\tgetDate: function (dateString) {\n\n\t\t\t/* Set calendar date */\n\t\t\tlet date = false;\n\n\t\t\t/* If input has datetime format value */\n\t\t\tif (dateString.match(/^\\d{4}-\\d{2}-\\d{2} \\d{1,2}:\\d{1,2}$/))\n\t\t\t\tdate = moment(dateString, \"YYYY-MM-DD HH:mm\");\n\n\t\t\t/* Id input has date format value */\n\t\t\tif (dateString.match(/^\\d{4}-\\d{2}-\\d{2}$/))\n\t\t\t\tdate = moment(dateString, \"YYYY-MM-DD\");\n\n\t\t\t/* Id input has date format value */\n\t\t\tif (dateString.match(/^\\d{2}.\\d{2}.\\d{4}$/))\n\t\t\t\tdate = moment(dateString, \"DD.MM.YYYY\");\n\n\t\t\t/* Id input has date format value */\n\t\t\tif (dateString.match(/^\\d{2}.\\d{2}.\\d{4} \\d{2}:\\d{2}$/))\n\t\t\t\tdate = moment(dateString, \"DD.MM.YYYY HH:mm\");\n\n\t\t\t/*  If still no */\n\t\t\tif (!date) {\n\t\t\t\tdate = moment();\n\n\t\t\t\t/* Set time */\n\t\t\t\tif (this.field.attr(\"name\") === \"since\")\n\t\t\t\t\tdate.hour(0).minute(0);\n\t\t\t}\n\n\t\t\t/* Reset time */\n\t\t\tif (!this.useTime)\n\t\t\t\tdate.hour(0).minute(0);\n\n\t\t\t/* Additional check */\n\t\t\treturn this.date = date;\n\n\t\t},\n\n\t\t/**\n\t\t * Closes windows\n\t\t */\n\t\tclose: function () {\n\n\t\t\t/* Remove calendar */\n\t\t\tif (this.holder)\n\t\t\t\tthis.holder.remove();\n\n\t\t\t/* Unset */\n\t\t\tif (this.field) {\n\t\t\t\tthis.field.off(\"keyup.calendar\");\n\t\t\t\tthis.field = false;\n\t\t\t}\n\t\t}\n\t};\n\n\tlet show = function (field, showTime) {\n\n\t\t/* Remove old calendars */\n\t\tthis.close();\n\n\t\t/* Begins from current date */\n\t\tthis.field = field;\n\t\tthis.period = false;\n\t\tthis.useTime = showTime ? showTime : false;\n\t\tthis.lastPicked = \"none\";\n\n\t\tif (field.is(\"input.datePeriod\")) {\n\t\t\tthis.period = true;\n\t\t\tthis.getDatePeriod(field.val());\n\t\t} else\n\t\t\tthis.getDate(field.val());\n\n\t\t/* Render */\n\t\tthis.holder = templates.render(\"calendar\", this);\n\n\t\t/* Actions */\n\t\tthis.holder\n\n\t\t/* Months changer */\n\t\t\t.action(\"click\", \".month .next\", function (event) {\n\t\t\t\tevent.preventDefault();\n\t\t\t\tcalendar.changeMonth(calendar.date.month() + 1);\n\t\t\t})\n\t\t\t.action(\"click\", \".month .prev\", function (event) {\n\t\t\t\tevent.preventDefault();\n\t\t\t\tcalendar.changeMonth(calendar.date.month() - 1);\n\t\t\t})\n\n\t\t\t/* Years */\n\t\t\t.action(\"click\", \".year .next\", function (event) {\n\t\t\t\tevent.preventDefault();\n\t\t\t\tcalendar.changeYear(calendar.date.year() + 1);\n\t\t\t})\n\t\t\t.action(\"click\", \".year .prev\", function (event) {\n\t\t\t\tevent.preventDefault();\n\t\t\t\tcalendar.changeYear(calendar.date.year() - 1);\n\t\t\t})\n\t\t\t.action(\"click\", \".setNow\", function (event) {\n\t\t\t\tevent.preventDefault();\n\t\t\t\tcalendar.date = moment();\n\t\t\t\tcalendar.renderDays();\n\t\t\t\tcalendar.setTime();\n\t\t\t})\n\t\t\t.action(\"click\", \".setToday\", function (event) {\n\t\t\t\tevent.preventDefault();\n\t\t\t\tcalendar.date = moment();\n\t\t\t\tcalendar.date.hour(0);\n\t\t\t\tcalendar.date.minute(0);\n\t\t\t\tcalendar.renderDays();\n\t\t\t\tcalendar.setTime();\n\t\t\t})\n\t\t\t.action(\"click\", \".setWeek\", function (event) {\n\t\t\t\tevent.preventDefault();\n\t\t\t\tcalendar.date = moment();\n\t\t\t\tcalendar.date.subtract(7, \"d\");\n\t\t\t\tcalendar.renderDays();\n\t\t\t\tcalendar.setTime();\n\t\t\t})\n\n\t\t\t/* Day */\n\t\t\t.action(\"click\", \".dates .day\", function (event) {\n\t\t\t\tevent.preventDefault();\n\t\t\t\tlet self = $(this);\n\n\t\t\t\tif (self.is(\".selected\") && !calendar.period)\n\t\t\t\t\tcalendar.dayPick($(this));\n\t\t\t\telse {\n\t\t\t\t\tcalendar.changeDay($(this));\n\t\t\t\t\tcalendar.dayPick(false, true);\n\t\t\t\t}\n\t\t\t})\n\n\t\t\t/* Apply button */\n\t\t\t.action(\"click\", \".apply\", function (event) {\n\t\t\t\tevent.preventDefault();\n\t\t\t\tcalendar.dayPick();\n\t\t\t})\n\n\t\t\t/* Time */\n\t\t\t.action(\"click\", \".time a\", function (event) {\n\t\t\t\tevent.preventDefault();\n\t\t\t\tcalendar.date.hour(moment().hour());\n\t\t\t\tcalendar.date.minute(moment().minute());\n\t\t\t\tcalendar.setTime();\n\t\t\t})\n\t\t\t.action(\"keyup\", \".time .hour\", function () {\n\t\t\t\tcalendar.date.hour(this.value);\n\t\t\t})\n\t\t\t.action(\"keyup\", \".time .minute\", function () {\n\t\t\t\tcalendar.date.minute(this.value);\n\t\t\t});\n\n\n\t\t/* Close and containers */\n\t\tthis.dates = this.holder.find(\".dates\");\n\t\tthis.yearView = this.holder.find(\".year .value\");\n\t\tthis.monthView = this.holder.find(\".month .value\");\n\t\tthis.pickedDateView = this.holder.find(\".pickedDate\");\n\n\t\t/* Refresh days */\n\t\tthis.renderDays();\n\n\t\t/* Reposition */\n\t\tthis.position(field);\n\t\tthis.setDayPick();\n\n\t\t/* Auto change */\n\t\tthis.field.on(\"keyup.calendar\", function () {\n\t\t\tshow(field, showTime);\n\t\t});\n\n\t\tlet dateOriginal;\n\t\tthis.dates.on(\"touchstart\", function (event) {\n\n\t\t\tlet element = $(event.target);\n\t\t\tif (!element.is(\".day\")) return;\n\t\t\tdateOriginal = calendar.date.clone().date(parseInt(element.html()));\n\n\t\t}).on(\"touchmove\", function (event) {\n\n\t\t\t/* No original event */\n\t\t\tevent.preventDefault();\n\n\t\t\tlet element = document.elementFromPoint((event.clientX || event.originalEvent.touches[0].clientX), (event.clientY || event.originalEvent.touches[0].clientY));\n\t\t\telement = $(element);\n\n\t\t\tif (!element.is(\".day\")) return;\n\n\t\t\tlet date = dateOriginal.clone().date(parseInt(element.html()));\n\n\t\t\tif (date.isBefore(dateOriginal)) {\n\t\t\t\tcalendar.since = date.clone();\n\t\t\t\tcalendar.till = dateOriginal.clone();\n\t\t\t} else {\n\t\t\t\tcalendar.since = dateOriginal.clone();\n\t\t\t\tcalendar.till = date.clone();\n\t\t\t}\n\t\t\tcalendar.lastModified = \"none\";\n\t\t\tcalendar.markSelected();\n\t\t\t// $(this).trigger(\"click\");\n\n\t\t});\n\n\t}.bind(calendar);\n\n\t/* Return */\n\tthis.service = show;\n\n});\n\nsky.onReady(({calendar}) => {\n\n\t/* Calendar show */\n\t$(document).action(\"click.calendar\", function (event) {\n\n\t\t/* Get element */\n\t\tlet element = $(event.target || event.srcElement);\n\n\t\t/* Remove calendar */\n\t\tif (!element.is(\".calendar\") && !element.parents(\".calendar\").length)\n\t\t\t$(\".calendar\").remove();\n\n\t\t/* Calendar show */\n\t\tif (element.is(\"input.date\"))\n\t\t\tcalendar(element);\n\n\t\t/* Calendar show */\n\t\tif (element.is(\"input.datePeriod\"))\n\t\t\tcalendar(element, false, true);\n\n\t\t/* Calendar show */\n\t\tif (element.is(\"input.datetime\"))\n\t\t\tcalendar(element, true);\n\n\t\t/* Calendar show */\n\t\tif (element.is(\"input.datehour\"))\n\t\t\tcalendar(element, true);\n\n\t}).action(\"keydown.calendar\", function (event) {\n\t\tif (event.keyCode === 13) {\n\t\t\tlet calendars = $(\".calendar\");\n\t\t\tif (calendars.length) {\n\t\t\t\tcalendars.find(\".day.selected\").trigger(\"click\");\n\t\t\t\tevent.preventDefault();\n\t\t\t}\n\t\t}\n\t});\n});","sky.service(\"callback\", function() {\n\n\t/**\n\t * Creates callback object that holds functions list\n\t * @param {string} [flags]\n\t * @returns {*}\n\t * @constructor\n\t */\n\tlet Callback = function(flags) {\n\n\t\t/* Self construct */\n\t\tif(!(this instanceof Callback))\n\t\t\treturn new Callback(flags);\n\n\t\t/**\n\t\t * Functions list holder\n\t\t * @type {Array}\n\t\t */\n\t\tthis.functions = [];\n\t\tthis.toRun =  0;\n\t\tthis.context = this;\n\n\t\t/* Self return for next usage */\n\t\treturn this;\n\n\t};\n\n\t/**\n\t * Base\n\t * @type {{functions: Array, toRun: number, context: *, add: add, removeByContext: removeByContext, fire: fire, fireNext: fireNext}}\n\t */\n\tCallback.prototype = {\n\n\t\t/**\n\t\t * Adds new function to stack\n\t\t * @param {Function} func Function to add\n\t\t * @param {Object} context Function context\n\t\t * @param {Object} options Call options\n\t\t */\n\t\tadd: function(func, context, options) {\n\t\t\tthis.functions.push({\n\t\t\t\tfunc: func,\n\t\t\t\tcontext: context || false,\n\t\t\t\tonce: options && options.once\n\t\t\t});\n\t\t\treturn this;\n\t\t},\n\n\t\t/**\n\t\t * Removes function from list by context\n\t\t * @param context\n\t\t */\n\t\tremoveByContext: function(context) {\n\n\t\t\t/* Find listener */\n\t\t\t$.each(this.functions, function(i, current) {\n\t\t\t\tif(current.context === context)\n\t\t\t\t\tthis.functions.splice(i, 1);\n\t\t\t}.bind(this));\n\n\t\t\t/* Self return */\n\t\t\treturn this;\n\n\t\t},\n\n\t\t/**\n\t\t * Removes function from list by context\n\t\t * @param func\n\t\t */\n\t\tremoveByCallback: function(func) {\n\n\t\t\t/* Find listener */\n\t\t\t$.each(this.functions, function(i, current) {\n\t\t\t\tif(current.func === func)\n\t\t\t\t\tthis.functions.splice(i, 1);\n\t\t\t}.bind(this));\n\n\t\t\t/* Self return */\n\t\t\treturn this;\n\n\t\t},\n\n\t\t/**\n\t\t * Fires all functions\n\t\t * @param {Object} context Function context\n\t\t * @param {Array} args Arguments\n\t\t */\n\t\tfire: function(context, args) {\n\t\t\t$.each(this.functions, function(_, func) {\n\t\t\t\tfunc.func.apply(func.context || context, args);\n\t\t\t});\n\t\t},\n\n\t\t/**\n\t\t * Fires next function\n\t\t * @param {Array|Object} args Arguments\n\t\t * @param {Object} context Function context\n\t\t */\n\t\tfireNext: function(args, context) {\n\n\t\t\t/* If no more to run */\n\t\t\tif(this.functions.length <= this.toRun)\n\t\t\t\treturn false;\n\n\t\t\t/* Set next to run */\n\t\t\tthis.toRun++;\n\n\t\t\t/* Function to run */\n\t\t\tlet current = this.functions[this.toRun - 1],\n\t\t\t\tresult,\n\t\t\t\tfunc = current.func;\n\n\t\t\t/* Set context */\n\t\t\tcontext = current.context || context || window;\n\n\t\t\t/* Get function in string */\n\t\t\tif(typeof func === \"string\")\n\t\t\t\tfunc = context[func];\n\n\t\t\t/* If no function found */\n\t\t\tif(!func)\n\t\t\t\treturn true;\n\n\t\t\t/* Call function */\n\t\t\tresult =  func.apply(current.context || context, args) !== false;\n\n\t\t\t/* If call once */\n\t\t\tif(current.once) {\n\t\t\t\tthis.functions.splice(this.toRun - 2, 1);\n\t\t\t\tthis.toRun--;\n\t\t\t}\n\n\t\t\t/* Return function result */\n\t\t\treturn result;\n\t\t}\n\n\t};\n\n\tthis.service = Callback;\n\n});","sky.service(\"callbacks\", [\"callback\"], function({ callback }) {\n\n\t/**\n\t *\n\t * Callbacks prepared object\n\t * @param {*} [flags] Flags list for jQuery.Callbacks\n\t * @constructor\n\t */\n\tlet Callbacks = function(flags) {\n\n\t\t/* Self construction */\n\t\tif(!(this instanceof Callbacks))\n\t\t\treturn new Callbacks(flags);\n\n\t\t/* Add properties */\n\t\t$.extend(true, this, Callbacks.extend);\n\n\t\t/* Callbacks list */\n\t\tthis.advancedCallbacks = {};\n\n\t\t/* Set default flags and self context */\n\t\treturn this.flags(flags);\n\n\t};\n\n\t/**\n\t * Prototype\n\t * @type {{on: on, fire: fire, off: off, flags: flags, setContext: setContext}}\n\t */\n\tCallbacks.prototype = {\n\n\t\t\t/**\n\t\t\t * Flags for sky.Callback\n\t\t\t * @param {object} flags Flags list\n\t\t\t * @returns {*}\n\t\t\t */\n\t\t\tflags: function(flags) {\n\t\t\t\tthis.callbacksFlags = flags;\n\t\t\t\treturn this;\n\t\t\t},\n\n\t\t\t/**\n\t\t\t * Remove by listener\n\t\t\t * @param {string} name Event name\n\t\t\t * @param {string} listener Listener object\n\t\t\t */\n\t\t\tremoveListener: function(name, listener) {\n\t\t\t\tif(this.advancedCallbacks[name]) {\n\t\t\t\t\tthis.advancedCallbacks[name].removeByContext(listener);\n\t\t\t\t}\n\t\t\t},\n\n\t\t\t/**\n\t\t\t * Adds new event handler\n\t\t\t * @param {string} \t name \t\t\tName of event\n\t\t\t * @param {function|string} func \tFunction be called on event fires\n\t\t\t * @param {object}   [context]\t\tFunction options\n\t\t\t * @param {object}   [options]\t\tFunction options\n\t\t\t */\n\t\t\ton:  function(name, func, context, options) {\n\n\n\t\t\t\tif(name instanceof Object)\n\t\t\t\t\t$.each(name, (event, func) => { this.on(event, func) });\n\n\t\t\t\telse $.each(this.getEventsNames(name), (_, name) => {\n\n\t\t\t\t\t/* Create callbacks */\n\t\t\t\t\tif(!this.advancedCallbacks[name])\n\t\t\t\t\t\tthis.advancedCallbacks[name] = callback(this.callbacksFlags);\n\n\t\t\t\t\t/* Add function */\n\t\t\t\t\tthis.advancedCallbacks[name].add(func, context ? context : self.context, options || {});\n\n\t\t\t\t});\n\n\t\t\t\treturn this;\n\t\t\t},\n\n\t\t\t/**\n\t\t\t * Fires callbacks for specified event\n\t\t\t * @param {string} name Name of event\n\t\t\t * @param {object} args Arguments to be passed\n\t\t\t * @param {object} [options] Additional options\n\t\t\t */\n\t\t\tfire: function(name, args, options) {\n\n\t\t\t\t/* Success last */\n\t\t\t\tlet events = this.getEventsNames(name),\n\t\t\t\t\tself = this,\n\t\t\t\t\tnext = false;\n\t\t\t\t\toptions = options || {};\n\n\t\t\t\t/* Remove global if need */\n\t\t\t\tif(options[\"noGlobal\"])\n\t\t\t\t\tevents = events.slice(1);\n\n\t\t\t\t/* Fire events */\n\t\t\t\t$.each(events, function(_, event) {\n\n\t\t\t\t\t/* If no callback */\n\t\t\t\t\tif(!self.advancedCallbacks[event])\n\t\t\t\t\t\treturn;\n\n\t\t\t\t\t/* Run */\n\t\t\t\t\tdo {\n\t\t\t\t\t\tnext = self.advancedCallbacks[event].fireNext(jQuery.extend({ event: event }, args || []), self.context, options.possible);\n\t\t\t\t\t} while(next);\n\n\t\t\t\t\t/* Reset */\n\t\t\t\t\tif(!options.once)\n\t\t\t\t\t\tself.advancedCallbacks[event].toRun = 0;\n\n\t\t\t\t});\n\n\t\t\t},\n\n\t\t\t/**\n\t\t\t * Get all event names from global name\n\t\t\t * @param {String} name Global event name\n\t\t\t * @returns {Array}\n\t\t\t */\n\t\t\tgetEventsNames: function(name) {\n\n\t\t\t\t/* Get events names */\n\t\t\t\tlet names = name.split(\",\"), events = [];\n\n\t\t\t\t/* Go through */\n\t\t\t\t$.each(names, function(i, name) {\n\n\t\t\t\t\t/* Remove spaces */\n\t\t\t\t\tname = name.replace(\" \", \"\");\n\n\t\t\t\t\t/* Get elements */\n\t\t\t\t\tlet elements = name.split(\".\");\n\t\t\t\t\tevents.push(elements[0]);\n\n\t\t\t\t\t/* Go through */\n\t\t\t\t\tfor(let j = 1; j < elements.length; j++)\n\t\t\t\t\t\tevents.push(elements[0] + \".\" + elements[j]);\n\n\t\t\t\t\t/* Global event */\n\t\t\t\t\tif(elements.length > 2)\n\t\t\t\t\t\tevents.push(elements.join(\".\"));\n\n\t\t\t\t});\n\n\t\t\t\t/* Return */\n\t\t\t\treturn events;\n\n\t\t\t},\n\n\t\t/**\n\t\t * Removes event handlers and functions\n\t\t * @param {string} name Event name\n\t\t * @param func\n\t\t */\n\t\t\toff: function(name, func = null) {\n\t\t\t\tif(func && this.advancedCallbacks[name])\n\t\t\t\t\tthis.advancedCallbacks[name].removeByCallback(func);\n\t\t\t\telse\n\t\t\t\t\tdelete this.advancedCallbacks[name];\n\t\t\t}\n\n\t\t};\n\n\t\tthis.service = Callbacks;\n\n});","sky.service(\"dataOperator\", [ \"inputsIO\", \"notifications\", \"templates\", \"utils\", \"ajax\", \"actions\" ], function ({ inputsIO, notifications, templates, utils, ajax, actions }) {\n\n\tclass searchField {\n\t\tconstructor(name, virtual) {\n\t\t\tthis.name = name;\n\t\t\tthis.inputName = name;\n\t\t\tthis.virtual = virtual || false;\n\t\t\tthis.default = null;\n\t\t\tthis.input = false;\n\t\t\tthis.value = null;\n\t\t}\n\t\tvalueOrNullOnDefault() {\n\t\t\tif ((this.default instanceof Array) && (this.value instanceof Array))\n\t\t\t\treturn utils.isObjectsEqual(this.value, this.default) ? null : this.value;\n\n\t\t\treturn this.value === this.default ? null : this.value;\n\t\t}\n\t\tread() {\n\t\t\tif (this.virtual === \"search\")\n\t\t\t\treturn this.searchRead();\n\t\t\telse if (this.virtual)\n\t\t\t\treturn this.hashRead();\n\t\t\telse if (this.input)\n\t\t\t\tthis.value = inputsIO.readInputsValues(this.input);\n\n\t\t\treturn this.value;\n\t\t}\n\t\twrite() {\n\t\t\tif (this.input)\n\t\t\t\tinputsIO.writeInputsValue(this.value === null ? this.default : this.value, this.input);\n\t\t\treturn this.value;\n\t\t}\n\t\thashRead() {\n\t\t\tlet hashValue = page.history.hashObject[this.name];\n\t\t\treturn this.value = (typeof hashValue === \"undefined\") ? this.default : hashValue;\n\t\t}\n\t\tsearchRead () {\n\t\t\tlet searchValue = page.history.searchObject[this.name];\n\t\t\treturn this.value = (typeof searchValue === \"undefined\") ? this.default : searchValue;\n\t\t}\n\t}\n\n\t/**\n\t * Default options\n\t * @type {{}}\n\t */\n\tlet baseOptions = {\n\t\tfields: {},\n\t\thistoryType: \"hash\"\n\t};\n\n\t/* Creates new data operator */\n\tclass DataOperator {\n\t\tconstructor(options) {\n\n\t\t\t/* Stores last request object */\n\t\t\tthis.lastRequestData = false;\n\n\t\t\t/* Func that calls before request */\n\t\t\tthis.beforeRequest = false;\n\t\t\t\n\t\t\t/* Fields list */\n\t\t\tthis.fields = {};\n\n\t\t\t/* Add base options, but only not set, that's why so fun construction */\n\t\t\tthis.options = $.extend({}, baseOptions, true);\n\n\t\t\t/* Options init */\n\t\t\tthis.setOptions(options);\n\n\t\t}\n\n\t\t/** Saves to options */\n\t\tsetOptions(options) {\n\n\t\t\t/* Back link */\n\t\t\tlet self = this;\n\n\t\t\t/* Set submit handler */\n\t\t\tif (options.form)\n\t\t\t\t$(options.form).action(\"submit\", this.onFormSubmit.bind(this));\n\n\t\t\t/* Add to options */\n\t\t\t$.extend(this.options, options, true);\n\n\t\t\t/* Self return */\n\t\t\treturn this;\n\t\t}\n\n\t\t/**\n\t\t * On form submit\n\t\t * @param event\n\t\t */\n\t\tonFormSubmit(event) {\n\n\t\t\t/* Prevent */\n\t\t\tevent.preventDefault();\n\n\t\t\t/* If form not valid */\n\t\t\tif (!$(this.options.form).validForm())\n\t\t\t\treturn;\n\n\t\t\tlet options = {force: true};\n\n\t\t\tif (this.fields[\"page\"])\n\t\t\t\toptions[this.options.historyType === \"search\" ? \"search\" : \"hash\"] = {page: 1};\n\n\t\t\t/* Update */\n\t\t\tthis.reload(options);\n\n\t\t}\n\n\t\tprepareRequest(options) {\n\n\t\t\t/* On empty */\n\t\t\toptions = options || {};\n\n\t\t\t/* Hash fields */\n\t\t\tif (options[\"hash\"])\n\t\t\t\tpage.history.set(options[\"hash\"]);\n\n\t\t\t/* Hash fields */\n\t\t\tif (options[\"search\"])\n\t\t\t\tpage.history.search(options[\"search\"]);\n\n\t\t\t/* Hash fields */\n\t\t\tif (options[\"virtual\"]) {\n\t\t\t\tif (this.options.historyType === \"search\")\n\t\t\t\t\tpage.history.search(options[\"virtual\"]);\n\t\t\t\telse\n\t\t\t\t\tpage.history.set(options[\"virtual\"]);\n\t\t\t}\n\n\t\t\t/* Write to form from hash */\n\t\t\tif (options.fromUrl) {\n\t\t\t\tif (this.options.historyType === \"search\")\n\t\t\t\t\tthis.readSearch().writeForm();\n\t\t\t\telse\n\t\t\t\t\tthis.readHash().writeForm();\n\t\t\t}\n\n\t\t\t/* jQuery wrap */\n\t\t\tif (this.options.form && !$(this.options.form).validForm())\n\t\t\t\treturn false;\n\n\t\t\t/* Read */\n\t\t\tlet data = this.read();\n\n\t\t\t/* Add additional data */\n\t\t\tif (this.options[\"requestData\"])\n\t\t\t\tdata = $.extend(data, this.options[\"requestData\"]);\n\n\t\t\t/* Check is same and no force requested */\n\t\t\tif (this.lastRequestData !== false && utils.isObjectsEqual(this.lastRequestData, data) && !options[\"force\"])\n\t\t\t\treturn false;\n\n\t\t\t/* Set hash data */\n\t\t\tif (!options.fromUrl && this.options.historyType === \"search\")\n\t\t\t\tthis.writeSearch();\n\t\t\telse if (!options.fromUrl)\n\t\t\t\tthis.writeHash();\n\n\t\t\t/* Before request call */\n\t\t\tif (this.beforeRequest)\n\t\t\t\tif (this.beforeRequest(data, options) === false)\n\t\t\t\t\treturn false;\n\n\t\t\t/* Return data */\n\t\t\treturn data;\n\n\t\t}\n\n\t\t/**\n\t\t * Reloads data according to params\n\t\t * @param options\n\t\t * @returns {DataOperator}\n\t\t */\n\t\treload(options) {\n\n\t\t\t/* Prepare */\n\t\t\tlet data = this.prepareRequest(options);\n\n\t\t\t/* Reload */\n\t\t\tif (data)\n\t\t\t\tthis.request(data);\n\n\t\t\t/* Self return */\n\t\t\treturn this;\n\n\t\t}\n\n\t\t/**\n\t\t * Performs request to reload data\n\t\t * @param data\n\t\t */\n\t\trequest(data) {\n\n\t\t\t/* Back link */\n\t\t\tlet self = this;\n\n\t\t\t/* Save last data */\n\t\t\tself.lastRequestData = data;\n\n\t\t\t/* Stop old request */\n\t\t\tif (this.ajax)\n\t\t\t\tthis.ajax.stop();\n\n\t\t\t/* Request */\n\t\t\tthis.ajax = ajax(this.options.url, data)\n\t\t\t\t.on(\"success\", function (response) {\n\t\t\t\t\tself.lastResponse = response;\n\t\t\t\t\tself.render(response, data);\n\t\t\t\t})\n\t\t\t\t.on(\"error\", function (error) {\n\t\t\t\t\tself.error(error)\n\t\t\t\t})\n\t\t\t\t.on(\"always\", function () {\n\t\t\t\t\tself.ajax = false;\n\t\t\t\t});\n\n\t\t\t/* Create loading, auto remove when ajax finishes */\n\t\t\tnotifications.loading(this.ajax).reloadContent(this.options.holder);\n\n\t\t}\n\n\t\t/**\n\t\t * On success, have to be overloaded\n\t\t * @param data\n\t\t * @param request\n\t\t */\n\t\trender(data, request) {}\n\n\t\t/**\n\t\t * On error, have to be overloaded\n\t\t * @param error\n\t\t */\n\t\terror(error) {}\n\n\t\t/**\n\t\t * Adds list of fields to current list\n\t\t * @param {Array} list List of names\n\t\t * @param {Boolean} [virtual] Virtual fields flag\n\t\t */\n\t\tfieldsList(list, virtual) {\n\n\t\t\t/* Back link */\n\t\t\tlet self = this;\n\n\t\t\t/* Go through and push */\n\t\t\t$.each(list, function (_, item) {\n\t\t\t\tself.options.fields[item] = virtual;\n\t\t\t});\n\n\t\t\t/* Self return */\n\t\t\treturn this;\n\t\t\t\n\t\t}\n\n\t\t/**\n\t\t * Sets form fields\n\t\t * @param list\n\t\t * @returns {*}\n\t\t */\n\t\trealFieldsList(list) {\n\t\t\treturn this.fieldsList(list);\n\t\t}\n\n\t\t/**\n\t\t * Set none forms fields\n\t\t * @param list\n\t\t * @returns {*}\n\t\t */\n\t\tvirtualFieldsList(list) {\n\t\t\treturn this.fieldsList(list, true);\n\t\t}\n\n\t\t/**\n\t\t * Reads real fields\n\t\t * @returns {{}}\n\t\t */\n\t\treadReal() {\n\n\t\t\t/* Data holder */\n\t\t\tlet data = {};\n\n\t\t\t/* Go through */\n\t\t\t$.each(this.fields, function (i, field) {\n\t\t\t\t/** @let field searchField */\n\n\t\t\t\tif (field.virtual)\n\t\t\t\t\treturn;\n\n\t\t\t\t/* Read */\n\t\t\t\tfield.read();\n\n\t\t\t\t/* Get non default or null */\n\t\t\t\tlet val = field.valueOrNullOnDefault();\n\n\t\t\t\t/* If value not same as default */\n\t\t\t\tif (val !== null)\n\t\t\t\t\tdata[field.name] = val;\n\n\t\t\t});\n\n\t\t\t/* Self return */\n\t\t\treturn data;\n\n\t\t}\n\n\t\t/** Reads form to fields */\n\t\tread() {\n\n\t\t\t/* Data holder */\n\t\t\tlet data = {};\n\n\t\t\t/* Go through */\n\t\t\t$.each(this.fields, function (i, field) {\n\t\t\t\t/** @let field searchField */\n\n\t\t\t\t/* Read */\n\t\t\t\tfield.read();\n\n\t\t\t\t/* Get non default or null */\n\t\t\t\tlet val = field.valueOrNullOnDefault();\n\n\t\t\t\t/* If value not same as default */\n\t\t\t\tif (val !== null)\n\t\t\t\t\tdata[field.name] = val;\n\n\t\t\t});\n\n\t\t\t/* Self return */\n\t\t\treturn data;\n\t\t}\n\n\t\t/** Write current field to form */\n\t\twriteForm() {\n\t\t\t$.each(this.fields, function (i, field) {\n\t\t\t\t/** @let field searchField */\n\t\t\t\tfield.write();\n\t\t\t});\n\n\t\t\t/* Self return */\n\t\t\treturn this;\n\t\t}\n\n\t\t/** Reads hash to fields */\n\t\treadHash() {\n\t\t\t$.each(this.fields, function (i, field) {\n\t\t\t\t/** @let field searchField */\n\t\t\t\tfield.hashRead();\n\t\t\t});\n\n\t\t\t/* Self return */\n\t\t\treturn this;\n\t\t}\n\n\t\t/** Reads hash to fields */\n\t\treadSearch() {\n\t\t\t$.each(this.fields, function (i, field) {\n\t\t\t\t/** @let field searchField */\n\t\t\t\tfield.searchRead();\n\t\t\t});\n\n\t\t\t/* Self return */\n\t\t\treturn this;\n\t\t}\n\n\t\t/** Writes current fields to hash */\n\t\twriteHash() {\n\n\t\t\t/* To write */\n\t\t\tlet write = {};\n\n\t\t\t/* Go through */\n\t\t\t$.each(this.fields, function (i, field) {\n\t\t\t\t/** @let field searchField */\n\t\t\t\twrite[field.name] = field.valueOrNullOnDefault();\n\t\t\t});\n\n\t\t\t/* Write to hash */\n\t\t\tpage.history.set(write);\n\n\t\t\t/* Self return */\n\t\t\treturn this;\n\t\t}\n\n\t\t/** Writes current fields to hash */\n\t\twriteSearch() {\n\n\t\t\t/* To write */\n\t\t\tlet write = {};\n\n\t\t\t/* Go through */\n\t\t\t$.each(this.fields, function (i, field) {\n\t\t\t\t/** @let field searchField */\n\t\t\t\twrite[field.name] = field.valueOrNullOnDefault();\n\t\t\t});\n\n\t\t\t/* Write to hash */\n\t\t\tpage.history.search(write);\n\n\t\t\t/* Self return */\n\t\t\treturn this;\n\n\t\t}\n\n\t\t/** Finds inputs associated with fields */\n\t\tinitInputs() {\n\n\t\t\t/* Back link */\n\t\t\tlet self = this;\n\n\t\t\t$.each(this.options.fields, function (fieldName, virtual) {\n\n\t\t\t\t// Create search field\n\t\t\t\tlet field = new searchField(fieldName, virtual ? self.options.historyType : false);\n\n\t\t\t\t/** @let field searchField */\n\t\t\t\tif (!field.virtual) {\n\n\t\t\t\t\t/* Find input */\n\t\t\t\t\tif (field.name[0] === \"*\") {\n\t\t\t\t\t\tfield.name = field.name.substring(1);\n\t\t\t\t\t\tfield.input = $(self.options.form).find(\".selectReplaceChoose[data-input=\" + field.name + \"]\");\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t\tfield.input = $(self.options.form).find('[name=\"' + field.name + '\"]');\n\n\t\t\t\t\t/* Remove fields without input */\n\t\t\t\t\tif (!field.input || !field.input.length) {\n\t\t\t\t\t\tdelete self.fields[fieldName];\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\t/* Save */\n\t\t\t\t\tself.fields[fieldName] = field;\n\n\t\t\t\t\t/* Read default */\n\t\t\t\t\tfield.default = field.read();\n\t\t\t\t\tfield.value = null;\n\t\t\t\t} else {\n\t\t\t\t\tif (self.options.historyType === \"search\")\n\t\t\t\t\t\tfield.virtual = \"search\";\n\t\t\t\t\tself.fields[fieldName] = field;\n\t\t\t\t}\n\t\t\t});\n\n\t\t\t/* Self return */\n\t\t\treturn this;\n\t\t}\n\t};\n\n\t/* Interface */\n\tthis.service = {\n\t\tinitOperator: options => new DataOperator(options),\n\t\tsearchField: searchField,\n\t\tinitLoader: function (loader, notifications, pagination, { reload = true, history = true }) {\n\n\t\t\t/* Add count */\n\t\t\tloader.beforeRequest = function (data, options) {\n\t\t\t\tif (!this.lastRequestData || options.force)\n\t\t\t\t\tdata[\"count\"] = true;\n\t\t\t};\n\n\t\t\t/* Render function */\n\t\t\tloader.render = function (response) {\n\n\t\t\t\t// Re render\n\t\t\t\t$(this.options.holder).html('').append(\n\t\t\t\t\ttemplates.render(\"page-result-render\", response)\n\t\t\t\t);\n\n\t\t\t\t// Remove old\n\t\t\t\tif (this.pagination)\n\t\t\t\t\tthis.pagination = this.pagination.remove();\n\n\t\t\t\tif (typeof response.pages !== \"undefined\") {\n\n\t\t\t\t\t// Pages holder\n\t\t\t\t\tlet holder = $(\"#pages\").html('');\n\n\t\t\t\t\t// Create new\n\t\t\t\t\tif (response.pages > 1 && pagination) {\n\t\t\t\t\t\tthis.pagination = pagination.add({\n\t\t\t\t\t\t\tpages: response.pages,\n\t\t\t\t\t\t\tcurrent: response.page,\n\t\t\t\t\t\t\tholder: holder\n\t\t\t\t\t\t});\n\t\t\t\t\t\tthis.pagination.onPageChange = function (pageNum) {\n\t\t\t\t\t\t\tloader.reload({virtual: {page: pageNum}});\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t};\n\n\t\t\t/* On loading error */\n\t\t\tloader.error = function (error) {\n\n\t\t\t\t// Remove pagination on error\n\t\t\t\tif (this.pagination)\n\t\t\t\t\tthis.pagination = this.pagination.remove();\n\n\t\t\t\t// Clear\n\t\t\t\t$(this.options.holder).html('').append(notifications.message({text: error}).render);\n\t\t\t};\n\n\t\t\t/* Reload */\n\t\t\tif (reload)\n\t\t\t\tloader.reload({fromUrl: true});\n\n\t\t\t/* Set handler */\n\t\t\tif (history)\n\t\t\t\tpage.history.on(\"change\", function (searchChanged, hashChanged) {\n\t\t\t\t\tif (searchChanged || hashChanged)\n\t\t\t\t\t\tloader.reload({fromUrl: true});\n\t\t\t\t});\n\n\t\t}\n\t}\n\n});","sky.service(\"directives\", [\"exceptions\"], function ({exceptions}) {\n\n\tlet list = {},\n\t\tdirectives = this.service = {\n\n\t\t\t/**\n\t\t\t * Adds new directive\n\t\t\t * @param {string} name Directive name\n\t\t\t * @param {*} options Directive options\n\t\t\t * @param {function} directive How to parse directive\n\t\t\t */\n\t\t\tadd: function (name, options, directive) {\n\n\t\t\t\t/* Reset */\n\t\t\t\tif (!directive && typeof options === \"function\") {\n\t\t\t\t\tdirective = options;\n\t\t\t\t\toptions = {};\n\t\t\t\t}\n\t\t\t\toptions.directive = directive;\n\t\t\t\toptions.selector = name;\n\n\t\t\t\t/* Save */\n\t\t\t\tlist[name] = options;\n\n\t\t\t\t/* Self return*/\n\t\t\t\treturn this;\n\n\t\t\t},\n\n\t\t\t/**\n\t\t\t * Get element attributes\n\t\t\t * @param element\n\t\t\t * @returns {{}}\n\t\t\t */\n\t\t\tgetAttributes: function (element) {\n\n\t\t\t\t/* Holds attributes */\n\t\t\t\tlet attributes = {};\n\n\t\t\t\t/* Copy them to list */\n\t\t\t\t$.each(element.get(0).attributes, function (_, attr) {\n\t\t\t\t\tattributes[attr.nodeName] = attr.nodeValue;\n\t\t\t\t});\n\n\t\t\t\t/* Return */\n\t\t\t\treturn attributes;\n\n\t\t\t},\n\n\t\t\t/**\n\t\t\t * Applies directive convert to element\n\t\t\t * @param element\n\t\t\t * @param options\n\t\t\t */\n\t\t\tparseElement: function (element, options) {\n\n\t\t\t\t/* Get element */\n\t\t\t\telement = $(element);\n\n\t\t\t\t/* Get element attributes */\n\t\t\t\tlet attributes = this.getAttributes(element);\n\n\t\t\t\t/* Parse body for jason data */\n\t\t\t\tif (options[\"json\"] || options[\"jsonToData\"]) {\n\n\t\t\t\t\t/* Get child */\n\t\t\t\t\tlet jsonScript = element.children('script[type=\"application/json\"]');\n\n\t\t\t\t\t/* If we have json encoded data */\n\t\t\t\t\tif (jsonScript.length) {\n\n\t\t\t\t\t\ttry {\n\n\t\t\t\t\t\t\t/* Parse json */\n\t\t\t\t\t\t\tlet json = JSON.parse(jsonScript.text());\n\n\t\t\t\t\t\t\t/* Extend */\n\t\t\t\t\t\t\t$.extend(attributes, json);\n\n\t\t\t\t\t\t\t/* Save to data */\n\t\t\t\t\t\t\tif (options[\"jsonToData\"])\n\t\t\t\t\t\t\t\telement.data(\"json\", json);\n\n\t\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\t\tthrow new exceptions.system.Error(\"Element \" + options.selector + \" should have json stored content, but error on parse appears\");\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t/* Call parse function */\n\t\t\t\tif (typeof options.directive === \"function\")\n\t\t\t\t\toptions.directive(element, attributes);\n\t\t\t},\n\n\t\t\t/**\n\t\t\t * Searches and replaces directives in element\n\t\t\t * @param element\n\t\t\t */\n\t\t\tparse: function (element) {\n\t\t\t\t$.each(list, function (tag, options) {\n\t\t\t\t\t$(tag, element).each(function () {\n\t\t\t\t\t\tdirectives.parseElement(this, options);\n\t\t\t\t\t});\n\t\t\t\t\tif (element.is(tag))\n\t\t\t\t\t\tdirectives.parseElement(element, options);\n\t\t\t\t});\n\t\t\t}\n\n\n\t\t};\n\n\t/* Add jQuery fn */\n\tjQuery.fn.parseDirectives = function () {\n\n\t\t/* Parse */\n\t\tdirectives.parse(this);\n\n\t\t/* Return */\n\t\treturn this;\n\n\t};\n\n\t/* Parse body for directives when all ready */\n\tsky.onReady(function () {\n\t\t$(\"body\").parseDirectives();\n\t});\n\n});","sky.service(\"drag\", [\"callbacks\"], function({callbacks}) {\n\tlet self = {\n\t\tbindEvents: (event, events) => {\n\t\t\tself.bind(event)\n\t\t\t\t.on(\"start\", events.start)\n\t\t\t\t.on(\"move\", events.move)\n\t\t\t\t.on(\"stop\", events.stop)\n\t\t},\n\t\tbind: event => {\n\n\t\t\t// Get original event\n\t\t\tevent = event.originalEvent || event;\n\n\t\t\t// Check button\n\t\t\tif(event.button && event.button !== 1)\n\t\t\t\treturn;\n\n\t\t\t// Stop default action\n\t\t\tevent.preventDefault();\n\n\t\t\tlet started = false,\n\t\t\t\tcallbacks = callbacks();\n\n\t\t\t$(document).on(\"mousemove.drag\", function(event) {\n\n\t\t\t\t// Start\n\t\t\t\tif(!started) {\n\t\t\t\t\tstarted = true;\n\t\t\t\t\tcallbacks.fire(\"start\", { event: event, x: event.pageX, y: event.pageY });\n\t\t\t\t}\n\t\t\t\t// Move\n\t\t\t\telse callbacks.fire(\"move\", { event: event, x: event.pageX, y: event.pageY });\n\n\t\t\t\t// Prevent default\n\t\t\t\tevent.preventDefault();\n\t\t\t\treturn false;\n\n\t\t\t}).on(\"mouseup.drag\", function(event) {\n\n\t\t\t\t// Off events\n\t\t\t\t$(document).off(\"mousemove.drag\").off(\"mouseup.drag\");\n\n\t\t\t\t// If not started\n\t\t\t\tif(!started)\n\t\t\t\t\treturn;\n\n\t\t\t\t// Stop default action\n\t\t\t\tevent.preventDefault();\n\n\t\t\t\t// Call stop callback\n\t\t\t\tcallbacks.fire(\"stop\", { event: event, x: event.pageX, y: event.pageY });\n\n\t\t\t});\n\n\t\t\treturn callbacks;\n\t\t}\n\t};\n\treturn self;\n});","sky.service(\"history\", [ \"callbacks\", \"supported\" ], function ({ callbacks, supported }) {\n\n\n\t/**\n\t * Get difference fields in objects\n\t * @param {object} first  Object to compare\n\t * @param {object} second Object to compare\n\t */\n    let getObjectsDifference = function (first, second) {\n\n\t\tlet difference = {},\n\t\t    localDiff = false;\n\n        /* If both arrays or objects */\n\t\tif ((first instanceof Array && second instanceof Array) || (first instanceof Object && second instanceof Object)) {\n\n            /* Find what was changed or deleted in second */\n\t\t\t$.each(first, function (key, value) {\n\n                /* If no such elements in second */\n\t\t\t\tif (typeof second[key] === \"undefined\")\n\t\t\t\t\tdifference[key] = null; // Set to null\n\n                /* Check if different */\n\t\t\t\telse if (localDiff = getObjectsDifference(value, second[key])) {\n\t\t\t\t\tdifference[key] = localDiff;\n\t\t\t\t}\n\n\t\t\t});\n\n            /* If was added */\n\t\t\t$.each(second, function (key, value) {\n\t\t\t\tif (typeof first[key] === \"undefined\")\n\t\t\t\t\tdifference[key] = value;\n\t\t\t});\n\n            /* Convert object to array */\n\t\t\tif (first instanceof Array) {\n\t\t\t\tlet returnArray = [];\n\t\t\t\t$.each(difference, function (key) {\n\t\t\t\t\treturnArray.push(difference[key]);\n\t\t\t\t});\n\t\t\t\tdifference = returnArray;\n\t\t\t}\n\n\t\t} else {\n\t\t\tif (first !== second) return second;\n\t\t\telse return false;\n\t\t}\n\n        /* No array difference */\n\t\tif (difference.length === 0) return false;\n\t\telse return difference;\n\n\t};\n\n    /**\n     * History constructor\n     * @param [options]\n     * @returns {sky.History}\n     * @constructor\n     */\n    sky.History = function (options) {\n\n\t\t/* Self creation */\n        if (!(this instanceof sky.History))\n            return new sky.History(options);\n\n\t\t/* Reset */\n        this.options = options || {};\n\n\t\t/* Set events */\n        this.events = this.options.events || new callbacks();\n        this.options.events = this.events;\n\n\t\t/* Self return */\n        return this;\n\n    };\n\n    /**\n     * Extending\n     */\n    $.extend(sky.History.prototype, {\n\n        /**\n         * Stores last saved hash\n         */\n        hashString: \"\",\n\n        /**\n         * Stores last saved search\n         */\n        searchString: \"\",\n\n        /**\n         * Stores last saved path\n         */\n        pathString: \"\",\n\n        /**\n         * Stores object with hash params key/value pairs\n         */\n        hashObject: {},\n\n        /**\n         * Stores object with page search params key/value pairs\n         */\n        searchObject: {},\n\n        /**\n         * Stores events\n         */\n        events: undefined,\n\n        /**\n         * Holds hash check function interval id\n         */\n        intervalId: 0,\n\n        /**\n         * This page base url\n         */\n        base: \"\",\n\n        /**\n         * Changes current path to specified\n         * @param {string} path PAth to navigate\n         */\n        navigate: function (path) {\n\n            // Get path\n            path = path.replace(\"~\", this.base);\n\n            // Get current\n            let current = (window.location.pathname + window.location.search).substr(this.base.length);\n\n            // If changes\n            if (current !== path) {\n\n                // Set new state\n                history.pushState({ oldPath: this.pathString, newPath: path, search: this.searchObject}, path, path);\n\n                // Get new\n                this.pathString = window.location.pathname.substr(this.base.length);\n\n                // Get search string\n                this.searchString = this.getWindowSearch();\n\n                // Fire event\n                this.events.fire(\"navigate.path, always\", {hash: this.hashObject, path: this.pathString, search: this.searchObject});\n\n            }\n        },\n\n        /**\n         * Fires on path change\n         */\n        change: function () {\n\n\t\t\t/* Hash difference holder */\n            let hashDifference = {},\n                searchDifference = {},\n                old = this.pathString,\n                hashChanged = false,\n                searchChanged = false;\n\n\t\t\t/* If api supported */\n            if (this.supported)\n                this.pathString = window.location.pathname.substr(this.base.length);\n\n\t\t\t/* Check if hash changed */\n            if (this.hashString !== this.getWindowHash()) {\n\n\t\t\t\t/* Get difference */\n                hashDifference = this.getDifference(this.getWindowHash(), this.hashObject);\n\n\t\t\t\t/* Hash change flag */\n                hashChanged = true;\n\n            }\n\n\t\t\t/* Check if params changed */\n            if (this.searchString !== this.getWindowSearch()) {\n\n\t\t\t\t/* Get difference */\n                searchDifference = this.getDifference(this.getWindowSearch(), this.searchObject);\n\n\t\t\t\t/* Hash change flag */\n                searchChanged = true;\n\n            }\n\n\t\t\t/* If nothing changed */\n            if (this.pathString === old && !hashChanged && !searchChanged)\n                return;\n\n\t\t\t/* Rebuild hash object on new hash str */\n            this.rebuild();\n\n\t\t\t/* Fire */\n            this.events.fire(\"change, always\", {\n                hash: this.hashObject,\n                hashDifference: hashDifference,\n                searchDifference: searchDifference,\n                path: this.pathString,\n                oldPath: old,\n                searchChanged: searchChanged,\n                hashChanged: hashChanged,\n                pathChanged: old !== this.pathString\n            });\n\n        },\n\n        /**\n         * Navigates to specified path\n         * @param path\n         */\n        setHash: function (path) {\n\n\t\t\t/* To not jump top */\n            if (path === \"\" && window.location.hash !== \"\")\n                path = \"none\";\n\n\t\t\t/* Save */\n            this.hashString = path;\n\n\t\t\t/* Set hash */\n            window.location.hash = encodeURI(path);//encodeURI(path);\n\n        },\n\n        /**\n         * Navigates to specified path\n         * @param path\n         */\n        setSearch: function (path) {\n\n\t\t\t/* Set path */\n            this.navigate(window.location.pathname + encodeURI(path !== \"\" ? \"?\" + path : \"\"));\n\n        },\n\n        /**\n         * Sets hash letiable\n         * @param {object}    elements Fields to be set\n         * @param {boolean}    [force]     Replace all stored fields with elements object\n         */\n        set: function (elements, force) {\n\n            let changed = false;\n\n\t\t\t/* Force rewrite */\n            if (force)\n                this.hashObject = elements;\n\n\t\t\t/* Go through elements and add or change them */\n            $.each(elements, (key, value) => {\n\n\t\t\t\t/* If we need delete */\n                if (value === null)\n                    delete this.hashObject[key];\n                else\n                    this.hashObject[key] = value;\n\n\t\t\t\t/* Set as changed */\n                changed = true;\n\n            });\n\n\t\t\t/* If any changes we rebuild hash */\n            if (changed || force)\n                this.setHash(decodeURIComponent(jQuery.param(this.hashObject).replace(/\\+/g, \" \")));\n\n\t\t\t/* Fire */\n            this.events.fire(\"set, always\", {elements: elements, hash: this.hashObject, path: this.pathString});\n\n        },\n\n\n        /**\n         * Sets hash letiable\n         * @param {object}    elements Fields to be set\n         * @param {boolean}    [force]     Replace all stored fields with elements object\n         */\n        search: function (elements, force) {\n\n            let changed = false;\n\n\t\t\t/* Force rewrite */\n            if (force)\n                this.searchObject = elements;\n\n\t\t\t/* Go through elements and add or change them */\n            $.each(elements, $.proxy(function (key, value) {\n\n\t\t\t\t/* If we need delete */\n                if (value === null)\n                    delete this.searchObject[key];\n                else\n                    this.searchObject[key] = value;\n\n\t\t\t\t/* Set as changed */\n                changed = true;\n\n            }, this));\n\n\t\t\t/* If any changes we rebuild hash */\n            if (changed || force)\n                this.setSearch(decodeURIComponent(jQuery.param(this.searchObject).replace(/\\+/g, \" \")));\n\n\t\t\t/* Fire */\n\t\t\tthis.events.fire(\"set, always\", {elements: elements, hash: this.hashObject, path: this.pathString});\n\n        },\n\n        /**\n         * Makes hash from object\n         * @param obj\n         * @returns {*|void|string|XML}\n         */\n        stringFromObject: function (obj) {\n            return jQuery.param(obj).replace(/\\+/g, \" \");\n        },\n\n        /**\n         * Get objects according to hash string\n         * @param {string} paramsString String which contains key=value pairs, would be parsed to object\n         */\n        getObjects: function (paramsString) {\n\n            let objects = {};\n\n\t\t\t/* Remove sharp */\n            if (paramsString.substr(0, 1) === '#' || paramsString.substr(0, 1) === '?')\n                paramsString = paramsString.slice(1, paramsString.length);\n\n\t\t\t/* Split parameters */\n            let subStrings = paramsString.split(\"&\");\n\n\t\t\t/* Get params */\n            $.each(subStrings, function (i, str) {\n\n                let keyAndValue = str.split(\"=\", 2);\n\n\t\t\t\t/* If no assign */\n                if (keyAndValue.length < 2)\n                    return;\n\n                let name = keyAndValue[0];\n\n\t\t\t\t/* Truncate brackets */\n                if (name.substr(-2) === \"[]\")\n                    name = name.substr(0, name.length - 2);\n\n\t\t\t\t/* Special hash for \"=\" in value  */\n                keyAndValue[1] = str.substr(keyAndValue[0].length + 1);\n\n\t\t\t\t/* If object repeats we create array */\n                if (typeof objects[name] === \"undefined\") objects[name] = keyAndValue[1];\n                else {\n                    if (!(objects[name] instanceof Array)) objects[name] = [objects[name]];\n                    objects[name].push(keyAndValue[1]);\n                }\n            });\n\n            return objects;\n\n        },\n\n        /**\n         * Finds difference between current stored hash and parameter\n         * @returns {*}\n         */\n        getDifference: function (string, stored) {\n\n\t\t\t/* Init */\n            let objects = this.getObjects(decodeURI(string));\n            return getObjectsDifference(stored, objects);\n\n        },\n\n        /**\n         * Rebuilds stored hash parameters according to current one\n         */\n        rebuild: function () {\n            this.hashString = this.getWindowHash();\n            this.hashObject = this.getObjects(this.hashString);\n            this.searchString = this.getWindowSearch();\n            this.searchObject = this.getObjects(this.searchString);\n            this.pathString = window.location.pathname;\n            return this;\n\n        },\n\n        /**\n         * Gets current window hash without \"#\"\n         * @returns {string}\n         */\n        getWindowHash: function () {\n\n\t\t\t/* Get decoded hash */\n            let hash = decodeURI(window.location.hash);\n\n\t\t\t/* Remove sharp */\n            if (hash.substr(0, 1) === '#')\n                hash = hash.slice(1);\n\n\t\t\t/* Return */\n            return hash;\n\n        },\n\n        /**\n         * Gets current window parameters without \"?\"\n         * @returns {string}\n         */\n        getWindowSearch: function () {\n\n\t\t\t/* Get decoded hash */\n            let search = decodeURI(window.location.search);\n\n\t\t\t/* Remove question */\n            if (search.substr(0, 1) === '?')\n                search = search.slice(1);\n\n\t\t\t/* Return */\n            return search;\n\n        },\n\n        /**\n         * Set interval execution\n         */\n        start: function () {\n\n            /* Set base if any */\n\t\t\tif (this.options.base)\n\t\t\t\tthis.base = this.options.base;\n\n\t\t\t/* If supported history */\n            if (window.history)\n                window.onpopstate = this.change.bind(this);\n\n            /* Timeout */\n            if (!this.intervalId)\n                this.intervalId = setInterval(this.change.bind(this), this.options.time || 500);\n\n\t\t\t/* Immediately event */\n            this.change();\n            return this;\n        }\n\n    });\n\n});","sky.service(\"inputsIO\", function () {\n\n\tthis.service = {\n\n\t\t/**\n\t\t * Get value of single input\n\t\t * @param input\n\t\t * @returns {*}\n\t\t */\n\t\treadInputValue: function (input) {\n\n\t\t\tif (input.is(\".selectReplaceChoose\")) {\n\n\t\t\t\t// Get inputs\n\t\t\t\tlet inputs = input.find(\"input\");\n\n\t\t\t\t// Read\n\t\t\t\tlet data = this.readInputsValues(inputs);\n\n\t\t\t\t// If all checked\n\t\t\t\tif (data.length === inputs.length)\n\t\t\t\t\treturn true;\n\n\t\t\t\t// Return data\n\t\t\t\treturn data;\n\n\t\t\t} else if (input.is(\":checkbox\") || input.is(\":radio\")) {\n\t\t\t\treturn input.is(\":checked\") ? input.val() : false;\n\t\t\t} else\n\t\t\t\treturn input.val() === \"\" ? false : input.val();\n\n\n\t\t},\n\n\t\t/**\n\t\t * Get value of multiple inputs\n\t\t * @param inputs\n\t\t * @returns {*}\n\t\t */\n\t\treadInputsValues: function (inputs) {\n\n\t\t\t/* If single input */\n\t\t\tif (inputs.length === 1)\n\t\t\t\treturn this.readInputValue(inputs);\n\n\t\t\t/* Values holder */\n\t\t\tlet valuesNamed = [],\n\t\t\t\tvaluesLined = [],\n\t\t\t\tself = this;\n\n\t\t\t/* Go through */\n\t\t\tinputs.each(function () {\n\n\t\t\t\t/* Get value */\n\t\t\t\tlet input = $(this),\n\t\t\t\t\tvalue = self.readInputValue(input);\n\n\t\t\t\t/* If we get values */\n\t\t\t\tif (value !== false) {\n\t\t\t\t\tvaluesNamed.push({name: input.attr(\"name\"), value: value});\n\t\t\t\t\tvaluesLined.push(value);\n\t\t\t\t}\n\n\t\t\t});\n\n\t\t\t/* Single */\n\t\t\tif (valuesLined.length === 1) {\n\t\t\t\treturn valuesLined[0];\n\t\t\t}\n\n\t\t\t/* Return */\n\t\t\treturn valuesLined.length ? valuesLined : false;\n\n\t\t},\n\n\t\t/**\n\t\t * Write single input value\n\t\t * @param value\n\t\t * @param input\n\t\t * @returns {*}\n\t\t */\n\t\twriteInputValue: function (value, input) {\n\n\t\t\tif (input.is(\".selectReplaceChoose\")) {\n\n\t\t\t\t// Get inputs\n\t\t\t\tlet inputs = input.find(\"input\");\n\n\t\t\t\t// If all checked\n\t\t\t\tif (value === true)\n\t\t\t\t\tinputs.prop(\"checked\", true);\n\t\t\t\telse\n\t\t\t\t\tthis.writeInputsValue(value, inputs);\n\n\t\t\t\tif (inputs.length)\n\t\t\t\t\tinputs.first().trigger(\"change\", {notByUser: true});\n\n\t\t\t} else if (input.is(\":checkbox\") || input.is(\":radio\")) {\n\t\t\t\treturn input.prop(\"checked\", value !== false);\n\t\t\t} else\n\t\t\t\treturn input.val(value === false ? \"\" : value);\n\t\t},\n\n\t\t/**\n\t\t * Write multiple inputs value\n\t\t * @param values\n\t\t * @param inputs\n\t\t * @returns {*}\n\t\t */\n\t\twriteInputsValue: function (values, inputs) {\n\n\t\t\t/* Write single */\n\t\t\tif (inputs.length < 2)\n\t\t\t\treturn this.writeInputValue(values, inputs);\n\n\t\t\t/* Multiple */\n\t\t\tif (inputs.is(\":checkbox\") || inputs.is(\":radio\")) {\n\t\t\t\tinputs.prop(\"checked\", false);\n\t\t\t\tif (values instanceof Array) {\n\t\t\t\t\t$.each(values, function (_, val) {\n\t\t\t\t\t\tinputs.filter('[value=\"' + val + '\"]').prop(\"checked\", true);\n\t\t\t\t\t});\n\t\t\t\t\tinputs.first().trigger(\"change\", {notByUser: true});\n\t\t\t\t} else {\n\t\t\t\t\tif (values === false || values === true)\n\t\t\t\t\t\tinputs.prop(\"checked\", values).first().trigger(\"change\", {notByUser: true});\n\t\t\t\t\telse\n\t\t\t\t\t\tinputs.filter('[value=\"' + values + '\"]').prop(\"checked\", true).trigger(\"change\", {notByUser: true});\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tinputs.val(values);\n\t\t\t}\n\t\t}\n\n\t}\n\n});","sky.service(\"localStorage\", [ \"callbacks\" ], function({ callbacks }) {\n\n\t/**\n\t * Local storage class\n\t * @param {Object} options Creation options\n\t * @param {sky.Callbacks} [events] Events handler\n\t * @returns {*}\n\t * @constructor\n\t */\n\tlet LocalStorage = this.service = class {\n\t\tconstructor(options, events) {\n\n\t\t\t/* If already */\n\t\t\tif(options instanceof LocalStorage)\n\t\t\t\treturn options;\n\n\t\t\t/* Self creating if not in constructor */\n\t\t\tif(!(this instanceof LocalStorage))\n\t\t\t\treturn new LocalStorage(options, events);\n\n\t\t\t/* Options */\n\t\t\toptions = options || {};\n\n\t\t\t/* Set default name */\n\t\t\tif(!options.name)\n\t\t\t\toptions.name = \"global\";\n\n\t\t\t/* Set prefix */\n\t\t\tif(!options.prefix)\n\t\t\t\toptions.prefix = options.name;\n\n\t\t\t/* Set full name */\n\t\t\tthis.fullName = [\"sky\", options.name].join(\"-\");\n\n\t\t\t/* Stored item prefix */\n\t\t\tthis.itemPrefix = [\"sky\", options.prefix].join(\"-\");\n\n\t\t\t/* Get events */\n\t\t\tthis.events = events || new callbacks();\n\n\t\t\t/* Ids list */\n\t\t\tthis.ids = false;\n\n\t\t\t/* Return */\n\t\t\treturn this;\n\n\t\t}\n\n\t\t/**\n\t\t * Loads item form database\n\t\t * @param {*} id Unique id\n\t\t * @param {function} [onLoad] Calls when load complete\n\t\t */\n\t\tload(id, onLoad) {\n\n\t\t\t/* Try to get item from storage */\n\t\t\tlet item = localStorage.getItem([this.itemPrefix, id].join(\"-\"));\n\n\t\t\t/* Trigger error */\n\t\t\tif(item === null)\n\t\t\t\tthis.events.fire(\"load.error\", { id: id, storage: this });\n\n\t\t\t/* Call function */\n\t\t\tif(onLoad)\n\t\t\t\tonLoad(item ? $.parseJSON(item) : undefined);\n\n\t\t\t/* Return */\n\t\t\treturn item ? $.parseJSON(item) : undefined;\n\n\t\t}\n\n\t\t/**\n\t\t * Get all ids from database\n\t\t * @returns {*}\n\t\t */\n\t\tgetIds() {\n\n\t\t\t/* If already stored */\n\t\t\tif(this.ids instanceof Array)\n\t\t\t\treturn this.ids;\n\n\t\t\t/* Gets ids list by key */\n\t\t\tlet itemsIds = localStorage.getItem(this.fullName), self = this;\n\n\t\t\t/* SAve and return */\n\t\t\titemsIds = itemsIds ? itemsIds.split(\", \") : [];\n\t\t\tthis.ids = [];\n\n\t\t\t/* remove duplicates */\n\t\t\t$.each(itemsIds, function(_, id) {\n\t\t\t\tif(self.ids.indexOf(id) < 0)\n\t\t\t\t\tself.ids.push(id);\n\t\t\t});\n\n\t\t\t/* return */\n\t\t\treturn this.ids;\n\n\t\t}\n\n\t\t/**\n\t\t * Loads all element from storage\n\t\t * @param onLoad\n\t\t */\n\t\tloadAll(onLoad) {\n\n\t\t\t/* Item holder */\n\t\t\tlet self = this, items = {};\n\n\t\t\t/* Go through items */\n\t\t\t$.each(this.getIds(), function(_, id) {\n\n\t\t\t\t/* Get item */\n\t\t\t\tself.load(id, function(item) {\n\n\t\t\t\t\t/* Add parsed */\n\t\t\t\t\tif(item) items[id] = item;\n\t\t\t\t\telse delete self.ids[id];\n\n\t\t\t\t});\n\n\t\t\t});\n\n\t\t\t/* Trigger error */\n\t\t\tif(!self.ids.length)\n\t\t\t\tthis.events.fire(\"empty\", { storage: this });\n\n\t\t\t/* Return */\n\t\t\tonLoad.call(this, items);\n\n\t\t}\n\n\t\t/**\n\t\t * Save data to storage\n\t\t * @param id\n\t\t * @param data\n\t\t * @returns {*}\n\t\t */\n\t\tsave(id, data) {\n\n\t\t\ttry {\n\n\t\t\t\t/* Save item */\n\t\t\t\tlocalStorage.setItem([this.itemPrefix, id].join(\"-\"), JSON.stringify(data));\n\n\t\t\t\t/* Get ids */\n\t\t\t\tlet ids = this.getIds();\n\n\t\t\t\t/* Save id */\n\t\t\t\tif(ids.indexOf(id) < 0)\n\t\t\t\t\tids.push(id);\n\n\t\t\t\t/* Save keys */\n\t\t\t\tlocalStorage.setItem(this.fullName, ids.join(\", \"));\n\n\t\t\t\t/* Trigger event */\n\t\t\t\tthis.events.fire(\"save.success\", { storage: this, data: data, id: id });\n\n\t\t\t} catch(e) {\n\t\t\t\tconsole.log(e);\n\t\t\t}\n\n\t\t\t/* Self return */\n\t\t\treturn this;\n\n\t\t}\n\n\t\t/**\n\t\t * Saves all\n\t\t * @param index\n\t\t * @param models\n\t\t * @returns {*}\n\t\t */\n\t\tsaveAll(index, models) {\n\t\t\tlet self = this;\n\n\t\t\t/* Go through */\n\t\t\t$.each(models, function() {\n\t\t\t\tself.save(this.attr(index), this.attributes);\n\t\t\t});\n\n\t\t\treturn this;\n\t\t}\n\n\t\t/**\n\t\t * Removes from storage\n\t\t * @param id\n\t\t * @returns {*}\n\t\t */\n\t\tremove(id) {\n\n\t\t\t/* Init */\n\t\t\tlet index,\n\t\t\t\tids = this.getIds(); // Get ids\n\n\t\t\t/* Remove item */\n\t\t\tlocalStorage.removeItem([this.itemPrefix, id].join(\"-\"));\n\n\t\t\t/* Remove from list */\n\t\t\tif((index = ids.indexOf(id)) > -1) {\n\n\t\t\t\t/* Remove id */\n\t\t\t\tids.splice(index, 1);\n\n\t\t\t\t/* Save keys */\n\t\t\t\tlocalStorage.setItem(this.fullName, ids.join(\", \"));\n\n\t\t\t\t/* Trigger event */\n\t\t\t\tthis.events.fire(\"success.remove\", { storage: this, id: id });\n\n\t\t\t}\n\t\t\t/* If no id */\n\t\t\telse\n\t\t\t\tthis.events.fire(\"remove.error\", { storage: this, id: id });\n\n\n\t\t\t/* Self return */\n\t\t\treturn this;\n\n\t\t}\n\t};\n\n});","sky.service(\"model\", [ \"modelsStorage\", \"callbacks\" ], function({ modelsStorage, callbacks }) {\n\n\t/**\n\t * List of model definitions\n\t */\n\tlet modelsDefinition = {};\n\n\tclass Model {\n\t\tconstructor(type, data) {\n\n\t\t\t/* Init as base */\n\t\t\tthis.definition = BaseDefinition;\n\n\t\t\t/* Get special if defined */\n\t\t\tif(modelsDefinition[type])\n\t\t\t\tthis.definition = modelsDefinition[type];\n\n\t\t\t/* Save id */\n\t\t\tthis.id = data[this.definition.id] || null;\n\t\t\tthis.type = type;\n\t\t\tthis.data = {};\n\t\t\tthis.callbacks = callbacks();\n\t\t\tthis.definition.creation.bind(this)($.extend({}, data, true));\n\n\t\t}\n\t\textend(data) {\n\t\t\tthis.definition.extension.bind(this)($.extend({}, data, true));\n\t\t\treturn this.changed();\n\t\t}\n\t\tchanged() {\n\t\t\tthis.callbacks.fire(\"change\", {model: this});\n\t\t\treturn this;\n\t\t}\n\t\tremoveFromStorage() {\n\t\t\tmodelsStorage.remove(this);\n\t\t}\n\t\taddListener(func) {\n\t\t\tthis.callbacks.on(\"change\", func);\n\t\t}\n\t\tremoveListener(func) {\n\t\t\tthis.callbacks.off(\"change\", func);\n\t\t}\n\t}\n\n\t/**\n\t * Base model definition witch would be parented\n\t */\n\tlet BaseDefinition = {\n\t\tid: \"id\",\n\t\tcreation: function(data) {\n\t\t\tthis.data = data;\n\t\t},\n\t\textension: function(data) {\n\t\t\t$.extend(true, this.data, data);\n\t\t}\n\t};\n\n\tthis.service = {\n\t\t/**\n\t\t * Adds new models definition\n\t\t * @param name\n\t\t * @param definition\n\t\t */\n\t\taddDefinition: function(name, definition) {\n\t\t\tmodelsDefinition[name] = $.extend({}, BaseDefinition, definition);\n\t\t},\n\n\t\tfromData: function(type, data) {\n\n\t\t\tlet model = new this.Model(type, data);\n\t\t\tlet cached = modelsStorage.add(model);\n\n\t\t\tif(cached)\n\t\t\t\treturn cached.extend(data);\n\n\t\t\treturn model;\n\n\t\t}\n\t};\n\n});","sky.service(\"modelsManager\", [\"callbacks\", \"model\"], function({callbacks, model}) {\n\tclass Manager {\n\t\tconstructor(type, arr) {\n\n\t\t\tthis.items = [];\n\t\t\tthis.type = type;\n\t\t\tthis.callbacks = callbacks();\n\n\t\t\t$.each(arr, (_, model) => {\n\t\t\t\tthis.items.push(model)\n\t\t\t});\n\t\t}\n\t\treloadFromArray(arr) {\n\t\t\tthis.items = [];\n\t\t\t$.each(arr, (_, data) => {\n\t\t\t\tthis.items.push(model.fromData(this.type, data))\n\t\t\t});\n\t\t}\n\t\tcount() {\n\t\t\treturn this.items.length;\n\t\t}\n\t\taddListener(func) {\n\t\t\tthis.callbacks.on(\"change\", func);\n\t\t}\n\t\tremoveListener(func) {\n\t\t\tthis.callbacks.off(\"change\", func);\n\t\t}\n\t}\n\n\tthis.service = {\n\t\tfromArray: function(type, arr) {\n\t\t\tlet items = [];\n\t\t\t$.each(arr, (_, data) => {\n\t\t\t\titems.push(sky.model.fromData(type, data));\n\t\t\t});\n\t\t\treturn new Manager(type, items);\n\t\t}\n\t};\n\n});","sky.service(\"modelsStorage\", function() {\n\n    let cache = {};\n\n    this.service = {\n\t\tadd: function(model) {\n\n\t\t\t// Search in cache\n\t\t\tlet cached = this.search(model.type, model.id);\n\n\t\t\t// If found extend\n\t\t\tif(cached)\n\t\t\t\treturn cached;\n\n            // Create type storage if none\n            if(!this.cache[model.type])\n                this.cache[model.type] = {};\n\n            // Save model\n            this.cache[model.type][model.id] = model;\n\n\t\t},\n\n\t\tsearch: function(type, id) {\n\n\t\t\t// Cache search\n\t\t\tif(cache[type] && cache[type][id])\n\t\t\t\treturn cache[type][id];\n\n\t\t\t// On miss\n\t\t\treturn false;\n\t\t},\n\n\t\tremove: function(model) {\n\t\t\tdelete cache[model.type][model.id];\n\t\t}\n\t}\n});","/**\n * For work with different type of notifications\n */\nsky.service(\"notifications\", [ \"stackList\", \"callbacks\", \"visibleCalculator\", \"templates\", \"windows\", \"tips\" ], function({ stackList, callbacks, visibleCalculator, templates, windows, tips }) {\n\n\tlet notification = function(options) {\n\t\t/* Self creation */\n\t\tif(!(this instanceof notification))\n\t\t\treturn new notification(options);\n\n\t\tthis.render = templates.render(\"forms-notification\", options);\n\t};\n\tlet message = function(options) {\n\n\t\t/* Self creation */\n\t\tif(!(this instanceof message))\n\t\t\treturn new message(options);\n\n\t\tthis.render = templates.render(\"forms-message\", options);\n\t};\n\n\tmessage.prototype = {\n\t\tmodal: function() {\n\t\t\treturn windows.Modal(this.render);\n\t\t},\n\n\t\t/**\n\t\t * Append to holder of modal window\n\t\t * @param {object} modal\n\t\t */\n\t\tappendToModal: function(modal) {\n\t\t\tmodal.holder.append(this.render);\n\t\t},\n\n\t\ttip: function(object, align) {\n\t\t\ttips.Tip(object, { create: this.render, close: 5 }).show(align || \"top\",);\n\t\t}\n\t};\n\n\tlet loadings = stackList();\n\n\t/**\n\t * Loading\n\t */\n\tlet loading = function(ajax, global = true) {\n\n\t\t/* Self creation */\n        if(!(this instanceof loading))\n            return new loading(ajax, global);\n\n\t\t/* Back link */\n\t\tthis.global = global;\n\n\t\t/* Render */\n\t\tthis.render = $('<div><div></div></div>').addClass(\"ajaxLoading\");\n\n\t\t/* Global insert */\n\t\tif(this.global)\n\t\t\tthis.render.addClass(\"fixed\").appendTo(\"body\");\n\n\t\t/* If stop possible */\n\t\tif(ajax) {\n\t\t\t$(\"<span/>\").appendTo(this.render.addClass(\"cancelable\")).click(function() { ajax.stop(); });\n\t\t\tajax.on(\"always\", () => { this.hide(); });\n\t\t}\n\n\t\t/* Callbacks */\n\t\tthis.callbacks = callbacks();\n\n\t\t/* List save */\n\t\tloadings.add(this);\n\n\t};\n\n\t/**\n\t * Prototype\n\t * @type {{render: null, hide: hide}}\n\t */\n\tloading.prototype = {\n\n\t\t/**\n\t\t * Loads loading in modal window\n\t\t * @param {object} modal Window\n\t\t */\n\t\tinModalWindow: function(modal) {\n\n\t\t\t/* Hide */\n\t\t\tlet content = modal.holder.children().hide();\n\n\t\t\t/* Insert */\n\t\t\tthis.render.appendTo(modal.holder);\n\n\t\t\t/* Restore on hide */\n\t\t\tthis.callbacks.on(\"hide\", () => content.show());\n\n\t\t},\n\n\t\t/**\n\t\t *\n\t\t * @param contentHolder\n\t\t */\n\t\treloadContent: function(contentHolder) {\n\n\t\t\t/* If no holder */\n\t\t\tif(!this.holder.length)\n\t\t\t\treturn;\n\n\t\t\t/* Safe */\n\t\t\tthis.holder = contentHolder = $(contentHolder).addClass(\"withLoading\");\n\n\t\t\t/* Get children */\n\t\t\tlet content = contentHolder.children();\n\n\t\t\t/* Different content disable */\n\t\t\tif(this.global) {\n\n\t\t\t\tcontent.disable();\n\n\t\t\t\t/* Make sizes calculator */\n\t\t\t\tthis.calc = visibleCalculator(contentHolder, this.render.outerHeight(), \"body\");\n\n\t\t\t\t/* Set position func */\n\t\t\t\tthis.setPosition = function() {\n\t\t\t\t\tlet position = this.calc.calculate();\n\t\t\t\t\tthis.render.css({\n\t\t\t\t\t\tleft: position.left + (position.width) / 2,\n\t\t\t\t\t\ttop: position.top + (position.height) / 2\n\t\t\t\t\t})\n\t\t\t\t};\n\t\t\t\tthis.setPosition();\n\n\t\t\t\t/* Re enable */\n\t\t\t\tthis.callbacks.on(\"hide\", () => {\n\t\t\t\t\tcontent.enable();\n\t\t\t\t\t$(window).off(\"scroll.notification\");\n\t\t\t\t});\n\n\t\t\t\t$(window).on(\"scroll.notification\", () => { this.setPosition();\t});\n\n\t\t\t} else {\n\n\t\t\t\t/*  Hide */\n\t\t\t\tcontent.hide();\n\n\t\t\t\t/* Insert */\n\t\t\t\tthis.render.appendTo(this.holder);\n\n\t\t\t\t/* Re enable */\n\t\t\t\tthis.callbacks.on(\"hide\", function() {\n\t\t\t\t\tcontent.show();\n\t\t\t\t});\n\t\t\t}\n\n\t\t\treturn this;\n\n\t\t},\n\n\t\tsetHolder: function(holder) {\n\n\t\t\t/* Append and save */\n\t\t\tthis.holder = $(holder).addClass(\"withLoading\").append(this.render);\n\n\t\t\t/* Self return */\n\t\t\treturn this;\n\n\t\t},\n\n\t\t/**\n\t\t * Hides current loading\n\t\t */\n\t\thide: function() {\n\n\t\t\tif(this.holder)\n\t\t\t\tthis.holder.removeClass(\"withLoading\");\n\n\t\t\tthis.render.remove();\n\t\t\tthis.callbacks.fire(\"hide\");\n\n\t\t\t/* Remove from list */\n\t\t\tloadings.remove(this);\n\n\t\t}\n\t};\n\n\treturn {\n\t\tloading: loading,\n\t\tmessage: message,\n\t\treCalculate: function() {\n\t\t\tloadings.each(function(instance) {\n\t\t\t\tinstance.calc.init();\n\t\t\t\tinstance.setPosition();\n\t\t\t})\n\t\t}\n\t}\n\n});","sky.services.add(\"pagination\", [\"templates\", \"stackList\"], function({ templates, stackList }) {\n\n\tlet list = stackList();\n\n\tclass Pagination {\n\t\tconstructor({ pages, holder, current = 1, }) {\n\n\t\t\t/* Self creation */\n\t\t\tif(!(this instanceof Pagination))\n\t\t\t\treturn new Pagination({ pages, holder, current });\n\n\t\t\t/* Save */\n\t\t\tlist.add(this);\n\n\t\t\t/* Set total pages */\n\t\t\tthis.pages \t\t= pages;\n\t\t\tthis.current \t= current;\n\t\t\tthis.pageWidth\t= 50;\n\t\t\tthis.id \t\t= last;\n\n\t\t\t/* No pages needed */\n\t\t\tif(this.pages < 2)\n\t\t\t\treturn this;\n\n\t\t\t/* Counted params */\n\t\t\tthis.dimensions = {\n\t\t\t\tstartPage      : 1,\n\t\t\t\tlastStartPage  : 0,\n\t\t\t\tpagesVisible   : 0,\n\t\t\t\tpagesInvisible : 0,\n\t\t\t\tscrollAvailable: 0,\n\t\t\t\tscrollStart\t   : 0,\n\t\t\t\ttumbler\t\t   : 10\n\t\t\t};\n\n\t\t\t/* Render */\n\t\t\tthis.dom = {};\n\t\t\tthis.dom.holder  = templates.render(\"pagination\", {}).data(\"pagination\", this);\n\t\t\tthis.dom.slider  = this.dom.holder.find(\".pages\");\n\t\t\tthis.dom.pages   = this.dom.slider.children();\n\t\t\tthis.dom.back \t = this.dom.holder.children(\".left\");\n\t\t\tthis.dom.forward = this.dom.holder.children(\".right\");\n\n\t\t\t/* Insert */\n\t\t\tif(holder)\n\t\t\t\tthis.dom.holder.appendTo(holder);\n\n\t\t\t/* If bigger than 10000 */\n\t\t\tif(this.pages > 9999) {\n\t\t\t\tthis.dom.slider.addClass(\"tenthousand\");\n\t\t\t\tthis.pageWidth = 80;\n\t\t\t}\n\t\t\t/* If bigger than 1000 */\n\t\t\telse if(this.pages > 999) {\n\t\t\t\tthis.dom.slider.addClass(\"thousand\");\n\t\t\t\tthis.pageWidth = 70;\n\t\t\t}\n\t\t\t/* If bigger 100 */\n\t\t\telse if(this.pages > 99 ) {\n\t\t\t\tthis.dom.slider.addClass(\"hundred\");\n\t\t\t\tthis.pageWidth = 60;\n\t\t\t}\n\n\t\t\t/* Make all */\n\t\t\tthis.redraw();\n\n\t\t\t/* Mark page */\n\t\t\tthis.goToPage(this.current);\n\n\t\t\t/* Self return */\n\t\t\treturn this;\n\n\t\t}\n\n\t\t/** */\n\t\tonPageChange(newPage) {}\n\n\t\t/** Removes navigator */\n\t\tremove() {\n\t\t\tthis.dom.holder.remove();\n\t\t\tlist.remove(this);\n\t\t}\n\n\t\t/**\n\t\t * Redraws pagination\n\t\t */\n\t\tredraw() {\n\n            /* No action on invisible */\n            if(!this.dom.holder.is(\":visible\"))\n                return;\n\n\t\t\t/* Reset width */\n\t\t\tthis.dom.slider.css(\"width\", \"auto\");\n\n\t\t\t/* Count visible sizes */\n\t\t\tthis.dimensions.pagesVisible = Math.floor((this.dom.holder.innerWidth() - 100) / this.pageWidth);\n\n\t\t\t/* Count invisible */\n\t\t\tthis.dimensions.pagesInvisible = (this.pages - this.dimensions.pagesVisible) > 0 ? this.pages - this.dimensions.pagesVisible : 0;\n\n\t\t\t/* Count last start */\n\t\t\tthis.dimensions.lastStartPage = this.dimensions.pagesInvisible + 1;\n\n\t\t\t/* Get max pages */\n\t\t\tlet toShow = this.dimensions.pagesVisible > this.pages ? this.pages : this.dimensions.pagesVisible;\n\n\t\t\t/* Crop */\n\t\t\tthis.dom.slider.css(\"width\", toShow * this.pageWidth);\n\n\t\t\t/* Redraw pages */\n\t\t\tthis.drawPages(this.dimensions.startPage);\n\n\t\t\t/* Try to create scroll */\n\t\t\tthis.createScroll();\n\n\t\t\t/* Set scroll position */\n\t\t\tif(this.dom.scrollLine)\n\t\t\t\tthis.dom.runner.css(\"left\", this.calculate().scroll);\n\n\t\t}\n\n\t\t/**\n\t\t * Create scroll line if needed\n\t\t */\n\t\tcreateScroll() {\n\n\t\t\t/* If no scroll needed */\n\t\t\tif(this.pages <= this.dimensions.pagesVisible) {\n\t\t\t\tif(this.dom.scrollLine) {\n\t\t\t\t\tthis.dom.scrollLine.remove();\n\t\t\t\t\tthis.dom.scrollLine = false;\n\t\t\t\t}\n\t\t\t\treturn;\n\t\t\t} else if(!this.dom.scrollLine) {\n\n\t\t\t\t/* Create scroll */\n\t\t\t\tthis.dom.scrollLine = templates.render(\"pagination-scroll\", {}).appendTo(this.dom.slider);\n\t\t\t\tthis.dom.runner = this.dom.scrollLine.children();\n\t\t\t}\n\n\t\t\t/* Count left */\n\t\t\tthis.dimensions.scrollStart = this.dom.scrollLine.position().left + 2;\n\n\t\t\t/* Count scroll line width */\n\t\t\tthis.dimensions.scrollAvailable = this.dom.scrollLine.outerWidth() - this.dom.scrollLine.children().outerWidth() - 4;\n\t\t\n\t\t}\n\n\t\t/**\n\t\t * Calculates related coordinates between scroll and move part\n\t\t */\n\t\tcalculate(position) {\n\n\t\t\t/* Get position */\n\t\t\tif(position === undefined)\n\t\t\t\tposition = this.dom.runner.offset().left  - this.dimensions.scrollStart;\n\n\t\t\t/* Remove start */\n\t\t\tposition = position - this.dimensions.scrollStart;\n\n\t\t\t/* Correct */\n\t\t\tposition = position > 0 ? position : 0;\n\n\t\t\t/* Count pages */\n\t\t\treturn {\n\t\t\t\tpages : Math.floor(this.dimensions.pagesInvisible * (position / this.dimensions.scrollAvailable)) + 1,\n\t\t\t\tscroll: Math.floor(this.dimensions.scrollAvailable * (this.dimensions.startPage - 1)/ this.dimensions.pagesInvisible + this.dimensions.scrollStart)\n\t\t\t}\n\n\t\t}\n\n\t\t/**\n\t\t * Draws pages according to start\n\t\t * @param {int} start Page to start from\n\t\t */\n\t\tdrawPages(start) {\n\n\t\t\t/* Remove old pages */\n\t\t\tthis.dom.pages.html(\"\");\n\n\t\t\t/* Correct */\n\t\t\tif(start > this.dimensions.pagesInvisible)\n\t\t\t\tstart = this.dimensions.pagesInvisible + 1;\n\n\t\t\t/* Correct */\n\t\t\tif(start < 1)\n\t\t\t\tstart = 1;\n\n\t\t\t/* Start position */\n\t\t\tlet i = start;\n\n\t\t\t/* Draw pages */\n\t\t\twhile(i <= this.pages && i < start + this.dimensions.pagesVisible) {\n\t\t\t\ttemplates.render(\"pagination-page\", { page: i, current: this.current }).appendTo(this.dom.pages);\n\t\t\t\ti++;\n\t\t\t}\n\n\t\t\t/* Reset start page */\n\t\t\tthis.dimensions.startPage = start;\n\n\n\t\t}\n\n\t\t/**\n\t\t * Sets page as active\n\t\t * @param {int} page Page number\n\t\t * @returns {Pagination}\n\t\t */\n\t\tgoToPage(page) {\n\n\t\t\t/* If no pages */\n\t\t\tif(this.pages < 2)\n\t\t\t\treturn this;\n\n\t\t\t/* Parse */\n\t\t\tpage = parseInt(page);\n\n\t\t\t/* Correct */\n\t\t\tif(page < 1)\n\t\t\t\tpage = 1;\n\t\t\telse if(page > this.pages)\n\t\t\t\tpage = this.pages;\n\n\t\t\t/* Checks if page is visible */\n\t\t\tlet isVisible = this.dimensions.startPage <= page && page < this.dimensions.startPage + this.dimensions.pagesVisible;\n\n\t\t\t/* Redraws if needed */\n\t\t\tif(!isVisible) {\n\t\t\t\tthis.drawPages(page);\n\t\t\t\tif(this.dom.scrollLine)\n\t\t\t\t\tthis.dom.runner.css(\"left\", this.calculate().scroll);\n\t\t\t}\n\n\t\t\t/* Make active */\n\t\t\tthis.dom.pages.children().removeClass(\"active\").filter(\"[page=\" + page +\"]\").addClass(\"active\");\n\n\t\t\t/* Forward buttons disable */\n\t\t\tif(page > 1) this.dom.back.enable();\n\t\t\telse this.dom.back.disable();\n\n\t\t\t/* Backward button disable */\n\t\t\tif(page === this.pages) this.dom.forward.disable();\n\t\t\telse this.dom.forward.enable();\n\n\t\t\t/* Callback */\n\t\t\tif(this.current !== page)\n\t\t\t\tthis.onPageChange(page);\n\n\t\t\t/* Save page state */\n\t\t\tthis.current = page;\n\n\t\t\t/* Self return */\n\t\t\treturn this;\n\n\t\t}\n\n\t\t/** Set scroll */\n\t\tscroll(event) {\n\n\t\t\tlet pos = event.pageX - 10;\n\t\t\tif(this.dimensions.scrollStart > pos)\n\t\t\t\tpos = this.dimensions.scrollStart;\n\t\t\tif(this.dimensions.scrollStart + this.dimensions.scrollAvailable < pos)\n\t\t\t\tpos = this.dimensions.scrollStart + this.dimensions.scrollAvailable;\n\n\t\t\tthis.dom.runner.css({left: pos});\n\t\t\tthis.drawPages(this.calculate(pos).pages);\n\n\t\t}\n\n\t}\n\n\t/* Bind windows events */\n\t$(window).on(\"resize\", function() {\n\t\tlist.each(() => { this.redraw(); });\n\t});\n\n\t/* Return */\n\tthis.service = {\n\t\tadd: function(options) {\n\t\t\treturn new Pagination(options);\n\t\t}\n\t}\n\n});","sky.service(\"stackList\", function() {\n\tlet List = this.service = function() {\n\n\t\tif(!(this instanceof List))\n\t\t\treturn new List();\n\n\t\tlet elements = {};\n\t\tlet lastId = 0;\n\t\tlet total = 0;\n\n\t\tthis.last = function() {\n\n\t\t\t/* Holder */\n\t\t\tlet last = false;\n\n\t\t\t/* Apply for windows */\n\t\t\t$.each(elements, function (_, element) { last = element });\n\n\t\t\t/* Return */\n\t\t\treturn last;\n\n\t\t};\n\n\t\tthis.add = function(element) {\n\t\t\tlastId++;\n\t\t\ttotal++;\n\t\t\telement[lastId] = element;\n\t\t};\n\n\t\tthis.remove = function(element) {\n\t\t\t/* Apply for windows */\n\t\t\t$.each(elements, function (index, current) {\n\t\t\t\tif(element === current) {\n\t\t\t\t\tdelete elements[index];\n\t\t\t\t\ttotal--;\n\t\t\t\t}\n\t\t\t});\n\t\t};\n\n\t\tthis.total = function() {\n\t\t\treturn total;\n\t\t};\n\n\t\tthis.elements = function() {\n\t\t\treturn elements;\n\t\t};\n\n\t\tthis.each = function(callback) {\n\t\t\tfor(let single of elements)\n\t\t\t\tcallback.apply(single, single);\n\t\t};\n\n\t}\n});","sky.onReady(({suggester}) => {\n\t$(document).on(\"click\", function(event) {\n\n\t\t/* Get element */\n\t\tlet element = $(event.target || event.srcElement);\n\n\t\t/* If click in replace we should not hide it */\n\t\tif(element.is(\"[type=submit]\") || element.closest(\".suggester\").length || element.data(\"suggester\"))\n\t\t\treturn;\n\n\t\t/* Hide all */\n\t\tsuggester.hide();\n\n\t});\n});\n\nsky.service(\"suggester\", [\"templates\"], function({templates}) {\n\n\tlet render,\n\t\tobject,\n\t\tlastList,\n\t\tsuggester = this.service = {\n\t\t\thide: function() {\n\n\t\t\t\tif(render) {\n\t\t\t\t\trender.remove();\n\t\t\t\t\trender = false;\n\t\t\t\t}\n\t\t\t\tif(object) {\n\t\t\t\t\tobject.removeData(\"suggester\");\n\t\t\t\t\tobject = false;\n\t\t\t\t}\n\t\t\t\t$(document).off(\"keyup.suggester, keydown.suggester\");\n\t\t\t},\n\t\t\tshow: function(input, list) {\n\n\t\t\t\t/* Hide previous */\n\t\t\t\tsuggester.hide();\n\n\t\t\t\t/* Save */\n\t\t\t\tlastList = list;\n\t\t\t\trender = templates.render(\"suggester\", {items: list}).insertAfter(input.closest(\"label, .label\"));\n\t\t\t\tobject = input.data(\"suggester\", render);\n\n\t\t\t\t/* Get positions */\n\t\t\t\tlet elementPosition = input.offset(),\n\t\t\t\t\trenderPosition = render.offset();\n\n\t\t\t\t/* Show */\n\t\t\t\trender.css({\n\t\t\t\t\t\"margin-left\": elementPosition.left - renderPosition.left,\n\t\t\t\t\t\"margin-top\": elementPosition.top - renderPosition.top + input.outerHeight()\n\t\t\t\t});\n\n\t\t\t\t/* Add handlers */\n\t\t\t\tlet children = render.children().on(\"click\", function() {\n\t\t\t\t\tinput.val($(this).html());\n\t\t\t\t\tsuggester.hide();\n\t\t\t\t\tif(lastList[$(this).attr(\"data-index\")].callback)\n\t\t\t\t\t\tlastList[$(this).attr(\"data-index\")].callback();\n\t\t\t\t});\n\n\t\t\t\t$(document).on(\"keyup.suggester\", function(event) {\n\n\t\t\t\t\tif(event.keyCode === 38 || event.keyCode === 40) {\n\n\t\t\t\t\t\tlet selected = children.filter(\".selected\");\n\t\t\t\t\t\tchildren.removeClass(\"selected\");\n\n\t\t\t\t\t\t// Up\n\t\t\t\t\t\tif(event.keyCode === 38) {\n\t\t\t\t\t\t\tif(!selected.length || !selected.prev().length)\n\t\t\t\t\t\t\t\tchildren.last().addClass(\"selected\");\n\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t\tselected.prev().addClass(\"selected\");\n\t\t\t\t\t\t}\n\t\t\t\t\t\t// Down\n\t\t\t\t\t\tif(event.keyCode === 40) {\n\t\t\t\t\t\t\tchildren.removeClass(\"selected\");\n\t\t\t\t\t\t\tif(!selected.length || !selected.next().length) {\n\t\t\t\t\t\t\t\tchildren.first().addClass(\"selected\")\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tselected.next().addClass(\"selected\");\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\t// Esc\n\t\t\t\t\tif(event.keyCode === 27) suggester.hide();\n\n\n\t\t\t\t}).on(\"keydown.suggester\", function(event) {\n\n\t\t\t\t\t// Enter\n\t\t\t\t\tif(event.keyCode !== 13) return;\n\n\t\t\t\t\tlet selected = children.filter(\".selected\");\n\t\t\t\t\tif(selected.length) {\n\t\t\t\t\t\tselected.trigger(\"click\");\n\t\t\t\t\t\tevent.preventDefault();\n\t\t\t\t\t} else {\n\t\t\t\t\t\tsuggester.hide();\n\t\t\t\t\t}\n\n\t\t\t\t});\n\t\t\t}\n\t\t};\n});","/**\n * Module to work with user services\n */\nsky.service(\"supported\", function () {\n\ttry {\n\t\tthis.service.fullScreen = typeof document[\"webkitIsFullScreen\"] !== \"undefined\";\n\t\tthis.service.formData = window.FormData && true;\n\t\tthis.service.XHRIsSupported = XHRIsSupported;\n\t\tthis.service.XHRUpload = (typeof new XMLHttpRequest().upload !== \"undefined\");\n\t\tthis.service.localStorage = !!window.localStorage;\n\t} catch (e) {}\n});","sky.service(\"templates\", [\"localStorage\", \"supported\", \"directives\", \"exceptions\"], function({ localStorage, supported, directives, exceptions }) {\n\n\t\n\tlet templatesList = {},\n\t\ttemplatesCompiled = {},\n\t\tTemplates = this.service = {\n\n\t\t/** Globals list */\n\t\tglobals : {},\n\n\t\t/** Local storage support */\n\t\tstorage: supported.localStorage ? localStorage({ name: \"jsTemplates\" }) : false,\n\n\t\t/**\n\t\t * Adds new template to list\n\t\t * @param options\n\t\t */\n\t\tadd: function(options) {\n\t\t\ttemplatesList[options.name] = options.template;\n\t\t\tif(this.storage) {\n\t\t\t\tthis.storage.save(options.name, templatesList[options.name]);\n\t\t\t\t//$.cookie(\"storedTemplates-\" + options.name, options.date);\n\t\t\t}\n\t\t},\n\n\t\t/**\n\t\t * Renders specified template\n\t\t * @param {String} name Template name\n\t\t * @param {Object} data Inner data\n\t\t * @param {bool} [noDirectives]\n\t\t * @returns {*}\n\t\t */\n\t\trenderWithHolder: function(name, data, noDirectives) {\n\n\t\t\t/* Compile template */\n\t\t\tthis.compile(name);\n\n\t\t\t/* Add globals */\n\t\t\tdata = $.extend(true, {}, data, { globals: this.globals });\n\n\t\t\t/* Render */\n\t\t\tlet temp = $('<div/>').append(templatesCompiled[name].render(data));\n\n\t\t\t/* Parse directives */\n\t\t\tif(!noDirectives)\n\t\t\t\tdirectives.parse(temp);\n\n\t\t\t/* Return */\n\t\t\treturn temp;\n\n\t\t},\n\n\t\t/**\n\t\t * Renders specified template\n\t\t * @param {String} name Template name\n\t\t * @param {Object} data Inner data\n\t\t * @param {bool} [noDirectives]\n\t\t * @returns {*}\n\t\t */\n\t\trender: function(name, data, noDirectives) {\n\n\t\t\t/* Compile template */\n\t\t\treturn this.renderWithHolder(name, data, noDirectives).children();\n\n\t\t},\n\n\t\t/**\n\t\t * Renders specified template and returns text\n\t\t * @param {String} name Template name\n\t\t * @param {Object} data Inner data\n\t\t * @param {bool} [noDirectives]\n\t\t * @returns {*}\n\t\t */\n\t\trenderToText: function(name, data, noDirectives) {\n\n\t\t\t/* Compile template */\n\t\t\treturn this.renderWithHolder(name, data, noDirectives).html();\n\n\t\t},\n\n\t\t/**\n\t\t * Renders template by its text as parameter\n\t\t * @param {string} text Template text\n\t\t * @param {Object} data Inner data\n\t\t * @param {bool} [noDirectives]\n\t\t * @returns {XMLList|*}\n\t\t */\n\t\trenderByText: function(text, data, noDirectives) {\n\n\t\t\t/* Add globals */\n\t\t\tdata = jQuery.extend(true, data, { globals: this.globals });\n\n\t\t\t/* Render */\n\t\t\tlet temp = $('<div/>').append(twig({ data: text }).render(data));\n\n\t\t\t/* Parse directives */\n\t\t\tif(!noDirectives)\n\t\t\t\tdirectives.parse(temp);\n\n\t\t\t/* Return */\n\t\t\treturn temp.children();\n\n\t\t},\n\n\t\t/**\n\t\t * Renders template by its text as parameter\n\t\t * @param {string} text Template text\n\t\t * @param {Object} data Inner data\n\t\t * @param noDirectives\n\t\t * @returns {XMLList|*}\n\t\t */\n\t\trenderByTextToText: function(text, data, noDirectives)  {\n\t\t\treturn $('<div/>').append(this.renderByText(text, data, noDirectives)).html();\n\t\t},\n\n\t\t/**\n\t\t * Compiles specified template\n\t\t * @param {string} name Template name\n\t\t */\n\t\tcompile: function(name) {\n\n\t\t\t/* If already compiled */\n\t\t\tif(templatesCompiled[name])\n\t\t\t\treturn;\n\n\t\t\t/* Load */\n\t\t\tthis.load(name);\n\n\t\t\t/* Compile */\n\t\t\tlet compiled = twig({ id: name, data: templatesList[name] });\n\n\t\t\t/* Check */\n\t\t\tif(!compiled)\n\t\t\t\tthrow new exceptions.system.Error('Error during compiling template \"' + name + '\"');\n\n\t\t\t/* Save */\n\t\t\ttemplatesCompiled[name] = compiled;\n\n\t\t},\n\n\t\t/**\n\t\t * Loads specified template\n\t\t * @param {string} name Template name\n\t\t */\n\t\tload: function(name) {\n\n\t\t\t/* Loaded */\n\t\t\tlet fromLS;\n\n\t\t\t/* Try to load from storage */\n\t\t\tif(!templatesList[name] && this.storage && (fromLS = this.storage.load(name)))\n\t\t\t\treturn templatesList[name] = fromLS;\n\n\t\t\t/* If already compiled */\n\t\t\tif(templatesList[name])\n\t\t\t\treturn templatesList[name];\n\n\t\t\t/* Load template */\n\t\t\tif(!(templatesList[name] = $('script[type=\"text/template\"][id='+ name +']').html()))\n\t\t\t\tthrow new exceptions.system.Error(\"Can't find template  \"  + name);\n\n\t\t\t/* Save to LS */\n\t\t\tif(this.storage)\n\t\t\t\tthis.storage.save(name, { template: templatesList[name] });\n\n\t\t\t/* Return */\n\t\t\treturn templatesList[name]\n\n\t\t}\n\n\t};\n\n\t/**\n\t * Load templates on ready\n\t */\n\t$(document).on(\"ready\", sky.func(function() {\n\n\t\t/* Find templates and save them */\n\t\t$('script[type=\"text/template\"]').each(function() {\n\t\t\tlet self = $(this);\n\t\t\tTemplates.add({\n\t\t\t\tname        : self.attr('id'),\n\t\t\t\ttemplate    : self.html()\n\t\t\t\t//dependencies: self.attr('dependencies') ? self.attr('dependencies').replace(\" \", \"\").split(\",\") : false\n\t\t\t});\n\t\t});\n\n\t\t/* Save templates files data */\n\t\tif(window.page.data[\"templates\"] && Templates.storage) {\n\t\t\t$.each(window.page.data[\"templates\"], function() {\n\t\t\t\t$.cookie(\"storedTemplates-\" + this.path, this.date);\n\t\t\t});\n\t\t}\n\n\t}));\n\n});\n","sky.service(\"tips\", [\"stackList\", \"callbacks\"], function({ stackList, callbacks }) {\n\n    /** Class to work with tips */\n    let list = stackList(),\n        tips = this.service = {\n\n        /**\n         * Hides all visible tips\n         * @param withoutAutoHide\n         */\n        hideAll: function(withoutAutoHide) {\n\n            /* Hide all tips */\n            $.each(list.elements(), function(_, tip) {\n                if(withoutAutoHide || tip.autoHide)\n                    this.hide();\n            });\n\n        },\n\n        /**\n         * Returns last open window if any\n         * @returns {tips.Tip|boolean}\n         */\n        getLast: function() {\n            list.last();\n        },\n\n        /**\n         * Add show/hide functions\n         * @param {string}            selector            Object to bind tips for\n         * @param {string}            align                Align of tip\n         * @param options\n         * @see tips.tip\n         */\n        bind: function(selector, align, options) {\n\n            /* Create binds */\n            $(selector).on({\n                \"mouseenter\": function() {\n                    let tip = $(this).data(\"tip\") || tips.Tip(this, options).show(align);\n                },\n                \"mouseleave\": function() {\n                    let tip = $(this).data(\"tip\");\n                    if(tip) tip.hide(align);\n                }\n            });\n\n        },\n\n        /**\n         * Creates new tip object\n         * @param {object}            object                Object to show tip for\n         * @param autoHide\n         * @param create\n         * @param close\n         * @param ajax\n         * @param highlight\n         * @constructor\n         */\n        Tip: function(object, { autoHide = true, create = false, close = false, ajax = false, highlight = false } = {}) {\n\n            /* Auto construct */\n            if(!(this instanceof tips.Tip))\n                return new tips.Tip(object, { autoHide, create, close, ajax, highlight });\n\n            /* Manual create tip by create function */\n            if(typeof create === \"function\") {\n\n                /* Create tip */\n                this.tip = create(object);\n\n                /* If no tip */\n                if(!this.tip) return this;\n\n            }\n\n            /* Object set */\n            this.object = $(object).data(\"tip\", this);\n\n            /* Save callbacks */\n            this.callbacks = callbacks();\n\n            /* Auto hide */\n            this.autoHide = autoHide;\n\n            /* Manual create tip by create function */\n            if(typeof create !== \"function\") {\n\n                /* Create tip */\n                this.tip = $(\"<div/>\").addClass(\"tip\").append('<div class=\"tipContent\"></div>').insertBefore(object);\n\n                /* Title using */\n                if(!create && this.object.attr('title'))\n\t\t\t\t\tcreate = this.object.attr('title');\n                else if(!create)\n\t\t\t\t\tcreate = \" \";\n\n                this.tip.find(\".tipContent\").append(create);\n\n            }\n\n            if(highlight)\n                this.shadow = $('<div/>').css({ opacity: 0, position:\"absolute\", width: \"100%\", height: \"100%\", left:0 ,top:0, background: \"rgba(0,0,0,0.5)\" }).appendTo(\"body\");\n\n            /* If count down */\n            if(typeof close === \"number\")\n                this.closeTimeout = setTimeout(() => this.hide(), close);\n\n            /* If close button */\n            else if(close)\n                $('<div/>').addClass('close').appendTo(this.tip).on(\"click\", () => this.hide());\n\n            /* If stop possible */\n            if(ajax)  ajax.on(\"always\", () => this.hide());\n\n            /* Add to list */\n            this.tip.css(\"display\", \"none\");\n\t\t\tlist.add(this);\n            return this;\n\n        }\n\n    };\n\n    /**\n     * Extends tip\n     */\n    $.extend(tips.Tip.prototype, /** @lends tips.tip */ {\n\n        /**\n         * Shows tip according to type\n         * @param {string} [align] Way it would be shown\n         */\n        show: function(align) {\n\n            /* Back link */\n            let self   = this;\n            let offset = this.tip.css({left: \"\", top: \"\", marginLeft: \"\", marginTop: \"\", display: \"\"}).offset();\n\n            /* Stop animation and shows */\n            this.tip.stop();\n\n            /* Save way to show */\n            if(align) this.align = align;\n\n            /* If shadow */\n            if(this.shadow)\n                this.shadow.stop().show().animate({opacity: 1}, 100);\n\n            /* Different actions according to tip position */\n            switch(this.align) {\n\n                /* If show righter than input */\n                case \"right\":\n                {\n                    this.tip.addClass(\"right\").css({\n                        marginLeft: this.object.offset().left + this.object.outerWidth() - offset.left,\n                        marginTop : this.object.offset().top - offset.top + parseInt((this.object.outerHeight() - this.tip.outerHeight()) / 2),\n                        opacity   : 0\n                    });\n                    this.tip.animate({opacity: 1, marginLeft: \"+=10\"}, 100);\n                    break;\n                }\n                /* If show righter than input */\n                case \"left\":\n                {\n                    this.tip.addClass(\"left\").css({\n                        marginLeft: this.object.offset().left - offset.left - this.tip.outerWidth(),\n                        marginTop : this.object.offset().top - offset.top + parseInt((this.object.outerHeight() - this.tip.outerHeight()) / 2),\n                        opacity   : 0\n                    });\n                    this.tip.animate({opacity: 1, marginLeft: \"-=10\"}, 300);\n                    break;\n                }\n                /* If show topper */\n                case \"top\":\n                {\n\n                    // Count left offset\n                    let left = this.object.offset().left - offset.left;\n\n                    /* Reposition */\n                    if(offset.left + left + this.tip.outerWidth() > $(window).outerWidth())\n                        left = left - this.tip.outerWidth() + this.object.outerWidth();\n\n                    /* Position */\n                    this.tip.addClass(\"top\").css({\n                        marginLeft: left,\n                        marginTop : this.object.offset().top - this.tip.outerHeight() - offset.top,\n                        opacity   : 0\n                    });\n\n                    this.tip.animate({opacity: 1, marginTop: \"-=10\"}, 300);\n                    break;\n                }\n                /* If show topper */\n                case \"bottom\":\n                {\n\n                    let left = this.object.offset().left - offset.left;\n\n                    /* Reposition */\n                    if(offset.left + left + this.tip.outerWidth() > $(window).outerWidth())\n                        left = left - this.tip.outerWidth() + this.object.outerWidth();\n\n                    /* Position */\n                    this.tip.addClass(\"bottom\").css({\n                        marginLeft: left,\n                        marginTop : this.object.offset().top + this.object.outerHeight() - offset.top,\n                        opacity   : 0\n                    });\n\n                    this.tip.animate({opacity: 1, marginTop: \"+=10\"}, 300);\n                    break;\n                }\n                /* If we replace input with tip */\n                case \"instead\":\n                {\n                    this.tip.css({\n                        width  : this.object.outerWidth(),\n                        height : this.object.outerHeight(),\n                        display: \"none\"\n                    });\n                    this.object.fadeOut(100, function() {\n                        self.tip.fadeIn(100);\n                    }).get(0).blur();\n                    break;\n                }\n                case \"inside\":\n                {\n                    this.tip.css({\n                        width  : this.object.outerWidth(),\n                        height : this.object.outerHeight(),\n                        display: \"none\"\n                    });\n                    this.tip.css(\"opacity\", 0).animate({opacity: 1}, 100);\n                    break;\n                }\n                default:\n                    break;\n            }\n\n            this.tip.css({left: \"\", top: \"\"});\n\n            /* Self return */\n            return this;\n\n        },\n\n        /**\n         * Hides current tip\n         */\n        hide: function() {\n\n            /* Remove count down if needed */\n            if(this.closeTimeout)\n                clearTimeout(this.closeTimeout);\n\n            /* Stop animation */\n            this.tip.stop();\n\n            /* Get know how tip was shown */\n            let align = this.align;\n\n            /* Create end animation callback */\n            let callback = () => {\n\n                /* Delete record from global list */\n                list.remove(this);\n\n                /* Remove data */\n                this.object.removeData(\"tip\");\n\n                /* Remove tip */\n                this.tip.remove();\n\n                /* Callback */\n                this.callbacks.fire(\"hide\", this);\n\n            };\n\n            /* If just shown */\n            if(!align)\n                callback();\n\n            /* If shadow */\n            if(this.shadow)\n                this.shadow.animate({opacity: 0}, 100, () => { this.shadow.remove() });\n\n            /* Right way hide */\n            if(align === \"right\")\n                this.tip.animate({opacity: 0, marginLeft: \"+=10\"}, 100, callback);\n\n            /* Left way hide */\n            if(align === \"left\")\n                this.tip.animate({opacity: 0, marginLeft: \"-=10\"}, 100, callback);\n\n            /* Instead way hide */\n            if(align === \"instead\")\n                this.tip.fadeOut({opacity: 0}, 200, callback);\n\n            /* Top way hide */\n            if(align === \"top\")\n                this.tip.animate({opacity: 0, marginTop: \"-=5\"}, 200, callback);\n\n            /* Bottom way hide */\n            if(align === \"bottom\")\n                this.tip.animate({opacity: 0, marginTop: \"+=5\"}, 200, callback);\n\n            /* Inside way hide */\n            if(align === \"inside\")\n                this.tip.animate({opacity: 0}, 200, callback);\n\n            /* Self return */\n            return this;\n\n        },\n\n        /**\n         * Gets tips dom\n         * @returns {*}\n         */\n        get: function() {\n            return this.tip;\n        },\n\n        /**\n         * Sets tip text\n         * @param {string|jQuery} text What to insert to tip body\n         */\n        set: function(text) {\n            this.tip.children(\".tipContent\").html(text);\n            return this;\n        },\n\n        /**\n         * Adds something to tip\n         * @param {string|jQuery} what What to append to tip body\n         */\n        add: function(what) {\n            this.tip.children(\".tipContent\").append(what);\n            return this;\n        }\n\n    });\n\n});","sky.service(\"utils\", function() {\n\t$.extend(sky, this.service = {\n\n\n\n\t\t/**\n\t\t * Checks if object has same data\n\t\t * @param first\n\t\t * @param second\n\t\t */\n\t\tisObjectsEqual: function(first, second) {\n\n\t\t\t/* Different types */\n\t\t\tif(typeof first !== typeof second)\n\t\t\t\treturn false;\n\n\t\t\t/* If object or array we will compare each element */\n\t\t\tif(first instanceof Array || first instanceof Object) {\n\t\t\t\tlet key;\n\t\t\t\t/* Check first */\n\t\t\t\tfor(key in first) {\n\t\t\t\t\tif(!first.hasOwnProperty(key)) continue;\n\t\t\t\t\tif(typeof second[key] === \"undefined\") return false;\n\t\t\t\t\telse if(!this.isObjectsEqual(first[key], second[key])) return false;\n\t\t\t\t}\n\n\t\t\t\t/* Check second */\n\t\t\t\tfor(key in second) {\n\t\t\t\t\tif(!second.hasOwnProperty(key)) continue;\n\t\t\t\t\tif(typeof first[key] === \"undefined\") return false;\n\t\t\t\t}\n\n\t\t\t} else if(first !== second) return false;    // For simple types\n\n\t\t\t/* All tests success */\n\t\t\treturn true;\n\n\t\t},\n\n\t\t/**\n\t\t * Adds zero\n\t\t * @param value\n\t\t * @returns {Number}\n\t\t */\n\t\taddLeadingZero: function(value) {\n\n\t\t\t/* Parse */\n\t\t\tvalue = parseInt(value);\n\n\t\t\t/* Ad zero */\n\t\t\tif(value < 10)\n\t\t\t\tvalue = \"0\" + value;\n\n\t\t\t/* Val */\n\t\t\treturn value;\n\n\t\t},\n\n\t\tencode: function(rawStr) {\n\t\t\treturn rawStr.replace(/[\\u00A0-\\u9999<>\\&]/gim, function(i) {\n\t\t\t\treturn '&#'+i.charCodeAt(0)+';';\n\t\t\t});\n\t\t},\n\n\t\t/**\n\t\t * Makes data to JSON past\n\t\t * @param data\n\t\t * @param [inputName]\n\t\t * @returns {string}\n\t\t */\n\t\tjsonData: function(data, inputName) {\n\t\t\treturn '<script type=\"application/json\"' + (inputName ? (' input-name=\"' + inputName + '\"') : \"\") + '>' + sky.encode(JSON.stringify(data)) + '</script>';\n\t\t},\n\n\t\tprepareSelectData: function(items, func, { columnSplitOn = 6, maxColumns = 4 }) {\n\n\t\t\tlet index = 0,\n\t\t\t\tgroupHolder,\n\t\t\t\tcompiled,\n\t\t\t\tcolumns = [],\n\t\t\t\tcolumnsCount = items.length / columnSplitOn;\n\n\t\t\tif(columnsCount < 1)\n\t\t\t\tcolumnsCount = 1;\n\t\t\tif(columnsCount > maxColumns)\n\t\t\t\tcolumnsCount = maxColumns;\n\n\t\t\tlet perColumn = Math.ceil(items.length / columnsCount);\n\n\t\t\t$.each(items, function(_, item) {\n\t\t\t\tif(compiled = func({ item, index, column: columns.length })) {\n\n\t\t\t\t\tif (index % perColumn === 0) {\n\t\t\t\t\t\tgroupHolder = [];\n\t\t\t\t\t\tcolumns.push(groupHolder);\n\t\t\t\t\t}\n\n\t\t\t\t\tgroupHolder.push(compiled);\n\t\t\t\t\tindex++;\n\t\t\t\t}\n\t\t\t});\n\n\t\t\treturn index === 0 ? [] : {groups: columns}\n\n\t\t}\n\t});\n});","sky.onReady(function({ validator }) {\n\tjQuery.fn.validForm = function() {\n\t\treturn validator.validateForm(this);\n\t}.safe();\n\tjQuery.fn.validationRule = function(name, options) {\n\t\treturn validator.addRule(this, name, options);\n\t}.safe();\n\t$(document).on(\"change keyup\", \"[data-validate]\", function() {\n\t\tvalidator.validateElement($(this));\n\t});\n});\n\nsky.service(\"validator\", function() {\n\n\t/**\n\t * Main validation object\n\t */\n\tlet validator = this.service = {\n\n\t\t/**\n\t\t * Validates specified form, or dom element\n\t\t * @param form\n\t\t */\n\t\tvalidateForm: function(form) {\n\n\t\t\tlet pass = true,\n\t\t\t\tself = this;\n\n\t\t\t/* Go through all elements that need to be validate */\n\t\t\tform.find(\"input, select, textarea, .selectReplace, [data-validate]\").filter(\":visible\").each(function() {\n\n\t\t\t\t/* Get element */\n\t\t\t\tlet element = $(this);\n\n\t\t\t\t/* validate if needed to */\n\t\t\t\tif(self.shouldBeValidated(element) && !self.validateElement(element, form))\n\t\t\t\t\tpass = false;\n\n\t\t\t});\n\n\t\t\t/* Return result */\n\t\t\treturn pass;\n\n\t\t},\n\n\t\t/**\n\t\t * Add rule to specified element\n\t\t * @param element\n\t\t * @param name\n\t\t * @param [options]\n\t\t */\n\t\taddRule: function(element, name, options) {\n\n\t\t\t/* Get or make options and add rule */\n\t\t\tthis.Options(element).addRule(name, options || {});\n\n\t\t\t/* Self return */\n\t\t\treturn this;\n\n\t\t},\n\n\t\t/**\n\t\t *\n\t\t * Validates specified element\n\t\t * @param {*} element Element to validate\n\t\t * @param {*} [form] Form to validate\n\t\t * @returns {boolean}\n\t\t */\n\t\tvalidateElement: function(element, form) {\n\n\t\t\tlet self = this,\n\t\t\t\toptions = this.Options(element),\n\t\t\t\ttotalPass = true,\n\t\t\t\tvalue = element.val(),\n\t\t\t\tlastError = false,\n\t\t\t\tfirstError = false,\n\t\t\t\tlastSuccess = false,\n\t\t\t\tfirstSuccess = false;\n\n\t\t\t/* Select replace */\n\t\t\tif(element.is(\".selectReplace\")) {\n\t\t\t\tlet inputs = element.next().find(\"input:checked\");\n\t\t\t\tif(!inputs.length)\n\t\t\t\t\tvalue = \"\";\n\t\t\t\telse if(element.is(\".single\"))\n\t\t\t\t\tvalue = element.next().find(\"input:checked\").val();\n\t\t\t\telse\n\t\t\t\t\tvalue = element.next().find(\"input:checked\").length ? \"true\" : \"\";\n\t\t\t}\n\n\t\t\t/* Go through rules */\n\t\t\t$.each(options.rules, function(name, ruleOverload) {\n\n\t\t\t\t/* Make compiled rule */\n\t\t\t\tlet compiledRule = jQuery.extend(true, {}, self.rules[name] || self.Rule({}), ruleOverload || {});\n\n\t\t\t\t/* Execute message is needed */\n\t\t\t\tif(typeof compiledRule.message === \"function\")\n\t\t\t\t\tcompiledRule.message = compiledRule.message.call(this);\n\n\t\t\t\t/* Check if element pass validation */\n\t\t\t\tlet pass = self.validate(value, compiledRule, element, form);\n\n\t\t\t\t/* Perform action according to result */\n\t\t\t\tif(pass) {\n\t\t\t\t\tcompiledRule.onSuccess(element, compiledRule);\n\t\t\t\t\tlastSuccess = compiledRule;\n\t\t\t\t\tif(!firstSuccess)\n\t\t\t\t\t\tfirstSuccess = compiledRule;\n\t\t\t\t} else {\n\t\t\t\t\tcompiledRule.onError(element, compiledRule);\n\t\t\t\t\tlastError = compiledRule;\n\t\t\t\t\tif(!firstError)\n\t\t\t\t\t\tfirstError = compiledRule;\n\t\t\t\t\ttotalPass = false;\n\t\t\t\t}\n\n\t\t\t});\n\n\t\t\t/* Total callbacks */\n\t\t\tif(totalPass)\n\t\t\t\toptions.onSuccess(element, lastSuccess);\n\t\t\telse\n\t\t\t\toptions.onError(element, firstError);\n\n\t\t\t/* Return true of element passed all validations */\n\t\t\treturn totalPass;\n\n\t\t},\n\n\t\t/**\n\t\t * Return true if element should be validated\n\t\t * @param {*} element Element to validate\n\t\t * @returns {boolean}\n\t\t */\n\t\tshouldBeValidated: function(element) {\n\t\t\treturn element.attr(\"data-validate\") || element.data(\"validationOptions\");\n\t\t},\n\n\t\t/**\n\t\t * Return true if element passed validation\n\t\t * @param element\n\t\t * @param compiledRule\n\t\t * @param form\n\t\t * @returns {*}\n\t\t * @param value\n\t\t */\n\t\tvalidate: function(value, compiledRule, element, form) {\n\t\t\treturn compiledRule.rule.call(compiledRule, value, element, form);\n\t\t}\n\n\t};\n\n\t/**\n\t * Defaults\n\t */\n\tvalidator.ruleDefaults = {\n\n\t};\n\n\t/**\n\t * Defaults\n\t * @type {{onSuccess: onSuccess, onError: onError}}\n\t */\n\tvalidator.optionsDefaults = {\n\n\t\t/* Fires on success */\n\t\tonSuccess: function(element) {\n\n\t\t\t/* Remove error */\n\t\t\telement.removeClass(this.errorClass);\n\n\t\t\t/* Add success */\n\t\t\tif(this.successClass)\n\t\t\t\telement.addClass(this.successClass);\n\n\t\t},\n\n\t\t/* Fires on error */\n\t\tonError: function(element) {\n\n\t\t\t/* Add error */\n\t\t\telement.addClass(this.errorClass);\n\n\t\t\t/* Remove success */\n\t\t\tif(this.successClass)\n\t\t\t\telement.removeClass(this.successClass);\n\n\t\t}\n\t};\n\n\t/**\n\t * Base rule object\n\t * @param overload\n\t * @returns {validator.Rule}\n\t * @constructor\n\t */\n\tvalidator.Rule = function(overload) {\n\n\t\t/* Self creation if needed */\n\t\tif(!(this instanceof validator.Rule))\n\t\t\treturn new validator.Rule(overload);\n\n\t\t/* Dump rule to check validation */\n\t\tthis.rule = function() { return true; };\n\n\t\t/* Dump message */\n\t\tthis.message = \"    \";\n\n\t\t/* List of options to make validation according to */\n\t\tthis.options = [];\n\n\t\t/* Fires on success */\n\t\tthis.onSuccess = function(element) {};\n\n\t\t/* Fires on error */\n\t\tthis.onError = function(element) {};\n\n\t\t/* Self extend with overload */\n\t\tjQuery.extend(this, overload);\n\n\t\t/* Return */\n\t\treturn this;\n\n\t};\n\n\t/**\n\t * List of default rules\n\t * @type {{required: validator.Rule}}\n\t */\n\tvalidator.rules = {\n\t\trequired: validator.Rule({\n\t\t\trule: function(value) {\n\t\t\t\treturn !!value.length;\n\t\t\t},\n\t\t\tmessage: \"   \"\n\t\t}),\n\t\trequiredIfFilled: validator.Rule({\n\t\t\trule: function(value) {\n\t\t\t\tlet item = $(this.options[0]);\n\t\t\t\treturn item.is(\":radio, :checkbox\") ? !item.is(\":checked\") || value : item.val() === \"\" || value;\n\t\t\t},\n\t\t\tmessage: \"   \"\n\t\t}),\n\t\tdate: validator.Rule({\n\t\t\trule: function(value) {\n\t\t\t\treturn !value || (\n\t\t\t\t\tvalue.match(/^\\d{4}-\\d{2}-\\d{2}( \\d{2}:\\d{2}(:\\d{2})?)?$/) ||\n\t\t\t\t\tvalue.match(/^\\d{2}.\\d{2}.\\d{4}( \\d{2}:\\d{2}(:\\d{2})?)?$/)\n\t\t\t\t\t);\n\t\t\t},\n\t\t\tmessage: \"  \"\n\t\t}),\n\t\tperiod: validator.Rule({\n\t\t\trule: function(value) {\n\t\t\t\treturn !value || (\n\t\t\t\t\tvalue.match(/^\\d{4}-\\d{2}-\\d{2}$/) ||\n\t\t\t\t\tvalue.match(/^\\d{2}.\\d{2}.\\d{4}$/) ||\n\t\t\t\t\tvalue.match(/^\\d{2}.\\d{2}.\\d{4}\\s*-\\s*\\d{2}.\\d{2}.\\d{4}$/) ||\n\t\t\t\t\tvalue.match(/^\\d{4}-\\d{2}-\\d{2}\\s*-\\s*\\d{4}-\\d{2}-\\d{2}$/)\n\t\t\t\t\t);\n\t\t\t},\n\t\t\tmessage: \"  \"\n\t\t}),\n\t\temail: validator.Rule({\n\t\t\trule: function(value) {\n\t\t\t\treturn value && value.match(/[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*@(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?/);\n\t\t\t},\n\t\t\tmessage: \"   \"\n\t\t}),\n\t\tsame: validator.Rule({\n\t\t\trule: function(value) {\n\t\t\t\treturn value === $('[name=\"' + this.options[0] + '\"]').val();\n\t\t\t},\n\t\t\tmessage: \"  \"\n\t\t}),\n\t\turl: validator.Rule({\n\t\t\trule: function(value) {\n\t\t\t\treturn value === \"\" || value.match(/^(https?:\\/\\/.+)$/);\n\t\t\t},\n\t\t\tmessage: \"   URI\"\n\t\t}),\n\t\tregexp: validator.Rule({\n\t\t\trule: function(value) {\n\t\t\t\treturn value === \"\" || value.match(new RegExp(this.options[0]));\n\t\t\t},\n\t\t\tmessage: \"  \"\n\t\t}),\n\t\tnumeric: validator.Rule({\n\t\t\trule: function(value) {\n\t\t\t\treturn value === \"\" || value.match(/^-?[0-9]+(\\.[0-9]+)?$/);\n\t\t\t},\n\t\t\tmessage: \" \"\n\t\t}),\n\t\tpositive: validator.Rule({\n\t\t\trule: function(value) {\n\t\t\t\treturn value === \"\" || value.match(/^[0-9]+(\\.[0-9]+)?$/) && parseFloat(value) > 0;\n\t\t\t},\n\t\t\tmessage: \"  \"\n\t\t}),\n\t\tmax: validator.Rule({\n\t\t\trule: function(value) {\n\t\t\t\treturn value === \"\" || value.match(/^[0-9]+(\\.[0-9]+)?$/) && parseFloat(value) <= parseFloat(this.options[0] || 0);\n\t\t\t},\n\t\t\tmessage: function() {\n\t\t\t\treturn \" ,    \" + (this.options[0] || 0)\n\t\t\t}\n\t\t}),\n\t\tmin: validator.Rule({\n\t\t\trule: function(value) {\n\t\t\t\treturn value === \"\" || value.match(/^[0-9]+(\\.[0-9]+)?$/) && parseFloat(value) >= parseFloat(this.options[0] || 0);\n\t\t\t},\n\t\t\tmessage: function() {\n\t\t\t\treturn \" ,    \" + (this.options[0] || 0);\n\t\t\t}\n\t\t}),\n\t\tminLength: validator.Rule({\n\t\t\trule: function(value) {\n\t\t\t\treturn value === \"\" || value.length >= (this.options[0] || 0)\n\t\t\t},\n\t\t\tmessage: \"    \"\n\t\t}),\n\t\tmaxLength: validator.Rule({\n\t\t\trule: function(value) {\n\t\t\t\treturn value === \"\" || value.length <= (this.options[0] || 0)\n\t\t\t},\n\t\t\tmessage: \"     \"\n\t\t})\n\t};\n\n\t/**\n\t * Holds element validation options\n\t * @param element\n\t * @constructor\n\t */\n\tvalidator.Options = function(element) {\n\n\t\t/* Create or return */\n\t\tif(!(this instanceof validator.Options))\n\t\t\treturn element.data(\"validationOptions\") || new validator.Options(element);\n\n\t\t/* Callbacks after all checks */\n\t\tthis.onSuccess = function() {};\n\t\tthis.onError = function() {};\n\n\t\t/* Adds to element on success */\n\t\tthis.successClass = false;\n\n\t\t/* Adds to element on error */\n\t\tthis.errorClass   = \"error\";\n\n\t\t/* Overlay defaults */\n\t\tjQuery.extend(true, this, validator.optionsDefaults);\n\n\t\t/* Holds list of validating rules */\n\t\tthis.rules = {};\n\n\t\t/* Save element */\n\t\tthis.element = element;\n\n\t\t/* Get rules that declared in element definition */\n\t\tthis.getDeclaredRules();\n\n\t\t/* Save option */\n\t\tthis.element.data(\"validationOptions\", this);\n\n\t\t/* Self return */\n\t\treturn this;\n\n\t};\n\n\tvalidator.Options.prototype = {\n\n\t\t/**\n\t\t * Gets list of rules that are set in declared way\n\t\t */\n\t\tgetDeclaredRules: function() {\n\n\t\t\t/* Get attribute value */\n\t\t\tlet attr = this.element.attr(\"data-validate\"),\n\t\t\t\tself = this;\n\n\t\t\t/* If none */\n\t\t\tif(!attr)\n\t\t\t\treturn;\n\n\t\t\t/* Get list */\n\t\t\t$.each(attr.split(\";\"), function(_, name) {\n\n\t\t\t\t/* Get parameters */\n\t\t\t\tlet params = name.match(/(\\w+)\\((.*)\\)/);\n\n\t\t\t\t/* Parse */\n\t\t\t\tif(params) {\n\n\t\t\t\t\t/* Get function */\n\t\t\t\t\tname = params[1];\n\n\t\t\t\t\t/* Parse params */\n\t\t\t\t\tparams = params[2].match(/(('[^']+')|([\\d\\w]+))/g);\n\t\t\t\t\t$.each(params, function(i, val) {\n\t\t\t\t\t\tparams[i] = eval(val.trim());\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\t/* Add rule to options */\n\t\t\t\tself.addRule(name.trim(), { options: params || [] });\n\n\t\t\t});\n\n\n\t\t},\n\n\t\t/**\n\t\t * Adds new rule for element\n\t\t * @param {string} name Rule name\n\t\t * @param {object} options Rule options\n\t\t * @returns {validator.Options}\n\t\t */\n\t\taddRule: function(name, options) {\n\n\t\t\t/* Create and save new rule */\n\t\t\tthis.rules[name] = jQuery.extend({}, validator.ruleDefaults, options);\n\n\t\t\t/* Mark for auto validation */\n\t\t\tif(!this.element.attr(\"data-validate\"))\n\t\t\t\tthis.element.attr(\"data-validate\", \"true\");\n\n\t\t\t/* Self returning */\n\t\t\treturn this;\n\t\t}\n\n\t}\n\n});","sky.service(\"visibleCalculator\", function() {\n\n\tlet Calculator = this.service = class {\n\n\t\tconstructor(holder, minHeight, scrollable) {\n\n\t\t\t/* Check if class */\n\t\t\tif(!(this instanceof Calculator))\n\t\t\t\treturn new Calculator(holder, minHeight, scrollable);\n\n\t\t\t/* Re get holder */\n\t\t\tthis.holder = $(holder);\n\t\t\tthis.scrollable = scrollable;\n\t\t\tthis.minHeight = minHeight;\n\n\t\t\t/* Init */\n\t\t\tthis.init();\n\n\t\t}\n\n\t\t/* Init func */\n\t\tinit() {\n\n\t\t\t/* Count offset */\n\t\t\tlet offset = this.holder.offset();\n\n\t\t\t/* Get holder rect */\n\t\t\tthis.holderRect = {\n\t\t\t\tleft  : offset.left,\n\t\t\t\ttop   : offset.top,\n\t\t\t\twidth : this.holder.outerWidth(),\n\t\t\t\theight: this.holder.outerHeight()\n\t\t\t};\n\n\t\t}\n\n\t\t/* Calculating function */\n\t\tcalculate() {\n\n\t\t\t/* How much is scrolled */\n\t\t\tlet scrollTop    = $(this.scrollable).scrollTop(),\n\t\t\t\twindowHeight = $(window).height(),\n\t\t\t\twindowWidth  = $(window).width(),\n\t\t\t\tsizes        = {\n\t\t\t\t\tleft        : this.holderRect.left,\n\t\t\t\t\tright       : this.holderRect.left + this.holderRect.width,\n\t\t\t\t\ttop         : this.holderRect.top - scrollTop,\n\t\t\t\t\twidth       : this.holderRect.width,\n\t\t\t\t\theight      : this.holderRect.height,\n\t\t\t\t\trealHeight  : this.holderRect.height,\n\t\t\t\t\tscrollTop   : scrollTop,\n\t\t\t\t\tscrollLeft  : 0,\n\t\t\t\t\twindowHeight: windowHeight,\n\t\t\t\t\twindowWidth : windowWidth,\n\t\t\t\t};\n\n\t\t\t/* Min height */\n\t\t\tif(sizes.height < this.minHeight)\n\t\t\t\tsizes.height = this.minHeight;\n\n\t\t\t/* Count bottom */\n\t\t\tsizes.bottom = sizes.top + sizes.height;\n\n\t\t\t/* If top border near than holder */\n\t\t\tif(sizes.top < 0) {\n\t\t\t\t// If visible less than min\n\t\t\t\tif(sizes.bottom < this.minHeight) {\n\t\t\t\t\tsizes.bottom = sizes.bottom < 0 ? 0 : sizes.bottom;\n\t\t\t\t\tsizes.top = sizes.bottom - this.minHeight;\n\t\t\t\t\tsizes.height = this.minHeight;\n\t\t\t\t}\n\t\t\t\t// If visible more than min\n\t\t\t\telse {\n\t\t\t\t\tsizes.height = sizes.bottom;\n\t\t\t\t\tsizes.top = 0;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t/* Get visible bottom */\n\t\t\tif(windowHeight < sizes.bottom) {\n\t\t\t\t// If visible less than min\n\t\t\t\tif(windowHeight - sizes.top < this.minHeight) {\n\t\t\t\t\tsizes.height = this.minHeight;\n\t\t\t\t\tsizes.top = windowHeight - sizes.top < 0 ? 0 : sizes.top;\n\t\t\t\t\tsizes.bottom = sizes.top + this.minHeight;\n\t\t\t\t}\n\t\t\t\t// If visible more than min\n\t\t\t\telse {\n\t\t\t\t\tsizes.height = windowHeight - sizes.top;\n\t\t\t\t\tsizes.bottom = 0;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t/* Return */\n\t\t\treturn sizes;\n\n\t\t}\n\n\t\tgetDropOffset(replace, popup) {\n\n\t\t\t/* Get drop */\n\t\t\tif(!popup.is(\":visible\")) return;\n\n\t\t\t/* Set position to zeros to get max width and height */\n\t\t\tpopup.removeClass('hidden').css({left: 0, top: 0});\n\n\t\t\t/* Init */\n\t\t\tlet popupWidth  = popup.outerWidth(),\n\t\t\t\tpopupHeight = popup.outerHeight();\n\n\t\t\t/* Reset position */\n\t\t\tpopup.css({marginLeft: \"\", marginTop: \"\", width: \"\", left: \"\", top: \"\"});\n\n\t\t\t/* Init */\n\t\t\tlet win            = $(window),\n\t\t\t\treplaceOffset  = replace.offset(),\n\t\t\t\tpopupOffset    = popup.offset(),\n\t\t\t\tleftDifference = popupOffset.left - replaceOffset.left,\n\t\t\t\ttopDifference  = popupOffset.top - replaceOffset.top,\n\t\t\t\tmiddle         = false,\n\t\t\t\tvisible        = this.calculate();\n\n\t\t\t// Drop down\n\t\t\tif(visible.bottom + popupHeight >= visible.windowHeight)\n\t\t\t\tpopup.css(\"marginTop\", topDifference + visible.realHeight + 1);\n\t\t\t// Drop up\n\t\t\telse if(visible.top > popupHeight)\n\t\t\t\tpopup.css(\"marginTop\", -topDifference - 1);\n\t\t\t// Drop left\n\t\t\telse {\n\t\t\t\tpopup.css(\"marginTop\", -topDifference - (popupHeight - visible.realHeight) / 2);\n\t\t\t\tmiddle = true;\n\t\t\t}\n\n\n\t\t\t/* Set position */\n\t\t\tif(!middle) {\n\t\t\t\tif(visible.windowWidth > visible.left + popupWidth)\n\t\t\t\t\tpopup.css(\"marginLeft\", leftDifference);\n\t\t\t\telse\n\t\t\t\t\tpopup.css(\"marginLeft\", leftDifference - popupWidth + visible.width);\n\t\t\t} else {\n\n\t\t\t\tif(win.width() > selfOffset.left + popupWidth + selfWidth)\n\t\t\t\t\tpopup.css({\n\t\t\t\t\t\tmarginLeft: selfOffset.left - popupOffset.left + selfWidth\n\t\t\t\t\t});\n\t\t\t\telse\n\t\t\t\t\tpopup.css({\n\t\t\t\t\t\tmarginLeft: selfOffset.left - popupOffset.left - popupWidth\n\t\t\t\t\t});\n\n\t\t\t}\n\n\t\t}\n\t}\n\n})\n;","/**\n * Holds classes to work with modal/new windows\n */\nsky.service('windows', [\"templates\", \"callbacks\", \"stackList\"], function ({templates, callbacks, stackList}) {\n\n\tlet tips = false,\n\t\tlist = stackList(),\n\t\twindows = this.service = {\n\n\t\t\t/**\n\t\t\t * Returns last open window if any\n\t\t\t * @returns {windows.Modal|boolean}\n\t\t\t */\n\t\t\tgetLast: function () {\n\t\t\t\treturn list.last()\n\t\t\t},\n\n\t\t\t/**\n\t\t\t * Creates new modal window\n\t\t\t * @param {*} name Window name\n\t\t\t * @param {*} [data] Data to send with request\n\t\t\t */\n\t\t\tModal: function (name, data) {\n\n\t\t\t\t/* Self construct */\n\t\t\t\tif (!(this instanceof windows.Modal))\n\t\t\t\t\treturn new windows.Modal(name, data);\n\n\t\t\t\t/* Create window */\n\t\t\t\tthis.locked \t\t= false;\n\t\t\t\tthis.background \t= templates.render(\"windows-modal\", {}).appendTo(\"#pageContentHolder\").data(\"modalWindow\", this);\n\t\t\t\tthis.dataContainer \t= this.background.children();\n\t\t\t\tthis.holder \t\t= this.dataContainer.children(\".windowData\");\n\t\t\t\tthis.closeButton \t= this.dataContainer.children(\".close\");\n\n\t\t\t\t/* Make body un scrollable */\n\t\t\t\t$(document.body).css(\"overflow\", \"hidden\");\n\n\t\t\t\t/* Callbacks */\n\t\t\t\tthis.callbacks = callbacks();\n\n\t\t\t\t/* Render content */\n\t\t\t\ttry {\n\t\t\t\t\tthis.reRender(name, data);\n\t\t\t\t} catch (e) {\n\t\t\t\t\tthis.close(false);\n\t\t\t\t\tthrow e;\n\t\t\t\t}\n\n\t\t\t\t/* Return */\n\t\t\t\treturn this;\n\n\t\t\t}\n\n\t\t};\n\n\t/**\n\t * Modal window prototype\n\t */\n\twindows.Modal.prototype = {\n\n\t\t/**\n\t\t * Renders window content\n\t\t * @param {*} name Window name\n\t\t * @param {*} [data] Data to send with request\n\t\t */\n\t\treRender: function (name, data) {\n\n\t\t\t/* Close all tips */\n\t\t\tif(tips) tips.hideAll(true);\n\n\t\t\t/* Clear */\n\t\t\tthis.holder.html('');\n\n\t\t\t/* Render content */\n\t\t\tif (name instanceof jQuery)\n\t\t\t\tthis.template = name.appendTo(this.holder);\n\t\t\telse if (typeof name === \"string\")\n\t\t\t\tthis.template = templates.render(name, data).appendTo(this.holder);\n\n\t\t\t/* Self return */\n\t\t\treturn this;\n\t\t},\n\n\t\t/**\n\t\t * Removes all except that was rendered\n\t\t */\n\t\tclearExceptTemplate: function () {\n\t\t\tthis.holder.children().detach();\n\t\t\tthis.holder.append(this.template);\n\t\t},\n\n\t\t/**\n\t\t * Removes all except that was rendered\n\t\t */\n\t\tremoveMessages: function () {\n\t\t\tthis.holder.find(\".notificationMessage\").remove();\n\t\t\treturn this;\n\t\t},\n\n\t\t/**\n\t\t * Locks window so it can't be closed\n\t\t * @returns {windows.Modal}\n\t\t */\n\t\tlock: function (ajax) {\n\t\t\tthis.locked = true;\n\t\t\tthis.closeButton.hide();\n\t\t\tif (ajax) ajax\n\t\t\t\t.on(\"preSuccess\", function () {\n\t\t\t\t\tthis.dataContainer.css(\"height\", this.dataContainer.innerHeight());\n\t\t\t\t}, this)\n\t\t\t\t.on(\"notAbort\", function () {\n\t\t\t\t\tlet self = this;\n\t\t\t\t\tthis.unlock();\n\t\t\t\t\tthis.dataContainer.css(\"height\", this.holder.outerHeight());\n\t\t\t\t\tsetTimeout(function () {\n\t\t\t\t\t\tself.dataContainer.css(\"height\", \"\");\n\t\t\t\t\t}, 500)\n\t\t\t\t}, this)\n\t\t\t\t.on(\"abort\", function () {\n\t\t\t\t\tthis.unlock().close();\n\t\t\t\t}, this);\n\t\t\treturn this;\n\t\t},\n\n\t\t/**\n\t\t * Unlocks window so it can be closed\n\t\t * @returns {windows.Modal}\n\t\t */\n\t\tunlock: function () {\n\t\t\tthis.locked = false;\n\t\t\tthis.closeButton.show();\n\t\t\treturn this;\n\t\t},\n\n\t\t/**\n\t\t * Closes current window\n\t\t * @param {boolean} [byUser] Indicates that window was closed not by user\n\t\t */\n\t\tclose: function (byUser = false) {\n\n\t\t\t/* If windows is locked */\n\t\t\tif (this.locked)\n\t\t\t\treturn;\n\n\t\t\t/* Remove elements */\n\t\t\tthis.background.fadeOut(\"fast\", function () {\n\t\t\t\t$(this).remove()\n\t\t\t});\n\n\t\t\t/* Delete from list */\n\t\t\tlist.remove(this);\n\n\t\t\t/* Call close callback */\n\t\t\tthis.callbacks.fire(\"close\", {byUser: byUser});\n\n\t\t\t/* Close all tips */\n\t\t\tif(tips) tips.hideAll(true);\n\n\t\t\t/* Make body scrollable */\n\t\t\tif (list.total() < 1)\n\t\t\t\t$(document.body).css(\"overflow\", \"\");\n\n\t\t\treturn this;\n\n\t\t}\n\n\t};\n\n\ttry {\n\t\ttips = sky.service(\"tips\");\n\t} catch (e) {}\n\n\t/* Add handler to black area click */\n\t$(document)\n\t\t.on(\"keyup\", sky.func(function (event) {\n\t\t\tlet last;\n\n\t\t\t/* If slide show was disabled */\n\t\t\tif (document[\"webkitIsFullScreen\"] || document[\"mozIsFullScreen\"] || document[\"isFullScreen\"])\n\t\t\t\treturn;\n\n\t\t\t/* Close current window */\n\t\t\tif (event.keyCode === 27 && (last = windows.getLast()))\n\t\t\t\tlast.close(true);\n\n\t\t}));\n\n});","/**\n * Fire services init done\n */\nsky.exec(function() {\n\tsky.servicesDeferred.resolve();\n});","sky.action(\"pagination\", {\n\n\tsetPage: function(button, _, page) {\n\n\t\t/* Get pagination */\n\t\tlet pagination = button.parents(\".pagination\").data(\"pagination\");\n\n\t\t/* Correct page */\n\t\tif(page === \"next\")\n\t\t\tpage = pagination.current + 1;\n\n\t\t/* Correct  */\n\t\tif(page === \"previous\")\n\t\t\tpage = pagination.current - 1;\n\n\t\t/* Go to page */\n\t\tpagination.goToPage(page);\n\n\t},\n\n\tscrollTo: function(element, event) {\n\n\t\t/* Get pagination */\n\t\tlet pagination = element.parents(\".pagination\").data(\"pagination\");\n\n\t\t/* Move */\n\t\tpagination.scroll(event);\n\n\t},\n\n\tgrab: function(runner) {\n\n\t\t/* Get pagination */\n\t\tlet pagination = runner.parents(\".pagination\").data(\"pagination\");\n\n\t\t/* Binds */\n\t\t$(window)\n\t\t\t.on(\"mouseup.pagination\", function() {\n\t\t\t\t$(window).off(\"mouseup.pagination mousemove.pagination\");\n\t\t\t}).on(\"mousemove.pagination\", function(event) {\n\t\t\t\tpagination.scroll(event);\n\t\t\t});\n\n\t},\n\n\tnext: function(button, _) {\n\t\tthis.setPage(button, _, \"next\")\n\t},\n\n\tprevious: function(button, _) {\n\t\tthis.setPage(button, _, \"previous\")\n\t}\n\n});","sky.action(\"selectReplace\", function({ visibleCalculator }) {\n\n    let filter = function(self, event) {\n\n        /* Get drop */\n        let popup  = self.closest(\".selectReplaceChoose\"),\n            inputs = popup.find(\"input[name]\");\n\n        /* On enter */\n        if(event.which === 13) {\n            let visible = popup.find(\"label:visible\");\n            if(visible.length > 0) {\n                inputs.prop(\"checked\", false);\n                visible.children(\"input\").prop(\"checked\", true).trigger(\"change\");\n            }\n            event.stopPropagation();\n        }\n\n        /* Get value */\n\t\tlet value = self.val(),\n\t\t\t rus              = \"\",\n             eng              = \"qwertyuiop[]asdfghjkl;'\\\\zxcvbnm,.\",\n             expression       = new RegExp(value.toLowerCase()),\n             expressionInvert = new RegExp(value.toLowerCase().replace(/[a-z-]/g, (character) => {\n                if(rus.indexOf(character) > -1) return eng[rus.indexOf(character)];\n                if(eng.indexOf(character) > -1) return rus[eng.indexOf(character)];\n                return character;\n            }));\n\n        /* Hide */\n        for(let input of inputs) {\n\n            if(input.parent().hasClass('hidden'))\n                return;\n\n            let inputHtml = input.next().html().toLowerCase();\n\n            try {\n                if(!inputHtml.match(expression) && !inputHtml.match(expressionInvert)) input.parent().hide();\n                else input.parent().show();\n            } catch(e) {}\n\n        }\n    };\n\n    return {\n\n        filter: filter,\n\n        selectAll: function(button) {\n\n            /* Get drop */\n            let popup = button.closest(\".selectReplaceChoose\");\n            popup.find(\":checkbox:visible\").prop(\"checked\", true).first().trigger(\"change\");\n\n        },\n\n        unSelectAll: function(button) {\n\n            /* Get drop */\n            let popup = button.closest(\".selectReplaceChoose\");\n            popup.find(\":checkbox:visible\").prop(\"checked\", false).first().trigger(\"change\");\n\n        },\n\n        close: function(element, event) {\n            if(element.get(0) === event.target)\n                $(\".selectReplaceChoose\").addClass('hidden');\n        },\n\n        /**\n         * Shows drop down\n         * @param replace Input\n         */\n        drop: function (replace) {\n\n            /* Hide all */\n\t\t\t$(\".selectReplaceChoose\").addClass('hidden');\n\n            /* Get drop */\n            let popup = replace.next(),\n                dropOffset = visibleCalculator.getDropOffset(replace, popup);\n\n\t\t\t/* If visible just hide */\n\t\t\tif(dropOffset) {\n\t\t\t\tpopup.removeClass('hidden').css({ marginLeft: dropOffset.left, margintop: dropOffset.top });\n\n\t\t\t\tif(replace.outerWidth() > popup.outerWidth())\n\t\t\t\t\tpopup.css(\"width\", replace.outerWidth());\n\n                /* Search focus */\n\t\t\t\tif (popup.find(\".search\").length)\n\t\t\t\t\tpopup.find(\".search input\").val('').focus();\n\n            }\n\n        }\n    }\n});","sky.directive(\"[data-tip]\", function(button, attributes) {\n\n\t// Get\n\tlet events  = attributes[\"data-event\"] || \"\",\n\t\ttipName = attributes[\"data-tip\"],\n\t\tevent   = \"click: shared.showTip('\" + tipName + \"')\";\n\n\t// Set new\n\tevents = events ? event : events + \"; \" + event;\n\n\t// Add\n\tbutton.attr(\"data-event\", events).addClass(\"dashed\");\n\n});\nsky.directive(\"[data-tip-text]\", function(button, attributes) {\n\n\t// Get\n\tlet events  = attributes[\"data-event\"] || \"\",\n\t\ttipText = attributes[\"data-tip-hover\"] || attributes[\"data-tip-text\"],\n\t\tevent   = \"click: shared.showTipWithText('\" + tipText + \"')\";\n\n\t// Set new\n\tevents = events ? event : events + \"; \" + event;\n\n\t// Add\n\tbutton.attr(\"data-event\", events).addClass(\"dashed\");\n\n});\nsky.directive(\"[data-tip-hover]\", function(button, attributes) {\n\n\t// Get\n\tlet tipText = attributes[\"data-tip-hover\"];\n\n\tsky.service(\"tips\").bind(button, \"top\", {create: tipText});\n\n\t// Set new\n\tlet events = attributes[\"data-event\"] || \"\",\n\t\tevent  = \"click: shared.showTipWithText('\" + tipText + \"')\";\n\tevents = events ? event : events + \"; \" + event;\n\n\t// Add\n\tbutton.attr(\"data-event\", events).addClass(\"dashed\");\n\n});\nsky.directive(\"[data-suggests]\", function(element, attributes) {\n\telement.attr(\"data-event\", \"keyup: suggest.\" + attributes[\"data-suggests\"]).attr(\"autocomplete\", \"off\");\n});\nsky.directive(\"input.autoHttp\", function(input) {\n\tinput.on(\"focus\", function() {\n\t\tif(input.val() === \"\") input.val(\"http://\").get(0).selectionStart = 7;\n\t});\n});","sky.action(\"suggest\", function(suggester) {\r\n   return {\r\n       adverts: function(input, event) {\r\n\r\n           // Events\r\n           if(event.keyCode == 38 || event.keyCode == 40 || event.keyCode == 13 || event.keyCode == 27)\r\n               return;\r\n\r\n           // Stop if any other\r\n           if(this.suggestAjax)\r\n               this.suggestAjax.stop();\r\n\r\n           // Nothing\r\n           if(input.val() == \"\" || input.val().length < 2) {\r\n               suggester.hideAll();\r\n               return;\r\n           }\r\n\r\n           this.suggestAjax = sky.ajax(\"/ajax/members/search\", { name: input.val() })\r\n               .on(\"success\", function(response) {\r\n\r\n                   // No filtered\r\n                   if(!response.adverts || !response.adverts.length)\r\n                       suggester.hideAll();\r\n\r\n                   var filtered = [];\r\n\r\n                   $.each(response.adverts, function(_, advert) {\r\n                       filtered.push(advert.username);\r\n                   });\r\n\r\n                   // Show\r\n                   suggester.show(input, filtered);\r\n\r\n               }).on(\"error\", function() {\r\n                   suggester.hideAll();\r\n               });\r\n\r\n       },\r\n\r\n       campaigns: function(input, event){\r\n\r\n           // Events\r\n           if(event.keyCode == 38 || event.keyCode == 40 || event.keyCode == 13 || event.keyCode == 27)\r\n               return;\r\n\r\n           // Stop if any other\r\n           if(this.suggestAjax)\r\n               this.suggestAjax.stop();\r\n\r\n           // Nothing\r\n           if(input.val() == \"\" || input.val().length < 2) {\r\n               suggester.hideAll();\r\n               return;\r\n           }\r\n\r\n           this.suggestAjax = sky.ajax(\"/ajax/campaigns/search\", { name: input.val() })\r\n               .on(\"success\", function(response) {\r\n\r\n                   // No filtered\r\n                   if(!response.campaigns || !response.campaigns.length)\r\n                       suggester.hideAll();\r\n\r\n                   var filtered = [];\r\n\r\n                   $.each(response.campaigns, function(_, campaign) {\r\n\r\n                       filtered.push({ html: campaign.name });\r\n                   });\r\n\r\n                   // Show\r\n                   suggester.show(input, filtered);\r\n\r\n               }).on(\"error\", function() {\r\n                   suggester.hideAll();\r\n               });\r\n       },\r\n\r\n       campaignsSpecial: function(input, event){\r\n           // Events\r\n           if(event.keyCode == 38 || event.keyCode == 40 || event.keyCode == 13 || event.keyCode == 27)\r\n               return;\r\n\r\n           // Nothing\r\n           if(input.val() == \"\" || input.val().length < 2) {\r\n               suggester.hideAll();\r\n               return;\r\n           }\r\n\r\n           if(this.suggestAjax)\r\n               this.suggestAjax.stop();\r\n\r\n           this.suggestAjax = sky.ajax(\"/ajax/campaigns/search\", { name: input.val() })\r\n               .on(\"success\", function(response) {\r\n\r\n                   // No filtered\r\n                   if(!response.campaigns || !response.campaigns.length)\r\n                       suggester.hideAll();\r\n\r\n                   var filtered = [];\r\n\r\n                   $.each(response.campaigns, function(_, campaign) {\r\n\r\n                       filtered.push({ html: campaign.name+\" (\"+campaign.advert.username+\")\", callback: function(){\r\n                           sky.actions.perform(null, null, \"page.selectCampaign\", [campaign.id]);\r\n                       }});\r\n                   });\r\n\r\n                   // Show\r\n                   suggester.show(input, filtered);\r\n\r\n               }).on(\"error\", function() {\r\n                   suggester.hideAll();\r\n               });\r\n       }\r\n   }\r\n});","sky.directive(\".selectReplaceChoose\", function(popup, attrs) {\r\n\r\n\t\t/* Get inputs */\r\n\t\tlet labels = popup.find(\"label\"),\r\n\t\t\tinputs = popup.find(\"input:radio, input:checkbox\"),\r\n\t\t\tcurrent, change, children, replace = popup.prev(),\r\n\t\t\tval = \"\",\r\n            defaultValue = replace.html() || '-',\r\n            defaultAllValue = replace.text() || \"\";\r\n\r\n\t\treplace.data(\"addItem\", function(item) {\r\n\t\t\tvar newInput = sky.templates.renderByText(\"{% skyImport forms as forms %}{{ forms.selectReplaceGroup(items, options) }}\", { items: [item], options: {\r\n\t\t\t\tname: replace.attr(\"input\"),\r\n\t\t\t\tmultiple:  !replace.hasClass(\"single\")\r\n\t\t\t}});\r\n\t\t\tnewInput.insertAfter(inputs.filter(\":last\").parent());\r\n\t\t\tinputs = popup.find(\"input\");\r\n\t\t});\r\n\r\n\t\t/* On change */\r\n\t\t$(document).on(\"change\", '[data-input=\"'+ attrs[\"data-input\"] + '\"] input', change = function(event, data) {\r\n\r\n\t\t\t/* Remove selected styles */\r\n\t\t\tlabels.removeClass(\"selected\");\r\n\r\n\t\t\t/* Base text */\r\n\t\t\tval = \"\";\r\n\t\t\tchildren = false;\r\n\r\n\t\t\t/* Get checked */\r\n\t\t\tvar filtered = inputs.filter(\":checked\").each(function() {\r\n\t\t\t\tcurrent = $(this);\r\n\t\t\t\tcurrent.closest(\"label\").addClass(\"selected\");\r\n\t\t\t\tval = (val && val + \", \") + current.next().text();\r\n\t\t\t\tchildren = current.next();\r\n\t\t\t});\r\n\r\n\t\t\t/* Make text shorter */\r\n\t\t\tif(val.length > 26)\r\n\t\t\t\tval = val.substr(0, 26).trim() + \"...\";\r\n\r\n\t\t\tif(filtered.length === inputs.length && !popup.hasClass(\"single\"))\r\n\t\t\t\tval = defaultAllValue;\r\n\r\n\t\t\tif(popup.hasClass(\"single\") && children)\r\n\t\t\t\treplace.html('').prepend(children.clone().removeClass(\"name\"));\r\n\t\t\telse if(!children)\r\n\t\t\t\treplace.html(defaultValue);\r\n\t\t\telse\r\n\t\t\t\treplace.text(val);\r\n\r\n\t\t\t/* If not fake event */\r\n\t\t\tif(event && current) {\r\n                replace.trigger(\"change\", $.extend(data || {}, {\r\n                    value: current.val(),\r\n                    item: $(this)\r\n                }));\r\n            }\r\n\r\n            if(popup.hasClass(\"single\"))\r\n\t\t\t\t$(\".selectReplaceChoose\").addClass('hidden');\r\n\t\t});\r\n\r\n\t\t/* Trigger */\r\n\t\tsetTimeout(function() { change(false) }, 1);\r\n\r\n\t});\r\n\r\n\r\n$(document)\r\n\t.on(\"click touchstart\", function(event) {\r\n\r\n\t\t/* Get element */\r\n\t\tvar element = $(event.target || event.srcElement);\r\n\r\n\r\n\t\t/* If click in replace we should not hide it */\r\n\t\tif(element.closest(\".selectReplaceChoose\").length || element.closest(\".selectReplace\").length)\r\n\t\t\treturn;\r\n\r\n\t\t/* Hide all */\r\n\t\t$(\".selectReplaceChoose\").addClass('hidden');\r\n\r\n\t}).on(\"change\", \".specialSelect input\", function(event) {\r\n\t\tvar root = $(this).closest(\".specialSelect\");\r\n\t\troot.find(\".selected\").removeClass(\"selected\");\r\n\t\troot.find(\"input\").each(function() {\r\n\t\t\tvar self = $(this);\r\n\r\n\t\t\tif(self.is(\":checked\"))\r\n\t\t\t\tself.parent().addClass(\"selected\");\r\n\r\n\t\t});\r\n\r\n\t\t//root.closest(\"form\").trigger(\"submit\");\r\n\r\n\t}).on(\"mouseover\", \".selectReplaceChoose label\", function() {\r\n\r\n\t\tvar label = $(this);\r\n\t\tvar originalTip = label.find(\".checkItemTip\");\r\n\r\n\t\tif(originalTip.length && !label.data(\"tip\")) {\r\n\t\t\tvar popup = label.closest(\".selectReplaceChoose\");\r\n\t\t\tvar tip = originalTip.clone().removeClass(\"hidden\").appendTo(\"body\");\r\n\t\t\ttip.css({\r\n\t\t\t\tleft: popup.offset().left,\r\n\t\t\t\ttop: popup.offset().top + popup.outerHeight() + 5\r\n\t\t\t});\r\n\t\t\tlabel.data(\"tip\", tip);\r\n\t\t}\r\n\r\n\t}).on(\"mouseout\", \".selectReplaceChoose label\", function() {\r\n\r\n\t\tvar label = $(this);\r\n\r\n\t\tif(label.data(\"tip\")) {\r\n\t\t\tlabel.data(\"tip\").remove();\r\n\t\t\tlabel.removeData(\"tip\");\r\n\t\t}\r\n\r\n\t})\r\n\r\n;\r\n","/**\n * Fire project init done\n */\nsky.exec(function() {\n    $('body').removeClass(\"hidden\");\n    sky.projectDeffered.resolve();\n});"]}