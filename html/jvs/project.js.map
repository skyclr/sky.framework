{"version":3,"sources":["actions/actions.js","ajaxLoadingIndicator/ajaxLoadingIndicator.js","callbacks/callback.js","callbacks/callbacks.js","ajax/ajax.js","dataOperator/dataOperator.js","dataOperator/inputsIO.js","dataOperator/searchField.js","directives/directives.js","history/history.js","localStorage/localStorage.js","drag/drag.js","calendar/calendar.js","ajaxFiles/ajaxFiles.dropZone.js","ajaxFiles/ajaxFiles.iframe.js","ajaxFiles/ajaxFiles.js","ajaxFiles/ajaxFiles.xhr.js","notifications/notifications.js","models/models.js","models/modelsManager.js","models/modelsStorage.js","pagination/pagination.js","stacklist/stacklist.js","suggester/suggester.js","supported/supported.js","templates/templates.js","tips/tips.js","utils/utils.js","validator/validator.js","visibleCalculator/visibleCalculator.js","windows/windows.js","pagination/actions/paginationActions.js","suggester/actions/suggests.js","suggester/directives/suggests.js","tips/actions/tips.js","tips/directives/tips.js","selectReplace/actions/selectReplace.js","selectReplace/directives/select.js","servicesInit.js","shared.js","projectInit.js"],"names":["sky","service","exceptions","list","actions","perform","element","event","action","options","params","match","split","$","each","i","val","eval","trim","extend","self","path","current","name","isDisabled","elem","length","system","Error","apply","concat","add","events","safe","fn","selector","on","data","call","document","skyEvent","getAttribute","indexOf","type","preventDefault","map","parts","eventString","target","get","stackList","loadings","Loading","ajax","global","render","html","addClass","appendTo","click","stop","hide","callbacks","modal","content","holder","children","show","contentHolder","setHolder","disable","calc","visibleCalculator","outerHeight","enable","window","off","position","calculate","css","left","width","top","height","trigger","append","removeClass","remove","fire","loading","Callback","flags","functions","toRun","context","prototype","func","push","once","removeByContext","splice","removeByCallback","args","fireNext","result","callback","Callbacks","advancedCallbacks","callbacksFlags","removeListener","listener","Object","getEventsNames","_","next","slice","jQuery","possible","names","replace","elements","j","join","url","object","callbackData","ajaxExtend","filter","ajaxCallbacks","abort","dataType","timeout","success","response","textStatus","jqXHR","error","text","errorThrown","errorText","responseText","status","codes","code","promise","always","searchField","templates","utils","ajaxLoadingIndicator","baseOptions","fields","historyType","DataOperator","lastRequestData","beforeRequest","setOptions","form","onFormSubmit","bind","validForm","force","getById","page","reload","history","set","search","fromUrl","readSearch","writeForm","readHash","read","isObjectsEqual","writeURI","prepareRequest","request","lastResponse","reloadContent","virtual","item","fieldsList","field","valueOrNullOnDefault","write","hashRead","searchRead","fieldName","substring","input","find","default","value","initOperator","initLoader","loader","notifications","pagination","pages","onPageChange","pageNum","message","searchChanged","hashChanged","readInputValue","is","inputs","readInputsValues","valuesNamed","valuesLined","attr","writeInputValue","prop","writeInputsValue","first","notByUser","values","Array","inputsIO","inputName","hashValue","hashObject","searchValue","searchObject","directives","directive","getAttributes","attributes","nodeName","nodeValue","parseElement","jsonScript","json","JSON","parse","e","parseDirectives","onReady","supported","getObjectsDifference","second","difference","localDiff","key","returnArray","History","hashString","searchString","pathString","undefined","intervalId","base","navigate","location","pathname","substr","pushState","oldPath","newPath","getWindowSearch","hash","change","hashDifference","searchDifference","old","getWindowHash","getDifference","rebuild","pathChanged","setHash","encodeURI","setSearch","changed","decodeURIComponent","param","proxy","stringFromObject","obj","getObjects","paramsString","objects","subStrings","str","keyAndValue","string","stored","decodeURI","start","onpopstate","setInterval","time","LocalStorage","id","items","getItems","localStorage","getItem","parseJSON","storage","setItem","stringify","bindEvents","move","originalEvent","started","button","x","pageX","y","pageY","calendar","monthsNames","renderDays","moment","date","weeks","currentWeek","month","day","number","isoWeek","days","clone","dateStr","format","dates","period","since","till","setTime","dayPick","dayDiv","notClose","parseInt","getInputValue","close","useTime","isSame","setDayPick","pickedDateView","insertAfter","parent","calculator","offset","getDropOffset","marginTop","marginLeft","periodChangeDay","reset","lastModified","isBefore","isAfter","markSelected","changeDay","hour","minute","changeYear","year","yearView","changeMonth","monthView","getDatePeriod","dateString","getDate","showTime","subtract","dateOriginal","elementFromPoint","clientX","touches","clientY","srcElement","parents","keyCode","calendars","zone","files","XHRUpload","attachEvents","dragenter","dragleave","dragend","drop","dragover","isValidFileDrag","effect","dataTransfer","effectAllowed","dropEffect","onStart","dt","isWebkit","navigator","userAgent","types","contains","AjaxFilesIFrame","getName","cancel","onAbort","IFrame","setAttribute","send","fileName","insertBefore","createIframe","createForm","attachLoadEvent","getIframeContentJSON","onSuccess","setTimeout","iframe","load","parentNode","contentDocument","body","innerHTML","doc","contentWindow","onError","console","log","src","Math","floor","random","queryString","method","enctype","ajaxFilesXHR","ajaxFilesIFrame","AjaxFiles","saveFiles","file","parallel","handler","sendParallel","sendConsequentially","defaultSend","closest","windows","filesAjax","getLast","currentFile","lock","unlock","clearExceptTemplate","appendToModal","totalPercent","percent","toProceed","inProgress","total","totalLoaded","totalSize","fileRequests","size","loaded","formData","FormData","processData","contentType","xhr","XMLHttpRequest","upload","toFixed","onProgress","beforeSend","setRequestHeader","all","notSuccess","delete","fileRequestData","tips","Message","align","Tip","create","findInElement","modelsStorage","modelsDefinition","Model","definition","BaseDefinition","creation","extension","model","addDefinition","fromData","cached","Manager","arr","fromArray","cache","Pagination","pageWidth","last","dimensions","startPage","lastStartPage","pagesVisible","pagesInvisible","scrollAvailable","scrollStart","tumbler","dom","slider","back","forward","redraw","goToPage","newPage","innerWidth","toShow","drawPages","createScroll","scrollLine","runner","scroll","outerWidth","isVisible","pos","List","lastId","index","hasOwnProperty","single","suggester","lastList","removeData","elementPosition","renderPosition","selected","prev","fullScreen","templatesList","templatesCompiled","Templates","globals","template","save","cookie","renderByNameWithHolder","noDirectives","compile","coverWithHolder","renderByTextWithHolder","Twig","twig","temp","createElement","childNodes","renderToText","renderByText","renderByTextToText","compiled","fromLS","attrs","hideAll","withoutAutoHide","caller","tip","autoHide","highlight","className","shadow","opacity","background","closeTimeout","display","animate","fadeOut","fadeIn","blur","clearTimeout","what","arguments","addLeadingZero","encode","rawStr","charCodeAt","jsonData","prepareSelectData","columnSplitOn","maxColumns","columns","columnsCount","groupHolder","perColumn","ceil","column","groups","validator","validateForm","validationRule","addRule","validateElement","pass","shouldBeValidated","Options","totalPass","lastError","firstError","lastSuccess","firstSuccess","rules","ruleOverload","compiledRule","Rule","validate","rule","ruleDefaults","optionsDefaults","errorClass","successClass","overload","required","requiredIfFilled","email","same","regexp","RegExp","numeric","positive","parseFloat","max","min","minLength","maxLength","getDeclaredRules","Calculator","minHeight","scrollable","init","holderRect","scrollTop","windowHeight","windowWidth","sizes","right","realHeight","bottom","scrollLeft","popup","popupWidth","popupHeight","win","replaceOffset","popupOffset","leftDifference","topDifference","middle","visible","Modal","locked","dataContainer","closeButton","reRender","detach","innerHeight","byUser","setPage","scrollTo","grab","previous","adverts","suggestAjax","filtered","advert","username","campaigns","campaign","campaignsSpecial","showTip","hideTips","showTipWithText","forceHideTips","tipName","tipText","which","stopPropagation","rus","eng","expression","toLowerCase","expressionInvert","character","hasClass","inputHtml","selectAll","unSelectAll","label","originalTip","hideTip","dropOffset","focus","defaultValue","defaultAllValue","prepend","select","option","replaceElement","exec","servicesDeferred","resolve","closeWindow","submit","clearForm","changeOrder","orderField","order","table","trs","cell1","cell2","convert","sort","firstTr","secondTr","buttonTr","val1","val2","isNaN","changeOrderReload","currentLoader","selectionStart","classList","projectDeffered"],"mappings":"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","file":"project.js","sourcesContent":["sky.service(\"actions\", [\"exceptions\"], function ({exceptions}) {\n\n\tlet list = {},\n\t\tactions = this.service = {\n\n\t\t\t/**\n\t\t\t * Performs action\n\t\t\t * @param element\n\t\t\t * @param event\n\t\t\t * @param action\n\t\t\t * @param {Array} [options]\n\t\t\t */\n\t\t\tperform: function (element, event, action, options) {\n\n\t\t\t\t/* Get parameters */\n\t\t\t\tlet params = action.match(/(.+)\\((.*)\\)/);\n\n\t\t\t\t/* Parse */\n\t\t\t\tif (params) {\n\n\t\t\t\t\t/* Get function */\n\t\t\t\t\taction = params[1];\n\n\t\t\t\t\t/* Parse params */\n\t\t\t\t\tparams = params[2].split(\",\");\n\t\t\t\t\t$.each(params, function (i, val) {\n\t\t\t\t\t\tparams[i] = eval(val.trim());\n\t\t\t\t\t})\n\t\t\t\t}\n\n\t\t\t\t/* Options */\n\t\t\t\tif (options)\n\t\t\t\t\tparams = $.extend(params || [], options);\n\n\t\t\t\t/* Get */\n\t\t\t\tlet self = element ? $(element) : false,\n\t\t\t\t\tpath = action.split(\".\"),\n\t\t\t\t\tcurrent = list,\n\t\t\t\t\tname = action;\n\n\t\t\t\t/* If disabled */\n\t\t\t\tif (self && self.isDisabled && self.isDisabled())\n\t\t\t\t\treturn;\n\n\t\t\t\t$.each(path, function (i, elem) {\n\n\t\t\t\t\t/* Search */\n\t\t\t\t\tif (i + 1 < path.length && !current[elem])\n\t\t\t\t\t\tthrow new exceptions.system.Error(\"No action - \" + action + \", because can't find '\" + elem + \"'\");\n\n\t\t\t\t\t/* Get new elem */\n\t\t\t\t\tif (i + 1 < path.length)\n\t\t\t\t\t\tcurrent = current[elem];\n\n\t\t\t\t\t/* Save name */\n\t\t\t\t\tname = elem;\n\n\t\t\t\t});\n\n\t\t\t\t/* If no */\n\t\t\t\tif (!current[name])\n\t\t\t\t\tthrow new exceptions.system.Error(\"No action - \" + action);\n\n\t\t\t\t/* Call */\n\t\t\t\tcurrent[name].apply(current, [self, event].concat(params || []));\n\n\t\t\t},\n\n\t\t\t/**\n\t\t\t * Adds actions to list\n\t\t\t * @param name Group name\n\t\t\t * @param events List\n\t\t\t */\n\t\t\tadd: function (name, events) {\n\n\t\t\t\tif (typeof events === \"function\")\n\t\t\t\t\tevents = events.safe(true)();\n\n\t\t\t\t// Check\n\t\t\t\tif (!events || typeof events !== 'object')\n\t\t\t\t\tthrow new exceptions.system.Error(\"No event object for events '\" + name + \"' provided\");\n\n\t\t\t\t// Save\n\t\t\t\tlist[name] = $.extend(list[name] || {}, events);\n\n\t\t\t}\n\n\t\t};\n\n\n\t/**\n\t * Adds special bind function\n\t * @param {string} name Event name\n\t * @param {*} selector Selector string\n\t * @param {function} [action] Action function\n\t * @returns {jQuery}\n\t */\n\t$.fn.action = function(name, selector, action) {\n\n\t\t/* Parameters skip */\n\t\tif(typeof action === \"undefined\") { action = selector; selector = null; }\n\n\t\t/* Bind */\n\t\treturn this.on(name, selector, function(event, data) {\n\t\t\taction.call(this, event, $(this), data);\n\t\t}.safe());\n\t};\n\n\t/*\n\t * Bind declarative events\n\t */\n\t$(document).action(\"click submit keyup keydown dblclick mouseover mouseout mouseleave mouseenter change mousedown mouseup touchstart\", '[data-event]', function (event, self, data) {\n\n\t\t/* Get string */\n\t\tlet skyEvent = this.getAttribute(\"data-event\");\n\n\t\t/* If no such event in data-event attribute */\n\t\tif (skyEvent.indexOf(event.type) === -1)\n\t\t\treturn;\n\n\t\t/* If disabled */\n\t\tif (self.isDisabled && self.isDisabled()) {\n\t\t\tevent.preventDefault();\n\t\t\treturn;\n\t\t}\n\n\t\tskyEvent.split(\";\").map(eventString => {\n\n\t\t\t/* Get elements */\n\t\t\tlet parts = eventString.match(/(\\w+):(.*)/);\n\n\t\t\t/* Wrong */\n\t\t\tif (parts.length !== 3)\n\t\t\t\tthrow new exceptions.system.Error(\"Wrong action format in data-event: \" + eventString);\n\n\t\t\t/* Get elements */\n\t\t\tlet name = parts[1].trim(),\n\t\t\t\taction = parts[2].trim();\n\n\t\t\t/* Another event */\n\t\t\tif (name !== event.type)\n\t\t\t\treturn;\n\n\t\t\t/* No default go */\n\t\t\tif (event.target === self.get(0))\n\t\t\t\tevent.preventDefault();\n\n\t\t\t/* Passed data */\n\t\t\tevent.data = data;\n\n\t\t\t/* Perform action */\n\t\t\tactions.perform(this, event, action);\n\n\t\t});\n\n\t});\n\n});","sky.service(\"ajaxLoadingIndicator\", [\"stackList\"], function({ stackList }) {\n\n\tlet loadings = stackList();\n\n\t/**\n\t * Loading\n\t */\n\tclass Loading {\n\t\tconstructor(ajax, global = true) {\n\n\t\t\t/* List save */\n\t\t\tloadings.add(this);\n\n\t\t\t/* Back link */\n\t\t\tthis.global = global;\n\n\t\t\t/* Render */\n\t\t\tthis.render = $('<div/>').html('<div></div>').addClass(\"ajaxLoading\");\n\n\t\t\t/* Global insert */\n\t\t\tif(this.global)\n\t\t\t\tthis.render.addClass(\"fixed\").appendTo(\"body\");\n\n\t\t\t/* If stop possible */\n\t\t\tif(ajax) {\n\t\t\t\t$(\"<span/>\").appendTo(this.render.addClass(\"cancelable\")).click(function() {\n\t\t\t\t\tajax.stop();\n\t\t\t\t});\n\t\t\t\tajax.on(\"always\", () => this.hide());\n\t\t\t}\n\n\t\t\t/* Callbacks */\n\t\t\tthis.events = callbacks();\n\n\t\t}\n\n\t\t/**\n\t\t * Loads loading in modal window\n\t\t * @param {object} modal Window\n\t\t */\n\t\tinModalWindow(modal) {\n\n\t\t\t/* Hide */\n\t\t\tlet content = modal.holder.children().hide();\n\n\t\t\t/* Insert */\n\t\t\tthis.render.appendTo(modal.holder);\n\n\t\t\t/* Restore on hide */\n\t\t\tthis.events.on(\"hide\", () => content.show());\n\n\t\t}\n\n\t\t/**\n\t\t *\n\t\t * @param contentHolder\n\t\t */\n\t\treloadContent(contentHolder) {\n\n\t\t\tthis.setHolder(contentHolder);\n\n\t\t\t/* If no holder */\n\t\t\tif(!this.holder.length)\n\t\t\t\treturn;\n\n\t\t\t/* Get children */\n\t\t\tlet content = this.holder.children();\n\n\t\t\t/* Different content disable */\n\t\t\tif(this.global) {\n\n\t\t\t\t/* Disable content */\n\t\t\t\tcontent.disable();\n\n\t\t\t\t/* Make sizes calculator */\n\t\t\t\tthis.calc = visibleCalculator(contentHolder, this.render.outerHeight(), \"body\");\n\n\t\t\t\t/* Re enable */\n\t\t\t\tthis.events.on(\"hide\", () => {\n\t\t\t\t\tcontent.enable();\n\t\t\t\t\t$(window).off(\"scroll.notification\");\n\t\t\t\t});\n\n\t\t\t\t/* Bind scroll handler */\n\t\t\t\t$(window).on(\"scroll.notification\", () => {\n\t\t\t\t\tlet position = this.calc.calculate();\n\t\t\t\t\tthis.render.css({\n\t\t\t\t\t\tleft: position.left + (position.width) / 2,\n\t\t\t\t\t\ttop : position.top + (position.height) / 2\n\t\t\t\t\t})\n\t\t\t\t}).trigger(\"scroll\");\n\n\t\t\t} else {\n\n\t\t\t\t/*  Hide */\n\t\t\t\tcontent.hide();\n\n\t\t\t\t/* Insert */\n\t\t\t\tthis.render.appendTo(this.holder);\n\n\t\t\t\t/* Re enable */\n\t\t\t\tthis.events.on(\"hide\", function() {\n\t\t\t\t\tcontent.show();\n\t\t\t\t});\n\t\t\t}\n\n\t\t\treturn this;\n\n\t\t}\n\n\t\tsetHolder(holder) {\n\n\t\t\t/* Append and save */\n\t\t\tthis.holder = $(holder).addClass(\"withLoading\").append(this.render);\n\n\t\t\t/* Self return */\n\t\t\treturn this;\n\n\t\t}\n\n\t\t/**\n\t\t * Hides current loading\n\t\t */\n\t\thide() {\n\n\t\t\tif(this.holder)\n\t\t\t\tthis.holder.removeClass(\"withLoading\");\n\n\t\t\tthis.render.remove();\n\t\t\tthis.events.fire(\"hide\");\n\n\t\t\t/* Remove from list */\n\t\t\tloadings.remove(this);\n\n\t\t}\n\t}\n\n\tthis.service = {\n\t\tloading: (ajax, global = true) => new Loading(ajax, global),\n\t}\n\n});","sky.service(\"callback\", function() {\n\n\t/**\n\t * Creates callback object that holds functions list\n\t * @param {string} [flags]\n\t * @returns {*}\n\t * @constructor\n\t */\n\tlet Callback = function(flags) {\n\n\t\t/* Self construct */\n\t\tif(!(this instanceof Callback))\n\t\t\treturn new Callback(flags);\n\n\t\t/**\n\t\t * Functions list holder\n\t\t * @type {Array}\n\t\t */\n\t\tthis.functions = [];\n\t\tthis.toRun =  0;\n\t\tthis.context = this;\n\n\t\t/* Self return for next usage */\n\t\treturn this;\n\n\t};\n\n\t/**\n\t * Base\n\t * @type {{functions: Array, toRun: number, context: *, add: add, removeByContext: removeByContext, fire: fire, fireNext: fireNext}}\n\t */\n\tCallback.prototype = {\n\n\t\t/**\n\t\t * Adds new function to stack\n\t\t * @param {Function} func Function to add\n\t\t * @param {Object} context Function context\n\t\t * @param {Object} options Call options\n\t\t */\n\t\tadd: function(func, context, options) {\n\t\t\tthis.functions.push({\n\t\t\t\tfunc: func,\n\t\t\t\tcontext: context || false,\n\t\t\t\tonce: options && options.once\n\t\t\t});\n\t\t\treturn this;\n\t\t},\n\n\t\t/**\n\t\t * Removes function from list by context\n\t\t * @param context\n\t\t */\n\t\tremoveByContext: function(context) {\n\n\t\t\t/* Find listener */\n\t\t\tlet i;\n\t\t\tfor(i in this.functions)\n\t\t\t\tif(this.functions[i].context === context)\n\t\t\t\t\tthis.functions.splice(i, 1);\n\n\t\t\t/* Self return */\n\t\t\treturn this;\n\n\t\t},\n\n\t\t/**\n\t\t * Removes function from list by context\n\t\t * @param func\n\t\t */\n\t\tremoveByCallback: function(func) {\n\n\t\t\t/* Find listener */\n\t\t\tlet i;\n\t\t\tfor(i in this.functions)\n\t\t\t\tif(this.functions[i].func === func)\n\t\t\t\t\tthis.functions.splice(i, 1);\n\n\t\t\t/* Self return */\n\t\t\treturn this;\n\n\t\t},\n\n\t\t/**\n\t\t * Fires all functions\n\t\t * @param {Object} context Function context\n\t\t * @param {Array} args Arguments\n\t\t */\n\t\tfire: function(context, args) {\n\t\t\tfor(let func of this.functions)\n\t\t\t\tfunc.func.apply(func.context || context, args);\n\t\t},\n\n\t\t/**\n\t\t * Fires next function\n\t\t * @param {Array|Object} args Arguments\n\t\t * @param {Object} context Function context\n\t\t */\n\t\tfireNext: function(args, context) {\n\n\t\t\t/* If no more to run */\n\t\t\tif(this.functions.length <= this.toRun)\n\t\t\t\treturn false;\n\n\t\t\t/* Set next to run */\n\t\t\tthis.toRun++;\n\n\t\t\t/* Function to run */\n\t\t\tlet current = this.functions[this.toRun - 1],\n\t\t\t\tresult,\n\t\t\t\tfunc = current.func;\n\n\t\t\t/* Set context */\n\t\t\tcontext = current.context || context || window;\n\n\t\t\t/* Get function in string */\n\t\t\tif(typeof func === \"string\")\n\t\t\t\tfunc = context[func];\n\n\t\t\t/* If no function found */\n\t\t\tif(!func)\n\t\t\t\treturn true;\n\n\t\t\t/* Call function */\n\t\t\tresult =  func.apply(current.context || context, args) !== false;\n\n\t\t\t/* If call once */\n\t\t\tif(current.once) {\n\t\t\t\tthis.functions.splice(this.toRun - 2, 1);\n\t\t\t\tthis.toRun--;\n\t\t\t}\n\n\t\t\t/* Return function result */\n\t\t\treturn result;\n\t\t}\n\n\t};\n\n\tthis.service = Callback;\n\n});","sky.service(\"callbacks\", [\"callback\"], function({ callback }) {\n\n\t/**\n\t *\n\t * Callbacks prepared object\n\t * @param {*} [flags] Flags list for jQuery.Callbacks\n\t * @constructor\n\t */\n\tlet Callbacks = function(flags) {\n\n\t\t/* Self construction */\n\t\tif(!(this instanceof Callbacks))\n\t\t\treturn new Callbacks(flags);\n\n\t\t/* Add properties */\n\t\t$.extend(true, this, Callbacks.extend);\n\n\t\t/* Callbacks list */\n\t\tthis.advancedCallbacks = {};\n\n\t\t/* Set default flags and self context */\n\t\treturn this.flags(flags);\n\n\t};\n\n\t/**\n\t * Prototype\n\t * @type {{on: on, fire: fire, off: off, flags: flags, setContext: setContext}}\n\t */\n\tCallbacks.prototype = {\n\n\t\t\t/**\n\t\t\t * Flags for sky.Callback\n\t\t\t * @param {object} flags Flags list\n\t\t\t * @returns {*}\n\t\t\t */\n\t\t\tflags: function(flags) {\n\t\t\t\tthis.callbacksFlags = flags;\n\t\t\t\treturn this;\n\t\t\t},\n\n\t\t\t/**\n\t\t\t * Remove by listener\n\t\t\t * @param {string} name Event name\n\t\t\t * @param {string} listener Listener object\n\t\t\t */\n\t\t\tremoveListener: function(name, listener) {\n\t\t\t\tif(this.advancedCallbacks[name]) {\n\t\t\t\t\tthis.advancedCallbacks[name].removeByContext(listener);\n\t\t\t\t}\n\t\t\t},\n\n\t\t\t/**\n\t\t\t * Adds new event handler\n\t\t\t * @param {string} \t name \t\t\tName of event\n\t\t\t * @param {function|string} func \tFunction be called on event fires\n\t\t\t * @param {object}   [context]\t\tFunction options\n\t\t\t * @param {object}   [options]\t\tFunction options\n\t\t\t */\n\t\t\ton:  function(name, func, context, options) {\n\n\n\t\t\t\tif(name instanceof Object)\n\t\t\t\t\t$.each(name, (event, func) => { this.on(event, func) });\n\n\t\t\t\telse $.each(this.getEventsNames(name), (_, name) => {\n\n\t\t\t\t\t/* Create callbacks */\n\t\t\t\t\tif(!this.advancedCallbacks[name])\n\t\t\t\t\t\tthis.advancedCallbacks[name] = callback(this.callbacksFlags);\n\n\t\t\t\t\t/* Add function */\n\t\t\t\t\tthis.advancedCallbacks[name].add(func, context ? context : self.context, options || {});\n\n\t\t\t\t});\n\n\t\t\t\treturn this;\n\t\t\t},\n\n\t\t\t/**\n\t\t\t * Fires callbacks for specified event\n\t\t\t * @param {string} name Name of event\n\t\t\t * @param {object} args Arguments to be passed\n\t\t\t * @param {object} [options] Additional options\n\t\t\t */\n\t\t\tfire: function(name, args, options) {\n\n\t\t\t\t/* Success last */\n\t\t\t\tlet events = this.getEventsNames(name),\n\t\t\t\t\tself = this,\n\t\t\t\t\tnext = false;\n\t\t\t\t\toptions = options || {};\n\n\t\t\t\t/* Remove global if need */\n\t\t\t\tif(options[\"noGlobal\"])\n\t\t\t\t\tevents = events.slice(1);\n\n\t\t\t\t/* Fire events */\n\t\t\t\t$.each(events, function(_, event) {\n\n\t\t\t\t\t/* If no callback */\n\t\t\t\t\tif(!self.advancedCallbacks[event])\n\t\t\t\t\t\treturn;\n\n\t\t\t\t\t/* Run */\n\t\t\t\t\tdo {\n\t\t\t\t\t\tnext = self.advancedCallbacks[event].fireNext(jQuery.extend({ event: event }, args || []), self.context, options.possible);\n\t\t\t\t\t} while(next);\n\n\t\t\t\t\t/* Reset */\n\t\t\t\t\tif(!options.once)\n\t\t\t\t\t\tself.advancedCallbacks[event].toRun = 0;\n\n\t\t\t\t});\n\n\t\t\t},\n\n\t\t\t/**\n\t\t\t * Get all event names from global name\n\t\t\t * @param {String} name Global event name\n\t\t\t * @returns {Array}\n\t\t\t */\n\t\t\tgetEventsNames: function(name) {\n\n\t\t\t\t/* Get events names */\n\t\t\t\tlet names = name.split(\",\"), events = [];\n\n\t\t\t\t/* Go through */\n\t\t\t\t$.each(names, function(i, name) {\n\n\t\t\t\t\t/* Remove spaces */\n\t\t\t\t\tname = name.replace(\" \", \"\");\n\n\t\t\t\t\t/* Get elements */\n\t\t\t\t\tlet elements = name.split(\".\");\n\t\t\t\t\tevents.push(elements[0]);\n\n\t\t\t\t\t/* Go through */\n\t\t\t\t\tfor(let j = 1; j < elements.length; j++)\n\t\t\t\t\t\tevents.push(elements[0] + \".\" + elements[j]);\n\n\t\t\t\t\t/* Global event */\n\t\t\t\t\tif(elements.length > 2)\n\t\t\t\t\t\tevents.push(elements.join(\".\"));\n\n\t\t\t\t});\n\n\t\t\t\t/* Return */\n\t\t\t\treturn events;\n\n\t\t\t},\n\n\t\t/**\n\t\t * Removes event handlers and functions\n\t\t * @param {string} name Event name\n\t\t * @param func\n\t\t */\n\t\t\toff: function(name, func = null) {\n\t\t\t\tif(func && this.advancedCallbacks[name])\n\t\t\t\t\tthis.advancedCallbacks[name].removeByCallback(func);\n\t\t\t\telse\n\t\t\t\t\tdelete this.advancedCallbacks[name];\n\t\t\t}\n\n\t\t};\n\n\t\tthis.service = Callbacks;\n\n});","sky.service(\"ajax\", [\"callbacks\"], function({ callbacks }) {\n\n\t/**\n\t * Advanced ajax execution\n\t * To abort call stop() method instead of abort() because it's used for abort callback set, or .ajax.abort()\n\t * You may skip type, don't skip it if lock is string set false in object and data\n\t * @param {string} url\t\t\t\tRequested url\n\t * @param {object} [data]\t\t\tHolds request parameters\n\t * @param {jQuery} [object]\t\t\tObject which performs request, to disable it during request\n\t * @param {object} [ajaxExtend]\t\tAdditional ajax options, see http://api.jquery.com/jQuery.ajaxSetup/\n\t * @param {object} [callbackData]\tAdditional params that passed to any callback\n\t */\n\tthis.service = function(url, data, { object = null, callbackData = {}, ajaxExtend = {} }) {\n\n\t\t/* Lock button */\n\t\tif(object)\n\t\t\tobject = $(object).filter(\":not(.disabled)\").disable();\n\n\t\t/* New object to store callbacks */\n\t\tlet ajaxCallbacks = new callbacks();\n\t\tajaxCallbacks.stop = function() { ajaxCallbacks.ajax.abort(); };\n\n\t\t/* Perform ajax request */\n\t\tajaxCallbacks.ajax = $.ajax($.extend(true, {\n\n\t\t\t/* Set base options */\n\t\t\turl     \t: url,\n\t\t\tdata    \t: data,\n\t\t\tdataType\t: \"json\",\n\t\t\ttype    \t: \"post\",\n\t\t\ttimeout\t\t: 480 * 1000,\n\t\t\tsuccess: function(response, textStatus, jqXHR) {\n\n\t\t\t\t/* Possible params list */\n\t\t\t\tlet params = $.extend({ jqXHR: jqXHR, textStatus: textStatus, object: object }, callbackData);\n\n\t\t\t\t/* If empty response */\n\t\t\t\tif(response === null) {\n\t\t\t\t\tparams.error = \"Данные небыли переданы\";\n\t\t\t\t\tparams.type = \"noData\";\n\t\t\t\t}\n\n\t\t\t\t/* If response returned with error */\n\t\t\t\tif(response.error) {\n\t\t\t\t\tparams.error = response.text;\n\t\t\t\t\tparams.type = \"php\";\n\t\t\t\t}\n\n\t\t\t\t/* If error type set */\n\t\t\t\tif(params.type)\n\t\t\t\t\treturn ajaxCallbacks.fire(\"notSuccess, error\", params); // No data\n\n\t\t\t\t/* Set response in possible params */\n\t\t\t\tparams.response = params.data = response;\n\n\t\t\t\t/* User success function */\n\t\t\t\treturn ajaxCallbacks.fire(\"preSuccess, success, notAbort\", params);\n\n\t\t\t}.safe(),\n\t\t\terror: function(jqXHR, textStatus, errorThrown) {\n\n\t\t\t\t/* Defaults */\n\t\t\t\tlet type        = \"Unknown\",\n\t\t\t\t\terrorText   = \"Во время выполнения запроса произошла ошибка, пожалуйста попробуйте позже\";\n\n\t\t\t\t/* Get error text according to response data */\n\t\t\t\tif(textStatus === \"abort\") {\n\t\t\t\t\ttype \t  = \"abort\";\n\t\t\t\t\terrorText = 'Выполнение запроса прервано';\n\t\t\t\t} else if(textStatus === 'parsererror') {\n\t\t\t\t\ttype \t  = \"parse\";\n\t\t\t\t\terrorText = \"Ответ пришел в неверном формате, пожалуйста попробуйте позже, текст:<br/>\" + jqXHR.responseText;\n\t\t\t\t} else if(textStatus === 'timeout') {\n\t\t\t\t\ttype \t  = \"timeout\";\n\t\t\t\t\terrorText = 'Время ожидания ответа истекло';\n\t\t\t\t} else if(jqXHR.status === 0) {\n\t\t\t\t\ttype \t  = \"stopped\";\n\t\t\t\t\terrorText = 'Загрузка остановлена, проверьте свои настройки сети';\n\t\t\t\t} else if(codes[jqXHR.status]) {\n\t\t\t\t\ttype = jqXHR.status;\n\t\t\t\t\terrorText = 'Ошибка во времы выполнения запроса <br/> ' + codes[jqXHR.status];\n\t\t\t\t}\n\n\t\t\t\t/* Possible params list */\n\t\t\t\tlet params = $.extend({\n\t\t\t\t\terror      : errorText,\n\t\t\t\t\ttype       : type,\n\t\t\t\t\tcode\t   : type,\n\t\t\t\t\tjqXHR      : jqXHR,\n\t\t\t\t\ttextStatus : textStatus,\n\t\t\t\t\tstatus     : textStatus,\n\t\t\t\t\terrorThrown: errorThrown,\n\t\t\t\t\tobject     : object\n\t\t\t\t}, callbackData);\n\n\t\t\t\t/* Execute callback */\n\t\t\t\tajaxCallbacks.fire(\"notSuccess\", params);\n\n\t\t\t\t/* Execute special ajaxCallbacks */\n\t\t\t\tajaxCallbacks.fire(textStatus === \"abort\" ? \"abort\" : \"error, notAbort\", params);\n\n\t\t\t}.safe()\n\n\t\t}, ajaxExtend));\n\n\t\t/* On always set */\n\t\tajaxCallbacks.ajax.promise().always(function(jqXHR, textStatus, errorThrown) {\n\n\t\t\t/* Unlock objects */\n\t\t\tif(object)\n\t\t\t\tobject.enable();\n\n\t\t\t/* Always callback */\n\t\t\tajaxCallbacks.fire(\"always\", { errorThrown: errorThrown, textStatus: textStatus, jqXHR: jqXHR, object: object});\n\n\t\t}.safe());\n\n\t\treturn ajaxCallbacks;\n\n\t};\n\n\t/**\n\t * Contains http codes\n\t */\n\tlet codes = {\n\n\t\t/* Request errors */\n\t\t400: \"Неверный запрос\",\n\t\t401: \"Для выполнеия запроса нужня авторизация\",\n\t\t402: \"Для доступа к ресурсу необходима оплата\",\n\t\t403: \"Доступ к ресурсу запрещен\",\n\t\t404: \"Сервер для выполнения запроса не найден или запрос выполнялся слишком долго\",\n\t\t405: \"Не поддерживаемый метод HTTP\",\n\t\t406: \"Не приемлемо\",\n\t\t407: \"Необходима аутентификация прокси\",\n\t\t408: \"Истекло время ожидания\",\n\t\t409: \"Конфликт\",\n\t\t410: \"Ресурс удален\",\n\t\t411: \"В запросе не указана длинна\",\n\t\t412: \"Условие ложно\",\n\t\t413: \"Размер запроса слишком велик\",\n\t\t414: \"Запрашиваемый URI слишком длинный\",\n\t\t415: \"Неподдерживаемый тип данных\",\n\t\t416: \"Запрашиваемый диапазон не достижим\",\n\t\t417: \"Ожидаемое неприемлемо\",\n\t\t422: \"Необрабатываемый экземпляр\",\n\t\t423: \"Ресурс заблокирован\",\n\t\t424: \"Невыполненная зависимость\",\n\t\t425: \"Неупорядоченный набор\",\n\t\t426: \"Необходимо обновление\",\n\t\t428: \"Необходимо предусловие\",\n\t\t429: \"Слишком много запросов\",\n\t\t431: \"Поля заголовка запроса слишком большие\",\n\t\t451: \"Недоступно по юридическим причинам\",\n\t\t456: \"Некорректируемая ошибка\",\n\t\t499: \"Используется Nginx, соединение закрыто до получения ответа\",\n\n\t\t/* Server error */\n\t\t500: \"Внутренняя ошибка сервера\",\n\t\t501: \"Не реализовано\",\n\t\t502: \"Плохой или ошибочный шлюз\",\n\t\t503: \"Сервис недоступен\",\n\t\t504: \"Шлюз не отвечает\",\n\t\t505: \"Версия HTTP не поддерживается\",\n\t\t506: \"Вариант тоже проводит согласование\",\n\t\t507: \"Переполнение хранилища\",\n\t\t508: \"Запрос зациклен\",\n\t\t509: \"Исчерпана пропускная ширина канала\",\n\t\t510: \"Не расширено\",\n\t\t511: \"Требуется сетевая аутентификация\"\n\n\t};\n\n});","sky.service(\"dataOperator\", [ \"searchField\", \"templates\", \"utils\", \"ajax\", \"stackList\", \"ajaxLoadingIndicator\" ], function ({ searchField, templates, utils, ajax, stackList, ajaxLoadingIndicator }) {\n\n\t/**\n\t * Default options\n\t * @type {{}}\n\t */\n\tlet baseOptions = {\n\t\tfields: {},\n\t\thistoryType: \"hash\"\n\t};\n\n\t/* Creates new data operator */\n\tclass DataOperator {\n\t\tconstructor(options) {\n\n\t\t\t/* Stores last request object */\n\t\t\tthis.lastRequestData = false;\n\n\t\t\t/* Func that calls before request */\n\t\t\tthis.beforeRequest = false;\n\t\t\t\n\t\t\t/* Fields list */\n\t\t\tthis.fields = stackList();\n\n\t\t\t/* Add base options, but only not set, that's why so fun construction */\n\t\t\tthis.options = utils.extend({}, baseOptions, true);\n\n\t\t\t/* Options init */\n\t\t\tthis.setOptions(options);\n\n\t\t}\n\n\t\t/** Saves to options */\n\t\tsetOptions(options) {\n\n\t\t\t/* Add to options */\n\t\t\tutils.extend(this.options, options, true);\n\n\t\t\t/* Set submit handler */\n\t\t\tif(this.options.form)\n\t\t\t\t$(this.options.form).action(\"submit\", this.onFormSubmit.bind(this));\n\n\t\t\t/* Self return */\n\t\t\treturn this;\n\t\t}\n\n\t\t/**\n\t\t * On form submit\n\t\t * @param event\n\t\t */\n\t\tonFormSubmit(event) {\n\n\t\t\t/* Prevent */\n\t\t\tevent.preventDefault();\n\n\t\t\t/* If form not valid */\n\t\t\tif (!$(this.options.form).validForm())\n\t\t\t\treturn;\n\n\t\t\tlet options = {force: true};\n\n\t\t\tif (this.fields.getById(\"page\"))\n\t\t\t\toptions[this.options.historyType === \"search\" ? \"search\" : \"hash\"] = {page: 1};\n\n\t\t\t/* Update */\n\t\t\tthis.reload(options);\n\n\t\t}\n\n\t\tprepareRequest(options) {\n\n\t\t\t/* On empty */\n\t\t\toptions = options || {};\n\n\t\t\t/* Hash fields */\n\t\t\tif (options[\"hash\"])\n\t\t\t\tpage.history.set(options[\"hash\"]);\n\n\t\t\t/* Hash fields */\n\t\t\tif (options[\"search\"])\n\t\t\t\tpage.history.search(options[\"search\"]);\n\n\t\t\t/* Hash fields */\n\t\t\tif (options[\"virtual\"]) {\n\t\t\t\tif (this.options.historyType === \"search\")\n\t\t\t\t\tpage.history.search(options[\"virtual\"]);\n\t\t\t\telse\n\t\t\t\t\tpage.history.set(options[\"virtual\"]);\n\t\t\t}\n\n\t\t\t/* Write to form from hash */\n\t\t\tif (options.fromUrl) {\n\t\t\t\tif (this.options.historyType === \"search\")\n\t\t\t\t\tthis.readSearch().writeForm();\n\t\t\t\telse\n\t\t\t\t\tthis.readHash().writeForm();\n\t\t\t}\n\n\t\t\t/* jQuery wrap */\n\t\t\tif (this.options.form && !$(this.options.form).validForm())\n\t\t\t\treturn false;\n\n\t\t\t/* Read */\n\t\t\tlet data = this.read();\n\n\t\t\t/* Add additional data */\n\t\t\tif (this.options[\"requestData\"])\n\t\t\t\tdata = utils.extend(data, this.options[\"requestData\"]);\n\n\t\t\t/* Check is same and no force requested */\n\t\t\tif (this.lastRequestData !== false && utils.isObjectsEqual(this.lastRequestData, data) && !options[\"force\"])\n\t\t\t\treturn false;\n\n\t\t\t/* Set hash data */\n\t\t\tif (!options.fromUrl)\n\t\t\t\tthis.writeURI(this.options.historyType);\n\n\t\t\t/* Before request call */\n\t\t\tif (this.beforeRequest)\n\t\t\t\tif (this.beforeRequest(data, options) === false)\n\t\t\t\t\treturn false;\n\n\t\t\t/* Return data */\n\t\t\treturn data;\n\n\t\t}\n\n\t\t/**\n\t\t * Reloads data according to params\n\t\t * @param options\n\t\t * @returns {DataOperator}\n\t\t */\n\t\treload(options) {\n\n\t\t\t/* Prepare */\n\t\t\tlet data = this.prepareRequest(options);\n\n\t\t\t/* Reload */\n\t\t\tif (data)\n\t\t\t\tthis.request(data);\n\n\t\t\t/* Self return */\n\t\t\treturn this;\n\n\t\t}\n\n\t\t/**\n\t\t * Performs request to reload data\n\t\t * @param data\n\t\t */\n\t\trequest(data) {\n\n\t\t\t/* Back link */\n\t\t\tlet self = this;\n\n\t\t\t/* Save last data */\n\t\t\tself.lastRequestData = data;\n\n\t\t\t/* Stop old request */\n\t\t\tif (this.ajax)\n\t\t\t\tthis.ajax.stop();\n\n\t\t\t/* Request */\n\t\t\tthis.ajax = ajax(this.options.url, data)\n\t\t\t\t.on(\"success\", function (response) {\n\t\t\t\t\tself.lastResponse = response;\n\t\t\t\t\tself.render(response, data);\n\t\t\t\t})\n\t\t\t\t.on(\"error\", function (error) {\n\t\t\t\t\tself.error(error)\n\t\t\t\t})\n\t\t\t\t.on(\"always\", function () {\n\t\t\t\t\tself.ajax = false;\n\t\t\t\t});\n\n\t\t\t/* Create loading, auto remove when ajax finishes */\n\t\t\tajaxLoadingIndicator.loading(this.ajax).reloadContent(this.options.holder);\n\n\t\t}\n\n\t\t/**\n\t\t * On success, have to be overloaded\n\t\t * @param data\n\t\t * @param request\n\t\t */\n\t\trender(data, request) {}\n\n\t\t/**\n\t\t * On error, have to be overloaded\n\t\t * @param error\n\t\t */\n\t\terror(error) {}\n\n\t\t/**\n\t\t * Adds list of fields to current list\n\t\t * @param {Array} list List of names\n\t\t * @param {Boolean} [virtual] Virtual fields flag\n\t\t */\n\t\tfieldsList(list, virtual) {\n\n\t\t\t/* Go through and push */\n\t\t\tutils.each(list, (_, item) => {\n\t\t\t\tthis.options.fields[item] = virtual;\n\t\t\t});\n\n\t\t\t/* Self return */\n\t\t\treturn this;\n\t\t\t\n\t\t}\n\n\t\t/**\n\t\t * Sets form fields\n\t\t * @param list\n\t\t * @returns {*}\n\t\t */\n\t\trealFieldsList(list) {\n\t\t\treturn this.fieldsList(list);\n\t\t}\n\n\t\t/**\n\t\t * Set none forms fields\n\t\t * @param list\n\t\t * @returns {*}\n\t\t */\n\t\tvirtualFieldsList(list) {\n\t\t\treturn this.fieldsList(list, true);\n\t\t}\n\n\t\t/**\n\t\t * Reads real fields\n\t\t * @val {string} type Field type - \"real\" or \"virtual\"\n\t\t * @returns {{}}\n\t\t */\n\t\tread(type = false) {\n\n\t\t\t/* Data holder */\n\t\t\tlet data = {};\n\n\t\t\t/* Go through */\n\t\t\tthis.fields.each(field => {\n\n\t\t\t\t/** @let field searchField */\n\t\t\t\tif (type && (type === \"real\" && field.virtual || !field.virtual))\n\t\t\t\t\treturn;\n\n\t\t\t\t/* Read */\n\t\t\t\tfield.read();\n\n\t\t\t\t/* Get non default or null */\n\t\t\t\tlet val = field.valueOrNullOnDefault();\n\n\t\t\t\t/* If value not same as default */\n\t\t\t\tif (val !== null)\n\t\t\t\t\tdata[field.name] = val;\n\n\t\t\t});\n\n\t\t\t/* Self return */\n\t\t\treturn data;\n\n\t\t}\n\n\t\t/** Write current field to form */\n\t\twriteForm() {\n\t\t\tthis.fields.each(field => field.write());\n\t\t\treturn this;\n\t\t}\n\n\t\t/** Reads hash to fields */\n\t\treadHash() {\n\t\t\tthis.fields.each(field => field.hashRead());\n\t\t\treturn this;\n\t\t}\n\n\t\t/** Reads hash to fields */\n\t\treadSearch() {\n\t\t\tthis.fields.each(field => field.searchRead());\n\t\t\treturn this;\n\t\t}\n\n\t\t/** Writes current fields to hash */\n\t\twriteURI(type = \"hash\") {\n\n\t\t\t/* To write */\n\t\t\tlet write = {};\n\n\t\t\t/* Go through */\n\t\t\tthis.fields.each(field => {\n\t\t\t\twrite[field.name]  = field.valueOrNullOnDefault();\n\t\t\t});\n\n\t\t\t/* Write to URI */\n\t\t\ttype === \"search\" ? page.history.search(write) : page.history.set(write);\n\n\t\t\t/* Self return */\n\t\t\treturn this;\n\n\t\t}\n\n\t\t/** Finds inputs associated with fields */\n\t\tinitInputs() {\n\n\t\t\t/* Back link */\n\t\t\tlet self = this;\n\n\t\t\tutils.each(this.options.fields, (fieldName, virtual) => {\n\n\t\t\t\t// Create search field\n\t\t\t\tlet field = new searchField(fieldName, virtual ? self.options.historyType : false);\n\n\t\t\t\t/** @let field searchField */\n\t\t\t\tif (!field.virtual) {\n\n\t\t\t\t\t/* Find input */\n\t\t\t\t\tif (field.name[0] === \"*\") {\n\t\t\t\t\t\tfield.name = field.name.substring(1);\n\t\t\t\t\t\tfield.input = $(self.options.form).find(\".selectReplaceChoose[data-input=\" + field.name + \"]\");\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t\tfield.input = $(self.options.form).find('[name=\"' + field.name + '\"]');\n\n\t\t\t\t\t/* Remove fields without input */\n\t\t\t\t\tif (!field.input || !field.input.length) {\n\t\t\t\t\t\tdelete self.fields[fieldName];\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\t/* Save */\n\t\t\t\t\tself.fields[fieldName] = field;\n\n\t\t\t\t\t/* Read default */\n\t\t\t\t\tfield.default = field.read();\n\t\t\t\t\tfield.value = null;\n\t\t\t\t} else {\n\t\t\t\t\tself.fields[fieldName] = field;\n\t\t\t\t}\n\t\t\t});\n\n\t\t\t/* Self return */\n\t\t\treturn this;\n\t\t}\n\t}\n\n\t/* Interface */\n\tthis.service = {\n\t\tinitOperator: options => new DataOperator(options),\n\t\tsearchField: searchField,\n\t\tinitLoader: function (loader, notifications, pagination, { reload = true, history = true }) {\n\n\t\t\t/* Add count */\n\t\t\tloader.beforeRequest = function (data, options) {\n\t\t\t\tif (!loader.lastRequestData || options.force)\n\t\t\t\t\tdata[\"count\"] = true;\n\t\t\t};\n\n\t\t\t/* Render function */\n\t\t\tloader.render = function (response) {\n\n\t\t\t\t// Re render\n\t\t\t\t$(loader.options.holder).html('').append(\n\t\t\t\t\ttemplates.render(\"page-result-render\", response)\n\t\t\t\t);\n\n\t\t\t\t// Remove old\n\t\t\t\tif (loader.pagination)\n\t\t\t\t\tloader.pagination = loader.pagination.remove();\n\n\t\t\t\tif (typeof response.pages !== \"undefined\") {\n\n\t\t\t\t\t// Pages holder\n\t\t\t\t\tlet holder = $(\"#pages\").html('');\n\n\t\t\t\t\t// Create new\n\t\t\t\t\tif (response.pages > 1 && pagination) {\n\t\t\t\t\t\tloader.pagination = pagination.add({\n\t\t\t\t\t\t\tpages: response.pages,\n\t\t\t\t\t\t\tcurrent: response.page,\n\t\t\t\t\t\t\tholder: holder\n\t\t\t\t\t\t});\n\t\t\t\t\t\tloader.pagination.onPageChange = function (pageNum) {\n\t\t\t\t\t\t\tloader.reload({virtual: {page: pageNum}});\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t};\n\n\t\t\t/* On loading error */\n\t\t\tloader.error = function (error) {\n\n\t\t\t\t// Remove pagination on error\n\t\t\t\tif (loader.pagination)\n\t\t\t\t\tloader.pagination = this.pagination.remove();\n\n\t\t\t\t// Clear\n\t\t\t\t$(loader.options.holder).html('').append(notifications.message({text: error}).render);\n\n\t\t\t};\n\n\t\t\t/* Reload */\n\t\t\tif (reload)\n\t\t\t\tloader.reload({fromUrl: true});\n\n\t\t\t/* Set handler */\n\t\t\tif (history)\n\t\t\t\tpage.history.on(\"change\", function (searchChanged, hashChanged) {\n\t\t\t\t\tif (searchChanged || hashChanged)\n\t\t\t\t\t\tloader.reload({fromUrl: true});\n\t\t\t\t});\n\n\t\t}\n\t}\n\n});","sky.service(\"inputsIO\", function () {\n\n\tthis.service = {\n\n\t\t/**\n\t\t * Get value of single input\n\t\t * @param input\n\t\t * @returns {*}\n\t\t */\n\t\treadInputValue: function (input) {\n\n\t\t\tif (input.is(\".selectReplaceChoose\")) {\n\n\t\t\t\t// Get inputs\n\t\t\t\tlet inputs = input.find(\"input\");\n\n\t\t\t\t// Read\n\t\t\t\tlet data = this.readInputsValues(inputs);\n\n\t\t\t\t// If all checked\n\t\t\t\tif (data.length === inputs.length)\n\t\t\t\t\treturn true;\n\n\t\t\t\t// Return data\n\t\t\t\treturn data;\n\n\t\t\t} else if (input.is(\":checkbox\") || input.is(\":radio\")) {\n\t\t\t\treturn input.is(\":checked\") ? input.val() : false;\n\t\t\t} else\n\t\t\t\treturn input.val() === \"\" ? false : input.val();\n\n\n\t\t},\n\n\t\t/**\n\t\t * Get value of multiple inputs\n\t\t * @param inputs\n\t\t * @returns {*}\n\t\t */\n\t\treadInputsValues: function (inputs) {\n\n\t\t\t/* If single input */\n\t\t\tif (inputs.length === 1)\n\t\t\t\treturn this.readInputValue(inputs);\n\n\t\t\t/* Values holder */\n\t\t\tlet valuesNamed = [],\n\t\t\t\tvaluesLined = [],\n\t\t\t\tself = this;\n\n\t\t\t/* Go through */\n\t\t\tinputs.each(function () {\n\n\t\t\t\t/* Get value */\n\t\t\t\tlet input = $(this),\n\t\t\t\t\tvalue = self.readInputValue(input);\n\n\t\t\t\t/* If we get values */\n\t\t\t\tif (value !== false) {\n\t\t\t\t\tvaluesNamed.push({name: input.attr(\"name\"), value: value});\n\t\t\t\t\tvaluesLined.push(value);\n\t\t\t\t}\n\n\t\t\t});\n\n\t\t\t/* Single */\n\t\t\tif (valuesLined.length === 1) {\n\t\t\t\treturn valuesLined[0];\n\t\t\t}\n\n\t\t\t/* Return */\n\t\t\treturn valuesLined.length ? valuesLined : false;\n\n\t\t},\n\n\t\t/**\n\t\t * Write single input value\n\t\t * @param value\n\t\t * @param input\n\t\t * @returns {*}\n\t\t */\n\t\twriteInputValue: function (value, input) {\n\n\t\t\tif (input.is(\".selectReplaceChoose\")) {\n\n\t\t\t\t// Get inputs\n\t\t\t\tlet inputs = input.find(\"input\");\n\n\t\t\t\t// If all checked\n\t\t\t\tif (value === true)\n\t\t\t\t\tinputs.prop(\"checked\", true);\n\t\t\t\telse\n\t\t\t\t\tthis.writeInputsValue(value, inputs);\n\n\t\t\t\tif (inputs.length)\n\t\t\t\t\tinputs.first().trigger(\"change\", {notByUser: true});\n\n\t\t\t} else if (input.is(\":checkbox\") || input.is(\":radio\")) {\n\t\t\t\treturn input.prop(\"checked\", value !== false);\n\t\t\t} else\n\t\t\t\treturn input.val(value === false ? \"\" : value);\n\t\t},\n\n\t\t/**\n\t\t * Write multiple inputs value\n\t\t * @param values\n\t\t * @param inputs\n\t\t * @returns {*}\n\t\t */\n\t\twriteInputsValue: function (values, inputs) {\n\n\t\t\t/* Write single */\n\t\t\tif (inputs.length < 2)\n\t\t\t\treturn this.writeInputValue(values, inputs);\n\n\t\t\t/* Multiple */\n\t\t\tif (inputs.is(\":checkbox\") || inputs.is(\":radio\")) {\n\t\t\t\tinputs.prop(\"checked\", false);\n\t\t\t\tif (values instanceof Array) {\n\t\t\t\t\t$.each(values, function (_, val) {\n\t\t\t\t\t\tinputs.filter('[value=\"' + val + '\"]').prop(\"checked\", true);\n\t\t\t\t\t});\n\t\t\t\t\tinputs.first().trigger(\"change\", {notByUser: true});\n\t\t\t\t} else {\n\t\t\t\t\tif (values === false || values === true)\n\t\t\t\t\t\tinputs.prop(\"checked\", values).first().trigger(\"change\", {notByUser: true});\n\t\t\t\t\telse\n\t\t\t\t\t\tinputs.filter('[value=\"' + values + '\"]').prop(\"checked\", true).trigger(\"change\", {notByUser: true});\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tinputs.val(values);\n\t\t\t}\n\t\t}\n\n\t}\n\n});","sky.service(\"searchField\", [\"utils\", \"inputsIO\"], function ({ utils, inputsIO }) {\n\tthis.service = class {\n\t\tconstructor(name, virtual) {\n\t\t\tthis.name = name;\n\t\t\tthis.inputName = name;\n\t\t\tthis.virtual = virtual || false;\n\t\t\tthis.default = null;\n\t\t\tthis.input = false;\n\t\t\tthis.value = null;\n\t\t}\n\t\tvalueOrNullOnDefault() {\n\t\t\tif ((this.default instanceof Array) && (this.value instanceof Array))\n\t\t\t\treturn utils.isObjectsEqual(this.value, this.default) ? null : this.value;\n\n\t\t\treturn this.value === this.default ? null : this.value;\n\t\t}\n\t\tread() {\n\t\t\tif (this.virtual === \"search\")\n\t\t\t\treturn this.searchRead();\n\t\t\telse if (this.virtual)\n\t\t\t\treturn this.hashRead();\n\t\t\telse if (this.input)\n\t\t\t\tthis.value = inputsIO.readInputsValues(this.input);\n\n\t\t\treturn this.value;\n\t\t}\n\t\twrite() {\n\t\t\tif (this.input)\n\t\t\t\tinputsIO.writeInputsValue(this.value === null ? this.default : this.value, this.input);\n\t\t\treturn this.value;\n\t\t}\n\t\thashRead() {\n\t\t\tlet hashValue = page.history.hashObject[this.name];\n\t\t\treturn this.value = (typeof hashValue === \"undefined\") ? this.default : hashValue;\n\t\t}\n\t\tsearchRead () {\n\t\t\tlet searchValue = page.history.searchObject[this.name];\n\t\t\treturn this.value = (typeof searchValue === \"undefined\") ? this.default : searchValue;\n\t\t}\n\t}\n});","sky.service(\"directives\", [\"exceptions\", \"utils\", \"stackList\"], function ({exceptions, utils, stackList}) {\n\n\tlet list = stackList(),\n\t\tdirectives = this.service = {\n\n\t\t\t/**\n\t\t\t * Adds new directive\n\t\t\t * @param {string} name Directive name\n\t\t\t * @param {*} options Directive options\n\t\t\t * @param {function} directive How to parse directive\n\t\t\t */\n\t\t\tadd: function (name, options, directive) {\n\n\t\t\t\t/* Reset */\n\t\t\t\tif (!directive && typeof options === \"function\") {\n\t\t\t\t\tdirective = options;\n\t\t\t\t\toptions = {};\n\t\t\t\t}\n\t\t\t\toptions.directive = directive;\n\t\t\t\toptions.selector = name;\n\n\t\t\t\t/* Save */\n\t\t\t\tlist.add(options);\n\n\t\t\t\t/* Self return*/\n\t\t\t\treturn this;\n\n\t\t\t},\n\n\t\t\t/**\n\t\t\t * Get element attributes\n\t\t\t * @param element\n\t\t\t * @returns {{}}\n\t\t\t */\n\t\t\tgetAttributes: function (element) {\n\n\t\t\t\t/* Holds attributes */\n\t\t\t\tlet attributes = {};\n\n\t\t\t\t/* Copy them to list */\n\t\t\t\tfor(let attr of element.get(0).attributes)\n\t\t\t\t\tattributes[attr.nodeName] = attr.nodeValue;\n\n\t\t\t\t/* Return */\n\t\t\t\treturn attributes;\n\n\t\t\t},\n\n\t\t\t/**\n\t\t\t * Applies directive convert to element\n\t\t\t * @param element\n\t\t\t * @param options\n\t\t\t */\n\t\t\tparseElement: function (element, options) {\n\n\t\t\t\t/* Get element */\n\t\t\t\telement = $(element);\n\n\t\t\t\t/* Get element attributes */\n\t\t\t\tlet attributes = this.getAttributes(element);\n\n\t\t\t\t/* Parse body for jason data */\n\t\t\t\tif (options[\"json\"] || options[\"jsonToData\"]) {\n\n\t\t\t\t\t/* Get child */\n\t\t\t\t\tlet jsonScript = element.children('script[type=\"application/json\"]');\n\n\t\t\t\t\t/* If we have json encoded data */\n\t\t\t\t\tif (jsonScript.length) {\n\n\t\t\t\t\t\ttry {\n\n\t\t\t\t\t\t\t/* Parse json */\n\t\t\t\t\t\t\tlet json = JSON.parse(jsonScript.text());\n\n\t\t\t\t\t\t\t/* Extend */\n\t\t\t\t\t\t\tutils.extend(attributes, json);\n\n\t\t\t\t\t\t\t/* Save to data */\n\t\t\t\t\t\t\tif (options[\"jsonToData\"])\n\t\t\t\t\t\t\t\telement.data(\"json\", json);\n\n\t\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\t\tthrow new exceptions.system.Error(\"Element \" + options.selector + \" should have json stored content, but error on parse appears\");\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t/* Call parse function */\n\t\t\t\tif (typeof options.directive === \"function\")\n\t\t\t\t\toptions.directive(element, attributes);\n\t\t\t},\n\n\t\t\t/**\n\t\t\t * Searches and replaces directives in element\n\t\t\t * @param element\n\t\t\t */\n\t\t\tparse: function (element) {\n\t\t\t\tlist.each((directive) => {\n\t\t\t\t\t$(directive.selector, element).each(function () {\n\t\t\t\t\t\tdirectives.parseElement(this, directive);\n\t\t\t\t\t});\n\t\t\t\t\tif ($(element).is(directive.selector))\n\t\t\t\t\t\tdirectives.parseElement(element, directive);\n\t\t\t\t});\n\t\t\t}\n\n\n\t\t};\n\n\t/* Add jQuery fn */\n\tjQuery.fn.parseDirectives = function () {\n\n\t\t/* Parse */\n\t\tdirectives.parse(this);\n\n\t\t/* Return */\n\t\treturn this;\n\n\t};\n\n\t/* Parse body for directives when all ready */\n\tsky.onReady(function () {\n\t\t$(\"body\").parseDirectives();\n\t});\n\n});","sky.service(\"history\", [ \"callbacks\", \"supported\" ], function ({ callbacks, supported }) {\n\n\n\t/**\n\t * Get difference fields in objects\n\t * @param {object} first  Object to compare\n\t * @param {object} second Object to compare\n\t */\n    let getObjectsDifference = function (first, second) {\n\n\t\tlet difference = {},\n\t\t    localDiff = false;\n\n        /* If both arrays or objects */\n\t\tif ((first instanceof Array && second instanceof Array) || (first instanceof Object && second instanceof Object)) {\n\n            /* Find what was changed or deleted in second */\n\t\t\t$.each(first, function (key, value) {\n\n                /* If no such elements in second */\n\t\t\t\tif (typeof second[key] === \"undefined\")\n\t\t\t\t\tdifference[key] = null; // Set to null\n\n                /* Check if different */\n\t\t\t\telse if (localDiff = getObjectsDifference(value, second[key])) {\n\t\t\t\t\tdifference[key] = localDiff;\n\t\t\t\t}\n\n\t\t\t});\n\n            /* If was added */\n\t\t\t$.each(second, function (key, value) {\n\t\t\t\tif (typeof first[key] === \"undefined\")\n\t\t\t\t\tdifference[key] = value;\n\t\t\t});\n\n            /* Convert object to array */\n\t\t\tif (first instanceof Array) {\n\t\t\t\tlet returnArray = [];\n\t\t\t\t$.each(difference, function (key) {\n\t\t\t\t\treturnArray.push(difference[key]);\n\t\t\t\t});\n\t\t\t\tdifference = returnArray;\n\t\t\t}\n\n\t\t} else {\n\t\t\tif (first !== second) return second;\n\t\t\telse return false;\n\t\t}\n\n        /* No array difference */\n\t\tif (difference.length === 0) return false;\n\t\telse return difference;\n\n\t};\n\n    /**\n     * History constructor\n     * @param [options]\n     * @returns {sky.History}\n     * @constructor\n     */\n    sky.History = function (options) {\n\n\t\t/* Self creation */\n        if (!(this instanceof sky.History))\n            return new sky.History(options);\n\n\t\t/* Reset */\n        this.options = options || {};\n\n\t\t/* Set events */\n        this.events = this.options.events || new callbacks();\n        this.options.events = this.events;\n\n\t\t/* Self return */\n        return this;\n\n    };\n\n    /**\n     * Extending\n     */\n    $.extend(sky.History.prototype, {\n\n        /**\n         * Stores last saved hash\n         */\n        hashString: \"\",\n\n        /**\n         * Stores last saved search\n         */\n        searchString: \"\",\n\n        /**\n         * Stores last saved path\n         */\n        pathString: \"\",\n\n        /**\n         * Stores object with hash params key/value pairs\n         */\n        hashObject: {},\n\n        /**\n         * Stores object with page search params key/value pairs\n         */\n        searchObject: {},\n\n        /**\n         * Stores events\n         */\n        events: undefined,\n\n        /**\n         * Holds hash check function interval id\n         */\n        intervalId: 0,\n\n        /**\n         * This page base url\n         */\n        base: \"\",\n\n        /**\n         * Changes current path to specified\n         * @param {string} path PAth to navigate\n         */\n        navigate: function (path) {\n\n            // Get path\n            path = path.replace(\"~\", this.base);\n\n            // Get current\n            let current = (window.location.pathname + window.location.search).substr(this.base.length);\n\n            // If changes\n            if (current !== path) {\n\n                // Set new state\n                history.pushState({ oldPath: this.pathString, newPath: path, search: this.searchObject}, path, path);\n\n                // Get new\n                this.pathString = window.location.pathname.substr(this.base.length);\n\n                // Get search string\n                this.searchString = this.getWindowSearch();\n\n                // Fire event\n                this.events.fire(\"navigate.path, always\", {hash: this.hashObject, path: this.pathString, search: this.searchObject});\n\n            }\n        },\n\n        /**\n         * Fires on path change\n         */\n        change: function () {\n\n\t\t\t/* Hash difference holder */\n            let hashDifference = {},\n                searchDifference = {},\n                old = this.pathString,\n                hashChanged = false,\n                searchChanged = false;\n\n\t\t\t/* If api supported */\n            if (this.supported)\n                this.pathString = window.location.pathname.substr(this.base.length);\n\n\t\t\t/* Check if hash changed */\n            if (this.hashString !== this.getWindowHash()) {\n\n\t\t\t\t/* Get difference */\n                hashDifference = this.getDifference(this.getWindowHash(), this.hashObject);\n\n\t\t\t\t/* Hash change flag */\n                hashChanged = true;\n\n            }\n\n\t\t\t/* Check if params changed */\n            if (this.searchString !== this.getWindowSearch()) {\n\n\t\t\t\t/* Get difference */\n                searchDifference = this.getDifference(this.getWindowSearch(), this.searchObject);\n\n\t\t\t\t/* Hash change flag */\n                searchChanged = true;\n\n            }\n\n\t\t\t/* If nothing changed */\n            if (this.pathString === old && !hashChanged && !searchChanged)\n                return;\n\n\t\t\t/* Rebuild hash object on new hash str */\n            this.rebuild();\n\n\t\t\t/* Fire */\n            this.events.fire(\"change, always\", {\n                hash: this.hashObject,\n                hashDifference: hashDifference,\n                searchDifference: searchDifference,\n                path: this.pathString,\n                oldPath: old,\n                searchChanged: searchChanged,\n                hashChanged: hashChanged,\n                pathChanged: old !== this.pathString\n            });\n\n        },\n\n        /**\n         * Navigates to specified path\n         * @param path\n         */\n        setHash: function (path) {\n\n\t\t\t/* To not jump top */\n            if (path === \"\" && window.location.hash !== \"\")\n                path = \"none\";\n\n\t\t\t/* Save */\n            this.hashString = path;\n\n\t\t\t/* Set hash */\n            window.location.hash = encodeURI(path);//encodeURI(path);\n\n        },\n\n        /**\n         * Navigates to specified path\n         * @param path\n         */\n        setSearch: function (path) {\n\n\t\t\t/* Set path */\n            this.navigate(window.location.pathname + encodeURI(path !== \"\" ? \"?\" + path : \"\"));\n\n        },\n\n        /**\n         * Sets hash letiable\n         * @param {object}    elements Fields to be set\n         * @param {boolean}    [force]     Replace all stored fields with elements object\n         */\n        set: function (elements, force) {\n\n            let changed = false;\n\n\t\t\t/* Force rewrite */\n            if (force)\n                this.hashObject = elements;\n\n\t\t\t/* Go through elements and add or change them */\n            $.each(elements, (key, value) => {\n\n\t\t\t\t/* If we need delete */\n                if (value === null)\n                    delete this.hashObject[key];\n                else\n                    this.hashObject[key] = value;\n\n\t\t\t\t/* Set as changed */\n                changed = true;\n\n            });\n\n\t\t\t/* If any changes we rebuild hash */\n            if (changed || force)\n                this.setHash(decodeURIComponent(jQuery.param(this.hashObject).replace(/\\+/g, \" \")));\n\n\t\t\t/* Fire */\n            this.events.fire(\"set, always\", {elements: elements, hash: this.hashObject, path: this.pathString});\n\n        },\n\n\n        /**\n         * Sets hash letiable\n         * @param {object}    elements Fields to be set\n         * @param {boolean}    [force]     Replace all stored fields with elements object\n         */\n        search: function (elements, force) {\n\n            let changed = false;\n\n\t\t\t/* Force rewrite */\n            if (force)\n                this.searchObject = elements;\n\n\t\t\t/* Go through elements and add or change them */\n            $.each(elements, $.proxy(function (key, value) {\n\n\t\t\t\t/* If we need delete */\n                if (value === null)\n                    delete this.searchObject[key];\n                else\n                    this.searchObject[key] = value;\n\n\t\t\t\t/* Set as changed */\n                changed = true;\n\n            }, this));\n\n\t\t\t/* If any changes we rebuild hash */\n            if (changed || force)\n                this.setSearch(decodeURIComponent(jQuery.param(this.searchObject).replace(/\\+/g, \" \")));\n\n\t\t\t/* Fire */\n\t\t\tthis.events.fire(\"set, always\", {elements: elements, hash: this.hashObject, path: this.pathString});\n\n        },\n\n        /**\n         * Makes hash from object\n         * @param obj\n         * @returns {*|void|string|XML}\n         */\n        stringFromObject: function (obj) {\n            return jQuery.param(obj).replace(/\\+/g, \" \");\n        },\n\n        /**\n         * Get objects according to hash string\n         * @param {string} paramsString String which contains key=value pairs, would be parsed to object\n         */\n        getObjects: function (paramsString) {\n\n            let objects = {};\n\n\t\t\t/* Remove sharp */\n            if (paramsString.substr(0, 1) === '#' || paramsString.substr(0, 1) === '?')\n                paramsString = paramsString.slice(1, paramsString.length);\n\n\t\t\t/* Split parameters */\n            let subStrings = paramsString.split(\"&\");\n\n\t\t\t/* Get params */\n            $.each(subStrings, function (i, str) {\n\n                let keyAndValue = str.split(\"=\", 2);\n\n\t\t\t\t/* If no assign */\n                if (keyAndValue.length < 2)\n                    return;\n\n                let name = keyAndValue[0];\n\n\t\t\t\t/* Truncate brackets */\n                if (name.substr(-2) === \"[]\")\n                    name = name.substr(0, name.length - 2);\n\n\t\t\t\t/* Special hash for \"=\" in value  */\n                keyAndValue[1] = str.substr(keyAndValue[0].length + 1);\n\n\t\t\t\t/* If object repeats we create array */\n                if (typeof objects[name] === \"undefined\") objects[name] = keyAndValue[1];\n                else {\n                    if (!(objects[name] instanceof Array)) objects[name] = [objects[name]];\n                    objects[name].push(keyAndValue[1]);\n                }\n            });\n\n            return objects;\n\n        },\n\n        /**\n         * Finds difference between current stored hash and parameter\n         * @returns {*}\n         */\n        getDifference: function (string, stored) {\n\n\t\t\t/* Init */\n            let objects = this.getObjects(decodeURI(string));\n            return getObjectsDifference(stored, objects);\n\n        },\n\n        /**\n         * Rebuilds stored hash parameters according to current one\n         */\n        rebuild: function () {\n            this.hashString = this.getWindowHash();\n            this.hashObject = this.getObjects(this.hashString);\n            this.searchString = this.getWindowSearch();\n            this.searchObject = this.getObjects(this.searchString);\n            this.pathString = window.location.pathname;\n            return this;\n\n        },\n\n        /**\n         * Gets current window hash without \"#\"\n         * @returns {string}\n         */\n        getWindowHash: function () {\n\n\t\t\t/* Get decoded hash */\n            let hash = decodeURI(window.location.hash);\n\n\t\t\t/* Remove sharp */\n            if (hash.substr(0, 1) === '#')\n                hash = hash.slice(1);\n\n\t\t\t/* Return */\n            return hash;\n\n        },\n\n        /**\n         * Gets current window parameters without \"?\"\n         * @returns {string}\n         */\n        getWindowSearch: function () {\n\n\t\t\t/* Get decoded hash */\n            let search = decodeURI(window.location.search);\n\n\t\t\t/* Remove question */\n            if (search.substr(0, 1) === '?')\n                search = search.slice(1);\n\n\t\t\t/* Return */\n            return search;\n\n        },\n\n        /**\n         * Set interval execution\n         */\n        start: function () {\n\n            /* Set base if any */\n\t\t\tif (this.options.base)\n\t\t\t\tthis.base = this.options.base;\n\n\t\t\t/* If supported history */\n            if (window.history)\n                window.onpopstate = this.change.bind(this);\n\n            /* Timeout */\n            if (!this.intervalId)\n                this.intervalId = setInterval(this.change.bind(this), this.options.time || 500);\n\n\t\t\t/* Immediately event */\n            this.change();\n            return this;\n        }\n\n    });\n\n});","sky.service(\"localStorage\", [ \"callbacks\" ], function({ callbacks }) {\n\n\t//noinspection JSUnusedLocalSymbols\n\tlet LocalStorage = this.service = class {\n\t\tconstructor(options) {\n\t\t\tthis.name = options.name || \"global\";\n\t\t\tthis.events = callbacks();\n\t\t}\n\n\t\t/**\n\t\t * Loads item form database\n\t\t * @param {*} id Unique id\n\t\t */\n\t\tload(id) {\n\t\t\tlet items = this.getItems();\n\t\t\treturn items ? items[id] : undefined;\n\t\t}\n\n\t\tgetItems() {\n\t\t\ttry {\n\n\t\t\t\t/* Try to get item from storage */\n\t\t\t\tlet items = localStorage.getItem(this.name);\n\n\t\t\t\t/* Trigger error */\n\t\t\t\tif(items !== null)\n\t\t\t\t\treturn $.parseJSON(items);\n\n\t\t\t} catch(e) {\n\t\t\t\tthis.events.fire(\"error\", { storage: this });\n\t\t\t}\n\n\t\t\t/* Undefined on error */\n\t\t\treturn undefined;\n\n\t\t}\n\n\t\t/**\n\t\t * Save data to storage\n\t\t * @param id\n\t\t * @param data\n\t\t * @returns {*}\n\t\t */\n\t\tsave(id, data) {\n\n\t\t\ttry {\n\n\t\t\t\t/* Save */\n\t\t\t\tlet items = this.getItems() || {};\n\n\t\t\t\t/* Add item */\n\t\t\t\titems[id] = data;\n\n\t\t\t\t/* Save keys */\n\t\t\t\tlocalStorage.setItem(this.name, JSON.stringify(items));\n\n\t\t\t} catch(e) {\n\t\t\t\tthis.events.fire(\"error\", { storage: this });\n\t\t\t}\n\n\t\t\t/* Self return */\n\t\t\treturn this;\n\n\t\t}\n\n\t\t/**\n\t\t * Removes from storage\n\t\t * @param id\n\t\t * @returns {*}\n\t\t */\n\t\tremove(id) {\n\t\t\ttry {\n\n\t\t\t\t/* Save */\n\t\t\t\tlet items = this.getItems();\n\n\t\t\t\t/* Add item */\n\t\t\t\tdelete items[id];\n\n\t\t\t\t/* Save keys */\n\t\t\t\tlocalStorage.setItem(this.name, JSON.stringify(items));\n\n\t\t\t} catch(e) {\n\t\t\t\tthis.events.fire(\"error\", { storage: this });\n\t\t\t}\n\n\t\t\t/* Self return */\n\t\t\treturn this;\n\n\t\t}\n\t};\n\n});","sky.service(\"drag\", [\"callbacks\"], function({callbacks}) {\n\tlet self = {\n\t\tbindEvents: (event, events) => {\n\t\t\tself.bind(event)\n\t\t\t\t.on(\"start\", events.start)\n\t\t\t\t.on(\"move\", events.move)\n\t\t\t\t.on(\"stop\", events.stop)\n\t\t},\n\t\tbind: event => {\n\n\t\t\t// Get original event\n\t\t\tevent = event.originalEvent || event;\n\n\t\t\t// Init vars\n\t\t\tlet started = false,\n\t\t\t\tcallbacks = callbacks();\n\n\t\t\t// Check button\n\t\t\tif(event.button && event.button !== 1)\n\t\t\t\treturn callbacks;\n\n\t\t\t// Stop default action\n\t\t\tevent.preventDefault();\n\n\t\t\t$(document).on(\"mousemove.drag\", function(event) {\n\n\t\t\t\t// Start\n\t\t\t\tif(!started) {\n\t\t\t\t\tstarted = true;\n\t\t\t\t\tcallbacks.fire(\"start\", { event: event, x: event.pageX, y: event.pageY });\n\t\t\t\t}\n\t\t\t\t// Move\n\t\t\t\telse callbacks.fire(\"move\", { event: event, x: event.pageX, y: event.pageY });\n\n\t\t\t\t// Prevent default\n\t\t\t\tevent.preventDefault();\n\t\t\t\treturn false;\n\n\t\t\t}).on(\"mouseup.drag\", function(event) {\n\n\t\t\t\t// Off events\n\t\t\t\t$(document).off(\"mousemove.drag\").off(\"mouseup.drag\");\n\n\t\t\t\t// If not started\n\t\t\t\tif(!started)\n\t\t\t\t\treturn;\n\n\t\t\t\t// Stop default action\n\t\t\t\tevent.preventDefault();\n\n\t\t\t\t// Call stop callback\n\t\t\t\tcallbacks.fire(\"stop\", { event: event, x: event.pageX, y: event.pageY });\n\n\t\t\t});\n\n\t\t\treturn callbacks;\n\t\t}\n\t};\n\treturn self;\n});","sky.service(\"calendar\", [ \"templates\", \"visibleCalculator\" ], function ({ templates, visibleCalculator }) {\n\n\t/* This class is for showing calendar to pick date on page */\n\tlet calendar = {\n\n\t\t/* Days set */\n\t\tmonthsNames: window.page.data.monthsNames || [\"Январь\", \"Февраль\", \"Март\", \"Апрель\", \"Май\", \"Июнь\", \"Июль\", \"Август\", \"Сентябрь\", \"Октябрь\", \"Ноябрь\", \"Декабрь\"],\n\n\t\trenderDays: function () {\n\n\t\t\t/* Clone */\n\t\t\tlet current = moment(this.date),\n\t\t\t\tweeks = [],\n\t\t\t\tcurrentWeek = false;\n\n\t\t\t/* From first */\n\t\t\tcurrent.date(1);\n\n\t\t\t/* Go through */\n\t\t\twhile (current.month() === this.date.month()) {\n\n\t\t\t\t/* Make week if new */\n\t\t\t\tif (!currentWeek || current.day() === 1) {\n\t\t\t\t\tcurrentWeek = {number: current.isoWeek(), days: []};\n\t\t\t\t\tweeks.push(currentWeek);\n\t\t\t\t}\n\n\t\t\t\t/* Push */\n\t\t\t\tcurrentWeek.days.push({date: current.clone(), dateStr: current.format(\"YYYY.MM.DD\"), day: current.day() === 0 ? 6 : current.day() - 1});\n\n\t\t\t\t/* Go next day */\n\t\t\t\tcurrent.add(1, \"d\");\n\n\t\t\t}\n\n\t\t\t/* Render */\n\t\t\tthis.dates.html('').append(templates.render(\"calendar-dates\", {\n\t\t\t\tweeks: weeks,\n\t\t\t\tdateStr: this.date.format(\"YYYY.MM.DD\"),\n\t\t\t\tcurrent: this.date,\n\t\t\t\tperiod: this.period,\n\t\t\t\tsince: this.since,\n\t\t\t\ttill: this.till\n\t\t\t}));\n\n\t\t\t/* Render */\n\t\t\tthis.setTime();\n\n\t\t},\n\n\t\t/**\n\t\t * When user picks date\n\t\t * @param {*} dayDiv Div that user clicked, if he did\n\t\t * @param notClose\n\t\t */\n\t\tdayPick: function (dayDiv, notClose) {\n\n\t\t\t/* Set date */\n\t\t\tif (dayDiv)\n\t\t\t\tthis.date.date(parseInt(dayDiv.html()));\n\n\t\t\tthis.field.val(this.getInputValue()).trigger(\"change\").trigger(\"keyup\");\n\t\t\tif (!notClose) this.close();\n\n\t\t},\n\n\t\tgetInputValue: function () {\n\n\t\t\t/* Get field new value */\n\t\t\tif (this.useTime)\n\t\t\t\treturn this.date.format(\"DD.MM.YYYY HH:mm\");\n\t\t\telse if (this.period && this.since.isSame(this.till))\n\t\t\t\treturn this.since.format(\"DD.MM.YYYY\");\n\t\t\telse if (this.period)\n\t\t\t\treturn this.since.format(\"DD.MM.YYYY\") + ' - ' + this.till.format(\"DD.MM.YYYY\");\n\n\t\t\t/* Default */\n\t\t\treturn this.date.format(\"DD.MM.YYYY\");\n\n\t\t},\n\n\t\tsetDayPick: function () {\n\t\t\tthis.pickedDateView.html(this.getInputValue());\n\t\t},\n\n\t\t/**\n\t\t * Position date picker\n\t\t * @param {*} field Item that we should position under\n\t\t */\n\t\tposition: function (field) {\n\n\t\t\tthis.holder.insertAfter(field.parent()).css(\"position\", \"absolute\");\n\n\t\t\tlet calculator = new visibleCalculator(field),\n\t\t\t\toffset = calculator.getDropOffset(field, this.holder);\n\n\t\t\tthis.holder.css({\n\t\t\t\tmarginTop: offset.top,\n\t\t\t\tmarginLeft: offset.left\n\t\t\t});\n\n\t\t},\n\n\t\t/**\n\t\t * Sets time inputs in calendar values\n\t\t */\n\t\tsetTime: function () {\n\n\t\t\t/* Set time */\n\t\t\tthis.holder.find(\".time .hour\").val(this.date.format(\"HH\"));\n\t\t\tthis.holder.find(\".time .minute\").val(this.date.format(\"mm\"));\n\n\t\t},\n\n\t\tperiodChangeDay: function () {\n\n\t\t\tlet reset = function () {\n\t\t\t\tcalendar.since = calendar.date.clone();\n\t\t\t\tcalendar.till = calendar.date.clone();\n\t\t\t\tcalendar.lastModified = \"none\"\n\t\t\t};\n\n\t\t\tif (this.date.isBefore(this.since)) {\n\t\t\t\tif (this.lastModified !== \"since\") {\n\t\t\t\t\tthis.since = this.date.clone();\n\t\t\t\t\tthis.lastModified = \"since\"\n\t\t\t\t}\n\t\t\t\telse reset();\n\t\t\t} else if (this.date.isAfter(this.till)) {\n\t\t\t\tif (this.lastModified !== \"till\") {\n\t\t\t\t\tthis.till = this.date.clone();\n\t\t\t\t\tthis.lastModified = \"till\"\n\t\t\t\t}\n\t\t\t\telse reset();\n\t\t\t} else if (this.date.isSame(this.till) || this.date.isSame(this.since))\n\t\t\t\treset();\n\t\t\telse {\n\t\t\t\tif (this.lastModified === \"since\") {\n\t\t\t\t\tthis.till = this.date.clone();\n\t\t\t\t\tthis.lastModified = \"till\"\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tthis.since = this.date.clone();\n\t\t\t\t\tthis.lastModified = \"since\"\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tcalendar.markSelected();\n\n\t\t},\n\n\t\tmarkSelected: function () {\n\n\t\t\tthis.dates.find(\".day\").removeClass(\"selected\").removeClass(\"subSelected\").each(function () {\n\n\n\t\t\t\tlet element = $(this),\n\t\t\t\t\tdate = calendar.date.clone().date(parseInt(element.html()));\n\n\t\t\t\tif (!calendar.period) {\n\t\t\t\t\tif (date.format(\"DD.MM.YYYY\") === calendar.date.format(\"DD.MM.YYYY\"))\n\t\t\t\t\t\telement.addClass(\"subSelected\");\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (date.isAfter(calendar.since) && date.isBefore(calendar.till))\n\t\t\t\t\telement.addClass(\"subSelected\");\n\t\t\t\telse if (date.isSame(calendar.since) || date.isSame(calendar.till))\n\t\t\t\t\telement.addClass(\"selected\");\n\n\t\t\t});\n\n\t\t},\n\n\t\t/**\n\t\t * Changes day\n\t\t * @param {*} element Day picker\n\t\t * @returns {undefined}\n\t\t */\n\t\tchangeDay: function (element) {\n\n\t\t\t/* If pick today */\n\t\t\tthis.date.date(parseInt(element.html()));\n\n\t\t\t/* No more for period */\n\t\t\tif (this.period) {\n\t\t\t\tthis.periodChangeDay();\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tcalendar.markSelected();\n\n\t\t\t/* Set time */\n\t\t\tif (this.field.attr(\"name\") === \"since\")\n\t\t\t\tthis.date.hour(0).minute(0);\n\t\t\telse if (this.date.format(\"DD-MM-YYYY\") === moment().format(\"DD-MM-YYYY\"))\n\t\t\t\tthis.date.hour(moment().hour()).minute(moment().minute());\n\t\t\telse\n\t\t\t\tthis.date.hour(23).minute(59);\n\n\t\t\t/* Pick */\n\t\t\tif (this.useTime)\n\t\t\t\tthis.setTime();\n\n\t\t},\n\n\t\t/**\n\t\t * Sets specified year\n\t\t * @param {int} year Year that need to be set\n\t\t */\n\t\tchangeYear: function (year) {\n\n\t\t\t/* Set year */\n\t\t\tthis.date.year(year);\n\n\t\t\t/* Update */\n\t\t\tthis.yearView.html(year);\n\n\t\t\t/* Dates redraw */\n\t\t\tthis.renderDays();\n\n\t\t},\n\n\t\t/**\n\t\t * Sets specified month\n\t\t * @param {int} month Month to be set\n\t\t */\n\t\tchangeMonth: function (month) {\n\n\t\t\t/* Set year */\n\t\t\tthis.date.month(month);\n\n\t\t\t/* Updates */\n\t\t\tthis.monthView.html(this.monthsNames[this.date.month()] + ' ' + this.date.year());\n\n\t\t\t/* Reload year */\n\t\t\tthis.changeYear(this.date.year());\n\n\t\t},\n\n\t\tgetDatePeriod: function (dateString) {\n\n\t\t\t// Split and get since\n\t\t\tlet parts = dateString.split('-'),\n\t\t\t\ttill,\n\t\t\t\tsince = this.getDate(parts[0].trim());\n\n\t\t\t// Get till\n\t\t\tif (parts.length > 1)\n\t\t\t\ttill = this.getDate(parts[1].trim());\n\t\t\telse\n\t\t\t\ttill = this.getDate(parts[0].trim());\n\n\t\t\t// Set inner lets\n\t\t\tthis.since = since;\n\t\t\tthis.till = till;\n\t\t\tthis.date = since.clone();\n\n\t\t},\n\n\t\t/**\n\t\t * Creates today date\n\t\t */\n\t\tgetDate: function (dateString) {\n\n\t\t\t/* Set calendar date */\n\t\t\tlet date = false;\n\n\t\t\t/* If input has datetime format value */\n\t\t\tif (dateString.match(/^\\d{4}-\\d{2}-\\d{2} \\d{1,2}:\\d{1,2}$/))\n\t\t\t\tdate = moment(dateString, \"YYYY-MM-DD HH:mm\");\n\n\t\t\t/* Id input has date format value */\n\t\t\tif (dateString.match(/^\\d{4}-\\d{2}-\\d{2}$/))\n\t\t\t\tdate = moment(dateString, \"YYYY-MM-DD\");\n\n\t\t\t/* Id input has date format value */\n\t\t\tif (dateString.match(/^\\d{2}.\\d{2}.\\d{4}$/))\n\t\t\t\tdate = moment(dateString, \"DD.MM.YYYY\");\n\n\t\t\t/* Id input has date format value */\n\t\t\tif (dateString.match(/^\\d{2}.\\d{2}.\\d{4} \\d{2}:\\d{2}$/))\n\t\t\t\tdate = moment(dateString, \"DD.MM.YYYY HH:mm\");\n\n\t\t\t/*  If still no */\n\t\t\tif (!date) {\n\t\t\t\tdate = moment();\n\n\t\t\t\t/* Set time */\n\t\t\t\tif (this.field.attr(\"name\") === \"since\")\n\t\t\t\t\tdate.hour(0).minute(0);\n\t\t\t}\n\n\t\t\t/* Reset time */\n\t\t\tif (!this.useTime)\n\t\t\t\tdate.hour(0).minute(0);\n\n\t\t\t/* Additional check */\n\t\t\treturn this.date = date;\n\n\t\t},\n\n\t\t/**\n\t\t * Closes windows\n\t\t */\n\t\tclose: function () {\n\n\t\t\t/* Remove calendar */\n\t\t\tif (this.holder)\n\t\t\t\tthis.holder.remove();\n\n\t\t\t/* Unset */\n\t\t\tif (this.field) {\n\t\t\t\tthis.field.off(\"keyup.calendar\");\n\t\t\t\tthis.field = false;\n\t\t\t}\n\t\t}\n\t};\n\n\tlet show = function (field, showTime) {\n\n\t\t/* Remove old calendars */\n\t\tthis.close();\n\n\t\t/* Begins from current date */\n\t\tthis.field = field;\n\t\tthis.period = false;\n\t\tthis.useTime = showTime ? showTime : false;\n\t\t// this.lastPicked = \"none\";\n\n\t\tif (field.is(\"input.datePeriod\")) {\n\t\t\tthis.period = true;\n\t\t\tthis.getDatePeriod(field.val());\n\t\t} else\n\t\t\tthis.getDate(field.val());\n\n\t\t/* Render */\n\t\tthis.holder = templates.render(\"calendar\", this);\n\n\t\t/* Actions */\n\t\tthis.holder\n\n\t\t/* Months changer */\n\t\t\t.action(\"click\", \".month .next\", function (event) {\n\t\t\t\tevent.preventDefault();\n\t\t\t\tcalendar.changeMonth(calendar.date.month() + 1);\n\t\t\t})\n\t\t\t.action(\"click\", \".month .prev\", function (event) {\n\t\t\t\tevent.preventDefault();\n\t\t\t\tcalendar.changeMonth(calendar.date.month() - 1);\n\t\t\t})\n\n\t\t\t/* Years */\n\t\t\t.action(\"click\", \".year .next\", function (event) {\n\t\t\t\tevent.preventDefault();\n\t\t\t\tcalendar.changeYear(calendar.date.year() + 1);\n\t\t\t})\n\t\t\t.action(\"click\", \".year .prev\", function (event) {\n\t\t\t\tevent.preventDefault();\n\t\t\t\tcalendar.changeYear(calendar.date.year() - 1);\n\t\t\t})\n\t\t\t.action(\"click\", \".setNow\", function (event) {\n\t\t\t\tevent.preventDefault();\n\t\t\t\tcalendar.date = moment();\n\t\t\t\tcalendar.renderDays();\n\t\t\t\tcalendar.setTime();\n\t\t\t})\n\t\t\t.action(\"click\", \".setToday\", function (event) {\n\t\t\t\tevent.preventDefault();\n\t\t\t\tcalendar.date = moment();\n\t\t\t\tcalendar.date.hour(0);\n\t\t\t\tcalendar.date.minute(0);\n\t\t\t\tcalendar.renderDays();\n\t\t\t\tcalendar.setTime();\n\t\t\t})\n\t\t\t.action(\"click\", \".setWeek\", function (event) {\n\t\t\t\tevent.preventDefault();\n\t\t\t\tcalendar.date = moment();\n\t\t\t\tcalendar.date.subtract(7, \"d\");\n\t\t\t\tcalendar.renderDays();\n\t\t\t\tcalendar.setTime();\n\t\t\t})\n\n\t\t\t/* Day */\n\t\t\t.action(\"click\", \".dates .day\", function (event) {\n\t\t\t\tevent.preventDefault();\n\t\t\t\tlet self = $(this);\n\n\t\t\t\tif (self.is(\".selected\") && !calendar.period)\n\t\t\t\t\tcalendar.dayPick($(this));\n\t\t\t\telse {\n\t\t\t\t\tcalendar.changeDay($(this));\n\t\t\t\t\tcalendar.dayPick(false, true);\n\t\t\t\t}\n\t\t\t})\n\n\t\t\t/* Apply button */\n\t\t\t.action(\"click\", \".apply\", function (event) {\n\t\t\t\tevent.preventDefault();\n\t\t\t\tcalendar.dayPick();\n\t\t\t})\n\n\t\t\t/* Time */\n\t\t\t.action(\"click\", \".time a\", function (event) {\n\t\t\t\tevent.preventDefault();\n\t\t\t\tcalendar.date.hour(moment().hour());\n\t\t\t\tcalendar.date.minute(moment().minute());\n\t\t\t\tcalendar.setTime();\n\t\t\t})\n\t\t\t.action(\"keyup\", \".time .hour\", function () {\n\t\t\t\tcalendar.date.hour(this.value);\n\t\t\t})\n\t\t\t.action(\"keyup\", \".time .minute\", function () {\n\t\t\t\tcalendar.date.minute(this.value);\n\t\t\t});\n\n\n\t\t/* Close and containers */\n\t\tthis.dates = this.holder.find(\".dates\");\n\t\tthis.yearView = this.holder.find(\".year .value\");\n\t\tthis.monthView = this.holder.find(\".month .value\");\n\t\tthis.pickedDateView = this.holder.find(\".pickedDate\");\n\n\t\t/* Refresh days */\n\t\tthis.renderDays();\n\n\t\t/* Reposition */\n\t\tthis.position(field);\n\t\tthis.setDayPick();\n\n\t\t/* Auto change */\n\t\tthis.field.on(\"keyup.calendar\", function () {\n\t\t\tshow(field, showTime);\n\t\t});\n\n\t\tlet dateOriginal;\n\t\tthis.dates.on(\"touchstart\", function (event) {\n\n\t\t\tlet element = $(event.target);\n\t\t\tif (!element.is(\".day\")) return;\n\t\t\tdateOriginal = calendar.date.clone().date(parseInt(element.html()));\n\n\t\t}).on(\"touchmove\", function (event) {\n\n\t\t\t/* No original event */\n\t\t\tevent.preventDefault();\n\n\t\t\tlet element = document.elementFromPoint((event.clientX || event.originalEvent.touches[0].clientX), (event.clientY || event.originalEvent.touches[0].clientY));\n\t\t\telement = $(element);\n\n\t\t\tif (!element.is(\".day\")) return;\n\n\t\t\tlet date = dateOriginal.clone().date(parseInt(element.html()));\n\n\t\t\tif (date.isBefore(dateOriginal)) {\n\t\t\t\tcalendar.since = date.clone();\n\t\t\t\tcalendar.till = dateOriginal.clone();\n\t\t\t} else {\n\t\t\t\tcalendar.since = dateOriginal.clone();\n\t\t\t\tcalendar.till = date.clone();\n\t\t\t}\n\t\t\tcalendar.lastModified = \"none\";\n\t\t\tcalendar.markSelected();\n\t\t\t// $(this).trigger(\"click\");\n\n\t\t});\n\n\t}.bind(calendar);\n\n\t/* Return */\n\tthis.service = show;\n\n});\n\nsky.onReady(({calendar}) => {\n\n\t/* Calendar show */\n\t$(document).action(\"click.calendar\", function (event) {\n\n\t\t/* Get element */\n\t\tlet element = $(event.target || event.srcElement);\n\n\t\t/* Remove calendar */\n\t\tif (!element.is(\".calendar\") && !element.parents(\".calendar\").length)\n\t\t\t$(\".calendar\").remove();\n\n\t\t/* Calendar show */\n\t\tif (element.is(\"input.date\"))\n\t\t\tcalendar(element);\n\n\t\t/* Calendar show */\n\t\tif (element.is(\"input.datePeriod\"))\n\t\t\tcalendar(element, false, true);\n\n\t\t/* Calendar show */\n\t\tif (element.is(\"input.datetime\"))\n\t\t\tcalendar(element, true);\n\n\t\t/* Calendar show */\n\t\tif (element.is(\"input.datehour\"))\n\t\t\tcalendar(element, true);\n\n\t}).action(\"keydown.calendar\", function (event) {\n\t\tif (event.keyCode === 13) {\n\t\t\tlet calendars = $(\".calendar\");\n\t\t\tif (calendars.length) {\n\t\t\t\tcalendars.find(\".day.selected\").trigger(\"click\");\n\t\t\t\tevent.preventDefault();\n\t\t\t}\n\t\t}\n\t});\n});","/** Class to work with drop zone for File api */\nsky.service(\"ajaxFilesDropZone\", [\"supported\", \"callbacks\"], function({ supported, callbacks }) {\n\tthis.service = class {\n\t\tconstructor({ zone, data, url, options }) {\n\n\t\t\t/* Save options */\n\t\t\tthis.options   = options;\n\t\t\tthis.zone      = zone;\n\t\t\tthis.callbacks = callbacks();\n\t\t\tthis.data      = data;\n\t\t\tthis.url       = url;\n\t\t\tthis.files     = [];\n\n\t\t\t/* If no XHR supported, no file drop needed */\n\t\t\tif(!supported.XHRUpload) {\n\t\t\t\tthis.callbacks.fire(\"nonSupported\");\n\t\t\t\treturn this;\n\t\t\t}\n\n\t\t\t/* Bind events */\n\t\t\tthis.attachEvents();\n\n\t\t}\n\n\t\tattachEvents() {\n\n\t\t\t/* While over event */\n\t\t\tthis.zone.on({\n\n\t\t\t\tdragenter: (event) => { this.callbacks.fire(\"dragenter\", this, [event]); },\n\t\t\t\tdragleave: (event) => { this.callbacks.fire(\"dragleave\", this, [event]); },\n\t\t\t\tdragend  : (event) => { this.callbacks.fire(\"dragend\", this, [event]); \t },\n\t\t\t\tdrop     : (event) => { this.callbacks.fire(\"drop\", this, [event]);\t\t },\n\t\t\t\tdragover : (event) => {\n\n\t\t\t\t\t/* Get event */\n\t\t\t\t\tevent = event.originalEvent;\n\n\t\t\t\t\t/* Check if drag is valid */\n\t\t\t\t\tif(!this.isValidFileDrag(event))\n\t\t\t\t\t\treturn;\n\n\t\t\t\t\t/* Get effect */\n\t\t\t\t\tlet effect = event.dataTransfer.effectAllowed;\n\n\t\t\t\t\t/* Set proper */\n\t\t\t\t\tif(effect === 'move' || effect === 'linkMove') {\n\t\t\t\t\t\tevent.dataTransfer.dropEffect = 'move'; // for FF (only move allowed)\n\t\t\t\t\t} else {\n\t\t\t\t\t\tevent.dataTransfer.dropEffect = 'copy'; // for Chrome\n\t\t\t\t\t}\n\n\t\t\t\t\t/* Prevent */\n\t\t\t\t\tevent.preventDefault();\n\n\t\t\t\t}\n\t\t\t});\n\n\t\t\t/* Stop file opening when drop on browser window */\n\t\t\t$(document).bind({\n\t\t\t\tdragover : function(e) {\n\t\t\t\t\te = e.originalEvent;\n\t\t\t\t\tif(e.dataTransfer) {\n\t\t\t\t\t\te.dataTransfer.dropEffect = 'none';\n\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tdragenter: function(e) {\n\t\t\t\t\tif(typeof self.options.onStart !== \"undefined\")\n\t\t\t\t\t\tself.options.onStart.apply(self, [e]);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tstatic isValidFileDrag(event) {\n\n\t\t\tlet dt = event.dataTransfer,\n\t\t\t// do not check dt.types.contains in webkit, because it crashes safari 4\n\t\t\t\tisWebkit = navigator.userAgent.indexOf(\"AppleWebKit\") > -1;\n\n\t\t\t// dt.effectAllowed is none in Safari 5\n\t\t\t// dt.types.contains check is for firefox\n\t\t\treturn dt && dt.effectAllowed !== 'none' &&\n\t\t\t\t(dt.files || (!isWebkit && dt.types.contains && dt.types.contains('Files')));\n\n\t\t}\n\n\t};\n\n});","sky.service(\"ajaxFilesIFrame\", function() {\n\n\tlet AjaxFilesIFrame = function(options) {\n\n\t\t/* Save options */\n\t\tthis.options \t= options;\n\t\tthis.files    \t= options.files;\n\t\tthis.input   \t= options.input;\n\t\tthis.url  \t \t= options.url;\n\t\tthis.data \t \t= options.data;\n\t\tthis.callbacks \t= options.callbacks;\n\n\t};\n\n\tAjaxFilesIFrame.prototype = {\n\n\t\tgetName: function(name){\n\n\t\t\t// get input value and remove path to normalize\n\t\t\treturn name.replace(/.*(\\/|\\\\)/, \"\");\n\n\t\t},\n\n\t\tcancel: function(id){\n\n\t\t\tthis.options.onAbort(id, this.getName(this.input.value));\n\n\t\t\tthis.IFrame.setAttribute('src', 'javascript:false;').remove();\n\n\t\t},\n\n\t\t/**\n\t\t * Upload file function\n\t\t */\n\t\tsend: function() {\n\n\t\t\t/* letiables */\n\t\t\tlet self \t = this;\n\t\t\tlet input \t = this.input;\n\t\t\tlet fileName = this.getName(input.value);\n\n\t\t\t/* Create new input */\n\t\t\t$(input).clone().val(\"\").insertBefore(input);\n\n\t\t\t/* Create elements */\n\t\t\tthis.IFrame = this.createIframe();\n\t\t\tthis.form = this.createForm(this.IFrame, this.options.data).append(input);\n\n\t\t\tthis.attachLoadEvent(this.IFrame, function() {\n\n\t\t\t\tlet response = self.getIframeContentJSON(self.IFrame);\n\n\t\t\t\tif(response) self.options.onSuccess(response);\n\n\t\t\t\t// timeout added to fix busy state in FF3.6\n\t\t\t\tsetTimeout(function(){ self.IFrame.remove(); }, 1);\n\n\t\t\t});\n\n\t\t\tthis.form.trigger(\"submit\");\n\n\t\t},\n\n\t\t/**\n\t\t * Attach load event to IFrame\n\t\t */\n\t\tattachLoadEvent: function(iframe, callback){\n\n\t\t\tiframe.load(function(){\n\n\t\t\t\tif (!this.parentNode) return;\n\n\t\t\t\t// fixing Opera 10.53\n\t\t\t\tif (this.contentDocument &&\n\t\t\t\t\tthis.contentDocument.body &&\n\t\t\t\t\tthis.contentDocument.body.innerHTML === \"false\") return;\n\n\t\t\t\tcallback();\n\n\t\t\t});\n\n\t\t},\n\n\t\t/**\n\t\t * Returns json object received by IFrame from server.\n\t\t */\n\t\tgetIframeContentJSON: function(iframe){\n\n\t\t\t/* IFrame.contentWindow.document - for IE<7 */\n\t\t\tlet doc = iframe.get(0).contentDocument ? iframe.get(0).contentDocument: iframe.get(0).contentWindow.document;\n\n\t\t\tlet response = doc.body.innerHTML\n\n\t\t\t/* Check for empty response */\n\t\t\tif(response === \"\") {\n\t\t\t\tif(self.callbacks) self.callbacks.onError(\"Данные небыли переданы\"); // No data\n\t\t\t\treturn false;\n\t\t\t}\n\n\n\t\t\t/* Try to get json data */\n\t\t\ttry {\n\t\t\t\tresponse = jQuery.parseJSON(response);\n\t\t\t} catch(e) {\n\t\t\t\tif(self.callbacks) {\n\t\t\t\t\tself.callbacks.onError(\"Неверный формат данных\"); // No data\n\t\t\t\t\tconsole.log(response);\n\t\t\t\t}\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\t/* If response returned with error */\n\t\t\tif(response.error) {\n\t\t\t\tif(self.callbacks) self.callbacks.onError(response.text); // Execute user error handler\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\treturn response;\n\t\t},\n\n\t\t/**\n\t\t * Creates IFrame with unique name\n\t\t */\n\t\tcreateIframe: function() {\n\n\t\t\treturn $('<IFrame/>', { src: \"javascript:false;\", name: \"uploadIFrame\" + Math.floor(Math.random()*1000000) }).css(\"display\", \"none\").appendTo('body');\n\n\t\t},\n\n\t\t/**\n\t\t * Creates form, that will be submitted to IFrame\n\t\t */\n\t\tcreateForm: function(iframe, params) {\n\n\t\t\tlet queryString = this.url + \"?\" + jQuery.param(params);\n\n\t\t\treturn $('<form/>', {\n\t\t\t\tmethod: \"post\", enctype: \"multipart/form-data\", action: queryString, target: iframe.attr(\"name\")\n\t\t\t}).css(\"display\", \"none\").appendTo('body');\n\n\t\t}\n\n\t};\n\n});","/**\n * Module to work with ajax file upload\n */\nsky.service(\"ajaxFiles\", [\"supported\", \"callbacks\", \"ajaxFilesXHR\", \"ajaxFilesIFrame\"], function({ callbacks, supported, ajaxFilesXHR, ajaxFilesIFrame }) {\n\n\t/**\n\t * Class to work with dynamic file upload\n\t * @param {html|string} input Input to be used to upload\n\t * @param {string} url Url to upload\n\t * @param {object} data Data to be send with request\n\t */\n\tlet AjaxFiles = this.service = function(input, url, data) {\n\n\t\t/* Self construct */\n\t\tif(!(this instanceof AjaxFiles))\n\t\t\treturn new AjaxFiles(input, url, data);\n\n\t\t/* Save items */\n\t\tthis.inputs \t= $(input);\n\t\tthis.url   \t\t= url;\n\t\tthis.data  \t\t= data;\n\t\tthis.callbacks \t= callbacks();\n\t\tthis.files\t\t= [];\n\n\t\t/**\n\t\t * Function to handle file input change\n\t\t */\n\t\tthis.saveFiles = function(input) {\n\n\t\t\t/* Get files list */\n\t\t\tif(supported.XHRUpload) {\n\n\t\t\t\t/* Get files from event */\n\t\t\t\tlet files = input.get(0).files;\n\n\t\t\t\t/* Save them to this */\n\t\t\t\tfor(let file of files)\n\t\t\t\t\tthis.files.push({ file: file, input: input, inputName: input.attr(\"name\") });\n\n\t\t\t} else this.files.push(input.get(0));\n\n\t\t};\n\n\t\t/**\n\t\t * Sends ajax files\n\t\t * @param {bool} parallel If try files would be send in parallel\n\t\t * @returns {*}\n\t\t */\n\t\tthis.send = function(parallel) {\n\n\t\t\t/* Clear */\n\t\t\tthis.files = [];\n\n\t\t\t/* Get files list */\n\t\t\tthis.inputs.each((_, input) => { this.saveFiles($(input)); });\n\n\t\t\t/* If no files */\n\t\t\tif(!this.files.length)\n\t\t\t\treturn false;\n\n\t\t\t/* Create supported handler */\n\t\t\tlet handler;\n\t\t\tif(supported.XHRUpload)\n\t\t\t\thandler = new ajaxFilesXHR(this);\n\t\t\telse\n\t\t\t\thandler = new ajaxFilesIFrame(this);\n\n\t\t\t/* Send files */\n\t\t\tif(parallel)\n\t\t\t\tthis.sendParallel(handler);\n\t\t\telse\n\t\t\t\tthis.sendConsequentially(handler);\n\n\t\t\t/* return send handler */\n\t\t\treturn handler;\n\n\t\t};\n\n\t\t/**\n\t\t * Sends files consequentially\n\t\t * @param handler\n\t\t */\n\t\tthis.sendConsequentially = function(handler) {\n\n\t\t\t/* First id */\n\t\t\tlet id = 0;\n\n\t\t\t/* Set sending next after this one */\n\t\t\tthis.callbacks.on(\"always\", () => {\n\t\t\t\tid++;\n\t\t\t\tif(this.files[id])\n\t\t\t\t\thandler.send(this.files[id]);\n\t\t\t});\n\n\t\t\t/* Send first */\n\t\t\thandler.send(self.files[id]);\n\n\t\t};\n\n\t\t/**\n\t\t * Sends files parallel\n\t\t * @param handler\n\t\t */\n\t\tthis.sendParallel = function(handler) {\n\n\t\t\t/* Send files through them */\n\t\t\tfor(let file of this.files)\n\t\t\t\thandler.send(file);\n\n\t\t};\n\n\t\t/* Self return */\n\t\treturn this;\n\n\t};\n\n\t/**\n\t * Performs default file send\n\t * @param {string} url\n\t * @param element\n\t * @param data\n\t */\n\tAjaxFiles.defaultSend = function(url, element, data) {\n\n\t\t// Get input\n\t\tlet input = element.is(\"input[type=file]\") ? element : element.closest(\"label, .label\").find(\"input[type=file]\"),\n\t\t\texceptions = sky.service(\"exceptions\"),\n\t\t\ttemplates = sky.service(\"templates\"),\n\t\t\tnotifications = sky.service(\"notifications\"),\n\t\t\twindows = sky.service.windows(\"windows\");\n\n\t\t// Check\n\t\tif(!input.length)\n\t\t\tthrow new exceptions.system.Error(\"No proper input provided for file send\");\n\n\t\t// Init\n\t\tlet filesAjax = AjaxFiles(input, url, data),\n\t\t\tmodal = windows.getLast(),\n\t\t\tcurrentFile;\n\n\t\t/*  Bind events */\n\t\tfilesAjax.callbacks\n\t\t\t.on(\"begin\", function (file) {\n\t\t\t\tif(modal) {\n\t\t\t\t\tmodal.holder.find(\".preview\").remove();\n\t\t\t\t\tmodal.lock();\n\t\t\t\t}\n\t\t\t\tcurrentFile = templates.render(\"files-single-upload\", file).insertAfter(element.parent());\n\t\t\t})\n\t\t\t.on(\"always\", function () {\n\t\t\t\tcurrentFile.remove();\n\t\t\t\tif(modal)\n\t\t\t\t\tmodal.unlock();\n\t\t\t})\n\t\t\t.on(\"notSuccess\", function (error) {\n\t\t\t\tmodal.clearExceptTemplate();\n\t\t\t\tnotifications.message({text: error}).appendToModal(modal);\n\t\t\t})\n\t\t\t.on(\"progress\", function (totalPercent, percent) {\n\t\t\t\tcurrentFile.find(\".total\").html(percent + \"%\");\n\t\t\t\tcurrentFile.find(\".progressBar div\").css(\"width\", percent + \"%\");\n\n\t\t\t\t// If loaded\n\t\t\t\tif (percent === 100)\n\t\t\t\t\tcurrentFile.find(\".total\").html(\"100%, обработка\");\n\n\n\t\t\t})\n\t\t\t.on(\"start\", function () {\n\n\t\t\t});\n\n\t\t/* Send */\n\t\tfilesAjax.send();\n\t\treturn filesAjax;\n\n\t};\n\n});","/** Sends file data via HttpRequest */\nsky.service(\"ajaxFilesXHR\", [\"supported\", \"ajax\", \"stackList\"], function({supported, ajax, stackList}) {\n\tthis.service = class {\n\t\tconstructor(options) {\n\n\t\t\t/* Save options */\n\t\t\tthis.options \t\t= options;\n\t\t\tthis.files \t\t\t= options.files;\n\t\t\tthis.input \t\t\t= options.input;\n\t\t\tthis.url \t\t\t= options.url;\n\t\t\tthis.data \t\t\t= options.data;\n\t\t\tthis.callbacks \t\t= options.callbacks;\n\t\t\tthis.toProceed \t\t= options.files.length;\n\t\t\tthis.inProgress \t= 0;\n\t\t\tthis.total \t\t\t= options.files.length;\n\t\t\tthis.totalLoaded \t= 0;\n\t\t\tthis.totalSize \t\t= 0;\n\t\t\tthis.totalPercent \t= 0;\n\t\t\tthis.current \t\t= 0;\n\t\t\tthis.fileRequests \t= stackList();\n\n\t\t\t/* Go through */\n\t\t\tfor(file of options.files)\n\t\t\t\tthis.totalSize += file.size;\n\n\t\t}\n\n\t\t/**\n\t\t * Get file name\n\t\t * @param {*} file File\n\t\t * @returns {string}\n\t\t */\n\t\tstatic getName(file) {\n\t\t\treturn file.name.replace(/.*(\\/|\\\\)/, \"\");\n\t\t}\n\n\t\t/**\n\t\t * Uploads file\n\t\t * @param {*} file File name in files stack\n\t\t */\n\t\tsend(file) {\n\n\t\t\t/* This obj will store data associated with XHR */\n\t\t\t$.extend(file, {\n\t\t\t\tid     : Math.random(),\n\t\t\t\tname   : this.getName(file.file),\n\t\t\t\tsize   : file.file.size,\n\t\t\t\tajax   : false,\n\t\t\t\tpercent: false,\n\t\t\t\tloaded : 0\n\t\t\t});\n\n\t\t\t/* Prepare params */\n\t\t\tlet self        = this,\n\t\t\t\tparams      = this.data || {},\n\t\t\t\tqueryString = this.url + \"?ajaxFile=\" + file.name + \"&\" + jQuery.param(params);\n\n\t\t\t/**\n\t\t\t * Params extend\n\t\t\t * @param {object} args Object to be extended\n\t\t\t * @returns {*}\n\t\t\t */\n\t\t\tthis.extend = function(args) {\n\t\t\t\treturn jQuery.extend(args, {\n\t\t\t\t\ttotalLoaded : self.totalLoaded,\n\t\t\t\t\ttotalSize   : self.totalSize,\n\t\t\t\t\ttotalPercent: self.totalPercent,\n\t\t\t\t\tfile        : file,\n\t\t\t\t\tloaded      : file.loaded,\n\t\t\t\t\tsize        : file.size,\n\t\t\t\t\tpercent     : file.percent,\n\t\t\t\t\ttoProceed   : self.toProceed,\n\t\t\t\t\tcurrent     : self.current,\n\t\t\t\t\ttotal       : self.total\n\t\t\t\t});\n\t\t\t};\n\n\t\t\t/* Send */\n\t\t\tif(supported.formData) {\n\n\t\t\t\t/* Create form data sender */\n\t\t\t\tlet form = new FormData();\n\t\t\t\tform.append(file.inputName, file.file);\n\n\t\t\t\t/* Send start */\n\t\t\t\tfile.ajax = ajax(queryString, form, { ajaxExtend: {\n\t\t\t\t\t\tprocessData: false,\n\t\t\t\t\t\tcontentType: false,\n\t\t\t\t\t\ttype       : \"POST\",\n\t\t\t\t\t\txhr        : (() => {\n\t\t\t\t\t\t\ttry {\n\n\t\t\t\t\t\t\t\t/* Create XHR */\n\t\t\t\t\t\t\t\tlet xhr = new XMLHttpRequest();\n\n\t\t\t\t\t\t\t\t/* Set special upload api handlers */\n\t\t\t\t\t\t\t\txhr.upload[\"onloadstart\"] = function() {\n\t\t\t\t\t\t\t\t\tthis.inProgress++;\n\t\t\t\t\t\t\t\t\tthis.callbacks.fire(\"begin\", this.extend({}));\n\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t\txhr.upload[\"onprogress\"] = function(event) {\n\t\t\t\t\t\t\t\t\tthis.totalLoaded += event.loaded - file.loaded;\n\t\t\t\t\t\t\t\t\tthis.totalPercent = (this.totalLoaded / this.totalSize * 100).toFixed(0);\n\t\t\t\t\t\t\t\t\tthis.onProgress(event, file);\n\t\t\t\t\t\t\t\t};\n\n\t\t\t\t\t\t\t\t/* Return create XHR */\n\t\t\t\t\t\t\t\treturn xhr;\n\n\t\t\t\t\t\t\t} catch(e) {\n\t\t\t\t\t\t\t\treturn undefined;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}).safe()\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t} else {\n\n\t\t\t\t/* Send start */\n\t\t\t\tfile.ajax = ajax(queryString, file.file, {\n\t\t\t\t\tprocessData: false,\n\t\t\t\t\tcontentType: false,\n\t\t\t\t\ttype       : \"POST\",\n\t\t\t\t\tbeforeSend : sky.func(function(jqXHR) {\n\t\t\t\t\t\tjqXHR.setRequestHeader(\"X-Requested-With\", \"XMLHttpRequest\");\n\t\t\t\t\t\tjqXHR.setRequestHeader(\"X-File-Name\", encodeURI(file.name));\n\t\t\t\t\t\tjqXHR.setRequestHeader(\"Content-Type\", \"multipart/form-data\");\n\t\t\t\t\t\tjqXHR.setRequestHeader(\"Content-Disposition\", 'attachment; filename=\"' + encodeURI(file.name) + '\"');\n\t\t\t\t\t\tjqXHR.setRequestHeader(\"Accept\", \"text/html,application/xhtml+xml,application/xml;q=0.9\");\n\t\t\t\t\t})\n\t\t\t\t});\n\n\t\t\t}\n\n\t\t\t/* Set ajax callbacks */\n\t\t\tfile.ajax.on({\n\t\t\t\tsuccess:\t(all) => { this.callbacks.fire(\"success\", this.extend(all)); },\n\t\t\t\terror: \t\t(all) => { this.callbacks.fire(\"error\", this.extend(all)); },\n\t\t\t\tnotSuccess: (all) => { this.callbacks.fire(\"notSuccess\", this.extend(all)); },\n\t\t\t\talways: \t(all) => {\n\n\t\t\t\t\t/* Counters */\n\t\t\t\t\tthis.inProgress--;\n\t\t\t\t\tthis.toProceed--;\n\n\t\t\t\t\t/* Call always method */\n\t\t\t\t\tthis.callbacks.fire(\"always\", this.extend(all));\n\n\t\t\t\t\t/* Delete connection */\n\t\t\t\t\tthis.fileRequests.delete(file);\n\n\t\t\t\t}\n\t\t\t});\n\n\t\t\t/* Save */\n\t\t\tthis.fileRequests.add(file);\n\n\t\t}\n\n\t\t/**\n\t\t * Fores on progress change\n\t\t * @param event\n\t\t * @param fileRequestData\n\t\t */\n\t\tonProgress(event, fileRequestData) {\n\n\t\t\t/* Count percentage */\n\t\t\tlet percent = (event.loaded / event[\"total\"] * 100).toFixed(0);\n\t\t\tfileRequestData.loaded = event.loaded;\n\n\t\t\t/* If percent changed */\n\t\t\tif(percent !== fileRequestData.percent && event[\"lengthComputable\"]) {\n\t\t\t\tfileRequestData.percent = percent;\n\t\t\t\tthis.callbacks.fire(\"progress\", this.extend({}));\n\t\t\t}\n\n\t\t}\n\n\t\t/**\n\t\t * Aborts current download\n\t\t */\n\t\tabort() {\n\n\t\t\t/* Stop each request */\n\t\t\tthis.fileRequests.each(request => { request.ajax.stop() });\n\n\t\t\t/* Call always method */\n\t\t\tthis.callbacks.fire(\"abort\", this.extend({}));\n\n\t\t}\n\n\t};\n\n});","/**\n * For work with different type of notifications\n */\nsky.service(\"notifications\", [\"templates\", \"windows\", \"tips\"], function({templates, windows, tips}) {\n\n\tclass Message {\n\t\tconstructor({text, type = \"error\"}) {\n\t\t\tthis.render = templates.render(\"forms-message\", {type, text});\n\t\t}\n\n\t\t/**\n\t\t * Creates new modal window and appends message to it\n\t\t * @returns {*}\n\t\t */\n\t\tmodal() {\n\t\t\treturn windows.modal(this.render);\n\t\t}\n\n\t\t/**\n\t\t * Append to holder of modal window\n\t\t * @param {object} modal\n\t\t */\n\t\tappendToModal(modal) {\n\t\t\tmodal.holder.append(this.render);\n\t\t}\n\n\t\t/**\n\t\t * Shows notification in tip\n\t\t * @param object\n\t\t * @param align\n\t\t */\n\t\ttip(object, align) {\n\t\t\ttips.Tip(object, {create: this.render, close: 5}).show(align || \"top\");\n\t\t}\n\t}\n\n\treturn {\n\t\tmessage      : ({text, type = \"error\"}) => new Message({text, type}),\n\t\tfindInElement: element => element.find(\".notificationMessage\")\n\t}\n\n});","sky.service(\"model\", [ \"modelsStorage\", \"callbacks\" ], function({ modelsStorage, callbacks }) {\n\n\t/**\n\t * List of model definitions\n\t */\n\tlet modelsDefinition = {};\n\n\tclass Model {\n\t\tconstructor(type, data) {\n\n\t\t\t/* Init as base */\n\t\t\tthis.definition = BaseDefinition;\n\n\t\t\t/* Get special if defined */\n\t\t\tif(modelsDefinition[type])\n\t\t\t\tthis.definition = modelsDefinition[type];\n\n\t\t\t/* Save id */\n\t\t\tthis.id = data[this.definition.id] || null;\n\t\t\tthis.type = type;\n\t\t\tthis.data = {};\n\t\t\tthis.events = callbacks();\n\t\t\tthis.definition.creation.bind(this)($.extend({}, data, true));\n\n\t\t}\n\t\textend(data) {\n\t\t\tthis.definition.extension.bind(this)($.extend({}, data, true));\n\t\t\treturn this.changed();\n\t\t}\n\t\tchanged() {\n\t\t\tthis.events.fire(\"change\", {model: this});\n\t\t\treturn this;\n\t\t}\n\t\tremoveFromStorage() {\n\t\t\tmodelsStorage.remove(this);\n\t\t}\n\t}\n\n\t/**\n\t * Base model definition witch would be parented\n\t */\n\tlet BaseDefinition = {\n\t\tid       : function() {\n\t\t\treturn this.data[\"id\"]\n\t\t},\n\t\tcreation : function(data) {\n\t\t\tthis.data = data;\n\t\t},\n\t\textension: function(data) {\n\t\t\t$.extend(true, this.data, data);\n\t\t}\n\t};\n\n\tthis.service = {\n\t\t/**\n\t\t * Adds new models definition\n\t\t * @param name\n\t\t * @param definition\n\t\t */\n\t\taddDefinition: function(name, definition) {\n\t\t\tmodelsDefinition[name] = $.extend({}, BaseDefinition, definition);\n\t\t},\n\n\t\tfromData: function(type, data) {\n\n\t\t\tlet model = new this.Model(type, data);\n\t\t\tlet cached = modelsStorage.add(model);\n\n\t\t\tif(cached)\n\t\t\t\treturn cached.extend(data);\n\n\t\t\treturn model;\n\n\t\t}\n\t};\n\n});","sky.service(\"modelsManager\", [\"callbacks\", \"model\"], function({callbacks, model}) {\n\tclass Manager {\n\t\tconstructor(type, arr) {\n\n\t\t\tthis.items = [];\n\t\t\tthis.type = type;\n\t\t\tthis.events = callbacks();\n\n\t\t\t$.each(arr, (_, model) => {\n\t\t\t\tthis.items.push(model)\n\t\t\t});\n\t\t}\n\t\treloadFromArray(arr) {\n\t\t\tthis.items = [];\n\t\t\t$.each(arr, (_, data) => {\n\t\t\t\tthis.items.push(model.fromData(this.type, data))\n\t\t\t});\n\t\t}\n\t\tcount() {\n\t\t\treturn this.items.length;\n\t\t}\n\t\taddListener(func) {\n\t\t\tthis.events.on(\"change\", func);\n\t\t}\n\t\tremoveListener(func) {\n\t\t\tthis.events.off(\"change\", func);\n\t\t}\n\t}\n\n\tthis.service = {\n\t\tfromArray: function(type, arr) {\n\t\t\tlet items = [];\n\t\t\t$.each(arr, (_, data) => {\n\t\t\t\titems.push(sky.model.fromData(type, data));\n\t\t\t});\n\t\t\treturn new Manager(type, items);\n\t\t}\n\t};\n\n});","sky.service(\"modelsStorage\", function() {\n\n    let cache = {};\n\n    this.service = {\n\t\tadd: function(model) {\n\n\t\t\t// Search in cache\n\t\t\tlet cached = this.search(model.type, model.id());\n\n\t\t\t// If found extend\n\t\t\tif(cached)\n\t\t\t\treturn cached;\n\n            // Create type storage if none\n            if(!this.cache[model.type])\n                this.cache[model.type] = {};\n\n            // Save model\n            this.cache[model.type][model.id()] = model;\n\n\t\t},\n\n\t\tsearch: function(type, id) {\n\n\t\t\t// Cache search\n\t\t\tif(cache[type] && cache[type][id])\n\t\t\t\treturn cache[type][id];\n\n\t\t\t// On miss\n\t\t\treturn false;\n\t\t},\n\n\t\tremove: function(model) {\n\t\t\tdelete cache[model.type][model.id()];\n\t\t}\n\t}\n});","sky.service(\"pagination\", [\"templates\", \"stackList\"], function({ templates, stackList }) {\n\n\tlet list = stackList();\n\n\tclass Pagination {\n\t\tconstructor({ pages, holder, current = 1, }) {\n\n\t\t\t/* Self creation */\n\t\t\tif(!(this instanceof Pagination))\n\t\t\t\treturn new Pagination({ pages, holder, current });\n\n\t\t\t/* Save */\n\t\t\tlist.add(this);\n\n\t\t\t/* Set total pages */\n\t\t\tthis.pages \t\t= pages;\n\t\t\tthis.current \t= current;\n\t\t\tthis.pageWidth\t= 50;\n\t\t\tthis.id \t\t= last;\n\n\t\t\t/* No pages needed */\n\t\t\tif(this.pages < 2)\n\t\t\t\treturn this;\n\n\t\t\t/* Counted params */\n\t\t\tthis.dimensions = {\n\t\t\t\tstartPage      : 1,\n\t\t\t\tlastStartPage  : 0,\n\t\t\t\tpagesVisible   : 0,\n\t\t\t\tpagesInvisible : 0,\n\t\t\t\tscrollAvailable: 0,\n\t\t\t\tscrollStart\t   : 0,\n\t\t\t\ttumbler\t\t   : 10\n\t\t\t};\n\n\t\t\t/* Render */\n\t\t\tthis.dom = {};\n\t\t\tthis.dom.holder  = templates.render(\"pagination\", {}).data(\"pagination\", this);\n\t\t\tthis.dom.slider  = this.dom.holder.find(\".pages\");\n\t\t\tthis.dom.pages   = this.dom.slider.children();\n\t\t\tthis.dom.back \t = this.dom.holder.children(\".left\");\n\t\t\tthis.dom.forward = this.dom.holder.children(\".right\");\n\n\t\t\t/* Insert */\n\t\t\tif(holder)\n\t\t\t\tthis.dom.holder.appendTo(holder);\n\n\t\t\t/* If bigger than 10000 */\n\t\t\tif(this.pages > 9999) {\n\t\t\t\tthis.dom.slider.addClass(\"tenthousand\");\n\t\t\t\tthis.pageWidth = 80;\n\t\t\t}\n\t\t\t/* If bigger than 1000 */\n\t\t\telse if(this.pages > 999) {\n\t\t\t\tthis.dom.slider.addClass(\"thousand\");\n\t\t\t\tthis.pageWidth = 70;\n\t\t\t}\n\t\t\t/* If bigger 100 */\n\t\t\telse if(this.pages > 99 ) {\n\t\t\t\tthis.dom.slider.addClass(\"hundred\");\n\t\t\t\tthis.pageWidth = 60;\n\t\t\t}\n\n\t\t\t/* Make all */\n\t\t\tthis.redraw();\n\n\t\t\t/* Mark page */\n\t\t\tthis.goToPage(this.current);\n\n\t\t\t/* Self return */\n\t\t\treturn this;\n\n\t\t}\n\n\t\t/** */\n\t\tonPageChange(newPage) {}\n\n\t\t/** Removes navigator */\n\t\tremove() {\n\t\t\tthis.dom.holder.remove();\n\t\t\tlist.remove(this);\n\t\t}\n\n\t\t/**\n\t\t * Redraws pagination\n\t\t */\n\t\tredraw() {\n\n            /* No action on invisible */\n            if(!this.dom.holder.is(\":visible\"))\n                return;\n\n\t\t\t/* Reset width */\n\t\t\tthis.dom.slider.css(\"width\", \"auto\");\n\n\t\t\t/* Count visible sizes */\n\t\t\tthis.dimensions.pagesVisible = Math.floor((this.dom.holder.innerWidth() - 100) / this.pageWidth);\n\n\t\t\t/* Count invisible */\n\t\t\tthis.dimensions.pagesInvisible = (this.pages - this.dimensions.pagesVisible) > 0 ? this.pages - this.dimensions.pagesVisible : 0;\n\n\t\t\t/* Count last start */\n\t\t\tthis.dimensions.lastStartPage = this.dimensions.pagesInvisible + 1;\n\n\t\t\t/* Get max pages */\n\t\t\tlet toShow = this.dimensions.pagesVisible > this.pages ? this.pages : this.dimensions.pagesVisible;\n\n\t\t\t/* Crop */\n\t\t\tthis.dom.slider.css(\"width\", toShow * this.pageWidth);\n\n\t\t\t/* Redraw pages */\n\t\t\tthis.drawPages(this.dimensions.startPage);\n\n\t\t\t/* Try to create scroll */\n\t\t\tthis.createScroll();\n\n\t\t\t/* Set scroll position */\n\t\t\tif(this.dom.scrollLine)\n\t\t\t\tthis.dom.runner.css(\"left\", this.calculate().scroll);\n\n\t\t}\n\n\t\t/**\n\t\t * Create scroll line if needed\n\t\t */\n\t\tcreateScroll() {\n\n\t\t\t/* If no scroll needed */\n\t\t\tif(this.pages <= this.dimensions.pagesVisible) {\n\t\t\t\tif(this.dom.scrollLine) {\n\t\t\t\t\tthis.dom.scrollLine.remove();\n\t\t\t\t\tthis.dom.scrollLine = false;\n\t\t\t\t}\n\t\t\t\treturn;\n\t\t\t} else if(!this.dom.scrollLine) {\n\n\t\t\t\t/* Create scroll */\n\t\t\t\tthis.dom.scrollLine = templates.render(\"pagination-scroll\", {}).appendTo(this.dom.slider);\n\t\t\t\tthis.dom.runner = this.dom.scrollLine.children();\n\t\t\t}\n\n\t\t\t/* Count left */\n\t\t\tthis.dimensions.scrollStart = this.dom.scrollLine.position().left + 2;\n\n\t\t\t/* Count scroll line width */\n\t\t\tthis.dimensions.scrollAvailable = this.dom.scrollLine.outerWidth() - this.dom.scrollLine.children().outerWidth() - 4;\n\t\t\n\t\t}\n\n\t\t/**\n\t\t * Calculates related coordinates between scroll and move part\n\t\t */\n\t\tcalculate(position) {\n\n\t\t\t/* Get position */\n\t\t\tif(position === undefined)\n\t\t\t\tposition = this.dom.runner.offset().left  - this.dimensions.scrollStart;\n\n\t\t\t/* Remove start */\n\t\t\tposition = position - this.dimensions.scrollStart;\n\n\t\t\t/* Correct */\n\t\t\tposition = position > 0 ? position : 0;\n\n\t\t\t/* Count pages */\n\t\t\treturn {\n\t\t\t\tpages : Math.floor(this.dimensions.pagesInvisible * (position / this.dimensions.scrollAvailable)) + 1,\n\t\t\t\tscroll: Math.floor(this.dimensions.scrollAvailable * (this.dimensions.startPage - 1)/ this.dimensions.pagesInvisible + this.dimensions.scrollStart)\n\t\t\t}\n\n\t\t}\n\n\t\t/**\n\t\t * Draws pages according to start\n\t\t * @param {int} start Page to start from\n\t\t */\n\t\tdrawPages(start) {\n\n\t\t\t/* Remove old pages */\n\t\t\tthis.dom.pages.html(\"\");\n\n\t\t\t/* Correct */\n\t\t\tif(start > this.dimensions.pagesInvisible)\n\t\t\t\tstart = this.dimensions.pagesInvisible + 1;\n\n\t\t\t/* Correct */\n\t\t\tif(start < 1)\n\t\t\t\tstart = 1;\n\n\t\t\t/* Start position */\n\t\t\tlet i = start;\n\n\t\t\t/* Draw pages */\n\t\t\twhile(i <= this.pages && i < start + this.dimensions.pagesVisible) {\n\t\t\t\ttemplates.render(\"pagination-page\", { page: i, current: this.current }).appendTo(this.dom.pages);\n\t\t\t\ti++;\n\t\t\t}\n\n\t\t\t/* Reset start page */\n\t\t\tthis.dimensions.startPage = start;\n\n\n\t\t}\n\n\t\t/**\n\t\t * Sets page as active\n\t\t * @param {int} page Page number\n\t\t * @returns {Pagination}\n\t\t */\n\t\tgoToPage(page) {\n\n\t\t\t/* If no pages */\n\t\t\tif(this.pages < 2)\n\t\t\t\treturn this;\n\n\t\t\t/* Parse */\n\t\t\tpage = parseInt(page);\n\n\t\t\t/* Correct */\n\t\t\tif(page < 1)\n\t\t\t\tpage = 1;\n\t\t\telse if(page > this.pages)\n\t\t\t\tpage = this.pages;\n\n\t\t\t/* Checks if page is visible */\n\t\t\tlet isVisible = this.dimensions.startPage <= page && page < this.dimensions.startPage + this.dimensions.pagesVisible;\n\n\t\t\t/* Redraws if needed */\n\t\t\tif(!isVisible) {\n\t\t\t\tthis.drawPages(page);\n\t\t\t\tif(this.dom.scrollLine)\n\t\t\t\t\tthis.dom.runner.css(\"left\", this.calculate().scroll);\n\t\t\t}\n\n\t\t\t/* Make active */\n\t\t\tthis.dom.pages.children().removeClass(\"active\").filter(\"[page=\" + page +\"]\").addClass(\"active\");\n\n\t\t\t/* Forward buttons disable */\n\t\t\tif(page > 1) this.dom.back.enable();\n\t\t\telse this.dom.back.disable();\n\n\t\t\t/* Backward button disable */\n\t\t\tif(page === this.pages) this.dom.forward.disable();\n\t\t\telse this.dom.forward.enable();\n\n\t\t\t/* Callback */\n\t\t\tif(this.current !== page)\n\t\t\t\tthis.onPageChange(page);\n\n\t\t\t/* Save page state */\n\t\t\tthis.current = page;\n\n\t\t\t/* Self return */\n\t\t\treturn this;\n\n\t\t}\n\n\t\t/** Set scroll */\n\t\tscroll(event) {\n\n\t\t\tlet pos = event.pageX - 10;\n\t\t\tif(this.dimensions.scrollStart > pos)\n\t\t\t\tpos = this.dimensions.scrollStart;\n\t\t\tif(this.dimensions.scrollStart + this.dimensions.scrollAvailable < pos)\n\t\t\t\tpos = this.dimensions.scrollStart + this.dimensions.scrollAvailable;\n\n\t\t\tthis.dom.runner.css({left: pos});\n\t\t\tthis.drawPages(this.calculate(pos).pages);\n\n\t\t}\n\n\t}\n\n\t/* Bind windows events */\n\t$(window).on(\"resize\", function() {\n\t\tlist.each(() => { this.redraw(); });\n\t});\n\n\t/* Return */\n\tthis.service = {\n\t\tadd: function(options) {\n\t\t\treturn new Pagination(options);\n\t\t}\n\t}\n\n});","sky.service(\"stackList\", [\"utils\"], function({ utils }) {\n\tlet List = this.service = function() {\n\n\t\tif(!(this instanceof List))\n\t\t\treturn new List();\n\n\t\tlet elements = {};\n\t\tlet lastId = 0;\n\t\tlet total = 0;\n\n\t\tthis.last = function() {\n\n\t\t\t/* Holder */\n\t\t\tlet last = undefined;\n\n\t\t\t/* Apply for windows */\n\t\t\tthis.each(element => { last = element });\n\n\t\t\t/* Return */\n\t\t\treturn last;\n\n\t\t};\n\n\t\tthis.add = function(element, id = false) {\n\t\t\tlastId++;\n\t\t\ttotal++;\n\t\t\telements[id || lastId] = element;\n\t\t};\n\n\t\tthis.remove = function(element) {\n\t\t\t/* Apply for windows */\n\t\t\tfor(let index in elements)\n\t\t\t\tif(elements.hasOwnProperty(index) && elements[index] === element) {\n\t\t\t\t\tdelete elements[index];\n\t\t\t\t\ttotal--;\n\t\t\t\t}\n\t\t};\n\n\t\tthis.total = function() {\n\t\t\treturn total;\n\t\t};\n\n\t\tthis.getById = function(id) {\n\t\t\treturn elements[id];\n\t\t};\n\n\t\tthis.elements = function() {\n\t\t\treturn elements;\n\t\t};\n\n\t\tthis.each = function(callback) {\n\t\t\tutils.each(elements, (id, single) => {\n\t\t\t\tcallback.apply(single, [single, id]);\n\t\t\t});\n\n\t\t};\n\n\t}\n});","sky.onReady(({suggester}) => {\n\t$(document).on(\"click\", function(event) {\n\n\t\t/* Get element */\n\t\tlet element = $(event.target || event.srcElement);\n\n\t\t/* If click in replace we should not hide it */\n\t\tif(element.is(\"[type=submit]\") || element.closest(\".suggester\").length || element.data(\"suggester\"))\n\t\t\treturn;\n\n\t\t/* Hide all */\n\t\tsuggester.hide();\n\n\t});\n});\n\nsky.service(\"suggester\", [\"templates\"], function({templates}) {\n\n\tlet render,\n\t\tobject,\n\t\tlastList,\n\t\tsuggester = this.service = {\n\t\t\thide: function() {\n\n\t\t\t\tif(render) {\n\t\t\t\t\trender.remove();\n\t\t\t\t\trender = false;\n\t\t\t\t}\n\t\t\t\tif(object) {\n\t\t\t\t\tobject.removeData(\"suggester\");\n\t\t\t\t\tobject = false;\n\t\t\t\t}\n\t\t\t\t$(document).off(\"keyup.suggester, keydown.suggester\");\n\t\t\t},\n\t\t\tshow: function(input, list) {\n\n\t\t\t\t/* Hide previous */\n\t\t\t\tsuggester.hide();\n\n\t\t\t\t/* Save */\n\t\t\t\tlastList = list;\n\t\t\t\trender = templates.render(\"suggester\", {items: list}).insertAfter(input.closest(\"label, .label\"));\n\t\t\t\tobject = input.data(\"suggester\", render);\n\n\t\t\t\t/* Get positions */\n\t\t\t\tlet elementPosition = input.offset(),\n\t\t\t\t\trenderPosition = render.offset();\n\n\t\t\t\t/* Show */\n\t\t\t\trender.css({\n\t\t\t\t\t\"margin-left\": elementPosition.left - renderPosition.left,\n\t\t\t\t\t\"margin-top\": elementPosition.top - renderPosition.top + input.outerHeight()\n\t\t\t\t});\n\n\t\t\t\t/* Add handlers */\n\t\t\t\tlet children = render.children().on(\"click\", function() {\n\t\t\t\t\tinput.val($(this).html());\n\t\t\t\t\tsuggester.hide();\n\t\t\t\t\tif(lastList[$(this).attr(\"data-index\")].callback)\n\t\t\t\t\t\tlastList[$(this).attr(\"data-index\")].callback();\n\t\t\t\t});\n\n\t\t\t\t$(document).on(\"keyup.suggester\", function(event) {\n\n\t\t\t\t\tif(event.keyCode === 38 || event.keyCode === 40) {\n\n\t\t\t\t\t\tlet selected = children.filter(\".selected\");\n\t\t\t\t\t\tchildren.removeClass(\"selected\");\n\n\t\t\t\t\t\t// Up\n\t\t\t\t\t\tif(event.keyCode === 38) {\n\t\t\t\t\t\t\tif(!selected.length || !selected.prev().length)\n\t\t\t\t\t\t\t\tchildren.last().addClass(\"selected\");\n\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t\tselected.prev().addClass(\"selected\");\n\t\t\t\t\t\t}\n\t\t\t\t\t\t// Down\n\t\t\t\t\t\tif(event.keyCode === 40) {\n\t\t\t\t\t\t\tchildren.removeClass(\"selected\");\n\t\t\t\t\t\t\tif(!selected.length || !selected.next().length) {\n\t\t\t\t\t\t\t\tchildren.first().addClass(\"selected\")\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tselected.next().addClass(\"selected\");\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\t// Esc\n\t\t\t\t\tif(event.keyCode === 27) suggester.hide();\n\n\n\t\t\t\t}).on(\"keydown.suggester\", function(event) {\n\n\t\t\t\t\t// Enter\n\t\t\t\t\tif(event.keyCode !== 13) return;\n\n\t\t\t\t\tlet selected = children.filter(\".selected\");\n\t\t\t\t\tif(selected.length) {\n\t\t\t\t\t\tselected.trigger(\"click\");\n\t\t\t\t\t\tevent.preventDefault();\n\t\t\t\t\t} else {\n\t\t\t\t\t\tsuggester.hide();\n\t\t\t\t\t}\n\n\t\t\t\t});\n\t\t\t}\n\t\t};\n});","/**\n * Module to work with user services\n */\nsky.service(\"supported\", function () {\n\ttry {\n\t\tthis.service.fullScreen = typeof document[\"webkitIsFullScreen\"] !== \"undefined\";\n\t\tthis.service.formData = window.FormData && true;\n\t\t// this.service.XHRIsSupported = XHRIsSupported;\n\t\tthis.service.XHRUpload = (typeof new XMLHttpRequest().upload !== \"undefined\");\n\t\tthis.service.localStorage = !!window.localStorage;\n\t} catch (e) {}\n});","sky.service(\"templates\", [\"localStorage\", \"supported\", \"directives\", \"exceptions\", \"utils\"], function({localStorage, supported, directives, exceptions, utils}) {\n\n\n\tlet templatesList     = {},\n\t\ttemplatesCompiled = {},\n\t\tTemplates         = this.service = {\n\n\t\t\t/** Globals list */\n\t\t\tglobals: {},\n\n\t\t\t/** Local storage support */\n\t\t\tstorage: supported.localStorage ? new localStorage({name: \"jsTemplates\"}) : false,\n\n\t\t\t/**\n\t\t\t * Adds new template to list\n\t\t\t * @param options\n\t\t\t */\n\t\t\tadd: function(options) {\n\t\t\t\ttemplatesList[options.name] = options.template;\n\t\t\t\tif(this.storage) {\n\t\t\t\t\tthis.storage.save(options.name, options.template);\n\t\t\t\t\t$.cookie(\"storedTemplates-\" + options.name, options.date);\n\t\t\t\t}\n\t\t\t},\n\n\t\t\trenderByNameWithHolder: function(name, data, noDirectives) {\n\n\t\t\t\t/* Compile template */\n\t\t\t\tlet template = this.compile(name);\n\n\t\t\t\t/* Add globals */\n\t\t\t\tdata = utils.extend(true, {}, data, {globals: this.globals});\n\n\t\t\t\t/* return */\n\t\t\t\treturn this.coverWithHolder(template.render(data), noDirectives);\n\n\t\t\t},\n\n\t\t\trenderByTextWithHolder: function(name, data, noDirectives) {\n\n\n\t\t\t\t/* Add globals */\n\t\t\t\tdata = utils.extend(true, {}, data, {globals: this.globals});\n\n\t\t\t\t/* return */\n\t\t\t\treturn this.coverWithHolder(Twig.twig({data: text}).render(data), noDirectives);\n\n\t\t\t},\n\n\t\t\tcoverWithHolder: function(text, noDirectives) {\n\n\t\t\t\t/* Render */\n\t\t\t\tlet temp = document.createElement('div');\n\t\t\t\ttemp.innerHTML = text.trim();\n\n\t\t\t\t/* Parse directives */\n\t\t\t\tif(!noDirectives)\n\t\t\t\t\tdirectives.parse(temp);\n\n\t\t\t\t/* Return */\n\t\t\t\treturn temp;\n\n\t\t\t},\n\n\t\t\t/**\n\t\t\t * Renders specified template\n\t\t\t * @param {String} name Template name\n\t\t\t * @param {Object} data Inner data\n\t\t\t * @param {bool} [noDirectives]\n\t\t\t * @returns {*}\n\t\t\t */\n\t\t\trender: function(name, data, noDirectives) {\n\n\t\t\t\t/* Compile template */\n\t\t\t\treturn $(this.renderByNameWithHolder(name, data, noDirectives).childNodes);\n\n\t\t\t},\n\n\t\t\t/**\n\t\t\t * Renders specified template and returns text\n\t\t\t * @param {String} name Template name\n\t\t\t * @param {Object} data Inner data\n\t\t\t * @param {bool} [noDirectives]\n\t\t\t * @returns {*}\n\t\t\t */\n\t\t\trenderToText: function(name, data, noDirectives) {\n\n\t\t\t\t/* Compile template */\n\t\t\t\treturn this.renderByNameWithHolder(name, data, noDirectives).innerHTML;\n\n\t\t\t},\n\n\t\t\t/**\n\t\t\t * Renders template by its text as parameter\n\t\t\t * @param {string} text Template text\n\t\t\t * @param {Object} data Inner data\n\t\t\t * @param {bool} [noDirectives]\n\t\t\t * @returns {XMLList|*}\n\t\t\t */\n\t\t\trenderByText: function(text, data, noDirectives) {\n\t\t\t\treturn $(this.renderByTextWithHolder(name, data, noDirectives).childNodes);\n\t\t\t},\n\n\t\t\t/**\n\t\t\t * Renders template by its text as parameter\n\t\t\t * @param {string} text Template text\n\t\t\t * @param {Object} data Inner data\n\t\t\t * @param noDirectives\n\t\t\t * @returns {XMLList|*}\n\t\t\t */\n\t\t\trenderByTextToText: function(text, data, noDirectives) {\n\t\t\t\treturn this.renderByTextWithHolder(name, data, noDirectives).innerHTML;\n\t\t\t},\n\n\t\t\t/**\n\t\t\t * Compiles specified template\n\t\t\t * @param {string} name Template name\n\t\t\t */\n\t\t\tcompile: function(name) {\n\n\t\t\t\t/* If already compiled */\n\t\t\t\tif(!templatesCompiled[name]) {\n\n\t\t\t\t\t/* Load */\n\t\t\t\t\tlet template = this.load(name);\n\n\t\t\t\t\t/* Compile */\n\t\t\t\t\tlet compiled = Twig.twig({ id: name, data: template });\n\n\t\t\t\t\t/* Check */\n\t\t\t\t\tif(!compiled)\n\t\t\t\t\t\tthrow new exceptions.system.Error('Error during compiling template \"' + name + '\"');\n\n\t\t\t\t\t/* Save */\n\t\t\t\t\ttemplatesCompiled[name] = compiled;\n\n\t\t\t\t}\n\n\t\t\t\t/* Save */\n\t\t\t\treturn templatesCompiled[name];\n\n\t\t\t},\n\n\t\t\t/**\n\t\t\t * Loads specified template\n\t\t\t * @param {string} name Template name\n\t\t\t */\n\t\t\tload: function(name) {\n\n\t\t\t\t/* Loaded */\n\t\t\t\tlet fromLS;\n\n\t\t\t\t/* Try to load from storage */\n\t\t\t\tif(!templatesList[name] && this.storage && (fromLS = this.storage.load(name)))\n\t\t\t\t\treturn templatesList[name] = fromLS;\n\n\t\t\t\t/* If already compiled */\n\t\t\t\tif(templatesList[name])\n\t\t\t\t\treturn templatesList[name];\n\n\t\t\t\t/* Load template */\n\t\t\t\tif(!(templatesList[name] = $('script[type=\"text/template\"][id=' + name + ']').html()))\n\t\t\t\t\tthrow new exceptions.system.Error(\"Can't find template – \" + name);\n\n\t\t\t\t/* Save to LS */\n\t\t\t\tif(this.storage)\n\t\t\t\t\tthis.storage.save(name, {template: templatesList[name]});\n\n\t\t\t\t/* Return */\n\t\t\t\treturn templatesList[name]\n\n\t\t\t}\n\n\t\t};\n\n\tsky.directive('script[type=\"text/template\"], template', function(template, attrs) {\n\t\tTemplates.add({\n\t\t\tname    : attrs.id,\n\t\t\ttemplate: template.html()\n\t\t});\n\t});\n\n\n\t/* Save templates files data */\n\tsky.onReady(() => {\n\t\tif(window.page.data.templates && supported.localStorage) {\n\t\t\tutils.each(window.page.data.templates, function(_, template) {\n\t\t\t\t$.cookie(\"storedTemplates-\" + template.path, template.date);\n\t\t\t});\n\t\t}\n\t});\n\n});\n","sky.service(\"tips\", [\"stackList\", \"callbacks\"], function({ stackList, callbacks }) {\n\n    /** Class to work with tips */\n    let list = stackList(),\n        tips = this.service = {\n\n\t\t\t/**\n\t\t\t * Hides all visible tips\n\t\t\t * @param withoutAutoHide\n\t\t\t * @param caller\n\t\t\t */\n        hideAll: function(withoutAutoHide, caller) {\n\n            /* Hide all tips */\n            list.each((tip) => {\n                if(withoutAutoHide)\n\t\t\t\t\ttip.hide();\n                else if(tip.autoHide && (!caller || !caller.closest(tip.tip).length && !caller.closest(tip.object).length)) {\n\t\t\t\t\ttip.hide();\n                }\n            });\n\n        },\n\n        /**\n         * Returns last open window if any\n         * @returns {tips.Tip|boolean}\n         */\n        getLast: function() {\n            list.last();\n        },\n\n        /**\n         * Add show/hide functions\n         * @param {string}            selector            Object to bind tips for\n         * @param {string}            align                Align of tip\n         * @param options\n         * @see tips.tip\n         */\n        bind: function(selector, align, options) {\n\n            /* Create binds */\n            $(selector).on({\n                \"mouseenter\": function() {\n                    let tip = $(this).data(\"tip\") || tips.Tip(this, options).show(align);\n                },\n                \"mouseleave\": function() {\n                    let tip = $(this).data(\"tip\");\n                    if(tip) tip.hide(align);\n                }\n            });\n\n        },\n\n        /**\n         * Creates new tip object\n         * @param {object}            object                Object to show tip for\n         * @param autoHide\n         * @param create\n         * @param close\n         * @param ajax\n         * @param highlight\n         * @param className\n         * @constructor\n         */\n        Tip: function(object, { autoHide = true, create = false, close = false, ajax = false, highlight = false, className = false } = {}) {\n\n            /* Auto construct */\n            if(!(this instanceof tips.Tip))\n                return new tips.Tip(object, { autoHide, create, close, ajax, highlight, className });\n\n            /* Old tip exists */\n            if($(object).data(\"tip\"))\n                return $(object).data(\"tip\");\n\n            /* Add to list */\n\t\t\tlist.add(this);\n\n            /* Manual create tip by create function */\n            if(typeof create === \"function\") {\n\n                /* Create tip */\n                this.tip = create(object);\n\n                /* If no tip */\n                if(!this.tip) return this;\n\n            }\n\n            /* Object set */\n            this.object = $(object).data(\"tip\", this);\n\n            /* Save callbacks */\n            this.callbacks = callbacks();\n\n            /* Auto hide */\n            this.autoHide = autoHide;\n\n            /* Manual create tip by create function */\n            if(typeof create !== \"function\") {\n\n                /* Create tip */\n                this.tip = $(\"<div/>\").addClass(\"tip\").append('<div class=\"tipContent\"></div>').insertBefore(object);\n\n                /* Title using */\n                if(!create && this.object.attr('title'))\n\t\t\t\t\tcreate = this.object.attr('title');\n                else if(!create)\n\t\t\t\t\tcreate = \"Пожалуйста подождите\";\n\n                this.tip.find(\".tipContent\").append(create);\n\n            }\n\n            if(highlight)\n                this.shadow = $('<div/>').css({ opacity: 0, position:\"absolute\", width: \"100%\", height: \"100%\", left:0 ,top:0, background: \"rgba(0,0,0,0.5)\" }).appendTo(\"body\");\n\n            /* If count down */\n            if(typeof close === \"number\")\n                this.closeTimeout = setTimeout(() => this.hide(), close);\n\n            /* If close button */\n            else if(close)\n                $('<div/>').addClass('close').appendTo(this.tip).on(\"click\", () => this.hide());\n\n            /* If stop possible */\n            if(ajax)  ajax.on(\"always\", () => this.hide());\n\n            /* Add to list */\n            if(className)\n                this.tip.addClass(className);\n\n            /* Add to list */\n            this.tip.css(\"display\", \"none\");\n\n            return this;\n\n        }\n\n    };\n\n    /**\n     * Extends tip\n     */\n    $.extend(tips.Tip.prototype, /** @lends tips.tip */ {\n\n        /**\n         * Shows tip according to type\n         * @param {string} [align] Way it would be shown\n         */\n        show: function(align) {\n\n            /* Back link */\n            let self   = this;\n            let offset = this.tip.css({left: \"\", top: \"\", marginLeft: \"\", marginTop: \"\", display: \"\"}).addClass(align).offset();\n\n            /* Stop animation and shows */\n            this.tip.stop();\n\n            /* Save way to show */\n            if(align) this.align = align;\n\n            /* If shadow */\n            if(this.shadow)\n                this.shadow.stop().show().animate({opacity: 1}, 100);\n\n            /* Different actions according to tip position */\n            switch(this.align) {\n\n                /* If show righter than input */\n                case \"right\":\n                {\n                    this.tip.css({\n                        marginLeft: this.object.offset().left + this.object.outerWidth() - offset.left,\n                        marginTop : this.object.offset().top - offset.top + parseInt((this.object.outerHeight() - this.tip.outerHeight()) / 2),\n                        opacity   : 0\n                    });\n                    this.tip.animate({opacity: 1, marginLeft: \"+=10\"}, 100);\n                    break;\n                }\n                /* If show righter than input */\n                case \"left\":\n                {\n                    this.tip.css({\n                        marginLeft: this.object.offset().left - offset.left - this.tip.outerWidth(),\n                        marginTop : this.object.offset().top - offset.top + parseInt((this.object.outerHeight() - this.tip.outerHeight()) / 2),\n                        opacity   : 0\n                    });\n                    this.tip.animate({opacity: 1, marginLeft: \"-=10\"}, 300);\n                    break;\n                }\n                /* If show topper */\n                case \"top\":\n                {\n\n                    // Count left offset\n                    let left = this.object.offset().left - offset.left;\n\n                    /* Reposition */\n                    if(offset.left + left + this.tip.outerWidth() > $(window).outerWidth())\n                        left = left - this.tip.outerWidth() + this.object.outerWidth();\n\n                    /* Position */\n                    this.tip.css({\n                        marginLeft: left,\n                        marginTop : this.object.offset().top - this.tip.outerHeight() - offset.top,\n                        opacity   : 0\n                    });\n\n                    this.tip.animate({opacity: 1, marginTop: \"-=10\"}, 300);\n                    break;\n                }\n                /* If show topper */\n                case \"bottom\":\n                {\n\n                    let left = this.object.offset().left - offset.left;\n\n                    /* Reposition */\n                    if(offset.left + left + this.tip.outerWidth() > $(window).outerWidth())\n                        left = left - this.tip.outerWidth() + this.object.outerWidth();\n\n                    /* Position */\n                    this.tip.css({\n                        marginLeft: left,\n                        marginTop : this.object.offset().top + this.object.outerHeight() - offset.top,\n                        opacity   : 0\n                    });\n\n                    this.tip.animate({opacity: 1, marginTop: \"+=10\"}, 300);\n                    break;\n                }\n                /* If we replace input with tip */\n                case \"instead\":\n                {\n                    this.tip.css({\n                        width  : this.object.outerWidth(),\n                        height : this.object.outerHeight(),\n                        display: \"none\"\n                    });\n                    this.object.fadeOut(100, function() {\n                        self.tip.fadeIn(100);\n                    }).get(0).blur();\n                    break;\n                }\n                case \"inside\":\n                {\n                    this.tip.css({\n                        width  : this.object.outerWidth(),\n                        height : this.object.outerHeight(),\n                        display: \"none\"\n                    });\n                    this.tip.css(\"opacity\", 0).animate({opacity: 1}, 100);\n                    break;\n                }\n                default:\n                    break;\n            }\n\n            this.tip.css({left: \"\", top: \"\"});\n\n            /* Self return */\n            return this;\n\n        },\n\n        /**\n         * Hides current tip\n         */\n        hide: function() {\n\n            /* Remove count down if needed */\n            if(this.closeTimeout)\n                clearTimeout(this.closeTimeout);\n\n            /* Stop animation */\n            this.tip.stop();\n\n            /* Get know how tip was shown */\n            let align = this.align;\n\n            /* Create end animation callback */\n            let callback = () => {\n\n                /* Delete record from global list */\n                list.remove(this);\n\n                /* Remove data */\n                this.object.removeData(\"tip\");\n\n                /* Remove tip */\n                this.tip.remove();\n\n                /* Callback */\n                this.callbacks.fire(\"hide\", this);\n\n            };\n\n            /* If just shown */\n            if(!align)\n                callback();\n\n            /* If shadow */\n            if(this.shadow)\n                this.shadow.animate({opacity: 0}, 100, () => { this.shadow.remove() });\n\n            /* Right way hide */\n            if(align === \"right\")\n                this.tip.animate({opacity: 0, marginLeft: \"+=10\"}, 100, callback);\n\n            /* Left way hide */\n            if(align === \"left\")\n                this.tip.animate({opacity: 0, marginLeft: \"-=10\"}, 100, callback);\n\n            /* Instead way hide */\n            if(align === \"instead\")\n                this.tip.fadeOut({opacity: 0}, 200, callback);\n\n            /* Top way hide */\n            if(align === \"top\")\n                this.tip.animate({opacity: 0, marginTop: \"-=5\"}, 200, callback);\n\n            /* Bottom way hide */\n            if(align === \"bottom\")\n                this.tip.animate({opacity: 0, marginTop: \"+=5\"}, 200, callback);\n\n            /* Inside way hide */\n            if(align === \"inside\")\n                this.tip.animate({opacity: 0}, 200, callback);\n\n            /* Self return */\n            return this;\n\n        },\n\n        /**\n         * Gets tips dom\n         * @returns {*}\n         */\n        get: function() {\n            return this.tip;\n        },\n\n        /**\n         * Sets tip text\n         * @param {string|jQuery} text What to insert to tip body\n         */\n        set: function(text) {\n            this.tip.children(\".tipContent\").html(text);\n            return this;\n        },\n\n        /**\n         * Adds something to tip\n         * @param {string|jQuery} what What to append to tip body\n         */\n        add: function(what) {\n            this.tip.children(\".tipContent\").append(what);\n            return this;\n        }\n\n    });\n\n});","sky.service(\"utils\", function() {\n\tthis.service = {\n\n\t\textend: function() {\n\t\t\treturn $.extend.apply($, arguments);\n\t\t},\n\n\t\teach: function() {\n\t\t\treturn $.each.apply($, arguments);\n\t\t},\n\n\t\t/**\n\t\t * Checks if object has same data\n\t\t * @param first\n\t\t * @param second\n\t\t */\n\t\tisObjectsEqual: function(first, second) {\n\n\t\t\t/* Different types */\n\t\t\tif(typeof first !== typeof second)\n\t\t\t\treturn false;\n\n\t\t\t/* If object or array we will compare each element */\n\t\t\tif(first instanceof Array || first instanceof Object) {\n\t\t\t\tlet key;\n\t\t\t\t/* Check first */\n\t\t\t\tfor(key in first) {\n\t\t\t\t\tif(!first.hasOwnProperty(key)) continue;\n\t\t\t\t\tif(typeof second[key] === \"undefined\") return false;\n\t\t\t\t\telse if(!this.isObjectsEqual(first[key], second[key])) return false;\n\t\t\t\t}\n\n\t\t\t\t/* Check second */\n\t\t\t\tfor(key in second) {\n\t\t\t\t\tif(!second.hasOwnProperty(key)) continue;\n\t\t\t\t\tif(typeof first[key] === \"undefined\") return false;\n\t\t\t\t}\n\n\t\t\t} else if(first !== second) return false;    // For simple types\n\n\t\t\t/* All tests success */\n\t\t\treturn true;\n\n\t\t},\n\n\t\t/**\n\t\t * Adds zero\n\t\t * @param value\n\t\t * @returns {Number}\n\t\t */\n\t\taddLeadingZero: function(value) {\n\n\t\t\t/* Parse */\n\t\t\tvalue = parseInt(value);\n\n\t\t\t/* Ad zero */\n\t\t\tif(value < 10)\n\t\t\t\tvalue = \"0\" + value;\n\n\t\t\t/* Val */\n\t\t\treturn value;\n\n\t\t},\n\n\t\tencode: function(rawStr) {\n\t\t\treturn rawStr.replace(/[\\u00A0-\\u9999<>&]/gim, function(i) {\n\t\t\t\treturn '&#' + i.charCodeAt(0) + ';';\n\t\t\t});\n\t\t},\n\n\t\t/**\n\t\t * Makes data to JSON past\n\t\t * @param data\n\t\t * @param [inputName]\n\t\t * @returns {string}\n\t\t */\n\t\tjsonData: function(data, inputName) {\n\t\t\treturn '<script type=\"application/json\"' + (inputName ? (' input-name=\"' + inputName + '\"') : \"\") + '>' + sky.encode(JSON.stringify(data)) + '</script>';\n\t\t},\n\n\t\tprepareSelectData: function(items, func, {columnSplitOn = 6, maxColumns = 4}) {\n\n\t\t\tlet index        = 0,\n\t\t\t\tcolumns      = [],\n\t\t\t\tcolumnsCount = items.length / columnSplitOn,\n\t\t\t\tgroupHolder,\n\t\t\t\tcompiled;\n\n\t\t\tif(columnsCount < 1)\n\t\t\t\tcolumnsCount = 1;\n\t\t\tif(columnsCount > maxColumns)\n\t\t\t\tcolumnsCount = maxColumns;\n\n\t\t\tlet perColumn = Math.ceil(items.length / columnsCount);\n\n\t\t\tfor(let item of items) {\n\t\t\t\tif(compiled = func({item, index, column: columns.length})) {\n\n\t\t\t\t\tif(index % perColumn === 0) {\n\t\t\t\t\t\tgroupHolder = [];\n\t\t\t\t\t\tcolumns.push(groupHolder);\n\t\t\t\t\t}\n\n\t\t\t\t\tgroupHolder.push(compiled);\n\t\t\t\t\tindex++;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn index === 0 ? [] : {groups: columns}\n\n\t\t}\n\t}\n});","sky.onReady(function({ validator }) {\n\tjQuery.fn.validForm = function() {\n\t\treturn validator.validateForm(this);\n\t}.safe();\n\tjQuery.fn.validationRule = function(name, options) {\n\t\treturn validator.addRule(this, name, options);\n\t}.safe();\n\t$(document).on(\"change keyup\", \"[data-validate]\", function() {\n\t\tvalidator.validateElement($(this));\n\t});\n});\n\nsky.service(\"validator\", function() {\n\n\t/**\n\t * Main validation object\n\t */\n\tlet validator = this.service = {\n\n\t\t/**\n\t\t * Validates specified form, or dom element\n\t\t * @param form\n\t\t */\n\t\tvalidateForm: function(form) {\n\n\t\t\tlet pass = true,\n\t\t\t\tself = this;\n\n\t\t\t/* Go through all elements that need to be validate */\n\t\t\tform.find(\"input, select, textarea, .selectReplace, [data-validate]\").filter(\":visible\").each(function() {\n\n\t\t\t\t/* Get element */\n\t\t\t\tlet element = $(this);\n\n\t\t\t\t/* validate if needed to */\n\t\t\t\tif(self.shouldBeValidated(element) && !self.validateElement(element, form))\n\t\t\t\t\tpass = false;\n\n\t\t\t});\n\n\t\t\t/* Return result */\n\t\t\treturn pass;\n\n\t\t},\n\n\t\t/**\n\t\t * Add rule to specified element\n\t\t * @param element\n\t\t * @param name\n\t\t * @param [options]\n\t\t */\n\t\taddRule: function(element, name, options) {\n\n\t\t\t/* Get or make options and add rule */\n\t\t\tthis.Options(element).addRule(name, options || {});\n\n\t\t\t/* Self return */\n\t\t\treturn this;\n\n\t\t},\n\n\t\t/**\n\t\t *\n\t\t * Validates specified element\n\t\t * @param {*} element Element to validate\n\t\t * @param {*} [form] Form to validate\n\t\t * @returns {boolean}\n\t\t */\n\t\tvalidateElement: function(element, form) {\n\n\t\t\tlet self = this,\n\t\t\t\toptions = this.Options(element),\n\t\t\t\ttotalPass = true,\n\t\t\t\tvalue = element.val(),\n\t\t\t\tlastError = false,\n\t\t\t\tfirstError = false,\n\t\t\t\tlastSuccess = false,\n\t\t\t\tfirstSuccess = false;\n\n\t\t\t/* Select replace */\n\t\t\tif(element.is(\".selectReplace\")) {\n\t\t\t\tlet inputs = element.next().find(\"input:checked\");\n\t\t\t\tif(!inputs.length)\n\t\t\t\t\tvalue = \"\";\n\t\t\t\telse if(element.is(\".single\"))\n\t\t\t\t\tvalue = element.next().find(\"input:checked\").val();\n\t\t\t\telse\n\t\t\t\t\tvalue = element.next().find(\"input:checked\").length ? \"true\" : \"\";\n\t\t\t}\n\n\t\t\t/* Go through rules */\n\t\t\t$.each(options.rules, function(name, ruleOverload) {\n\n\t\t\t\t/* Make compiled rule */\n\t\t\t\tlet compiledRule = jQuery.extend(true, {}, self.rules[name] || self.Rule({}), ruleOverload || {});\n\n\t\t\t\t/* Execute message is needed */\n\t\t\t\tif(typeof compiledRule.message === \"function\")\n\t\t\t\t\tcompiledRule.message = compiledRule.message.call(this);\n\n\t\t\t\t/* Check if element pass validation */\n\t\t\t\tlet pass = self.validate(value, compiledRule, element, form);\n\n\t\t\t\t/* Perform action according to result */\n\t\t\t\tif(pass) {\n\t\t\t\t\tcompiledRule.onSuccess(element, compiledRule);\n\t\t\t\t\tlastSuccess = compiledRule;\n\t\t\t\t\tif(!firstSuccess)\n\t\t\t\t\t\tfirstSuccess = compiledRule;\n\t\t\t\t} else {\n\t\t\t\t\tcompiledRule.onError(element, compiledRule);\n\t\t\t\t\tlastError = compiledRule;\n\t\t\t\t\tif(!firstError)\n\t\t\t\t\t\tfirstError = compiledRule;\n\t\t\t\t\ttotalPass = false;\n\t\t\t\t}\n\n\t\t\t});\n\n\t\t\t/* Total callbacks */\n\t\t\tif(totalPass)\n\t\t\t\toptions.onSuccess(element, lastSuccess);\n\t\t\telse\n\t\t\t\toptions.onError(element, firstError);\n\n\t\t\t/* Return true of element passed all validations */\n\t\t\treturn totalPass;\n\n\t\t},\n\n\t\t/**\n\t\t * Return true if element should be validated\n\t\t * @param {*} element Element to validate\n\t\t * @returns {boolean}\n\t\t */\n\t\tshouldBeValidated: function(element) {\n\t\t\treturn element.attr(\"data-validate\") || element.data(\"validationOptions\");\n\t\t},\n\n\t\t/**\n\t\t * Return true if element passed validation\n\t\t * @param element\n\t\t * @param compiledRule\n\t\t * @param form\n\t\t * @returns {*}\n\t\t * @param value\n\t\t */\n\t\tvalidate: function(value, compiledRule, element, form) {\n\t\t\treturn compiledRule.rule.call(compiledRule, value, element, form);\n\t\t}\n\n\t};\n\n\t/**\n\t * Defaults\n\t */\n\tvalidator.ruleDefaults = {\n\n\t};\n\n\t/**\n\t * Defaults\n\t * @type {{onSuccess: onSuccess, onError: onError}}\n\t */\n\tvalidator.optionsDefaults = {\n\n\t\t/* Fires on success */\n\t\tonSuccess: function(element) {\n\n\t\t\t/* Remove error */\n\t\t\telement.removeClass(this.errorClass);\n\n\t\t\t/* Add success */\n\t\t\tif(this.successClass)\n\t\t\t\telement.addClass(this.successClass);\n\n\t\t},\n\n\t\t/* Fires on error */\n\t\tonError: function(element) {\n\n\t\t\t/* Add error */\n\t\t\telement.addClass(this.errorClass);\n\n\t\t\t/* Remove success */\n\t\t\tif(this.successClass)\n\t\t\t\telement.removeClass(this.successClass);\n\n\t\t}\n\t};\n\n\t/**\n\t * Base rule object\n\t * @param overload\n\t * @returns {validator.Rule}\n\t * @constructor\n\t */\n\tvalidator.Rule = function(overload) {\n\n\t\t/* Self creation if needed */\n\t\tif(!(this instanceof validator.Rule))\n\t\t\treturn new validator.Rule(overload);\n\n\t\t/* Dump rule to check validation */\n\t\tthis.rule = function() { return true; };\n\n\t\t/* Dump message */\n\t\tthis.message = \"Это поле заполнено не верно\";\n\n\t\t/* List of options to make validation according to */\n\t\tthis.options = [];\n\n\t\t/* Fires on success */\n\t\tthis.onSuccess = function(element) {};\n\n\t\t/* Fires on error */\n\t\tthis.onError = function(element) {};\n\n\t\t/* Self extend with overload */\n\t\tjQuery.extend(this, overload);\n\n\t\t/* Return */\n\t\treturn this;\n\n\t};\n\n\t/**\n\t * List of default rules\n\t * @type {{required: validator.Rule}}\n\t */\n\tvalidator.rules = {\n\t\trequired: validator.Rule({\n\t\t\trule: function(value) {\n\t\t\t\treturn !!value.length;\n\t\t\t},\n\t\t\tmessage: \"Это поле необходимо заполнить\"\n\t\t}),\n\t\trequiredIfFilled: validator.Rule({\n\t\t\trule: function(value) {\n\t\t\t\tlet item = $(this.options[0]);\n\t\t\t\treturn item.is(\":radio, :checkbox\") ? !item.is(\":checked\") || value : item.val() === \"\" || value;\n\t\t\t},\n\t\t\tmessage: \"Это поле необходимо заполнить\"\n\t\t}),\n\t\tdate: validator.Rule({\n\t\t\trule: function(value) {\n\t\t\t\treturn !value || (\n\t\t\t\t\tvalue.match(/^\\d{4}-\\d{2}-\\d{2}( \\d{2}:\\d{2}(:\\d{2})?)?$/) ||\n\t\t\t\t\tvalue.match(/^\\d{2}.\\d{2}.\\d{4}( \\d{2}:\\d{2}(:\\d{2})?)?$/)\n\t\t\t\t\t);\n\t\t\t},\n\t\t\tmessage: \"Дата указана неверно\"\n\t\t}),\n\t\tperiod: validator.Rule({\n\t\t\trule: function(value) {\n\t\t\t\treturn !value || (\n\t\t\t\t\tvalue.match(/^\\d{4}-\\d{2}-\\d{2}$/) ||\n\t\t\t\t\tvalue.match(/^\\d{2}.\\d{2}.\\d{4}$/) ||\n\t\t\t\t\tvalue.match(/^\\d{2}.\\d{2}.\\d{4}\\s*-\\s*\\d{2}.\\d{2}.\\d{4}$/) ||\n\t\t\t\t\tvalue.match(/^\\d{4}-\\d{2}-\\d{2}\\s*-\\s*\\d{4}-\\d{2}-\\d{2}$/)\n\t\t\t\t\t);\n\t\t\t},\n\t\t\tmessage: \"Период указан неверно\"\n\t\t}),\n\t\temail: validator.Rule({\n\t\t\trule: function(value) {\n\t\t\t\treturn value && value.match(/[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*@(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?/);\n\t\t\t},\n\t\t\tmessage: \"Почтовый адрес указан неверно\"\n\t\t}),\n\t\tsame: validator.Rule({\n\t\t\trule: function(value) {\n\t\t\t\treturn value === $('[name=\"' + this.options[0] + '\"]').val();\n\t\t\t},\n\t\t\tmessage: \"Поля не совпадают\"\n\t\t}),\n\t\turl: validator.Rule({\n\t\t\trule: function(value) {\n\t\t\t\treturn value === \"\" || value.match(/^(https?:\\/\\/.+)$/);\n\t\t\t},\n\t\t\tmessage: \"Не корректный адрес URI\"\n\t\t}),\n\t\tregexp: validator.Rule({\n\t\t\trule: function(value) {\n\t\t\t\treturn value === \"\" || value.match(new RegExp(this.options[0]));\n\t\t\t},\n\t\t\tmessage: \"Введите корректное значение\"\n\t\t}),\n\t\tnumeric: validator.Rule({\n\t\t\trule: function(value) {\n\t\t\t\treturn value === \"\" || value.match(/^-?[0-9]+(\\.[0-9]+)?$/);\n\t\t\t},\n\t\t\tmessage: \"Введите число\"\n\t\t}),\n\t\tpositive: validator.Rule({\n\t\t\trule: function(value) {\n\t\t\t\treturn value === \"\" || value.match(/^[0-9]+(\\.[0-9]+)?$/) && parseFloat(value) > 0;\n\t\t\t},\n\t\t\tmessage: \"Введите положительное число\"\n\t\t}),\n\t\tmax: validator.Rule({\n\t\t\trule: function(value) {\n\t\t\t\treturn value === \"\" || value.match(/^[0-9]+(\\.[0-9]+)?$/) && parseFloat(value) <= parseFloat(this.options[0] || 0);\n\t\t\t},\n\t\t\tmessage: function() {\n\t\t\t\treturn \"Введите число, не обльше чем \" + (this.options[0] || 0)\n\t\t\t}\n\t\t}),\n\t\tmin: validator.Rule({\n\t\t\trule: function(value) {\n\t\t\t\treturn value === \"\" || value.match(/^[0-9]+(\\.[0-9]+)?$/) && parseFloat(value) >= parseFloat(this.options[0] || 0);\n\t\t\t},\n\t\t\tmessage: function() {\n\t\t\t\treturn \"Введите число, не меньше чем \" + (this.options[0] || 0);\n\t\t\t}\n\t\t}),\n\t\tminLength: validator.Rule({\n\t\t\trule: function(value) {\n\t\t\t\treturn value === \"\" || value.length >= (this.options[0] || 0)\n\t\t\t},\n\t\t\tmessage: \"В этом поле нехватает символов\"\n\t\t}),\n\t\tmaxLength: validator.Rule({\n\t\t\trule: function(value) {\n\t\t\t\treturn value === \"\" || value.length <= (this.options[0] || 0)\n\t\t\t},\n\t\t\tmessage: \"В этом поле слишком много символов\"\n\t\t})\n\t};\n\n\t/**\n\t * Holds element validation options\n\t * @param element\n\t * @constructor\n\t */\n\tvalidator.Options = function(element) {\n\n\t\t/* Create or return */\n\t\tif(!(this instanceof validator.Options))\n\t\t\treturn element.data(\"validationOptions\") || new validator.Options(element);\n\n\t\t/* Callbacks after all checks */\n\t\tthis.onSuccess = function() {};\n\t\tthis.onError = function() {};\n\n\t\t/* Adds to element on success */\n\t\tthis.successClass = false;\n\n\t\t/* Adds to element on error */\n\t\tthis.errorClass   = \"error\";\n\n\t\t/* Overlay defaults */\n\t\tjQuery.extend(true, this, validator.optionsDefaults);\n\n\t\t/* Holds list of validating rules */\n\t\tthis.rules = {};\n\n\t\t/* Save element */\n\t\tthis.element = element;\n\n\t\t/* Get rules that declared in element definition */\n\t\tthis.getDeclaredRules();\n\n\t\t/* Save option */\n\t\tthis.element.data(\"validationOptions\", this);\n\n\t\t/* Self return */\n\t\treturn this;\n\n\t};\n\n\tvalidator.Options.prototype = {\n\n\t\t/**\n\t\t * Gets list of rules that are set in declared way\n\t\t */\n\t\tgetDeclaredRules: function() {\n\n\t\t\t/* Get attribute value */\n\t\t\tlet attr = this.element.attr(\"data-validate\"),\n\t\t\t\tself = this;\n\n\t\t\t/* If none */\n\t\t\tif(!attr)\n\t\t\t\treturn;\n\n\t\t\t/* Get list */\n\t\t\t$.each(attr.split(\";\"), function(_, name) {\n\n\t\t\t\t/* Get parameters */\n\t\t\t\tlet params = name.match(/(\\w+)\\((.*)\\)/);\n\n\t\t\t\t/* Parse */\n\t\t\t\tif(params) {\n\n\t\t\t\t\t/* Get function */\n\t\t\t\t\tname = params[1];\n\n\t\t\t\t\t/* Parse params */\n\t\t\t\t\tparams = params[2].match(/(('[^']+')|([\\d\\w]+))/g);\n\t\t\t\t\t$.each(params, function(i, val) {\n\t\t\t\t\t\tparams[i] = eval(val.trim());\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\t/* Add rule to options */\n\t\t\t\tself.addRule(name.trim(), { options: params || [] });\n\n\t\t\t});\n\n\n\t\t},\n\n\t\t/**\n\t\t * Adds new rule for element\n\t\t * @param {string} name Rule name\n\t\t * @param {object} options Rule options\n\t\t * @returns {validator.Options}\n\t\t */\n\t\taddRule: function(name, options) {\n\n\t\t\t/* Create and save new rule */\n\t\t\tthis.rules[name] = jQuery.extend({}, validator.ruleDefaults, options);\n\n\t\t\t/* Mark for auto validation */\n\t\t\tif(!this.element.attr(\"data-validate\"))\n\t\t\t\tthis.element.attr(\"data-validate\", \"true\");\n\n\t\t\t/* Self returning */\n\t\t\treturn this;\n\t\t}\n\n\t}\n\n});","sky.service(\"visibleCalculator\", function() {\n\n\tlet Calculator = class {\n\n\t\tconstructor(holder, minHeight, scrollable) {\n\n\t\t\t/* Check if class */\n\t\t\tif(!(this instanceof Calculator))\n\t\t\t\treturn new Calculator(holder, minHeight, scrollable);\n\n\t\t\t/* Re get holder */\n\t\t\tthis.holder = $(holder);\n\t\t\tthis.scrollable = scrollable || $('body');\n\t\t\tthis.minHeight = minHeight || 0;\n\n\t\t\t/* Init */\n\t\t\tthis.init();\n\n\t\t}\n\n\t\t/* Init func */\n\t\tinit() {\n\n\t\t\t/* Count offset */\n\t\t\tlet offset = this.holder.offset();\n\n\t\t\t/* Get holder rect */\n\t\t\tthis.holderRect = {\n\t\t\t\tleft  : offset.left,\n\t\t\t\ttop   : offset.top,\n\t\t\t\twidth : this.holder.outerWidth(),\n\t\t\t\theight: this.holder.outerHeight()\n\t\t\t};\n\n\t\t}\n\n\t\t/* Calculating function */\n\t\tcalculate() {\n\n\t\t\t/* How much is scrolled */\n\t\t\tlet scrollTop    = $(this.scrollable).scrollTop(),\n\t\t\t\twindowHeight = $(window).height(),\n\t\t\t\twindowWidth  = $(window).width(),\n\t\t\t\tsizes        = {\n\t\t\t\t\tleft        : this.holderRect.left,\n\t\t\t\t\tright       : this.holderRect.left + this.holderRect.width,\n\t\t\t\t\ttop         : this.holderRect.top - scrollTop,\n\t\t\t\t\twidth       : this.holderRect.width,\n\t\t\t\t\theight      : this.holderRect.height,\n\t\t\t\t\trealHeight  : this.holderRect.height,\n\t\t\t\t\tbottom\t\t: 0,\n\t\t\t\t\tscrollTop   : scrollTop,\n\t\t\t\t\tscrollLeft  : 0,\n\t\t\t\t\twindowHeight: windowHeight,\n\t\t\t\t\twindowWidth : windowWidth,\n\t\t\t\t};\n\n\t\t\t/* Min height */\n\t\t\tif(sizes.height < this.minHeight)\n\t\t\t\tsizes.height = this.minHeight;\n\n\t\t\t/* Count bottom */\n\t\t\tsizes.bottom = sizes.top + sizes.height;\n\n\t\t\t/* If top border near than holder */\n\t\t\tif(sizes.top < 0) {\n\t\t\t\t// If visible less than min\n\t\t\t\tif(sizes.bottom < this.minHeight) {\n\t\t\t\t\tsizes.bottom = sizes.bottom < 0 ? 0 : sizes.bottom;\n\t\t\t\t\tsizes.top = sizes.bottom - this.minHeight;\n\t\t\t\t\tsizes.height = this.minHeight;\n\t\t\t\t}\n\t\t\t\t// If visible more than min\n\t\t\t\telse {\n\t\t\t\t\tsizes.height = sizes.bottom;\n\t\t\t\t\tsizes.top = 0;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t/* Get visible bottom */\n\t\t\tif(windowHeight < sizes.bottom) {\n\t\t\t\t// If visible less than min\n\t\t\t\tif(windowHeight - sizes.top < this.minHeight) {\n\t\t\t\t\tsizes.height = this.minHeight;\n\t\t\t\t\tsizes.top = windowHeight - sizes.top < 0 ? 0 : sizes.top;\n\t\t\t\t\tsizes.bottom = sizes.top + this.minHeight;\n\t\t\t\t}\n\t\t\t\t// If visible more than min\n\t\t\t\telse {\n\t\t\t\t\tsizes.height = windowHeight - sizes.top;\n\t\t\t\t\tsizes.bottom = 0;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t/* Return */\n\t\t\treturn sizes;\n\n\t\t}\n\n\t\tgetDropOffset(replace, popup) {\n\n\t\t\t/* Get drop */\n\t\t\tif(!popup.is(\":visible\")) return;\n\n\t\t\t/* Set position to zeros to get max width and height */\n\t\t\tpopup.removeClass('hidden').css({left: 0, top: 0});\n\n\t\t\t/* Init */\n\t\t\tlet popupWidth  = popup.outerWidth(),\n\t\t\t\tpopupHeight = popup.outerHeight();\n\n\t\t\t/* Reset position */\n\t\t\tpopup.css({marginLeft: \"\", marginTop: \"\", width: \"\", left: \"\", top: \"\"});\n\n\t\t\t/* Init */\n\t\t\tlet win            = $(window),\n\t\t\t\treplaceOffset  = replace.offset(),\n\t\t\t\tpopupOffset    = popup.offset(),\n\t\t\t\tleftDifference = popupOffset.left - replaceOffset.left,\n\t\t\t\ttopDifference  = popupOffset.top - replaceOffset.top,\n\t\t\t\tmiddle         = false,\n\t\t\t\tvisible        = this.calculate(),\n\t\t\t\ttop = 0, left = 0;\n\n\t\t\t// Drop down\n\t\t\tif(visible.bottom + popupHeight <= visible.windowHeight)\n\t\t\t\ttop = -topDifference + visible.realHeight + 1;\n\t\t\t// Drop up\n\t\t\telse if(visible.top > popupHeight)\n\t\t\t\ttop = -topDifference - 1 - popupHeight;\n\t\t\t// Drop left\n\t\t\telse {\n\t\t\t\ttop = -topDifference - (popupHeight - visible.realHeight) / 2;\n\t\t\t\tmiddle = true;\n\t\t\t}\n\t\t\t\n\t\t\t/* Set position */\n\t\t\tif(!middle) {\n\t\t\t\tif(visible.windowWidth > visible.left + popupWidth)\n\t\t\t\t\tleft = -leftDifference;\n\t\t\t\telse\n\t\t\t\t\tleft = -leftDifference - popupWidth + visible.width;\n\t\t\t} else {\n\t\t\t\tif(win.width() > replaceOffset.left + popupWidth + visible.width)\n\t\t\t\t\tleft = replaceOffset.left - popupOffset.left + visible.width;\n\t\t\t\telse\n\t\t\t\t\tleft = replaceOffset.left - popupOffset.left - popupWidth;\n\t\t\t}\n\n\t\t\treturn { top, left };\n\t\t\t\n\t\t}\n\t};\n\tthis.service = Calculator;\n});","/**\n * Holds classes to work with modal/new windows\n */\nsky.service('windows', [\"templates\", \"callbacks\", \"stackList\"], function ({templates, callbacks, stackList}) {\n\n\tlet tips = false,\n\t\tlist = stackList(),\n\t\twindows = this.service = {\n\t\t\t/**\n\t\t\t * Returns last open window if any\n\t\t\t * @returns {Modal|undefined}\n\t\t\t */\n\t\t\tgetLast: () => list.last(),\n\t\t\t/**\n\t\t\t * Returns new modal window\n\t\t\t * @returns {Modal}\n\t\t\t */\n\t\t\tmodal: (name, data) => new Modal(name, data)\n\t\t};\n\n\n\t/**\n\t * Creates new modal window\n\t * @param {*} name Window name\n\t * @param {*} [data] Data to send with request\n\t */\n\tclass Modal {\n\t\tconstructor (name, data) {\n\n\t\t\t/* Create window */\n\t\t\tthis.locked \t\t= false;\n\t\t\tthis.background \t= templates.render(\"windows-modal\", {}).appendTo(\"#pageContentHolder\").data(\"modalWindow\", this);\n\t\t\tthis.dataContainer \t= this.background.children();\n\t\t\tthis.holder \t\t= this.dataContainer.children(\".windowData\");\n\t\t\tthis.closeButton \t= this.dataContainer.children(\".close\");\n\n\t\t\t/* Make body un scrollable */\n\t\t\t$(document.body).css(\"overflow\", \"hidden\");\n\n\t\t\t/* Callbacks */\n\t\t\tthis.callbacks = callbacks();\n\n\t\t\t/* Render content */\n\t\t\ttry {\n\t\t\t\tthis.reRender(name, data);\n\t\t\t} catch (e) {\n\t\t\t\tthis.close(false);\n\t\t\t\tthrow e;\n\t\t\t}\n\n\t\t\t/* Return */\n\t\t\treturn this;\n\n\t\t}\n\n\t\t/**\n\t\t * Renders window content\n\t\t * @param {*} name Window name\n\t\t * @param {*} [data] Data to send with request\n\t\t */\n\t\treRender(name, data) {\n\n\t\t\t/* Close all tips */\n\t\t\tif(tips) tips.hideAll(true);\n\n\t\t\t/* Clear */\n\t\t\tthis.holder.html('');\n\n\t\t\t/* Render content */\n\t\t\tif (name instanceof jQuery)\n\t\t\t\tthis.template = name.appendTo(this.holder);\n\t\t\telse if (typeof name === \"string\")\n\t\t\t\tthis.template = templates.render(name, data).appendTo(this.holder);\n\n\t\t\t/* Self return */\n\t\t\treturn this;\n\t\t}\n\n\t\t/**\n\t\t * Removes all except that was rendered\n\t\t */\n\t\tclearExceptTemplate() {\n\t\t\tthis.holder.children().detach();\n\t\t\tthis.holder.append(this.template);\n\t\t}\n\n\t\t/**\n\t\t * Removes all except that was rendered\n\t\t */\n\t\tremoveNotifications() {\n\t\t\ttry {\n\t\t\t\tsky.service(\"notifications\").findInElement(this.holder).remove();\n\t\t\t} catch(e) {}\n\t\t}\n\n\t\t/**\n\t\t * Locks window so it can't be closed\n\t\t * @var {*} ajax Ajax object\n\t\t * @returns {Modal}\n\t\t */\n\t\tlock(ajax = false) {\n\t\t\tthis.locked = true;\n\t\t\tthis.closeButton.hide();\n\t\t\tif (ajax) ajax\n\t\t\t\t.on(\"preSuccess\", function () {\n\t\t\t\t\tthis.dataContainer.css(\"height\", this.dataContainer.innerHeight());\n\t\t\t\t}, this)\n\t\t\t\t.on(\"notAbort\", function () {\n\t\t\t\t\tlet self = this;\n\t\t\t\t\tthis.unlock();\n\t\t\t\t\tthis.dataContainer.css(\"height\", this.holder.outerHeight());\n\t\t\t\t\tsetTimeout(function () {\n\t\t\t\t\t\tself.dataContainer.css(\"height\", \"\");\n\t\t\t\t\t}, 500)\n\t\t\t\t}, this)\n\t\t\t\t.on(\"abort\", function () {\n\t\t\t\t\tthis.unlock().close();\n\t\t\t\t}, this);\n\t\t\treturn this;\n\t\t}\n\n\t\t/**\n\t\t * Unlocks window so it can be closed\n\t\t * @returns {Modal}\n\t\t */\n\t\tunlock() {\n\t\t\tthis.locked = false;\n\t\t\tthis.closeButton.show();\n\t\t\treturn this;\n\t\t}\n\n\t\t/**\n\t\t * Closes current window\n\t\t * @param {boolean} [byUser] Indicates that window was closed not by user\n\t\t */\n\t\tclose(byUser = false) {\n\n\t\t\t/* If windows is locked */\n\t\t\tif (this.locked)\n\t\t\t\treturn;\n\n\t\t\t/* Remove elements */\n\t\t\tthis.background.fadeOut(\"fast\", function () {\n\t\t\t\t$(this).remove()\n\t\t\t});\n\n\t\t\t/* Delete from list */\n\t\t\tlist.remove(this);\n\n\t\t\t/* Call close callback */\n\t\t\tthis.callbacks.fire(\"close\", {byUser: byUser});\n\n\t\t\t/* Close all tips */\n\t\t\ttry {\n\t\t\t\ttips = sky.service(\"tips\").hideAll(true);\n\t\t\t} catch (e) {}\n\n\t\t\t/* Make body scrollable */\n\t\t\tif (list.total() < 1)\n\t\t\t\t$(document.body).css(\"overflow\", \"\");\n\n\t\t\treturn this;\n\n\t\t}\n\t}\n\n\ttry {\n\t\ttips = sky.service(\"tips\");\n\t} catch (e) {}\n\n\t/* Add handler to black area click */\n\t$(document)\n\t\t.on(\"keyup\", sky.func(function (event) {\n\t\t\tlet last;\n\n\t\t\t/* If slide show was disabled */\n\t\t\tif (document[\"webkitIsFullScreen\"] || document[\"mozIsFullScreen\"] || document[\"isFullScreen\"])\n\t\t\t\treturn;\n\n\t\t\t/* Close current window */\n\t\t\tif (event.keyCode === 27 && (last = windows.getLast()))\n\t\t\t\tlast.close(true);\n\n\t\t}));\n\n});","sky.action(\"pagination\", {\n\n\tsetPage: function(button, _, page) {\n\n\t\t/* Get pagination */\n\t\tlet pagination = button.parents(\".pagination\").data(\"pagination\");\n\n\t\t/* Correct page */\n\t\tif(page === \"next\")\n\t\t\tpage = pagination.current + 1;\n\n\t\t/* Correct  */\n\t\tif(page === \"previous\")\n\t\t\tpage = pagination.current - 1;\n\n\t\t/* Go to page */\n\t\tpagination.goToPage(page);\n\n\t},\n\n\tscrollTo: function(element, event) {\n\n\t\t/* Get pagination */\n\t\tlet pagination = element.parents(\".pagination\").data(\"pagination\");\n\n\t\t/* Move */\n\t\tpagination.scroll(event);\n\n\t},\n\n\tgrab: function(runner) {\n\n\t\t/* Get pagination */\n\t\tlet pagination = runner.parents(\".pagination\").data(\"pagination\");\n\n\t\t/* Binds */\n\t\t$(window)\n\t\t\t.on(\"mouseup.pagination\", function() {\n\t\t\t\t$(window).off(\"mouseup.pagination mousemove.pagination\");\n\t\t\t}).on(\"mousemove.pagination\", function(event) {\n\t\t\t\tpagination.scroll(event);\n\t\t\t});\n\n\t},\n\n\tnext: function(button, _) {\n\t\tthis.setPage(button, _, \"next\")\n\t},\n\n\tprevious: function(button, _) {\n\t\tthis.setPage(button, _, \"previous\")\n\t}\n\n});","sky.action(\"suggest\", function(suggester) {\r\n   return {\r\n       adverts: function(input, event) {\r\n\r\n           // Events\r\n           if(event.keyCode == 38 || event.keyCode == 40 || event.keyCode == 13 || event.keyCode == 27)\r\n               return;\r\n\r\n           // Stop if any other\r\n           if(this.suggestAjax)\r\n               this.suggestAjax.stop();\r\n\r\n           // Nothing\r\n           if(input.val() == \"\" || input.val().length < 2) {\r\n               suggester.hideAll();\r\n               return;\r\n           }\r\n\r\n           this.suggestAjax = sky.ajax(\"/ajax/members/search\", { name: input.val() })\r\n               .on(\"success\", function(response) {\r\n\r\n                   // No filtered\r\n                   if(!response.adverts || !response.adverts.length)\r\n                       suggester.hideAll();\r\n\r\n                   var filtered = [];\r\n\r\n                   $.each(response.adverts, function(_, advert) {\r\n                       filtered.push(advert.username);\r\n                   });\r\n\r\n                   // Show\r\n                   suggester.show(input, filtered);\r\n\r\n               }).on(\"error\", function() {\r\n                   suggester.hideAll();\r\n               });\r\n\r\n       },\r\n\r\n       campaigns: function(input, event){\r\n\r\n           // Events\r\n           if(event.keyCode == 38 || event.keyCode == 40 || event.keyCode == 13 || event.keyCode == 27)\r\n               return;\r\n\r\n           // Stop if any other\r\n           if(this.suggestAjax)\r\n               this.suggestAjax.stop();\r\n\r\n           // Nothing\r\n           if(input.val() == \"\" || input.val().length < 2) {\r\n               suggester.hideAll();\r\n               return;\r\n           }\r\n\r\n           this.suggestAjax = sky.ajax(\"/ajax/campaigns/search\", { name: input.val() })\r\n               .on(\"success\", function(response) {\r\n\r\n                   // No filtered\r\n                   if(!response.campaigns || !response.campaigns.length)\r\n                       suggester.hideAll();\r\n\r\n                   var filtered = [];\r\n\r\n                   $.each(response.campaigns, function(_, campaign) {\r\n\r\n                       filtered.push({ html: campaign.name });\r\n                   });\r\n\r\n                   // Show\r\n                   suggester.show(input, filtered);\r\n\r\n               }).on(\"error\", function() {\r\n                   suggester.hideAll();\r\n               });\r\n       },\r\n\r\n       campaignsSpecial: function(input, event){\r\n           // Events\r\n           if(event.keyCode == 38 || event.keyCode == 40 || event.keyCode == 13 || event.keyCode == 27)\r\n               return;\r\n\r\n           // Nothing\r\n           if(input.val() == \"\" || input.val().length < 2) {\r\n               suggester.hideAll();\r\n               return;\r\n           }\r\n\r\n           if(this.suggestAjax)\r\n               this.suggestAjax.stop();\r\n\r\n           this.suggestAjax = sky.ajax(\"/ajax/campaigns/search\", { name: input.val() })\r\n               .on(\"success\", function(response) {\r\n\r\n                   // No filtered\r\n                   if(!response.campaigns || !response.campaigns.length)\r\n                       suggester.hideAll();\r\n\r\n                   var filtered = [];\r\n\r\n                   $.each(response.campaigns, function(_, campaign) {\r\n\r\n                       filtered.push({ html: campaign.name+\" (\"+campaign.advert.username+\")\", callback: function(){\r\n                           sky.actions.perform(null, null, \"page.selectCampaign\", [campaign.id]);\r\n                       }});\r\n                   });\r\n\r\n                   // Show\r\n                   suggester.show(input, filtered);\r\n\r\n               }).on(\"error\", function() {\r\n                   suggester.hideAll();\r\n               });\r\n       }\r\n   }\r\n});","sky.directive(\"[data-suggests]\", function(element, attributes) {\n\telement.attr(\"data-event\", \"keyup: suggest.\" + attributes[\"data-suggests\"]).attr(\"autocomplete\", \"off\");\n});","sky.action(\"tips\", ({ tips }) => {\n\n\t// Get\n\tlet body = $('body'),\n\t\tevents  = body.attr(\"data-event\") || \"\",\n\t\tevent   = \"click: tips.hideTips\";\n\n\t// Add\n\tbody.attr(\"data-event\", events ? events + \"; \" + event: event);\n\n\tlet self = {\n\n\t\tshowTip: function(button, _, name) {\n\n\t\t\tif(button.data(\"tip\")) {\n\t\t\t\tbutton.data(\"tip\").hide();\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// Hide others\n\t\t\tself.hideTips(button, false);\n\n\t\t\t// Create\n\t\t\tlet tip = tips.Tip(button, {\n\t\t\t\tcreate: $('<div/>').css(\"overflow\", \"hidden\").append($(\"#\" + name + \"TipText\").html())\n\t\t\t});\n\n\t\t\t// Show\n\t\t\ttip.show(\"top\");\n\n\t\t},\n\n\t\tshowTipWithText: function(button, _, text) {\n\n\t\t\tif(button.data(\"tip\")) {\n\t\t\t\tbutton.data(\"tip\").hide();\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// Hide others\n\t\t\tself.hideTips(button, false);\n\n\t\t\t// Create\n\t\t\tlet tip = tips.Tip(button, {\n\t\t\t\tcreate: $('<div/>').css(\"overflow\", \"hidden\").append(text)\n\t\t\t});\n\n\t\t\t// Show\n\t\t\ttip.show(\"top\");\n\n\t\t},\n\n\t\thideTips: function(element, event) {\n\t\t\ttips.hideAll(false, $(event.target));\n\t\t},\n\n\t\t/**\n\t\t *\n\t\t */\n\t\tforceHideTips: function() {\n\t\t\ttips.hideAll(true);\n\t\t}\n\t};\n\treturn self;\n});","sky.directive(\"[data-tip]\", function(button, attributes) {\n\n\t// Get\n\tlet events  = attributes[\"data-event\"] || \"\",\n\t\ttipName = attributes[\"data-tip\"],\n\t\tevent   = \"click: tips.showTip('\" + tipName + \"')\";\n\n\t// Set new\n\tevents = events ? events + \"; \" + event: event;\n\n\t// Add\n\tbutton.attr(\"data-event\", events).addClass(\"dashed\");\n\n});\nsky.directive(\"[data-tip-text]\", function(button, attributes) {\n\n\t// Get\n\tlet events  = attributes[\"data-event\"] || \"\",\n\t\ttipText = attributes[\"data-tip-hover\"] || attributes[\"data-tip-text\"],\n\t\tevent   = \"click: tips.showTipWithText('\" + tipText + \"')\";\n\n\t// Set new\n\tevents = events ? events + \"; \" + event: event;\n\n\t// Add\n\tbutton.attr(\"data-event\", events).addClass(\"dashed\");\n\n});\nsky.directive(\"[data-tip-hover]\", function(button, attributes) {\n\n\t// Get\n\tlet tipText = attributes[\"data-tip-hover\"];\n\n\tsky.service(\"tips\").bind(button, \"top\", {create: tipText});\n\n\t// Set new\n\tlet events = attributes[\"data-event\"] || \"\",\n\t\tevent  = \"click: tips.showTipWithText('\" + tipText + \"')\";\n\tevents = events ? events + \"; \" + event : event;\n\n\t// Add\n\tbutton.attr(\"data-event\", events).addClass(\"dashed\");\n\n});","sky.action(\"selectReplace\", function({ visibleCalculator }) {\n\n    let filter = function(self, event) {\n\n        /* Get drop */\n        let popup  = self.closest(\".selectReplaceChoose\"),\n            inputs = popup.find(\"input[name]\");\n\n        /* On enter */\n        if(event.which === 13) {\n            let visible = popup.find(\"label:visible\");\n            if(visible.length > 0) {\n                inputs.prop(\"checked\", false);\n                visible.children(\"input\").prop(\"checked\", true).trigger(\"change\");\n            }\n            event.stopPropagation();\n        }\n\n        /* Get value */\n\t\tlet value = self.val(),\n\t\t\t rus              = \"йцукенгшщзхъфывапролджэёячсмитьбю\",\n             eng              = \"qwertyuiop[]asdfghjkl;'\\\\zxcvbnm,.\",\n             expression       = new RegExp(value.toLowerCase()),\n             expressionInvert = new RegExp(value.toLowerCase().replace(/[a-zа-яё]/g, (character) => {\n                if(rus.indexOf(character) > -1) return eng[rus.indexOf(character)];\n                if(eng.indexOf(character) > -1) return rus[eng.indexOf(character)];\n                return character;\n            }));\n\n        /* Hide */\n        inputs.each((_, input) => {\n\n        \tinput = $(input);\n\n            if(input.parent().hasClass('hidden'))\n                return;\n\n            let inputHtml = input.next().html().toLowerCase();\n\n            try {\n                if(!inputHtml.match(expression) && !inputHtml.match(expressionInvert)) input.parent().hide();\n                else input.parent().show();\n            } catch(e) {}\n\n        });\n    };\n\n    return {\n\n        filter: filter,\n\n        selectAll: function(button) {\n\n            /* Get drop */\n            let popup = button.closest(\".selectReplaceChoose\");\n            popup.find(\":checkbox:visible\").prop(\"checked\", true).first().trigger(\"change\");\n\n        },\n\n        unSelectAll: function(button) {\n\n            /* Get drop */\n            let popup = button.closest(\".selectReplaceChoose\");\n            popup.find(\":checkbox:visible\").prop(\"checked\", false).first().trigger(\"change\");\n\n        },\n\n        close: function(element, event) {\n            if(element.get(0) === event.target)\n                $(\".selectReplaceChoose\").addClass('hidden');\n        },\n\n\t\tshowTip: function(label) {\n\n\t\t\tlet originalTip = label.find(\".checkItemTip\");\n\n\t\t\t/* If no tip element or tip already shown */\n\t\t\tif(!originalTip.length || label.data(\"tip\"))\n\t\t\t    return;\n\n            let popup = label.closest(\".selectReplaceChoose\");\n            let tip = originalTip.clone().removeClass(\"hidden\").appendTo(\"body\");\n            tip.css({\n                left: popup.offset().left,\n                top : popup.offset().top + popup.outerHeight() + 5\n            });\n            label.data(\"tip\", tip);\n\n\n\t\t},\n\n        hideTip: function(label) {\n\t\t\tif(!label.data(\"tip\"))\n\t\t\t    return;\n            label.data(\"tip\").remove();\n            label.removeData(\"tip\");\n\t\t},\n\n        /**\n         * Shows drop down\n         * @param replace Input\n         */\n        drop: function (replace) {\n\n            /* Hide all */\n\t\t\t$(\".selectReplaceChoose\").addClass('hidden');\n\n            /* Get drop */\n            let popup = replace.next(),\n                dropOffset = (new visibleCalculator(replace)).getDropOffset(replace, popup.removeClass('hidden'));\n\n            /* If cant calculate offset */\n            if(!dropOffset) return;\n\n\t\t\tpopup.css({ marginLeft: dropOffset.left, marginTop: dropOffset.top });\n\n\t\t\tif(replace.outerWidth() > popup.outerWidth())\n\t\t\t\tpopup.css(\"width\", replace.outerWidth());\n\n\t\t\t/* Search focus */\n\t\t\tif (popup.find(\".search\").length)\n\t\t\t\tpopup.find(\".search input\").val('').focus();\n\n        },\n\n        change: function(element, event) {\n\n\t\t\t/* Get inputs */\n\t\t\tlet popup = element.closest(\".selectReplaceChoose\"),\n\t\t\t\tinputs = popup.find(\"input:radio, input:checkbox\"),\n\t\t\t\tcurrent, change, children = false, replace = popup.prev(),\n\t\t\t\tval = \"\";\n\n\t\t\tlet { defaultValue, defaultAllValue } = replace.data(\"defaults\");\n\n\t\t\t/* Un select all */\n\t\t\tpopup.find(\"label\").removeClass(\"selected\");\n\n            /* Get checked */\n\t\t\tlet filtered = inputs.filter(\":checked\").each(function() {\n\t\t\t\tcurrent = $(this);\n\t\t\t\tcurrent.closest(\"label\").addClass(\"selected\");\n\t\t\t\tchildren = current.next();\n\t\t\t\tval = (val && val + \", \") + children.text();\n\t\t\t});\n\n            /* Make text shorter */\n\t\t\tif(val.length > 26)\n\t\t\t\tval = val.substr(0, 26).trim() + \"...\";\n\n\t\t\t/* If all checked */\n\t\t\tif(filtered.length === inputs.length && !popup.hasClass(\"single\"))\n\t\t\t\tval = defaultAllValue;\n\n\t\t\t/* Set input html */\n\t\t\tif(popup.hasClass(\"single\") && children)\n\t\t\t\treplace.html('').prepend(children.clone().removeClass(\"name\"));\n\t\t\telse if(!children)\n\t\t\t\treplace.html(defaultValue);\n\t\t\telse\n\t\t\t\treplace.text(val);\n\n            /* If not fake event */\n\t\t\tif(event && current)\n\t\t\t\treplace.trigger(\"change\", { value: current.val(), item: element });\n\n\t\t\t/* Hide on single-select */\n\t\t\tif(popup.hasClass(\"single\"))\n\t\t\t\tpopup.addClass('hidden');\n\n        }\n\n    }\n});","sky.directive(\"select\", (select, attrs) => {\r\n\tlet options = attrs || {};\r\n\toptions.items = [];\r\n\tselect.find(\"option\").each(option => {\r\n\t\toptions.items.push({ html: option.html(), value: option.attr(\"value\") });\r\n\t});\r\n\tlet replace = sky.service(\"templates\").renderByText(\"{% import forms as forms %}{{ forms.selectReplace(options) }}\", { options: options });\r\n\treplace.replaceElement(select);\r\n});\r\nsky.directive(\".selectReplaceChoose\", (popup, attrs) => {\r\n\t\tlet replace = popup.prev();\r\n\t\treplace.data(\"defaults\", {\r\n\t\t\tdefaultValue: replace.html() || '-',\r\n\t\t\tdefaultAllValue: replace.text() || \"Все\"\r\n\t\t});\r\n\r\n\t\t/* Trigger */\r\n\t\tsetTimeout(function() { change(false) }, 1);\r\n\r\n});\r\n\r\nsky.onReady(() => {\r\n\t$(document).on(\"click touchstart\", function(event) {\r\n\r\n\t\t/* Get element */\r\n\t\tlet element = $(event.target || event.srcElement);\r\n\r\n\r\n\t\t/* If click in replace we should not hide it */\r\n\t\tif(element.closest(\".selectReplaceChoose\").length || element.closest(\".selectReplace\").length)\r\n\t\t\treturn;\r\n\r\n\t\t/* Hide all */\r\n\t\t$(\".selectReplaceChoose\").addClass('hidden');\r\n\r\n\t})\r\n});\r\n","/**\n * Fire services init done\n */\nsky.exec(function() {\n\tsky.servicesDeferred.resolve();\n});","sky.directive(\"input.autoHttp\", function(input) {\n\tinput.on(\"focus\", function() {\n\t\tif(input.val() === \"\") input.val(\"http://\").get(0).selectionStart = 7;\n\t});\n});","/**\n * Fire project init done\n */\nsky.exec(function() {\n    document.body.classList.remove(\"hidden\");\n    sky.projectDeffered.resolve();\n});"]}