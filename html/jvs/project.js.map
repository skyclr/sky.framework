{"version":3,"sources":["ajax/ajax.js","actions/actions.js","ajaxLoadingIndicator/ajaxLoadingIndicator.js","ajaxFiles/ajaxFiles.dropZone.js","ajaxFiles/ajaxFiles.iframe.js","ajaxFiles/ajaxFiles.js","ajaxFiles/ajaxFiles.xhr.js","calendar/calendar.js","dataOperator/dataOperator.js","dataOperator/inputsIO.js","dataOperator/searchField.js","callbacks/callback.js","callbacks/callbacks.js","drag/drag.js","localStorage/localStorage.js","models/models.js","models/modelsManager.js","models/modelsStorage.js","notifications/notifications.js","pagination/pagination-actions.js","pagination/pagination.js","stacklist/stacklist.js","suggester/suggester.js","directives/directives.js","templates/templates.js","supported/supported.js","utils/utils.js","tips/tips-actions.js","tips/tips-directives.js","tips/tips.js","validator/validator.js","visibleCalculator/visibleCalculator.js","history/history.js","windows/windows.js","selectReplace/actions/selectReplace.js","selectReplace/directives/select.js","suggester/actions/suggests.js","suggester/directives/suggests.js","servicesInit.js","shared.js","projectInit.js"],"names":["sky","service","callbacks","utils","url","data","object","callbackData","ajaxExtend","$","filter","disable","ajaxCallbacks","stop","ajax","abort","extend","dataType","type","timeout","success","response","textStatus","jqXHR","params","error","text","fire","safe","errorThrown","errorText","responseText","status","codes","code","promise","always","enable","exceptions","list","actions","perform","element","event","action","options","match","split","each","i","val","eval","trim","self","path","current","name","isDisabled","elem","length","system","Error","apply","concat","add","events","fn","selector","on","call","document","skyEvent","getAttribute","indexOf","preventDefault","map","parts","eventString","target","get","stackList","loadings","Loading","global","render","html","addClass","appendTo","click","hide","modal","content","holder","children","show","contentHolder","setHolder","calc","visibleCalculator","outerHeight","window","off","position","calculate","css","left","width","top","height","trigger","append","removeClass","remove","loading","supported","zone","files","XHRUpload","attachEvents","dragenter","dragleave","dragend","drop","dragover","originalEvent","isValidFileDrag","effect","dataTransfer","effectAllowed","dropEffect","bind","e","onStart","dt","isWebkit","navigator","userAgent","types","contains","AjaxFilesIFrame","input","prototype","getName","replace","cancel","id","onAbort","value","IFrame","setAttribute","send","fileName","clone","insertBefore","createIframe","form","createForm","attachLoadEvent","getIframeContentJSON","onSuccess","setTimeout","iframe","callback","load","parentNode","contentDocument","body","innerHTML","doc","contentWindow","onError","jQuery","parseJSON","console","log","src","Math","floor","random","queryString","param","method","enctype","attr","ajaxFilesXHR","ajaxFilesIFrame","AjaxFiles","inputs","saveFiles","file","push","inputName","parallel","_","handler","sendParallel","sendConsequentially","defaultSend","is","closest","find","templates","notifications","windows","filesAjax","getLast","currentFile","lock","insertAfter","parent","unlock","clearExceptTemplate","message","appendToModal","totalPercent","percent","toProceed","inProgress","total","totalLoaded","totalSize","fileRequests","size","loaded","args","formData","FormData","processData","contentType","xhr","XMLHttpRequest","upload","toFixed","onProgress","undefined","beforeSend","func","setRequestHeader","encodeURI","all","notSuccess","delete","fileRequestData","request","calendar","monthsNames","page","renderDays","moment","date","weeks","currentWeek","month","day","number","isoWeek","days","dateStr","format","dates","period","since","till","setTime","dayPick","dayDiv","notClose","parseInt","field","getInputValue","close","useTime","isSame","setDayPick","pickedDateView","calculator","offset","getDropOffset","marginTop","marginLeft","periodChangeDay","reset","lastModified","isBefore","isAfter","markSelected","changeDay","hour","minute","changeYear","year","yearView","changeMonth","monthView","getDatePeriod","dateString","getDate","showTime","subtract","dateOriginal","elementFromPoint","clientX","touches","clientY","onReady","srcElement","parents","keyCode","calendars","searchField","ajaxLoadingIndicator","baseOptions","fields","historyType","DataOperator","lastRequestData","beforeRequest","setOptions","onFormSubmit","validForm","force","getById","reload","history","set","search","fromUrl","readSearch","writeForm","readHash","read","isObjectsEqual","writeURI","prepareRequest","lastResponse","reloadContent","virtual","item","fieldsList","valueOrNullOnDefault","write","hashRead","searchRead","fieldName","substring","default","initOperator","initLoader","loader","pagination","pages","onPageChange","pageNum","searchChanged","hashChanged","readInputValue","readInputsValues","valuesNamed","valuesLined","writeInputValue","prop","writeInputsValue","first","notByUser","values","Array","inputsIO","hashValue","hashObject","searchValue","searchObject","Callback","flags","functions","toRun","context","once","removeByContext","splice","removeByCallback","fireNext","result","Callbacks","advancedCallbacks","callbacksFlags","removeListener","listener","Object","getEventsNames","next","slice","possible","names","elements","j","join","bindEvents","start","move","started","button","x","pageX","y","pageY","LocalStorage","items","getItems","localStorage","getItem","storage","setItem","JSON","stringify","modelsStorage","modelsDefinition","Model","definition","BaseDefinition","creation","extension","changed","model","addDefinition","fromData","cached","Manager","arr","fromArray","cache","tips","Message","align","Tip","create","findInElement","setPage","goToPage","scrollTo","scroll","grab","runner","previous","Pagination","arrows","pageWidth","dimensions","startPage","pagesVisible","pagesInvisible","scrollAvailable","scrollStart","tumbler","dom","slider","back","forward","redraw","newPage","innerWidth","toShow","drawPages","createScroll","scrollLine","outerWidth","isVisible","pos","List","lastId","last","index","hasOwnProperty","single","suggester","lastList","removeData","elementPosition","renderPosition","selected","prev","directives","directive","getAttributes","attributes","nodeName","nodeValue","parseElement","jsonScript","json","parse","parseDirectives","templatesList","templatesCompiled","Templates","globals","template","save","cookie","renderByNameWithHolder","noDirectives","compile","coverWithHolder","renderByTextWithHolder","Twig","twig","temp","createElement","childNodes","renderToText","renderByText","renderByTextToText","compiled","fromLS","attrs","fullScreen","arguments","second","key","addLeadingZero","encode","rawStr","charCodeAt","jsonData","prepareSelectData","columnSplitOn","maxColumns","columns","columnsCount","groupHolder","perColumn","ceil","column","groups","showTip","hideTips","tip","showTipWithText","hideAll","forceHideTips","tipName","tipText","withoutAutoHide","caller","autoHide","highlight","className","shadow","opacity","background","closeTimeout","display","animate","fadeOut","fadeIn","blur","clearTimeout","what","validator","validateForm","validationRule","addRule","validateElement","pass","shouldBeValidated","Options","totalPass","lastError","firstError","lastSuccess","firstSuccess","rules","ruleOverload","compiledRule","Rule","validate","rule","ruleDefaults","optionsDefaults","errorClass","successClass","overload","required","requiredIfFilled","email","same","regexp","RegExp","numeric","positive","parseFloat","max","min","minLength","maxLength","getDeclaredRules","Calculator","minHeight","scrollable","init","holderRect","scrollTop","windowHeight","windowWidth","sizes","right","realHeight","bottom","scrollLeft","popup","popupInnerWidth","popupWidth","popupHeight","win","replaceOffset","popupOffset","leftDifference","topDifference","middle","visible","getObjectsDifference","difference","localDiff","returnArray","History","hashString","searchString","pathString","intervalId","base","navigate","location","pathname","substr","pushState","oldPath","newPath","getWindowSearch","hash","change","hashDifference","searchDifference","old","getWindowHash","getDifference","rebuild","pathChanged","setHash","setSearch","decodeURIComponent","proxy","stringFromObject","obj","getObjects","paramsString","objects","subStrings","str","keyAndValue","string","stored","decodeURI","onpopstate","setInterval","time","Modal","modalAjax","locked","dataContainer","closeButton","reRender","detach","innerHeight","byUser","which","stopPropagation","rus","eng","expression","toLowerCase","expressionInvert","character","hasClass","inputHtml","selectAll","unSelectAll","label","originalTip","hideTip","dropOffset","focus","defaultValue","defaultAllValue","filtered","prepend","select","option","checked","replaceElement","adverts","suggestAjax","advert","username","campaigns","campaign","campaignsSpecial","exec","servicesDeferred","resolve","closeWindow","submit","clearForm","changeOrder","orderField","order","table","trs","cell1","cell2","convert","sort","firstTr","secondTr","buttonTr","val1","val2","isNaN","changeOrderReload","currentLoader","selectionStart","classList","projectDeffered"],"mappings":"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","file":"project.js","sourcesContent":["sky.service(\"ajax\", [\"callbacks\", \"utils\"], function({ callbacks, utils }) {\n\n\t/**\n\t * Advanced ajax execution\n\t * To abort call stop() method instead of abort() because it's used for abort callback set, or .ajax.abort()\n\t * You may skip type, don't skip it if lock is string set false in object and data\n\t * @param {string} url\t\t\t\tRequested url\n\t * @param {object} [data]\t\t\tHolds request parameters\n\t * @param {jQuery} [object]\t\t\tObject which performs request, to disable it during request\n\t * @param {object} [ajaxExtend]\t\tAdditional ajax options, see http://api.jquery.com/jQuery.ajaxSetup/\n\t * @param {object} [callbackData]\tAdditional params that passed to any callback\n\t */\n\tthis.service = function(url, data = {}, { object = null, callbackData = {}, ajaxExtend = {} } = {}) {\n\n\t\t/* Lock button */\n\t\tif(object)\n\t\t\tobject = $(object).filter(\":not(.disabled)\").disable();\n\n\t\t/* New object to store callbacks */\n\t\tlet ajaxCallbacks = new callbacks();\n\t\tajaxCallbacks.stop = function() { ajaxCallbacks.ajax.abort(); };\n\n\t\t/* Perform ajax request */\n\t\tajaxCallbacks.ajax = $.ajax(utils.extend(true, {\n\n\t\t\t/* Set base options */\n\t\t\turl     \t: url,\n\t\t\tdata    \t: data,\n\t\t\tdataType\t: \"json\",\n\t\t\ttype    \t: \"post\",\n\t\t\ttimeout\t\t: 480 * 1000,\n\t\t\tsuccess: function(response, textStatus, jqXHR) {\n\n\t\t\t\t/* Possible params list */\n\t\t\t\tlet params = utils.extend({ jqXHR: jqXHR, textStatus: textStatus, object: object }, callbackData);\n\n\t\t\t\t/* If empty response */\n\t\t\t\tif(response === null) {\n\t\t\t\t\tparams.error = \"Данные небыли переданы\";\n\t\t\t\t\tparams.type = \"noData\";\n\t\t\t\t}\n\n\t\t\t\t/* If response returned with error */\n\t\t\t\tif(response.error) {\n\t\t\t\t\tparams.error = 'Request error: ' + response.text;\n\t\t\t\t\tparams.type = \"php\";\n\t\t\t\t}\n\n\t\t\t\t/* If error type set */\n\t\t\t\tif(params.type)\n\t\t\t\t\treturn ajaxCallbacks.fire(\"notSuccess, error\", params); // No data\n\n\t\t\t\t/* Set response in possible params */\n\t\t\t\tparams.response = params.data = response;\n\n\t\t\t\t/* User success function */\n\t\t\t\treturn ajaxCallbacks.fire(\"preSuccess, success, notAbort\", params);\n\n\t\t\t}.safe(),\n\t\t\terror: function(jqXHR, textStatus, errorThrown) {\n\n\t\t\t\t/* Defaults */\n\t\t\t\tlet type        = \"Unknown\",\n\t\t\t\t\terrorText   = \"Во время выполнения запроса произошла ошибка, пожалуйста попробуйте позже\";\n\n\t\t\t\t/* Get error text according to response data */\n\t\t\t\tif(textStatus === \"abort\") {\n\t\t\t\t\ttype \t  = \"abort\";\n\t\t\t\t\terrorText = 'Выполнение запроса прервано';\n\t\t\t\t} else if(textStatus === 'parsererror') {\n\t\t\t\t\ttype \t  = \"parse\";\n\t\t\t\t\terrorText = \"Ответ пришел в неверном формате, пожалуйста попробуйте позже, текст:<br/>\" + jqXHR.responseText;\n\t\t\t\t} else if(textStatus === 'timeout') {\n\t\t\t\t\ttype \t  = \"timeout\";\n\t\t\t\t\terrorText = 'Время ожидания ответа истекло';\n\t\t\t\t} else if(jqXHR.status === 0) {\n\t\t\t\t\ttype \t  = \"stopped\";\n\t\t\t\t\terrorText = 'Загрузка остановлена, проверьте свои настройки сети';\n\t\t\t\t} else if(codes[jqXHR.status]) {\n\t\t\t\t\ttype = jqXHR.status;\n\t\t\t\t\terrorText = 'Ошибка во времы выполнения запроса <br/> ' + codes[jqXHR.status];\n\t\t\t\t}\n\n\t\t\t\t/* Possible params list */\n\t\t\t\tlet params = utils.extend({\n\t\t\t\t\terror      : 'Request error: ' + errorText,\n\t\t\t\t\ttype       : type,\n\t\t\t\t\tcode\t   : type,\n\t\t\t\t\tjqXHR      : jqXHR,\n\t\t\t\t\ttextStatus : textStatus,\n\t\t\t\t\tstatus     : textStatus,\n\t\t\t\t\terrorThrown: errorThrown,\n\t\t\t\t\tobject     : object\n\t\t\t\t}, callbackData);\n\n\t\t\t\t/* Execute callback */\n\t\t\t\tajaxCallbacks.fire(\"notSuccess\", params);\n\n\t\t\t\t/* Execute special ajaxCallbacks */\n\t\t\t\tajaxCallbacks.fire(textStatus === \"abort\" ? \"abort\" : \"error, notAbort\", params);\n\n\t\t\t}.safe()\n\n\t\t}, ajaxExtend));\n\n\t\t/* On always set */\n\t\tajaxCallbacks.ajax.promise().always(function(jqXHR, textStatus, errorThrown) {\n\n\t\t\t/* Unlock objects */\n\t\t\tif(object)\n\t\t\t\tobject.enable();\n\n\t\t\t/* Always callback */\n\t\t\tajaxCallbacks.fire(\"always\", { errorThrown: errorThrown, textStatus: textStatus, jqXHR: jqXHR, object: object});\n\n\t\t}.safe());\n\n\t\treturn ajaxCallbacks;\n\n\t};\n\n\t/**\n\t * Contains http codes\n\t */\n\tlet codes = {\n\n\t\t/* Request errors */\n\t\t400: \"Неверный запрос\",\n\t\t401: \"Для выполнеия запроса нужня авторизация\",\n\t\t402: \"Для доступа к ресурсу необходима оплата\",\n\t\t403: \"Доступ к ресурсу запрещен\",\n\t\t404: \"Сервер для выполнения запроса не найден или запрос выполнялся слишком долго\",\n\t\t405: \"Не поддерживаемый метод HTTP\",\n\t\t406: \"Не приемлемо\",\n\t\t407: \"Необходима аутентификация прокси\",\n\t\t408: \"Истекло время ожидания\",\n\t\t409: \"Конфликт\",\n\t\t410: \"Ресурс удален\",\n\t\t411: \"В запросе не указана длинна\",\n\t\t412: \"Условие ложно\",\n\t\t413: \"Размер запроса слишком велик\",\n\t\t414: \"Запрашиваемый URI слишком длинный\",\n\t\t415: \"Неподдерживаемый тип данных\",\n\t\t416: \"Запрашиваемый диапазон не достижим\",\n\t\t417: \"Ожидаемое неприемлемо\",\n\t\t422: \"Необрабатываемый экземпляр\",\n\t\t423: \"Ресурс заблокирован\",\n\t\t424: \"Невыполненная зависимость\",\n\t\t425: \"Неупорядоченный набор\",\n\t\t426: \"Необходимо обновление\",\n\t\t428: \"Необходимо предусловие\",\n\t\t429: \"Слишком много запросов\",\n\t\t431: \"Поля заголовка запроса слишком большие\",\n\t\t451: \"Недоступно по юридическим причинам\",\n\t\t456: \"Некорректируемая ошибка\",\n\t\t499: \"Используется Nginx, соединение закрыто до получения ответа\",\n\n\t\t/* Server error */\n\t\t500: \"Внутренняя ошибка сервера\",\n\t\t501: \"Не реализовано\",\n\t\t502: \"Плохой или ошибочный шлюз\",\n\t\t503: \"Сервис недоступен\",\n\t\t504: \"Шлюз не отвечает\",\n\t\t505: \"Версия HTTP не поддерживается\",\n\t\t506: \"Вариант тоже проводит согласование\",\n\t\t507: \"Переполнение хранилища\",\n\t\t508: \"Запрос зациклен\",\n\t\t509: \"Исчерпана пропускная ширина канала\",\n\t\t510: \"Не расширено\",\n\t\t511: \"Требуется сетевая аутентификация\"\n\n\t};\n\n});","sky.service(\"actions\", [\"exceptions\"], function ({exceptions}) {\n\n\tlet list = {},\n\t\tactions = this.service = {\n\n\t\t\t/**\n\t\t\t * Performs action\n\t\t\t * @param element\n\t\t\t * @param event\n\t\t\t * @param action\n\t\t\t * @param {Array} [options]\n\t\t\t */\n\t\t\tperform: function (element, event, action, options) {\n\n\t\t\t\t/* Get parameters */\n\t\t\t\tlet params = action.match(/(.+)\\((.*)\\)/);\n\n\t\t\t\t/* Parse */\n\t\t\t\tif (params) {\n\n\t\t\t\t\t/* Get function */\n\t\t\t\t\taction = params[1];\n\n\t\t\t\t\t/* Parse params */\n\t\t\t\t\tparams = params[2].split(\",\");\n\t\t\t\t\t$.each(params, function (i, val) {\n\t\t\t\t\t\tparams[i] = eval(val.trim());\n\t\t\t\t\t})\n\t\t\t\t}\n\n\t\t\t\t/* Options */\n\t\t\t\tif (options)\n\t\t\t\t\tparams = $.extend(params || [], options);\n\n\t\t\t\t/* Get */\n\t\t\t\tlet self = element ? $(element) : false,\n\t\t\t\t\tpath = action.split(\".\"),\n\t\t\t\t\tcurrent = list,\n\t\t\t\t\tname = action;\n\n\t\t\t\t/* If disabled */\n\t\t\t\tif (self && self.isDisabled && self.isDisabled())\n\t\t\t\t\treturn;\n\n\t\t\t\t$.each(path, function (i, elem) {\n\n\t\t\t\t\t/* Search */\n\t\t\t\t\tif (i + 1 < path.length && !current[elem])\n\t\t\t\t\t\tthrow new exceptions.system.Error(\"No action - \" + action + \", because can't find '\" + elem + \"'\");\n\n\t\t\t\t\t/* Get new elem */\n\t\t\t\t\tif (i + 1 < path.length)\n\t\t\t\t\t\tcurrent = current[elem];\n\n\t\t\t\t\t/* Save name */\n\t\t\t\t\tname = elem;\n\n\t\t\t\t});\n\n\t\t\t\t/* If no */\n\t\t\t\tif (!current[name])\n\t\t\t\t\tthrow new exceptions.system.Error(\"No action - \" + action);\n\n\t\t\t\t/* Call */\n\t\t\t\tcurrent[name].apply(current, [self, event].concat(params || []));\n\n\t\t\t},\n\n\t\t\t/**\n\t\t\t * Adds actions to list\n\t\t\t * @param name Group name\n\t\t\t * @param events List\n\t\t\t */\n\t\t\tadd: function (name, events) {\n\n\t\t\t\tif (typeof events === \"function\")\n\t\t\t\t\tevents = events.safe(true)();\n\n\t\t\t\t// Check\n\t\t\t\tif (!events || typeof events !== 'object')\n\t\t\t\t\tthrow new exceptions.system.Error(\"No event object for events '\" + name + \"' provided\");\n\n\t\t\t\t// Save\n\t\t\t\tlist[name] = $.extend(list[name] || {}, events);\n\n\t\t\t}\n\n\t\t};\n\n\n\t/**\n\t * Adds special bind function\n\t * @param {string} name Event name\n\t * @param {*} selector Selector string\n\t * @param {function} [action] Action function\n\t * @returns {jQuery}\n\t */\n\t$.fn.action = function(name, selector, action) {\n\n\t\t/* Parameters skip */\n\t\tif(typeof action === \"undefined\") { action = selector; selector = null; }\n\n\t\t/* Bind */\n\t\treturn this.on(name, selector, function(event, data) {\n\t\t\taction.call(this, event, $(this), data);\n\t\t}.safe());\n\t};\n\n\t/*\n\t * Bind declarative events\n\t */\n\t$(document).action(\"click submit keyup keydown dblclick mouseover mouseout mouseleave mouseenter change mousedown mouseup touchstart\", '[data-event]', function (event, self, data) {\n\n\t\t/* Get string */\n\t\tlet skyEvent = this.getAttribute(\"data-event\");\n\n\t\t/* If no such event in data-event attribute */\n\t\tif (skyEvent.indexOf(event.type) === -1)\n\t\t\treturn;\n\n\t\t/* If disabled */\n\t\tif (self.isDisabled && self.isDisabled()) {\n\t\t\tevent.preventDefault();\n\t\t\treturn;\n\t\t}\n\n\t\tskyEvent.split(\";\").map(eventString => {\n\n\t\t\t/* Get elements */\n\t\t\tlet parts = eventString.match(/(\\w+):(.*)/);\n\n\t\t\t/* Wrong */\n\t\t\tif (parts.length !== 3)\n\t\t\t\tthrow new exceptions.system.Error(\"Wrong action format in data-event: \" + eventString);\n\n\t\t\t/* Get elements */\n\t\t\tlet name = parts[1].trim(),\n\t\t\t\taction = parts[2].trim();\n\n\t\t\t/* Another event */\n\t\t\tif (name !== event.type)\n\t\t\t\treturn;\n\n\t\t\t/* No default go */\n\t\t\tif (event.target === self.get(0))\n\t\t\t\tevent.preventDefault();\n\n\t\t\t/* Passed data */\n\t\t\tevent.data = data;\n\n\t\t\t/* Perform action */\n\t\t\tactions.perform(this, event, action);\n\n\t\t});\n\n\t});\n\n});","sky.service(\"ajaxLoadingIndicator\", [\"stackList\", \"callbacks\"], function({ stackList, callbacks }) {\n\n\tlet loadings = stackList();\n\n\t/**\n\t * Loading\n\t */\n\tclass Loading {\n\t\tconstructor({ ajax = false, global = true} ) {\n\n\t\t\t/* List save */\n\t\t\tloadings.add(this);\n\n\t\t\t/* Back link */\n\t\t\tthis.global = global;\n\n\t\t\t/* Render */\n\t\t\tthis.render = $('<div/>').html('<div></div>').addClass(\"ajaxLoading\");\n\n\t\t\t/* Global insert */\n\t\t\tif(this.global)\n\t\t\t\tthis.render.addClass(\"fixed\").appendTo(\"body\");\n\n\t\t\t/* If stop possible */\n\t\t\tif(ajax) {\n\t\t\t\t$(\"<span/>\").appendTo(this.render.addClass(\"cancelable\")).click(function() {\n\t\t\t\t\tajax.stop();\n\t\t\t\t});\n\t\t\t\tajax.on(\"always\", () => this.hide());\n\t\t\t}\n\n\t\t\t/* Callbacks */\n\t\t\tthis.events = callbacks();\n\n\t\t}\n\n\t\t/**\n\t\t * Loads loading in modal window\n\t\t * @param {object} modal Window\n\t\t */\n\t\tinModalWindow(modal) {\n\n\t\t\t/* Hide */\n\t\t\tlet content = modal.holder.children().hide();\n\n\t\t\t/* Insert */\n\t\t\tthis.render.appendTo(modal.holder);\n\n\t\t\t/* Restore on hide */\n\t\t\tthis.events.on(\"hide\", () => content.show());\n\n\t\t}\n\n\t\t/**\n\t\t *\n\t\t * @param contentHolder\n\t\t */\n\t\treloadContent(contentHolder) {\n\n\t\t\tthis.setHolder(contentHolder);\n\n\t\t\t/* If no holder */\n\t\t\tif(!this.holder.length)\n\t\t\t\treturn;\n\n\t\t\t/* Get children */\n\t\t\tlet content = this.holder.children();\n\n\t\t\t/* Different content disable */\n\t\t\tif(this.global) {\n\n\t\t\t\t/* Disable content */\n\t\t\t\tcontent.disable();\n\n\t\t\t\t/* Make sizes calculator */\n\t\t\t\tthis.calc = visibleCalculator(contentHolder, this.render.outerHeight(), \"body\");\n\n\t\t\t\t/* Re enable */\n\t\t\t\tthis.events.on(\"hide\", () => {\n\t\t\t\t\tcontent.enable();\n\t\t\t\t\t$(window).off(\"scroll.notification\");\n\t\t\t\t});\n\n\t\t\t\t/* Bind scroll handler */\n\t\t\t\t$(window).on(\"scroll.notification\", () => {\n\t\t\t\t\tlet position = this.calc.calculate();\n\t\t\t\t\tthis.render.css({\n\t\t\t\t\t\tleft: position.left + (position.width) / 2,\n\t\t\t\t\t\ttop : position.top + (position.height) / 2\n\t\t\t\t\t})\n\t\t\t\t}).trigger(\"scroll\");\n\n\t\t\t} else {\n\n\t\t\t\t/*  Hide */\n\t\t\t\tcontent.hide();\n\n\t\t\t\t/* Insert */\n\t\t\t\tthis.render.appendTo(this.holder);\n\n\t\t\t\t/* Re enable */\n\t\t\t\tthis.events.on(\"hide\", function() {\n\t\t\t\t\tcontent.show();\n\t\t\t\t});\n\t\t\t}\n\n\t\t\treturn this;\n\n\t\t}\n\n\t\tsetHolder(holder) {\n\n\t\t\t/* Append and save */\n\t\t\tthis.holder = $(holder).addClass(\"withLoading\").append(this.render);\n\n\t\t\t/* Self return */\n\t\t\treturn this;\n\n\t\t}\n\n\t\t/**\n\t\t * Hides current loading\n\t\t */\n\t\thide() {\n\n\t\t\tif(this.holder)\n\t\t\t\tthis.holder.removeClass(\"withLoading\");\n\n\t\t\tthis.render.remove();\n\t\t\tthis.events.fire(\"hide\");\n\n\t\t\t/* Remove from list */\n\t\t\tloadings.remove(this);\n\n\t\t}\n\t}\n\n\tthis.service = {\n\t\tloading: (ajax = false, global = true) => new Loading({ ajax, global }),\n\t}\n\n});","/** Class to work with drop zone for File api */\nsky.service(\"ajaxFilesDropZone\", [\"supported\", \"callbacks\"], function({ supported, callbacks }) {\n\tthis.service = class {\n\t\tconstructor({ zone, data, url, options }) {\n\n\t\t\t/* Save options */\n\t\t\tthis.options   = options;\n\t\t\tthis.zone      = zone;\n\t\t\tthis.callbacks = callbacks();\n\t\t\tthis.data      = data;\n\t\t\tthis.url       = url;\n\t\t\tthis.files     = [];\n\n\t\t\t/* If no XHR supported, no file drop needed */\n\t\t\tif(!supported.XHRUpload) {\n\t\t\t\tthis.callbacks.fire(\"nonSupported\");\n\t\t\t\treturn this;\n\t\t\t}\n\n\t\t\t/* Bind events */\n\t\t\tthis.attachEvents();\n\n\t\t}\n\n\t\tattachEvents() {\n\n\t\t\t/* While over event */\n\t\t\tthis.zone.on({\n\n\t\t\t\tdragenter: (event) => { this.callbacks.fire(\"dragenter\", this, [event]); },\n\t\t\t\tdragleave: (event) => { this.callbacks.fire(\"dragleave\", this, [event]); },\n\t\t\t\tdragend  : (event) => { this.callbacks.fire(\"dragend\", this, [event]); \t },\n\t\t\t\tdrop     : (event) => { this.callbacks.fire(\"drop\", this, [event]);\t\t },\n\t\t\t\tdragover : (event) => {\n\n\t\t\t\t\t/* Get event */\n\t\t\t\t\tevent = event.originalEvent;\n\n\t\t\t\t\t/* Check if drag is valid */\n\t\t\t\t\tif(!this.isValidFileDrag(event))\n\t\t\t\t\t\treturn;\n\n\t\t\t\t\t/* Get effect */\n\t\t\t\t\tlet effect = event.dataTransfer.effectAllowed;\n\n\t\t\t\t\t/* Set proper */\n\t\t\t\t\tif(effect === 'move' || effect === 'linkMove') {\n\t\t\t\t\t\tevent.dataTransfer.dropEffect = 'move'; // for FF (only move allowed)\n\t\t\t\t\t} else {\n\t\t\t\t\t\tevent.dataTransfer.dropEffect = 'copy'; // for Chrome\n\t\t\t\t\t}\n\n\t\t\t\t\t/* Prevent */\n\t\t\t\t\tevent.preventDefault();\n\n\t\t\t\t}\n\t\t\t});\n\n\t\t\t/* Stop file opening when drop on browser window */\n\t\t\t$(document).bind({\n\t\t\t\tdragover : function(e) {\n\t\t\t\t\te = e.originalEvent;\n\t\t\t\t\tif(e.dataTransfer) {\n\t\t\t\t\t\te.dataTransfer.dropEffect = 'none';\n\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tdragenter: function(e) {\n\t\t\t\t\tif(typeof self.options.onStart !== \"undefined\")\n\t\t\t\t\t\tself.options.onStart.apply(self, [e]);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tstatic isValidFileDrag(event) {\n\n\t\t\tlet dt = event.dataTransfer,\n\t\t\t// do not check dt.types.contains in webkit, because it crashes safari 4\n\t\t\t\tisWebkit = navigator.userAgent.indexOf(\"AppleWebKit\") > -1;\n\n\t\t\t// dt.effectAllowed is none in Safari 5\n\t\t\t// dt.types.contains check is for firefox\n\t\t\treturn dt && dt.effectAllowed !== 'none' &&\n\t\t\t\t(dt.files || (!isWebkit && dt.types.contains && dt.types.contains('Files')));\n\n\t\t}\n\n\t};\n\n});","sky.service(\"ajaxFilesIFrame\", function() {\n\n\tlet AjaxFilesIFrame = function(options) {\n\n\t\t/* Save options */\n\t\tthis.options \t= options;\n\t\tthis.files    \t= options.files;\n\t\tthis.input   \t= options.input;\n\t\tthis.url  \t \t= options.url;\n\t\tthis.data \t \t= options.data;\n\t\tthis.callbacks \t= options.callbacks;\n\n\t};\n\n\tAjaxFilesIFrame.prototype = {\n\n\t\tgetName: function(name){\n\n\t\t\t// get input value and remove path to normalize\n\t\t\treturn name.replace(/.*(\\/|\\\\)/, \"\");\n\n\t\t},\n\n\t\tcancel: function(id){\n\n\t\t\tthis.options.onAbort(id, this.getName(this.input.value));\n\n\t\t\tthis.IFrame.setAttribute('src', 'javascript:false;').remove();\n\n\t\t},\n\n\t\t/**\n\t\t * Upload file function\n\t\t */\n\t\tsend: function() {\n\n\t\t\t/* letiables */\n\t\t\tlet self \t = this;\n\t\t\tlet input \t = this.input;\n\t\t\tlet fileName = this.getName(input.value);\n\n\t\t\t/* Create new input */\n\t\t\t$(input).clone().val(\"\").insertBefore(input);\n\n\t\t\t/* Create elements */\n\t\t\tthis.IFrame = this.createIframe();\n\t\t\tthis.form = this.createForm(this.IFrame, this.options.data).append(input);\n\n\t\t\tthis.attachLoadEvent(this.IFrame, function() {\n\n\t\t\t\tlet response = self.getIframeContentJSON(self.IFrame);\n\n\t\t\t\tif(response) self.options.onSuccess(response);\n\n\t\t\t\t// timeout added to fix busy state in FF3.6\n\t\t\t\tsetTimeout(function(){ self.IFrame.remove(); }, 1);\n\n\t\t\t});\n\n\t\t\tthis.form.trigger(\"submit\");\n\n\t\t},\n\n\t\t/**\n\t\t * Attach load event to IFrame\n\t\t */\n\t\tattachLoadEvent: function(iframe, callback){\n\n\t\t\tiframe.load(function(){\n\n\t\t\t\tif (!this.parentNode) return;\n\n\t\t\t\t// fixing Opera 10.53\n\t\t\t\tif (this.contentDocument &&\n\t\t\t\t\tthis.contentDocument.body &&\n\t\t\t\t\tthis.contentDocument.body.innerHTML === \"false\") return;\n\n\t\t\t\tcallback();\n\n\t\t\t});\n\n\t\t},\n\n\t\t/**\n\t\t * Returns json object received by IFrame from server.\n\t\t */\n\t\tgetIframeContentJSON: function(iframe){\n\n\t\t\t/* IFrame.contentWindow.document - for IE<7 */\n\t\t\tlet doc = iframe.get(0).contentDocument ? iframe.get(0).contentDocument: iframe.get(0).contentWindow.document;\n\n\t\t\tlet response = doc.body.innerHTML\n\n\t\t\t/* Check for empty response */\n\t\t\tif(response === \"\") {\n\t\t\t\tif(self.callbacks) self.callbacks.onError(\"Данные небыли переданы\"); // No data\n\t\t\t\treturn false;\n\t\t\t}\n\n\n\t\t\t/* Try to get json data */\n\t\t\ttry {\n\t\t\t\tresponse = jQuery.parseJSON(response);\n\t\t\t} catch(e) {\n\t\t\t\tif(self.callbacks) {\n\t\t\t\t\tself.callbacks.onError(\"Неверный формат данных\"); // No data\n\t\t\t\t\tconsole.log(response);\n\t\t\t\t}\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\t/* If response returned with error */\n\t\t\tif(response.error) {\n\t\t\t\tif(self.callbacks) self.callbacks.onError(response.text); // Execute user error handler\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\treturn response;\n\t\t},\n\n\t\t/**\n\t\t * Creates IFrame with unique name\n\t\t */\n\t\tcreateIframe: function() {\n\n\t\t\treturn $('<IFrame/>', { src: \"javascript:false;\", name: \"uploadIFrame\" + Math.floor(Math.random()*1000000) }).css(\"display\", \"none\").appendTo('body');\n\n\t\t},\n\n\t\t/**\n\t\t * Creates form, that will be submitted to IFrame\n\t\t */\n\t\tcreateForm: function(iframe, params) {\n\n\t\t\tlet queryString = this.url + \"?\" + jQuery.param(params);\n\n\t\t\treturn $('<form/>', {\n\t\t\t\tmethod: \"post\", enctype: \"multipart/form-data\", action: queryString, target: iframe.attr(\"name\")\n\t\t\t}).css(\"display\", \"none\").appendTo('body');\n\n\t\t}\n\n\t};\n\n});","/**\n * Module to work with ajax file upload\n */\nsky.service(\"ajaxFiles\", [\"supported\", \"callbacks\", \"ajaxFilesXHR\", \"ajaxFilesIFrame\"], function({ callbacks, supported, ajaxFilesXHR, ajaxFilesIFrame }) {\n\n\t/**\n\t * Class to work with dynamic file upload\n\t * @param {html|string} input Input to be used to upload\n\t * @param {string} url Url to upload\n\t * @param {object} data Data to be send with request\n\t */\n\tlet AjaxFiles = this.service = function(input, url, data) {\n\n\t\t/* Self construct */\n\t\tif(!(this instanceof AjaxFiles))\n\t\t\treturn new AjaxFiles(input, url, data);\n\n\t\t/* Save items */\n\t\tthis.inputs \t= $(input);\n\t\tthis.url   \t\t= url;\n\t\tthis.data  \t\t= data;\n\t\tthis.callbacks \t= callbacks();\n\t\tthis.files\t\t= [];\n\n\t\t/**\n\t\t * Function to handle file input change\n\t\t */\n\t\tthis.saveFiles = function(input) {\n\n\t\t\t/* Get files list */\n\t\t\tif(supported.XHRUpload) {\n\n\t\t\t\t/* Get files from event */\n\t\t\t\tlet files = input.get(0).files;\n\n\t\t\t\t/* Save them to this */\n\t\t\t\tfor(let file of files)\n\t\t\t\t\tthis.files.push({ file: file, input: input, inputName: input.attr(\"name\") });\n\n\t\t\t} else this.files.push(input.get(0));\n\n\t\t};\n\n\t\t/**\n\t\t * Sends ajax files\n\t\t * @param {bool} parallel If try files would be send in parallel\n\t\t * @returns {*}\n\t\t */\n\t\tthis.send = function(parallel) {\n\n\t\t\t/* Clear */\n\t\t\tthis.files = [];\n\n\t\t\t/* Get files list */\n\t\t\tthis.inputs.each((_, input) => { this.saveFiles($(input)); });\n\n\t\t\t/* If no files */\n\t\t\tif(!this.files.length)\n\t\t\t\treturn false;\n\n\t\t\t/* Create supported handler */\n\t\t\tlet handler;\n\t\t\tif(supported.XHRUpload)\n\t\t\t\thandler = new ajaxFilesXHR(this);\n\t\t\telse\n\t\t\t\thandler = new ajaxFilesIFrame(this);\n\n\t\t\t/* Send files */\n\t\t\tif(parallel)\n\t\t\t\tthis.sendParallel(handler);\n\t\t\telse\n\t\t\t\tthis.sendConsequentially(handler);\n\n\t\t\t/* return send handler */\n\t\t\treturn handler;\n\n\t\t};\n\n\t\t/**\n\t\t * Sends files consequentially\n\t\t * @param handler\n\t\t */\n\t\tthis.sendConsequentially = function(handler) {\n\n\t\t\t/* First id */\n\t\t\tlet id = 0;\n\n\t\t\t/* Set sending next after this one */\n\t\t\tthis.callbacks.on(\"always\", () => {\n\t\t\t\tid++;\n\t\t\t\tif(this.files[id])\n\t\t\t\t\thandler.send(this.files[id]);\n\t\t\t});\n\n\t\t\t/* Send first */\n\t\t\thandler.send(self.files[id]);\n\n\t\t};\n\n\t\t/**\n\t\t * Sends files parallel\n\t\t * @param handler\n\t\t */\n\t\tthis.sendParallel = function(handler) {\n\n\t\t\t/* Send files through them */\n\t\t\tfor(let file of this.files)\n\t\t\t\thandler.send(file);\n\n\t\t};\n\n\t\t/* Self return */\n\t\treturn this;\n\n\t};\n\n\t/**\n\t * Performs default file send\n\t * @param {string} url\n\t * @param element\n\t * @param data\n\t */\n\tAjaxFiles.defaultSend = function(url, element, data) {\n\n\t\t// Get input\n\t\tlet input = element.is(\"input[type=file]\") ? element : element.closest(\"label, .label\").find(\"input[type=file]\"),\n\t\t\texceptions = sky.service(\"exceptions\"),\n\t\t\ttemplates = sky.service(\"templates\"),\n\t\t\tnotifications = sky.service(\"notifications\"),\n\t\t\twindows = sky.service.windows(\"windows\");\n\n\t\t// Check\n\t\tif(!input.length)\n\t\t\tthrow new exceptions.system.Error(\"No proper input provided for file send\");\n\n\t\t// Init\n\t\tlet filesAjax = AjaxFiles(input, url, data),\n\t\t\tmodal = windows.getLast(),\n\t\t\tcurrentFile;\n\n\t\t/*  Bind events */\n\t\tfilesAjax.callbacks\n\t\t\t.on(\"begin\", function (file) {\n\t\t\t\tif(modal) {\n\t\t\t\t\tmodal.holder.find(\".preview\").remove();\n\t\t\t\t\tmodal.lock();\n\t\t\t\t}\n\t\t\t\tcurrentFile = templates.render(\"files-single-upload\", file).insertAfter(element.parent());\n\t\t\t})\n\t\t\t.on(\"always\", function () {\n\t\t\t\tcurrentFile.remove();\n\t\t\t\tif(modal)\n\t\t\t\t\tmodal.unlock();\n\t\t\t})\n\t\t\t.on(\"notSuccess\", function (error) {\n\t\t\t\tmodal.clearExceptTemplate();\n\t\t\t\tnotifications.message({text: error}).appendToModal(modal);\n\t\t\t})\n\t\t\t.on(\"progress\", function (totalPercent, percent) {\n\t\t\t\tcurrentFile.find(\".total\").html(percent + \"%\");\n\t\t\t\tcurrentFile.find(\".progressBar div\").css(\"width\", percent + \"%\");\n\n\t\t\t\t// If loaded\n\t\t\t\tif (percent === 100)\n\t\t\t\t\tcurrentFile.find(\".total\").html(\"100%, обработка\");\n\n\n\t\t\t})\n\t\t\t.on(\"start\", function () {\n\n\t\t\t});\n\n\t\t/* Send */\n\t\tfilesAjax.send();\n\t\treturn filesAjax;\n\n\t};\n\n});","/** Sends file data via HttpRequest */\nsky.service(\"ajaxFilesXHR\", [\"supported\", \"ajax\", \"stackList\"], function({supported, ajax, stackList}) {\n\tthis.service = class {\n\t\tconstructor(options) {\n\n\t\t\t/* Save options */\n\t\t\tthis.options \t\t= options;\n\t\t\tthis.files \t\t\t= options.files;\n\t\t\tthis.input \t\t\t= options.input;\n\t\t\tthis.url \t\t\t= options.url;\n\t\t\tthis.data \t\t\t= options.data;\n\t\t\tthis.callbacks \t\t= options.callbacks;\n\t\t\tthis.toProceed \t\t= options.files.length;\n\t\t\tthis.inProgress \t= 0;\n\t\t\tthis.total \t\t\t= options.files.length;\n\t\t\tthis.totalLoaded \t= 0;\n\t\t\tthis.totalSize \t\t= 0;\n\t\t\tthis.totalPercent \t= 0;\n\t\t\tthis.current \t\t= 0;\n\t\t\tthis.fileRequests \t= stackList();\n\n\t\t\t/* Go through */\n\t\t\tfor(file of options.files)\n\t\t\t\tthis.totalSize += file.size;\n\n\t\t}\n\n\t\t/**\n\t\t * Get file name\n\t\t * @param {*} file File\n\t\t * @returns {string}\n\t\t */\n\t\tstatic getName(file) {\n\t\t\treturn file.name.replace(/.*(\\/|\\\\)/, \"\");\n\t\t}\n\n\t\t/**\n\t\t * Uploads file\n\t\t * @param {*} file File name in files stack\n\t\t */\n\t\tsend(file) {\n\n\t\t\t/* This obj will store data associated with XHR */\n\t\t\t$.extend(file, {\n\t\t\t\tid     : Math.random(),\n\t\t\t\tname   : this.getName(file.file),\n\t\t\t\tsize   : file.file.size,\n\t\t\t\tajax   : false,\n\t\t\t\tpercent: false,\n\t\t\t\tloaded : 0\n\t\t\t});\n\n\t\t\t/* Prepare params */\n\t\t\tlet self        = this,\n\t\t\t\tparams      = this.data || {},\n\t\t\t\tqueryString = this.url + \"?ajaxFile=\" + file.name + \"&\" + jQuery.param(params);\n\n\t\t\t/**\n\t\t\t * Params extend\n\t\t\t * @param {object} args Object to be extended\n\t\t\t * @returns {*}\n\t\t\t */\n\t\t\tthis.extend = function(args) {\n\t\t\t\treturn jQuery.extend(args, {\n\t\t\t\t\ttotalLoaded : self.totalLoaded,\n\t\t\t\t\ttotalSize   : self.totalSize,\n\t\t\t\t\ttotalPercent: self.totalPercent,\n\t\t\t\t\tfile        : file,\n\t\t\t\t\tloaded      : file.loaded,\n\t\t\t\t\tsize        : file.size,\n\t\t\t\t\tpercent     : file.percent,\n\t\t\t\t\ttoProceed   : self.toProceed,\n\t\t\t\t\tcurrent     : self.current,\n\t\t\t\t\ttotal       : self.total\n\t\t\t\t});\n\t\t\t};\n\n\t\t\t/* Send */\n\t\t\tif(supported.formData) {\n\n\t\t\t\t/* Create form data sender */\n\t\t\t\tlet form = new FormData();\n\t\t\t\tform.append(file.inputName, file.file);\n\n\t\t\t\t/* Send start */\n\t\t\t\tfile.ajax = ajax(queryString, form, { ajaxExtend: {\n\t\t\t\t\t\tprocessData: false,\n\t\t\t\t\t\tcontentType: false,\n\t\t\t\t\t\ttype       : \"POST\",\n\t\t\t\t\t\txhr        : (() => {\n\t\t\t\t\t\t\ttry {\n\n\t\t\t\t\t\t\t\t/* Create XHR */\n\t\t\t\t\t\t\t\tlet xhr = new XMLHttpRequest();\n\n\t\t\t\t\t\t\t\t/* Set special upload api handlers */\n\t\t\t\t\t\t\t\txhr.upload[\"onloadstart\"] = function() {\n\t\t\t\t\t\t\t\t\tthis.inProgress++;\n\t\t\t\t\t\t\t\t\tthis.callbacks.fire(\"begin\", this.extend({}));\n\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t\txhr.upload[\"onprogress\"] = function(event) {\n\t\t\t\t\t\t\t\t\tthis.totalLoaded += event.loaded - file.loaded;\n\t\t\t\t\t\t\t\t\tthis.totalPercent = (this.totalLoaded / this.totalSize * 100).toFixed(0);\n\t\t\t\t\t\t\t\t\tthis.onProgress(event, file);\n\t\t\t\t\t\t\t\t};\n\n\t\t\t\t\t\t\t\t/* Return create XHR */\n\t\t\t\t\t\t\t\treturn xhr;\n\n\t\t\t\t\t\t\t} catch(e) {\n\t\t\t\t\t\t\t\treturn undefined;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}).safe()\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t} else {\n\n\t\t\t\t/* Send start */\n\t\t\t\tfile.ajax = ajax(queryString, file.file, {\n\t\t\t\t\tprocessData: false,\n\t\t\t\t\tcontentType: false,\n\t\t\t\t\ttype       : \"POST\",\n\t\t\t\t\tbeforeSend : sky.func(function(jqXHR) {\n\t\t\t\t\t\tjqXHR.setRequestHeader(\"X-Requested-With\", \"XMLHttpRequest\");\n\t\t\t\t\t\tjqXHR.setRequestHeader(\"X-File-Name\", encodeURI(file.name));\n\t\t\t\t\t\tjqXHR.setRequestHeader(\"Content-Type\", \"multipart/form-data\");\n\t\t\t\t\t\tjqXHR.setRequestHeader(\"Content-Disposition\", 'attachment; filename=\"' + encodeURI(file.name) + '\"');\n\t\t\t\t\t\tjqXHR.setRequestHeader(\"Accept\", \"text/html,application/xhtml+xml,application/xml;q=0.9\");\n\t\t\t\t\t})\n\t\t\t\t});\n\n\t\t\t}\n\n\t\t\t/* Set ajax callbacks */\n\t\t\tfile.ajax.on({\n\t\t\t\tsuccess:\t(all) => { this.callbacks.fire(\"success\", this.extend(all)); },\n\t\t\t\terror: \t\t(all) => { this.callbacks.fire(\"error\", this.extend(all)); },\n\t\t\t\tnotSuccess: (all) => { this.callbacks.fire(\"notSuccess\", this.extend(all)); },\n\t\t\t\talways: \t(all) => {\n\n\t\t\t\t\t/* Counters */\n\t\t\t\t\tthis.inProgress--;\n\t\t\t\t\tthis.toProceed--;\n\n\t\t\t\t\t/* Call always method */\n\t\t\t\t\tthis.callbacks.fire(\"always\", this.extend(all));\n\n\t\t\t\t\t/* Delete connection */\n\t\t\t\t\tthis.fileRequests.delete(file);\n\n\t\t\t\t}\n\t\t\t});\n\n\t\t\t/* Save */\n\t\t\tthis.fileRequests.add(file);\n\n\t\t}\n\n\t\t/**\n\t\t * Fores on progress change\n\t\t * @param event\n\t\t * @param fileRequestData\n\t\t */\n\t\tonProgress(event, fileRequestData) {\n\n\t\t\t/* Count percentage */\n\t\t\tlet percent = (event.loaded / event[\"total\"] * 100).toFixed(0);\n\t\t\tfileRequestData.loaded = event.loaded;\n\n\t\t\t/* If percent changed */\n\t\t\tif(percent !== fileRequestData.percent && event[\"lengthComputable\"]) {\n\t\t\t\tfileRequestData.percent = percent;\n\t\t\t\tthis.callbacks.fire(\"progress\", this.extend({}));\n\t\t\t}\n\n\t\t}\n\n\t\t/**\n\t\t * Aborts current download\n\t\t */\n\t\tabort() {\n\n\t\t\t/* Stop each request */\n\t\t\tthis.fileRequests.each(request => { request.ajax.stop() });\n\n\t\t\t/* Call always method */\n\t\t\tthis.callbacks.fire(\"abort\", this.extend({}));\n\n\t\t}\n\n\t};\n\n});","sky.service(\"calendar\", [ \"templates\", \"visibleCalculator\" ], function ({ templates, visibleCalculator }) {\n\n\t/* This class is for showing calendar to pick date on page */\n\tlet calendar = {\n\n\t\t/* Days set */\n\t\tmonthsNames: window.page.data.monthsNames || [\"Январь\", \"Февраль\", \"Март\", \"Апрель\", \"Май\", \"Июнь\", \"Июль\", \"Август\", \"Сентябрь\", \"Октябрь\", \"Ноябрь\", \"Декабрь\"],\n\n\t\trenderDays: function () {\n\n\t\t\t/* Clone */\n\t\t\tlet current = moment(this.date),\n\t\t\t\tweeks = [],\n\t\t\t\tcurrentWeek = false;\n\n\t\t\t/* From first */\n\t\t\tcurrent.date(1);\n\n\t\t\t/* Go through */\n\t\t\twhile (current.month() === this.date.month()) {\n\n\t\t\t\t/* Make week if new */\n\t\t\t\tif (!currentWeek || current.day() === 1) {\n\t\t\t\t\tcurrentWeek = {number: current.isoWeek(), days: []};\n\t\t\t\t\tweeks.push(currentWeek);\n\t\t\t\t}\n\n\t\t\t\t/* Push */\n\t\t\t\tcurrentWeek.days.push({date: current.clone(), dateStr: current.format(\"YYYY.MM.DD\"), day: current.day() === 0 ? 6 : current.day() - 1});\n\n\t\t\t\t/* Go next day */\n\t\t\t\tcurrent.add(1, \"d\");\n\n\t\t\t}\n\n\t\t\t/* Render */\n\t\t\tthis.dates.html('').append(templates.render(\"calendar-dates\", {\n\t\t\t\tweeks: weeks,\n\t\t\t\tdateStr: this.date.format(\"YYYY.MM.DD\"),\n\t\t\t\tcurrent: this.date,\n\t\t\t\tperiod: this.period,\n\t\t\t\tsince: this.since,\n\t\t\t\ttill: this.till\n\t\t\t}));\n\n\t\t\t/* Render */\n\t\t\tthis.setTime();\n\n\t\t},\n\n\t\t/**\n\t\t * When user picks date\n\t\t * @param {*} dayDiv Div that user clicked, if he did\n\t\t * @param notClose\n\t\t */\n\t\tdayPick: function (dayDiv, notClose) {\n\n\t\t\t/* Set date */\n\t\t\tif (dayDiv)\n\t\t\t\tthis.date.date(parseInt(dayDiv.html()));\n\n\t\t\tthis.field.val(this.getInputValue()).trigger(\"change\").trigger(\"keyup\");\n\t\t\tif (!notClose) this.close();\n\n\t\t},\n\n\t\tgetInputValue: function () {\n\n\t\t\t/* Get field new value */\n\t\t\tif (this.useTime)\n\t\t\t\treturn this.date.format(\"DD.MM.YYYY HH:mm\");\n\t\t\telse if (this.period && this.since.isSame(this.till))\n\t\t\t\treturn this.since.format(\"DD.MM.YYYY\");\n\t\t\telse if (this.period)\n\t\t\t\treturn this.since.format(\"DD.MM.YYYY\") + ' - ' + this.till.format(\"DD.MM.YYYY\");\n\n\t\t\t/* Default */\n\t\t\treturn this.date.format(\"DD.MM.YYYY\");\n\n\t\t},\n\n\t\tsetDayPick: function () {\n\t\t\tthis.pickedDateView.html(this.getInputValue());\n\t\t},\n\n\t\t/**\n\t\t * Position date picker\n\t\t * @param {*} field Item that we should position under\n\t\t */\n\t\tposition: function (field) {\n\n\t\t\tthis.holder.insertAfter(field.parent()).css(\"position\", \"absolute\");\n\n\t\t\tlet calculator = new visibleCalculator(field),\n\t\t\t\toffset = calculator.getDropOffset(field, this.holder);\n\n\t\t\tthis.holder.css({\n\t\t\t\tmarginTop: offset.top,\n\t\t\t\tmarginLeft: offset.left,\n\t\t\t\twidth: offset.width\n\t\t\t});\n\n\t\t},\n\n\t\t/**\n\t\t * Sets time inputs in calendar values\n\t\t */\n\t\tsetTime: function () {\n\n\t\t\t/* Set time */\n\t\t\tthis.holder.find(\".time .hour\").val(this.date.format(\"HH\"));\n\t\t\tthis.holder.find(\".time .minute\").val(this.date.format(\"mm\"));\n\n\t\t},\n\n\t\tperiodChangeDay: function () {\n\n\t\t\tlet reset = function () {\n\t\t\t\tcalendar.since = calendar.date.clone();\n\t\t\t\tcalendar.till = calendar.date.clone();\n\t\t\t\tcalendar.lastModified = \"none\"\n\t\t\t};\n\n\t\t\tif (this.date.isBefore(this.since)) {\n\t\t\t\tif (this.lastModified !== \"since\") {\n\t\t\t\t\tthis.since = this.date.clone();\n\t\t\t\t\tthis.lastModified = \"since\"\n\t\t\t\t}\n\t\t\t\telse reset();\n\t\t\t} else if (this.date.isAfter(this.till)) {\n\t\t\t\tif (this.lastModified !== \"till\") {\n\t\t\t\t\tthis.till = this.date.clone();\n\t\t\t\t\tthis.lastModified = \"till\"\n\t\t\t\t}\n\t\t\t\telse reset();\n\t\t\t} else if (this.date.isSame(this.till) || this.date.isSame(this.since))\n\t\t\t\treset();\n\t\t\telse {\n\t\t\t\tif (this.lastModified === \"since\") {\n\t\t\t\t\tthis.till = this.date.clone();\n\t\t\t\t\tthis.lastModified = \"till\"\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tthis.since = this.date.clone();\n\t\t\t\t\tthis.lastModified = \"since\"\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tcalendar.markSelected();\n\n\t\t},\n\n\t\tmarkSelected: function () {\n\n\t\t\tthis.dates.find(\".day\").removeClass(\"selected\").removeClass(\"subSelected\").each(function () {\n\n\n\t\t\t\tlet element = $(this),\n\t\t\t\t\tdate = calendar.date.clone().date(parseInt(element.html()));\n\n\t\t\t\tif (!calendar.period) {\n\t\t\t\t\tif (date.format(\"DD.MM.YYYY\") === calendar.date.format(\"DD.MM.YYYY\"))\n\t\t\t\t\t\telement.addClass(\"subSelected\");\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (date.isAfter(calendar.since) && date.isBefore(calendar.till))\n\t\t\t\t\telement.addClass(\"subSelected\");\n\t\t\t\telse if (date.isSame(calendar.since) || date.isSame(calendar.till))\n\t\t\t\t\telement.addClass(\"selected\");\n\n\t\t\t});\n\n\t\t},\n\n\t\t/**\n\t\t * Changes day\n\t\t * @param {*} element Day picker\n\t\t * @returns {undefined}\n\t\t */\n\t\tchangeDay: function (element) {\n\n\t\t\t/* If pick today */\n\t\t\tthis.date.date(parseInt(element.html()));\n\n\t\t\t/* No more for period */\n\t\t\tif (this.period) {\n\t\t\t\tthis.periodChangeDay();\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tcalendar.markSelected();\n\n\t\t\t/* Set time */\n\t\t\tif (this.field.attr(\"name\") === \"since\")\n\t\t\t\tthis.date.hour(0).minute(0);\n\t\t\telse if (this.date.format(\"DD-MM-YYYY\") === moment().format(\"DD-MM-YYYY\"))\n\t\t\t\tthis.date.hour(moment().hour()).minute(moment().minute());\n\t\t\telse\n\t\t\t\tthis.date.hour(23).minute(59);\n\n\t\t\t/* Pick */\n\t\t\tif (this.useTime)\n\t\t\t\tthis.setTime();\n\n\t\t},\n\n\t\t/**\n\t\t * Sets specified year\n\t\t * @param {int} year Year that need to be set\n\t\t */\n\t\tchangeYear: function (year) {\n\n\t\t\t/* Set year */\n\t\t\tthis.date.year(year);\n\n\t\t\t/* Update */\n\t\t\tthis.yearView.html(year);\n\n\t\t\t/* Dates redraw */\n\t\t\tthis.renderDays();\n\n\t\t},\n\n\t\t/**\n\t\t * Sets specified month\n\t\t * @param {int} month Month to be set\n\t\t */\n\t\tchangeMonth: function (month) {\n\n\t\t\t/* Set year */\n\t\t\tthis.date.month(month);\n\n\t\t\t/* Updates */\n\t\t\tthis.monthView.html(this.monthsNames[this.date.month()] + ' ' + this.date.year());\n\n\t\t\t/* Reload year */\n\t\t\tthis.changeYear(this.date.year());\n\n\t\t},\n\n\t\tgetDatePeriod: function (dateString) {\n\n\t\t\t// Split and get since\n\t\t\tlet parts = dateString.split('-'),\n\t\t\t\ttill,\n\t\t\t\tsince = this.getDate(parts[0].trim());\n\n\t\t\t// Get till\n\t\t\tif (parts.length > 1)\n\t\t\t\ttill = this.getDate(parts[1].trim());\n\t\t\telse\n\t\t\t\ttill = this.getDate(parts[0].trim());\n\n\t\t\t// Set inner lets\n\t\t\tthis.since = since;\n\t\t\tthis.till = till;\n\t\t\tthis.date = since.clone();\n\n\t\t},\n\n\t\t/**\n\t\t * Creates today date\n\t\t */\n\t\tgetDate: function (dateString) {\n\n\t\t\t/* Set calendar date */\n\t\t\tlet date = false;\n\n\t\t\t/* If input has datetime format value */\n\t\t\tif (dateString.match(/^\\d{4}-\\d{2}-\\d{2} \\d{1,2}:\\d{1,2}$/))\n\t\t\t\tdate = moment(dateString, \"YYYY-MM-DD HH:mm\");\n\n\t\t\t/* Id input has date format value */\n\t\t\tif (dateString.match(/^\\d{4}-\\d{2}-\\d{2}$/))\n\t\t\t\tdate = moment(dateString, \"YYYY-MM-DD\");\n\n\t\t\t/* Id input has date format value */\n\t\t\tif (dateString.match(/^\\d{2}.\\d{2}.\\d{4}$/))\n\t\t\t\tdate = moment(dateString, \"DD.MM.YYYY\");\n\n\t\t\t/* Id input has date format value */\n\t\t\tif (dateString.match(/^\\d{2}.\\d{2}.\\d{4} \\d{2}:\\d{2}$/))\n\t\t\t\tdate = moment(dateString, \"DD.MM.YYYY HH:mm\");\n\n\t\t\t/*  If still no */\n\t\t\tif (!date) {\n\t\t\t\tdate = moment();\n\n\t\t\t\t/* Set time */\n\t\t\t\tif (this.field.attr(\"name\") === \"since\")\n\t\t\t\t\tdate.hour(0).minute(0);\n\t\t\t}\n\n\t\t\t/* Reset time */\n\t\t\tif (!this.useTime)\n\t\t\t\tdate.hour(0).minute(0);\n\n\t\t\t/* Additional check */\n\t\t\treturn this.date = date;\n\n\t\t},\n\n\t\t/**\n\t\t * Closes windows\n\t\t */\n\t\tclose: function () {\n\n\t\t\t/* Remove calendar */\n\t\t\tif (this.holder)\n\t\t\t\tthis.holder.remove();\n\n\t\t\t/* Unset */\n\t\t\tif (this.field) {\n\t\t\t\tthis.field.off(\"keyup.calendar\");\n\t\t\t\tthis.field = false;\n\t\t\t}\n\t\t}\n\t};\n\n\tlet show = function (field, showTime) {\n\n\t\t/* Remove old calendars */\n\t\tthis.close();\n\n\t\t/* Begins from current date */\n\t\tthis.field = field;\n\t\tthis.period = false;\n\t\tthis.useTime = showTime ? showTime : false;\n\t\t// this.lastPicked = \"none\";\n\n\t\tif (field.is(\"input.datePeriod\")) {\n\t\t\tthis.period = true;\n\t\t\tthis.getDatePeriod(field.val());\n\t\t} else\n\t\t\tthis.getDate(field.val());\n\n\t\t/* Render */\n\t\tthis.holder = templates.render(\"calendar\", this);\n\n\t\t/* Actions */\n\t\tthis.holder\n\n\t\t/* Months changer */\n\t\t\t.action(\"click\", \".month .next\", function (event) {\n\t\t\t\tevent.preventDefault();\n\t\t\t\tcalendar.changeMonth(calendar.date.month() + 1);\n\t\t\t})\n\t\t\t.action(\"click\", \".month .prev\", function (event) {\n\t\t\t\tevent.preventDefault();\n\t\t\t\tcalendar.changeMonth(calendar.date.month() - 1);\n\t\t\t})\n\n\t\t\t/* Years */\n\t\t\t.action(\"click\", \".year .next\", function (event) {\n\t\t\t\tevent.preventDefault();\n\t\t\t\tcalendar.changeYear(calendar.date.year() + 1);\n\t\t\t})\n\t\t\t.action(\"click\", \".year .prev\", function (event) {\n\t\t\t\tevent.preventDefault();\n\t\t\t\tcalendar.changeYear(calendar.date.year() - 1);\n\t\t\t})\n\t\t\t.action(\"click\", \".setNow\", function (event) {\n\t\t\t\tevent.preventDefault();\n\t\t\t\tcalendar.date = moment();\n\t\t\t\tcalendar.renderDays();\n\t\t\t\tcalendar.setTime();\n\t\t\t})\n\t\t\t.action(\"click\", \".setToday\", function (event) {\n\t\t\t\tevent.preventDefault();\n\t\t\t\tcalendar.date = moment();\n\t\t\t\tcalendar.date.hour(0);\n\t\t\t\tcalendar.date.minute(0);\n\t\t\t\tcalendar.renderDays();\n\t\t\t\tcalendar.setTime();\n\t\t\t})\n\t\t\t.action(\"click\", \".setWeek\", function (event) {\n\t\t\t\tevent.preventDefault();\n\t\t\t\tcalendar.date = moment();\n\t\t\t\tcalendar.date.subtract(7, \"d\");\n\t\t\t\tcalendar.renderDays();\n\t\t\t\tcalendar.setTime();\n\t\t\t})\n\n\t\t\t/* Day */\n\t\t\t.action(\"click\", \".dates .day\", function (event) {\n\t\t\t\tevent.preventDefault();\n\t\t\t\tlet self = $(this);\n\n\t\t\t\tif (self.is(\".selected\") && !calendar.period)\n\t\t\t\t\tcalendar.dayPick($(this));\n\t\t\t\telse {\n\t\t\t\t\tcalendar.changeDay($(this));\n\t\t\t\t\tcalendar.dayPick(false, true);\n\t\t\t\t}\n\t\t\t})\n\n\t\t\t/* Apply button */\n\t\t\t.action(\"click\", \".apply\", function (event) {\n\t\t\t\tevent.preventDefault();\n\t\t\t\tcalendar.dayPick();\n\t\t\t})\n\n\t\t\t/* Time */\n\t\t\t.action(\"click\", \".time a\", function (event) {\n\t\t\t\tevent.preventDefault();\n\t\t\t\tcalendar.date.hour(moment().hour());\n\t\t\t\tcalendar.date.minute(moment().minute());\n\t\t\t\tcalendar.setTime();\n\t\t\t})\n\t\t\t.action(\"keyup\", \".time .hour\", function () {\n\t\t\t\tcalendar.date.hour(this.value);\n\t\t\t})\n\t\t\t.action(\"keyup\", \".time .minute\", function () {\n\t\t\t\tcalendar.date.minute(this.value);\n\t\t\t});\n\n\n\t\t/* Close and containers */\n\t\tthis.dates = this.holder.find(\".dates\");\n\t\tthis.yearView = this.holder.find(\".year .value\");\n\t\tthis.monthView = this.holder.find(\".month .value\");\n\t\tthis.pickedDateView = this.holder.find(\".pickedDate\");\n\n\t\t/* Refresh days */\n\t\tthis.renderDays();\n\n\t\t/* Reposition */\n\t\tthis.position(field);\n\t\tthis.setDayPick();\n\n\t\t/* Auto change */\n\t\tthis.field.on(\"keyup.calendar\", function () {\n\t\t\tshow(field, showTime);\n\t\t});\n\n\t\tlet dateOriginal;\n\t\tthis.dates.on(\"touchstart\", function (event) {\n\n\t\t\tlet element = $(event.target);\n\t\t\tif (!element.is(\".day\")) return;\n\t\t\tdateOriginal = calendar.date.clone().date(parseInt(element.html()));\n\n\t\t}).on(\"touchmove\", function (event) {\n\n\t\t\t/* No original event */\n\t\t\tevent.preventDefault();\n\n\t\t\tlet element = document.elementFromPoint((event.clientX || event.originalEvent.touches[0].clientX), (event.clientY || event.originalEvent.touches[0].clientY));\n\t\t\telement = $(element);\n\n\t\t\tif (!element.is(\".day\")) return;\n\n\t\t\tlet date = dateOriginal.clone().date(parseInt(element.html()));\n\n\t\t\tif (date.isBefore(dateOriginal)) {\n\t\t\t\tcalendar.since = date.clone();\n\t\t\t\tcalendar.till = dateOriginal.clone();\n\t\t\t} else {\n\t\t\t\tcalendar.since = dateOriginal.clone();\n\t\t\t\tcalendar.till = date.clone();\n\t\t\t}\n\t\t\tcalendar.lastModified = \"none\";\n\t\t\tcalendar.markSelected();\n\t\t\t// $(this).trigger(\"click\");\n\n\t\t});\n\n\t}.bind(calendar);\n\n\t/* Return */\n\tthis.service = show;\n\n});\n\nsky.onReady(({calendar}) => {\n\n\t/* Calendar show */\n\t$(document).action(\"click.calendar\", function (event) {\n\n\t\t/* Get element */\n\t\tlet element = $(event.target || event.srcElement);\n\n\t\t/* Remove calendar */\n\t\tif (!element.is(\".calendar\") && !element.parents(\".calendar\").length)\n\t\t\t$(\".calendar\").remove();\n\n\t\t/* Calendar show */\n\t\tif (element.is(\"input.date\"))\n\t\t\tcalendar(element);\n\n\t\t/* Calendar show */\n\t\tif (element.is(\"input.datePeriod\"))\n\t\t\tcalendar(element, false, true);\n\n\t\t/* Calendar show */\n\t\tif (element.is(\"input.datetime\"))\n\t\t\tcalendar(element, true);\n\n\t\t/* Calendar show */\n\t\tif (element.is(\"input.datehour\"))\n\t\t\tcalendar(element, true);\n\n\t}).action(\"keydown.calendar\", function (event) {\n\t\tif (event.keyCode === 13) {\n\t\t\tlet calendars = $(\".calendar\");\n\t\t\tif (calendars.length) {\n\t\t\t\tcalendars.find(\".day.selected\").trigger(\"click\");\n\t\t\t\tevent.preventDefault();\n\t\t\t}\n\t\t}\n\t});\n});","sky.service(\"dataOperator\", [ \"searchField\", \"templates\", \"utils\", \"ajax\", \"stackList\", \"ajaxLoadingIndicator\" ], function ({ searchField, templates, utils, ajax, stackList, ajaxLoadingIndicator }) {\n\n\t/**\n\t * Default options\n\t * @type {{}}\n\t */\n\tlet baseOptions = {\n\t\tfields: {},\n\t\thistoryType: \"hash\"\n\t};\n\n\t/* Creates new data operator */\n\tclass DataOperator {\n\t\tconstructor(options) {\n\n\t\t\t/* Stores last request object */\n\t\t\tthis.lastRequestData = false;\n\n\t\t\t/* Func that calls before request */\n\t\t\tthis.beforeRequest = false;\n\t\t\t\n\t\t\t/* Fields list */\n\t\t\tthis.fields = stackList();\n\n\t\t\t/* Add base options, but only not set, that's why so fun construction */\n\t\t\tthis.options = utils.extend({}, baseOptions, true);\n\n\t\t\t/* Options init */\n\t\t\tthis.setOptions(options);\n\n\t\t}\n\n\t\t/** Saves to options */\n\t\tsetOptions(options) {\n\n\t\t\t/* Add to options */\n\t\t\tutils.extend(this.options, options, true);\n\n\t\t\t/* Set submit handler */\n\t\t\tif(this.options.form)\n\t\t\t\t$(this.options.form).action(\"submit\", this.onFormSubmit.bind(this));\n\n\t\t\t/* Self return */\n\t\t\treturn this;\n\t\t}\n\n\t\t/**\n\t\t * On form submit\n\t\t * @param event\n\t\t */\n\t\tonFormSubmit(event) {\n\n\t\t\t/* Prevent */\n\t\t\tevent.preventDefault();\n\n\t\t\t/* If form not valid */\n\t\t\tif (!$(this.options.form).validForm())\n\t\t\t\treturn;\n\n\t\t\tlet options = {force: true};\n\n\t\t\tif (this.fields.getById(\"page\"))\n\t\t\t\toptions[this.options.historyType === \"search\" ? \"search\" : \"hash\"] = {page: 1};\n\n\t\t\t/* Update */\n\t\t\tthis.reload(options);\n\n\t\t}\n\n\t\tprepareRequest(options) {\n\n\t\t\t/* On empty */\n\t\t\toptions = options || {};\n\n\t\t\t/* Hash fields */\n\t\t\tif (options[\"hash\"])\n\t\t\t\tpage.history.set(options[\"hash\"]);\n\n\t\t\t/* Hash fields */\n\t\t\tif (options[\"search\"])\n\t\t\t\tpage.history.search(options[\"search\"]);\n\n\t\t\t/* Hash fields */\n\t\t\tif (options[\"virtual\"]) {\n\t\t\t\tif (this.options.historyType === \"search\")\n\t\t\t\t\tpage.history.search(options[\"virtual\"]);\n\t\t\t\telse\n\t\t\t\t\tpage.history.set(options[\"virtual\"]);\n\t\t\t}\n\n\t\t\t/* Write to form from hash */\n\t\t\tif (options.fromUrl) {\n\t\t\t\tif (this.options.historyType === \"search\")\n\t\t\t\t\tthis.readSearch().writeForm();\n\t\t\t\telse\n\t\t\t\t\tthis.readHash().writeForm();\n\t\t\t}\n\n\t\t\t/* jQuery wrap */\n\t\t\tif (this.options.form && !$(this.options.form).validForm())\n\t\t\t\treturn false;\n\n\t\t\t/* Read */\n\t\t\tlet data = this.read();\n\n\t\t\t/* Add additional data */\n\t\t\tif (this.options[\"requestData\"])\n\t\t\t\tdata = utils.extend(data, this.options[\"requestData\"]);\n\n\t\t\t/* Check is same and no force requested */\n\t\t\tif (this.lastRequestData !== false && utils.isObjectsEqual(this.lastRequestData, data) && !options[\"force\"])\n\t\t\t\treturn false;\n\n\t\t\t/* Set hash data */\n\t\t\tif (!options.fromUrl)\n\t\t\t\tthis.writeURI(this.options.historyType);\n\n\t\t\t/* Before request call */\n\t\t\tif (this.beforeRequest)\n\t\t\t\tif (this.beforeRequest(data, options) === false)\n\t\t\t\t\treturn false;\n\n\t\t\t/* Return data */\n\t\t\treturn data;\n\n\t\t}\n\n\t\t/**\n\t\t * Reloads data according to params\n\t\t * @param options\n\t\t * @returns {DataOperator}\n\t\t */\n\t\treload(options) {\n\n\t\t\t/* Prepare */\n\t\t\tlet data = this.prepareRequest(options);\n\n\t\t\t/* Reload */\n\t\t\tif (data)\n\t\t\t\tthis.request(data);\n\n\t\t\t/* Self return */\n\t\t\treturn this;\n\n\t\t}\n\n\t\t/**\n\t\t * Performs request to reload data\n\t\t * @param data\n\t\t */\n\t\trequest(data) {\n\n\t\t\t/* Back link */\n\t\t\tlet self = this;\n\n\t\t\t/* Save last data */\n\t\t\tself.lastRequestData = data;\n\n\t\t\t/* Stop old request */\n\t\t\tif (this.ajax)\n\t\t\t\tthis.ajax.stop();\n\n\t\t\t/* Request */\n\t\t\tthis.ajax = ajax(this.options.url, data)\n\t\t\t\t.on(\"success\", function (response) {\n\t\t\t\t\tself.lastResponse = response;\n\t\t\t\t\tself.render(response, data);\n\t\t\t\t})\n\t\t\t\t.on(\"error\", function (error) {\n\t\t\t\t\tself.error(error)\n\t\t\t\t})\n\t\t\t\t.on(\"always\", function () {\n\t\t\t\t\tself.ajax = false;\n\t\t\t\t});\n\n\t\t\t/* Create loading, auto remove when ajax finishes */\n\t\t\tajaxLoadingIndicator.loading(this.ajax).reloadContent(this.options.holder);\n\n\t\t}\n\n\t\t/**\n\t\t * On success, have to be overloaded\n\t\t * @param data\n\t\t * @param request\n\t\t */\n\t\trender(data, request) {}\n\n\t\t/**\n\t\t * On error, have to be overloaded\n\t\t * @param error\n\t\t */\n\t\terror(error) {}\n\n\t\t/**\n\t\t * Adds list of fields to current list\n\t\t * @param {Array} list List of names\n\t\t * @param {Boolean} [virtual] Virtual fields flag\n\t\t */\n\t\tfieldsList(list, virtual) {\n\n\t\t\t/* Go through and push */\n\t\t\tutils.each(list, (_, item) => {\n\t\t\t\tthis.options.fields[item] = virtual;\n\t\t\t});\n\n\t\t\t/* Self return */\n\t\t\treturn this;\n\t\t\t\n\t\t}\n\n\t\t/**\n\t\t * Sets form fields\n\t\t * @param list\n\t\t * @returns {*}\n\t\t */\n\t\trealFieldsList(list) {\n\t\t\treturn this.fieldsList(list);\n\t\t}\n\n\t\t/**\n\t\t * Set none forms fields\n\t\t * @param list\n\t\t * @returns {*}\n\t\t */\n\t\tvirtualFieldsList(list) {\n\t\t\treturn this.fieldsList(list, true);\n\t\t}\n\n\t\t/**\n\t\t * Reads real fields\n\t\t * @val {string} type Field type - \"real\" or \"virtual\"\n\t\t * @returns {{}}\n\t\t */\n\t\tread(type = false) {\n\n\t\t\t/* Data holder */\n\t\t\tlet data = {};\n\n\t\t\t/* Go through */\n\t\t\tthis.fields.each(field => {\n\n\t\t\t\t/** @let field searchField */\n\t\t\t\tif (type && (type === \"real\" && field.virtual || !field.virtual))\n\t\t\t\t\treturn;\n\n\t\t\t\t/* Read */\n\t\t\t\tfield.read();\n\n\t\t\t\t/* Get non default or null */\n\t\t\t\tlet val = field.valueOrNullOnDefault();\n\n\t\t\t\t/* If value not same as default */\n\t\t\t\tif (val !== null)\n\t\t\t\t\tdata[field.name] = val;\n\n\t\t\t});\n\n\t\t\t/* Self return */\n\t\t\treturn data;\n\n\t\t}\n\n\t\t/** Write current field to form */\n\t\twriteForm() {\n\t\t\tthis.fields.each(field => field.write());\n\t\t\treturn this;\n\t\t}\n\n\t\t/** Reads hash to fields */\n\t\treadHash() {\n\t\t\tthis.fields.each(field => field.hashRead());\n\t\t\treturn this;\n\t\t}\n\n\t\t/** Reads hash to fields */\n\t\treadSearch() {\n\t\t\tthis.fields.each(field => field.searchRead());\n\t\t\treturn this;\n\t\t}\n\n\t\t/** Writes current fields to hash */\n\t\twriteURI(type = \"hash\") {\n\n\t\t\t/* To write */\n\t\t\tlet write = {};\n\n\t\t\t/* Go through */\n\t\t\tthis.fields.each(field => {\n\t\t\t\twrite[field.name]  = field.valueOrNullOnDefault();\n\t\t\t});\n\n\t\t\t/* Write to URI */\n\t\t\ttype === \"search\" ? page.history.search(write) : page.history.set(write);\n\n\t\t\t/* Self return */\n\t\t\treturn this;\n\n\t\t}\n\n\t\t/** Finds inputs associated with fields */\n\t\tinitInputs() {\n\n\t\t\t/* Back link */\n\t\t\tlet self = this;\n\n\t\t\tutils.each(this.options.fields, (fieldName, virtual) => {\n\n\t\t\t\t// Create search field\n\t\t\t\tlet field = new searchField(fieldName, virtual ? self.options.historyType : false);\n\n\t\t\t\t/** @let field searchField */\n\t\t\t\tif (!field.virtual) {\n\n\t\t\t\t\t/* Find input */\n\t\t\t\t\tif (field.name[0] === \"*\") {\n\t\t\t\t\t\tfield.name = field.name.substring(1);\n\t\t\t\t\t\tfield.input = $(self.options.form).find(\".selectReplaceChoose[data-input=\" + field.name + \"]\");\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t\tfield.input = $(self.options.form).find('[name=\"' + field.name + '\"]');\n\n\t\t\t\t\t/* Remove fields without input */\n\t\t\t\t\tif (!field.input || !field.input.length) {\n\t\t\t\t\t\tdelete self.fields[fieldName];\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\t/* Save */\n\t\t\t\t\tself.fields[fieldName] = field;\n\n\t\t\t\t\t/* Read default */\n\t\t\t\t\tfield.default = field.read();\n\t\t\t\t\tfield.value = null;\n\t\t\t\t} else {\n\t\t\t\t\tself.fields[fieldName] = field;\n\t\t\t\t}\n\t\t\t});\n\n\t\t\t/* Self return */\n\t\t\treturn this;\n\t\t}\n\t}\n\n\t/* Interface */\n\tthis.service = {\n\t\tinitOperator: options => new DataOperator(options),\n\t\tsearchField: searchField,\n\t\tinitLoader: function (loader, notifications, pagination, { reload = true, history = true }) {\n\n\t\t\t/* Add count */\n\t\t\tloader.beforeRequest = function (data, options) {\n\t\t\t\tif (!loader.lastRequestData || options.force)\n\t\t\t\t\tdata[\"count\"] = true;\n\t\t\t};\n\n\t\t\t/* Render function */\n\t\t\tloader.render = function (response) {\n\n\t\t\t\t// Re render\n\t\t\t\t$(loader.options.holder).html('').append(\n\t\t\t\t\ttemplates.render(\"page-result-render\", response)\n\t\t\t\t);\n\n\t\t\t\t// Remove old\n\t\t\t\tif (loader.pagination)\n\t\t\t\t\tloader.pagination = loader.pagination.remove();\n\n\t\t\t\tif (typeof response.pages !== \"undefined\") {\n\n\t\t\t\t\t// Pages holder\n\t\t\t\t\tlet holder = $(\"#pages\").html('');\n\n\t\t\t\t\t// Create new\n\t\t\t\t\tif (response.pages > 1 && pagination) {\n\t\t\t\t\t\tloader.pagination = pagination.add({\n\t\t\t\t\t\t\tpages: response.pages,\n\t\t\t\t\t\t\tcurrent: response.page,\n\t\t\t\t\t\t\tholder: holder\n\t\t\t\t\t\t});\n\t\t\t\t\t\tloader.pagination.onPageChange = function (pageNum) {\n\t\t\t\t\t\t\tloader.reload({virtual: {page: pageNum}});\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t};\n\n\t\t\t/* On loading error */\n\t\t\tloader.error = function (error) {\n\n\t\t\t\t// Remove pagination on error\n\t\t\t\tif (loader.pagination)\n\t\t\t\t\tloader.pagination = this.pagination.remove();\n\n\t\t\t\t// Clear\n\t\t\t\t$(loader.options.holder).html('').append(notifications.message({text: error}).render);\n\n\t\t\t};\n\n\t\t\t/* Reload */\n\t\t\tif (reload)\n\t\t\t\tloader.reload({fromUrl: true});\n\n\t\t\t/* Set handler */\n\t\t\tif (history)\n\t\t\t\tpage.history.on(\"change\", function (searchChanged, hashChanged) {\n\t\t\t\t\tif (searchChanged || hashChanged)\n\t\t\t\t\t\tloader.reload({fromUrl: true});\n\t\t\t\t});\n\n\t\t}\n\t}\n\n});","sky.service(\"inputsIO\", function () {\n\n\tthis.service = {\n\n\t\t/**\n\t\t * Get value of single input\n\t\t * @param input\n\t\t * @returns {*}\n\t\t */\n\t\treadInputValue: function (input) {\n\n\t\t\tif (input.is(\".selectReplaceChoose\")) {\n\n\t\t\t\t// Get inputs\n\t\t\t\tlet inputs = input.find(\"input\");\n\n\t\t\t\t// Read\n\t\t\t\tlet data = this.readInputsValues(inputs);\n\n\t\t\t\t// If all checked\n\t\t\t\tif (data.length === inputs.length)\n\t\t\t\t\treturn true;\n\n\t\t\t\t// Return data\n\t\t\t\treturn data;\n\n\t\t\t} else if (input.is(\":checkbox\") || input.is(\":radio\")) {\n\t\t\t\treturn input.is(\":checked\") ? input.val() : false;\n\t\t\t} else\n\t\t\t\treturn input.val() === \"\" ? false : input.val();\n\n\n\t\t},\n\n\t\t/**\n\t\t * Get value of multiple inputs\n\t\t * @param inputs\n\t\t * @returns {*}\n\t\t */\n\t\treadInputsValues: function (inputs) {\n\n\t\t\t/* If single input */\n\t\t\tif (inputs.length === 1)\n\t\t\t\treturn this.readInputValue(inputs);\n\n\t\t\t/* Values holder */\n\t\t\tlet valuesNamed = [],\n\t\t\t\tvaluesLined = [],\n\t\t\t\tself = this;\n\n\t\t\t/* Go through */\n\t\t\tinputs.each(function () {\n\n\t\t\t\t/* Get value */\n\t\t\t\tlet input = $(this),\n\t\t\t\t\tvalue = self.readInputValue(input);\n\n\t\t\t\t/* If we get values */\n\t\t\t\tif (value !== false) {\n\t\t\t\t\tvaluesNamed.push({name: input.attr(\"name\"), value: value});\n\t\t\t\t\tvaluesLined.push(value);\n\t\t\t\t}\n\n\t\t\t});\n\n\t\t\t/* Single */\n\t\t\tif (valuesLined.length === 1) {\n\t\t\t\treturn valuesLined[0];\n\t\t\t}\n\n\t\t\t/* Return */\n\t\t\treturn valuesLined.length ? valuesLined : false;\n\n\t\t},\n\n\t\t/**\n\t\t * Write single input value\n\t\t * @param value\n\t\t * @param input\n\t\t * @returns {*}\n\t\t */\n\t\twriteInputValue: function (value, input) {\n\n\t\t\tif (input.is(\".selectReplaceChoose\")) {\n\n\t\t\t\t// Get inputs\n\t\t\t\tlet inputs = input.find(\"input\");\n\n\t\t\t\t// If all checked\n\t\t\t\tif (value === true)\n\t\t\t\t\tinputs.prop(\"checked\", true);\n\t\t\t\telse\n\t\t\t\t\tthis.writeInputsValue(value, inputs);\n\n\t\t\t\tif (inputs.length)\n\t\t\t\t\tinputs.first().trigger(\"change\", {notByUser: true});\n\n\t\t\t} else if (input.is(\":checkbox\") || input.is(\":radio\")) {\n\t\t\t\treturn input.prop(\"checked\", value !== false);\n\t\t\t} else\n\t\t\t\treturn input.val(value === false ? \"\" : value);\n\t\t},\n\n\t\t/**\n\t\t * Write multiple inputs value\n\t\t * @param values\n\t\t * @param inputs\n\t\t * @returns {*}\n\t\t */\n\t\twriteInputsValue: function (values, inputs) {\n\n\t\t\t/* Write single */\n\t\t\tif (inputs.length < 2)\n\t\t\t\treturn this.writeInputValue(values, inputs);\n\n\t\t\t/* Multiple */\n\t\t\tif (inputs.is(\":checkbox\") || inputs.is(\":radio\")) {\n\t\t\t\tinputs.prop(\"checked\", false);\n\t\t\t\tif (values instanceof Array) {\n\t\t\t\t\t$.each(values, function (_, val) {\n\t\t\t\t\t\tinputs.filter('[value=\"' + val + '\"]').prop(\"checked\", true);\n\t\t\t\t\t});\n\t\t\t\t\tinputs.first().trigger(\"change\", {notByUser: true});\n\t\t\t\t} else {\n\t\t\t\t\tif (values === false || values === true)\n\t\t\t\t\t\tinputs.prop(\"checked\", values).first().trigger(\"change\", {notByUser: true});\n\t\t\t\t\telse\n\t\t\t\t\t\tinputs.filter('[value=\"' + values + '\"]').prop(\"checked\", true).trigger(\"change\", {notByUser: true});\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tinputs.val(values);\n\t\t\t}\n\t\t}\n\n\t}\n\n});","sky.service(\"searchField\", [\"utils\", \"inputsIO\"], function ({ utils, inputsIO }) {\n\tthis.service = class {\n\t\tconstructor(name, virtual) {\n\t\t\tthis.name = name;\n\t\t\tthis.inputName = name;\n\t\t\tthis.virtual = virtual || false;\n\t\t\tthis.default = null;\n\t\t\tthis.input = false;\n\t\t\tthis.value = null;\n\t\t}\n\t\tvalueOrNullOnDefault() {\n\t\t\tif ((this.default instanceof Array) && (this.value instanceof Array))\n\t\t\t\treturn utils.isObjectsEqual(this.value, this.default) ? null : this.value;\n\n\t\t\treturn this.value === this.default ? null : this.value;\n\t\t}\n\t\tread() {\n\t\t\tif (this.virtual === \"search\")\n\t\t\t\treturn this.searchRead();\n\t\t\telse if (this.virtual)\n\t\t\t\treturn this.hashRead();\n\t\t\telse if (this.input)\n\t\t\t\tthis.value = inputsIO.readInputsValues(this.input);\n\n\t\t\treturn this.value;\n\t\t}\n\t\twrite() {\n\t\t\tif (this.input)\n\t\t\t\tinputsIO.writeInputsValue(this.value === null ? this.default : this.value, this.input);\n\t\t\treturn this.value;\n\t\t}\n\t\thashRead() {\n\t\t\tlet hashValue = page.history.hashObject[this.name];\n\t\t\treturn this.value = (typeof hashValue === \"undefined\") ? this.default : hashValue;\n\t\t}\n\t\tsearchRead () {\n\t\t\tlet searchValue = page.history.searchObject[this.name];\n\t\t\treturn this.value = (typeof searchValue === \"undefined\") ? this.default : searchValue;\n\t\t}\n\t}\n});","sky.service(\"callback\", function() {\n\n\t/**\n\t * Creates callback object that holds functions list\n\t * @param {string} [flags]\n\t * @returns {*}\n\t * @constructor\n\t */\n\tlet Callback = function(flags) {\n\n\t\t/* Self construct */\n\t\tif(!(this instanceof Callback))\n\t\t\treturn new Callback(flags);\n\n\t\t/**\n\t\t * Functions list holder\n\t\t * @type {Array}\n\t\t */\n\t\tthis.functions = [];\n\t\tthis.toRun =  0;\n\t\tthis.context = this;\n\n\t\t/* Self return for next usage */\n\t\treturn this;\n\n\t};\n\n\t/**\n\t * Base\n\t * @type {{functions: Array, toRun: number, context: *, add: add, removeByContext: removeByContext, fire: fire, fireNext: fireNext}}\n\t */\n\tCallback.prototype = {\n\n\t\t/**\n\t\t * Adds new function to stack\n\t\t * @param {Function} func Function to add\n\t\t * @param {Object} context Function context\n\t\t * @param {Object} options Call options\n\t\t */\n\t\tadd: function(func, context, options) {\n\t\t\tthis.functions.push({\n\t\t\t\tfunc: func,\n\t\t\t\tcontext: context || false,\n\t\t\t\tonce: options && options.once\n\t\t\t});\n\t\t\treturn this;\n\t\t},\n\n\t\t/**\n\t\t * Removes function from list by context\n\t\t * @param context\n\t\t */\n\t\tremoveByContext: function(context) {\n\n\t\t\t/* Find listener */\n\t\t\tlet i;\n\t\t\tfor(i in this.functions)\n\t\t\t\tif(this.functions[i].context === context)\n\t\t\t\t\tthis.functions.splice(i, 1);\n\n\t\t\t/* Self return */\n\t\t\treturn this;\n\n\t\t},\n\n\t\t/**\n\t\t * Removes function from list by context\n\t\t * @param func\n\t\t */\n\t\tremoveByCallback: function(func) {\n\n\t\t\t/* Find listener */\n\t\t\tlet i;\n\t\t\tfor(i in this.functions)\n\t\t\t\tif(this.functions[i].func === func)\n\t\t\t\t\tthis.functions.splice(i, 1);\n\n\t\t\t/* Self return */\n\t\t\treturn this;\n\n\t\t},\n\n\t\t/**\n\t\t * Fires all functions\n\t\t * @param {Object} context Function context\n\t\t * @param {Array} args Arguments\n\t\t */\n\t\tfire: function(context, args) {\n\t\t\tfor(let func of this.functions)\n\t\t\t\tfunc.func.apply(func.context || context, args);\n\t\t},\n\n\t\t/**\n\t\t * Fires next function\n\t\t * @param {Array|Object} args Arguments\n\t\t * @param {Object} context Function context\n\t\t */\n\t\tfireNext: function(args, context) {\n\n\t\t\t/* If no more to run */\n\t\t\tif(this.functions.length <= this.toRun)\n\t\t\t\treturn false;\n\n\t\t\t/* Set next to run */\n\t\t\tthis.toRun++;\n\n\t\t\t/* Function to run */\n\t\t\tlet current = this.functions[this.toRun - 1],\n\t\t\t\tresult,\n\t\t\t\tfunc = current.func;\n\n\t\t\t/* Set context */\n\t\t\tcontext = current.context || context || window;\n\n\t\t\t/* Get function in string */\n\t\t\tif(typeof func === \"string\")\n\t\t\t\tfunc = context[func];\n\n\t\t\t/* If no function found */\n\t\t\tif(!func)\n\t\t\t\treturn true;\n\n\t\t\t/* Call function */\n\t\t\tresult =  func.call(current.context || context, args) !== false;\n\n\t\t\t/* If call once */\n\t\t\tif(current.once) {\n\t\t\t\tthis.functions.splice(this.toRun - 2, 1);\n\t\t\t\tthis.toRun--;\n\t\t\t}\n\n\t\t\t/* Return function result */\n\t\t\treturn result;\n\t\t}\n\n\t};\n\n\tthis.service = Callback;\n\n});","sky.service(\"callbacks\", [\"callback\"], function({ callback }) {\n\n\t/**\n\t *\n\t * Callbacks prepared object\n\t * @param {*} [flags] Flags list for jQuery.Callbacks\n\t * @constructor\n\t */\n\tlet Callbacks = function(flags) {\n\n\t\t/* Self construction */\n\t\tif(!(this instanceof Callbacks))\n\t\t\treturn new Callbacks(flags);\n\n\t\t/* Add properties */\n\t\t$.extend(true, this, Callbacks.extend);\n\n\t\t/* Callbacks list */\n\t\tthis.advancedCallbacks = {};\n\n\t\t/* Set default flags and self context */\n\t\treturn this.flags(flags);\n\n\t};\n\n\t/**\n\t * Prototype\n\t * @type {{on: on, fire: fire, off: off, flags: flags, setContext: setContext}}\n\t */\n\tCallbacks.prototype = {\n\n\t\t\t/**\n\t\t\t * Flags for sky.Callback\n\t\t\t * @param {object} flags Flags list\n\t\t\t * @returns {*}\n\t\t\t */\n\t\t\tflags: function(flags) {\n\t\t\t\tthis.callbacksFlags = flags;\n\t\t\t\treturn this;\n\t\t\t},\n\n\t\t\t/**\n\t\t\t * Remove by listener\n\t\t\t * @param {string} name Event name\n\t\t\t * @param {string} listener Listener object\n\t\t\t */\n\t\t\tremoveListener: function(name, listener) {\n\t\t\t\tif(this.advancedCallbacks[name]) {\n\t\t\t\t\tthis.advancedCallbacks[name].removeByContext(listener);\n\t\t\t\t}\n\t\t\t},\n\n\t\t\t/**\n\t\t\t * Adds new event handler\n\t\t\t * @param {string} \t name \t\t\tName of event\n\t\t\t * @param {function|string} func \tFunction be called on event fires\n\t\t\t * @param {object}   [context]\t\tFunction options\n\t\t\t * @param {object}   [options]\t\tFunction options\n\t\t\t */\n\t\t\ton:  function(name, func, context, options) {\n\n\n\t\t\t\tif(name instanceof Object)\n\t\t\t\t\t$.each(name, (event, func) => { this.on(event, func) });\n\n\t\t\t\telse $.each(this.getEventsNames(name), (_, name) => {\n\n\t\t\t\t\t/* Create callbacks */\n\t\t\t\t\tif(!this.advancedCallbacks[name])\n\t\t\t\t\t\tthis.advancedCallbacks[name] = callback(this.callbacksFlags);\n\n\t\t\t\t\t/* Add function */\n\t\t\t\t\tthis.advancedCallbacks[name].add(func, context ? context : self.context, options || {});\n\n\t\t\t\t});\n\n\t\t\t\treturn this;\n\t\t\t},\n\n\t\t\t/**\n\t\t\t * Fires callbacks for specified event\n\t\t\t * @param {string} name Name of event\n\t\t\t * @param {object} args Arguments to be passed\n\t\t\t * @param {object} [options] Additional options\n\t\t\t */\n\t\t\tfire: function(name, args, options) {\n\n\t\t\t\t/* Success last */\n\t\t\t\tlet events = this.getEventsNames(name),\n\t\t\t\t\tself = this,\n\t\t\t\t\tnext = false;\n\t\t\t\t\toptions = options || {};\n\n\t\t\t\t/* Remove global if need */\n\t\t\t\tif(options[\"noGlobal\"])\n\t\t\t\t\tevents = events.slice(1);\n\n\t\t\t\t/* Fire events */\n\t\t\t\t$.each(events, function(_, event) {\n\n\t\t\t\t\t/* If no callback */\n\t\t\t\t\tif(!self.advancedCallbacks[event])\n\t\t\t\t\t\treturn;\n\n\t\t\t\t\t/* Run */\n\t\t\t\t\tdo {\n\t\t\t\t\t\tnext = self.advancedCallbacks[event].fireNext(jQuery.extend({ event: event }, args || []), self.context, options.possible);\n\t\t\t\t\t} while(next);\n\n\t\t\t\t\t/* Reset */\n\t\t\t\t\tif(!options.once)\n\t\t\t\t\t\tself.advancedCallbacks[event].toRun = 0;\n\n\t\t\t\t});\n\n\t\t\t},\n\n\t\t\t/**\n\t\t\t * Get all event names from global name\n\t\t\t * @param {String} name Global event name\n\t\t\t * @returns {Array}\n\t\t\t */\n\t\t\tgetEventsNames: function(name) {\n\n\t\t\t\t/* Get events names */\n\t\t\t\tlet names = name.split(\",\"), events = [];\n\n\t\t\t\t/* Go through */\n\t\t\t\t$.each(names, function(i, name) {\n\n\t\t\t\t\t/* Remove spaces */\n\t\t\t\t\tname = name.replace(\" \", \"\");\n\n\t\t\t\t\t/* Get elements */\n\t\t\t\t\tlet elements = name.split(\".\");\n\t\t\t\t\tevents.push(elements[0]);\n\n\t\t\t\t\t/* Go through */\n\t\t\t\t\tfor(let j = 1; j < elements.length; j++)\n\t\t\t\t\t\tevents.push(elements[0] + \".\" + elements[j]);\n\n\t\t\t\t\t/* Global event */\n\t\t\t\t\tif(elements.length > 2)\n\t\t\t\t\t\tevents.push(elements.join(\".\"));\n\n\t\t\t\t});\n\n\t\t\t\t/* Return */\n\t\t\t\treturn events;\n\n\t\t\t},\n\n\t\t/**\n\t\t * Removes event handlers and functions\n\t\t * @param {string} name Event name\n\t\t * @param func\n\t\t */\n\t\t\toff: function(name, func = null) {\n\t\t\t\tif(func && this.advancedCallbacks[name])\n\t\t\t\t\tthis.advancedCallbacks[name].removeByCallback(func);\n\t\t\t\telse\n\t\t\t\t\tdelete this.advancedCallbacks[name];\n\t\t\t}\n\n\t\t};\n\n\t\tthis.service = Callbacks;\n\n});","sky.service(\"drag\", [\"callbacks\"], function({callbacks}) {\n\tlet self = {\n\t\tbindEvents: (event, events) => {\n\t\t\tself.bind(event)\n\t\t\t\t.on(\"start\", events.start)\n\t\t\t\t.on(\"move\", events.move)\n\t\t\t\t.on(\"stop\", events.stop)\n\t\t},\n\t\tbind: event => {\n\n\t\t\t// Get original event\n\t\t\tevent = event.originalEvent || event;\n\n\t\t\t// Init vars\n\t\t\tlet started = false,\n\t\t\t\tcallbacks = callbacks();\n\n\t\t\t// Check button\n\t\t\tif(event.button && event.button !== 1)\n\t\t\t\treturn callbacks;\n\n\t\t\t// Stop default action\n\t\t\tevent.preventDefault();\n\n\t\t\t$(document).on(\"mousemove.drag\", function(event) {\n\n\t\t\t\t// Start\n\t\t\t\tif(!started) {\n\t\t\t\t\tstarted = true;\n\t\t\t\t\tcallbacks.fire(\"start\", { event: event, x: event.pageX, y: event.pageY });\n\t\t\t\t}\n\t\t\t\t// Move\n\t\t\t\telse callbacks.fire(\"move\", { event: event, x: event.pageX, y: event.pageY });\n\n\t\t\t\t// Prevent default\n\t\t\t\tevent.preventDefault();\n\t\t\t\treturn false;\n\n\t\t\t}).on(\"mouseup.drag\", function(event) {\n\n\t\t\t\t// Off events\n\t\t\t\t$(document).off(\"mousemove.drag\").off(\"mouseup.drag\");\n\n\t\t\t\t// If not started\n\t\t\t\tif(!started)\n\t\t\t\t\treturn;\n\n\t\t\t\t// Stop default action\n\t\t\t\tevent.preventDefault();\n\n\t\t\t\t// Call stop callback\n\t\t\t\tcallbacks.fire(\"stop\", { event: event, x: event.pageX, y: event.pageY });\n\n\t\t\t});\n\n\t\t\treturn callbacks;\n\t\t}\n\t};\n\treturn self;\n});","sky.service(\"localStorage\", [ \"callbacks\" ], function({ callbacks }) {\n\n\t//noinspection JSUnusedLocalSymbols\n\tlet LocalStorage = this.service = class {\n\t\tconstructor(options) {\n\t\t\tthis.name = options.name || \"global\";\n\t\t\tthis.events = callbacks();\n\t\t}\n\n\t\t/**\n\t\t * Loads item form database\n\t\t * @param {*} id Unique id\n\t\t */\n\t\tload(id) {\n\t\t\tlet items = this.getItems();\n\t\t\treturn items ? items[id] : undefined;\n\t\t}\n\n\t\tgetItems() {\n\t\t\ttry {\n\n\t\t\t\t/* Try to get item from storage */\n\t\t\t\tlet items = localStorage.getItem(this.name);\n\n\t\t\t\t/* Trigger error */\n\t\t\t\tif(items !== null)\n\t\t\t\t\treturn $.parseJSON(items);\n\n\t\t\t} catch(e) {\n\t\t\t\tthis.events.fire(\"error\", { storage: this });\n\t\t\t}\n\n\t\t\t/* Undefined on error */\n\t\t\treturn undefined;\n\n\t\t}\n\n\t\t/**\n\t\t * Save data to storage\n\t\t * @param id\n\t\t * @param data\n\t\t * @returns {*}\n\t\t */\n\t\tsave(id, data) {\n\n\t\t\ttry {\n\n\t\t\t\t/* Save */\n\t\t\t\tlet items = this.getItems() || {};\n\n\t\t\t\t/* Add item */\n\t\t\t\titems[id] = data;\n\n\t\t\t\t/* Save keys */\n\t\t\t\tlocalStorage.setItem(this.name, JSON.stringify(items));\n\n\t\t\t} catch(e) {\n\t\t\t\tthis.events.fire(\"error\", { storage: this });\n\t\t\t}\n\n\t\t\t/* Self return */\n\t\t\treturn this;\n\n\t\t}\n\n\t\t/**\n\t\t * Removes from storage\n\t\t * @param id\n\t\t * @returns {*}\n\t\t */\n\t\tremove(id) {\n\t\t\ttry {\n\n\t\t\t\t/* Save */\n\t\t\t\tlet items = this.getItems();\n\n\t\t\t\t/* Add item */\n\t\t\t\tdelete items[id];\n\n\t\t\t\t/* Save keys */\n\t\t\t\tlocalStorage.setItem(this.name, JSON.stringify(items));\n\n\t\t\t} catch(e) {\n\t\t\t\tthis.events.fire(\"error\", { storage: this });\n\t\t\t}\n\n\t\t\t/* Self return */\n\t\t\treturn this;\n\n\t\t}\n\t};\n\n});","sky.service(\"model\", [ \"modelsStorage\", \"callbacks\" ], function({ modelsStorage, callbacks }) {\n\n\t/**\n\t * List of model definitions\n\t */\n\tlet modelsDefinition = {};\n\n\tclass Model {\n\t\tconstructor(type, data) {\n\n\t\t\t/* Init as base */\n\t\t\tthis.definition = BaseDefinition;\n\n\t\t\t/* Get special if defined */\n\t\t\tif(modelsDefinition[type])\n\t\t\t\tthis.definition = modelsDefinition[type];\n\n\t\t\t/* Save id */\n\t\t\tthis.id = data[this.definition.id] || null;\n\t\t\tthis.type = type;\n\t\t\tthis.data = {};\n\t\t\tthis.events = callbacks();\n\t\t\tthis.definition.creation.bind(this)($.extend({}, data, true));\n\n\t\t}\n\t\textend(data) {\n\t\t\tthis.definition.extension.bind(this)($.extend({}, data, true));\n\t\t\treturn this.changed();\n\t\t}\n\t\tchanged() {\n\t\t\tthis.events.fire(\"change\", {model: this});\n\t\t\treturn this;\n\t\t}\n\t\tremoveFromStorage() {\n\t\t\tmodelsStorage.remove(this);\n\t\t}\n\t}\n\n\t/**\n\t * Base model definition witch would be parented\n\t */\n\tlet BaseDefinition = {\n\t\tid       : function() {\n\t\t\treturn this.data[\"id\"]\n\t\t},\n\t\tcreation : function(data) {\n\t\t\tthis.data = data;\n\t\t},\n\t\textension: function(data) {\n\t\t\t$.extend(true, this.data, data);\n\t\t}\n\t};\n\n\tthis.service = {\n\t\t/**\n\t\t * Adds new models definition\n\t\t * @param name\n\t\t * @param definition\n\t\t */\n\t\taddDefinition: function(name, definition) {\n\t\t\tmodelsDefinition[name] = $.extend({}, BaseDefinition, definition);\n\t\t},\n\n\t\tfromData: function(type, data) {\n\n\t\t\tlet model = new this.Model(type, data);\n\t\t\tlet cached = modelsStorage.add(model);\n\n\t\t\tif(cached)\n\t\t\t\treturn cached.extend(data);\n\n\t\t\treturn model;\n\n\t\t}\n\t};\n\n});","sky.service(\"modelsManager\", [\"callbacks\", \"model\"], function({callbacks, model}) {\n\tclass Manager {\n\t\tconstructor(type, arr) {\n\n\t\t\tthis.items = [];\n\t\t\tthis.type = type;\n\t\t\tthis.events = callbacks();\n\n\t\t\t$.each(arr, (_, model) => {\n\t\t\t\tthis.items.push(model)\n\t\t\t});\n\t\t}\n\t\treloadFromArray(arr) {\n\t\t\tthis.items = [];\n\t\t\t$.each(arr, (_, data) => {\n\t\t\t\tthis.items.push(model.fromData(this.type, data))\n\t\t\t});\n\t\t}\n\t\tcount() {\n\t\t\treturn this.items.length;\n\t\t}\n\t\taddListener(func) {\n\t\t\tthis.events.on(\"change\", func);\n\t\t}\n\t\tremoveListener(func) {\n\t\t\tthis.events.off(\"change\", func);\n\t\t}\n\t}\n\n\tthis.service = {\n\t\tfromArray: function(type, arr) {\n\t\t\tlet items = [];\n\t\t\t$.each(arr, (_, data) => {\n\t\t\t\titems.push(sky.model.fromData(type, data));\n\t\t\t});\n\t\t\treturn new Manager(type, items);\n\t\t}\n\t};\n\n});","sky.service(\"modelsStorage\", function() {\n\n    let cache = {};\n\n    this.service = {\n\t\tadd: function(model) {\n\n\t\t\t// Search in cache\n\t\t\tlet cached = this.search(model.type, model.id());\n\n\t\t\t// If found extend\n\t\t\tif(cached)\n\t\t\t\treturn cached;\n\n            // Create type storage if none\n            if(!this.cache[model.type])\n                this.cache[model.type] = {};\n\n            // Save model\n            this.cache[model.type][model.id()] = model;\n\n\t\t},\n\n\t\tsearch: function(type, id) {\n\n\t\t\t// Cache search\n\t\t\tif(cache[type] && cache[type][id])\n\t\t\t\treturn cache[type][id];\n\n\t\t\t// On miss\n\t\t\treturn false;\n\t\t},\n\n\t\tremove: function(model) {\n\t\t\tdelete cache[model.type][model.id()];\n\t\t}\n\t}\n});","/**\n * For work with different type of notifications\n */\nsky.service(\"notifications\", [\"templates\", \"windows\", \"tips\"], function({templates, windows, tips}) {\n\n\tclass Message {\n\t\tconstructor({text, type = \"error\"}) {\n\t\t\tthis.render = templates.render(\"forms-message\", {type, text});\n\t\t}\n\n\t\t/**\n\t\t * Creates new modal window and appends message to it\n\t\t * @returns {*}\n\t\t */\n\t\tmodal() {\n\t\t\treturn windows.modal(this.render);\n\t\t}\n\n\t\t/**\n\t\t * Append to holder of modal window\n\t\t * @param {object} modal\n\t\t */\n\t\tappendToModal(modal) {\n\t\t\tmodal.holder.append(this.render);\n\t\t}\n\n\t\t/**\n\t\t * Shows notification in tip\n\t\t * @param object\n\t\t * @param align\n\t\t */\n\t\ttip(object, align) {\n\t\t\ttips.Tip(object, {create: this.render, close: 5}).show(align || \"top\");\n\t\t}\n\t}\n\n\tthis.service = {\n\t\tmessage      : ({text, type = \"error\"}) => new Message({text, type}),\n\t\tfindInElement: element => element.find(\".notificationMessage\")\n\t}\n\n});","sky.action(\"pagination\", {\n\n\tsetPage: function(button, _, page) {\n\n\t\t/* Get pagination */\n\t\tlet pagination = button.parents(\".pagination\").data(\"pagination\");\n\n\t\t/* Correct page */\n\t\tif(page === \"next\")\n\t\t\tpage = pagination.current + 1;\n\n\t\t/* Correct  */\n\t\tif(page === \"previous\")\n\t\t\tpage = pagination.current - 1;\n\n\t\t/* Go to page */\n\t\tpagination.goToPage(page);\n\n\t},\n\n\tscrollTo: function(element, event) {\n\n\t\t/* Get pagination */\n\t\tlet pagination = element.parents(\".pagination\").data(\"pagination\");\n\n\t\t/* Move */\n\t\tpagination.scroll(event);\n\n\t},\n\n\tgrab: function(runner) {\n\n\t\t/* Get pagination */\n\t\tlet pagination = runner.parents(\".pagination\").data(\"pagination\");\n\n\t\t/* Binds */\n\t\t$(window)\n\t\t\t.on(\"mouseup.pagination\", function() {\n\t\t\t\t$(window).off(\"mouseup.pagination mousemove.pagination\");\n\t\t\t}).on(\"mousemove.pagination\", function(event) {\n\t\t\t\tpagination.scroll(event);\n\t\t\t});\n\n\t},\n\n\tnext: function(button, _) {\n\t\tthis.setPage(button, _, \"next\")\n\t},\n\n\tprevious: function(button, _) {\n\t\tthis.setPage(button, _, \"previous\")\n\t}\n\n});","sky.service(\"pagination\", [\"templates\", \"stackList\"], function({ templates, stackList }) {\n\n\tlet list = stackList();\n\n\tclass Pagination {\n\t\tconstructor({ pages, holder, current = 1, arrows = true }) {\n\n\t\t\t/* Save */\n\t\t\tlist.add(this);\n\n\t\t\t/* Set total pages */\n\t\t\tthis.pages \t\t= pages;\n\t\t\tthis.current \t= current;\n\t\t\tthis.pageWidth\t= 45;\n\n\t\t\t/* No pages needed */\n\t\t\tif(this.pages < 2)\n\t\t\t\treturn this;\n\n\t\t\t/* Counted params */\n\t\t\tthis.dimensions = {\n\t\t\t\tstartPage      : 1,\n\t\t\t\tpagesVisible   : 0,\n\t\t\t\tpagesInvisible : 0,\n\t\t\t\tscrollAvailable: 0,\n\t\t\t\tscrollStart\t   : 0,\n\t\t\t\ttumbler\t\t   : 10\n\t\t\t};\n\n\t\t\t/* Render */\n\t\t\tthis.dom = {};\n\t\t\tthis.dom.holder  = templates.render(\"pagination\", { arrows: arrows }).data(\"pagination\", this);\n\t\t\tthis.dom.slider  = this.dom.holder.find(\".pages\");\n\t\t\tthis.dom.pages   = this.dom.slider.children();\n\t\t\tthis.dom.back \t = this.dom.holder.children(\".left\");\n\t\t\tthis.dom.forward = this.dom.holder.children(\".right\");\n\n\t\t\t/* Insert */\n\t\t\tif(holder)\n\t\t\t\tthis.dom.holder.appendTo(holder);\n\n\t\t\t/* If bigger than 10000 */\n\t\t\tif(this.pages > 9999) {\n\t\t\t\tthis.dom.slider.addClass(\"tenthousand\");\n\t\t\t\tthis.pageWidth = 80;\n\t\t\t}\n\t\t\t/* If bigger than 1000 */\n\t\t\telse if(this.pages > 999) {\n\t\t\t\tthis.dom.slider.addClass(\"thousand\");\n\t\t\t\tthis.pageWidth = 70;\n\t\t\t}\n\t\t\t/* If bigger 100 */\n\t\t\telse if(this.pages > 99 ) {\n\t\t\t\tthis.dom.slider.addClass(\"hundred\");\n\t\t\t\tthis.pageWidth = 60;\n\t\t\t}\n\n\t\t\t/* Make all */\n\t\t\tthis.redraw();\n\n\t\t\t/* Mark page */\n\t\t\tthis.goToPage(this.current);\n\n\t\t\t/* Self return */\n\t\t\treturn this;\n\n\t\t}\n\n\t\t/** */\n\t\tonPageChange(newPage) {}\n\n\t\t/** Removes navigator */\n\t\tremove() {\n\t\t\tthis.dom.holder.remove();\n\t\t\tlist.remove(this);\n\t\t}\n\n\t\t/**\n\t\t * Redraws pagination\n\t\t */\n\t\tredraw() {\n\n            /* No action on invisible */\n            if(!this.dom.holder.is(\":visible\"))\n                return;\n\n\t\t\t/* Reset width */\n\t\t\tthis.dom.slider.css(\"width\", \"auto\");\n\n\t\t\t/* Count visible sizes */\n\t\t\tthis.dimensions.pagesVisible = Math.floor((this.dom.holder.innerWidth() - 100) / this.pageWidth);\n\n\t\t\t/* Count invisible */\n\t\t\tthis.dimensions.pagesInvisible = (this.pages - this.dimensions.pagesVisible) > 0 ? this.pages - this.dimensions.pagesVisible : 0;\n\n\t\t\t/* Get max pages */\n\t\t\tlet toShow = this.dimensions.pagesVisible > this.pages ? this.pages : this.dimensions.pagesVisible;\n\n\t\t\t/* Crop */\n\t\t\tthis.dom.slider.css(\"width\", toShow * this.pageWidth);\n\n\t\t\t/* Redraw pages */\n\t\t\tthis.drawPages(this.dimensions.startPage);\n\n\t\t\t/* Try to create scroll */\n\t\t\tthis.createScroll();\n\n\t\t\t/* Set scroll position */\n\t\t\tif(this.dom.scrollLine)\n\t\t\t\tthis.dom.runner.css(\"left\", this.calculate().scroll);\n\n\t\t}\n\n\t\t/**\n\t\t * Create scroll line if needed\n\t\t */\n\t\tcreateScroll() {\n\n\t\t\t/* If no scroll needed */\n\t\t\tif(this.pages <= this.dimensions.pagesVisible) {\n\t\t\t\tif(this.dom.scrollLine) {\n\t\t\t\t\tthis.dom.scrollLine.remove();\n\t\t\t\t\tthis.dom.scrollLine = false;\n\t\t\t\t}\n\t\t\t\treturn;\n\t\t\t} else if(!this.dom.scrollLine) {\n\n\t\t\t\t/* Create scroll */\n\t\t\t\tthis.dom.scrollLine = templates.render(\"pagination-scroll\", {}).appendTo(this.dom.slider);\n\t\t\t\tthis.dom.runner = this.dom.scrollLine.children();\n\t\t\t}\n\n\t\t\t/* Count left */\n\t\t\tthis.dimensions.scrollStart = this.dom.scrollLine.position().left + 2;\n\n\t\t\t/* Count scroll line width */\n\t\t\tthis.dimensions.scrollAvailable = this.dom.scrollLine.outerWidth() - this.dom.scrollLine.children().outerWidth() - 4;\n\t\t\n\t\t}\n\n\t\t/**\n\t\t * Calculates related coordinates between scroll and move part\n\t\t */\n\t\tcalculate(position) {\n\n\t\t\t/* Get position */\n\t\t\tif(position === undefined)\n\t\t\t\tposition = this.dom.runner.offset().left  - this.dimensions.scrollStart;\n\n\t\t\t/* Remove start */\n\t\t\tposition = position - this.dimensions.scrollStart;\n\n\t\t\t/* Correct */\n\t\t\tposition = position > 0 ? position : 0;\n\n\t\t\t/* Count pages */\n\t\t\treturn {\n\t\t\t\tpages : Math.floor(this.dimensions.pagesInvisible * (position / this.dimensions.scrollAvailable)) + 1,\n\t\t\t\tscroll: Math.floor(this.dimensions.scrollAvailable * (this.dimensions.startPage - 1)/ this.dimensions.pagesInvisible + this.dimensions.scrollStart)\n\t\t\t}\n\n\t\t}\n\n\t\t/**\n\t\t * Draws pages according to start\n\t\t * @param {int} start Page to start from\n\t\t */\n\t\tdrawPages(start) {\n\n\t\t\t/* Remove old pages */\n\t\t\tthis.dom.pages.html(\"\");\n\n\t\t\t/* Correct */\n\t\t\tif(start > this.dimensions.pagesInvisible)\n\t\t\t\tstart = this.dimensions.pagesInvisible + 1;\n\n\t\t\t/* Correct */\n\t\t\tif(start < 1)\n\t\t\t\tstart = 1;\n\n\t\t\t/* Start position */\n\t\t\tlet i = start;\n\n\t\t\t/* Draw pages */\n\t\t\twhile(i <= this.pages && i < start + this.dimensions.pagesVisible) {\n\t\t\t\ttemplates.render(\"pagination-page\", { page: i, current: this.current }).appendTo(this.dom.pages);\n\t\t\t\ti++;\n\t\t\t}\n\n\t\t\t/* Reset start page */\n\t\t\tthis.dimensions.startPage = start;\n\n\n\t\t}\n\n\t\t/**\n\t\t * Sets page as active\n\t\t * @param {int} page Page number\n\t\t * @returns {Pagination}\n\t\t */\n\t\tgoToPage(page = 1) {\n\n\t\t\t/* Parse */\n\t\t\tpage = parseInt(page);\n\n\t\t\t/* Correct */\n\t\t\tif(page < 1)\n\t\t\t\tpage = 1;\n\t\t\telse if(page > this.pages)\n\t\t\t\tpage = this.pages;\n\n\t\t\t/* Checks if page is visible */\n\t\t\tlet isVisible = this.dimensions.startPage <= page && page < this.dimensions.startPage + this.dimensions.pagesVisible;\n\n\t\t\t/* Redraws if needed */\n\t\t\tif(!isVisible) {\n\t\t\t\tthis.drawPages(page);\n\t\t\t\tif(this.dom.scrollLine)\n\t\t\t\t\tthis.dom.runner.css(\"left\", this.calculate().scroll);\n\t\t\t}\n\n\t\t\t/* Make active */\n\t\t\tthis.dom.pages.children().removeClass(\"active\").filter(\"[data-page=\" + page +\"]\").addClass(\"active\");\n\n\t\t\t/* Forward buttons disable */\n\t\t\tpage > 1 ? this.dom.back.enable() : this.dom.back.disable();\n\n\t\t\t/* Backward button disable */\n\t\t\tpage === this.pages ? this.dom.forward.disable() : this.dom.forward.enable();\n\n\t\t\t/* Callback */\n\t\t\tif(this.current !== page)\n\t\t\t\tthis.onPageChange(page);\n\n\t\t\t/* Save page state */\n\t\t\tthis.current = page;\n\n\t\t\t/* Self return */\n\t\t\treturn this;\n\n\t\t}\n\n\t\t/** Set scroll */\n\t\tscroll(event) {\n\n\t\t\tlet pos = event.pageX - 10;\n\t\t\tif(this.dimensions.scrollStart > pos)\n\t\t\t\tpos = this.dimensions.scrollStart;\n\t\t\tif(this.dimensions.scrollStart + this.dimensions.scrollAvailable < pos)\n\t\t\t\tpos = this.dimensions.scrollStart + this.dimensions.scrollAvailable;\n\n\t\t\tthis.dom.runner.css({left: pos});\n\t\t\tthis.drawPages(this.calculate(pos).pages);\n\n\t\t}\n\n\t}\n\n\t/* Bind windows events */\n\t$(window).on(\"resize\", function() {\n\t\tlist.each((pages) => { pages.redraw(); });\n\t});\n\n\t/* Return */\n\tthis.service = {\n\t\tadd: function(options) {\n\t\t\treturn new Pagination(options);\n\t\t}\n\t}\n\n});","sky.service(\"stackList\", [\"utils\"], function({ utils }) {\n\tlet List = this.service = function() {\n\n\t\tif(!(this instanceof List))\n\t\t\treturn new List();\n\n\t\tlet elements = {};\n\t\tlet lastId = 0;\n\t\tlet total = 0;\n\n\t\tthis.last = function() {\n\n\t\t\t/* Holder */\n\t\t\tlet last = undefined;\n\n\t\t\t/* Apply for windows */\n\t\t\tthis.each(element => { last = element });\n\n\t\t\t/* Return */\n\t\t\treturn last;\n\n\t\t};\n\n\t\tthis.add = function(element, id = false) {\n\t\t\tlastId++;\n\t\t\ttotal++;\n\t\t\telements[id || lastId] = element;\n\t\t};\n\n\t\tthis.remove = function(element) {\n\t\t\t/* Apply for windows */\n\t\t\tfor(let index in elements)\n\t\t\t\tif(elements.hasOwnProperty(index) && elements[index] === element) {\n\t\t\t\t\tdelete elements[index];\n\t\t\t\t\ttotal--;\n\t\t\t\t}\n\t\t};\n\n\t\tthis.total = function() {\n\t\t\treturn total;\n\t\t};\n\n\t\tthis.getById = function(id) {\n\t\t\treturn elements[id];\n\t\t};\n\n\t\tthis.elements = function() {\n\t\t\treturn elements;\n\t\t};\n\n\t\tthis.each = function(callback) {\n\t\t\tutils.each(elements, (id, single) => {\n\t\t\t\tcallback.apply(single, [single, id]);\n\t\t\t});\n\n\t\t};\n\n\t}\n});","sky.onReady(({suggester}) => {\n\t$(document).on(\"click\", function(event) {\n\n\t\t/* Get element */\n\t\tlet element = $(event.target || event.srcElement);\n\n\t\t/* If click in replace we should not hide it */\n\t\tif(element.is(\"[type=submit]\") || element.closest(\".suggester\").length || element.data(\"suggester\"))\n\t\t\treturn;\n\n\t\t/* Hide all */\n\t\tsuggester.hide();\n\n\t});\n});\n\nsky.service(\"suggester\", [\"templates\"], function({templates}) {\n\n\tlet render,\n\t\tobject,\n\t\tlastList,\n\t\tsuggester = this.service = {\n\t\t\thide: function() {\n\n\t\t\t\tif(render) {\n\t\t\t\t\trender.remove();\n\t\t\t\t\trender = false;\n\t\t\t\t}\n\t\t\t\tif(object) {\n\t\t\t\t\tobject.removeData(\"suggester\");\n\t\t\t\t\tobject = false;\n\t\t\t\t}\n\t\t\t\t$(document).off(\"keyup.suggester, keydown.suggester\");\n\t\t\t},\n\t\t\tshow: function(input, list) {\n\n\t\t\t\t/* Hide previous */\n\t\t\t\tsuggester.hide();\n\n\t\t\t\t/* Save */\n\t\t\t\tlastList = list;\n\t\t\t\trender = templates.render(\"suggester\", {items: list}).insertAfter(input.closest(\"label, .label\"));\n\t\t\t\tobject = input.data(\"suggester\", render);\n\n\t\t\t\t/* Get positions */\n\t\t\t\tlet elementPosition = input.offset(),\n\t\t\t\t\trenderPosition = render.offset();\n\n\t\t\t\t/* Show */\n\t\t\t\trender.css({\n\t\t\t\t\t\"margin-left\": elementPosition.left - renderPosition.left,\n\t\t\t\t\t\"margin-top\": elementPosition.top - renderPosition.top + input.outerHeight()\n\t\t\t\t});\n\n\t\t\t\t/* Add handlers */\n\t\t\t\tlet children = render.children().on(\"click\", function() {\n\t\t\t\t\tinput.val($(this).html());\n\t\t\t\t\tsuggester.hide();\n\t\t\t\t\tif(lastList[$(this).attr(\"data-index\")].callback)\n\t\t\t\t\t\tlastList[$(this).attr(\"data-index\")].callback();\n\t\t\t\t});\n\n\t\t\t\t$(document).on(\"keyup.suggester\", function(event) {\n\n\t\t\t\t\tif(event.keyCode === 38 || event.keyCode === 40) {\n\n\t\t\t\t\t\tlet selected = children.filter(\".selected\");\n\t\t\t\t\t\tchildren.removeClass(\"selected\");\n\n\t\t\t\t\t\t// Up\n\t\t\t\t\t\tif(event.keyCode === 38) {\n\t\t\t\t\t\t\tif(!selected.length || !selected.prev().length)\n\t\t\t\t\t\t\t\tchildren.last().addClass(\"selected\");\n\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t\tselected.prev().addClass(\"selected\");\n\t\t\t\t\t\t}\n\t\t\t\t\t\t// Down\n\t\t\t\t\t\tif(event.keyCode === 40) {\n\t\t\t\t\t\t\tchildren.removeClass(\"selected\");\n\t\t\t\t\t\t\tif(!selected.length || !selected.next().length) {\n\t\t\t\t\t\t\t\tchildren.first().addClass(\"selected\")\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tselected.next().addClass(\"selected\");\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\t// Esc\n\t\t\t\t\tif(event.keyCode === 27) suggester.hide();\n\n\n\t\t\t\t}).on(\"keydown.suggester\", function(event) {\n\n\t\t\t\t\t// Enter\n\t\t\t\t\tif(event.keyCode !== 13) return;\n\n\t\t\t\t\tlet selected = children.filter(\".selected\");\n\t\t\t\t\tif(selected.length) {\n\t\t\t\t\t\tselected.trigger(\"click\");\n\t\t\t\t\t\tevent.preventDefault();\n\t\t\t\t\t} else {\n\t\t\t\t\t\tsuggester.hide();\n\t\t\t\t\t}\n\n\t\t\t\t});\n\t\t\t}\n\t\t};\n});","sky.service(\"directives\", [\"exceptions\", \"utils\", \"stackList\"], function ({exceptions, utils, stackList}) {\n\n\tlet list = stackList(),\n\t\tdirectives = this.service = {\n\n\t\t\t/**\n\t\t\t * Adds new directive\n\t\t\t * @param {string} name Directive name\n\t\t\t * @param {*} options Directive options\n\t\t\t * @param {function} directive How to parse directive\n\t\t\t */\n\t\t\tadd: function (name, options, directive) {\n\n\t\t\t\t/* Reset */\n\t\t\t\tif (!directive && typeof options === \"function\") {\n\t\t\t\t\tdirective = options;\n\t\t\t\t\toptions = {};\n\t\t\t\t}\n\t\t\t\toptions.directive = directive;\n\t\t\t\toptions.selector = name;\n\n\t\t\t\t/* Save */\n\t\t\t\tlist.add(options);\n\n\t\t\t\t/* Self return*/\n\t\t\t\treturn this;\n\n\t\t\t},\n\n\t\t\t/**\n\t\t\t * Get element attributes\n\t\t\t * @param element\n\t\t\t * @returns {{}}\n\t\t\t */\n\t\t\tgetAttributes: function (element) {\n\n\t\t\t\t/* Holds attributes */\n\t\t\t\tlet attributes = {};\n\n\t\t\t\t/* Copy them to list */\n\t\t\t\tfor(let attr of element.get(0).attributes)\n\t\t\t\t\tattributes[attr.nodeName] = attr.nodeValue;\n\n\t\t\t\t/* Return */\n\t\t\t\treturn attributes;\n\n\t\t\t},\n\n\t\t\t/**\n\t\t\t * Applies directive convert to element\n\t\t\t * @param element\n\t\t\t * @param options\n\t\t\t */\n\t\t\tparseElement: function (element, options) {\n\n\t\t\t\t/* Get element */\n\t\t\t\telement = $(element);\n\n\t\t\t\t/* Get element attributes */\n\t\t\t\tlet attributes = this.getAttributes(element);\n\n\t\t\t\t/* Parse body for jason data */\n\t\t\t\tif (options[\"json\"] || options[\"jsonToData\"]) {\n\n\t\t\t\t\t/* Get child */\n\t\t\t\t\tlet jsonScript = element.children('script[type=\"application/json\"]');\n\n\t\t\t\t\t/* If we have json encoded data */\n\t\t\t\t\tif (jsonScript.length) {\n\n\t\t\t\t\t\ttry {\n\n\t\t\t\t\t\t\t/* Parse json */\n\t\t\t\t\t\t\tlet json = JSON.parse(jsonScript.text());\n\n\t\t\t\t\t\t\t/* Extend */\n\t\t\t\t\t\t\tutils.extend(attributes, json);\n\n\t\t\t\t\t\t\t/* Save to data */\n\t\t\t\t\t\t\tif (options[\"jsonToData\"])\n\t\t\t\t\t\t\t\telement.data(\"json\", json);\n\n\t\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\t\tthrow new exceptions.system.Error(\"Element \" + options.selector + \" should have json stored content, but error on parse appears\");\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t/* Call parse function */\n\t\t\t\tif (typeof options.directive === \"function\")\n\t\t\t\t\toptions.directive(element, attributes);\n\t\t\t},\n\n\t\t\t/**\n\t\t\t * Searches and replaces directives in element\n\t\t\t * @param element\n\t\t\t */\n\t\t\tparse: function (element) {\n\t\t\t\tlist.each((directive) => {\n\t\t\t\t\t$(directive.selector, element).each(function () {\n\t\t\t\t\t\tdirectives.parseElement(this, directive);\n\t\t\t\t\t});\n\t\t\t\t\tif ($(element).is(directive.selector))\n\t\t\t\t\t\tdirectives.parseElement(element, directive);\n\t\t\t\t});\n\t\t\t}\n\n\n\t\t};\n\n\t/* Add jQuery fn */\n\tjQuery.fn.parseDirectives = function () {\n\n\t\t/* Parse */\n\t\tdirectives.parse(this);\n\n\t\t/* Return */\n\t\treturn this;\n\n\t};\n\n\t/* Parse body for directives when all ready */\n\tsky.onReady(function () {\n\t\t$(\"body\").parseDirectives();\n\t});\n\n});","sky.service(\"templates\", [\"localStorage\", \"supported\", \"directives\", \"exceptions\", \"utils\"], function({localStorage, supported, directives, exceptions, utils}) {\n\n\n\tlet templatesList     = {},\n\t\ttemplatesCompiled = {},\n\t\tTemplates         = this.service = {\n\n\t\t\t/** Globals list */\n\t\t\tglobals: {},\n\n\t\t\t/** Local storage support */\n\t\t\tstorage: supported.localStorage ? new localStorage({name: \"jsTemplates\"}) : false,\n\n\t\t\t/**\n\t\t\t * Adds new template to list\n\t\t\t * @param options\n\t\t\t */\n\t\t\tadd: function(options) {\n\t\t\t\ttemplatesList[options.name] = options.template;\n\t\t\t\tif(this.storage) {\n\t\t\t\t\tthis.storage.save(options.name, options.template);\n\t\t\t\t\t$.cookie(\"storedTemplates-\" + options.name, options.date);\n\t\t\t\t}\n\t\t\t},\n\n\t\t\trenderByNameWithHolder: function(name, data, noDirectives) {\n\n\t\t\t\t/* Compile template */\n\t\t\t\tlet template = this.compile(name);\n\n\t\t\t\t/* Add globals */\n\t\t\t\tdata = utils.extend(true, {}, data, {globals: this.globals});\n\n\t\t\t\t/* return */\n\t\t\t\treturn this.coverWithHolder(template.render(data), noDirectives);\n\n\t\t\t},\n\n\t\t\trenderByTextWithHolder: function(text, data, noDirectives) {\n\n\n\t\t\t\t/* Add globals */\n\t\t\t\tdata = utils.extend(true, {}, data, {globals: this.globals});\n\n\t\t\t\t/* return */\n\t\t\t\treturn this.coverWithHolder(Twig.twig({data: text}).render(data), noDirectives);\n\n\t\t\t},\n\n\t\t\tcoverWithHolder: function(text, noDirectives) {\n\n\t\t\t\t/* Render */\n\t\t\t\tlet temp = document.createElement('div');\n\t\t\t\ttemp.innerHTML = text.trim();\n\n\t\t\t\t/* Parse directives */\n\t\t\t\tif(!noDirectives)\n\t\t\t\t\tdirectives.parse(temp);\n\n\t\t\t\t/* Return */\n\t\t\t\treturn temp;\n\n\t\t\t},\n\n\t\t\t/**\n\t\t\t * Renders specified template\n\t\t\t * @param {String} name Template name\n\t\t\t * @param {Object} data Inner data\n\t\t\t * @param {bool} [noDirectives]\n\t\t\t * @returns {*}\n\t\t\t */\n\t\t\trender: function(name, data, noDirectives) {\n\n\t\t\t\t/* Compile template */\n\t\t\t\treturn $(this.renderByNameWithHolder(name, data, noDirectives).childNodes);\n\n\t\t\t},\n\n\t\t\t/**\n\t\t\t * Renders specified template and returns text\n\t\t\t * @param {String} name Template name\n\t\t\t * @param {Object} data Inner data\n\t\t\t * @param {bool} [noDirectives]\n\t\t\t * @returns {*}\n\t\t\t */\n\t\t\trenderToText: function(name, data, noDirectives) {\n\n\t\t\t\t/* Compile template */\n\t\t\t\treturn this.renderByNameWithHolder(name, data, noDirectives).innerHTML;\n\n\t\t\t},\n\n\t\t\t/**\n\t\t\t * Renders template by its text as parameter\n\t\t\t * @param {string} text Template text\n\t\t\t * @param {Object} data Inner data\n\t\t\t * @param {bool} [noDirectives]\n\t\t\t * @returns {XMLList|*}\n\t\t\t */\n\t\t\trenderByText: function(text, data, noDirectives) {\n\t\t\t\treturn $(this.renderByTextWithHolder(text, data, noDirectives).childNodes);\n\t\t\t},\n\n\t\t\t/**\n\t\t\t * Renders template by its text as parameter\n\t\t\t * @param {string} text Template text\n\t\t\t * @param {Object} data Inner data\n\t\t\t * @param noDirectives\n\t\t\t * @returns {XMLList|*}\n\t\t\t */\n\t\t\trenderByTextToText: function(text, data, noDirectives) {\n\t\t\t\treturn this.renderByTextWithHolder(text, data, noDirectives).innerHTML;\n\t\t\t},\n\n\t\t\t/**\n\t\t\t * Compiles specified template\n\t\t\t * @param {string} name Template name\n\t\t\t */\n\t\t\tcompile: function(name) {\n\n\t\t\t\t/* If already compiled */\n\t\t\t\tif(!templatesCompiled[name]) {\n\n\t\t\t\t\t/* Load */\n\t\t\t\t\tlet template = this.load(name);\n\n\t\t\t\t\t/* Compile */\n\t\t\t\t\tlet compiled = Twig.twig({ id: name, data: template });\n\n\t\t\t\t\t/* Check */\n\t\t\t\t\tif(!compiled)\n\t\t\t\t\t\tthrow new exceptions.system.Error('Error during compiling template \"' + name + '\"');\n\n\t\t\t\t\t/* Save */\n\t\t\t\t\ttemplatesCompiled[name] = compiled;\n\n\t\t\t\t}\n\n\t\t\t\t/* Save */\n\t\t\t\treturn templatesCompiled[name];\n\n\t\t\t},\n\n\t\t\t/**\n\t\t\t * Loads specified template\n\t\t\t * @param {string} name Template name\n\t\t\t */\n\t\t\tload: function(name) {\n\n\t\t\t\t/* Loaded */\n\t\t\t\tlet fromLS;\n\n\t\t\t\t/* Try to load from storage */\n\t\t\t\tif(!templatesList[name] && this.storage && (fromLS = this.storage.load(name)))\n\t\t\t\t\treturn templatesList[name] = fromLS;\n\n\t\t\t\t/* If already compiled */\n\t\t\t\tif(templatesList[name])\n\t\t\t\t\treturn templatesList[name];\n\n\t\t\t\t/* Load template */\n\t\t\t\tif(!(templatesList[name] = $('script[type=\"text/template\"][id=' + name + ']').html()))\n\t\t\t\t\tthrow new exceptions.system.Error(\"Can't find template – \" + name);\n\n\t\t\t\t/* Save to LS */\n\t\t\t\tif(this.storage)\n\t\t\t\t\tthis.storage.save(name, {template: templatesList[name]});\n\n\t\t\t\t/* Return */\n\t\t\t\treturn templatesList[name]\n\n\t\t\t}\n\n\t\t};\n\n\tsky.directive('script[type=\"text/template\"], template', function(template, attrs) {\n\t\tTemplates.add({\n\t\t\tname    : attrs.id,\n\t\t\ttemplate: template.html()\n\t\t});\n\t});\n\n\n\t/* Save templates files data */\n\tsky.onReady(() => {\n\t\tif(window.page.data.templates && supported.localStorage) {\n\t\t\tutils.each(window.page.data.templates, function(_, template) {\n\t\t\t\t$.cookie(\"storedTemplates-\" + template.path, template.date);\n\t\t\t});\n\t\t}\n\t});\n\n});\n","/**\n * Module to work with user services\n */\nsky.service(\"supported\", function () {\n\ttry {\n\t\tthis.service.fullScreen = typeof document[\"webkitIsFullScreen\"] !== \"undefined\";\n\t\tthis.service.formData = window.FormData && true;\n\t\t// this.service.XHRIsSupported = XHRIsSupported;\n\t\tthis.service.XHRUpload = (typeof new XMLHttpRequest().upload !== \"undefined\");\n\t\tthis.service.localStorage = !!window.localStorage;\n\t} catch (e) {}\n});","sky.service(\"utils\", function() {\n\tthis.service = {\n\n\t\textend: function() {\n\t\t\treturn $.extend.apply($, arguments);\n\t\t},\n\n\t\teach: function() {\n\t\t\treturn $.each.apply($, arguments);\n\t\t},\n\n\t\t/**\n\t\t * Checks if object has same data\n\t\t * @param first\n\t\t * @param second\n\t\t */\n\t\tisObjectsEqual: function(first, second) {\n\n\t\t\t/* Different types */\n\t\t\tif(typeof first !== typeof second)\n\t\t\t\treturn false;\n\n\t\t\t/* If object or array we will compare each element */\n\t\t\tif(first instanceof Array || first instanceof Object) {\n\t\t\t\tlet key;\n\t\t\t\t/* Check first */\n\t\t\t\tfor(key in first) {\n\t\t\t\t\tif(!first.hasOwnProperty(key)) continue;\n\t\t\t\t\tif(typeof second[key] === \"undefined\") return false;\n\t\t\t\t\telse if(!this.isObjectsEqual(first[key], second[key])) return false;\n\t\t\t\t}\n\n\t\t\t\t/* Check second */\n\t\t\t\tfor(key in second) {\n\t\t\t\t\tif(!second.hasOwnProperty(key)) continue;\n\t\t\t\t\tif(typeof first[key] === \"undefined\") return false;\n\t\t\t\t}\n\n\t\t\t} else if(first !== second) return false;    // For simple types\n\n\t\t\t/* All tests success */\n\t\t\treturn true;\n\n\t\t},\n\n\t\t/**\n\t\t * Adds zero\n\t\t * @param value\n\t\t * @returns {Number}\n\t\t */\n\t\taddLeadingZero: function(value) {\n\n\t\t\t/* Parse */\n\t\t\tvalue = parseInt(value);\n\n\t\t\t/* Ad zero */\n\t\t\tif(value < 10)\n\t\t\t\tvalue = \"0\" + value;\n\n\t\t\t/* Val */\n\t\t\treturn value;\n\n\t\t},\n\n\t\tencode: function(rawStr) {\n\t\t\treturn rawStr.replace(/[\\u00A0-\\u9999<>&]/gim, function(i) {\n\t\t\t\treturn '&#' + i.charCodeAt(0) + ';';\n\t\t\t});\n\t\t},\n\n\t\t/**\n\t\t * Makes data to JSON past\n\t\t * @param data\n\t\t * @param [inputName]\n\t\t * @returns {string}\n\t\t */\n\t\tjsonData: function(data, inputName) {\n\t\t\treturn '<script type=\"application/json\"' + (inputName ? (' input-name=\"' + inputName + '\"') : \"\") + '>' + sky.encode(JSON.stringify(data)) + '</script>';\n\t\t},\n\n\t\tprepareSelectData: function(items, func, {columnSplitOn = 6, maxColumns = 4}) {\n\n\t\t\tlet index        = 0,\n\t\t\t\tcolumns      = [],\n\t\t\t\tcolumnsCount = items.length / columnSplitOn,\n\t\t\t\tgroupHolder,\n\t\t\t\tcompiled;\n\n\t\t\tif(columnsCount < 1)\n\t\t\t\tcolumnsCount = 1;\n\t\t\tif(columnsCount > maxColumns)\n\t\t\t\tcolumnsCount = maxColumns;\n\n\t\t\tlet perColumn = Math.ceil(items.length / columnsCount);\n\n\t\t\tfor(let item of items) {\n\t\t\t\tif(compiled = func({item, index, column: columns.length})) {\n\n\t\t\t\t\tif(index % perColumn === 0) {\n\t\t\t\t\t\tgroupHolder = [];\n\t\t\t\t\t\tcolumns.push(groupHolder);\n\t\t\t\t\t}\n\n\t\t\t\t\tgroupHolder.push(compiled);\n\t\t\t\t\tindex++;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn index === 0 ? [] : {groups: columns}\n\n\t\t}\n\t}\n});","sky.action(\"tips\", ({ tips }) => {\n\n\t// Get\n\tlet body = $('body'),\n\t\tevents  = body.attr(\"data-event\") || \"\",\n\t\tevent   = \"click: tips.hideTips\";\n\n\t// Add\n\tbody.attr(\"data-event\", events ? events + \"; \" + event: event);\n\n\tlet self = {\n\n\t\tshowTip: function(button, _, name) {\n\n\t\t\tif(button.data(\"tip\")) {\n\t\t\t\tbutton.data(\"tip\").hide();\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// Hide others\n\t\t\tself.hideTips(button, false);\n\n\t\t\t// Create\n\t\t\tlet tip = tips.Tip(button, {\n\t\t\t\tcreate: $('<div/>').css(\"overflow\", \"hidden\").append($(\"#\" + name + \"TipText\").html())\n\t\t\t});\n\n\t\t\t// Show\n\t\t\ttip.show(\"top\");\n\n\t\t},\n\n\t\tshowTipWithText: function(button, _, text) {\n\n\t\t\tif(button.data(\"tip\")) {\n\t\t\t\tbutton.data(\"tip\").hide();\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// Hide others\n\t\t\tself.hideTips(button, false);\n\n\t\t\t// Create\n\t\t\tlet tip = tips.Tip(button, {\n\t\t\t\tcreate: $('<div/>').css(\"overflow\", \"hidden\").append(text)\n\t\t\t});\n\n\t\t\t// Show\n\t\t\ttip.show(\"top\");\n\n\t\t},\n\n\t\thideTips: function(element, event) {\n\t\t\ttips.hideAll(false, $(event.target));\n\t\t},\n\n\t\t/**\n\t\t *\n\t\t */\n\t\tforceHideTips: function() {\n\t\t\ttips.hideAll(true);\n\t\t}\n\t};\n\treturn self;\n});","sky.directive(\"[data-tip]\", function(button, attributes) {\n\n\t// Get\n\tlet events  = attributes[\"data-event\"] || \"\",\n\t\ttipName = attributes[\"data-tip\"],\n\t\tevent   = \"click: tips.showTip('\" + tipName + \"')\";\n\n\t// Set new\n\tevents = events ? events + \"; \" + event: event;\n\n\t// Add\n\tbutton.attr(\"data-event\", events).addClass(\"dashed\");\n\n});\nsky.directive(\"[data-tip-text]\", function(button, attributes) {\n\n\t// Get\n\tlet events  = attributes[\"data-event\"] || \"\",\n\t\ttipText = attributes[\"data-tip-hover\"] || attributes[\"data-tip-text\"],\n\t\tevent   = \"click: tips.showTipWithText('\" + tipText + \"')\";\n\n\t// Set new\n\tevents = events ? events + \"; \" + event: event;\n\n\t// Add\n\tbutton.attr(\"data-event\", events).addClass(\"dashed\");\n\n});\nsky.directive(\"[data-tip-hover]\", function(button, attributes) {\n\n\t// Get\n\tlet tipText = attributes[\"data-tip-hover\"];\n\n\tsky.service(\"tips\").bind(button, \"top\", {create: tipText});\n\n\t// Set new\n\tlet events = attributes[\"data-event\"] || \"\",\n\t\tevent  = \"click: tips.showTipWithText('\" + tipText + \"')\";\n\tevents = events ? events + \"; \" + event : event;\n\n\t// Add\n\tbutton.attr(\"data-event\", events).addClass(\"dashed\");\n\n});","sky.service(\"tips\", [\"stackList\", \"callbacks\"], function({ stackList, callbacks }) {\n\n    /** Class to work with tips */\n    let list = stackList(),\n        tips = this.service = {\n\n\t\t\t/**\n\t\t\t * Hides all visible tips\n\t\t\t * @param withoutAutoHide\n\t\t\t * @param caller\n\t\t\t */\n        hideAll: function(withoutAutoHide, caller) {\n\n            /* Hide all tips */\n            list.each((tip) => {\n                if(withoutAutoHide)\n\t\t\t\t\ttip.hide();\n                else if(tip.autoHide && (!caller || !caller.closest(tip.tip).length && !caller.closest(tip.object).length)) {\n\t\t\t\t\ttip.hide();\n                }\n            });\n\n        },\n\n        /**\n         * Returns last open window if any\n         * @returns {tips.Tip|boolean}\n         */\n        getLast: function() {\n            list.last();\n        },\n\n        /**\n         * Add show/hide functions\n         * @param {string}            selector            Object to bind tips for\n         * @param {string}            align                Align of tip\n         * @param options\n         * @see tips.tip\n         */\n        bind: function(selector, align, options) {\n\n            /* Create binds */\n            $(selector).on({\n                \"mouseenter\": function() {\n                    let tip = $(this).data(\"tip\") || tips.Tip(this, options).show(align);\n                },\n                \"mouseleave\": function() {\n                    let tip = $(this).data(\"tip\");\n                    if(tip) tip.hide(align);\n                }\n            });\n\n        },\n\n        /**\n         * Creates new tip object\n         * @param {object}            object                Object to show tip for\n         * @param autoHide\n         * @param create\n         * @param close\n         * @param ajax\n         * @param highlight\n         * @param className\n         * @constructor\n         */\n        Tip: function(object, { autoHide = true, create = false, close = false, ajax = false, highlight = false, className = false } = {}) {\n\n            /* Auto construct */\n            if(!(this instanceof tips.Tip))\n                return new tips.Tip(object, { autoHide, create, close, ajax, highlight, className });\n\n            /* Old tip exists */\n            if($(object).data(\"tip\"))\n                return $(object).data(\"tip\");\n\n            /* Add to list */\n\t\t\tlist.add(this);\n\n            /* Manual create tip by create function */\n            if(typeof create === \"function\") {\n\n                /* Create tip */\n                this.tip = create(object);\n\n                /* If no tip */\n                if(!this.tip) return this;\n\n            }\n\n            /* Object set */\n            this.object = $(object).data(\"tip\", this);\n\n            /* Save callbacks */\n            this.callbacks = callbacks();\n\n            /* Auto hide */\n            this.autoHide = autoHide;\n\n            /* Manual create tip by create function */\n            if(typeof create !== \"function\") {\n\n                /* Create tip */\n                this.tip = $(\"<div/>\").addClass(\"tip\").append('<div class=\"tipContent\"></div>').insertBefore(object);\n\n                /* Title using */\n                if(!create && this.object.attr('title'))\n\t\t\t\t\tcreate = this.object.attr('title');\n                else if(!create)\n\t\t\t\t\tcreate = \"Пожалуйста подождите\";\n\n                this.tip.find(\".tipContent\").append(create);\n\n            }\n\n            if(highlight)\n                this.shadow = $('<div/>').css({ opacity: 0, position:\"absolute\", width: \"100%\", height: \"100%\", left:0 ,top:0, background: \"rgba(0,0,0,0.5)\" }).appendTo(\"body\");\n\n            /* If count down */\n            if(typeof close === \"number\")\n                this.closeTimeout = setTimeout(() => this.hide(), close);\n\n            /* If close button */\n            else if(close)\n                $('<div/>').addClass('close').appendTo(this.tip).on(\"click\", () => this.hide());\n\n            /* If stop possible */\n            if(ajax)  ajax.on(\"always\", () => this.hide());\n\n            /* Add to list */\n            if(className)\n                this.tip.addClass(className);\n\n            /* Add to list */\n            this.tip.css(\"display\", \"none\");\n\n            return this;\n\n        }\n\n    };\n\n    /**\n     * Extends tip\n     */\n    $.extend(tips.Tip.prototype, /** @lends tips.tip */ {\n\n        /**\n         * Shows tip according to type\n         * @param {string} [align] Way it would be shown\n         */\n        show: function(align) {\n\n            /* Back link */\n            let self   = this;\n            let offset = this.tip.css({left: \"\", top: \"\", marginLeft: \"\", marginTop: \"\", display: \"\"}).addClass(align).offset();\n\n            /* Stop animation and shows */\n            this.tip.stop();\n\n            /* Save way to show */\n            if(align) this.align = align;\n\n            /* If shadow */\n            if(this.shadow)\n                this.shadow.stop().show().animate({opacity: 1}, 100);\n\n            /* Different actions according to tip position */\n            switch(this.align) {\n\n                /* If show righter than input */\n                case \"right\":\n                {\n                    this.tip.css({\n                        marginLeft: this.object.offset().left + this.object.outerWidth() - offset.left,\n                        marginTop : this.object.offset().top - offset.top + parseInt((this.object.outerHeight() - this.tip.outerHeight()) / 2),\n                        opacity   : 0\n                    });\n                    this.tip.animate({opacity: 1, marginLeft: \"+=10\"}, 100);\n                    break;\n                }\n                /* If show righter than input */\n                case \"left\":\n                {\n                    this.tip.css({\n                        marginLeft: this.object.offset().left - offset.left - this.tip.outerWidth(),\n                        marginTop : this.object.offset().top - offset.top + parseInt((this.object.outerHeight() - this.tip.outerHeight()) / 2),\n                        opacity   : 0\n                    });\n                    this.tip.animate({opacity: 1, marginLeft: \"-=10\"}, 300);\n                    break;\n                }\n                /* If show topper */\n                case \"top\":\n                {\n\n                    // Count left offset\n                    let left = this.object.offset().left - offset.left;\n\n                    /* Reposition */\n                    if(offset.left + left + this.tip.outerWidth() > $(window).outerWidth())\n                        left = left - this.tip.outerWidth() + this.object.outerWidth();\n\n                    /* Position */\n                    this.tip.css({\n                        marginLeft: left,\n                        marginTop : this.object.offset().top - this.tip.outerHeight() - offset.top,\n                        opacity   : 0\n                    });\n\n                    this.tip.animate({opacity: 1, marginTop: \"-=10\"}, 300);\n                    break;\n                }\n                /* If show topper */\n                case \"bottom\":\n                {\n\n                    let left = this.object.offset().left - offset.left;\n\n                    /* Reposition */\n                    if(offset.left + left + this.tip.outerWidth() > $(window).outerWidth())\n                        left = left - this.tip.outerWidth() + this.object.outerWidth();\n\n                    /* Position */\n                    this.tip.css({\n                        marginLeft: left,\n                        marginTop : this.object.offset().top + this.object.outerHeight() - offset.top,\n                        opacity   : 0\n                    });\n\n                    this.tip.animate({opacity: 1, marginTop: \"+=10\"}, 300);\n                    break;\n                }\n                /* If we replace input with tip */\n                case \"instead\":\n                {\n                    this.tip.css({\n                        width  : this.object.outerWidth(),\n                        height : this.object.outerHeight(),\n                        display: \"none\"\n                    });\n                    this.object.fadeOut(100, function() {\n                        self.tip.fadeIn(100);\n                    }).get(0).blur();\n                    break;\n                }\n                case \"inside\":\n                {\n                    this.tip.css({\n                        width  : this.object.outerWidth(),\n                        height : this.object.outerHeight(),\n                        display: \"none\"\n                    });\n                    this.tip.css(\"opacity\", 0).animate({opacity: 1}, 100);\n                    break;\n                }\n                default:\n                    break;\n            }\n\n            this.tip.css({left: \"\", top: \"\"});\n\n            /* Self return */\n            return this;\n\n        },\n\n        /**\n         * Hides current tip\n         */\n        hide: function() {\n\n            /* Remove count down if needed */\n            if(this.closeTimeout)\n                clearTimeout(this.closeTimeout);\n\n            /* Stop animation */\n            this.tip.stop();\n\n            /* Get know how tip was shown */\n            let align = this.align;\n\n            /* Create end animation callback */\n            let callback = () => {\n\n                /* Delete record from global list */\n                list.remove(this);\n\n                /* Remove data */\n                this.object.removeData(\"tip\");\n\n                /* Remove tip */\n                this.tip.remove();\n\n                /* Callback */\n                this.callbacks.fire(\"hide\", this);\n\n            };\n\n            /* If just shown */\n            if(!align)\n                callback();\n\n            /* If shadow */\n            if(this.shadow)\n                this.shadow.animate({opacity: 0}, 100, () => { this.shadow.remove() });\n\n            /* Right way hide */\n            if(align === \"right\")\n                this.tip.animate({opacity: 0, marginLeft: \"+=10\"}, 100, callback);\n\n            /* Left way hide */\n            if(align === \"left\")\n                this.tip.animate({opacity: 0, marginLeft: \"-=10\"}, 100, callback);\n\n            /* Instead way hide */\n            if(align === \"instead\")\n                this.tip.fadeOut({opacity: 0}, 200, callback);\n\n            /* Top way hide */\n            if(align === \"top\")\n                this.tip.animate({opacity: 0, marginTop: \"-=5\"}, 200, callback);\n\n            /* Bottom way hide */\n            if(align === \"bottom\")\n                this.tip.animate({opacity: 0, marginTop: \"+=5\"}, 200, callback);\n\n            /* Inside way hide */\n            if(align === \"inside\")\n                this.tip.animate({opacity: 0}, 200, callback);\n\n            /* Self return */\n            return this;\n\n        },\n\n        /**\n         * Gets tips dom\n         * @returns {*}\n         */\n        get: function() {\n            return this.tip;\n        },\n\n        /**\n         * Sets tip text\n         * @param {string|jQuery} text What to insert to tip body\n         */\n        set: function(text) {\n            this.tip.children(\".tipContent\").html(text);\n            return this;\n        },\n\n        /**\n         * Adds something to tip\n         * @param {string|jQuery} what What to append to tip body\n         */\n        add: function(what) {\n            this.tip.children(\".tipContent\").append(what);\n            return this;\n        }\n\n    });\n\n});","sky.onReady(function({ validator }) {\n\tjQuery.fn.validForm = function() {\n\t\treturn validator.validateForm(this);\n\t}.safe();\n\tjQuery.fn.validationRule = function(name, options) {\n\t\treturn validator.addRule(this, name, options);\n\t}.safe();\n\t$(document).on(\"change keyup\", \"[data-validate]\", function() {\n\t\tvalidator.validateElement($(this));\n\t});\n});\n\nsky.service(\"validator\", function() {\n\n\t/**\n\t * Main validation object\n\t */\n\tlet validator = this.service = {\n\n\t\t/**\n\t\t * Validates specified form, or dom element\n\t\t * @param form\n\t\t */\n\t\tvalidateForm: function(form) {\n\n\t\t\tlet pass = true,\n\t\t\t\tself = this;\n\n\t\t\t/* Go through all elements that need to be validate */\n\t\t\tform.find(\"input, select, textarea, .selectReplace, [data-validate]\").filter(\":visible\").each(function() {\n\n\t\t\t\t/* Get element */\n\t\t\t\tlet element = $(this);\n\n\t\t\t\t/* validate if needed to */\n\t\t\t\tif(self.shouldBeValidated(element) && !self.validateElement(element, form))\n\t\t\t\t\tpass = false;\n\n\t\t\t});\n\n\t\t\t/* Return result */\n\t\t\treturn pass;\n\n\t\t},\n\n\t\t/**\n\t\t * Add rule to specified element\n\t\t * @param element\n\t\t * @param name\n\t\t * @param [options]\n\t\t */\n\t\taddRule: function(element, name, options) {\n\n\t\t\t/* Get or make options and add rule */\n\t\t\tthis.Options(element).addRule(name, options || {});\n\n\t\t\t/* Self return */\n\t\t\treturn this;\n\n\t\t},\n\n\t\t/**\n\t\t *\n\t\t * Validates specified element\n\t\t * @param {*} element Element to validate\n\t\t * @param {*} [form] Form to validate\n\t\t * @returns {boolean}\n\t\t */\n\t\tvalidateElement: function(element, form) {\n\n\t\t\tlet self = this,\n\t\t\t\toptions = this.Options(element),\n\t\t\t\ttotalPass = true,\n\t\t\t\tvalue = element.val(),\n\t\t\t\tlastError = false,\n\t\t\t\tfirstError = false,\n\t\t\t\tlastSuccess = false,\n\t\t\t\tfirstSuccess = false;\n\n\t\t\t/* Select replace */\n\t\t\tif(element.is(\".selectReplace\")) {\n\t\t\t\tlet inputs = element.next().find(\"input:checked\");\n\t\t\t\tif(!inputs.length)\n\t\t\t\t\tvalue = \"\";\n\t\t\t\telse if(element.is(\".single\"))\n\t\t\t\t\tvalue = element.next().find(\"input:checked\").val();\n\t\t\t\telse\n\t\t\t\t\tvalue = element.next().find(\"input:checked\").length ? \"true\" : \"\";\n\t\t\t}\n\n\t\t\t/* Go through rules */\n\t\t\t$.each(options.rules, function(name, ruleOverload) {\n\n\t\t\t\t/* Make compiled rule */\n\t\t\t\tlet compiledRule = jQuery.extend(true, {}, self.rules[name] || self.Rule({}), ruleOverload || {});\n\n\t\t\t\t/* Execute message is needed */\n\t\t\t\tif(typeof compiledRule.message === \"function\")\n\t\t\t\t\tcompiledRule.message = compiledRule.message.call(this);\n\n\t\t\t\t/* Check if element pass validation */\n\t\t\t\tlet pass = self.validate(value, compiledRule, element, form);\n\n\t\t\t\t/* Perform action according to result */\n\t\t\t\tif(pass) {\n\t\t\t\t\tcompiledRule.onSuccess(element, compiledRule);\n\t\t\t\t\tlastSuccess = compiledRule;\n\t\t\t\t\tif(!firstSuccess)\n\t\t\t\t\t\tfirstSuccess = compiledRule;\n\t\t\t\t} else {\n\t\t\t\t\tcompiledRule.onError(element, compiledRule);\n\t\t\t\t\tlastError = compiledRule;\n\t\t\t\t\tif(!firstError)\n\t\t\t\t\t\tfirstError = compiledRule;\n\t\t\t\t\ttotalPass = false;\n\t\t\t\t}\n\n\t\t\t});\n\n\t\t\t/* Total callbacks */\n\t\t\tif(totalPass)\n\t\t\t\toptions.onSuccess(element, lastSuccess);\n\t\t\telse\n\t\t\t\toptions.onError(element, firstError);\n\n\t\t\t/* Return true of element passed all validations */\n\t\t\treturn totalPass;\n\n\t\t},\n\n\t\t/**\n\t\t * Return true if element should be validated\n\t\t * @param {*} element Element to validate\n\t\t * @returns {boolean}\n\t\t */\n\t\tshouldBeValidated: function(element) {\n\t\t\treturn element.attr(\"data-validate\") || element.data(\"validationOptions\");\n\t\t},\n\n\t\t/**\n\t\t * Return true if element passed validation\n\t\t * @param element\n\t\t * @param compiledRule\n\t\t * @param form\n\t\t * @returns {*}\n\t\t * @param value\n\t\t */\n\t\tvalidate: function(value, compiledRule, element, form) {\n\t\t\treturn compiledRule.rule.call(compiledRule, value, element, form);\n\t\t}\n\n\t};\n\n\t/**\n\t * Defaults\n\t */\n\tvalidator.ruleDefaults = {\n\n\t};\n\n\t/**\n\t * Defaults\n\t * @type {{onSuccess: onSuccess, onError: onError}}\n\t */\n\tvalidator.optionsDefaults = {\n\n\t\t/* Fires on success */\n\t\tonSuccess: function(element) {\n\n\t\t\t/* Remove error */\n\t\t\telement.removeClass(this.errorClass);\n\n\t\t\t/* Add success */\n\t\t\tif(this.successClass)\n\t\t\t\telement.addClass(this.successClass);\n\n\t\t},\n\n\t\t/* Fires on error */\n\t\tonError: function(element) {\n\n\t\t\t/* Add error */\n\t\t\telement.addClass(this.errorClass);\n\n\t\t\t/* Remove success */\n\t\t\tif(this.successClass)\n\t\t\t\telement.removeClass(this.successClass);\n\n\t\t}\n\t};\n\n\t/**\n\t * Base rule object\n\t * @param overload\n\t * @returns {validator.Rule}\n\t * @constructor\n\t */\n\tvalidator.Rule = function(overload) {\n\n\t\t/* Self creation if needed */\n\t\tif(!(this instanceof validator.Rule))\n\t\t\treturn new validator.Rule(overload);\n\n\t\t/* Dump rule to check validation */\n\t\tthis.rule = function() { return true; };\n\n\t\t/* Dump message */\n\t\tthis.message = \"Это поле заполнено не верно\";\n\n\t\t/* List of options to make validation according to */\n\t\tthis.options = [];\n\n\t\t/* Fires on success */\n\t\tthis.onSuccess = function(element) {};\n\n\t\t/* Fires on error */\n\t\tthis.onError = function(element) {};\n\n\t\t/* Self extend with overload */\n\t\tjQuery.extend(this, overload);\n\n\t\t/* Return */\n\t\treturn this;\n\n\t};\n\n\t/**\n\t * List of default rules\n\t * @type {{required: validator.Rule}}\n\t */\n\tvalidator.rules = {\n\t\trequired: validator.Rule({\n\t\t\trule: function(value) {\n\t\t\t\treturn !!value.length;\n\t\t\t},\n\t\t\tmessage: \"Это поле необходимо заполнить\"\n\t\t}),\n\t\trequiredIfFilled: validator.Rule({\n\t\t\trule: function(value) {\n\t\t\t\tlet item = $(this.options[0]);\n\t\t\t\treturn item.is(\":radio, :checkbox\") ? !item.is(\":checked\") || value : item.val() === \"\" || value;\n\t\t\t},\n\t\t\tmessage: \"Это поле необходимо заполнить\"\n\t\t}),\n\t\tdate: validator.Rule({\n\t\t\trule: function(value) {\n\t\t\t\treturn !value || (\n\t\t\t\t\tvalue.match(/^\\d{4}-\\d{2}-\\d{2}( \\d{2}:\\d{2}(:\\d{2})?)?$/) ||\n\t\t\t\t\tvalue.match(/^\\d{2}.\\d{2}.\\d{4}( \\d{2}:\\d{2}(:\\d{2})?)?$/)\n\t\t\t\t\t);\n\t\t\t},\n\t\t\tmessage: \"Дата указана неверно\"\n\t\t}),\n\t\tperiod: validator.Rule({\n\t\t\trule: function(value) {\n\t\t\t\treturn !value || (\n\t\t\t\t\tvalue.match(/^\\d{4}-\\d{2}-\\d{2}$/) ||\n\t\t\t\t\tvalue.match(/^\\d{2}.\\d{2}.\\d{4}$/) ||\n\t\t\t\t\tvalue.match(/^\\d{2}.\\d{2}.\\d{4}\\s*-\\s*\\d{2}.\\d{2}.\\d{4}$/) ||\n\t\t\t\t\tvalue.match(/^\\d{4}-\\d{2}-\\d{2}\\s*-\\s*\\d{4}-\\d{2}-\\d{2}$/)\n\t\t\t\t\t);\n\t\t\t},\n\t\t\tmessage: \"Период указан неверно\"\n\t\t}),\n\t\temail: validator.Rule({\n\t\t\trule: function(value) {\n\t\t\t\treturn value && value.match(/[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*@(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?/);\n\t\t\t},\n\t\t\tmessage: \"Почтовый адрес указан неверно\"\n\t\t}),\n\t\tsame: validator.Rule({\n\t\t\trule: function(value) {\n\t\t\t\treturn value === $('[name=\"' + this.options[0] + '\"]').val();\n\t\t\t},\n\t\t\tmessage: \"Поля не совпадают\"\n\t\t}),\n\t\turl: validator.Rule({\n\t\t\trule: function(value) {\n\t\t\t\treturn value === \"\" || value.match(/^(https?:\\/\\/.+)$/);\n\t\t\t},\n\t\t\tmessage: \"Не корректный адрес URI\"\n\t\t}),\n\t\tregexp: validator.Rule({\n\t\t\trule: function(value) {\n\t\t\t\treturn value === \"\" || value.match(new RegExp(this.options[0]));\n\t\t\t},\n\t\t\tmessage: \"Введите корректное значение\"\n\t\t}),\n\t\tnumeric: validator.Rule({\n\t\t\trule: function(value) {\n\t\t\t\treturn value === \"\" || value.match(/^-?[0-9]+(\\.[0-9]+)?$/);\n\t\t\t},\n\t\t\tmessage: \"Введите число\"\n\t\t}),\n\t\tpositive: validator.Rule({\n\t\t\trule: function(value) {\n\t\t\t\treturn value === \"\" || value.match(/^[0-9]+(\\.[0-9]+)?$/) && parseFloat(value) > 0;\n\t\t\t},\n\t\t\tmessage: \"Введите положительное число\"\n\t\t}),\n\t\tmax: validator.Rule({\n\t\t\trule: function(value) {\n\t\t\t\treturn value === \"\" || value.match(/^[0-9]+(\\.[0-9]+)?$/) && parseFloat(value) <= parseFloat(this.options[0] || 0);\n\t\t\t},\n\t\t\tmessage: function() {\n\t\t\t\treturn \"Введите число, не обльше чем \" + (this.options[0] || 0)\n\t\t\t}\n\t\t}),\n\t\tmin: validator.Rule({\n\t\t\trule: function(value) {\n\t\t\t\treturn value === \"\" || value.match(/^[0-9]+(\\.[0-9]+)?$/) && parseFloat(value) >= parseFloat(this.options[0] || 0);\n\t\t\t},\n\t\t\tmessage: function() {\n\t\t\t\treturn \"Введите число, не меньше чем \" + (this.options[0] || 0);\n\t\t\t}\n\t\t}),\n\t\tminLength: validator.Rule({\n\t\t\trule: function(value) {\n\t\t\t\treturn value === \"\" || value.length >= (this.options[0] || 0)\n\t\t\t},\n\t\t\tmessage: \"В этом поле нехватает символов\"\n\t\t}),\n\t\tmaxLength: validator.Rule({\n\t\t\trule: function(value) {\n\t\t\t\treturn value === \"\" || value.length <= (this.options[0] || 0)\n\t\t\t},\n\t\t\tmessage: \"В этом поле слишком много символов\"\n\t\t})\n\t};\n\n\t/**\n\t * Holds element validation options\n\t * @param element\n\t * @constructor\n\t */\n\tvalidator.Options = function(element) {\n\n\t\t/* Create or return */\n\t\tif(!(this instanceof validator.Options))\n\t\t\treturn element.data(\"validationOptions\") || new validator.Options(element);\n\n\t\t/* Callbacks after all checks */\n\t\tthis.onSuccess = function() {};\n\t\tthis.onError = function() {};\n\n\t\t/* Adds to element on success */\n\t\tthis.successClass = false;\n\n\t\t/* Adds to element on error */\n\t\tthis.errorClass   = \"error\";\n\n\t\t/* Overlay defaults */\n\t\tjQuery.extend(true, this, validator.optionsDefaults);\n\n\t\t/* Holds list of validating rules */\n\t\tthis.rules = {};\n\n\t\t/* Save element */\n\t\tthis.element = element;\n\n\t\t/* Get rules that declared in element definition */\n\t\tthis.getDeclaredRules();\n\n\t\t/* Save option */\n\t\tthis.element.data(\"validationOptions\", this);\n\n\t\t/* Self return */\n\t\treturn this;\n\n\t};\n\n\tvalidator.Options.prototype = {\n\n\t\t/**\n\t\t * Gets list of rules that are set in declared way\n\t\t */\n\t\tgetDeclaredRules: function() {\n\n\t\t\t/* Get attribute value */\n\t\t\tlet attr = this.element.attr(\"data-validate\"),\n\t\t\t\tself = this;\n\n\t\t\t/* If none */\n\t\t\tif(!attr)\n\t\t\t\treturn;\n\n\t\t\t/* Get list */\n\t\t\t$.each(attr.split(\";\"), function(_, name) {\n\n\t\t\t\t/* Get parameters */\n\t\t\t\tlet params = name.match(/(\\w+)\\((.*)\\)/);\n\n\t\t\t\t/* Parse */\n\t\t\t\tif(params) {\n\n\t\t\t\t\t/* Get function */\n\t\t\t\t\tname = params[1];\n\n\t\t\t\t\t/* Parse params */\n\t\t\t\t\tparams = params[2].match(/(('[^']+')|([\\d\\w]+))/g);\n\t\t\t\t\t$.each(params, function(i, val) {\n\t\t\t\t\t\tparams[i] = eval(val.trim());\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\t/* Add rule to options */\n\t\t\t\tself.addRule(name.trim(), { options: params || [] });\n\n\t\t\t});\n\n\n\t\t},\n\n\t\t/**\n\t\t * Adds new rule for element\n\t\t * @param {string} name Rule name\n\t\t * @param {object} options Rule options\n\t\t * @returns {validator.Options}\n\t\t */\n\t\taddRule: function(name, options) {\n\n\t\t\t/* Create and save new rule */\n\t\t\tthis.rules[name] = jQuery.extend({}, validator.ruleDefaults, options);\n\n\t\t\t/* Mark for auto validation */\n\t\t\tif(!this.element.attr(\"data-validate\"))\n\t\t\t\tthis.element.attr(\"data-validate\", \"true\");\n\n\t\t\t/* Self returning */\n\t\t\treturn this;\n\t\t}\n\n\t}\n\n});","sky.service(\"visibleCalculator\", function() {\n\n\tlet Calculator = class {\n\n\t\tconstructor(holder, minHeight, scrollable) {\n\n\t\t\t/* Check if class */\n\t\t\tif(!(this instanceof Calculator))\n\t\t\t\treturn new Calculator(holder, minHeight, scrollable);\n\n\t\t\t/* Re get holder */\n\t\t\tthis.holder = $(holder);\n\t\t\tthis.scrollable = scrollable || $('body');\n\t\t\tthis.minHeight = minHeight || 0;\n\n\t\t\t/* Init */\n\t\t\tthis.init();\n\n\t\t}\n\n\t\t/* Init func */\n\t\tinit() {\n\n\t\t\t/* Count offset */\n\t\t\tlet offset = this.holder.offset();\n\n\t\t\t/* Get holder rect */\n\t\t\tthis.holderRect = {\n\t\t\t\tleft  : offset.left,\n\t\t\t\ttop   : offset.top,\n\t\t\t\twidth : this.holder.outerWidth(),\n\t\t\t\theight: this.holder.outerHeight()\n\t\t\t};\n\n\t\t}\n\n\t\t/* Calculating function */\n\t\tcalculate() {\n\n\t\t\t/* How much is scrolled */\n\t\t\tlet scrollTop    = $(this.scrollable).scrollTop(),\n\t\t\t\twindowHeight = $(window).height(),\n\t\t\t\twindowWidth  = $(window).width(),\n\t\t\t\tsizes        = {\n\t\t\t\t\tleft        : this.holderRect.left,\n\t\t\t\t\tright       : this.holderRect.left + this.holderRect.width,\n\t\t\t\t\ttop         : this.holderRect.top - scrollTop,\n\t\t\t\t\twidth       : this.holderRect.width,\n\t\t\t\t\theight      : this.holderRect.height,\n\t\t\t\t\trealHeight  : this.holderRect.height,\n\t\t\t\t\tbottom\t\t: 0,\n\t\t\t\t\tscrollTop   : scrollTop,\n\t\t\t\t\tscrollLeft  : 0,\n\t\t\t\t\twindowHeight: windowHeight,\n\t\t\t\t\twindowWidth : windowWidth,\n\t\t\t\t};\n\n\t\t\t/* Min height */\n\t\t\tif(sizes.height < this.minHeight)\n\t\t\t\tsizes.height = this.minHeight;\n\n\t\t\t/* Count bottom */\n\t\t\tsizes.bottom = sizes.top + sizes.height;\n\n\t\t\t/* If top border near than holder */\n\t\t\tif(sizes.top < 0) {\n\t\t\t\t// If visible less than min\n\t\t\t\tif(sizes.bottom < this.minHeight) {\n\t\t\t\t\tsizes.bottom = sizes.bottom < 0 ? 0 : sizes.bottom;\n\t\t\t\t\tsizes.top = sizes.bottom - this.minHeight;\n\t\t\t\t\tsizes.height = this.minHeight;\n\t\t\t\t}\n\t\t\t\t// If visible more than min\n\t\t\t\telse {\n\t\t\t\t\tsizes.height = sizes.bottom;\n\t\t\t\t\tsizes.top = 0;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t/* Get visible bottom */\n\t\t\tif(windowHeight < sizes.bottom) {\n\t\t\t\t// If visible less than min\n\t\t\t\tif(windowHeight - sizes.top < this.minHeight) {\n\t\t\t\t\tsizes.height = this.minHeight;\n\t\t\t\t\tsizes.top = windowHeight - sizes.top < 0 ? 0 : sizes.top;\n\t\t\t\t\tsizes.bottom = sizes.top + this.minHeight;\n\t\t\t\t}\n\t\t\t\t// If visible more than min\n\t\t\t\telse {\n\t\t\t\t\tsizes.height = windowHeight - sizes.top;\n\t\t\t\t\tsizes.bottom = 0;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t/* Return */\n\t\t\treturn sizes;\n\n\t\t}\n\n\t\tgetDropOffset(replace, popup) {\n\n\t\t\t/* Get drop */\n\t\t\tif(!popup.is(\":visible\")) return;\n\n\t\t\t/* Set position to zeros to get max width and height */\n\t\t\tpopup.removeClass('hidden').css({left: 0, top: 0});\n\n\t\t\t/* Init */\n\t\t\tlet popupInnerWidth  = popup.innerWidth(),\n\t\t\t\tpopupWidth  = popup.outerWidth(),\n\t\t\t\tpopupHeight = popup.outerHeight();\n\n\t\t\t/* Reset position */\n\t\t\tpopup.css({marginLeft: \"\", marginTop: \"\", width: \"\", left: \"\", top: \"\"});\n\n\t\t\t/* Init */\n\t\t\tlet win            = $(window),\n\t\t\t\treplaceOffset  = replace.offset(),\n\t\t\t\tpopupOffset    = popup.offset(),\n\t\t\t\tleftDifference = popupOffset.left - replaceOffset.left,\n\t\t\t\ttopDifference  = popupOffset.top - replaceOffset.top,\n\t\t\t\tmiddle         = false,\n\t\t\t\tvisible        = this.calculate(),\n\t\t\t\ttop = 0, left = 0;\n\n\t\t\t// Drop down\n\t\t\tif(visible.bottom + popupHeight <= visible.windowHeight)\n\t\t\t\ttop = -topDifference + visible.realHeight + 1;\n\t\t\t// Drop up\n\t\t\telse if(visible.top > popupHeight)\n\t\t\t\ttop = -topDifference - 1 - popupHeight;\n\t\t\t// Drop left\n\t\t\telse {\n\t\t\t\ttop = -topDifference - (popupHeight - visible.realHeight) / 2;\n\t\t\t\tmiddle = true;\n\t\t\t}\n\t\t\t\n\t\t\t/* Set position */\n\t\t\tif(!middle) {\n\t\t\t\tif(visible.windowWidth > visible.left + popupWidth)\n\t\t\t\t\tleft = -leftDifference;\n\t\t\t\telse\n\t\t\t\t\tleft = -leftDifference - popupWidth + visible.width;\n\t\t\t} else {\n\t\t\t\tif(win.width() > replaceOffset.left + popupWidth + visible.width)\n\t\t\t\t\tleft = replaceOffset.left - popupOffset.left + visible.width;\n\t\t\t\telse\n\t\t\t\t\tleft = replaceOffset.left - popupOffset.left - popupWidth;\n\t\t\t}\n\n\t\t\treturn { top, left, width: popupInnerWidth };\n\t\t\t\n\t\t}\n\t};\n\tthis.service = Calculator;\n});","sky.service(\"history\", [ \"callbacks\", \"supported\" ], function ({ callbacks, supported }) {\n\n\n\t/**\n\t * Get difference fields in objects\n\t * @param {object} first  Object to compare\n\t * @param {object} second Object to compare\n\t */\n    let getObjectsDifference = function (first, second) {\n\n\t\tlet difference = {},\n\t\t    localDiff = false;\n\n        /* If both arrays or objects */\n\t\tif ((first instanceof Array && second instanceof Array) || (first instanceof Object && second instanceof Object)) {\n\n            /* Find what was changed or deleted in second */\n\t\t\t$.each(first, function (key, value) {\n\n                /* If no such elements in second */\n\t\t\t\tif (typeof second[key] === \"undefined\")\n\t\t\t\t\tdifference[key] = null; // Set to null\n\n                /* Check if different */\n\t\t\t\telse if (localDiff = getObjectsDifference(value, second[key])) {\n\t\t\t\t\tdifference[key] = localDiff;\n\t\t\t\t}\n\n\t\t\t});\n\n            /* If was added */\n\t\t\t$.each(second, function (key, value) {\n\t\t\t\tif (typeof first[key] === \"undefined\")\n\t\t\t\t\tdifference[key] = value;\n\t\t\t});\n\n            /* Convert object to array */\n\t\t\tif (first instanceof Array) {\n\t\t\t\tlet returnArray = [];\n\t\t\t\t$.each(difference, function (key) {\n\t\t\t\t\treturnArray.push(difference[key]);\n\t\t\t\t});\n\t\t\t\tdifference = returnArray;\n\t\t\t}\n\n\t\t} else {\n\t\t\tif (first !== second) return second;\n\t\t\telse return false;\n\t\t}\n\n        /* No array difference */\n\t\tif (difference.length === 0) return false;\n\t\telse return difference;\n\n\t};\n\n    /**\n     * History constructor\n     * @param [options]\n     * @returns {sky.History}\n     * @constructor\n     */\n    sky.History = function (options) {\n\n\t\t/* Self creation */\n        if (!(this instanceof sky.History))\n            return new sky.History(options);\n\n\t\t/* Reset */\n        this.options = options || {};\n\n\t\t/* Set events */\n        this.events = this.options.events || new callbacks();\n        this.options.events = this.events;\n\n\t\t/* Self return */\n        return this;\n\n    };\n\n    /**\n     * Extending\n     */\n    $.extend(sky.History.prototype, {\n\n        /**\n         * Stores last saved hash\n         */\n        hashString: \"\",\n\n        /**\n         * Stores last saved search\n         */\n        searchString: \"\",\n\n        /**\n         * Stores last saved path\n         */\n        pathString: \"\",\n\n        /**\n         * Stores object with hash params key/value pairs\n         */\n        hashObject: {},\n\n        /**\n         * Stores object with page search params key/value pairs\n         */\n        searchObject: {},\n\n        /**\n         * Stores events\n         */\n        events: undefined,\n\n        /**\n         * Holds hash check function interval id\n         */\n        intervalId: 0,\n\n        /**\n         * This page base url\n         */\n        base: \"\",\n\n        /**\n         * Changes current path to specified\n         * @param {string} path PAth to navigate\n         */\n        navigate: function (path) {\n\n            // Get path\n            path = path.replace(\"~\", this.base);\n\n            // Get current\n            let current = (window.location.pathname + window.location.search).substr(this.base.length);\n\n            // If changes\n            if (current !== path) {\n\n                // Set new state\n                history.pushState({ oldPath: this.pathString, newPath: path, search: this.searchObject}, path, path);\n\n                // Get new\n                this.pathString = window.location.pathname.substr(this.base.length);\n\n                // Get search string\n                this.searchString = this.getWindowSearch();\n\n                // Fire event\n                this.events.fire(\"navigate.path, always\", {hash: this.hashObject, path: this.pathString, search: this.searchObject});\n\n            }\n        },\n\n        /**\n         * Fires on path change\n         */\n        change: function () {\n\n\t\t\t/* Hash difference holder */\n            let hashDifference = {},\n                searchDifference = {},\n                old = this.pathString,\n                hashChanged = false,\n                searchChanged = false;\n\n\t\t\t/* If api supported */\n            if (this.supported)\n                this.pathString = window.location.pathname.substr(this.base.length);\n\n\t\t\t/* Check if hash changed */\n            if (this.hashString !== this.getWindowHash()) {\n\n\t\t\t\t/* Get difference */\n                hashDifference = this.getDifference(this.getWindowHash(), this.hashObject);\n\n\t\t\t\t/* Hash change flag */\n                hashChanged = true;\n\n            }\n\n\t\t\t/* Check if params changed */\n            if (this.searchString !== this.getWindowSearch()) {\n\n\t\t\t\t/* Get difference */\n                searchDifference = this.getDifference(this.getWindowSearch(), this.searchObject);\n\n\t\t\t\t/* Hash change flag */\n                searchChanged = true;\n\n            }\n\n\t\t\t/* If nothing changed */\n            if (this.pathString === old && !hashChanged && !searchChanged)\n                return;\n\n\t\t\t/* Rebuild hash object on new hash str */\n            this.rebuild();\n\n\t\t\t/* Fire */\n            this.events.fire(\"change, always\", {\n                hash: this.hashObject,\n                hashDifference: hashDifference,\n                searchDifference: searchDifference,\n                path: this.pathString,\n                oldPath: old,\n                searchChanged: searchChanged,\n                hashChanged: hashChanged,\n                pathChanged: old !== this.pathString\n            });\n\n        },\n\n        /**\n         * Navigates to specified path\n         * @param path\n         */\n        setHash: function (path) {\n\n\t\t\t/* To not jump top */\n            if (path === \"\" && window.location.hash !== \"\")\n                path = \"none\";\n\n\t\t\t/* Save */\n            this.hashString = path;\n\n\t\t\t/* Set hash */\n            window.location.hash = encodeURI(path);//encodeURI(path);\n\n        },\n\n        /**\n         * Navigates to specified path\n         * @param path\n         */\n        setSearch: function (path) {\n\n\t\t\t/* Set path */\n            this.navigate(window.location.pathname + encodeURI(path !== \"\" ? \"?\" + path : \"\"));\n\n        },\n\n        /**\n         * Sets hash letiable\n         * @param {object}    elements Fields to be set\n         * @param {boolean}    [force]     Replace all stored fields with elements object\n         */\n        set: function (elements, force) {\n\n            let changed = false;\n\n\t\t\t/* Force rewrite */\n            if (force)\n                this.hashObject = elements;\n\n\t\t\t/* Go through elements and add or change them */\n            $.each(elements, (key, value) => {\n\n\t\t\t\t/* If we need delete */\n                if (value === null)\n                    delete this.hashObject[key];\n                else\n                    this.hashObject[key] = value;\n\n\t\t\t\t/* Set as changed */\n                changed = true;\n\n            });\n\n\t\t\t/* If any changes we rebuild hash */\n            if (changed || force)\n                this.setHash(decodeURIComponent(jQuery.param(this.hashObject).replace(/\\+/g, \" \")));\n\n\t\t\t/* Fire */\n            this.events.fire(\"set, always\", {elements: elements, hash: this.hashObject, path: this.pathString});\n\n        },\n\n\n        /**\n         * Sets hash letiable\n         * @param {object}    elements Fields to be set\n         * @param {boolean}    [force]     Replace all stored fields with elements object\n         */\n        search: function (elements, force) {\n\n            let changed = false;\n\n\t\t\t/* Force rewrite */\n            if (force)\n                this.searchObject = elements;\n\n\t\t\t/* Go through elements and add or change them */\n            $.each(elements, $.proxy(function (key, value) {\n\n\t\t\t\t/* If we need delete */\n                if (value === null)\n                    delete this.searchObject[key];\n                else\n                    this.searchObject[key] = value;\n\n\t\t\t\t/* Set as changed */\n                changed = true;\n\n            }, this));\n\n\t\t\t/* If any changes we rebuild hash */\n            if (changed || force)\n                this.setSearch(decodeURIComponent(jQuery.param(this.searchObject).replace(/\\+/g, \" \")));\n\n\t\t\t/* Fire */\n\t\t\tthis.events.fire(\"set, always\", {elements: elements, hash: this.hashObject, path: this.pathString});\n\n        },\n\n        /**\n         * Makes hash from object\n         * @param obj\n         * @returns {*|void|string|XML}\n         */\n        stringFromObject: function (obj) {\n            return jQuery.param(obj).replace(/\\+/g, \" \");\n        },\n\n        /**\n         * Get objects according to hash string\n         * @param {string} paramsString String which contains key=value pairs, would be parsed to object\n         */\n        getObjects: function (paramsString) {\n\n            let objects = {};\n\n\t\t\t/* Remove sharp */\n            if (paramsString.substr(0, 1) === '#' || paramsString.substr(0, 1) === '?')\n                paramsString = paramsString.slice(1, paramsString.length);\n\n\t\t\t/* Split parameters */\n            let subStrings = paramsString.split(\"&\");\n\n\t\t\t/* Get params */\n            $.each(subStrings, function (i, str) {\n\n                let keyAndValue = str.split(\"=\", 2);\n\n\t\t\t\t/* If no assign */\n                if (keyAndValue.length < 2)\n                    return;\n\n                let name = keyAndValue[0];\n\n\t\t\t\t/* Truncate brackets */\n                if (name.substr(-2) === \"[]\")\n                    name = name.substr(0, name.length - 2);\n\n\t\t\t\t/* Special hash for \"=\" in value  */\n                keyAndValue[1] = str.substr(keyAndValue[0].length + 1);\n\n\t\t\t\t/* If object repeats we create array */\n                if (typeof objects[name] === \"undefined\") objects[name] = keyAndValue[1];\n                else {\n                    if (!(objects[name] instanceof Array)) objects[name] = [objects[name]];\n                    objects[name].push(keyAndValue[1]);\n                }\n            });\n\n            return objects;\n\n        },\n\n        /**\n         * Finds difference between current stored hash and parameter\n         * @returns {*}\n         */\n        getDifference: function (string, stored) {\n\n\t\t\t/* Init */\n            let objects = this.getObjects(decodeURI(string));\n            return getObjectsDifference(stored, objects);\n\n        },\n\n        /**\n         * Rebuilds stored hash parameters according to current one\n         */\n        rebuild: function () {\n            this.hashString = this.getWindowHash();\n            this.hashObject = this.getObjects(this.hashString);\n            this.searchString = this.getWindowSearch();\n            this.searchObject = this.getObjects(this.searchString);\n            this.pathString = window.location.pathname;\n            return this;\n\n        },\n\n        /**\n         * Gets current window hash without \"#\"\n         * @returns {string}\n         */\n        getWindowHash: function () {\n\n\t\t\t/* Get decoded hash */\n            let hash = decodeURI(window.location.hash);\n\n\t\t\t/* Remove sharp */\n            if (hash.substr(0, 1) === '#')\n                hash = hash.slice(1);\n\n\t\t\t/* Return */\n            return hash;\n\n        },\n\n        /**\n         * Gets current window parameters without \"?\"\n         * @returns {string}\n         */\n        getWindowSearch: function () {\n\n\t\t\t/* Get decoded hash */\n            let search = decodeURI(window.location.search);\n\n\t\t\t/* Remove question */\n            if (search.substr(0, 1) === '?')\n                search = search.slice(1);\n\n\t\t\t/* Return */\n            return search;\n\n        },\n\n        /**\n         * Set interval execution\n         */\n        start: function () {\n\n            /* Set base if any */\n\t\t\tif (this.options.base)\n\t\t\t\tthis.base = this.options.base;\n\n\t\t\t/* If supported history */\n            if (window.history)\n                window.onpopstate = this.change.bind(this);\n\n            /* Timeout */\n            if (!this.intervalId)\n                this.intervalId = setInterval(this.change.bind(this), this.options.time || 500);\n\n\t\t\t/* Immediately event */\n            this.change();\n            return this;\n        }\n\n    });\n\n});","/**\n * Holds classes to work with modal/new windows\n */\nsky.service('windows', [\"templates\", \"callbacks\", \"stackList\"], function ({templates, callbacks, stackList}) {\n\n\tlet tips = false,\n\t\tlist = stackList(),\n\t\twindows = this.service = {\n\t\t\t/**\n\t\t\t * Returns last open window if any\n\t\t\t * @returns {Modal|undefined}\n\t\t\t */\n\t\t\tgetLast: () => list.last(),\n\t\t\t/**\n\t\t\t * Returns new modal window\n\t\t\t * @returns {Modal}\n\t\t\t */\n\t\t\tmodal: (name, data) => new Modal(name, data),\n\n\t\t\tmodalAjax: (ajax) => {\n\t\t\t\ttry {\n\n\t\t\t\t\tlet loading = sky.service(\"ajaxLoadingIndicator\").loading(ajax, false),\n\t\t\t\t\t\tmodal = (new Modal(loading.render));\n\n\t\t\t\t\tajax.on(\"always\", () => { modal.unlock(); })\n\t\t\t\t\t\t.on(\"abort\", () => { modal.unlock().close(); })\n\t\t\t\t\t\t.on(\"error\", ({ error }) => {\n\t\t\t\t\t\t\tsky.service(\"notifications\").message({ text: error }).appendToModal(modal);\n\t\t\t\t\t\t});\n\n\t\t\t\t\tmodal.lock();\n\n\t\t\t\t} catch(e) {}\n\t\t\t}\n\n\t\t};\n\n\n\t/**\n\t * Creates new modal window\n\t * @param {*} name Window name\n\t * @param {*} [data] Data to send with request\n\t */\n\tclass Modal {\n\t\tconstructor (name, data) {\n\n\t\t\t/* Create window */\n\t\t\tthis.locked \t\t= false;\n\t\t\tthis.background \t= templates.render(\"windows-modal\", {}).appendTo(\"#pageContentHolder\").data(\"modalWindow\", this);\n\t\t\tthis.dataContainer \t= this.background.children();\n\t\t\tthis.holder \t\t= this.dataContainer.children(\".windowData\");\n\t\t\tthis.closeButton \t= this.dataContainer.children(\".close\");\n\n\t\t\t/* Make body un scrollable */\n\t\t\t$(document.body).css(\"overflow\", \"hidden\");\n\n\t\t\t/* Callbacks */\n\t\t\tthis.callbacks = callbacks();\n\n\t\t\t/* Render content */\n\t\t\ttry {\n\t\t\t\tthis.reRender(name, data);\n\t\t\t} catch (e) {\n\t\t\t\tthis.close(false);\n\t\t\t\tthrow e;\n\t\t\t}\n\n\t\t\t/* Return */\n\t\t\treturn this;\n\n\t\t}\n\n\t\t/**\n\t\t * Renders window content\n\t\t * @param {*} name Window name\n\t\t * @param {*} [data] Data to send with request\n\t\t */\n\t\treRender(name, data) {\n\n\t\t\t/* Close all tips */\n\t\t\tif(tips) tips.hideAll(true);\n\n\t\t\t/* Clear */\n\t\t\tthis.holder.html('');\n\n\t\t\t/* Render content */\n\t\t\tif (name instanceof jQuery)\n\t\t\t\tthis.template = name.appendTo(this.holder);\n\t\t\telse if (typeof name === \"string\")\n\t\t\t\tthis.template = templates.render(name, data).appendTo(this.holder);\n\n\t\t\t/* Self return */\n\t\t\treturn this;\n\t\t}\n\n\t\t/**\n\t\t * Removes all except that was rendered\n\t\t */\n\t\tclearExceptTemplate() {\n\t\t\tthis.holder.children().detach();\n\t\t\tthis.holder.append(this.template);\n\t\t}\n\n\t\t/**\n\t\t * Removes all except that was rendered\n\t\t */\n\t\tremoveNotifications() {\n\t\t\ttry {\n\t\t\t\tsky.service(\"notifications\").findInElement(this.holder).remove();\n\t\t\t} catch(e) {}\n\t\t}\n\n\t\t/**\n\t\t * Locks window so it can't be closed\n\t\t * @var {*} ajax Ajax object\n\t\t * @returns {Modal}\n\t\t */\n\t\tlock(ajax = false) {\n\t\t\tthis.locked = true;\n\t\t\tthis.closeButton.hide();\n\t\t\tif (ajax) ajax\n\t\t\t\t.on(\"preSuccess\", function () {\n\t\t\t\t\tthis.dataContainer.css(\"height\", this.dataContainer.innerHeight());\n\t\t\t\t}, this)\n\t\t\t\t.on(\"notAbort\", function () {\n\t\t\t\t\tlet self = this;\n\t\t\t\t\tthis.unlock();\n\t\t\t\t\tthis.dataContainer.css(\"height\", this.holder.outerHeight());\n\t\t\t\t\tsetTimeout(function () {\n\t\t\t\t\t\tself.dataContainer.css(\"height\", \"\");\n\t\t\t\t\t}, 500)\n\t\t\t\t}, this)\n\t\t\t\t.on(\"abort\", function () {\n\t\t\t\t\tthis.unlock().close();\n\t\t\t\t}, this);\n\t\t\treturn this;\n\t\t}\n\n\t\t/**\n\t\t * Unlocks window so it can be closed\n\t\t * @returns {Modal}\n\t\t */\n\t\tunlock() {\n\t\t\tthis.locked = false;\n\t\t\tthis.closeButton.show();\n\t\t\treturn this;\n\t\t}\n\n\t\t/**\n\t\t * Closes current window\n\t\t * @param {boolean} [byUser] Indicates that window was closed not by user\n\t\t */\n\t\tclose(byUser = false) {\n\n\t\t\t/* If windows is locked */\n\t\t\tif (this.locked)\n\t\t\t\treturn;\n\n\t\t\t/* Remove elements */\n\t\t\tthis.background.fadeOut(\"fast\", function () {\n\t\t\t\t$(this).remove()\n\t\t\t});\n\n\t\t\t/* Delete from list */\n\t\t\tlist.remove(this);\n\n\t\t\t/* Call close callback */\n\t\t\tthis.callbacks.fire(\"close\", {byUser: byUser});\n\n\t\t\t/* Close all tips */\n\t\t\ttry {\n\t\t\t\ttips = sky.service(\"tips\").hideAll(true);\n\t\t\t} catch (e) {}\n\n\t\t\t/* Make body scrollable */\n\t\t\tif (list.total() < 1)\n\t\t\t\t$(document.body).css(\"overflow\", \"\");\n\n\t\t\treturn this;\n\n\t\t}\n\t}\n\n\ttry {\n\t\ttips = sky.service(\"tips\");\n\t} catch (e) {}\n\n\t/* Add handler to black area click */\n\t$(document)\n\t\t.on(\"keyup\", sky.func(function (event) {\n\t\t\tlet last;\n\n\t\t\t/* If slide show was disabled */\n\t\t\tif (document[\"webkitIsFullScreen\"] || document[\"mozIsFullScreen\"] || document[\"isFullScreen\"])\n\t\t\t\treturn;\n\n\t\t\t/* Close current window */\n\t\t\tif (event.keyCode === 27 && (last = windows.getLast()))\n\t\t\t\tlast.close(true);\n\n\t\t}));\n\n});","sky.action(\"selectReplace\", function({ visibleCalculator }) {\n\n    let filter = function(self, event) {\n\n        /* Get drop */\n        let popup  = self.closest(\".selectReplaceChoose\"),\n            inputs = popup.find(\"input[name]\");\n\n        /* On enter */\n        if(event.which === 13) {\n            let visible = popup.find(\"label:visible\");\n            if(visible.length > 0) {\n                inputs.prop(\"checked\", false);\n                visible.children(\"input\").prop(\"checked\", true).trigger(\"change\");\n            }\n            event.stopPropagation();\n        }\n\n        /* Get value */\n\t\tlet value = self.val(),\n\t\t\t rus              = \"йцукенгшщзхъфывапролджэёячсмитьбю\",\n             eng              = \"qwertyuiop[]asdfghjkl;'\\\\zxcvbnm,.\",\n             expression       = new RegExp(value.toLowerCase()),\n             expressionInvert = new RegExp(value.toLowerCase().replace(/[a-zа-яё]/g, (character) => {\n                if(rus.indexOf(character) > -1) return eng[rus.indexOf(character)];\n                if(eng.indexOf(character) > -1) return rus[eng.indexOf(character)];\n                return character;\n            }));\n\n        /* Hide */\n        inputs.each((_, input) => {\n\n        \tinput = $(input);\n\n            if(input.parent().hasClass('hidden'))\n                return;\n\n            let inputHtml = input.next().html().toLowerCase();\n\n            try {\n                if(!inputHtml.match(expression) && !inputHtml.match(expressionInvert)) input.parent().hide();\n                else input.parent().show();\n            } catch(e) {}\n\n        });\n    };\n\n    return {\n\n        filter: filter,\n\n        selectAll: function(button) {\n\n            /* Get drop */\n            let popup = button.closest(\".selectReplaceChoose\");\n            popup.find(\":checkbox:visible\").prop(\"checked\", true).first().trigger(\"change\");\n\n        },\n\n        unSelectAll: function(button) {\n\n            /* Get drop */\n            let popup = button.closest(\".selectReplaceChoose\");\n            popup.find(\":checkbox:visible\").prop(\"checked\", false).first().trigger(\"change\");\n\n        },\n\n        close: function(element, event) {\n            if(element.get(0) === event.target)\n                $(\".selectReplaceChoose\").addClass('hidden');\n        },\n\n\t\tshowTip: function(label) {\n\n\t\t\tlet originalTip = label.find(\".checkItemTip\");\n\n\t\t\t/* If no tip element or tip already shown */\n\t\t\tif(!originalTip.length || label.data(\"tip\"))\n\t\t\t    return;\n\n            let popup = label.closest(\".selectReplaceChoose\");\n            let tip = originalTip.clone().removeClass(\"hidden\").appendTo(\"body\");\n            tip.css({\n                left: popup.offset().left,\n                top : popup.offset().top + popup.outerHeight() + 5\n            });\n            label.data(\"tip\", tip);\n\n\n\t\t},\n\n        hideTip: function(label) {\n\t\t\tif(!label.data(\"tip\"))\n\t\t\t    return;\n            label.data(\"tip\").remove();\n            label.removeData(\"tip\");\n\t\t},\n\n        /**\n         * Shows drop down\n         * @param replace Input\n         */\n        drop: function (replace) {\n\n            /* Hide all */\n\t\t\t$(\".selectReplaceChoose\").addClass('hidden');\n\n            /* Get drop */\n            let popup = replace.next(),\n                dropOffset = (new visibleCalculator(replace)).getDropOffset(replace, popup.removeClass('hidden'));\n\n            /* If cant calculate offset */\n            if(!dropOffset) return;\n\n\t\t\tpopup.css({ marginLeft: dropOffset.left, marginTop: dropOffset.top });\n\n\t\t\tif(replace.outerWidth() > popup.outerWidth())\n\t\t\t\tpopup.css(\"width\", replace.outerWidth());\n\n\t\t\t/* Search focus */\n\t\t\tif (popup.find(\".search\").length)\n\t\t\t\tpopup.find(\".search input\").val('').focus();\n\n        },\n\n        change: function(element, event) {\n\n\t\t\t/* Get inputs */\n\t\t\tlet popup = element.closest(\".selectReplaceChoose\"),\n\t\t\t\tinputs = popup.find(\"input:radio, input:checkbox\"),\n\t\t\t\tcurrent, change, children = false, replace = popup.prev(),\n\t\t\t\tval = \"\";\n\n\t\t\tlet { defaultValue, defaultAllValue } = replace.data(\"defaults\");\n\n\t\t\t/* Un select all */\n\t\t\tpopup.find(\"label\").removeClass(\"selected\");\n\n            /* Get checked */\n\t\t\tlet filtered = inputs.filter(\":checked\").each(function() {\n\t\t\t\tcurrent = $(this);\n\t\t\t\tcurrent.closest(\"label\").addClass(\"selected\");\n\t\t\t\tchildren = current.next();\n\t\t\t\tval = (val && val + \", \") + children.text();\n\t\t\t});\n\n            /* Make text shorter */\n\t\t\tif(val.length > 26)\n\t\t\t\tval = val.substr(0, 26).trim() + \"...\";\n\n\t\t\t/* If all checked */\n\t\t\tif(filtered.length === inputs.length && !popup.hasClass(\"single\"))\n\t\t\t\tval = defaultAllValue;\n\n\t\t\t/* Set input html */\n\t\t\tif(popup.hasClass(\"single\") && children)\n\t\t\t\treplace.html('').prepend(children.clone().removeClass(\"name\"));\n\t\t\telse if(!children)\n\t\t\t\treplace.html(defaultValue);\n\t\t\telse\n\t\t\t\treplace.text(val);\n\n            /* If not fake event */\n\t\t\tif(event && current)\n\t\t\t\treplace.trigger(\"change\", { value: current.val(), item: element });\n\n\t\t\t/* Hide on single-select */\n\t\t\tif(popup.hasClass(\"single\"))\n\t\t\t\tpopup.addClass('hidden');\n\n        }\n\n    }\n});","sky.directive(\"select\", (select, attrs) => {\r\n\tlet options = attrs || {};\r\n\toptions.items = [];\r\n\toptions.selected = null;\r\n\tselect.find(\"option\").each((_, option) => {\r\n\t\toptions.items.push({ html: option.innerHTML, value: option.value, checked: !!option.selected });\r\n\t});\r\n\tlet replace = sky.service(\"templates\").renderByText(\"{% import forms as forms %}{{ forms.selectReplace(options, items) }}\", { options: options, items: options.items });\r\n\treplace.replaceElement(select);\r\n});\r\nsky.directive(\".selectReplaceChoose\", (popup, attrs) => {\r\n\t\tlet replace = popup.prev();\r\n\t\treplace.data(\"defaults\", {\r\n\t\t\tdefaultValue: replace.html() || '-',\r\n\t\t\tdefaultAllValue: replace.text() || \"Все\"\r\n\t\t});\r\n\r\n\t\t/* Trigger */\r\n\t\tsetTimeout(() => { popup.find(\"input:radio, input:checkbox\").first().trigger(\"change\"); }, 1);\r\n\r\n});\r\n\r\nsky.onReady(() => {\r\n\t$(document).on(\"click touchstart\", function(event) {\r\n\r\n\t\t/* Get element */\r\n\t\tlet element = $(event.target || event.srcElement);\r\n\r\n\r\n\t\t/* If click in replace we should not hide it */\r\n\t\tif(element.closest(\".selectReplaceChoose\").length || element.closest(\".selectReplace\").length)\r\n\t\t\treturn;\r\n\r\n\t\t/* Hide all */\r\n\t\t$(\".selectReplaceChoose\").addClass('hidden');\r\n\r\n\t})\r\n});\r\n","sky.action(\"suggest\", function(suggester) {\r\n   return {\r\n       adverts: function(input, event) {\r\n\r\n           // Events\r\n           if(event.keyCode == 38 || event.keyCode == 40 || event.keyCode == 13 || event.keyCode == 27)\r\n               return;\r\n\r\n           // Stop if any other\r\n           if(this.suggestAjax)\r\n               this.suggestAjax.stop();\r\n\r\n           // Nothing\r\n           if(input.val() == \"\" || input.val().length < 2) {\r\n               suggester.hideAll();\r\n               return;\r\n           }\r\n\r\n           this.suggestAjax = sky.ajax(\"/ajax/members/search\", { name: input.val() })\r\n               .on(\"success\", function(response) {\r\n\r\n                   // No filtered\r\n                   if(!response.adverts || !response.adverts.length)\r\n                       suggester.hideAll();\r\n\r\n                   var filtered = [];\r\n\r\n                   $.each(response.adverts, function(_, advert) {\r\n                       filtered.push(advert.username);\r\n                   });\r\n\r\n                   // Show\r\n                   suggester.show(input, filtered);\r\n\r\n               }).on(\"error\", function() {\r\n                   suggester.hideAll();\r\n               });\r\n\r\n       },\r\n\r\n       campaigns: function(input, event){\r\n\r\n           // Events\r\n           if(event.keyCode == 38 || event.keyCode == 40 || event.keyCode == 13 || event.keyCode == 27)\r\n               return;\r\n\r\n           // Stop if any other\r\n           if(this.suggestAjax)\r\n               this.suggestAjax.stop();\r\n\r\n           // Nothing\r\n           if(input.val() == \"\" || input.val().length < 2) {\r\n               suggester.hideAll();\r\n               return;\r\n           }\r\n\r\n           this.suggestAjax = sky.ajax(\"/ajax/campaigns/search\", { name: input.val() })\r\n               .on(\"success\", function(response) {\r\n\r\n                   // No filtered\r\n                   if(!response.campaigns || !response.campaigns.length)\r\n                       suggester.hideAll();\r\n\r\n                   var filtered = [];\r\n\r\n                   $.each(response.campaigns, function(_, campaign) {\r\n\r\n                       filtered.push({ html: campaign.name });\r\n                   });\r\n\r\n                   // Show\r\n                   suggester.show(input, filtered);\r\n\r\n               }).on(\"error\", function() {\r\n                   suggester.hideAll();\r\n               });\r\n       },\r\n\r\n       campaignsSpecial: function(input, event){\r\n           // Events\r\n           if(event.keyCode == 38 || event.keyCode == 40 || event.keyCode == 13 || event.keyCode == 27)\r\n               return;\r\n\r\n           // Nothing\r\n           if(input.val() == \"\" || input.val().length < 2) {\r\n               suggester.hideAll();\r\n               return;\r\n           }\r\n\r\n           if(this.suggestAjax)\r\n               this.suggestAjax.stop();\r\n\r\n           this.suggestAjax = sky.ajax(\"/ajax/campaigns/search\", { name: input.val() })\r\n               .on(\"success\", function(response) {\r\n\r\n                   // No filtered\r\n                   if(!response.campaigns || !response.campaigns.length)\r\n                       suggester.hideAll();\r\n\r\n                   var filtered = [];\r\n\r\n                   $.each(response.campaigns, function(_, campaign) {\r\n\r\n                       filtered.push({ html: campaign.name+\" (\"+campaign.advert.username+\")\", callback: function(){\r\n                           sky.actions.perform(null, null, \"page.selectCampaign\", [campaign.id]);\r\n                       }});\r\n                   });\r\n\r\n                   // Show\r\n                   suggester.show(input, filtered);\r\n\r\n               }).on(\"error\", function() {\r\n                   suggester.hideAll();\r\n               });\r\n       }\r\n   }\r\n});","sky.directive(\"[data-suggests]\", function(element, attributes) {\n\telement.attr(\"data-event\", \"keyup: suggest.\" + attributes[\"data-suggests\"]).attr(\"autocomplete\", \"off\");\n});","/**\n * Fire services init done\n */\nsky.exec(function() {\n\tsky.servicesDeferred.resolve();\n});","sky.directive(\"input.autoHttp\", function(input) {\n\tinput.on(\"focus\", function() {\n\t\tif(input.val() === \"\") input.val(\"http://\").get(0).selectionStart = 7;\n\t});\n});","/**\n * Fire project init done\n */\nsky.exec(function() {\n    document.body.classList.remove(\"hidden\");\n    sky.projectDeffered.resolve();\n});"]}